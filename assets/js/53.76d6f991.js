(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{378:function(s,t,a){"use strict";a.r(t);var e=a(0),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"listener"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#listener"}},[s._v("#")]),s._v(" listener")]),s._v(" "),a("p",[s._v("listener配置是用来绑定"),a("code",[s._v("BrokerIP+端口地址")]),s._v("​的，也就是只有通过绑定的地址才能够访问到该Broker。除了绑定地址之外，还可以配置该监听地址的认证协议，也就是使用该地址连接Broker时需要指定使用何种协议方式进行连接。")]),s._v(" "),a("p",[s._v("如下配置：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("listeners"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" INTERNAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9092")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("EXTERNAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9094")]),s._v("\nkafka_listener_security_protocol_map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"INTERNAL:SASL_PLAINTEXT,EXTERNAL:SASL_PLAINTEXT"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("连接该Broker的客户端只能通过"),a("code",[s._v("172.17.0.10:9092")]),s._v("​和"),a("code",[s._v("172.17.0.10:9094")]),s._v("​这两个地址访问kafka，并给前一个地址设置listener名称为"),a("code",[s._v("INTERNAL")]),s._v("​，后一个为"),a("code",[s._v("EXTERNAL")]),s._v("​")]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("kafka_listener_security_protocol_map")]),s._v("​配置中设置listener所使用的通信协议，INTERNAL设置的是"),a("code",[s._v("SASL_PLAINTEXT")]),s._v("​，这也是常见的用户名和密码认证协议，"),a("code",[s._v("EXTERNAL")]),s._v("​设置也是该协议。")]),s._v(" "),a("p",[s._v("最终，kafka 客户端连接该kafka broker，需要通过"),a("code",[s._v("172.17.0.10:9092")]),s._v("​或"),a("code",[s._v("172.17.0.10:9094")]),s._v("​地址进行连接，并且都需要使用用户名和密码进行认证。")]),s._v(" "),a("h2",{attrs:{id:"advertised-listeners"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#advertised-listeners"}},[s._v("#")]),s._v(" advertised.listeners")]),s._v(" "),a("p",[s._v("该配置指定Kafka Broker对外公开的网络IP和端口，用于告知客户端如何连接到Kafka Broker。公开的方式是通过存储在zookeeper中进行共享数据的。")]),s._v(" "),a("p",[s._v("如下配置：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("listeners"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" INTERNAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9092")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("EXTERNAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9094")]),s._v("\nadvertised_listeners"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" INTERNAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9092")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("EXTERNAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("公网IP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("端口\nkafka_listener_security_protocol_map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"INTERNAL:SASL_PLAINTEXT,EXTERNAL:SASL_PLAINTEXT"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("​"),a("code",[s._v("listeners")]),s._v("​和"),a("code",[s._v("kafka_listener_security_protocol_map")]),s._v("​的配置和上面讲的一样，而"),a("code",[s._v("advertised_listeners")]),s._v("​的配置和"),a("code",[s._v("listeners")]),s._v("​配置含义基本一致，但是它会保存在zookeeper中"),a("code",[s._v("/brokers/ids/0")]),s._v("​的endpoints里。")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"endpoints"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"INTERNAL://172.17.0.10:9092"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EXTERNAL://172.17.0.10:9094"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("kafka客户端连接kafka broker时，会先获取所有brokers的元数据信息，获取到endpoints的信息，然后再通过其中的endpint进行对broker进行连接操作。")]),s._v(" "),a("p",[a("strong",[s._v("问题来了，我都知道了kafka broker的IP地址+端口了，为什么还需要advertised.listeners?")])]),s._v(" "),a("p",[s._v("在需要代理才能连接kafka broker时，在这种场景时，需要将"),a("code",[s._v("advertised.listeners")]),s._v("​设置为代理的地址。")]),s._v(" "),a("p",[s._v("在公有云场景下部署kafka集群，公网IP不是在本节点网卡上的，所以无法通过listener进行绑定，所以只能通过0.0.0.0进行绑定。但是在集群外部时，kafka客户端进行连接，它是需要有能力访问kafka的每一个broker节点的，所以需要在advertised.listeners中配置公网IP，并存储在zookeeper中，这样kafka客户端就能拿到所有broker节点的公网IP并进行访问。")]),s._v(" "),a("h2",{attrs:{id:"内外网分流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内外网分流"}},[s._v("#")]),s._v(" 内外网分流")]),s._v(" "),a("p",[s._v("在公有云场景下，我们希望在集群内部客户端访问时不需要认证，而外部客户端访问时需要走认证加密访问。配置如下：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("listeners: INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9094\nadvertised_listeners: INTERNAL://内网IP:9092,EXTERNAL://公网IP:9094\nkafka_listener_security_protocol_map: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"INTERNAL:PLAINTEXT,EXTERNAL:SASL_PLAINTEXT"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("listeners都设置成对0.0.0.0进行监听也就是监听所有的网卡，但它们的端口不同，9092端口使用PLAINTEXT协议，而9094端口走的是SASL_PLAINTEXT协议")]),s._v(" "),a("p",[s._v("advertised_listeners，内网IP使用PLAINTEXT协议，公网IP使用SASL_PLAINTEXT协议。")]),s._v(" "),a("p",[s._v("当内网客户端访问时，会先获取到所有brokers的advertised_listeners信息，然后通过PLAINTEXT协议走内网IP访问kafka集群。")]),s._v(" "),a("p",[s._v("当公网客户端访问时，会先获取到所有brokers的advertised_listeners信息，然后通过SASL_PLAINTEXT走公网IP进行访问。")]),s._v(" "),a("p",[s._v("‍")]),s._v(" "),a("h2",{attrs:{id:"参考链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),a("ul",[a("li",[s._v("https://www.finclip.com/news/f/30226.html")]),s._v(" "),a("li",[s._v("https://juejin.cn/post/6893410969611927566")])])])}),[],!1,null,null,null);t.default=n.exports}}]);