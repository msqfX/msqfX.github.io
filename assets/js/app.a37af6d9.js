(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[]]);!function(n){function e(e){for(var r,s,i=e[0],l=e[1],c=e[2],d=0,u=[];d<i.length;d++)s=i[d],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&u.push(a[s][0]),a[s]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(n[r]=l[r]);for(p&&p(e);u.length;)u.shift()();return o.push.apply(o,c||[]),t()}function t(){for(var n,e=0;e<o.length;e++){for(var t=o[e],r=!0,i=1;i<t.length;i++){var l=t[i];0!==a[l]&&(r=!1)}r&&(o.splice(e--,1),n=s(s.s=t[0]))}return n}var r={},a={1:0},o=[];function s(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.e=function(n){var e=[],t=a[n];if(0!==t)if(t)e.push(t[2]);else{var r=new Promise((function(e,r){t=a[n]=[e,r]}));e.push(t[2]=r);var o,i=document.createElement("script");i.charset="utf-8",i.timeout=120,s.nc&&i.setAttribute("nonce",s.nc),i.src=function(n){return s.p+"assets/js/"+({}[n]||n)+"."+{2:"ba2df60a",3:"7b7b7ad0",4:"ee8017dd",5:"522bd6ec",6:"24f2b434",7:"fa04b38a",8:"9ccba721",9:"616f3d23",10:"49a84f11",11:"dc1f7f59",12:"d5cafed8",13:"d35cdd82",14:"0552ffa3",15:"dd83f90d",16:"cd39b01c",17:"be2c5d1c",18:"30011395",19:"91079076",20:"b9d0dabe",21:"d9c47444",22:"acdf2bd8",23:"bcbd2fc3",24:"dd45921c",25:"fc4665a1",26:"604115fe",27:"fe372ae0",28:"269a2f2c",29:"cb38c79a",30:"2a72aaa6",31:"5e699f78",32:"7caefc7b",33:"2cba8fe7",34:"1633e2ed",35:"27c53d02",36:"525ea1a7",37:"f9997184",38:"2e481766",39:"9edefdc0",40:"d20c14a0",41:"4a8a99f7",42:"a3e6900d",43:"58146ace",44:"d54f7679",45:"9f3d0746",46:"67b6d541",47:"1bdc2f23",48:"ce48209b",49:"1124b5b8",50:"4836a5a2",51:"2e0285d8",52:"178fafe1",53:"76d6f991",54:"7bae518f",55:"8ad542dd",56:"eb3a5866",57:"66a548b5",58:"11c919a4",59:"56ee65ad",60:"3f3cc5b3",61:"6aafaf2b",62:"3e86764a",63:"eb854243",64:"047122c3",65:"ab3be43f",66:"0e819df1",67:"10046f7e",68:"dd3f9d4c",69:"61a878dc",70:"723f314f",71:"d885dd2c",72:"31685ecb",73:"b240ced0",74:"7463a336",75:"7a05004d",76:"ecb99c56",77:"c57bc56b",78:"00ee2dbd",79:"b145c896",80:"d71abb80",81:"1552378a",82:"5f88610a",83:"b80ddb74",84:"ae1cf267",85:"08950c74",86:"99955193",87:"7c290c78",88:"f7f4496c",89:"bf057c70",90:"886e171c",91:"9ee9ec0e",92:"1c227473",93:"4881a96e",94:"68ac79b2",95:"744db94e",96:"77331cfb",97:"a4e9229f",98:"60f98d83",99:"995587b3",100:"6713a918",101:"662a7fd4",102:"7caa9051",103:"d2e4b5ac",104:"1b4b2c8e",105:"fb4fd6d8",106:"a840626a",107:"87b06d77",108:"6b6c072f",109:"25e2c915",110:"2a66b5c5",111:"207f71bd",112:"8bd38d71",113:"6713bacc",114:"29464f99",115:"96eaf075",116:"4e5cb7b4",117:"d1a5de4c",118:"655c6520",119:"94830a2a",120:"01eb7047",121:"a68fd0f7",122:"93091491"}[n]+".js"}(n);var l=new Error;o=function(e){i.onerror=i.onload=null,clearTimeout(c);var t=a[n];if(0!==t){if(t){var r=e&&("load"===e.type?"missing":e.type),o=e&&e.target&&e.target.src;l.message="Loading chunk "+n+" failed.\n("+r+": "+o+")",l.name="ChunkLoadError",l.type=r,l.request=o,t[1](l)}a[n]=void 0}};var c=setTimeout((function(){o({type:"timeout",target:i})}),12e4);i.onerror=i.onload=o,document.head.appendChild(i)}return Promise.all(e)},s.m=n,s.c=r,s.d=function(n,e,t){s.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},s.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},s.t=function(n,e){if(1&e&&(n=s(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var r in n)s.d(t,r,function(e){return n[e]}.bind(null,r));return t},s.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return s.d(e,"a",e),e},s.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},s.p="/",s.oe=function(n){throw console.error(n),n};var i=window.webpackJsonp=window.webpackJsonp||[],l=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var p=l;o.push([99,0]),t()}([function(n,e,t){"use strict";function r(n,e,t,r,a,o,s,i){var l,c="function"==typeof n?n.options:n;if(e&&(c.render=e,c.staticRenderFns=t,c._compiled=!0),r&&(c.functional=!0),o&&(c._scopeId="data-v-"+o),s?(l=function(n){(n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(n=__VUE_SSR_CONTEXT__),a&&a.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(s)},c._ssrRegister=l):a&&(l=i?function(){a.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:a),l)if(c.functional){c._injectStyles=l;var p=c.render;c.render=function(n,e){return l.call(e),p(n,e)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,l):[l]}return{exports:n,options:c}}t.d(e,"a",(function(){return r}))},function(n,e,t){"use strict";var r=function(n){return n&&n.Math===Math&&n};n.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof global&&global)||r("object"==typeof this&&this)||function(){return this}()||Function("return this")()},function(n,e,t){"use strict";var r="object"==typeof document&&document.all;n.exports=void 0===r&&void 0!==r?function(n){return"function"==typeof n||n===r}:function(n){return"function"==typeof n}},function(n,e,t){"use strict";n.exports=function(n){try{return!!n()}catch(n){return!0}}},function(n,e,t){"use strict";var r=t(28),a=Function.prototype,o=a.call,s=r&&a.bind.bind(o,o);n.exports=r?s:function(n){return function(){return o.apply(n,arguments)}}},function(n,e){var t=Array.isArray;n.exports=t},function(n,e,t){"use strict";var r=t(3);n.exports=!r((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(n,e,t){"use strict";var r=t(2);n.exports=function(n){return"object"==typeof n?null!==n:r(n)}},function(n,e,t){var r=t(69),a="object"==typeof self&&self&&self.Object===Object&&self,o=r||a||Function("return this")();n.exports=o},function(n,e,t){"use strict";var r=t(4),a=t(37),o=r({}.hasOwnProperty);n.exports=Object.hasOwn||function(n,e){return o(a(n),e)}},function(n,e,t){var r=t(166),a=t(169);n.exports=function(n,e){var t=a(n,e);return r(t)?t:void 0}},function(n,e,t){"use strict";t.d(e,"e",(function(){return r})),t.d(e,"b",(function(){return o})),t.d(e,"j",(function(){return s})),t.d(e,"g",(function(){return l})),t.d(e,"h",(function(){return c})),t.d(e,"i",(function(){return p})),t.d(e,"c",(function(){return d})),t.d(e,"f",(function(){return u})),t.d(e,"l",(function(){return m})),t.d(e,"m",(function(){return f})),t.d(e,"d",(function(){return h})),t.d(e,"k",(function(){return v})),t.d(e,"n",(function(){return b})),t.d(e,"a",(function(){return _}));t(16);const r=/#.*$/,a=/\.(md|html)$/,o=/\/$/,s=/^[a-z]+:/i;function i(n){return decodeURI(n).replace(r,"").replace(a,"")}function l(n){return s.test(n)}function c(n){return/^mailto:/.test(n)}function p(n){return/^tel:/.test(n)}function d(n){if(l(n))return n;if(!n)return"404";const e=n.match(r),t=e?e[0]:"",a=i(n);return o.test(a)?n:a+".html"+t}function u(n,e){const t=n.hash,a=function(n){const e=n&&n.match(r);if(e)return e[0]}(e);if(a&&t!==a)return!1;return i(n.path)===i(e)}function m(n,e,t){if(l(e))return{type:"external",path:e};t&&(e=function(n,e,t){const r=n.charAt(0);if("/"===r)return n;if("?"===r||"#"===r)return e+n;const a=e.split("/");t&&a[a.length-1]||a.pop();const o=n.replace(/^\//,"").split("/");for(let n=0;n<o.length;n++){const e=o[n];".."===e?a.pop():"."!==e&&a.push(e)}""!==a[0]&&a.unshift("");return a.join("/")}(e,t));const r=i(e);for(let e=0;e<n.length;e++)if(i(n[e].regularPath)===r)return Object.assign({},n[e],{type:"page",path:d(n[e].path)});return console.error(`[vuepress] No matching page found for sidebar item "${e}"`),{}}function f(n,e,t,r){const{pages:a,themeConfig:o}=t,s=r&&o.locales&&o.locales[r]||o;if("auto"===(n.frontmatter.sidebar||s.sidebar||o.sidebar))return g(n);const i=s.sidebar||o.sidebar;if(i){const{base:t,config:r}=function(n,e){if(Array.isArray(e))return{base:"/",config:e};for(const r in e)if(0===(t=n,/(\.html|\/)$/.test(t)?t:t+"/").indexOf(encodeURI(r)))return{base:r,config:e[r]};var t;return{}}(e,i);return"auto"===r?g(n):r?r.map(n=>function n(e,t,r,a=1){if("string"==typeof e)return m(t,e,r);if(Array.isArray(e))return Object.assign(m(t,e[0],r),{title:e[1]});{a>3&&console.error("[vuepress] detected a too deep nested sidebar group.");const o=e.children||[];return 0===o.length&&e.path?Object.assign(m(t,e.path,r),{title:e.title}):{type:"group",path:e.path,title:e.title,sidebarDepth:e.sidebarDepth,initialOpenGroupIndex:e.initialOpenGroupIndex,children:o.map(e=>n(e,t,r,a+1)),collapsable:!1!==e.collapsable}}}(n,a,t)):[]}return[]}function g(n){const e=h(n.headers||[]);return[{type:"group",collapsable:!1,title:n.title,path:null,children:e.map(e=>({type:"auto",title:e.title,basePath:n.path,path:n.path+"#"+e.slug,children:e.children||[]}))}]}function h(n){let e;return(n=n.map(n=>Object.assign({},n))).forEach(n=>{2===n.level?e=n:e&&(e.children||(e.children=[])).push(n)}),n.filter(n=>2===n.level)}function v(n){return Object.assign(n,{type:n.items&&n.items.length?"links":"link"})}function b(n){return Object.prototype.toString.call(n).match(/\[object (.*?)\]/)[1].toLowerCase()}function y(n){let e=n.frontmatter.date||n.lastUpdated||new Date,t=new Date(e);return"Invalid Date"==t&&e&&(t=new Date(e.replace(/-/g,"/"))),t.getTime()}function _(n,e){return y(e)-y(n)}},function(n,e){n.exports=function(n){return null!=n&&"object"==typeof n}},function(n,e,t){var r=t(15),a=t(151),o=t(152),s=r?r.toStringTag:void 0;n.exports=function(n){return null==n?void 0===n?"[object Undefined]":"[object Null]":s&&s in Object(n)?a(n):o(n)}},function(n,e,t){"use strict";var r=t(6),a=t(18),o=t(29);n.exports=r?function(n,e,t){return a.f(n,e,o(1,t))}:function(n,e,t){return n[e]=t,n}},function(n,e,t){var r=t(8).Symbol;n.exports=r},function(n,e,t){"use strict";var r=t(26),a=t(37),o=t(38),s=t(145),i=t(147);r({target:"Array",proto:!0,arity:1,forced:t(3)((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(n){return n instanceof TypeError}}()},{push:function(n){var e=a(this),t=o(e),r=arguments.length;i(t+r);for(var l=0;l<r;l++)e[t]=arguments[l],t++;return s(e,t),t}})},function(n,e,t){"use strict";var r=t(4),a=r({}.toString),o=r("".slice);n.exports=function(n){return o(a(n),8,-1)}},function(n,e,t){"use strict";var r=t(6),a=t(62),o=t(108),s=t(63),i=t(53),l=TypeError,c=Object.defineProperty,p=Object.getOwnPropertyDescriptor;e.f=r?o?function(n,e,t){if(s(n),e=i(e),s(t),"function"==typeof n&&"prototype"===e&&"value"in t&&"writable"in t&&!t.writable){var r=p(n,e);r&&r.writable&&(n[e]=t.value,t={configurable:"configurable"in t?t.configurable:r.configurable,enumerable:"enumerable"in t?t.enumerable:r.enumerable,writable:!1})}return c(n,e,t)}:c:function(n,e,t){if(s(n),e=i(e),s(t),a)try{return c(n,e,t)}catch(n){}if("get"in t||"set"in t)throw new l("Accessors not supported");return"value"in t&&(n[e]=t.value),n}},function(n,e,t){var r=t(156),a=t(157),o=t(158),s=t(159),i=t(160);function l(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=a,l.prototype.get=o,l.prototype.has=s,l.prototype.set=i,n.exports=l},function(n,e,t){var r=t(71);n.exports=function(n,e){for(var t=n.length;t--;)if(r(n[t][0],e))return t;return-1}},function(n,e,t){var r=t(10)(Object,"create");n.exports=r},function(n,e,t){var r=t(178);n.exports=function(n,e){var t=n.__data__;return r(e)?t["string"==typeof e?"string":"hash"]:t.map}},function(n,e,t){var r=t(46);n.exports=function(n){if("string"==typeof n||r(n))return n;var e=n+"";return"0"==e&&1/n==-1/0?"-0":e}},function(n,e,t){var r,a;
/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */void 0===(a="function"==typeof(r=function(){var n,e,t={version:"0.2.0"},r=t.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};function a(n,e,t){return n<e?e:n>t?t:n}function o(n){return 100*(-1+n)}t.configure=function(n){var e,t;for(e in n)void 0!==(t=n[e])&&n.hasOwnProperty(e)&&(r[e]=t);return this},t.status=null,t.set=function(n){var e=t.isStarted();n=a(n,r.minimum,1),t.status=1===n?null:n;var l=t.render(!e),c=l.querySelector(r.barSelector),p=r.speed,d=r.easing;return l.offsetWidth,s((function(e){""===r.positionUsing&&(r.positionUsing=t.getPositioningCSS()),i(c,function(n,e,t){var a;return(a="translate3d"===r.positionUsing?{transform:"translate3d("+o(n)+"%,0,0)"}:"translate"===r.positionUsing?{transform:"translate("+o(n)+"%,0)"}:{"margin-left":o(n)+"%"}).transition="all "+e+"ms "+t,a}(n,p,d)),1===n?(i(l,{transition:"none",opacity:1}),l.offsetWidth,setTimeout((function(){i(l,{transition:"all "+p+"ms linear",opacity:0}),setTimeout((function(){t.remove(),e()}),p)}),p)):setTimeout(e,p)})),this},t.isStarted=function(){return"number"==typeof t.status},t.start=function(){t.status||t.set(0);var n=function(){setTimeout((function(){t.status&&(t.trickle(),n())}),r.trickleSpeed)};return r.trickle&&n(),this},t.done=function(n){return n||t.status?t.inc(.3+.5*Math.random()).set(1):this},t.inc=function(n){var e=t.status;return e?("number"!=typeof n&&(n=(1-e)*a(Math.random()*e,.1,.95)),e=a(e+n,0,.994),t.set(e)):t.start()},t.trickle=function(){return t.inc(Math.random()*r.trickleRate)},n=0,e=0,t.promise=function(r){return r&&"resolved"!==r.state()?(0===e&&t.start(),n++,e++,r.always((function(){0==--e?(n=0,t.done()):t.set((n-e)/n)})),this):this},t.render=function(n){if(t.isRendered())return document.getElementById("nprogress");c(document.documentElement,"nprogress-busy");var e=document.createElement("div");e.id="nprogress",e.innerHTML=r.template;var a,s=e.querySelector(r.barSelector),l=n?"-100":o(t.status||0),p=document.querySelector(r.parent);return i(s,{transition:"all 0 linear",transform:"translate3d("+l+"%,0,0)"}),r.showSpinner||(a=e.querySelector(r.spinnerSelector))&&u(a),p!=document.body&&c(p,"nprogress-custom-parent"),p.appendChild(e),e},t.remove=function(){p(document.documentElement,"nprogress-busy"),p(document.querySelector(r.parent),"nprogress-custom-parent");var n=document.getElementById("nprogress");n&&u(n)},t.isRendered=function(){return!!document.getElementById("nprogress")},t.getPositioningCSS=function(){var n=document.body.style,e="WebkitTransform"in n?"Webkit":"MozTransform"in n?"Moz":"msTransform"in n?"ms":"OTransform"in n?"O":"";return e+"Perspective"in n?"translate3d":e+"Transform"in n?"translate":"margin"};var s=function(){var n=[];function e(){var t=n.shift();t&&t(e)}return function(t){n.push(t),1==n.length&&e()}}(),i=function(){var n=["Webkit","O","Moz","ms"],e={};function t(t){return t=t.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(n,e){return e.toUpperCase()})),e[t]||(e[t]=function(e){var t=document.body.style;if(e in t)return e;for(var r,a=n.length,o=e.charAt(0).toUpperCase()+e.slice(1);a--;)if((r=n[a]+o)in t)return r;return e}(t))}function r(n,e,r){e=t(e),n.style[e]=r}return function(n,e){var t,a,o=arguments;if(2==o.length)for(t in e)void 0!==(a=e[t])&&e.hasOwnProperty(t)&&r(n,t,a);else r(n,o[1],o[2])}}();function l(n,e){return("string"==typeof n?n:d(n)).indexOf(" "+e+" ")>=0}function c(n,e){var t=d(n),r=t+e;l(t,e)||(n.className=r.substring(1))}function p(n,e){var t,r=d(n);l(n,e)&&(t=r.replace(" "+e+" "," "),n.className=t.substring(1,t.length-1))}function d(n){return(" "+(n.className||"")+" ").replace(/\s+/gi," ")}function u(n){n&&n.parentNode&&n.parentNode.removeChild(n)}return t})?r.call(e,t,e,n):r)||(n.exports=a)},function(n){n.exports=JSON.parse('{"name":"vuepress-plugin-comment-plus","version":"1.1.0","description":"Comment plugin in vuepress, such as Gitalk, Valine...","main":"index.js","scripts":{"test":"echo \\"Error: no test specified\\" && exit 1"},"repository":{"type":"git","url":"git+ssh://git@github.com/SivanLaai/vuepress-plugin-comment-plus.git"},"keywords":["vuepress","comment","plugin","vue","gitalk","valine","waline"],"author":"dongyuanxin","license":"MIT","bugs":{"url":"https://github.com/SivanLaai/vuepress-plugin-comment-plus/issues"},"homepage":"https://github.com/SivanLaai/vuepress-plugin-comment-plus#readme","dependencies":{"ejs":"^2.6.1","gitalk":"^1.5.0","gitalk-fix":"^1.5.2","i":"^0.3.6","npm":"^6.9.0","valine":"^1.3.9","@waline/client":"^1.3.3"},"__npminstall_done":true,"_from":"vuepress-plugin-comment-plus@1.1.0","_resolved":"https://registry.npmmirror.com/vuepress-plugin-comment-plus/-/vuepress-plugin-comment-plus-1.1.0.tgz"}')},function(n,e,t){"use strict";var r=t(1),a=t(50).f,o=t(14),s=t(109),i=t(36),l=t(65),c=t(125);n.exports=function(n,e){var t,p,d,u,m,f=n.target,g=n.global,h=n.stat;if(t=g?r:h?r[f]||i(f,{}):r[f]&&r[f].prototype)for(p in e){if(u=e[p],d=n.dontCallGetSet?(m=a(t,p))&&m.value:t[p],!c(g?p:f+(h?".":"#")+p,n.forced)&&void 0!==d){if(typeof u==typeof d)continue;l(u,d)}(n.sham||d&&d.sham)&&o(u,"sham",!0),s(t,p,u,n)}}},function(n,e,t){"use strict";var r=t(28),a=Function.prototype.call;n.exports=r?a.bind(a):function(){return a.apply(a,arguments)}},function(n,e,t){"use strict";var r=t(3);n.exports=!r((function(){var n=function(){}.bind();return"function"!=typeof n||n.hasOwnProperty("prototype")}))},function(n,e,t){"use strict";n.exports=function(n,e){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:e}}},function(n,e,t){"use strict";var r=t(51),a=t(31);n.exports=function(n){return r(a(n))}},function(n,e,t){"use strict";var r=t(52),a=TypeError;n.exports=function(n){if(r(n))throw new a("Can't call method on "+n);return n}},function(n,e,t){"use strict";var r=t(1),a=t(2),o=function(n){return a(n)?n:void 0};n.exports=function(n,e){return arguments.length<2?o(r[n]):r[n]&&r[n][e]}},function(n,e,t){"use strict";var r=t(2),a=t(105),o=TypeError;n.exports=function(n){if(r(n))return n;throw new o(a(n)+" is not a function")}},function(n,e,t){"use strict";var r=t(1),a=t(59),o=t(9),s=t(61),i=t(57),l=t(56),c=r.Symbol,p=a("wks"),d=l?c.for||c:c&&c.withoutSetter||s;n.exports=function(n){return o(p,n)||(p[n]=i&&o(c,n)?c[n]:d("Symbol."+n)),p[n]}},function(n,e,t){"use strict";var r=t(60),a=t(1),o=t(36),s=n.exports=a["__core-js_shared__"]||o("__core-js_shared__",{});(s.versions||(s.versions=[])).push({version:"3.37.1",mode:r?"pure":"global",copyright:"Â© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.1/LICENSE",source:"https://github.com/zloirock/core-js"})},function(n,e,t){"use strict";var r=t(1),a=Object.defineProperty;n.exports=function(n,e){try{a(r,n,{value:e,configurable:!0,writable:!0})}catch(t){r[n]=e}return e}},function(n,e,t){"use strict";var r=t(31),a=Object;n.exports=function(n){return a(r(n))}},function(n,e,t){"use strict";var r=t(122);n.exports=function(n){return r(n.length)}},function(n,e,t){var r=t(150),a=t(12),o=Object.prototype,s=o.hasOwnProperty,i=o.propertyIsEnumerable,l=r(function(){return arguments}())?r:function(n){return a(n)&&s.call(n,"callee")&&!i.call(n,"callee")};n.exports=l},function(n,e,t){var r=t(10)(t(8),"Map");n.exports=r},function(n,e){n.exports=function(n){var e=typeof n;return null!=n&&("object"==e||"function"==e)}},function(n,e,t){var r=t(170),a=t(177),o=t(179),s=t(180),i=t(181);function l(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=a,l.prototype.get=o,l.prototype.has=s,l.prototype.set=i,n.exports=l},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n){t[++e]=n})),t}},function(n,e){n.exports=function(n){return"number"==typeof n&&n>-1&&n%1==0&&n<=9007199254740991}},function(n,e,t){var r=t(5),a=t(46),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;n.exports=function(n,e){if(r(n))return!1;var t=typeof n;return!("number"!=t&&"symbol"!=t&&"boolean"!=t&&null!=n&&!a(n))||(s.test(n)||!o.test(n)||null!=e&&n in Object(e))}},function(n,e,t){var r=t(13),a=t(12);n.exports=function(n){return"symbol"==typeof n||a(n)&&"[object Symbol]"==r(n)}},function(n,e){n.exports=function(n){return n}},function(n,e){n.exports=function(n){return n.webpackPolyfill||(n.deprecate=function(){},n.paths=[],n.children||(n.children=[]),Object.defineProperty(n,"loaded",{enumerable:!0,get:function(){return n.l}}),Object.defineProperty(n,"id",{enumerable:!0,get:function(){return n.i}}),n.webpackPolyfill=1),n}},function(n,e){var t=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,o=/^0o[0-7]+$/i,s=parseInt,i="object"==typeof global&&global&&global.Object===Object&&global,l="object"==typeof self&&self&&self.Object===Object&&self,c=i||l||Function("return this")(),p=Object.prototype.toString,d=Math.max,u=Math.min,m=function(){return c.Date.now()};function f(n){var e=typeof n;return!!n&&("object"==e||"function"==e)}function g(n){if("number"==typeof n)return n;if(function(n){return"symbol"==typeof n||function(n){return!!n&&"object"==typeof n}(n)&&"[object Symbol]"==p.call(n)}(n))return NaN;if(f(n)){var e="function"==typeof n.valueOf?n.valueOf():n;n=f(e)?e+"":e}if("string"!=typeof n)return 0===n?n:+n;n=n.replace(t,"");var i=a.test(n);return i||o.test(n)?s(n.slice(2),i?2:8):r.test(n)?NaN:+n}n.exports=function(n,e,t){var r,a,o,s,i,l,c=0,p=!1,h=!1,v=!0;if("function"!=typeof n)throw new TypeError("Expected a function");function b(e){var t=r,o=a;return r=a=void 0,c=e,s=n.apply(o,t)}function y(n){return c=n,i=setTimeout(k,e),p?b(n):s}function _(n){var t=n-l;return void 0===l||t>=e||t<0||h&&n-c>=o}function k(){var n=m();if(_(n))return w(n);i=setTimeout(k,function(n){var t=e-(n-l);return h?u(t,o-(n-c)):t}(n))}function w(n){return i=void 0,v&&r?b(n):(r=a=void 0,s)}function x(){var n=m(),t=_(n);if(r=arguments,a=this,l=n,t){if(void 0===i)return y(l);if(h)return i=setTimeout(k,e),b(l)}return void 0===i&&(i=setTimeout(k,e)),s}return e=g(e)||0,f(t)&&(p=!!t.leading,o=(h="maxWait"in t)?d(g(t.maxWait)||0,e):o,v="trailing"in t?!!t.trailing:v),x.cancel=function(){void 0!==i&&clearTimeout(i),c=0,r=l=a=i=void 0},x.flush=function(){return void 0===i?s:w(m())},x}},function(n,e,t){"use strict";var r=t(6),a=t(27),o=t(101),s=t(29),i=t(30),l=t(53),c=t(9),p=t(62),d=Object.getOwnPropertyDescriptor;e.f=r?d:function(n,e){if(n=i(n),e=l(e),p)try{return d(n,e)}catch(n){}if(c(n,e))return s(!a(o.f,n,e),n[e])}},function(n,e,t){"use strict";var r=t(4),a=t(3),o=t(17),s=Object,i=r("".split);n.exports=a((function(){return!s("z").propertyIsEnumerable(0)}))?function(n){return"String"===o(n)?i(n,""):s(n)}:s},function(n,e,t){"use strict";n.exports=function(n){return null==n}},function(n,e,t){"use strict";var r=t(102),a=t(54);n.exports=function(n){var e=r(n,"string");return a(e)?e:e+""}},function(n,e,t){"use strict";var r=t(32),a=t(2),o=t(55),s=t(56),i=Object;n.exports=s?function(n){return"symbol"==typeof n}:function(n){var e=r("Symbol");return a(e)&&o(e.prototype,i(n))}},function(n,e,t){"use strict";var r=t(4);n.exports=r({}.isPrototypeOf)},function(n,e,t){"use strict";var r=t(57);n.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(n,e,t){"use strict";var r=t(58),a=t(3),o=t(1).String;n.exports=!!Object.getOwnPropertySymbols&&!a((function(){var n=Symbol("symbol detection");return!o(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},function(n,e,t){"use strict";var r,a,o=t(1),s=t(103),i=o.process,l=o.Deno,c=i&&i.versions||l&&l.version,p=c&&c.v8;p&&(a=(r=p.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!a&&s&&(!(r=s.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=s.match(/Chrome\/(\d+)/))&&(a=+r[1]),n.exports=a},function(n,e,t){"use strict";var r=t(35);n.exports=function(n,e){return r[n]||(r[n]=e||{})}},function(n,e,t){"use strict";n.exports=!1},function(n,e,t){"use strict";var r=t(4),a=0,o=Math.random(),s=r(1..toString);n.exports=function(n){return"Symbol("+(void 0===n?"":n)+")_"+s(++a+o,36)}},function(n,e,t){"use strict";var r=t(6),a=t(3),o=t(107);n.exports=!r&&!a((function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(n,e,t){"use strict";var r=t(7),a=String,o=TypeError;n.exports=function(n){if(r(n))return n;throw new o(a(n)+" is not an object")}},function(n,e,t){"use strict";n.exports={}},function(n,e,t){"use strict";var r=t(9),a=t(116),o=t(50),s=t(18);n.exports=function(n,e,t){for(var i=a(e),l=s.f,c=o.f,p=0;p<i.length;p++){var d=i[p];r(n,d)||t&&r(t,d)||l(n,d,c(e,d))}}},function(n,e,t){"use strict";var r=t(121);n.exports=function(n){var e=+n;return e!=e||0===e?0:r(e)}},function(n,e,t){"use strict";var r=t(132),a=t(7),o=t(31),s=t(133);n.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var n,e=!1,t={};try{(n=r(Object.prototype,"__proto__","set"))(t,[]),e=t instanceof Array}catch(n){}return function(t,r){return o(t),s(r),a(t)?(e?n(t,r):t.__proto__=r,t):t}}():void 0)},function(n,e){n.exports=function(n,e){for(var t=-1,r=e.length,a=n.length;++t<r;)n[a+t]=e[t];return n}},function(n,e){var t="object"==typeof global&&global&&global.Object===Object&&global;n.exports=t},function(n,e,t){var r=t(19),a=t(161),o=t(162),s=t(163),i=t(164),l=t(165);function c(n){var e=this.__data__=new r(n);this.size=e.size}c.prototype.clear=a,c.prototype.delete=o,c.prototype.get=s,c.prototype.has=i,c.prototype.set=l,n.exports=c},function(n,e){n.exports=function(n,e){return n===e||n!=n&&e!=e}},function(n,e,t){var r=t(13),a=t(41);n.exports=function(n){if(!a(n))return!1;var e=r(n);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},function(n,e){var t=Function.prototype.toString;n.exports=function(n){if(null!=n){try{return t.call(n)}catch(n){}try{return n+""}catch(n){}}return""}},function(n,e,t){var r=t(182),a=t(12);n.exports=function n(e,t,o,s,i){return e===t||(null==e||null==t||!a(e)&&!a(t)?e!=e&&t!=t:r(e,t,o,s,n,i))}},function(n,e,t){var r=t(76),a=t(185),o=t(77);n.exports=function(n,e,t,s,i,l){var c=1&t,p=n.length,d=e.length;if(p!=d&&!(c&&d>p))return!1;var u=l.get(n),m=l.get(e);if(u&&m)return u==e&&m==n;var f=-1,g=!0,h=2&t?new r:void 0;for(l.set(n,e),l.set(e,n);++f<p;){var v=n[f],b=e[f];if(s)var y=c?s(b,v,f,e,n,l):s(v,b,f,n,e,l);if(void 0!==y){if(y)continue;g=!1;break}if(h){if(!a(e,(function(n,e){if(!o(h,e)&&(v===n||i(v,n,t,s,l)))return h.push(e)}))){g=!1;break}}else if(v!==b&&!i(v,b,t,s,l)){g=!1;break}}return l.delete(n),l.delete(e),g}},function(n,e,t){var r=t(42),a=t(183),o=t(184);function s(n){var e=-1,t=null==n?0:n.length;for(this.__data__=new r;++e<t;)this.add(n[e])}s.prototype.add=s.prototype.push=a,s.prototype.has=o,n.exports=s},function(n,e){n.exports=function(n,e){return n.has(e)}},function(n,e,t){var r=t(195),a=t(201),o=t(82);n.exports=function(n){return o(n)?r(n):a(n)}},function(n,e,t){(function(n){var r=t(8),a=t(197),o=e&&!e.nodeType&&e,s=o&&"object"==typeof n&&n&&!n.nodeType&&n,i=s&&s.exports===o?r.Buffer:void 0,l=(i?i.isBuffer:void 0)||a;n.exports=l}).call(this,t(48)(n))},function(n,e){var t=/^(?:0|[1-9]\d*)$/;n.exports=function(n,e){var r=typeof n;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&t.test(n))&&n>-1&&n%1==0&&n<e}},function(n,e,t){var r=t(198),a=t(199),o=t(200),s=o&&o.isTypedArray,i=s?a(s):r;n.exports=i},function(n,e,t){var r=t(72),a=t(44);n.exports=function(n){return null!=n&&a(n.length)&&!r(n)}},function(n,e,t){var r=t(10)(t(8),"Set");n.exports=r},function(n,e,t){var r=t(41);n.exports=function(n){return n==n&&!r(n)}},function(n,e){n.exports=function(n,e){return function(t){return null!=t&&(t[n]===e&&(void 0!==e||n in Object(t)))}}},function(n,e,t){var r=t(87),a=t(23);n.exports=function(n,e){for(var t=0,o=(e=r(e,n)).length;null!=n&&t<o;)n=n[a(e[t++])];return t&&t==o?n:void 0}},function(n,e,t){var r=t(5),a=t(45),o=t(212),s=t(215);n.exports=function(n,e){return r(n)?n:a(n,e)?[n]:o(s(n))}},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){var r=t(148),a=t(153),o=t(224),s=t(232),i=t(241),l=t(98),c=o((function(n){var e=l(n);return i(e)&&(e=void 0),s(r(n,1,i,!0),a(e,2))}));n.exports=c},function(n,e,t){"use strict";
/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */var r=/["'&<>]/;n.exports=function(n){var e,t=""+n,a=r.exec(t);if(!a)return t;var o="",s=0,i=0;for(s=a.index;s<t.length;s++){switch(t.charCodeAt(s)){case 34:e="&quot;";break;case 38:e="&amp;";break;case 39:e="&#39;";break;case 60:e="&lt;";break;case 62:e="&gt;";break;default:continue}i!==s&&(o+=t.substring(i,s)),i=s+1,o+=e}return i!==s?o+t.substring(i,s):o}},function(n,e,t){"use strict";
/**
 * @file Embedded JavaScript templating engine. {@link http://ejs.co}
 * @author Matthew Eernisse <mde@fleegix.org>
 * @author Tiancheng "Timothy" Gu <timothygu99@gmail.com>
 * @project EJS
 * @license {@link http://www.apache.org/licenses/LICENSE-2.0 Apache License, Version 2.0}
 */var r=t(248),a=t(249),o=t(250),s=!1,i=t(251).version,l=["delimiter","scope","context","debug","compileDebug","client","_with","rmWhitespace","strict","filename","async"],c=l.concat("cache"),p=/^\uFEFF/,d=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/;function u(n,t){var a;if(t.some((function(t){return a=e.resolveInclude(n,t,!0),r.existsSync(a)})))return a}function m(n,t){var r,a=n.filename,o=arguments.length>1;if(n.cache){if(!a)throw new Error("cache option requires a filename");if(r=e.cache.get(a))return r;o||(t=g(a).toString().replace(p,""))}else if(!o){if(!a)throw new Error("Internal EJS error: no file name or template provided");t=g(a).toString().replace(p,"")}return r=e.compile(t,n),n.cache&&e.cache.set(a,r),r}function f(n,t,r){var a;if(!r){if("function"==typeof e.promiseImpl)return new e.promiseImpl((function(e,r){try{e(a=m(n)(t))}catch(n){r(n)}}));throw new Error("Please provide a callback function")}try{a=m(n)(t)}catch(n){return r(n)}r(null,a)}function g(n){return e.fileLoader(n)}function h(n,t){var a=o.shallowCopy(o.createNullProtoObjWherePossible(),t);if(a.filename=function(n,t){var a,o,s=t.views,i=/^[A-Za-z]+:\\|^\//.exec(n);if(i&&i.length)n=n.replace(/^\/*/,""),a=Array.isArray(t.root)?u(n,t.root):e.resolveInclude(n,t.root||"/",!0);else if(t.filename&&(o=e.resolveInclude(n,t.filename),r.existsSync(o)&&(a=o)),!a&&Array.isArray(s)&&(a=u(n,s)),!a&&"function"!=typeof t.includer)throw new Error('Could not find the include file "'+t.escapeFunction(n)+'"');return a}(n,a),"function"==typeof t.includer){var s=t.includer(n,a.filename);if(s&&(s.filename&&(a.filename=s.filename),s.template))return m(a,s.template)}return m(a)}function v(n,e,t,r,a){var o=e.split("\n"),s=Math.max(r-3,0),i=Math.min(o.length,r+3),l=a(t),c=o.slice(s,i).map((function(n,e){var t=e+s+1;return(t==r?" >> ":"    ")+t+"| "+n})).join("\n");throw n.path=l,n.message=(l||"ejs")+":"+r+"\n"+c+"\n\n"+n.message,n}function b(n){return n.replace(/;(\s*$)/,"$1")}function y(n,t){var r=o.hasOwnOnlyObject(t),a=o.createNullProtoObjWherePossible();this.templateText=n,this.mode=null,this.truncate=!1,this.currentLine=1,this.source="",a.client=r.client||!1,a.escapeFunction=r.escape||r.escapeFunction||o.escapeXML,a.compileDebug=!1!==r.compileDebug,a.debug=!!r.debug,a.filename=r.filename,a.openDelimiter=r.openDelimiter||e.openDelimiter||"<",a.closeDelimiter=r.closeDelimiter||e.closeDelimiter||">",a.delimiter=r.delimiter||e.delimiter||"%",a.strict=r.strict||!1,a.context=r.context,a.cache=r.cache||!1,a.rmWhitespace=r.rmWhitespace,a.root=r.root,a.includer=r.includer,a.outputFunctionName=r.outputFunctionName,a.localsName=r.localsName||e.localsName||"locals",a.views=r.views,a.async=r.async,a.destructuredLocals=r.destructuredLocals,a.legacyInclude=void 0===r.legacyInclude||!!r.legacyInclude,a.strict?a._with=!1:a._with=void 0===r._with||r._with,this.opts=a,this.regex=this.createRegex()}e.cache=o.cache,e.fileLoader=r.readFileSync,e.localsName="locals",e.promiseImpl=new Function("return this;")().Promise,e.resolveInclude=function(n,e,t){var r=a.dirname,o=a.extname,s=(0,a.resolve)(t?e:r(e),n);return o(n)||(s+=".ejs"),s},e.compile=function(n,e){return e&&e.scope&&(s||(console.warn("`scope` option is deprecated and will be removed in EJS 3"),s=!0),e.context||(e.context=e.scope),delete e.scope),new y(n,e).compile()},e.render=function(n,e,t){var r=e||o.createNullProtoObjWherePossible(),a=t||o.createNullProtoObjWherePossible();return 2==arguments.length&&o.shallowCopyFromList(a,r,l),m(a,n)(r)},e.renderFile=function(){var n,e,t,r=Array.prototype.slice.call(arguments),a=r.shift(),s={filename:a};return"function"==typeof arguments[arguments.length-1]&&(n=r.pop()),r.length?(e=r.shift(),r.length?o.shallowCopy(s,r.pop()):(e.settings&&(e.settings.views&&(s.views=e.settings.views),e.settings["view cache"]&&(s.cache=!0),(t=e.settings["view options"])&&o.shallowCopy(s,t)),o.shallowCopyFromList(s,e,c)),s.filename=a):e=o.createNullProtoObjWherePossible(),f(s,e,n)},e.Template=y,e.clearCache=function(){e.cache.reset()},y.modes={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"},y.prototype={createRegex:function(){var n="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",e=o.escapeRegExpChars(this.opts.delimiter),t=o.escapeRegExpChars(this.opts.openDelimiter),r=o.escapeRegExpChars(this.opts.closeDelimiter);return n=n.replace(/%/g,e).replace(/</g,t).replace(/>/g,r),new RegExp(n)},compile:function(){var n,e,t,r=this.opts,s="",i="",l=r.escapeFunction,c=r.filename?JSON.stringify(r.filename):"undefined";if(!this.source){if(this.generateSource(),s+='  var __output = "";\n  function __append(s) { if (s !== undefined && s !== null) __output += s }\n',r.outputFunctionName){if(!d.test(r.outputFunctionName))throw new Error("outputFunctionName is not a valid JS identifier.");s+="  var "+r.outputFunctionName+" = __append;\n"}if(r.localsName&&!d.test(r.localsName))throw new Error("localsName is not a valid JS identifier.");if(r.destructuredLocals&&r.destructuredLocals.length){for(var p="  var __locals = ("+r.localsName+" || {}),\n",u=0;u<r.destructuredLocals.length;u++){var m=r.destructuredLocals[u];if(!d.test(m))throw new Error("destructuredLocals["+u+"] is not a valid JS identifier.");u>0&&(p+=",\n  "),p+=m+" = __locals."+m}s+=p+";\n"}!1!==r._with&&(s+="  with ("+r.localsName+" || {}) {\n",i+="  }\n"),i+="  return __output;\n",this.source=s+this.source+i}n=r.compileDebug?"var __line = 1\n  , __lines = "+JSON.stringify(this.templateText)+"\n  , __filename = "+c+";\ntry {\n"+this.source+"} catch (e) {\n  rethrow(e, __lines, __filename, __line, escapeFn);\n}\n":this.source,r.client&&(n="escapeFn = escapeFn || "+l.toString()+";\n"+n,r.compileDebug&&(n="rethrow = rethrow || "+v.toString()+";\n"+n)),r.strict&&(n='"use strict";\n'+n),r.debug&&console.log(n),r.compileDebug&&r.filename&&(n=n+"\n//# sourceURL="+c+"\n");try{if(r.async)try{t=new Function("return (async function(){}).constructor;")()}catch(n){throw n instanceof SyntaxError?new Error("This environment does not support async/await"):n}else t=Function;e=new t(r.localsName+", escapeFn, include, rethrow",n)}catch(n){throw n instanceof SyntaxError&&(r.filename&&(n.message+=" in "+r.filename),n.message+=" while compiling ejs\n\n",n.message+="If the above error is not helpful, you may want to try EJS-Lint:\n",n.message+="https://github.com/RyanZim/EJS-Lint",r.async||(n.message+="\n",n.message+="Or, if you meant to create an async function, pass `async: true` as an option.")),n}var f=r.client?e:function(n){return e.apply(r.context,[n||o.createNullProtoObjWherePossible(),l,function(e,t){var a=o.shallowCopy(o.createNullProtoObjWherePossible(),n);return t&&(a=o.shallowCopy(a,t)),h(e,r)(a)},v])};if(r.filename&&"function"==typeof Object.defineProperty){var g=r.filename,b=a.basename(g,a.extname(g));try{Object.defineProperty(f,"name",{value:b,writable:!1,enumerable:!1,configurable:!0})}catch(n){}}return f},generateSource:function(){this.opts.rmWhitespace&&(this.templateText=this.templateText.replace(/[\r\n]+/g,"\n").replace(/^\s+|\s+$/gm,"")),this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");var n=this,e=this.parseTemplateText(),t=this.opts.delimiter,r=this.opts.openDelimiter,a=this.opts.closeDelimiter;e&&e.length&&e.forEach((function(o,s){var i;if(0===o.indexOf(r+t)&&0!==o.indexOf(r+t+t)&&(i=e[s+2])!=t+a&&i!="-"+t+a&&i!="_"+t+a)throw new Error('Could not find matching close tag for "'+o+'".');n.scanLine(o)}))},parseTemplateText:function(){for(var n,e=this.templateText,t=this.regex,r=t.exec(e),a=[];r;)0!==(n=r.index)&&(a.push(e.substring(0,n)),e=e.slice(n)),a.push(r[0]),e=e.slice(r[0].length),r=t.exec(e);return e&&a.push(e),a},_addOutput:function(n){if(this.truncate&&(n=n.replace(/^(?:\r\n|\r|\n)/,""),this.truncate=!1),!n)return n;n=(n=(n=(n=n.replace(/\\/g,"\\\\")).replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace(/"/g,'\\"'),this.source+='    ; __append("'+n+'")\n'},scanLine:function(n){var e,t=this.opts.delimiter,r=this.opts.openDelimiter,a=this.opts.closeDelimiter;switch(e=n.split("\n").length-1,n){case r+t:case r+t+"_":this.mode=y.modes.EVAL;break;case r+t+"=":this.mode=y.modes.ESCAPED;break;case r+t+"-":this.mode=y.modes.RAW;break;case r+t+"#":this.mode=y.modes.COMMENT;break;case r+t+t:this.mode=y.modes.LITERAL,this.source+='    ; __append("'+n.replace(r+t+t,r+t)+'")\n';break;case t+t+a:this.mode=y.modes.LITERAL,this.source+='    ; __append("'+n.replace(t+t+a,t+a)+'")\n';break;case t+a:case"-"+t+a:case"_"+t+a:this.mode==y.modes.LITERAL&&this._addOutput(n),this.mode=null,this.truncate=0===n.indexOf("-")||0===n.indexOf("_");break;default:if(this.mode){switch(this.mode){case y.modes.EVAL:case y.modes.ESCAPED:case y.modes.RAW:n.lastIndexOf("//")>n.lastIndexOf("\n")&&(n+="\n")}switch(this.mode){case y.modes.EVAL:this.source+="    ; "+n+"\n";break;case y.modes.ESCAPED:this.source+="    ; __append(escapeFn("+b(n)+"))\n";break;case y.modes.RAW:this.source+="    ; __append("+b(n)+")\n";break;case y.modes.COMMENT:break;case y.modes.LITERAL:this._addOutput(n)}}else this._addOutput(n)}this.opts.compileDebug&&e&&(this.currentLine+=e,this.source+="    ; __line = "+this.currentLine+"\n")}},e.escapeXML=o.escapeXML,e.__express=e.renderFile,e.VERSION=i,e.name="ejs","undefined"!=typeof window&&(window.ejs=e)},function(n,e,t){"use strict";t.r(e);var r={name:"CodeBlock",props:{title:{type:String,required:!0},active:{type:Boolean,default:!1}}},a=(t(244),t(0)),o=Object(a.a)(r,(function(){var n=this.$createElement;return(this._self._c||n)("div",{staticClass:"theme-code-block",class:{"theme-code-block__active":this.active}},[this._t("default")],2)}),[],!1,null,"6c83c644",null);e.default=o.exports},function(n,e,t){"use strict";t.r(e);var r={name:"CodeGroup",data:()=>({codeTabs:[],activeCodeTabIndex:-1}),watch:{activeCodeTabIndex(n){this.codeTabs.forEach(n=>{n.elm.classList.remove("theme-code-block__active")}),this.codeTabs[n].elm.classList.add("theme-code-block__active")}},mounted(){this.codeTabs=(this.$slots.default||[]).filter(n=>Boolean(n.componentOptions)).map((n,e)=>(""===n.componentOptions.propsData.active&&(this.activeCodeTabIndex=e),{title:n.componentOptions.propsData.title,elm:n.elm})),-1===this.activeCodeTabIndex&&this.codeTabs.length>0&&(this.activeCodeTabIndex=0)},methods:{changeCodeTab(n){this.activeCodeTabIndex=n}}},a=(t(245),t(0)),o=Object(a.a)(r,(function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"theme-code-group"},[t("div",{staticClass:"theme-code-group__nav"},[t("ul",{staticClass:"theme-code-group__ul"},n._l(n.codeTabs,(function(e,r){return t("li",{key:e.title,staticClass:"theme-code-group__li"},[t("button",{staticClass:"theme-code-group__nav-tab",class:{"theme-code-group__nav-tab-active":r===n.activeCodeTabIndex},on:{click:function(e){return n.changeCodeTab(r)}}},[n._v("\n            "+n._s(e.title)+"\n          ")])])})),0)]),n._v(" "),n._t("default"),n._v(" "),n.codeTabs.length<1?t("pre",{staticClass:"pre-blank"},[n._v("// Make sure to add code blocks to your code group")]):n._e()],2)}),[],!1,null,"24edfee2",null);e.default=o.exports},function(n,e){n.exports=function(n){var e=null==n?0:n.length;return e?n[e-1]:void 0}},function(n,e,t){n.exports=t(255)},function(n,e,t){"use strict";var r=t(26),a=t(126).left,o=t(127),s=t(58);r({target:"Array",proto:!0,forced:!t(128)&&s>79&&s<83||!o("reduce")},{reduce:function(n){var e=arguments.length;return a(this,n,e,e>1?arguments[1]:void 0)}})},function(n,e,t){"use strict";var r={}.propertyIsEnumerable,a=Object.getOwnPropertyDescriptor,o=a&&!r.call({1:2},1);e.f=o?function(n){var e=a(this,n);return!!e&&e.enumerable}:r},function(n,e,t){"use strict";var r=t(27),a=t(7),o=t(54),s=t(104),i=t(106),l=t(34),c=TypeError,p=l("toPrimitive");n.exports=function(n,e){if(!a(n)||o(n))return n;var t,l=s(n,p);if(l){if(void 0===e&&(e="default"),t=r(l,n,e),!a(t)||o(t))return t;throw new c("Can't convert object to primitive value")}return void 0===e&&(e="number"),i(n,e)}},function(n,e,t){"use strict";n.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},function(n,e,t){"use strict";var r=t(33),a=t(52);n.exports=function(n,e){var t=n[e];return a(t)?void 0:r(t)}},function(n,e,t){"use strict";var r=String;n.exports=function(n){try{return r(n)}catch(n){return"Object"}}},function(n,e,t){"use strict";var r=t(27),a=t(2),o=t(7),s=TypeError;n.exports=function(n,e){var t,i;if("string"===e&&a(t=n.toString)&&!o(i=r(t,n)))return i;if(a(t=n.valueOf)&&!o(i=r(t,n)))return i;if("string"!==e&&a(t=n.toString)&&!o(i=r(t,n)))return i;throw new s("Can't convert object to primitive value")}},function(n,e,t){"use strict";var r=t(1),a=t(7),o=r.document,s=a(o)&&a(o.createElement);n.exports=function(n){return s?o.createElement(n):{}}},function(n,e,t){"use strict";var r=t(6),a=t(3);n.exports=r&&a((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(n,e,t){"use strict";var r=t(2),a=t(18),o=t(110),s=t(36);n.exports=function(n,e,t,i){i||(i={});var l=i.enumerable,c=void 0!==i.name?i.name:e;if(r(t)&&o(t,c,i),i.global)l?n[e]=t:s(e,t);else{try{i.unsafe?n[e]&&(l=!0):delete n[e]}catch(n){}l?n[e]=t:a.f(n,e,{value:t,enumerable:!1,configurable:!i.nonConfigurable,writable:!i.nonWritable})}return n}},function(n,e,t){"use strict";var r=t(4),a=t(3),o=t(2),s=t(9),i=t(6),l=t(111).CONFIGURABLE,c=t(112),p=t(113),d=p.enforce,u=p.get,m=String,f=Object.defineProperty,g=r("".slice),h=r("".replace),v=r([].join),b=i&&!a((function(){return 8!==f((function(){}),"length",{value:8}).length})),y=String(String).split("String"),_=n.exports=function(n,e,t){"Symbol("===g(m(e),0,7)&&(e="["+h(m(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!s(n,"name")||l&&n.name!==e)&&(i?f(n,"name",{value:e,configurable:!0}):n.name=e),b&&t&&s(t,"arity")&&n.length!==t.arity&&f(n,"length",{value:t.arity});try{t&&s(t,"constructor")&&t.constructor?i&&f(n,"prototype",{writable:!1}):n.prototype&&(n.prototype=void 0)}catch(n){}var r=d(n);return s(r,"source")||(r.source=v(y,"string"==typeof e?e:"")),n};Function.prototype.toString=_((function(){return o(this)&&u(this).source||c(this)}),"toString")},function(n,e,t){"use strict";var r=t(6),a=t(9),o=Function.prototype,s=r&&Object.getOwnPropertyDescriptor,i=a(o,"name"),l=i&&"something"===function(){}.name,c=i&&(!r||r&&s(o,"name").configurable);n.exports={EXISTS:i,PROPER:l,CONFIGURABLE:c}},function(n,e,t){"use strict";var r=t(4),a=t(2),o=t(35),s=r(Function.toString);a(o.inspectSource)||(o.inspectSource=function(n){return s(n)}),n.exports=o.inspectSource},function(n,e,t){"use strict";var r,a,o,s=t(114),i=t(1),l=t(7),c=t(14),p=t(9),d=t(35),u=t(115),m=t(64),f=i.TypeError,g=i.WeakMap;if(s||d.state){var h=d.state||(d.state=new g);h.get=h.get,h.has=h.has,h.set=h.set,r=function(n,e){if(h.has(n))throw new f("Object already initialized");return e.facade=n,h.set(n,e),e},a=function(n){return h.get(n)||{}},o=function(n){return h.has(n)}}else{var v=u("state");m[v]=!0,r=function(n,e){if(p(n,v))throw new f("Object already initialized");return e.facade=n,c(n,v,e),e},a=function(n){return p(n,v)?n[v]:{}},o=function(n){return p(n,v)}}n.exports={set:r,get:a,has:o,enforce:function(n){return o(n)?a(n):r(n,{})},getterFor:function(n){return function(e){var t;if(!l(e)||(t=a(e)).type!==n)throw new f("Incompatible receiver, "+n+" required");return t}}}},function(n,e,t){"use strict";var r=t(1),a=t(2),o=r.WeakMap;n.exports=a(o)&&/native code/.test(String(o))},function(n,e,t){"use strict";var r=t(59),a=t(61),o=r("keys");n.exports=function(n){return o[n]||(o[n]=a(n))}},function(n,e,t){"use strict";var r=t(32),a=t(4),o=t(117),s=t(124),i=t(63),l=a([].concat);n.exports=r("Reflect","ownKeys")||function(n){var e=o.f(i(n)),t=s.f;return t?l(e,t(n)):e}},function(n,e,t){"use strict";var r=t(118),a=t(123).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(n){return r(n,a)}},function(n,e,t){"use strict";var r=t(4),a=t(9),o=t(30),s=t(119).indexOf,i=t(64),l=r([].push);n.exports=function(n,e){var t,r=o(n),c=0,p=[];for(t in r)!a(i,t)&&a(r,t)&&l(p,t);for(;e.length>c;)a(r,t=e[c++])&&(~s(p,t)||l(p,t));return p}},function(n,e,t){"use strict";var r=t(30),a=t(120),o=t(38),s=function(n){return function(e,t,s){var i=r(e),l=o(i);if(0===l)return!n&&-1;var c,p=a(s,l);if(n&&t!=t){for(;l>p;)if((c=i[p++])!=c)return!0}else for(;l>p;p++)if((n||p in i)&&i[p]===t)return n||p||0;return!n&&-1}};n.exports={includes:s(!0),indexOf:s(!1)}},function(n,e,t){"use strict";var r=t(66),a=Math.max,o=Math.min;n.exports=function(n,e){var t=r(n);return t<0?a(t+e,0):o(t,e)}},function(n,e,t){"use strict";var r=Math.ceil,a=Math.floor;n.exports=Math.trunc||function(n){var e=+n;return(e>0?a:r)(e)}},function(n,e,t){"use strict";var r=t(66),a=Math.min;n.exports=function(n){var e=r(n);return e>0?a(e,9007199254740991):0}},function(n,e,t){"use strict";n.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(n,e,t){"use strict";e.f=Object.getOwnPropertySymbols},function(n,e,t){"use strict";var r=t(3),a=t(2),o=/#|\.prototype\./,s=function(n,e){var t=l[i(n)];return t===p||t!==c&&(a(e)?r(e):!!e)},i=s.normalize=function(n){return String(n).replace(o,".").toLowerCase()},l=s.data={},c=s.NATIVE="N",p=s.POLYFILL="P";n.exports=s},function(n,e,t){"use strict";var r=t(33),a=t(37),o=t(51),s=t(38),i=TypeError,l="Reduce of empty array with no initial value",c=function(n){return function(e,t,c,p){var d=a(e),u=o(d),m=s(d);if(r(t),0===m&&c<2)throw new i(l);var f=n?m-1:0,g=n?-1:1;if(c<2)for(;;){if(f in u){p=u[f],f+=g;break}if(f+=g,n?f<0:m<=f)throw new i(l)}for(;n?f>=0:m>f;f+=g)f in u&&(p=t(p,u[f],f,d));return p}};n.exports={left:c(!1),right:c(!0)}},function(n,e,t){"use strict";var r=t(3);n.exports=function(n,e){var t=[][n];return!!t&&r((function(){t.call(null,e||function(){return 1},1)}))}},function(n,e,t){"use strict";var r=t(1),a=t(17);n.exports="process"===a(r.process)},function(n,e,t){"use strict";var r=t(26),a=t(1),o=t(130),s=t(131),i=a.WebAssembly,l=7!==new Error("e",{cause:7}).cause,c=function(n,e){var t={};t[n]=s(n,e,l),r({global:!0,constructor:!0,arity:1,forced:l},t)},p=function(n,e){if(i&&i[n]){var t={};t[n]=s("WebAssembly."+n,e,l),r({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:l},t)}};c("Error",(function(n){return function(e){return o(n,this,arguments)}})),c("EvalError",(function(n){return function(e){return o(n,this,arguments)}})),c("RangeError",(function(n){return function(e){return o(n,this,arguments)}})),c("ReferenceError",(function(n){return function(e){return o(n,this,arguments)}})),c("SyntaxError",(function(n){return function(e){return o(n,this,arguments)}})),c("TypeError",(function(n){return function(e){return o(n,this,arguments)}})),c("URIError",(function(n){return function(e){return o(n,this,arguments)}})),p("CompileError",(function(n){return function(e){return o(n,this,arguments)}})),p("LinkError",(function(n){return function(e){return o(n,this,arguments)}})),p("RuntimeError",(function(n){return function(e){return o(n,this,arguments)}}))},function(n,e,t){"use strict";var r=t(28),a=Function.prototype,o=a.apply,s=a.call;n.exports="object"==typeof Reflect&&Reflect.apply||(r?s.bind(o):function(){return s.apply(o,arguments)})},function(n,e,t){"use strict";var r=t(32),a=t(9),o=t(14),s=t(55),i=t(67),l=t(65),c=t(135),p=t(136),d=t(137),u=t(141),m=t(142),f=t(6),g=t(60);n.exports=function(n,e,t,h){var v=h?2:1,b=n.split("."),y=b[b.length-1],_=r.apply(null,b);if(_){var k=_.prototype;if(!g&&a(k,"cause")&&delete k.cause,!t)return _;var w=r("Error"),x=e((function(n,e){var t=d(h?e:n,void 0),r=h?new _(n):new _;return void 0!==t&&o(r,"message",t),m(r,x,r.stack,2),this&&s(k,this)&&p(r,this,x),arguments.length>v&&u(r,arguments[v]),r}));if(x.prototype=k,"Error"!==y?i?i(x,w):l(x,w,{name:!0}):f&&"stackTraceLimit"in _&&(c(x,_,"stackTraceLimit"),c(x,_,"prepareStackTrace")),l(x,_),!g)try{k.name!==y&&o(k,"name",y),k.constructor=x}catch(n){}return x}}},function(n,e,t){"use strict";var r=t(4),a=t(33);n.exports=function(n,e,t){try{return r(a(Object.getOwnPropertyDescriptor(n,e)[t]))}catch(n){}}},function(n,e,t){"use strict";var r=t(134),a=String,o=TypeError;n.exports=function(n){if(r(n))return n;throw new o("Can't set "+a(n)+" as a prototype")}},function(n,e,t){"use strict";var r=t(7);n.exports=function(n){return r(n)||null===n}},function(n,e,t){"use strict";var r=t(18).f;n.exports=function(n,e,t){t in n||r(n,t,{configurable:!0,get:function(){return e[t]},set:function(n){e[t]=n}})}},function(n,e,t){"use strict";var r=t(2),a=t(7),o=t(67);n.exports=function(n,e,t){var s,i;return o&&r(s=e.constructor)&&s!==t&&a(i=s.prototype)&&i!==t.prototype&&o(n,i),n}},function(n,e,t){"use strict";var r=t(138);n.exports=function(n,e){return void 0===n?arguments.length<2?"":e:r(n)}},function(n,e,t){"use strict";var r=t(139),a=String;n.exports=function(n){if("Symbol"===r(n))throw new TypeError("Cannot convert a Symbol value to a string");return a(n)}},function(n,e,t){"use strict";var r=t(140),a=t(2),o=t(17),s=t(34)("toStringTag"),i=Object,l="Arguments"===o(function(){return arguments}());n.exports=r?o:function(n){var e,t,r;return void 0===n?"Undefined":null===n?"Null":"string"==typeof(t=function(n,e){try{return n[e]}catch(n){}}(e=i(n),s))?t:l?o(e):"Object"===(r=o(e))&&a(e.callee)?"Arguments":r}},function(n,e,t){"use strict";var r={};r[t(34)("toStringTag")]="z",n.exports="[object z]"===String(r)},function(n,e,t){"use strict";var r=t(7),a=t(14);n.exports=function(n,e){r(e)&&"cause"in e&&a(n,"cause",e.cause)}},function(n,e,t){"use strict";var r=t(14),a=t(143),o=t(144),s=Error.captureStackTrace;n.exports=function(n,e,t,i){o&&(s?s(n,e):r(n,"stack",a(t,i)))}},function(n,e,t){"use strict";var r=t(4),a=Error,o=r("".replace),s=String(new a("zxcasd").stack),i=/\n\s*at [^:]*:[^\n]*/,l=i.test(s);n.exports=function(n,e){if(l&&"string"==typeof n&&!a.prepareStackTrace)for(;e--;)n=o(n,i,"");return n}},function(n,e,t){"use strict";var r=t(3),a=t(29);n.exports=!r((function(){var n=new Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",a(1,7)),7!==n.stack)}))},function(n,e,t){"use strict";var r=t(6),a=t(146),o=TypeError,s=Object.getOwnPropertyDescriptor,i=r&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(n){return n instanceof TypeError}}();n.exports=i?function(n,e){if(a(n)&&!s(n,"length").writable)throw new o("Cannot set read only .length");return n.length=e}:function(n,e){return n.length=e}},function(n,e,t){"use strict";var r=t(17);n.exports=Array.isArray||function(n){return"Array"===r(n)}},function(n,e,t){"use strict";var r=TypeError;n.exports=function(n){if(n>9007199254740991)throw r("Maximum allowed index exceeded");return n}},function(n,e,t){var r=t(68),a=t(149);n.exports=function n(e,t,o,s,i){var l=-1,c=e.length;for(o||(o=a),i||(i=[]);++l<c;){var p=e[l];t>0&&o(p)?t>1?n(p,t-1,o,s,i):r(i,p):s||(i[i.length]=p)}return i}},function(n,e,t){var r=t(15),a=t(39),o=t(5),s=r?r.isConcatSpreadable:void 0;n.exports=function(n){return o(n)||a(n)||!!(s&&n&&n[s])}},function(n,e,t){var r=t(13),a=t(12);n.exports=function(n){return a(n)&&"[object Arguments]"==r(n)}},function(n,e,t){var r=t(15),a=Object.prototype,o=a.hasOwnProperty,s=a.toString,i=r?r.toStringTag:void 0;n.exports=function(n){var e=o.call(n,i),t=n[i];try{n[i]=void 0;var r=!0}catch(n){}var a=s.call(n);return r&&(e?n[i]=t:delete n[i]),a}},function(n,e){var t=Object.prototype.toString;n.exports=function(n){return t.call(n)}},function(n,e,t){var r=t(154),a=t(210),o=t(47),s=t(5),i=t(221);n.exports=function(n){return"function"==typeof n?n:null==n?o:"object"==typeof n?s(n)?a(n[0],n[1]):r(n):i(n)}},function(n,e,t){var r=t(155),a=t(209),o=t(85);n.exports=function(n){var e=a(n);return 1==e.length&&e[0][2]?o(e[0][0],e[0][1]):function(t){return t===n||r(t,n,e)}}},function(n,e,t){var r=t(70),a=t(74);n.exports=function(n,e,t,o){var s=t.length,i=s,l=!o;if(null==n)return!i;for(n=Object(n);s--;){var c=t[s];if(l&&c[2]?c[1]!==n[c[0]]:!(c[0]in n))return!1}for(;++s<i;){var p=(c=t[s])[0],d=n[p],u=c[1];if(l&&c[2]){if(void 0===d&&!(p in n))return!1}else{var m=new r;if(o)var f=o(d,u,p,n,e,m);if(!(void 0===f?a(u,d,3,o,m):f))return!1}}return!0}},function(n,e){n.exports=function(){this.__data__=[],this.size=0}},function(n,e,t){var r=t(20),a=Array.prototype.splice;n.exports=function(n){var e=this.__data__,t=r(e,n);return!(t<0)&&(t==e.length-1?e.pop():a.call(e,t,1),--this.size,!0)}},function(n,e,t){var r=t(20);n.exports=function(n){var e=this.__data__,t=r(e,n);return t<0?void 0:e[t][1]}},function(n,e,t){var r=t(20);n.exports=function(n){return r(this.__data__,n)>-1}},function(n,e,t){var r=t(20);n.exports=function(n,e){var t=this.__data__,a=r(t,n);return a<0?(++this.size,t.push([n,e])):t[a][1]=e,this}},function(n,e,t){var r=t(19);n.exports=function(){this.__data__=new r,this.size=0}},function(n,e){n.exports=function(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}},function(n,e){n.exports=function(n){return this.__data__.get(n)}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e,t){var r=t(19),a=t(40),o=t(42);n.exports=function(n,e){var t=this.__data__;if(t instanceof r){var s=t.__data__;if(!a||s.length<199)return s.push([n,e]),this.size=++t.size,this;t=this.__data__=new o(s)}return t.set(n,e),this.size=t.size,this}},function(n,e,t){var r=t(72),a=t(167),o=t(41),s=t(73),i=/^\[object .+?Constructor\]$/,l=Function.prototype,c=Object.prototype,p=l.toString,d=c.hasOwnProperty,u=RegExp("^"+p.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");n.exports=function(n){return!(!o(n)||a(n))&&(r(n)?u:i).test(s(n))}},function(n,e,t){var r,a=t(168),o=(r=/[^.]+$/.exec(a&&a.keys&&a.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";n.exports=function(n){return!!o&&o in n}},function(n,e,t){var r=t(8)["__core-js_shared__"];n.exports=r},function(n,e){n.exports=function(n,e){return null==n?void 0:n[e]}},function(n,e,t){var r=t(171),a=t(19),o=t(40);n.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||a),string:new r}}},function(n,e,t){var r=t(172),a=t(173),o=t(174),s=t(175),i=t(176);function l(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=a,l.prototype.get=o,l.prototype.has=s,l.prototype.set=i,n.exports=l},function(n,e,t){var r=t(21);n.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(n,e){n.exports=function(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}},function(n,e,t){var r=t(21),a=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;if(r){var t=e[n];return"__lodash_hash_undefined__"===t?void 0:t}return a.call(e,n)?e[n]:void 0}},function(n,e,t){var r=t(21),a=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;return r?void 0!==e[n]:a.call(e,n)}},function(n,e,t){var r=t(21);n.exports=function(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=r&&void 0===e?"__lodash_hash_undefined__":e,this}},function(n,e,t){var r=t(22);n.exports=function(n){var e=r(this,n).delete(n);return this.size-=e?1:0,e}},function(n,e){n.exports=function(n){var e=typeof n;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==n:null===n}},function(n,e,t){var r=t(22);n.exports=function(n){return r(this,n).get(n)}},function(n,e,t){var r=t(22);n.exports=function(n){return r(this,n).has(n)}},function(n,e,t){var r=t(22);n.exports=function(n,e){var t=r(this,n),a=t.size;return t.set(n,e),this.size+=t.size==a?0:1,this}},function(n,e,t){var r=t(70),a=t(75),o=t(186),s=t(189),i=t(205),l=t(5),c=t(79),p=t(81),d="[object Object]",u=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,m,f,g){var h=l(n),v=l(e),b=h?"[object Array]":i(n),y=v?"[object Array]":i(e),_=(b="[object Arguments]"==b?d:b)==d,k=(y="[object Arguments]"==y?d:y)==d,w=b==y;if(w&&c(n)){if(!c(e))return!1;h=!0,_=!1}if(w&&!_)return g||(g=new r),h||p(n)?a(n,e,t,m,f,g):o(n,e,b,t,m,f,g);if(!(1&t)){var x=_&&u.call(n,"__wrapped__"),E=k&&u.call(e,"__wrapped__");if(x||E){var j=x?n.value():n,A=E?e.value():e;return g||(g=new r),f(j,A,t,m,g)}}return!!w&&(g||(g=new r),s(n,e,t,m,f,g))}},function(n,e){n.exports=function(n){return this.__data__.set(n,"__lodash_hash_undefined__"),this}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e){n.exports=function(n,e){for(var t=-1,r=null==n?0:n.length;++t<r;)if(e(n[t],t,n))return!0;return!1}},function(n,e,t){var r=t(15),a=t(187),o=t(71),s=t(75),i=t(188),l=t(43),c=r?r.prototype:void 0,p=c?c.valueOf:void 0;n.exports=function(n,e,t,r,c,d,u){switch(t){case"[object DataView]":if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(n.byteLength!=e.byteLength||!d(new a(n),new a(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+n,+e);case"[object Error]":return n.name==e.name&&n.message==e.message;case"[object RegExp]":case"[object String]":return n==e+"";case"[object Map]":var m=i;case"[object Set]":var f=1&r;if(m||(m=l),n.size!=e.size&&!f)return!1;var g=u.get(n);if(g)return g==e;r|=2,u.set(n,e);var h=s(m(n),m(e),r,c,d,u);return u.delete(n),h;case"[object Symbol]":if(p)return p.call(n)==p.call(e)}return!1}},function(n,e,t){var r=t(8).Uint8Array;n.exports=r},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n,r){t[++e]=[r,n]})),t}},function(n,e,t){var r=t(190),a=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,o,s,i){var l=1&t,c=r(n),p=c.length;if(p!=r(e).length&&!l)return!1;for(var d=p;d--;){var u=c[d];if(!(l?u in e:a.call(e,u)))return!1}var m=i.get(n),f=i.get(e);if(m&&f)return m==e&&f==n;var g=!0;i.set(n,e),i.set(e,n);for(var h=l;++d<p;){var v=n[u=c[d]],b=e[u];if(o)var y=l?o(b,v,u,e,n,i):o(v,b,u,n,e,i);if(!(void 0===y?v===b||s(v,b,t,o,i):y)){g=!1;break}h||(h="constructor"==u)}if(g&&!h){var _=n.constructor,k=e.constructor;_==k||!("constructor"in n)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof k&&k instanceof k||(g=!1)}return i.delete(n),i.delete(e),g}},function(n,e,t){var r=t(191),a=t(192),o=t(78);n.exports=function(n){return r(n,o,a)}},function(n,e,t){var r=t(68),a=t(5);n.exports=function(n,e,t){var o=e(n);return a(n)?o:r(o,t(n))}},function(n,e,t){var r=t(193),a=t(194),o=Object.prototype.propertyIsEnumerable,s=Object.getOwnPropertySymbols,i=s?function(n){return null==n?[]:(n=Object(n),r(s(n),(function(e){return o.call(n,e)})))}:a;n.exports=i},function(n,e){n.exports=function(n,e){for(var t=-1,r=null==n?0:n.length,a=0,o=[];++t<r;){var s=n[t];e(s,t,n)&&(o[a++]=s)}return o}},function(n,e){n.exports=function(){return[]}},function(n,e,t){var r=t(196),a=t(39),o=t(5),s=t(79),i=t(80),l=t(81),c=Object.prototype.hasOwnProperty;n.exports=function(n,e){var t=o(n),p=!t&&a(n),d=!t&&!p&&s(n),u=!t&&!p&&!d&&l(n),m=t||p||d||u,f=m?r(n.length,String):[],g=f.length;for(var h in n)!e&&!c.call(n,h)||m&&("length"==h||d&&("offset"==h||"parent"==h)||u&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||i(h,g))||f.push(h);return f}},function(n,e){n.exports=function(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}},function(n,e){n.exports=function(){return!1}},function(n,e,t){var r=t(13),a=t(44),o=t(12),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,n.exports=function(n){return o(n)&&a(n.length)&&!!s[r(n)]}},function(n,e){n.exports=function(n){return function(e){return n(e)}}},function(n,e,t){(function(n){var r=t(69),a=e&&!e.nodeType&&e,o=a&&"object"==typeof n&&n&&!n.nodeType&&n,s=o&&o.exports===a&&r.process,i=function(){try{var n=o&&o.require&&o.require("util").types;return n||s&&s.binding&&s.binding("util")}catch(n){}}();n.exports=i}).call(this,t(48)(n))},function(n,e,t){var r=t(202),a=t(203),o=Object.prototype.hasOwnProperty;n.exports=function(n){if(!r(n))return a(n);var e=[];for(var t in Object(n))o.call(n,t)&&"constructor"!=t&&e.push(t);return e}},function(n,e){var t=Object.prototype;n.exports=function(n){var e=n&&n.constructor;return n===("function"==typeof e&&e.prototype||t)}},function(n,e,t){var r=t(204)(Object.keys,Object);n.exports=r},function(n,e){n.exports=function(n,e){return function(t){return n(e(t))}}},function(n,e,t){var r=t(206),a=t(40),o=t(207),s=t(83),i=t(208),l=t(13),c=t(73),p=c(r),d=c(a),u=c(o),m=c(s),f=c(i),g=l;(r&&"[object DataView]"!=g(new r(new ArrayBuffer(1)))||a&&"[object Map]"!=g(new a)||o&&"[object Promise]"!=g(o.resolve())||s&&"[object Set]"!=g(new s)||i&&"[object WeakMap]"!=g(new i))&&(g=function(n){var e=l(n),t="[object Object]"==e?n.constructor:void 0,r=t?c(t):"";if(r)switch(r){case p:return"[object DataView]";case d:return"[object Map]";case u:return"[object Promise]";case m:return"[object Set]";case f:return"[object WeakMap]"}return e}),n.exports=g},function(n,e,t){var r=t(10)(t(8),"DataView");n.exports=r},function(n,e,t){var r=t(10)(t(8),"Promise");n.exports=r},function(n,e,t){var r=t(10)(t(8),"WeakMap");n.exports=r},function(n,e,t){var r=t(84),a=t(78);n.exports=function(n){for(var e=a(n),t=e.length;t--;){var o=e[t],s=n[o];e[t]=[o,s,r(s)]}return e}},function(n,e,t){var r=t(74),a=t(211),o=t(218),s=t(45),i=t(84),l=t(85),c=t(23);n.exports=function(n,e){return s(n)&&i(e)?l(c(n),e):function(t){var s=a(t,n);return void 0===s&&s===e?o(t,n):r(e,s,3)}}},function(n,e,t){var r=t(86);n.exports=function(n,e,t){var a=null==n?void 0:r(n,e);return void 0===a?t:a}},function(n,e,t){var r=t(213),a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,s=r((function(n){var e=[];return 46===n.charCodeAt(0)&&e.push(""),n.replace(a,(function(n,t,r,a){e.push(r?a.replace(o,"$1"):t||n)})),e}));n.exports=s},function(n,e,t){var r=t(214);n.exports=function(n){var e=r(n,(function(n){return 500===t.size&&t.clear(),n})),t=e.cache;return e}},function(n,e,t){var r=t(42);function a(n,e){if("function"!=typeof n||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var t=function(){var r=arguments,a=e?e.apply(this,r):r[0],o=t.cache;if(o.has(a))return o.get(a);var s=n.apply(this,r);return t.cache=o.set(a,s)||o,s};return t.cache=new(a.Cache||r),t}a.Cache=r,n.exports=a},function(n,e,t){var r=t(216);n.exports=function(n){return null==n?"":r(n)}},function(n,e,t){var r=t(15),a=t(217),o=t(5),s=t(46),i=r?r.prototype:void 0,l=i?i.toString:void 0;n.exports=function n(e){if("string"==typeof e)return e;if(o(e))return a(e,n)+"";if(s(e))return l?l.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},function(n,e){n.exports=function(n,e){for(var t=-1,r=null==n?0:n.length,a=Array(r);++t<r;)a[t]=e(n[t],t,n);return a}},function(n,e,t){var r=t(219),a=t(220);n.exports=function(n,e){return null!=n&&a(n,e,r)}},function(n,e){n.exports=function(n,e){return null!=n&&e in Object(n)}},function(n,e,t){var r=t(87),a=t(39),o=t(5),s=t(80),i=t(44),l=t(23);n.exports=function(n,e,t){for(var c=-1,p=(e=r(e,n)).length,d=!1;++c<p;){var u=l(e[c]);if(!(d=null!=n&&t(n,u)))break;n=n[u]}return d||++c!=p?d:!!(p=null==n?0:n.length)&&i(p)&&s(u,p)&&(o(n)||a(n))}},function(n,e,t){var r=t(222),a=t(223),o=t(45),s=t(23);n.exports=function(n){return o(n)?r(s(n)):a(n)}},function(n,e){n.exports=function(n){return function(e){return null==e?void 0:e[n]}}},function(n,e,t){var r=t(86);n.exports=function(n){return function(e){return r(e,n)}}},function(n,e,t){var r=t(47),a=t(225),o=t(227);n.exports=function(n,e){return o(a(n,e,r),n+"")}},function(n,e,t){var r=t(226),a=Math.max;n.exports=function(n,e,t){return e=a(void 0===e?n.length-1:e,0),function(){for(var o=arguments,s=-1,i=a(o.length-e,0),l=Array(i);++s<i;)l[s]=o[e+s];s=-1;for(var c=Array(e+1);++s<e;)c[s]=o[s];return c[e]=t(l),r(n,this,c)}}},function(n,e){n.exports=function(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}},function(n,e,t){var r=t(228),a=t(231)(r);n.exports=a},function(n,e,t){var r=t(229),a=t(230),o=t(47),s=a?function(n,e){return a(n,"toString",{configurable:!0,enumerable:!1,value:r(e),writable:!0})}:o;n.exports=s},function(n,e){n.exports=function(n){return function(){return n}}},function(n,e,t){var r=t(10),a=function(){try{var n=r(Object,"defineProperty");return n({},"",{}),n}catch(n){}}();n.exports=a},function(n,e){var t=Date.now;n.exports=function(n){var e=0,r=0;return function(){var a=t(),o=16-(a-r);if(r=a,o>0){if(++e>=800)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}},function(n,e,t){var r=t(76),a=t(233),o=t(238),s=t(77),i=t(239),l=t(43);n.exports=function(n,e,t){var c=-1,p=a,d=n.length,u=!0,m=[],f=m;if(t)u=!1,p=o;else if(d>=200){var g=e?null:i(n);if(g)return l(g);u=!1,p=s,f=new r}else f=e?[]:m;n:for(;++c<d;){var h=n[c],v=e?e(h):h;if(h=t||0!==h?h:0,u&&v==v){for(var b=f.length;b--;)if(f[b]===v)continue n;e&&f.push(v),m.push(h)}else p(f,v,t)||(f!==m&&f.push(v),m.push(h))}return m}},function(n,e,t){var r=t(234);n.exports=function(n,e){return!!(null==n?0:n.length)&&r(n,e,0)>-1}},function(n,e,t){var r=t(235),a=t(236),o=t(237);n.exports=function(n,e,t){return e==e?o(n,e,t):r(n,a,t)}},function(n,e){n.exports=function(n,e,t,r){for(var a=n.length,o=t+(r?1:-1);r?o--:++o<a;)if(e(n[o],o,n))return o;return-1}},function(n,e){n.exports=function(n){return n!=n}},function(n,e){n.exports=function(n,e,t){for(var r=t-1,a=n.length;++r<a;)if(n[r]===e)return r;return-1}},function(n,e){n.exports=function(n,e,t){for(var r=-1,a=null==n?0:n.length;++r<a;)if(t(e,n[r]))return!0;return!1}},function(n,e,t){var r=t(83),a=t(240),o=t(43),s=r&&1/o(new r([,-0]))[1]==1/0?function(n){return new r(n)}:a;n.exports=s},function(n,e){n.exports=function(){}},function(n,e,t){var r=t(82),a=t(12);n.exports=function(n){return a(n)&&r(n)}},function(n,e,t){},function(n,e,t){},function(n,e,t){"use strict";t(88)},function(n,e,t){"use strict";t(89)},function(n,e,t){},function(n,e,t){},function(n,e){},function(n,e){function t(n,e){for(var t=0,r=n.length-1;r>=0;r--){var a=n[r];"."===a?n.splice(r,1):".."===a?(n.splice(r,1),t++):t&&(n.splice(r,1),t--)}if(e)for(;t--;t)n.unshift("..");return n}function r(n,e){if(n.filter)return n.filter(e);for(var t=[],r=0;r<n.length;r++)e(n[r],r,n)&&t.push(n[r]);return t}e.resolve=function(){for(var n="",e=!1,a=arguments.length-1;a>=-1&&!e;a--){var o=a>=0?arguments[a]:process.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(n=o+"/"+n,e="/"===o.charAt(0))}return(e?"/":"")+(n=t(r(n.split("/"),(function(n){return!!n})),!e).join("/"))||"."},e.normalize=function(n){var o=e.isAbsolute(n),s="/"===a(n,-1);return(n=t(r(n.split("/"),(function(n){return!!n})),!o).join("/"))||o||(n="."),n&&s&&(n+="/"),(o?"/":"")+n},e.isAbsolute=function(n){return"/"===n.charAt(0)},e.join=function(){var n=Array.prototype.slice.call(arguments,0);return e.normalize(r(n,(function(n,e){if("string"!=typeof n)throw new TypeError("Arguments to path.join must be strings");return n})).join("/"))},e.relative=function(n,t){function r(n){for(var e=0;e<n.length&&""===n[e];e++);for(var t=n.length-1;t>=0&&""===n[t];t--);return e>t?[]:n.slice(e,t-e+1)}n=e.resolve(n).substr(1),t=e.resolve(t).substr(1);for(var a=r(n.split("/")),o=r(t.split("/")),s=Math.min(a.length,o.length),i=s,l=0;l<s;l++)if(a[l]!==o[l]){i=l;break}var c=[];for(l=i;l<a.length;l++)c.push("..");return(c=c.concat(o.slice(i))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(n){if("string"!=typeof n&&(n+=""),0===n.length)return".";for(var e=n.charCodeAt(0),t=47===e,r=-1,a=!0,o=n.length-1;o>=1;--o)if(47===(e=n.charCodeAt(o))){if(!a){r=o;break}}else a=!1;return-1===r?t?"/":".":t&&1===r?"/":n.slice(0,r)},e.basename=function(n,e){var t=function(n){"string"!=typeof n&&(n+="");var e,t=0,r=-1,a=!0;for(e=n.length-1;e>=0;--e)if(47===n.charCodeAt(e)){if(!a){t=e+1;break}}else-1===r&&(a=!1,r=e+1);return-1===r?"":n.slice(t,r)}(n);return e&&t.substr(-1*e.length)===e&&(t=t.substr(0,t.length-e.length)),t},e.extname=function(n){"string"!=typeof n&&(n+="");for(var e=-1,t=0,r=-1,a=!0,o=0,s=n.length-1;s>=0;--s){var i=n.charCodeAt(s);if(47!==i)-1===r&&(a=!1,r=s+1),46===i?-1===e?e=s:1!==o&&(o=1):-1!==e&&(o=-1);else if(!a){t=s+1;break}}return-1===e||-1===r||0===o||1===o&&e===r-1&&e===t+1?"":n.slice(e,r)};var a="b"==="ab".substr(-1)?function(n,e,t){return n.substr(e,t)}:function(n,e,t){return e<0&&(e=n.length+e),n.substr(e,t)}},function(n,e,t){"use strict";var r=/[|\\{}()[\]^$+*?.]/g,a=Object.prototype.hasOwnProperty,o=function(n,e){return a.apply(n,[e])};e.escapeRegExpChars=function(n){return n?String(n).replace(r,"\\$&"):""};var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},i=/[&<>'"]/g;function l(n){return s[n]||n}function c(){return Function.prototype.toString.call(this)+';\nvar _ENCODE_HTML_RULES = {\n      "&": "&amp;"\n    , "<": "&lt;"\n    , ">": "&gt;"\n    , \'"\': "&#34;"\n    , "\'": "&#39;"\n    }\n  , _MATCH_HTML = /[&<>\'"]/g;\nfunction encode_char(c) {\n  return _ENCODE_HTML_RULES[c] || c;\n};\n'}e.escapeXML=function(n){return null==n?"":String(n).replace(i,l)};try{"function"==typeof Object.defineProperty?Object.defineProperty(e.escapeXML,"toString",{value:c}):e.escapeXML.toString=c}catch(n){console.warn("Unable to set escapeXML.toString (is the Function prototype frozen?)")}e.shallowCopy=function(n,e){if(e=e||{},null!=n)for(var t in e)o(e,t)&&"__proto__"!==t&&"constructor"!==t&&(n[t]=e[t]);return n},e.shallowCopyFromList=function(n,e,t){if(t=t||[],e=e||{},null!=n)for(var r=0;r<t.length;r++){var a=t[r];if(void 0!==e[a]){if(!o(e,a))continue;if("__proto__"===a||"constructor"===a)continue;n[a]=e[a]}}return n},e.cache={_data:{},set:function(n,e){this._data[n]=e},get:function(n){return this._data[n]},remove:function(n){delete this._data[n]},reset:function(){this._data={}}},e.hyphenToCamel=function(n){return n.replace(/-[a-z]/g,(function(n){return n[1].toUpperCase()}))},e.createNullProtoObjWherePossible="function"==typeof Object.create?function(){return Object.create(null)}:{__proto__:null}instanceof Object?function(){return{}}:function(){return{__proto__:null}},e.hasOwnOnlyObject=function(n){var t=e.createNullProtoObjWherePossible();for(var r in n)o(n,r)&&(t[r]=n[r]);return t}},function(n){n.exports=JSON.parse('{"name":"ejs","description":"Embedded JavaScript templates","keywords":["template","engine","ejs"],"version":"3.1.10","author":"Matthew Eernisse <mde@fleegix.org> (http://fleegix.org)","license":"Apache-2.0","bin":{"ejs":"./bin/cli.js"},"main":"./lib/ejs.js","jsdelivr":"ejs.min.js","unpkg":"ejs.min.js","repository":{"type":"git","url":"git://github.com/mde/ejs.git"},"bugs":"https://github.com/mde/ejs/issues","homepage":"https://github.com/mde/ejs","dependencies":{"jake":"^10.8.5"},"devDependencies":{"browserify":"^16.5.1","eslint":"^6.8.0","git-directory-deploy":"^1.5.1","jsdoc":"^4.0.2","lru-cache":"^4.0.1","mocha":"^10.2.0","uglify-js":"^3.3.16"},"engines":{"node":">=0.10.0"},"scripts":{"test":"npx jake test"},"__npminstall_done":true,"_from":"ejs@3.1.10","_resolved":"https://registry.npmmirror.com/ejs/-/ejs-3.1.10.tgz"}')},function(n,e,t){"use strict";t(90)},function(n,e,t){"use strict";t(91)},function(n,e,t){"use strict";t(92)},function(n,e,t){"use strict";t.r(e);
/*!
 * Vue.js v2.7.16
 * (c) 2014-2023 Evan You
 * Released under the MIT License.
 */
var r=Object.freeze({}),a=Array.isArray;function o(n){return null==n}function s(n){return null!=n}function i(n){return!0===n}function l(n){return"string"==typeof n||"number"==typeof n||"symbol"==typeof n||"boolean"==typeof n}function c(n){return"function"==typeof n}function p(n){return null!==n&&"object"==typeof n}var d=Object.prototype.toString;function u(n){return"[object Object]"===d.call(n)}function m(n){return"[object RegExp]"===d.call(n)}function f(n){var e=parseFloat(String(n));return e>=0&&Math.floor(e)===e&&isFinite(n)}function g(n){return s(n)&&"function"==typeof n.then&&"function"==typeof n.catch}function h(n){return null==n?"":Array.isArray(n)||u(n)&&n.toString===d?JSON.stringify(n,v,2):String(n)}function v(n,e){return e&&e.__v_isRef?e.value:e}function b(n){var e=parseFloat(n);return isNaN(e)?n:e}function y(n,e){for(var t=Object.create(null),r=n.split(","),a=0;a<r.length;a++)t[r[a]]=!0;return e?function(n){return t[n.toLowerCase()]}:function(n){return t[n]}}y("slot,component",!0);var _=y("key,ref,slot,slot-scope,is");function k(n,e){var t=n.length;if(t){if(e===n[t-1])return void(n.length=t-1);var r=n.indexOf(e);if(r>-1)return n.splice(r,1)}}var w=Object.prototype.hasOwnProperty;function x(n,e){return w.call(n,e)}function E(n){var e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}var j=/-(\w)/g,A=E((function(n){return n.replace(j,(function(n,e){return e?e.toUpperCase():""}))})),T=E((function(n){return n.charAt(0).toUpperCase()+n.slice(1)})),S=/\B([A-Z])/g,C=E((function(n){return n.replace(S,"-$1").toLowerCase()}));var B=Function.prototype.bind?function(n,e){return n.bind(e)}:function(n,e){function t(t){var r=arguments.length;return r?r>1?n.apply(e,arguments):n.call(e,t):n.call(e)}return t._length=n.length,t};function z(n,e){e=e||0;for(var t=n.length-e,r=new Array(t);t--;)r[t]=n[t+e];return r}function P(n,e){for(var t in e)n[t]=e[t];return n}function I(n){for(var e={},t=0;t<n.length;t++)n[t]&&P(e,n[t]);return e}function q(n,e,t){}var N=function(n,e,t){return!1},D=function(n){return n};function F(n,e){if(n===e)return!0;var t=p(n),r=p(e);if(!t||!r)return!t&&!r&&String(n)===String(e);try{var a=Array.isArray(n),o=Array.isArray(e);if(a&&o)return n.length===e.length&&n.every((function(n,t){return F(n,e[t])}));if(n instanceof Date&&e instanceof Date)return n.getTime()===e.getTime();if(a||o)return!1;var s=Object.keys(n),i=Object.keys(e);return s.length===i.length&&s.every((function(t){return F(n[t],e[t])}))}catch(n){return!1}}function O(n,e){for(var t=0;t<n.length;t++)if(F(n[t],e))return t;return-1}function L(n){var e=!1;return function(){e||(e=!0,n.apply(this,arguments))}}function R(n,e){return n===e?0===n&&1/n!=1/e:n==n||e==e}var M=["component","directive","filter"],U=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch","renderTracked","renderTriggered"],V={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:N,isReservedAttr:N,isUnknownElement:N,getTagNamespace:q,parsePlatformTagName:D,mustUseProp:N,async:!0,_lifecycleHooks:U},J=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function H(n){var e=(n+"").charCodeAt(0);return 36===e||95===e}function G(n,e,t,r){Object.defineProperty(n,e,{value:t,enumerable:!!r,writable:!0,configurable:!0})}var $=new RegExp("[^".concat(J.source,".$_\\d]"));var K="__proto__"in{},Z="undefined"!=typeof window,W=Z&&window.navigator.userAgent.toLowerCase(),X=W&&/msie|trident/.test(W),Q=W&&W.indexOf("msie 9.0")>0,Y=W&&W.indexOf("edge/")>0;W&&W.indexOf("android");var nn=W&&/iphone|ipad|ipod|ios/.test(W);W&&/chrome\/\d+/.test(W),W&&/phantomjs/.test(W);var en,tn=W&&W.match(/firefox\/(\d+)/),rn={}.watch,an=!1;if(Z)try{var on={};Object.defineProperty(on,"passive",{get:function(){an=!0}}),window.addEventListener("test-passive",null,on)}catch(n){}var sn=function(){return void 0===en&&(en=!Z&&"undefined"!=typeof global&&(global.process&&"server"===global.process.env.VUE_ENV)),en},ln=Z&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function cn(n){return"function"==typeof n&&/native code/.test(n.toString())}var pn,dn="undefined"!=typeof Symbol&&cn(Symbol)&&"undefined"!=typeof Reflect&&cn(Reflect.ownKeys);pn="undefined"!=typeof Set&&cn(Set)?Set:function(){function n(){this.set=Object.create(null)}return n.prototype.has=function(n){return!0===this.set[n]},n.prototype.add=function(n){this.set[n]=!0},n.prototype.clear=function(){this.set=Object.create(null)},n}();var un=null;function mn(n){void 0===n&&(n=null),n||un&&un._scope.off(),un=n,n&&n._scope.on()}var fn=function(){function n(n,e,t,r,a,o,s,i){this.tag=n,this.data=e,this.children=t,this.text=r,this.elm=a,this.ns=void 0,this.context=o,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=e&&e.key,this.componentOptions=s,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=i,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1}return Object.defineProperty(n.prototype,"child",{get:function(){return this.componentInstance},enumerable:!1,configurable:!0}),n}(),gn=function(n){void 0===n&&(n="");var e=new fn;return e.text=n,e.isComment=!0,e};function hn(n){return new fn(void 0,void 0,void 0,String(n))}function vn(n){var e=new fn(n.tag,n.data,n.children&&n.children.slice(),n.text,n.elm,n.context,n.componentOptions,n.asyncFactory);return e.ns=n.ns,e.isStatic=n.isStatic,e.key=n.key,e.isComment=n.isComment,e.fnContext=n.fnContext,e.fnOptions=n.fnOptions,e.fnScopeId=n.fnScopeId,e.asyncMeta=n.asyncMeta,e.isCloned=!0,e}"function"==typeof SuppressedError&&SuppressedError;var bn=0,yn=[],_n=function(){function n(){this._pending=!1,this.id=bn++,this.subs=[]}return n.prototype.addSub=function(n){this.subs.push(n)},n.prototype.removeSub=function(n){this.subs[this.subs.indexOf(n)]=null,this._pending||(this._pending=!0,yn.push(this))},n.prototype.depend=function(e){n.target&&n.target.addDep(this)},n.prototype.notify=function(n){var e=this.subs.filter((function(n){return n}));for(var t=0,r=e.length;t<r;t++){0,e[t].update()}},n}();_n.target=null;var kn=[];function wn(n){kn.push(n),_n.target=n}function xn(){kn.pop(),_n.target=kn[kn.length-1]}var En=Array.prototype,jn=Object.create(En);["push","pop","shift","unshift","splice","sort","reverse"].forEach((function(n){var e=En[n];G(jn,n,(function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var a,o=e.apply(this,t),s=this.__ob__;switch(n){case"push":case"unshift":a=t;break;case"splice":a=t.slice(2)}return a&&s.observeArray(a),s.dep.notify(),o}))}));var An=Object.getOwnPropertyNames(jn),Tn={},Sn=!0;function Cn(n){Sn=n}var Bn={notify:q,depend:q,addSub:q,removeSub:q},zn=function(){function n(n,e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),this.value=n,this.shallow=e,this.mock=t,this.dep=t?Bn:new _n,this.vmCount=0,G(n,"__ob__",this),a(n)){if(!t)if(K)n.__proto__=jn;else for(var r=0,o=An.length;r<o;r++){G(n,i=An[r],jn[i])}e||this.observeArray(n)}else{var s=Object.keys(n);for(r=0;r<s.length;r++){var i;In(n,i=s[r],Tn,void 0,e,t)}}}return n.prototype.observeArray=function(n){for(var e=0,t=n.length;e<t;e++)Pn(n[e],!1,this.mock)},n}();function Pn(n,e,t){return n&&x(n,"__ob__")&&n.__ob__ instanceof zn?n.__ob__:!Sn||!t&&sn()||!a(n)&&!u(n)||!Object.isExtensible(n)||n.__v_skip||Rn(n)||n instanceof fn?void 0:new zn(n,e,t)}function In(n,e,t,r,o,s,i){void 0===i&&(i=!1);var l=new _n,c=Object.getOwnPropertyDescriptor(n,e);if(!c||!1!==c.configurable){var p=c&&c.get,d=c&&c.set;p&&!d||t!==Tn&&2!==arguments.length||(t=n[e]);var u=o?t&&t.__ob__:Pn(t,!1,s);return Object.defineProperty(n,e,{enumerable:!0,configurable:!0,get:function(){var e=p?p.call(n):t;return _n.target&&(l.depend(),u&&(u.dep.depend(),a(e)&&Dn(e))),Rn(e)&&!o?e.value:e},set:function(e){var r=p?p.call(n):t;if(R(r,e)){if(d)d.call(n,e);else{if(p)return;if(!o&&Rn(r)&&!Rn(e))return void(r.value=e);t=e}u=o?e&&e.__ob__:Pn(e,!1,s),l.notify()}}}),l}}function qn(n,e,t){if(!Ln(n)){var r=n.__ob__;return a(n)&&f(e)?(n.length=Math.max(n.length,e),n.splice(e,1,t),r&&!r.shallow&&r.mock&&Pn(t,!1,!0),t):e in n&&!(e in Object.prototype)?(n[e]=t,t):n._isVue||r&&r.vmCount?t:r?(In(r.value,e,t,void 0,r.shallow,r.mock),r.dep.notify(),t):(n[e]=t,t)}}function Nn(n,e){if(a(n)&&f(e))n.splice(e,1);else{var t=n.__ob__;n._isVue||t&&t.vmCount||Ln(n)||x(n,e)&&(delete n[e],t&&t.dep.notify())}}function Dn(n){for(var e=void 0,t=0,r=n.length;t<r;t++)(e=n[t])&&e.__ob__&&e.__ob__.dep.depend(),a(e)&&Dn(e)}function Fn(n){return On(n,!0),G(n,"__v_isShallow",!0),n}function On(n,e){if(!Ln(n)){Pn(n,e,sn());0}}function Ln(n){return!(!n||!n.__v_isReadonly)}function Rn(n){return!(!n||!0!==n.__v_isRef)}function Mn(n,e,t){Object.defineProperty(n,t,{enumerable:!0,configurable:!0,get:function(){var n=e[t];if(Rn(n))return n.value;var r=n&&n.__ob__;return r&&r.dep.depend(),n},set:function(n){var r=e[t];Rn(r)&&!Rn(n)?r.value=n:e[t]=n}})}"".concat("watcher"," callback"),"".concat("watcher"," getter"),"".concat("watcher"," cleanup");var Un;var Vn=function(){function n(n){void 0===n&&(n=!1),this.detached=n,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Un,!n&&Un&&(this.index=(Un.scopes||(Un.scopes=[])).push(this)-1)}return n.prototype.run=function(n){if(this.active){var e=Un;try{return Un=this,n()}finally{Un=e}}else 0},n.prototype.on=function(){Un=this},n.prototype.off=function(){Un=this.parent},n.prototype.stop=function(n){if(this.active){var e=void 0,t=void 0;for(e=0,t=this.effects.length;e<t;e++)this.effects[e].teardown();for(e=0,t=this.cleanups.length;e<t;e++)this.cleanups[e]();if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].stop(!0);if(!this.detached&&this.parent&&!n){var r=this.parent.scopes.pop();r&&r!==this&&(this.parent.scopes[this.index]=r,r.index=this.index)}this.parent=void 0,this.active=!1}},n}();function Jn(n){var e=n._provided,t=n.$parent&&n.$parent._provided;return t===e?n._provided=Object.create(t):e}var Hn=E((function(n){var e="&"===n.charAt(0),t="~"===(n=e?n.slice(1):n).charAt(0),r="!"===(n=t?n.slice(1):n).charAt(0);return{name:n=r?n.slice(1):n,once:t,capture:r,passive:e}}));function Gn(n,e){function t(){var n=t.fns;if(!a(n))return Se(n,null,arguments,e,"v-on handler");for(var r=n.slice(),o=0;o<r.length;o++)Se(r[o],null,arguments,e,"v-on handler")}return t.fns=n,t}function $n(n,e,t,r,a,s){var l,c,p,d;for(l in n)c=n[l],p=e[l],d=Hn(l),o(c)||(o(p)?(o(c.fns)&&(c=n[l]=Gn(c,s)),i(d.once)&&(c=n[l]=a(d.name,c,d.capture)),t(d.name,c,d.capture,d.passive,d.params)):c!==p&&(p.fns=c,n[l]=p));for(l in e)o(n[l])&&r((d=Hn(l)).name,e[l],d.capture)}function Kn(n,e,t){var r;n instanceof fn&&(n=n.data.hook||(n.data.hook={}));var a=n[e];function l(){t.apply(this,arguments),k(r.fns,l)}o(a)?r=Gn([l]):s(a.fns)&&i(a.merged)?(r=a).fns.push(l):r=Gn([a,l]),r.merged=!0,n[e]=r}function Zn(n,e,t,r,a){if(s(e)){if(x(e,t))return n[t]=e[t],a||delete e[t],!0;if(x(e,r))return n[t]=e[r],a||delete e[r],!0}return!1}function Wn(n){return l(n)?[hn(n)]:a(n)?function n(e,t){var r,c,p,d,u=[];for(r=0;r<e.length;r++)o(c=e[r])||"boolean"==typeof c||(p=u.length-1,d=u[p],a(c)?c.length>0&&(Xn((c=n(c,"".concat(t||"","_").concat(r)))[0])&&Xn(d)&&(u[p]=hn(d.text+c[0].text),c.shift()),u.push.apply(u,c)):l(c)?Xn(d)?u[p]=hn(d.text+c):""!==c&&u.push(hn(c)):Xn(c)&&Xn(d)?u[p]=hn(d.text+c.text):(i(e._isVList)&&s(c.tag)&&o(c.key)&&s(t)&&(c.key="__vlist".concat(t,"_").concat(r,"__")),u.push(c)));return u}(n):void 0}function Xn(n){return s(n)&&s(n.text)&&!1===n.isComment}function Qn(n,e){var t,r,o,i,l=null;if(a(n)||"string"==typeof n)for(l=new Array(n.length),t=0,r=n.length;t<r;t++)l[t]=e(n[t],t);else if("number"==typeof n)for(l=new Array(n),t=0;t<n;t++)l[t]=e(t+1,t);else if(p(n))if(dn&&n[Symbol.iterator]){l=[];for(var c=n[Symbol.iterator](),d=c.next();!d.done;)l.push(e(d.value,l.length)),d=c.next()}else for(o=Object.keys(n),l=new Array(o.length),t=0,r=o.length;t<r;t++)i=o[t],l[t]=e(n[i],i,t);return s(l)||(l=[]),l._isVList=!0,l}function Yn(n,e,t,r){var a,o=this.$scopedSlots[n];o?(t=t||{},r&&(t=P(P({},r),t)),a=o(t)||(c(e)?e():e)):a=this.$slots[n]||(c(e)?e():e);var s=t&&t.slot;return s?this.$createElement("template",{slot:s},a):a}function ne(n){return zt(this.$options,"filters",n,!0)||D}function ee(n,e){return a(n)?-1===n.indexOf(e):n!==e}function te(n,e,t,r,a){var o=V.keyCodes[e]||t;return a&&r&&!V.keyCodes[e]?ee(a,r):o?ee(o,n):r?C(r)!==e:void 0===n}function re(n,e,t,r,o){if(t)if(p(t)){a(t)&&(t=I(t));var s=void 0,i=function(a){if("class"===a||"style"===a||_(a))s=n;else{var i=n.attrs&&n.attrs.type;s=r||V.mustUseProp(e,i,a)?n.domProps||(n.domProps={}):n.attrs||(n.attrs={})}var l=A(a),c=C(a);l in s||c in s||(s[a]=t[a],o&&((n.on||(n.on={}))["update:".concat(a)]=function(n){t[a]=n}))};for(var l in t)i(l)}else;return n}function ae(n,e){var t=this._staticTrees||(this._staticTrees=[]),r=t[n];return r&&!e||se(r=t[n]=this.$options.staticRenderFns[n].call(this._renderProxy,this._c,this),"__static__".concat(n),!1),r}function oe(n,e,t){return se(n,"__once__".concat(e).concat(t?"_".concat(t):""),!0),n}function se(n,e,t){if(a(n))for(var r=0;r<n.length;r++)n[r]&&"string"!=typeof n[r]&&ie(n[r],"".concat(e,"_").concat(r),t);else ie(n,e,t)}function ie(n,e,t){n.isStatic=!0,n.key=e,n.isOnce=t}function le(n,e){if(e)if(u(e)){var t=n.on=n.on?P({},n.on):{};for(var r in e){var a=t[r],o=e[r];t[r]=a?[].concat(a,o):o}}else;return n}function ce(n,e,t,r){e=e||{$stable:!t};for(var o=0;o<n.length;o++){var s=n[o];a(s)?ce(s,e,t):s&&(s.proxy&&(s.fn.proxy=!0),e[s.key]=s.fn)}return r&&(e.$key=r),e}function pe(n,e){for(var t=0;t<e.length;t+=2){var r=e[t];"string"==typeof r&&r&&(n[e[t]]=e[t+1])}return n}function de(n,e){return"string"==typeof n?e+n:n}function ue(n){n._o=oe,n._n=b,n._s=h,n._l=Qn,n._t=Yn,n._q=F,n._i=O,n._m=ae,n._f=ne,n._k=te,n._b=re,n._v=hn,n._e=gn,n._u=ce,n._g=le,n._d=pe,n._p=de}function me(n,e){if(!n||!n.length)return{};for(var t={},r=0,a=n.length;r<a;r++){var o=n[r],s=o.data;if(s&&s.attrs&&s.attrs.slot&&delete s.attrs.slot,o.context!==e&&o.fnContext!==e||!s||null==s.slot)(t.default||(t.default=[])).push(o);else{var i=s.slot,l=t[i]||(t[i]=[]);"template"===o.tag?l.push.apply(l,o.children||[]):l.push(o)}}for(var c in t)t[c].every(fe)&&delete t[c];return t}function fe(n){return n.isComment&&!n.asyncFactory||" "===n.text}function ge(n){return n.isComment&&n.asyncFactory}function he(n,e,t,a){var o,s=Object.keys(t).length>0,i=e?!!e.$stable:!s,l=e&&e.$key;if(e){if(e._normalized)return e._normalized;if(i&&a&&a!==r&&l===a.$key&&!s&&!a.$hasNormal)return a;for(var c in o={},e)e[c]&&"$"!==c[0]&&(o[c]=ve(n,t,c,e[c]))}else o={};for(var p in t)p in o||(o[p]=be(t,p));return e&&Object.isExtensible(e)&&(e._normalized=o),G(o,"$stable",i),G(o,"$key",l),G(o,"$hasNormal",s),o}function ve(n,e,t,r){var o=function(){var e=un;mn(n);var t=arguments.length?r.apply(null,arguments):r({}),o=(t=t&&"object"==typeof t&&!a(t)?[t]:Wn(t))&&t[0];return mn(e),t&&(!o||1===t.length&&o.isComment&&!ge(o))?void 0:t};return r.proxy&&Object.defineProperty(e,t,{get:o,enumerable:!0,configurable:!0}),o}function be(n,e){return function(){return n[e]}}function ye(n){return{get attrs(){if(!n._attrsProxy){var e=n._attrsProxy={};G(e,"_v_attr_proxy",!0),_e(e,n.$attrs,r,n,"$attrs")}return n._attrsProxy},get listeners(){n._listenersProxy||_e(n._listenersProxy={},n.$listeners,r,n,"$listeners");return n._listenersProxy},get slots(){return function(n){n._slotsProxy||we(n._slotsProxy={},n.$scopedSlots);return n._slotsProxy}(n)},emit:B(n.$emit,n),expose:function(e){e&&Object.keys(e).forEach((function(t){return Mn(n,e,t)}))}}}function _e(n,e,t,r,a){var o=!1;for(var s in e)s in n?e[s]!==t[s]&&(o=!0):(o=!0,ke(n,s,r,a));for(var s in n)s in e||(o=!0,delete n[s]);return o}function ke(n,e,t,r){Object.defineProperty(n,e,{enumerable:!0,configurable:!0,get:function(){return t[r][e]}})}function we(n,e){for(var t in e)n[t]=e[t];for(var t in n)t in e||delete n[t]}var xe=null;function Ee(n,e){return(n.__esModule||dn&&"Module"===n[Symbol.toStringTag])&&(n=n.default),p(n)?e.extend(n):n}function je(n){if(a(n))for(var e=0;e<n.length;e++){var t=n[e];if(s(t)&&(s(t.componentOptions)||ge(t)))return t}}function Ae(n,e,t,r,d,u){return(a(t)||l(t))&&(d=r,r=t,t=void 0),i(u)&&(d=2),function(n,e,t,r,l){if(s(t)&&s(t.__ob__))return gn();s(t)&&s(t.is)&&(e=t.is);if(!e)return gn();0;a(r)&&c(r[0])&&((t=t||{}).scopedSlots={default:r[0]},r.length=0);2===l?r=Wn(r):1===l&&(r=function(n){for(var e=0;e<n.length;e++)if(a(n[e]))return Array.prototype.concat.apply([],n);return n}(r));var d,u;if("string"==typeof e){var m=void 0;u=n.$vnode&&n.$vnode.ns||V.getTagNamespace(e),d=V.isReservedTag(e)?new fn(V.parsePlatformTagName(e),t,r,void 0,void 0,n):t&&t.pre||!s(m=zt(n.$options,"components",e))?new fn(e,t,r,void 0,void 0,n):kt(m,t,n,r,e)}else d=kt(e,t,n,r);return a(d)?d:s(d)?(s(u)&&function n(e,t,r){e.ns=t,"foreignObject"===e.tag&&(t=void 0,r=!0);if(s(e.children))for(var a=0,l=e.children.length;a<l;a++){var c=e.children[a];s(c.tag)&&(o(c.ns)||i(r)&&"svg"!==c.tag)&&n(c,t,r)}}(d,u),s(t)&&function(n){p(n.style)&&Ve(n.style);p(n.class)&&Ve(n.class)}(t),d):gn()}(n,e,t,r,d)}function Te(n,e,t){wn();try{if(e)for(var r=e;r=r.$parent;){var a=r.$options.errorCaptured;if(a)for(var o=0;o<a.length;o++)try{if(!1===a[o].call(r,n,e,t))return}catch(n){Ce(n,r,"errorCaptured hook")}}Ce(n,e,t)}finally{xn()}}function Se(n,e,t,r,a){var o;try{(o=t?n.apply(e,t):n.call(e))&&!o._isVue&&g(o)&&!o._handled&&(o.catch((function(n){return Te(n,r,a+" (Promise/async)")})),o._handled=!0)}catch(n){Te(n,r,a)}return o}function Ce(n,e,t){if(V.errorHandler)try{return V.errorHandler.call(null,n,e,t)}catch(e){e!==n&&Be(e,null,"config.errorHandler")}Be(n,e,t)}function Be(n,e,t){if(!Z||"undefined"==typeof console)throw n;console.error(n)}var ze,Pe=!1,Ie=[],qe=!1;function Ne(){qe=!1;var n=Ie.slice(0);Ie.length=0;for(var e=0;e<n.length;e++)n[e]()}if("undefined"!=typeof Promise&&cn(Promise)){var De=Promise.resolve();ze=function(){De.then(Ne),nn&&setTimeout(q)},Pe=!0}else if(X||"undefined"==typeof MutationObserver||!cn(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())ze="undefined"!=typeof setImmediate&&cn(setImmediate)?function(){setImmediate(Ne)}:function(){setTimeout(Ne,0)};else{var Fe=1,Oe=new MutationObserver(Ne),Le=document.createTextNode(String(Fe));Oe.observe(Le,{characterData:!0}),ze=function(){Fe=(Fe+1)%2,Le.data=String(Fe)},Pe=!0}function Re(n,e){var t;if(Ie.push((function(){if(n)try{n.call(e)}catch(n){Te(n,e,"nextTick")}else t&&t(e)})),qe||(qe=!0,ze()),!n&&"undefined"!=typeof Promise)return new Promise((function(n){t=n}))}function Me(n){return function(e,t){if(void 0===t&&(t=un),t)return function(n,e,t){var r=n.$options;r[e]=Tt(r[e],t)}(t,n,e)}}Me("beforeMount"),Me("mounted"),Me("beforeUpdate"),Me("updated"),Me("beforeDestroy"),Me("destroyed"),Me("activated"),Me("deactivated"),Me("serverPrefetch"),Me("renderTracked"),Me("renderTriggered"),Me("errorCaptured");var Ue=new pn;function Ve(n){return function n(e,t){var r,o,s=a(e);if(!s&&!p(e)||e.__v_skip||Object.isFrozen(e)||e instanceof fn)return;if(e.__ob__){var i=e.__ob__.dep.id;if(t.has(i))return;t.add(i)}if(s)for(r=e.length;r--;)n(e[r],t);else if(Rn(e))n(e.value,t);else for(o=Object.keys(e),r=o.length;r--;)n(e[o[r]],t)}(n,Ue),Ue.clear(),n}var Je,He=0,Ge=function(){function n(n,e,t,r,a){var o,s;o=this,void 0===(s=Un&&!Un._vm?Un:n?n._scope:void 0)&&(s=Un),s&&s.active&&s.effects.push(o),(this.vm=n)&&a&&(n._watcher=this),r?(this.deep=!!r.deep,this.user=!!r.user,this.lazy=!!r.lazy,this.sync=!!r.sync,this.before=r.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=t,this.id=++He,this.active=!0,this.post=!1,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new pn,this.newDepIds=new pn,this.expression="",c(e)?this.getter=e:(this.getter=function(n){if(!$.test(n)){var e=n.split(".");return function(n){for(var t=0;t<e.length;t++){if(!n)return;n=n[e[t]]}return n}}}(e),this.getter||(this.getter=q)),this.value=this.lazy?void 0:this.get()}return n.prototype.get=function(){var n;wn(this);var e=this.vm;try{n=this.getter.call(e,e)}catch(n){if(!this.user)throw n;Te(n,e,'getter for watcher "'.concat(this.expression,'"'))}finally{this.deep&&Ve(n),xn(),this.cleanupDeps()}return n},n.prototype.addDep=function(n){var e=n.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(n),this.depIds.has(e)||n.addSub(this))},n.prototype.cleanupDeps=function(){for(var n=this.deps.length;n--;){var e=this.deps[n];this.newDepIds.has(e.id)||e.removeSub(this)}var t=this.depIds;this.depIds=this.newDepIds,this.newDepIds=t,this.newDepIds.clear(),t=this.deps,this.deps=this.newDeps,this.newDeps=t,this.newDeps.length=0},n.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():mt(this)},n.prototype.run=function(){if(this.active){var n=this.get();if(n!==this.value||p(n)||this.deep){var e=this.value;if(this.value=n,this.user){var t='callback for watcher "'.concat(this.expression,'"');Se(this.cb,this.vm,[n,e],this.vm,t)}else this.cb.call(this.vm,n,e)}}},n.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},n.prototype.depend=function(){for(var n=this.deps.length;n--;)this.deps[n].depend()},n.prototype.teardown=function(){if(this.vm&&!this.vm._isBeingDestroyed&&k(this.vm._scope.effects,this),this.active){for(var n=this.deps.length;n--;)this.deps[n].removeSub(this);this.active=!1,this.onStop&&this.onStop()}},n}();function $e(n,e){Je.$on(n,e)}function Ke(n,e){Je.$off(n,e)}function Ze(n,e){var t=Je;return function r(){var a=e.apply(null,arguments);null!==a&&t.$off(n,r)}}function We(n,e,t){Je=n,$n(e,t||{},$e,Ke,Ze,n),Je=void 0}var Xe=null;function Qe(n){var e=Xe;return Xe=n,function(){Xe=e}}function Ye(n){for(;n&&(n=n.$parent);)if(n._inactive)return!0;return!1}function nt(n,e){if(e){if(n._directInactive=!1,Ye(n))return}else if(n._directInactive)return;if(n._inactive||null===n._inactive){n._inactive=!1;for(var t=0;t<n.$children.length;t++)nt(n.$children[t]);et(n,"activated")}}function et(n,e,t,r){void 0===r&&(r=!0),wn();var a=un,o=Un;r&&mn(n);var s=n.$options[e],i="".concat(e," hook");if(s)for(var l=0,c=s.length;l<c;l++)Se(s[l],n,t||null,n,i);n._hasHookEvent&&n.$emit("hook:"+e),r&&(mn(a),o&&o.on()),xn()}var tt=[],rt=[],at={},ot=!1,st=!1,it=0;var lt=0,ct=Date.now;if(Z&&!X){var pt=window.performance;pt&&"function"==typeof pt.now&&ct()>document.createEvent("Event").timeStamp&&(ct=function(){return pt.now()})}var dt=function(n,e){if(n.post){if(!e.post)return 1}else if(e.post)return-1;return n.id-e.id};function ut(){var n,e;for(lt=ct(),st=!0,tt.sort(dt),it=0;it<tt.length;it++)(n=tt[it]).before&&n.before(),e=n.id,at[e]=null,n.run();var t=rt.slice(),r=tt.slice();it=tt.length=rt.length=0,at={},ot=st=!1,function(n){for(var e=0;e<n.length;e++)n[e]._inactive=!0,nt(n[e],!0)}(t),function(n){var e=n.length;for(;e--;){var t=n[e],r=t.vm;r&&r._watcher===t&&r._isMounted&&!r._isDestroyed&&et(r,"updated")}}(r),function(){for(var n=0;n<yn.length;n++){var e=yn[n];e.subs=e.subs.filter((function(n){return n})),e._pending=!1}yn.length=0}(),ln&&V.devtools&&ln.emit("flush")}function mt(n){var e=n.id;if(null==at[e]&&(n!==_n.target||!n.noRecurse)){if(at[e]=!0,st){for(var t=tt.length-1;t>it&&tt[t].id>n.id;)t--;tt.splice(t+1,0,n)}else tt.push(n);ot||(ot=!0,Re(ut))}}function ft(n,e){if(n){for(var t=Object.create(null),r=dn?Reflect.ownKeys(n):Object.keys(n),a=0;a<r.length;a++){var o=r[a];if("__ob__"!==o){var s=n[o].from;if(s in e._provided)t[o]=e._provided[s];else if("default"in n[o]){var i=n[o].default;t[o]=c(i)?i.call(e):i}else 0}}return t}}function gt(n,e,t,o,s){var l,c=this,p=s.options;x(o,"_uid")?(l=Object.create(o))._original=o:(l=o,o=o._original);var d=i(p._compiled),u=!d;this.data=n,this.props=e,this.children=t,this.parent=o,this.listeners=n.on||r,this.injections=ft(p.inject,o),this.slots=function(){return c.$slots||he(o,n.scopedSlots,c.$slots=me(t,o)),c.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return he(o,n.scopedSlots,this.slots())}}),d&&(this.$options=p,this.$slots=this.slots(),this.$scopedSlots=he(o,n.scopedSlots,this.$slots)),p._scopeId?this._c=function(n,e,t,r){var s=Ae(l,n,e,t,r,u);return s&&!a(s)&&(s.fnScopeId=p._scopeId,s.fnContext=o),s}:this._c=function(n,e,t,r){return Ae(l,n,e,t,r,u)}}function ht(n,e,t,r,a){var o=vn(n);return o.fnContext=t,o.fnOptions=r,e.slot&&((o.data||(o.data={})).slot=e.slot),o}function vt(n,e){for(var t in e)n[A(t)]=e[t]}function bt(n){return n.name||n.__name||n._componentTag}ue(gt.prototype);var yt={init:function(n,e){if(n.componentInstance&&!n.componentInstance._isDestroyed&&n.data.keepAlive){var t=n;yt.prepatch(t,t)}else{(n.componentInstance=function(n,e){var t={_isComponent:!0,_parentVnode:n,parent:e},r=n.data.inlineTemplate;s(r)&&(t.render=r.render,t.staticRenderFns=r.staticRenderFns);return new n.componentOptions.Ctor(t)}(n,Xe)).$mount(e?n.elm:void 0,e)}},prepatch:function(n,e){var t=e.componentOptions;!function(n,e,t,a,o){var s=a.data.scopedSlots,i=n.$scopedSlots,l=!!(s&&!s.$stable||i!==r&&!i.$stable||s&&n.$scopedSlots.$key!==s.$key||!s&&n.$scopedSlots.$key),c=!!(o||n.$options._renderChildren||l),p=n.$vnode;n.$options._parentVnode=a,n.$vnode=a,n._vnode&&(n._vnode.parent=a),n.$options._renderChildren=o;var d=a.data.attrs||r;n._attrsProxy&&_e(n._attrsProxy,d,p.data&&p.data.attrs||r,n,"$attrs")&&(c=!0),n.$attrs=d,t=t||r;var u=n.$options._parentListeners;if(n._listenersProxy&&_e(n._listenersProxy,t,u||r,n,"$listeners"),n.$listeners=n.$options._parentListeners=t,We(n,t,u),e&&n.$options.props){Cn(!1);for(var m=n._props,f=n.$options._propKeys||[],g=0;g<f.length;g++){var h=f[g],v=n.$options.props;m[h]=Pt(h,v,e,n)}Cn(!0),n.$options.propsData=e}c&&(n.$slots=me(o,a.context),n.$forceUpdate())}(e.componentInstance=n.componentInstance,t.propsData,t.listeners,e,t.children)},insert:function(n){var e,t=n.context,r=n.componentInstance;r._isMounted||(r._isMounted=!0,et(r,"mounted")),n.data.keepAlive&&(t._isMounted?((e=r)._inactive=!1,rt.push(e)):nt(r,!0))},destroy:function(n){var e=n.componentInstance;e._isDestroyed||(n.data.keepAlive?function n(e,t){if(!(t&&(e._directInactive=!0,Ye(e))||e._inactive)){e._inactive=!0;for(var r=0;r<e.$children.length;r++)n(e.$children[r]);et(e,"deactivated")}}(e,!0):e.$destroy())}},_t=Object.keys(yt);function kt(n,e,t,l,c){if(!o(n)){var d=t.$options._base;if(p(n)&&(n=d.extend(n)),"function"==typeof n){var u;if(o(n.cid)&&void 0===(n=function(n,e){if(i(n.error)&&s(n.errorComp))return n.errorComp;if(s(n.resolved))return n.resolved;var t=xe;if(t&&s(n.owners)&&-1===n.owners.indexOf(t)&&n.owners.push(t),i(n.loading)&&s(n.loadingComp))return n.loadingComp;if(t&&!s(n.owners)){var r=n.owners=[t],a=!0,l=null,c=null;t.$on("hook:destroyed",(function(){return k(r,t)}));var d=function(n){for(var e=0,t=r.length;e<t;e++)r[e].$forceUpdate();n&&(r.length=0,null!==l&&(clearTimeout(l),l=null),null!==c&&(clearTimeout(c),c=null))},u=L((function(t){n.resolved=Ee(t,e),a?r.length=0:d(!0)})),m=L((function(e){s(n.errorComp)&&(n.error=!0,d(!0))})),f=n(u,m);return p(f)&&(g(f)?o(n.resolved)&&f.then(u,m):g(f.component)&&(f.component.then(u,m),s(f.error)&&(n.errorComp=Ee(f.error,e)),s(f.loading)&&(n.loadingComp=Ee(f.loading,e),0===f.delay?n.loading=!0:l=setTimeout((function(){l=null,o(n.resolved)&&o(n.error)&&(n.loading=!0,d(!1))}),f.delay||200)),s(f.timeout)&&(c=setTimeout((function(){c=null,o(n.resolved)&&m(null)}),f.timeout)))),a=!1,n.loading?n.loadingComp:n.resolved}}(u=n,d)))return function(n,e,t,r,a){var o=gn();return o.asyncFactory=n,o.asyncMeta={data:e,context:t,children:r,tag:a},o}(u,e,t,l,c);e=e||{},Gt(n),s(e.model)&&function(n,e){var t=n.model&&n.model.prop||"value",r=n.model&&n.model.event||"input";(e.attrs||(e.attrs={}))[t]=e.model.value;var o=e.on||(e.on={}),i=o[r],l=e.model.callback;s(i)?(a(i)?-1===i.indexOf(l):i!==l)&&(o[r]=[l].concat(i)):o[r]=l}(n.options,e);var m=function(n,e,t){var r=e.options.props;if(!o(r)){var a={},i=n.attrs,l=n.props;if(s(i)||s(l))for(var c in r){var p=C(c);Zn(a,l,c,p,!0)||Zn(a,i,c,p,!1)}return a}}(e,n);if(i(n.options.functional))return function(n,e,t,o,i){var l=n.options,c={},p=l.props;if(s(p))for(var d in p)c[d]=Pt(d,p,e||r);else s(t.attrs)&&vt(c,t.attrs),s(t.props)&&vt(c,t.props);var u=new gt(t,c,i,o,n),m=l.render.call(null,u._c,u);if(m instanceof fn)return ht(m,t,u.parent,l,u);if(a(m)){for(var f=Wn(m)||[],g=new Array(f.length),h=0;h<f.length;h++)g[h]=ht(f[h],t,u.parent,l,u);return g}}(n,m,e,t,l);var f=e.on;if(e.on=e.nativeOn,i(n.options.abstract)){var h=e.slot;e={},h&&(e.slot=h)}!function(n){for(var e=n.hook||(n.hook={}),t=0;t<_t.length;t++){var r=_t[t],a=e[r],o=yt[r];a===o||a&&a._merged||(e[r]=a?wt(o,a):o)}}(e);var v=bt(n.options)||c;return new fn("vue-component-".concat(n.cid).concat(v?"-".concat(v):""),e,void 0,void 0,void 0,t,{Ctor:n,propsData:m,listeners:f,tag:c,children:l},u)}}}function wt(n,e){var t=function(t,r){n(t,r),e(t,r)};return t._merged=!0,t}var xt=q,Et=V.optionMergeStrategies;function jt(n,e,t){if(void 0===t&&(t=!0),!e)return n;for(var r,a,o,s=dn?Reflect.ownKeys(e):Object.keys(e),i=0;i<s.length;i++)"__ob__"!==(r=s[i])&&(a=n[r],o=e[r],t&&x(n,r)?a!==o&&u(a)&&u(o)&&jt(a,o):qn(n,r,o));return n}function At(n,e,t){return t?function(){var r=c(e)?e.call(t,t):e,a=c(n)?n.call(t,t):n;return r?jt(r,a):a}:e?n?function(){return jt(c(e)?e.call(this,this):e,c(n)?n.call(this,this):n)}:e:n}function Tt(n,e){var t=e?n?n.concat(e):a(e)?e:[e]:n;return t?function(n){for(var e=[],t=0;t<n.length;t++)-1===e.indexOf(n[t])&&e.push(n[t]);return e}(t):t}function St(n,e,t,r){var a=Object.create(n||null);return e?P(a,e):a}Et.data=function(n,e,t){return t?At(n,e,t):e&&"function"!=typeof e?n:At(n,e)},U.forEach((function(n){Et[n]=Tt})),M.forEach((function(n){Et[n+"s"]=St})),Et.watch=function(n,e,t,r){if(n===rn&&(n=void 0),e===rn&&(e=void 0),!e)return Object.create(n||null);if(!n)return e;var o={};for(var s in P(o,n),e){var i=o[s],l=e[s];i&&!a(i)&&(i=[i]),o[s]=i?i.concat(l):a(l)?l:[l]}return o},Et.props=Et.methods=Et.inject=Et.computed=function(n,e,t,r){if(!n)return e;var a=Object.create(null);return P(a,n),e&&P(a,e),a},Et.provide=function(n,e){return n?function(){var t=Object.create(null);return jt(t,c(n)?n.call(this):n),e&&jt(t,c(e)?e.call(this):e,!1),t}:e};var Ct=function(n,e){return void 0===e?n:e};function Bt(n,e,t){if(c(e)&&(e=e.options),function(n,e){var t=n.props;if(t){var r,o,s={};if(a(t))for(r=t.length;r--;)"string"==typeof(o=t[r])&&(s[A(o)]={type:null});else if(u(t))for(var i in t)o=t[i],s[A(i)]=u(o)?o:{type:o};else 0;n.props=s}}(e),function(n,e){var t=n.inject;if(t){var r=n.inject={};if(a(t))for(var o=0;o<t.length;o++)r[t[o]]={from:t[o]};else if(u(t))for(var s in t){var i=t[s];r[s]=u(i)?P({from:s},i):{from:i}}else 0}}(e),function(n){var e=n.directives;if(e)for(var t in e){var r=e[t];c(r)&&(e[t]={bind:r,update:r})}}(e),!e._base&&(e.extends&&(n=Bt(n,e.extends,t)),e.mixins))for(var r=0,o=e.mixins.length;r<o;r++)n=Bt(n,e.mixins[r],t);var s,i={};for(s in n)l(s);for(s in e)x(n,s)||l(s);function l(r){var a=Et[r]||Ct;i[r]=a(n[r],e[r],t,r)}return i}function zt(n,e,t,r){if("string"==typeof t){var a=n[e];if(x(a,t))return a[t];var o=A(t);if(x(a,o))return a[o];var s=T(o);return x(a,s)?a[s]:a[t]||a[o]||a[s]}}function Pt(n,e,t,r){var a=e[n],o=!x(t,n),s=t[n],i=Dt(Boolean,a.type);if(i>-1)if(o&&!x(a,"default"))s=!1;else if(""===s||s===C(n)){var l=Dt(String,a.type);(l<0||i<l)&&(s=!0)}if(void 0===s){s=function(n,e,t){if(!x(e,"default"))return;var r=e.default;0;if(n&&n.$options.propsData&&void 0===n.$options.propsData[t]&&void 0!==n._props[t])return n._props[t];return c(r)&&"Function"!==qt(e.type)?r.call(n):r}(r,a,n);var p=Sn;Cn(!0),Pn(s),Cn(p)}return s}var It=/^\s*function (\w+)/;function qt(n){var e=n&&n.toString().match(It);return e?e[1]:""}function Nt(n,e){return qt(n)===qt(e)}function Dt(n,e){if(!a(e))return Nt(e,n)?0:-1;for(var t=0,r=e.length;t<r;t++)if(Nt(e[t],n))return t;return-1}var Ft={enumerable:!0,configurable:!0,get:q,set:q};function Ot(n,e,t){Ft.get=function(){return this[e][t]},Ft.set=function(n){this[e][t]=n},Object.defineProperty(n,t,Ft)}function Lt(n){var e=n.$options;if(e.props&&function(n,e){var t=n.$options.propsData||{},r=n._props=Fn({}),a=n.$options._propKeys=[];n.$parent&&Cn(!1);var o=function(o){a.push(o);var s=Pt(o,e,t,n);In(r,o,s,void 0,!0),o in n||Ot(n,"_props",o)};for(var s in e)o(s);Cn(!0)}(n,e.props),function(n){var e=n.$options,t=e.setup;if(t){var r=n._setupContext=ye(n);mn(n),wn();var a=Se(t,null,[n._props||Fn({}),r],n,"setup");if(xn(),mn(),c(a))e.render=a;else if(p(a))if(n._setupState=a,a.__sfc){var o=n._setupProxy={};for(var s in a)"__sfc"!==s&&Mn(o,a,s)}else for(var s in a)H(s)||Mn(n,a,s);else 0}}(n),e.methods&&function(n,e){n.$options.props;for(var t in e)n[t]="function"!=typeof e[t]?q:B(e[t],n)}(n,e.methods),e.data)!function(n){var e=n.$options.data;u(e=n._data=c(e)?function(n,e){wn();try{return n.call(e,e)}catch(n){return Te(n,e,"data()"),{}}finally{xn()}}(e,n):e||{})||(e={});var t=Object.keys(e),r=n.$options.props,a=(n.$options.methods,t.length);for(;a--;){var o=t[a];0,r&&x(r,o)||H(o)||Ot(n,"_data",o)}var s=Pn(e);s&&s.vmCount++}(n);else{var t=Pn(n._data={});t&&t.vmCount++}e.computed&&function(n,e){var t=n._computedWatchers=Object.create(null),r=sn();for(var a in e){var o=e[a],s=c(o)?o:o.get;0,r||(t[a]=new Ge(n,s||q,q,Rt)),a in n||Mt(n,a,o)}}(n,e.computed),e.watch&&e.watch!==rn&&function(n,e){for(var t in e){var r=e[t];if(a(r))for(var o=0;o<r.length;o++)Jt(n,t,r[o]);else Jt(n,t,r)}}(n,e.watch)}var Rt={lazy:!0};function Mt(n,e,t){var r=!sn();c(t)?(Ft.get=r?Ut(e):Vt(t),Ft.set=q):(Ft.get=t.get?r&&!1!==t.cache?Ut(e):Vt(t.get):q,Ft.set=t.set||q),Object.defineProperty(n,e,Ft)}function Ut(n){return function(){var e=this._computedWatchers&&this._computedWatchers[n];if(e)return e.dirty&&e.evaluate(),_n.target&&e.depend(),e.value}}function Vt(n){return function(){return n.call(this,this)}}function Jt(n,e,t,r){return u(t)&&(r=t,t=t.handler),"string"==typeof t&&(t=n[t]),n.$watch(e,t,r)}var Ht=0;function Gt(n){var e=n.options;if(n.super){var t=Gt(n.super);if(t!==n.superOptions){n.superOptions=t;var r=function(n){var e,t=n.options,r=n.sealedOptions;for(var a in t)t[a]!==r[a]&&(e||(e={}),e[a]=t[a]);return e}(n);r&&P(n.extendOptions,r),(e=n.options=Bt(t,n.extendOptions)).name&&(e.components[e.name]=n)}}return e}function $t(n){this._init(n)}function Kt(n){n.cid=0;var e=1;n.extend=function(n){n=n||{};var t=this,r=t.cid,a=n._Ctor||(n._Ctor={});if(a[r])return a[r];var o=bt(n)||bt(t.options);var s=function(n){this._init(n)};return(s.prototype=Object.create(t.prototype)).constructor=s,s.cid=e++,s.options=Bt(t.options,n),s.super=t,s.options.props&&function(n){var e=n.options.props;for(var t in e)Ot(n.prototype,"_props",t)}(s),s.options.computed&&function(n){var e=n.options.computed;for(var t in e)Mt(n.prototype,t,e[t])}(s),s.extend=t.extend,s.mixin=t.mixin,s.use=t.use,M.forEach((function(n){s[n]=t[n]})),o&&(s.options.components[o]=s),s.superOptions=t.options,s.extendOptions=n,s.sealedOptions=P({},s.options),a[r]=s,s}}function Zt(n){return n&&(bt(n.Ctor.options)||n.tag)}function Wt(n,e){return a(n)?n.indexOf(e)>-1:"string"==typeof n?n.split(",").indexOf(e)>-1:!!m(n)&&n.test(e)}function Xt(n,e){var t=n.cache,r=n.keys,a=n._vnode,o=n.$vnode;for(var s in t){var i=t[s];if(i){var l=i.name;l&&!e(l)&&Qt(t,s,r,a)}}o.componentOptions.children=void 0}function Qt(n,e,t,r){var a=n[e];!a||r&&a.tag===r.tag||a.componentInstance.$destroy(),n[e]=null,k(t,e)}!function(n){n.prototype._init=function(n){var e=this;e._uid=Ht++,e._isVue=!0,e.__v_skip=!0,e._scope=new Vn(!0),e._scope.parent=void 0,e._scope._vm=!0,n&&n._isComponent?function(n,e){var t=n.$options=Object.create(n.constructor.options),r=e._parentVnode;t.parent=e.parent,t._parentVnode=r;var a=r.componentOptions;t.propsData=a.propsData,t._parentListeners=a.listeners,t._renderChildren=a.children,t._componentTag=a.tag,e.render&&(t.render=e.render,t.staticRenderFns=e.staticRenderFns)}(e,n):e.$options=Bt(Gt(e.constructor),n||{},e),e._renderProxy=e,e._self=e,function(n){var e=n.$options,t=e.parent;if(t&&!e.abstract){for(;t.$options.abstract&&t.$parent;)t=t.$parent;t.$children.push(n)}n.$parent=t,n.$root=t?t.$root:n,n.$children=[],n.$refs={},n._provided=t?t._provided:Object.create(null),n._watcher=null,n._inactive=null,n._directInactive=!1,n._isMounted=!1,n._isDestroyed=!1,n._isBeingDestroyed=!1}(e),function(n){n._events=Object.create(null),n._hasHookEvent=!1;var e=n.$options._parentListeners;e&&We(n,e)}(e),function(n){n._vnode=null,n._staticTrees=null;var e=n.$options,t=n.$vnode=e._parentVnode,a=t&&t.context;n.$slots=me(e._renderChildren,a),n.$scopedSlots=t?he(n.$parent,t.data.scopedSlots,n.$slots):r,n._c=function(e,t,r,a){return Ae(n,e,t,r,a,!1)},n.$createElement=function(e,t,r,a){return Ae(n,e,t,r,a,!0)};var o=t&&t.data;In(n,"$attrs",o&&o.attrs||r,null,!0),In(n,"$listeners",e._parentListeners||r,null,!0)}(e),et(e,"beforeCreate",void 0,!1),function(n){var e=ft(n.$options.inject,n);e&&(Cn(!1),Object.keys(e).forEach((function(t){In(n,t,e[t])})),Cn(!0))}(e),Lt(e),function(n){var e=n.$options.provide;if(e){var t=c(e)?e.call(n):e;if(!p(t))return;for(var r=Jn(n),a=dn?Reflect.ownKeys(t):Object.keys(t),o=0;o<a.length;o++){var s=a[o];Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(t,s))}}}(e),et(e,"created"),e.$options.el&&e.$mount(e.$options.el)}}($t),function(n){var e={get:function(){return this._data}},t={get:function(){return this._props}};Object.defineProperty(n.prototype,"$data",e),Object.defineProperty(n.prototype,"$props",t),n.prototype.$set=qn,n.prototype.$delete=Nn,n.prototype.$watch=function(n,e,t){if(u(e))return Jt(this,n,e,t);(t=t||{}).user=!0;var r=new Ge(this,n,e,t);if(t.immediate){var a='callback for immediate watcher "'.concat(r.expression,'"');wn(),Se(e,this,[r.value],this,a),xn()}return function(){r.teardown()}}}($t),function(n){var e=/^hook:/;n.prototype.$on=function(n,t){var r=this;if(a(n))for(var o=0,s=n.length;o<s;o++)r.$on(n[o],t);else(r._events[n]||(r._events[n]=[])).push(t),e.test(n)&&(r._hasHookEvent=!0);return r},n.prototype.$once=function(n,e){var t=this;function r(){t.$off(n,r),e.apply(t,arguments)}return r.fn=e,t.$on(n,r),t},n.prototype.$off=function(n,e){var t=this;if(!arguments.length)return t._events=Object.create(null),t;if(a(n)){for(var r=0,o=n.length;r<o;r++)t.$off(n[r],e);return t}var s,i=t._events[n];if(!i)return t;if(!e)return t._events[n]=null,t;for(var l=i.length;l--;)if((s=i[l])===e||s.fn===e){i.splice(l,1);break}return t},n.prototype.$emit=function(n){var e=this,t=e._events[n];if(t){t=t.length>1?z(t):t;for(var r=z(arguments,1),a='event handler for "'.concat(n,'"'),o=0,s=t.length;o<s;o++)Se(t[o],e,r,e,a)}return e}}($t),function(n){n.prototype._update=function(n,e){var t=this,r=t.$el,a=t._vnode,o=Qe(t);t._vnode=n,t.$el=a?t.__patch__(a,n):t.__patch__(t.$el,n,e,!1),o(),r&&(r.__vue__=null),t.$el&&(t.$el.__vue__=t);for(var s=t;s&&s.$vnode&&s.$parent&&s.$vnode===s.$parent._vnode;)s.$parent.$el=s.$el,s=s.$parent},n.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},n.prototype.$destroy=function(){var n=this;if(!n._isBeingDestroyed){et(n,"beforeDestroy"),n._isBeingDestroyed=!0;var e=n.$parent;!e||e._isBeingDestroyed||n.$options.abstract||k(e.$children,n),n._scope.stop(),n._data.__ob__&&n._data.__ob__.vmCount--,n._isDestroyed=!0,n.__patch__(n._vnode,null),et(n,"destroyed"),n.$off(),n.$el&&(n.$el.__vue__=null),n.$vnode&&(n.$vnode.parent=null)}}}($t),function(n){ue(n.prototype),n.prototype.$nextTick=function(n){return Re(n,this)},n.prototype._render=function(){var n=this,e=n.$options,t=e.render,r=e._parentVnode;r&&n._isMounted&&(n.$scopedSlots=he(n.$parent,r.data.scopedSlots,n.$slots,n.$scopedSlots),n._slotsProxy&&we(n._slotsProxy,n.$scopedSlots)),n.$vnode=r;var o,s=un,i=xe;try{mn(n),xe=n,o=t.call(n._renderProxy,n.$createElement)}catch(e){Te(e,n,"render"),o=n._vnode}finally{xe=i,mn(s)}return a(o)&&1===o.length&&(o=o[0]),o instanceof fn||(o=gn()),o.parent=r,o}}($t);var Yt=[String,RegExp,Array],nr={KeepAlive:{name:"keep-alive",abstract:!0,props:{include:Yt,exclude:Yt,max:[String,Number]},methods:{cacheVNode:function(){var n=this.cache,e=this.keys,t=this.vnodeToCache,r=this.keyToCache;if(t){var a=t.tag,o=t.componentInstance,s=t.componentOptions;n[r]={name:Zt(s),tag:a,componentInstance:o},e.push(r),this.max&&e.length>parseInt(this.max)&&Qt(n,e[0],e,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var n in this.cache)Qt(this.cache,n,this.keys)},mounted:function(){var n=this;this.cacheVNode(),this.$watch("include",(function(e){Xt(n,(function(n){return Wt(e,n)}))})),this.$watch("exclude",(function(e){Xt(n,(function(n){return!Wt(e,n)}))}))},updated:function(){this.cacheVNode()},render:function(){var n=this.$slots.default,e=je(n),t=e&&e.componentOptions;if(t){var r=Zt(t),a=this.include,o=this.exclude;if(a&&(!r||!Wt(a,r))||o&&r&&Wt(o,r))return e;var s=this.cache,i=this.keys,l=null==e.key?t.Ctor.cid+(t.tag?"::".concat(t.tag):""):e.key;s[l]?(e.componentInstance=s[l].componentInstance,k(i,l),i.push(l)):(this.vnodeToCache=e,this.keyToCache=l),e.data.keepAlive=!0}return e||n&&n[0]}}};!function(n){var e={get:function(){return V}};Object.defineProperty(n,"config",e),n.util={warn:xt,extend:P,mergeOptions:Bt,defineReactive:In},n.set=qn,n.delete=Nn,n.nextTick=Re,n.observable=function(n){return Pn(n),n},n.options=Object.create(null),M.forEach((function(e){n.options[e+"s"]=Object.create(null)})),n.options._base=n,P(n.options.components,nr),function(n){n.use=function(n){var e=this._installedPlugins||(this._installedPlugins=[]);if(e.indexOf(n)>-1)return this;var t=z(arguments,1);return t.unshift(this),c(n.install)?n.install.apply(n,t):c(n)&&n.apply(null,t),e.push(n),this}}(n),function(n){n.mixin=function(n){return this.options=Bt(this.options,n),this}}(n),Kt(n),function(n){M.forEach((function(e){n[e]=function(n,t){return t?("component"===e&&u(t)&&(t.name=t.name||n,t=this.options._base.extend(t)),"directive"===e&&c(t)&&(t={bind:t,update:t}),this.options[e+"s"][n]=t,t):this.options[e+"s"][n]}}))}(n)}($t),Object.defineProperty($t.prototype,"$isServer",{get:sn}),Object.defineProperty($t.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty($t,"FunctionalRenderContext",{value:gt}),$t.version="2.7.16";var er=y("style,class"),tr=y("input,textarea,option,select,progress"),rr=y("contenteditable,draggable,spellcheck"),ar=y("events,caret,typing,plaintext-only"),or=y("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),sr="http://www.w3.org/1999/xlink",ir=function(n){return":"===n.charAt(5)&&"xlink"===n.slice(0,5)},lr=function(n){return ir(n)?n.slice(6,n.length):""},cr=function(n){return null==n||!1===n};function pr(n){for(var e=n.data,t=n,r=n;s(r.componentInstance);)(r=r.componentInstance._vnode)&&r.data&&(e=dr(r.data,e));for(;s(t=t.parent);)t&&t.data&&(e=dr(e,t.data));return function(n,e){if(s(n)||s(e))return ur(n,mr(e));return""}(e.staticClass,e.class)}function dr(n,e){return{staticClass:ur(n.staticClass,e.staticClass),class:s(n.class)?[n.class,e.class]:e.class}}function ur(n,e){return n?e?n+" "+e:n:e||""}function mr(n){return Array.isArray(n)?function(n){for(var e,t="",r=0,a=n.length;r<a;r++)s(e=mr(n[r]))&&""!==e&&(t&&(t+=" "),t+=e);return t}(n):p(n)?function(n){var e="";for(var t in n)n[t]&&(e&&(e+=" "),e+=t);return e}(n):"string"==typeof n?n:""}var fr={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},gr=y("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),hr=y("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),vr=function(n){return gr(n)||hr(n)};var br=Object.create(null);var yr=y("text,number,password,search,email,tel,url");var _r=Object.freeze({__proto__:null,createElement:function(n,e){var t=document.createElement(n);return"select"!==n||e.data&&e.data.attrs&&void 0!==e.data.attrs.multiple&&t.setAttribute("multiple","multiple"),t},createElementNS:function(n,e){return document.createElementNS(fr[n],e)},createTextNode:function(n){return document.createTextNode(n)},createComment:function(n){return document.createComment(n)},insertBefore:function(n,e,t){n.insertBefore(e,t)},removeChild:function(n,e){n.removeChild(e)},appendChild:function(n,e){n.appendChild(e)},parentNode:function(n){return n.parentNode},nextSibling:function(n){return n.nextSibling},tagName:function(n){return n.tagName},setTextContent:function(n,e){n.textContent=e},setStyleScope:function(n,e){n.setAttribute(e,"")}}),kr={create:function(n,e){wr(e)},update:function(n,e){n.data.ref!==e.data.ref&&(wr(n,!0),wr(e))},destroy:function(n){wr(n,!0)}};function wr(n,e){var t=n.data.ref;if(s(t)){var r=n.context,o=n.componentInstance||n.elm,i=e?null:o,l=e?void 0:o;if(c(t))Se(t,r,[i],r,"template ref function");else{var p=n.data.refInFor,d="string"==typeof t||"number"==typeof t,u=Rn(t),m=r.$refs;if(d||u)if(p){var f=d?m[t]:t.value;e?a(f)&&k(f,o):a(f)?f.includes(o)||f.push(o):d?(m[t]=[o],xr(r,t,m[t])):t.value=[o]}else if(d){if(e&&m[t]!==o)return;m[t]=l,xr(r,t,i)}else if(u){if(e&&t.value!==o)return;t.value=i}else 0}}}function xr(n,e,t){var r=n._setupState;r&&x(r,e)&&(Rn(r[e])?r[e].value=t:r[e]=t)}var Er=new fn("",{},[]),jr=["create","activate","update","remove","destroy"];function Ar(n,e){return n.key===e.key&&n.asyncFactory===e.asyncFactory&&(n.tag===e.tag&&n.isComment===e.isComment&&s(n.data)===s(e.data)&&function(n,e){if("input"!==n.tag)return!0;var t,r=s(t=n.data)&&s(t=t.attrs)&&t.type,a=s(t=e.data)&&s(t=t.attrs)&&t.type;return r===a||yr(r)&&yr(a)}(n,e)||i(n.isAsyncPlaceholder)&&o(e.asyncFactory.error))}function Tr(n,e,t){var r,a,o={};for(r=e;r<=t;++r)s(a=n[r].key)&&(o[a]=r);return o}var Sr={create:Cr,update:Cr,destroy:function(n){Cr(n,Er)}};function Cr(n,e){(n.data.directives||e.data.directives)&&function(n,e){var t,r,a,o=n===Er,s=e===Er,i=zr(n.data.directives,n.context),l=zr(e.data.directives,e.context),c=[],p=[];for(t in l)r=i[t],a=l[t],r?(a.oldValue=r.value,a.oldArg=r.arg,Ir(a,"update",e,n),a.def&&a.def.componentUpdated&&p.push(a)):(Ir(a,"bind",e,n),a.def&&a.def.inserted&&c.push(a));if(c.length){var d=function(){for(var t=0;t<c.length;t++)Ir(c[t],"inserted",e,n)};o?Kn(e,"insert",d):d()}p.length&&Kn(e,"postpatch",(function(){for(var t=0;t<p.length;t++)Ir(p[t],"componentUpdated",e,n)}));if(!o)for(t in i)l[t]||Ir(i[t],"unbind",n,n,s)}(n,e)}var Br=Object.create(null);function zr(n,e){var t,r,a=Object.create(null);if(!n)return a;for(t=0;t<n.length;t++){if((r=n[t]).modifiers||(r.modifiers=Br),a[Pr(r)]=r,e._setupState&&e._setupState.__sfc){var o=r.def||zt(e,"_setupState","v-"+r.name);r.def="function"==typeof o?{bind:o,update:o}:o}r.def=r.def||zt(e.$options,"directives",r.name)}return a}function Pr(n){return n.rawName||"".concat(n.name,".").concat(Object.keys(n.modifiers||{}).join("."))}function Ir(n,e,t,r,a){var o=n.def&&n.def[e];if(o)try{o(t.elm,n,t,r,a)}catch(r){Te(r,t.context,"directive ".concat(n.name," ").concat(e," hook"))}}var qr=[kr,Sr];function Nr(n,e){var t=e.componentOptions;if(!(s(t)&&!1===t.Ctor.options.inheritAttrs||o(n.data.attrs)&&o(e.data.attrs))){var r,a,l=e.elm,c=n.data.attrs||{},p=e.data.attrs||{};for(r in(s(p.__ob__)||i(p._v_attr_proxy))&&(p=e.data.attrs=P({},p)),p)a=p[r],c[r]!==a&&Dr(l,r,a,e.data.pre);for(r in(X||Y)&&p.value!==c.value&&Dr(l,"value",p.value),c)o(p[r])&&(ir(r)?l.removeAttributeNS(sr,lr(r)):rr(r)||l.removeAttribute(r))}}function Dr(n,e,t,r){r||n.tagName.indexOf("-")>-1?Fr(n,e,t):or(e)?cr(t)?n.removeAttribute(e):(t="allowfullscreen"===e&&"EMBED"===n.tagName?"true":e,n.setAttribute(e,t)):rr(e)?n.setAttribute(e,function(n,e){return cr(e)||"false"===e?"false":"contenteditable"===n&&ar(e)?e:"true"}(e,t)):ir(e)?cr(t)?n.removeAttributeNS(sr,lr(e)):n.setAttributeNS(sr,e,t):Fr(n,e,t)}function Fr(n,e,t){if(cr(t))n.removeAttribute(e);else{if(X&&!Q&&"TEXTAREA"===n.tagName&&"placeholder"===e&&""!==t&&!n.__ieph){var r=function(e){e.stopImmediatePropagation(),n.removeEventListener("input",r)};n.addEventListener("input",r),n.__ieph=!0}n.setAttribute(e,t)}}var Or={create:Nr,update:Nr};function Lr(n,e){var t=e.elm,r=e.data,a=n.data;if(!(o(r.staticClass)&&o(r.class)&&(o(a)||o(a.staticClass)&&o(a.class)))){var i=pr(e),l=t._transitionClasses;s(l)&&(i=ur(i,mr(l))),i!==t._prevClass&&(t.setAttribute("class",i),t._prevClass=i)}}var Rr,Mr={create:Lr,update:Lr};function Ur(n,e,t){var r=Rr;return function a(){var o=e.apply(null,arguments);null!==o&&Hr(n,a,t,r)}}var Vr=Pe&&!(tn&&Number(tn[1])<=53);function Jr(n,e,t,r){if(Vr){var a=lt,o=e;e=o._wrapper=function(n){if(n.target===n.currentTarget||n.timeStamp>=a||n.timeStamp<=0||n.target.ownerDocument!==document)return o.apply(this,arguments)}}Rr.addEventListener(n,e,an?{capture:t,passive:r}:t)}function Hr(n,e,t,r){(r||Rr).removeEventListener(n,e._wrapper||e,t)}function Gr(n,e){if(!o(n.data.on)||!o(e.data.on)){var t=e.data.on||{},r=n.data.on||{};Rr=e.elm||n.elm,function(n){if(s(n.__r)){var e=X?"change":"input";n[e]=[].concat(n.__r,n[e]||[]),delete n.__r}s(n.__c)&&(n.change=[].concat(n.__c,n.change||[]),delete n.__c)}(t),$n(t,r,Jr,Hr,Ur,e.context),Rr=void 0}}var $r,Kr={create:Gr,update:Gr,destroy:function(n){return Gr(n,Er)}};function Zr(n,e){if(!o(n.data.domProps)||!o(e.data.domProps)){var t,r,a=e.elm,l=n.data.domProps||{},c=e.data.domProps||{};for(t in(s(c.__ob__)||i(c._v_attr_proxy))&&(c=e.data.domProps=P({},c)),l)t in c||(a[t]="");for(t in c){if(r=c[t],"textContent"===t||"innerHTML"===t){if(e.children&&(e.children.length=0),r===l[t])continue;1===a.childNodes.length&&a.removeChild(a.childNodes[0])}if("value"===t&&"PROGRESS"!==a.tagName){a._value=r;var p=o(r)?"":String(r);Wr(a,p)&&(a.value=p)}else if("innerHTML"===t&&hr(a.tagName)&&o(a.innerHTML)){($r=$r||document.createElement("div")).innerHTML="<svg>".concat(r,"</svg>");for(var d=$r.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;d.firstChild;)a.appendChild(d.firstChild)}else if(r!==l[t])try{a[t]=r}catch(n){}}}}function Wr(n,e){return!n.composing&&("OPTION"===n.tagName||function(n,e){var t=!0;try{t=document.activeElement!==n}catch(n){}return t&&n.value!==e}(n,e)||function(n,e){var t=n.value,r=n._vModifiers;if(s(r)){if(r.number)return b(t)!==b(e);if(r.trim)return t.trim()!==e.trim()}return t!==e}(n,e))}var Xr={create:Zr,update:Zr},Qr=E((function(n){var e={},t=/:(.+)/;return n.split(/;(?![^(]*\))/g).forEach((function(n){if(n){var r=n.split(t);r.length>1&&(e[r[0].trim()]=r[1].trim())}})),e}));function Yr(n){var e=na(n.style);return n.staticStyle?P(n.staticStyle,e):e}function na(n){return Array.isArray(n)?I(n):"string"==typeof n?Qr(n):n}var ea,ta=/^--/,ra=/\s*!important$/,aa=function(n,e,t){if(ta.test(e))n.style.setProperty(e,t);else if(ra.test(t))n.style.setProperty(C(e),t.replace(ra,""),"important");else{var r=sa(e);if(Array.isArray(t))for(var a=0,o=t.length;a<o;a++)n.style[r]=t[a];else n.style[r]=t}},oa=["Webkit","Moz","ms"],sa=E((function(n){if(ea=ea||document.createElement("div").style,"filter"!==(n=A(n))&&n in ea)return n;for(var e=n.charAt(0).toUpperCase()+n.slice(1),t=0;t<oa.length;t++){var r=oa[t]+e;if(r in ea)return r}}));function ia(n,e){var t=e.data,r=n.data;if(!(o(t.staticStyle)&&o(t.style)&&o(r.staticStyle)&&o(r.style))){var a,i,l=e.elm,c=r.staticStyle,p=r.normalizedStyle||r.style||{},d=c||p,u=na(e.data.style)||{};e.data.normalizedStyle=s(u.__ob__)?P({},u):u;var m=function(n,e){var t,r={};if(e)for(var a=n;a.componentInstance;)(a=a.componentInstance._vnode)&&a.data&&(t=Yr(a.data))&&P(r,t);(t=Yr(n.data))&&P(r,t);for(var o=n;o=o.parent;)o.data&&(t=Yr(o.data))&&P(r,t);return r}(e,!0);for(i in d)o(m[i])&&aa(l,i,"");for(i in m)a=m[i],aa(l,i,null==a?"":a)}}var la={create:ia,update:ia},ca=/\s+/;function pa(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(ca).forEach((function(e){return n.classList.add(e)})):n.classList.add(e);else{var t=" ".concat(n.getAttribute("class")||""," ");t.indexOf(" "+e+" ")<0&&n.setAttribute("class",(t+e).trim())}}function da(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(ca).forEach((function(e){return n.classList.remove(e)})):n.classList.remove(e),n.classList.length||n.removeAttribute("class");else{for(var t=" ".concat(n.getAttribute("class")||""," "),r=" "+e+" ";t.indexOf(r)>=0;)t=t.replace(r," ");(t=t.trim())?n.setAttribute("class",t):n.removeAttribute("class")}}function ua(n){if(n){if("object"==typeof n){var e={};return!1!==n.css&&P(e,ma(n.name||"v")),P(e,n),e}return"string"==typeof n?ma(n):void 0}}var ma=E((function(n){return{enterClass:"".concat(n,"-enter"),enterToClass:"".concat(n,"-enter-to"),enterActiveClass:"".concat(n,"-enter-active"),leaveClass:"".concat(n,"-leave"),leaveToClass:"".concat(n,"-leave-to"),leaveActiveClass:"".concat(n,"-leave-active")}})),fa=Z&&!Q,ga="transition",ha="transitionend",va="animation",ba="animationend";fa&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(ga="WebkitTransition",ha="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(va="WebkitAnimation",ba="webkitAnimationEnd"));var ya=Z?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(n){return n()};function _a(n){ya((function(){ya(n)}))}function ka(n,e){var t=n._transitionClasses||(n._transitionClasses=[]);t.indexOf(e)<0&&(t.push(e),pa(n,e))}function wa(n,e){n._transitionClasses&&k(n._transitionClasses,e),da(n,e)}function xa(n,e,t){var r=ja(n,e),a=r.type,o=r.timeout,s=r.propCount;if(!a)return t();var i="transition"===a?ha:ba,l=0,c=function(){n.removeEventListener(i,p),t()},p=function(e){e.target===n&&++l>=s&&c()};setTimeout((function(){l<s&&c()}),o+1),n.addEventListener(i,p)}var Ea=/\b(transform|all)(,|$)/;function ja(n,e){var t,r=window.getComputedStyle(n),a=(r[ga+"Delay"]||"").split(", "),o=(r[ga+"Duration"]||"").split(", "),s=Aa(a,o),i=(r[va+"Delay"]||"").split(", "),l=(r[va+"Duration"]||"").split(", "),c=Aa(i,l),p=0,d=0;return"transition"===e?s>0&&(t="transition",p=s,d=o.length):"animation"===e?c>0&&(t="animation",p=c,d=l.length):d=(t=(p=Math.max(s,c))>0?s>c?"transition":"animation":null)?"transition"===t?o.length:l.length:0,{type:t,timeout:p,propCount:d,hasTransform:"transition"===t&&Ea.test(r[ga+"Property"])}}function Aa(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max.apply(null,e.map((function(e,t){return Ta(e)+Ta(n[t])})))}function Ta(n){return 1e3*Number(n.slice(0,-1).replace(",","."))}function Sa(n,e){var t=n.elm;s(t._leaveCb)&&(t._leaveCb.cancelled=!0,t._leaveCb());var r=ua(n.data.transition);if(!o(r)&&!s(t._enterCb)&&1===t.nodeType){for(var a=r.css,i=r.type,l=r.enterClass,d=r.enterToClass,u=r.enterActiveClass,m=r.appearClass,f=r.appearToClass,g=r.appearActiveClass,h=r.beforeEnter,v=r.enter,y=r.afterEnter,_=r.enterCancelled,k=r.beforeAppear,w=r.appear,x=r.afterAppear,E=r.appearCancelled,j=r.duration,A=Xe,T=Xe.$vnode;T&&T.parent;)A=T.context,T=T.parent;var S=!A._isMounted||!n.isRootInsert;if(!S||w||""===w){var C=S&&m?m:l,B=S&&g?g:u,z=S&&f?f:d,P=S&&k||h,I=S&&c(w)?w:v,q=S&&x||y,N=S&&E||_,D=b(p(j)?j.enter:j);0;var F=!1!==a&&!Q,O=za(I),R=t._enterCb=L((function(){F&&(wa(t,z),wa(t,B)),R.cancelled?(F&&wa(t,C),N&&N(t)):q&&q(t),t._enterCb=null}));n.data.show||Kn(n,"insert",(function(){var e=t.parentNode,r=e&&e._pending&&e._pending[n.key];r&&r.tag===n.tag&&r.elm._leaveCb&&r.elm._leaveCb(),I&&I(t,R)})),P&&P(t),F&&(ka(t,C),ka(t,B),_a((function(){wa(t,C),R.cancelled||(ka(t,z),O||(Ba(D)?setTimeout(R,D):xa(t,i,R)))}))),n.data.show&&(e&&e(),I&&I(t,R)),F||O||R()}}}function Ca(n,e){var t=n.elm;s(t._enterCb)&&(t._enterCb.cancelled=!0,t._enterCb());var r=ua(n.data.transition);if(o(r)||1!==t.nodeType)return e();if(!s(t._leaveCb)){var a=r.css,i=r.type,l=r.leaveClass,c=r.leaveToClass,d=r.leaveActiveClass,u=r.beforeLeave,m=r.leave,f=r.afterLeave,g=r.leaveCancelled,h=r.delayLeave,v=r.duration,y=!1!==a&&!Q,_=za(m),k=b(p(v)?v.leave:v);0;var w=t._leaveCb=L((function(){t.parentNode&&t.parentNode._pending&&(t.parentNode._pending[n.key]=null),y&&(wa(t,c),wa(t,d)),w.cancelled?(y&&wa(t,l),g&&g(t)):(e(),f&&f(t)),t._leaveCb=null}));h?h(x):x()}function x(){w.cancelled||(!n.data.show&&t.parentNode&&((t.parentNode._pending||(t.parentNode._pending={}))[n.key]=n),u&&u(t),y&&(ka(t,l),ka(t,d),_a((function(){wa(t,l),w.cancelled||(ka(t,c),_||(Ba(k)?setTimeout(w,k):xa(t,i,w)))}))),m&&m(t,w),y||_||w())}}function Ba(n){return"number"==typeof n&&!isNaN(n)}function za(n){if(o(n))return!1;var e=n.fns;return s(e)?za(Array.isArray(e)?e[0]:e):(n._length||n.length)>1}function Pa(n,e){!0!==e.data.show&&Sa(e)}var Ia=function(n){var e,t,r={},c=n.modules,p=n.nodeOps;for(e=0;e<jr.length;++e)for(r[jr[e]]=[],t=0;t<c.length;++t)s(c[t][jr[e]])&&r[jr[e]].push(c[t][jr[e]]);function d(n){var e=p.parentNode(n);s(e)&&p.removeChild(e,n)}function u(n,e,t,a,o,l,c){if(s(n.elm)&&s(l)&&(n=l[c]=vn(n)),n.isRootInsert=!o,!function(n,e,t,a){var o=n.data;if(s(o)){var l=s(n.componentInstance)&&o.keepAlive;if(s(o=o.hook)&&s(o=o.init)&&o(n,!1),s(n.componentInstance))return m(n,e),f(t,n.elm,a),i(l)&&function(n,e,t,a){var o,i=n;for(;i.componentInstance;)if(i=i.componentInstance._vnode,s(o=i.data)&&s(o=o.transition)){for(o=0;o<r.activate.length;++o)r.activate[o](Er,i);e.push(i);break}f(t,n.elm,a)}(n,e,t,a),!0}}(n,e,t,a)){var d=n.data,u=n.children,h=n.tag;s(h)?(n.elm=n.ns?p.createElementNS(n.ns,h):p.createElement(h,n),b(n),g(n,u,e),s(d)&&v(n,e),f(t,n.elm,a)):i(n.isComment)?(n.elm=p.createComment(n.text),f(t,n.elm,a)):(n.elm=p.createTextNode(n.text),f(t,n.elm,a))}}function m(n,e){s(n.data.pendingInsert)&&(e.push.apply(e,n.data.pendingInsert),n.data.pendingInsert=null),n.elm=n.componentInstance.$el,h(n)?(v(n,e),b(n)):(wr(n),e.push(n))}function f(n,e,t){s(n)&&(s(t)?p.parentNode(t)===n&&p.insertBefore(n,e,t):p.appendChild(n,e))}function g(n,e,t){if(a(e)){0;for(var r=0;r<e.length;++r)u(e[r],t,n.elm,null,!0,e,r)}else l(n.text)&&p.appendChild(n.elm,p.createTextNode(String(n.text)))}function h(n){for(;n.componentInstance;)n=n.componentInstance._vnode;return s(n.tag)}function v(n,t){for(var a=0;a<r.create.length;++a)r.create[a](Er,n);s(e=n.data.hook)&&(s(e.create)&&e.create(Er,n),s(e.insert)&&t.push(n))}function b(n){var e;if(s(e=n.fnScopeId))p.setStyleScope(n.elm,e);else for(var t=n;t;)s(e=t.context)&&s(e=e.$options._scopeId)&&p.setStyleScope(n.elm,e),t=t.parent;s(e=Xe)&&e!==n.context&&e!==n.fnContext&&s(e=e.$options._scopeId)&&p.setStyleScope(n.elm,e)}function _(n,e,t,r,a,o){for(;r<=a;++r)u(t[r],o,n,e,!1,t,r)}function k(n){var e,t,a=n.data;if(s(a))for(s(e=a.hook)&&s(e=e.destroy)&&e(n),e=0;e<r.destroy.length;++e)r.destroy[e](n);if(s(e=n.children))for(t=0;t<n.children.length;++t)k(n.children[t])}function w(n,e,t){for(;e<=t;++e){var r=n[e];s(r)&&(s(r.tag)?(x(r),k(r)):d(r.elm))}}function x(n,e){if(s(e)||s(n.data)){var t,a=r.remove.length+1;for(s(e)?e.listeners+=a:e=function(n,e){function t(){0==--t.listeners&&d(n)}return t.listeners=e,t}(n.elm,a),s(t=n.componentInstance)&&s(t=t._vnode)&&s(t.data)&&x(t,e),t=0;t<r.remove.length;++t)r.remove[t](n,e);s(t=n.data.hook)&&s(t=t.remove)?t(n,e):e()}else d(n.elm)}function E(n,e,t,r){for(var a=t;a<r;a++){var o=e[a];if(s(o)&&Ar(n,o))return a}}function j(n,e,t,a,l,c){if(n!==e){s(e.elm)&&s(a)&&(e=a[l]=vn(e));var d=e.elm=n.elm;if(i(n.isAsyncPlaceholder))s(e.asyncFactory.resolved)?S(n.elm,e,t):e.isAsyncPlaceholder=!0;else if(i(e.isStatic)&&i(n.isStatic)&&e.key===n.key&&(i(e.isCloned)||i(e.isOnce)))e.componentInstance=n.componentInstance;else{var m,f=e.data;s(f)&&s(m=f.hook)&&s(m=m.prepatch)&&m(n,e);var g=n.children,v=e.children;if(s(f)&&h(e)){for(m=0;m<r.update.length;++m)r.update[m](n,e);s(m=f.hook)&&s(m=m.update)&&m(n,e)}o(e.text)?s(g)&&s(v)?g!==v&&function(n,e,t,r,a){var i,l,c,d=0,m=0,f=e.length-1,g=e[0],h=e[f],v=t.length-1,b=t[0],y=t[v],k=!a;for(0;d<=f&&m<=v;)o(g)?g=e[++d]:o(h)?h=e[--f]:Ar(g,b)?(j(g,b,r,t,m),g=e[++d],b=t[++m]):Ar(h,y)?(j(h,y,r,t,v),h=e[--f],y=t[--v]):Ar(g,y)?(j(g,y,r,t,v),k&&p.insertBefore(n,g.elm,p.nextSibling(h.elm)),g=e[++d],y=t[--v]):Ar(h,b)?(j(h,b,r,t,m),k&&p.insertBefore(n,h.elm,g.elm),h=e[--f],b=t[++m]):(o(i)&&(i=Tr(e,d,f)),o(l=s(b.key)?i[b.key]:E(b,e,d,f))?u(b,r,n,g.elm,!1,t,m):Ar(c=e[l],b)?(j(c,b,r,t,m),e[l]=void 0,k&&p.insertBefore(n,c.elm,g.elm)):u(b,r,n,g.elm,!1,t,m),b=t[++m]);d>f?_(n,o(t[v+1])?null:t[v+1].elm,t,m,v,r):m>v&&w(e,d,f)}(d,g,v,t,c):s(v)?(s(n.text)&&p.setTextContent(d,""),_(d,null,v,0,v.length-1,t)):s(g)?w(g,0,g.length-1):s(n.text)&&p.setTextContent(d,""):n.text!==e.text&&p.setTextContent(d,e.text),s(f)&&s(m=f.hook)&&s(m=m.postpatch)&&m(n,e)}}}function A(n,e,t){if(i(t)&&s(n.parent))n.parent.data.pendingInsert=e;else for(var r=0;r<e.length;++r)e[r].data.hook.insert(e[r])}var T=y("attrs,class,staticClass,staticStyle,key");function S(n,e,t,r){var a,o=e.tag,l=e.data,c=e.children;if(r=r||l&&l.pre,e.elm=n,i(e.isComment)&&s(e.asyncFactory))return e.isAsyncPlaceholder=!0,!0;if(s(l)&&(s(a=l.hook)&&s(a=a.init)&&a(e,!0),s(a=e.componentInstance)))return m(e,t),!0;if(s(o)){if(s(c))if(n.hasChildNodes())if(s(a=l)&&s(a=a.domProps)&&s(a=a.innerHTML)){if(a!==n.innerHTML)return!1}else{for(var p=!0,d=n.firstChild,u=0;u<c.length;u++){if(!d||!S(d,c[u],t,r)){p=!1;break}d=d.nextSibling}if(!p||d)return!1}else g(e,c,t);if(s(l)){var f=!1;for(var h in l)if(!T(h)){f=!0,v(e,t);break}!f&&l.class&&Ve(l.class)}}else n.data!==e.text&&(n.data=e.text);return!0}return function(n,e,t,a){if(!o(e)){var l,c=!1,d=[];if(o(n))c=!0,u(e,d);else{var m=s(n.nodeType);if(!m&&Ar(n,e))j(n,e,d,null,null,a);else{if(m){if(1===n.nodeType&&n.hasAttribute("data-server-rendered")&&(n.removeAttribute("data-server-rendered"),t=!0),i(t)&&S(n,e,d))return A(e,d,!0),n;l=n,n=new fn(p.tagName(l).toLowerCase(),{},[],void 0,l)}var f=n.elm,g=p.parentNode(f);if(u(e,d,f._leaveCb?null:g,p.nextSibling(f)),s(e.parent))for(var v=e.parent,b=h(e);v;){for(var y=0;y<r.destroy.length;++y)r.destroy[y](v);if(v.elm=e.elm,b){for(var _=0;_<r.create.length;++_)r.create[_](Er,v);var x=v.data.hook.insert;if(x.merged)for(var E=x.fns.slice(1),T=0;T<E.length;T++)E[T]()}else wr(v);v=v.parent}s(g)?w([n],0,0):s(n.tag)&&k(n)}}return A(e,d,c),e.elm}s(n)&&k(n)}}({nodeOps:_r,modules:[Or,Mr,Kr,Xr,la,Z?{create:Pa,activate:Pa,remove:function(n,e){!0!==n.data.show?Ca(n,e):e()}}:{}].concat(qr)});Q&&document.addEventListener("selectionchange",(function(){var n=document.activeElement;n&&n.vmodel&&Ma(n,"input")}));var qa={inserted:function(n,e,t,r){"select"===t.tag?(r.elm&&!r.elm._vOptions?Kn(t,"postpatch",(function(){qa.componentUpdated(n,e,t)})):Na(n,e,t.context),n._vOptions=[].map.call(n.options,Oa)):("textarea"===t.tag||yr(n.type))&&(n._vModifiers=e.modifiers,e.modifiers.lazy||(n.addEventListener("compositionstart",La),n.addEventListener("compositionend",Ra),n.addEventListener("change",Ra),Q&&(n.vmodel=!0)))},componentUpdated:function(n,e,t){if("select"===t.tag){Na(n,e,t.context);var r=n._vOptions,a=n._vOptions=[].map.call(n.options,Oa);if(a.some((function(n,e){return!F(n,r[e])})))(n.multiple?e.value.some((function(n){return Fa(n,a)})):e.value!==e.oldValue&&Fa(e.value,a))&&Ma(n,"change")}}};function Na(n,e,t){Da(n,e,t),(X||Y)&&setTimeout((function(){Da(n,e,t)}),0)}function Da(n,e,t){var r=e.value,a=n.multiple;if(!a||Array.isArray(r)){for(var o,s,i=0,l=n.options.length;i<l;i++)if(s=n.options[i],a)o=O(r,Oa(s))>-1,s.selected!==o&&(s.selected=o);else if(F(Oa(s),r))return void(n.selectedIndex!==i&&(n.selectedIndex=i));a||(n.selectedIndex=-1)}}function Fa(n,e){return e.every((function(e){return!F(e,n)}))}function Oa(n){return"_value"in n?n._value:n.value}function La(n){n.target.composing=!0}function Ra(n){n.target.composing&&(n.target.composing=!1,Ma(n.target,"input"))}function Ma(n,e){var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!0),n.dispatchEvent(t)}function Ua(n){return!n.componentInstance||n.data&&n.data.transition?n:Ua(n.componentInstance._vnode)}var Va={model:qa,show:{bind:function(n,e,t){var r=e.value,a=(t=Ua(t)).data&&t.data.transition,o=n.__vOriginalDisplay="none"===n.style.display?"":n.style.display;r&&a?(t.data.show=!0,Sa(t,(function(){n.style.display=o}))):n.style.display=r?o:"none"},update:function(n,e,t){var r=e.value;!r!=!e.oldValue&&((t=Ua(t)).data&&t.data.transition?(t.data.show=!0,r?Sa(t,(function(){n.style.display=n.__vOriginalDisplay})):Ca(t,(function(){n.style.display="none"}))):n.style.display=r?n.__vOriginalDisplay:"none")},unbind:function(n,e,t,r,a){a||(n.style.display=n.__vOriginalDisplay)}}},Ja={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function Ha(n){var e=n&&n.componentOptions;return e&&e.Ctor.options.abstract?Ha(je(e.children)):n}function Ga(n){var e={},t=n.$options;for(var r in t.propsData)e[r]=n[r];var a=t._parentListeners;for(var r in a)e[A(r)]=a[r];return e}function $a(n,e){if(/\d-keep-alive$/.test(e.tag))return n("keep-alive",{props:e.componentOptions.propsData})}var Ka=function(n){return n.tag||ge(n)},Za=function(n){return"show"===n.name},Wa={name:"transition",props:Ja,abstract:!0,render:function(n){var e=this,t=this.$slots.default;if(t&&(t=t.filter(Ka)).length){0;var r=this.mode;0;var a=t[0];if(function(n){for(;n=n.parent;)if(n.data.transition)return!0}(this.$vnode))return a;var o=Ha(a);if(!o)return a;if(this._leaving)return $a(n,a);var s="__transition-".concat(this._uid,"-");o.key=null==o.key?o.isComment?s+"comment":s+o.tag:l(o.key)?0===String(o.key).indexOf(s)?o.key:s+o.key:o.key;var i=(o.data||(o.data={})).transition=Ga(this),c=this._vnode,p=Ha(c);if(o.data.directives&&o.data.directives.some(Za)&&(o.data.show=!0),p&&p.data&&!function(n,e){return e.key===n.key&&e.tag===n.tag}(o,p)&&!ge(p)&&(!p.componentInstance||!p.componentInstance._vnode.isComment)){var d=p.data.transition=P({},i);if("out-in"===r)return this._leaving=!0,Kn(d,"afterLeave",(function(){e._leaving=!1,e.$forceUpdate()})),$a(n,a);if("in-out"===r){if(ge(o))return c;var u,m=function(){u()};Kn(i,"afterEnter",m),Kn(i,"enterCancelled",m),Kn(d,"delayLeave",(function(n){u=n}))}}return a}}},Xa=P({tag:String,moveClass:String},Ja);function Qa(n){n.elm._moveCb&&n.elm._moveCb(),n.elm._enterCb&&n.elm._enterCb()}function Ya(n){n.data.newPos=n.elm.getBoundingClientRect()}function no(n){var e=n.data.pos,t=n.data.newPos,r=e.left-t.left,a=e.top-t.top;if(r||a){n.data.moved=!0;var o=n.elm.style;o.transform=o.WebkitTransform="translate(".concat(r,"px,").concat(a,"px)"),o.transitionDuration="0s"}}delete Xa.mode;var eo={Transition:Wa,TransitionGroup:{props:Xa,beforeMount:function(){var n=this,e=this._update;this._update=function(t,r){var a=Qe(n);n.__patch__(n._vnode,n.kept,!1,!0),n._vnode=n.kept,a(),e.call(n,t,r)}},render:function(n){for(var e=this.tag||this.$vnode.data.tag||"span",t=Object.create(null),r=this.prevChildren=this.children,a=this.$slots.default||[],o=this.children=[],s=Ga(this),i=0;i<a.length;i++){if((p=a[i]).tag)if(null!=p.key&&0!==String(p.key).indexOf("__vlist"))o.push(p),t[p.key]=p,(p.data||(p.data={})).transition=s;else;}if(r){var l=[],c=[];for(i=0;i<r.length;i++){var p;(p=r[i]).data.transition=s,p.data.pos=p.elm.getBoundingClientRect(),t[p.key]?l.push(p):c.push(p)}this.kept=n(e,null,l),this.removed=c}return n(e,null,o)},updated:function(){var n=this.prevChildren,e=this.moveClass||(this.name||"v")+"-move";n.length&&this.hasMove(n[0].elm,e)&&(n.forEach(Qa),n.forEach(Ya),n.forEach(no),this._reflow=document.body.offsetHeight,n.forEach((function(n){if(n.data.moved){var t=n.elm,r=t.style;ka(t,e),r.transform=r.WebkitTransform=r.transitionDuration="",t.addEventListener(ha,t._moveCb=function n(r){r&&r.target!==t||r&&!/transform$/.test(r.propertyName)||(t.removeEventListener(ha,n),t._moveCb=null,wa(t,e))})}})))},methods:{hasMove:function(n,e){if(!fa)return!1;if(this._hasMove)return this._hasMove;var t=n.cloneNode();n._transitionClasses&&n._transitionClasses.forEach((function(n){da(t,n)})),pa(t,e),t.style.display="none",this.$el.appendChild(t);var r=ja(t);return this.$el.removeChild(t),this._hasMove=r.hasTransform}}}};function to(n,e){for(var t in e)n[t]=e[t];return n}$t.config.mustUseProp=function(n,e,t){return"value"===t&&tr(n)&&"button"!==e||"selected"===t&&"option"===n||"checked"===t&&"input"===n||"muted"===t&&"video"===n},$t.config.isReservedTag=vr,$t.config.isReservedAttr=er,$t.config.getTagNamespace=function(n){return hr(n)?"svg":"math"===n?"math":void 0},$t.config.isUnknownElement=function(n){if(!Z)return!0;if(vr(n))return!1;if(n=n.toLowerCase(),null!=br[n])return br[n];var e=document.createElement(n);return n.indexOf("-")>-1?br[n]=e.constructor===window.HTMLUnknownElement||e.constructor===window.HTMLElement:br[n]=/HTMLUnknownElement/.test(e.toString())},P($t.options.directives,Va),P($t.options.components,eo),$t.prototype.__patch__=Z?Ia:q,$t.prototype.$mount=function(n,e){return function(n,e,t){var r;n.$el=e,n.$options.render||(n.$options.render=gn),et(n,"beforeMount"),r=function(){n._update(n._render(),t)},new Ge(n,r,q,{before:function(){n._isMounted&&!n._isDestroyed&&et(n,"beforeUpdate")}},!0),t=!1;var a=n._preWatchers;if(a)for(var o=0;o<a.length;o++)a[o].run();return null==n.$vnode&&(n._isMounted=!0,et(n,"mounted")),n}(this,n=n&&Z?function(n){if("string"==typeof n){var e=document.querySelector(n);return e||document.createElement("div")}return n}(n):void 0,e)},Z&&setTimeout((function(){V.devtools&&ln&&ln.emit("init",$t)}),0);var ro=/[!'()*]/g,ao=function(n){return"%"+n.charCodeAt(0).toString(16)},oo=/%2C/g,so=function(n){return encodeURIComponent(n).replace(ro,ao).replace(oo,",")};function io(n){try{return decodeURIComponent(n)}catch(n){0}return n}var lo=function(n){return null==n||"object"==typeof n?n:String(n)};function co(n){var e={};return(n=n.trim().replace(/^(\?|#|&)/,""))?(n.split("&").forEach((function(n){var t=n.replace(/\+/g," ").split("="),r=io(t.shift()),a=t.length>0?io(t.join("=")):null;void 0===e[r]?e[r]=a:Array.isArray(e[r])?e[r].push(a):e[r]=[e[r],a]})),e):e}function po(n){var e=n?Object.keys(n).map((function(e){var t=n[e];if(void 0===t)return"";if(null===t)return so(e);if(Array.isArray(t)){var r=[];return t.forEach((function(n){void 0!==n&&(null===n?r.push(so(e)):r.push(so(e)+"="+so(n)))})),r.join("&")}return so(e)+"="+so(t)})).filter((function(n){return n.length>0})).join("&"):null;return e?"?"+e:""}var uo=/\/?$/;function mo(n,e,t,r){var a=r&&r.options.stringifyQuery,o=e.query||{};try{o=fo(o)}catch(n){}var s={name:e.name||n&&n.name,meta:n&&n.meta||{},path:e.path||"/",hash:e.hash||"",query:o,params:e.params||{},fullPath:vo(e,a),matched:n?ho(n):[]};return t&&(s.redirectedFrom=vo(t,a)),Object.freeze(s)}function fo(n){if(Array.isArray(n))return n.map(fo);if(n&&"object"==typeof n){var e={};for(var t in n)e[t]=fo(n[t]);return e}return n}var go=mo(null,{path:"/"});function ho(n){for(var e=[];n;)e.unshift(n),n=n.parent;return e}function vo(n,e){var t=n.path,r=n.query;void 0===r&&(r={});var a=n.hash;return void 0===a&&(a=""),(t||"/")+(e||po)(r)+a}function bo(n,e,t){return e===go?n===e:!!e&&(n.path&&e.path?n.path.replace(uo,"")===e.path.replace(uo,"")&&(t||n.hash===e.hash&&yo(n.query,e.query)):!(!n.name||!e.name)&&(n.name===e.name&&(t||n.hash===e.hash&&yo(n.query,e.query)&&yo(n.params,e.params))))}function yo(n,e){if(void 0===n&&(n={}),void 0===e&&(e={}),!n||!e)return n===e;var t=Object.keys(n).sort(),r=Object.keys(e).sort();return t.length===r.length&&t.every((function(t,a){var o=n[t];if(r[a]!==t)return!1;var s=e[t];return null==o||null==s?o===s:"object"==typeof o&&"object"==typeof s?yo(o,s):String(o)===String(s)}))}function _o(n){for(var e=0;e<n.matched.length;e++){var t=n.matched[e];for(var r in t.instances){var a=t.instances[r],o=t.enteredCbs[r];if(a&&o){delete t.enteredCbs[r];for(var s=0;s<o.length;s++)a._isBeingDestroyed||o[s](a)}}}}var ko={name:"RouterView",functional:!0,props:{name:{type:String,default:"default"}},render:function(n,e){var t=e.props,r=e.children,a=e.parent,o=e.data;o.routerView=!0;for(var s=a.$createElement,i=t.name,l=a.$route,c=a._routerViewCache||(a._routerViewCache={}),p=0,d=!1;a&&a._routerRoot!==a;){var u=a.$vnode?a.$vnode.data:{};u.routerView&&p++,u.keepAlive&&a._directInactive&&a._inactive&&(d=!0),a=a.$parent}if(o.routerViewDepth=p,d){var m=c[i],f=m&&m.component;return f?(m.configProps&&wo(f,o,m.route,m.configProps),s(f,o,r)):s()}var g=l.matched[p],h=g&&g.components[i];if(!g||!h)return c[i]=null,s();c[i]={component:h},o.registerRouteInstance=function(n,e){var t=g.instances[i];(e&&t!==n||!e&&t===n)&&(g.instances[i]=e)},(o.hook||(o.hook={})).prepatch=function(n,e){g.instances[i]=e.componentInstance},o.hook.init=function(n){n.data.keepAlive&&n.componentInstance&&n.componentInstance!==g.instances[i]&&(g.instances[i]=n.componentInstance),_o(l)};var v=g.props&&g.props[i];return v&&(to(c[i],{route:l,configProps:v}),wo(h,o,l,v)),s(h,o,r)}};function wo(n,e,t,r){var a=e.props=function(n,e){switch(typeof e){case"undefined":return;case"object":return e;case"function":return e(n);case"boolean":return e?n.params:void 0;default:0}}(t,r);if(a){a=e.props=to({},a);var o=e.attrs=e.attrs||{};for(var s in a)n.props&&s in n.props||(o[s]=a[s],delete a[s])}}function xo(n,e,t){var r=n.charAt(0);if("/"===r)return n;if("?"===r||"#"===r)return e+n;var a=e.split("/");t&&a[a.length-1]||a.pop();for(var o=n.replace(/^\//,"").split("/"),s=0;s<o.length;s++){var i=o[s];".."===i?a.pop():"."!==i&&a.push(i)}return""!==a[0]&&a.unshift(""),a.join("/")}function Eo(n){return n.replace(/\/(?:\s*\/)+/g,"/")}var jo=Array.isArray||function(n){return"[object Array]"==Object.prototype.toString.call(n)},Ao=Ro,To=Po,So=function(n,e){return qo(Po(n,e),e)},Co=qo,Bo=Lo,zo=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function Po(n,e){for(var t,r=[],a=0,o=0,s="",i=e&&e.delimiter||"/";null!=(t=zo.exec(n));){var l=t[0],c=t[1],p=t.index;if(s+=n.slice(o,p),o=p+l.length,c)s+=c[1];else{var d=n[o],u=t[2],m=t[3],f=t[4],g=t[5],h=t[6],v=t[7];s&&(r.push(s),s="");var b=null!=u&&null!=d&&d!==u,y="+"===h||"*"===h,_="?"===h||"*"===h,k=t[2]||i,w=f||g;r.push({name:m||a++,prefix:u||"",delimiter:k,optional:_,repeat:y,partial:b,asterisk:!!v,pattern:w?Do(w):v?".*":"[^"+No(k)+"]+?"})}}return o<n.length&&(s+=n.substr(o)),s&&r.push(s),r}function Io(n){return encodeURI(n).replace(/[\/?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()}))}function qo(n,e){for(var t=new Array(n.length),r=0;r<n.length;r++)"object"==typeof n[r]&&(t[r]=new RegExp("^(?:"+n[r].pattern+")$",Oo(e)));return function(e,r){for(var a="",o=e||{},s=(r||{}).pretty?Io:encodeURIComponent,i=0;i<n.length;i++){var l=n[i];if("string"!=typeof l){var c,p=o[l.name];if(null==p){if(l.optional){l.partial&&(a+=l.prefix);continue}throw new TypeError('Expected "'+l.name+'" to be defined')}if(jo(p)){if(!l.repeat)throw new TypeError('Expected "'+l.name+'" to not repeat, but received `'+JSON.stringify(p)+"`");if(0===p.length){if(l.optional)continue;throw new TypeError('Expected "'+l.name+'" to not be empty')}for(var d=0;d<p.length;d++){if(c=s(p[d]),!t[i].test(c))throw new TypeError('Expected all "'+l.name+'" to match "'+l.pattern+'", but received `'+JSON.stringify(c)+"`");a+=(0===d?l.prefix:l.delimiter)+c}}else{if(c=l.asterisk?encodeURI(p).replace(/[?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()})):s(p),!t[i].test(c))throw new TypeError('Expected "'+l.name+'" to match "'+l.pattern+'", but received "'+c+'"');a+=l.prefix+c}}else a+=l}return a}}function No(n){return n.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function Do(n){return n.replace(/([=!:$\/()])/g,"\\$1")}function Fo(n,e){return n.keys=e,n}function Oo(n){return n&&n.sensitive?"":"i"}function Lo(n,e,t){jo(e)||(t=e||t,e=[]);for(var r=(t=t||{}).strict,a=!1!==t.end,o="",s=0;s<n.length;s++){var i=n[s];if("string"==typeof i)o+=No(i);else{var l=No(i.prefix),c="(?:"+i.pattern+")";e.push(i),i.repeat&&(c+="(?:"+l+c+")*"),o+=c=i.optional?i.partial?l+"("+c+")?":"(?:"+l+"("+c+"))?":l+"("+c+")"}}var p=No(t.delimiter||"/"),d=o.slice(-p.length)===p;return r||(o=(d?o.slice(0,-p.length):o)+"(?:"+p+"(?=$))?"),o+=a?"$":r&&d?"":"(?="+p+"|$)",Fo(new RegExp("^"+o,Oo(t)),e)}function Ro(n,e,t){return jo(e)||(t=e||t,e=[]),t=t||{},n instanceof RegExp?function(n,e){var t=n.source.match(/\((?!\?)/g);if(t)for(var r=0;r<t.length;r++)e.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return Fo(n,e)}(n,e):jo(n)?function(n,e,t){for(var r=[],a=0;a<n.length;a++)r.push(Ro(n[a],e,t).source);return Fo(new RegExp("(?:"+r.join("|")+")",Oo(t)),e)}(n,e,t):function(n,e,t){return Lo(Po(n,t),e,t)}(n,e,t)}Ao.parse=To,Ao.compile=So,Ao.tokensToFunction=Co,Ao.tokensToRegExp=Bo;var Mo=Object.create(null);function Uo(n,e,t){e=e||{};try{var r=Mo[n]||(Mo[n]=Ao.compile(n));return"string"==typeof e.pathMatch&&(e[0]=e.pathMatch),r(e,{pretty:!0})}catch(n){return""}finally{delete e[0]}}function Vo(n,e,t,r){var a="string"==typeof n?{path:n}:n;if(a._normalized)return a;if(a.name){var o=(a=to({},n)).params;return o&&"object"==typeof o&&(a.params=to({},o)),a}if(!a.path&&a.params&&e){(a=to({},a))._normalized=!0;var s=to(to({},e.params),a.params);if(e.name)a.name=e.name,a.params=s;else if(e.matched.length){var i=e.matched[e.matched.length-1].path;a.path=Uo(i,s,e.path)}else 0;return a}var l=function(n){var e="",t="",r=n.indexOf("#");r>=0&&(e=n.slice(r),n=n.slice(0,r));var a=n.indexOf("?");return a>=0&&(t=n.slice(a+1),n=n.slice(0,a)),{path:n,query:t,hash:e}}(a.path||""),c=e&&e.path||"/",p=l.path?xo(l.path,c,t||a.append):c,d=function(n,e,t){void 0===e&&(e={});var r,a=t||co;try{r=a(n||"")}catch(n){r={}}for(var o in e){var s=e[o];r[o]=Array.isArray(s)?s.map(lo):lo(s)}return r}(l.query,a.query,r&&r.options.parseQuery),u=a.hash||l.hash;return u&&"#"!==u.charAt(0)&&(u="#"+u),{_normalized:!0,path:p,query:d,hash:u}}var Jo,Ho=function(){},Go={name:"RouterLink",props:{to:{type:[String,Object],required:!0},tag:{type:String,default:"a"},custom:Boolean,exact:Boolean,exactPath:Boolean,append:Boolean,replace:Boolean,activeClass:String,exactActiveClass:String,ariaCurrentValue:{type:String,default:"page"},event:{type:[String,Array],default:"click"}},render:function(n){var e=this,t=this.$router,r=this.$route,a=t.resolve(this.to,r,this.append),o=a.location,s=a.route,i=a.href,l={},c=t.options.linkActiveClass,p=t.options.linkExactActiveClass,d=null==c?"router-link-active":c,u=null==p?"router-link-exact-active":p,m=null==this.activeClass?d:this.activeClass,f=null==this.exactActiveClass?u:this.exactActiveClass,g=s.redirectedFrom?mo(null,Vo(s.redirectedFrom),null,t):s;l[f]=bo(r,g,this.exactPath),l[m]=this.exact||this.exactPath?l[f]:function(n,e){return 0===n.path.replace(uo,"/").indexOf(e.path.replace(uo,"/"))&&(!e.hash||n.hash===e.hash)&&function(n,e){for(var t in e)if(!(t in n))return!1;return!0}(n.query,e.query)}(r,g);var h=l[f]?this.ariaCurrentValue:null,v=function(n){$o(n)&&(e.replace?t.replace(o,Ho):t.push(o,Ho))},b={click:$o};Array.isArray(this.event)?this.event.forEach((function(n){b[n]=v})):b[this.event]=v;var y={class:l},_=!this.$scopedSlots.$hasNormal&&this.$scopedSlots.default&&this.$scopedSlots.default({href:i,route:s,navigate:v,isActive:l[m],isExactActive:l[f]});if(_){if(1===_.length)return _[0];if(_.length>1||!_.length)return 0===_.length?n():n("span",{},_)}if("a"===this.tag)y.on=b,y.attrs={href:i,"aria-current":h};else{var k=function n(e){var t;if(e)for(var r=0;r<e.length;r++){if("a"===(t=e[r]).tag)return t;if(t.children&&(t=n(t.children)))return t}}(this.$slots.default);if(k){k.isStatic=!1;var w=k.data=to({},k.data);for(var x in w.on=w.on||{},w.on){var E=w.on[x];x in b&&(w.on[x]=Array.isArray(E)?E:[E])}for(var j in b)j in w.on?w.on[j].push(b[j]):w.on[j]=v;var A=k.data.attrs=to({},k.data.attrs);A.href=i,A["aria-current"]=h}else y.on=b}return n(this.tag,y,this.$slots.default)}};function $o(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey||n.defaultPrevented||void 0!==n.button&&0!==n.button)){if(n.currentTarget&&n.currentTarget.getAttribute){var e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}var Ko="undefined"!=typeof window;function Zo(n,e,t,r,a){var o=e||[],s=t||Object.create(null),i=r||Object.create(null);n.forEach((function(n){!function n(e,t,r,a,o,s){var i=a.path,l=a.name;0;var c=a.pathToRegexpOptions||{},p=function(n,e,t){t||(n=n.replace(/\/$/,""));if("/"===n[0])return n;if(null==e)return n;return Eo(e.path+"/"+n)}(i,o,c.strict);"boolean"==typeof a.caseSensitive&&(c.sensitive=a.caseSensitive);var d={path:p,regex:Wo(p,c),components:a.components||{default:a.component},alias:a.alias?"string"==typeof a.alias?[a.alias]:a.alias:[],instances:{},enteredCbs:{},name:l,parent:o,matchAs:s,redirect:a.redirect,beforeEnter:a.beforeEnter,meta:a.meta||{},props:null==a.props?{}:a.components?a.props:{default:a.props}};a.children&&a.children.forEach((function(a){var o=s?Eo(s+"/"+a.path):void 0;n(e,t,r,a,d,o)}));t[d.path]||(e.push(d.path),t[d.path]=d);if(void 0!==a.alias)for(var u=Array.isArray(a.alias)?a.alias:[a.alias],m=0;m<u.length;++m){0;var f={path:u[m],children:a.children};n(e,t,r,f,o,d.path||"/")}l&&(r[l]||(r[l]=d))}(o,s,i,n,a)}));for(var l=0,c=o.length;l<c;l++)"*"===o[l]&&(o.push(o.splice(l,1)[0]),c--,l--);return{pathList:o,pathMap:s,nameMap:i}}function Wo(n,e){return Ao(n,[],e)}function Xo(n,e){var t=Zo(n),r=t.pathList,a=t.pathMap,o=t.nameMap;function s(n,t,s){var i=Vo(n,t,!1,e),c=i.name;if(c){var p=o[c];if(!p)return l(null,i);var d=p.regex.keys.filter((function(n){return!n.optional})).map((function(n){return n.name}));if("object"!=typeof i.params&&(i.params={}),t&&"object"==typeof t.params)for(var u in t.params)!(u in i.params)&&d.indexOf(u)>-1&&(i.params[u]=t.params[u]);return i.path=Uo(p.path,i.params),l(p,i,s)}if(i.path){i.params={};for(var m=0;m<r.length;m++){var f=r[m],g=a[f];if(Qo(g.regex,i.path,i.params))return l(g,i,s)}}return l(null,i)}function i(n,t){var r=n.redirect,a="function"==typeof r?r(mo(n,t,null,e)):r;if("string"==typeof a&&(a={path:a}),!a||"object"!=typeof a)return l(null,t);var i=a,c=i.name,p=i.path,d=t.query,u=t.hash,m=t.params;if(d=i.hasOwnProperty("query")?i.query:d,u=i.hasOwnProperty("hash")?i.hash:u,m=i.hasOwnProperty("params")?i.params:m,c){o[c];return s({_normalized:!0,name:c,query:d,hash:u,params:m},void 0,t)}if(p){var f=function(n,e){return xo(n,e.parent?e.parent.path:"/",!0)}(p,n);return s({_normalized:!0,path:Uo(f,m),query:d,hash:u},void 0,t)}return l(null,t)}function l(n,t,r){return n&&n.redirect?i(n,r||t):n&&n.matchAs?function(n,e,t){var r=s({_normalized:!0,path:Uo(t,e.params)});if(r){var a=r.matched,o=a[a.length-1];return e.params=r.params,l(o,e)}return l(null,e)}(0,t,n.matchAs):mo(n,t,r,e)}return{match:s,addRoute:function(n,e){var t="object"!=typeof n?o[n]:void 0;Zo([e||n],r,a,o,t),t&&t.alias.length&&Zo(t.alias.map((function(n){return{path:n,children:[e]}})),r,a,o,t)},getRoutes:function(){return r.map((function(n){return a[n]}))},addRoutes:function(n){Zo(n,r,a,o)}}}function Qo(n,e,t){var r=e.match(n);if(!r)return!1;if(!t)return!0;for(var a=1,o=r.length;a<o;++a){var s=n.keys[a-1];s&&(t[s.name||"pathMatch"]="string"==typeof r[a]?io(r[a]):r[a])}return!0}var Yo=Ko&&window.performance&&window.performance.now?window.performance:Date;function ns(){return Yo.now().toFixed(3)}var es=ns();function ts(){return es}function rs(n){return es=n}var as=Object.create(null);function os(){"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var n=window.location.protocol+"//"+window.location.host,e=window.location.href.replace(n,""),t=to({},window.history.state);return t.key=ts(),window.history.replaceState(t,"",e),window.addEventListener("popstate",ls),function(){window.removeEventListener("popstate",ls)}}function ss(n,e,t,r){if(n.app){var a=n.options.scrollBehavior;a&&n.app.$nextTick((function(){var o=function(){var n=ts();if(n)return as[n]}(),s=a.call(n,e,t,r?o:null);s&&("function"==typeof s.then?s.then((function(n){ms(n,o)})).catch((function(n){0})):ms(s,o))}))}}function is(){var n=ts();n&&(as[n]={x:window.pageXOffset,y:window.pageYOffset})}function ls(n){is(),n.state&&n.state.key&&rs(n.state.key)}function cs(n){return ds(n.x)||ds(n.y)}function ps(n){return{x:ds(n.x)?n.x:window.pageXOffset,y:ds(n.y)?n.y:window.pageYOffset}}function ds(n){return"number"==typeof n}var us=/^#\d/;function ms(n,e){var t,r="object"==typeof n;if(r&&"string"==typeof n.selector){var a=us.test(n.selector)?document.getElementById(n.selector.slice(1)):document.querySelector(n.selector);if(a){var o=n.offset&&"object"==typeof n.offset?n.offset:{};e=function(n,e){var t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{x:r.left-t.left-e.x,y:r.top-t.top-e.y}}(a,o={x:ds((t=o).x)?t.x:0,y:ds(t.y)?t.y:0})}else cs(n)&&(e=ps(n))}else r&&cs(n)&&(e=ps(n));e&&("scrollBehavior"in document.documentElement.style?window.scrollTo({left:e.x,top:e.y,behavior:n.behavior}):window.scrollTo(e.x,e.y))}var fs,gs=Ko&&((-1===(fs=window.navigator.userAgent).indexOf("Android 2.")&&-1===fs.indexOf("Android 4.0")||-1===fs.indexOf("Mobile Safari")||-1!==fs.indexOf("Chrome")||-1!==fs.indexOf("Windows Phone"))&&window.history&&"function"==typeof window.history.pushState);function hs(n,e){is();var t=window.history;try{if(e){var r=to({},t.state);r.key=ts(),t.replaceState(r,"",n)}else t.pushState({key:rs(ns())},"",n)}catch(t){window.location[e?"replace":"assign"](n)}}function vs(n){hs(n,!0)}var bs={redirected:2,aborted:4,cancelled:8,duplicated:16};function ys(n,e){return ks(n,e,bs.redirected,'Redirected when going from "'+n.fullPath+'" to "'+function(n){if("string"==typeof n)return n;if("path"in n)return n.path;var e={};return ws.forEach((function(t){t in n&&(e[t]=n[t])})),JSON.stringify(e,null,2)}(e)+'" via a navigation guard.')}function _s(n,e){return ks(n,e,bs.cancelled,'Navigation cancelled from "'+n.fullPath+'" to "'+e.fullPath+'" with a new navigation.')}function ks(n,e,t,r){var a=new Error(r);return a._isRouter=!0,a.from=n,a.to=e,a.type=t,a}var ws=["params","query","hash"];function xs(n){return Object.prototype.toString.call(n).indexOf("Error")>-1}function Es(n,e){return xs(n)&&n._isRouter&&(null==e||n.type===e)}function js(n,e,t){var r=function(a){a>=n.length?t():n[a]?e(n[a],(function(){r(a+1)})):r(a+1)};r(0)}function As(n){return function(e,t,r){var a=!1,o=0,s=null;Ts(n,(function(n,e,t,i){if("function"==typeof n&&void 0===n.cid){a=!0,o++;var l,c=Bs((function(e){var a;((a=e).__esModule||Cs&&"Module"===a[Symbol.toStringTag])&&(e=e.default),n.resolved="function"==typeof e?e:Jo.extend(e),t.components[i]=e,--o<=0&&r()})),p=Bs((function(n){var e="Failed to resolve async component "+i+": "+n;s||(s=xs(n)?n:new Error(e),r(s))}));try{l=n(c,p)}catch(n){p(n)}if(l)if("function"==typeof l.then)l.then(c,p);else{var d=l.component;d&&"function"==typeof d.then&&d.then(c,p)}}})),a||r()}}function Ts(n,e){return Ss(n.map((function(n){return Object.keys(n.components).map((function(t){return e(n.components[t],n.instances[t],n,t)}))})))}function Ss(n){return Array.prototype.concat.apply([],n)}var Cs="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;function Bs(n){var e=!1;return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];if(!e)return e=!0,n.apply(this,t)}}var zs=function(n,e){this.router=n,this.base=function(n){if(!n)if(Ko){var e=document.querySelector("base");n=(n=e&&e.getAttribute("href")||"/").replace(/^https?:\/\/[^\/]+/,"")}else n="/";"/"!==n.charAt(0)&&(n="/"+n);return n.replace(/\/$/,"")}(e),this.current=go,this.pending=null,this.ready=!1,this.readyCbs=[],this.readyErrorCbs=[],this.errorCbs=[],this.listeners=[]};function Ps(n,e,t,r){var a=Ts(n,(function(n,r,a,o){var s=function(n,e){"function"!=typeof n&&(n=Jo.extend(n));return n.options[e]}(n,e);if(s)return Array.isArray(s)?s.map((function(n){return t(n,r,a,o)})):t(s,r,a,o)}));return Ss(r?a.reverse():a)}function Is(n,e){if(e)return function(){return n.apply(e,arguments)}}zs.prototype.listen=function(n){this.cb=n},zs.prototype.onReady=function(n,e){this.ready?n():(this.readyCbs.push(n),e&&this.readyErrorCbs.push(e))},zs.prototype.onError=function(n){this.errorCbs.push(n)},zs.prototype.transitionTo=function(n,e,t){var r,a=this;try{r=this.router.match(n,this.current)}catch(n){throw this.errorCbs.forEach((function(e){e(n)})),n}var o=this.current;this.confirmTransition(r,(function(){a.updateRoute(r),e&&e(r),a.ensureURL(),a.router.afterHooks.forEach((function(n){n&&n(r,o)})),a.ready||(a.ready=!0,a.readyCbs.forEach((function(n){n(r)})))}),(function(n){t&&t(n),n&&!a.ready&&(Es(n,bs.redirected)&&o===go||(a.ready=!0,a.readyErrorCbs.forEach((function(e){e(n)}))))}))},zs.prototype.confirmTransition=function(n,e,t){var r=this,a=this.current;this.pending=n;var o,s,i=function(n){!Es(n)&&xs(n)&&(r.errorCbs.length?r.errorCbs.forEach((function(e){e(n)})):console.error(n)),t&&t(n)},l=n.matched.length-1,c=a.matched.length-1;if(bo(n,a)&&l===c&&n.matched[l]===a.matched[c])return this.ensureURL(),n.hash&&ss(this.router,a,n,!1),i(((s=ks(o=a,n,bs.duplicated,'Avoided redundant navigation to current location: "'+o.fullPath+'".')).name="NavigationDuplicated",s));var p=function(n,e){var t,r=Math.max(n.length,e.length);for(t=0;t<r&&n[t]===e[t];t++);return{updated:e.slice(0,t),activated:e.slice(t),deactivated:n.slice(t)}}(this.current.matched,n.matched),d=p.updated,u=p.deactivated,m=p.activated,f=[].concat(function(n){return Ps(n,"beforeRouteLeave",Is,!0)}(u),this.router.beforeHooks,function(n){return Ps(n,"beforeRouteUpdate",Is)}(d),m.map((function(n){return n.beforeEnter})),As(m)),g=function(e,t){if(r.pending!==n)return i(_s(a,n));try{e(n,a,(function(e){!1===e?(r.ensureURL(!0),i(function(n,e){return ks(n,e,bs.aborted,'Navigation aborted from "'+n.fullPath+'" to "'+e.fullPath+'" via a navigation guard.')}(a,n))):xs(e)?(r.ensureURL(!0),i(e)):"string"==typeof e||"object"==typeof e&&("string"==typeof e.path||"string"==typeof e.name)?(i(ys(a,n)),"object"==typeof e&&e.replace?r.replace(e):r.push(e)):t(e)}))}catch(n){i(n)}};js(f,g,(function(){js(function(n){return Ps(n,"beforeRouteEnter",(function(n,e,t,r){return function(n,e,t){return function(r,a,o){return n(r,a,(function(n){"function"==typeof n&&(e.enteredCbs[t]||(e.enteredCbs[t]=[]),e.enteredCbs[t].push(n)),o(n)}))}}(n,t,r)}))}(m).concat(r.router.resolveHooks),g,(function(){if(r.pending!==n)return i(_s(a,n));r.pending=null,e(n),r.router.app&&r.router.app.$nextTick((function(){_o(n)}))}))}))},zs.prototype.updateRoute=function(n){this.current=n,this.cb&&this.cb(n)},zs.prototype.setupListeners=function(){},zs.prototype.teardown=function(){this.listeners.forEach((function(n){n()})),this.listeners=[],this.current=go,this.pending=null};var qs=function(n){function e(e,t){n.call(this,e,t),this._startLocation=Ns(this.base)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router,t=e.options.scrollBehavior,r=gs&&t;r&&this.listeners.push(os());var a=function(){var t=n.current,a=Ns(n.base);n.current===go&&a===n._startLocation||n.transitionTo(a,(function(n){r&&ss(e,n,t,!0)}))};window.addEventListener("popstate",a),this.listeners.push((function(){window.removeEventListener("popstate",a)}))}},e.prototype.go=function(n){window.history.go(n)},e.prototype.push=function(n,e,t){var r=this,a=this.current;this.transitionTo(n,(function(n){hs(Eo(r.base+n.fullPath)),ss(r.router,n,a,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var r=this,a=this.current;this.transitionTo(n,(function(n){vs(Eo(r.base+n.fullPath)),ss(r.router,n,a,!1),e&&e(n)}),t)},e.prototype.ensureURL=function(n){if(Ns(this.base)!==this.current.fullPath){var e=Eo(this.base+this.current.fullPath);n?hs(e):vs(e)}},e.prototype.getCurrentLocation=function(){return Ns(this.base)},e}(zs);function Ns(n){var e=window.location.pathname,t=e.toLowerCase(),r=n.toLowerCase();return!n||t!==r&&0!==t.indexOf(Eo(r+"/"))||(e=e.slice(n.length)),(e||"/")+window.location.search+window.location.hash}var Ds=function(n){function e(e,t,r){n.call(this,e,t),r&&function(n){var e=Ns(n);if(!/^\/#/.test(e))return window.location.replace(Eo(n+"/#"+e)),!0}(this.base)||Fs()}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router.options.scrollBehavior,t=gs&&e;t&&this.listeners.push(os());var r=function(){var e=n.current;Fs()&&n.transitionTo(Os(),(function(r){t&&ss(n.router,r,e,!0),gs||Ms(r.fullPath)}))},a=gs?"popstate":"hashchange";window.addEventListener(a,r),this.listeners.push((function(){window.removeEventListener(a,r)}))}},e.prototype.push=function(n,e,t){var r=this,a=this.current;this.transitionTo(n,(function(n){Rs(n.fullPath),ss(r.router,n,a,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var r=this,a=this.current;this.transitionTo(n,(function(n){Ms(n.fullPath),ss(r.router,n,a,!1),e&&e(n)}),t)},e.prototype.go=function(n){window.history.go(n)},e.prototype.ensureURL=function(n){var e=this.current.fullPath;Os()!==e&&(n?Rs(e):Ms(e))},e.prototype.getCurrentLocation=function(){return Os()},e}(zs);function Fs(){var n=Os();return"/"===n.charAt(0)||(Ms("/"+n),!1)}function Os(){var n=window.location.href,e=n.indexOf("#");return e<0?"":n=n.slice(e+1)}function Ls(n){var e=window.location.href,t=e.indexOf("#");return(t>=0?e.slice(0,t):e)+"#"+n}function Rs(n){gs?hs(Ls(n)):window.location.hash=n}function Ms(n){gs?vs(Ls(n)):window.location.replace(Ls(n))}var Us=function(n){function e(e,t){n.call(this,e,t),this.stack=[],this.index=-1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.push=function(n,e,t){var r=this;this.transitionTo(n,(function(n){r.stack=r.stack.slice(0,r.index+1).concat(n),r.index++,e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var r=this;this.transitionTo(n,(function(n){r.stack=r.stack.slice(0,r.index).concat(n),e&&e(n)}),t)},e.prototype.go=function(n){var e=this,t=this.index+n;if(!(t<0||t>=this.stack.length)){var r=this.stack[t];this.confirmTransition(r,(function(){var n=e.current;e.index=t,e.updateRoute(r),e.router.afterHooks.forEach((function(e){e&&e(r,n)}))}),(function(n){Es(n,bs.duplicated)&&(e.index=t)}))}},e.prototype.getCurrentLocation=function(){var n=this.stack[this.stack.length-1];return n?n.fullPath:"/"},e.prototype.ensureURL=function(){},e}(zs),Vs=function(n){void 0===n&&(n={}),this.app=null,this.apps=[],this.options=n,this.beforeHooks=[],this.resolveHooks=[],this.afterHooks=[],this.matcher=Xo(n.routes||[],this);var e=n.mode||"hash";switch(this.fallback="history"===e&&!gs&&!1!==n.fallback,this.fallback&&(e="hash"),Ko||(e="abstract"),this.mode=e,e){case"history":this.history=new qs(this,n.base);break;case"hash":this.history=new Ds(this,n.base,this.fallback);break;case"abstract":this.history=new Us(this,n.base);break;default:0}},Js={currentRoute:{configurable:!0}};Vs.prototype.match=function(n,e,t){return this.matcher.match(n,e,t)},Js.currentRoute.get=function(){return this.history&&this.history.current},Vs.prototype.init=function(n){var e=this;if(this.apps.push(n),n.$once("hook:destroyed",(function(){var t=e.apps.indexOf(n);t>-1&&e.apps.splice(t,1),e.app===n&&(e.app=e.apps[0]||null),e.app||e.history.teardown()})),!this.app){this.app=n;var t=this.history;if(t instanceof qs||t instanceof Ds){var r=function(n){t.setupListeners(),function(n){var r=t.current,a=e.options.scrollBehavior;gs&&a&&"fullPath"in n&&ss(e,n,r,!1)}(n)};t.transitionTo(t.getCurrentLocation(),r,r)}t.listen((function(n){e.apps.forEach((function(e){e._route=n}))}))}},Vs.prototype.beforeEach=function(n){return Gs(this.beforeHooks,n)},Vs.prototype.beforeResolve=function(n){return Gs(this.resolveHooks,n)},Vs.prototype.afterEach=function(n){return Gs(this.afterHooks,n)},Vs.prototype.onReady=function(n,e){this.history.onReady(n,e)},Vs.prototype.onError=function(n){this.history.onError(n)},Vs.prototype.push=function(n,e,t){var r=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){r.history.push(n,e,t)}));this.history.push(n,e,t)},Vs.prototype.replace=function(n,e,t){var r=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){r.history.replace(n,e,t)}));this.history.replace(n,e,t)},Vs.prototype.go=function(n){this.history.go(n)},Vs.prototype.back=function(){this.go(-1)},Vs.prototype.forward=function(){this.go(1)},Vs.prototype.getMatchedComponents=function(n){var e=n?n.matched?n:this.resolve(n).route:this.currentRoute;return e?[].concat.apply([],e.matched.map((function(n){return Object.keys(n.components).map((function(e){return n.components[e]}))}))):[]},Vs.prototype.resolve=function(n,e,t){var r=Vo(n,e=e||this.history.current,t,this),a=this.match(r,e),o=a.redirectedFrom||a.fullPath;return{location:r,route:a,href:function(n,e,t){var r="hash"===t?"#"+e:e;return n?Eo(n+"/"+r):r}(this.history.base,o,this.mode),normalizedTo:r,resolved:a}},Vs.prototype.getRoutes=function(){return this.matcher.getRoutes()},Vs.prototype.addRoute=function(n,e){this.matcher.addRoute(n,e),this.history.current!==go&&this.history.transitionTo(this.history.getCurrentLocation())},Vs.prototype.addRoutes=function(n){this.matcher.addRoutes(n),this.history.current!==go&&this.history.transitionTo(this.history.getCurrentLocation())},Object.defineProperties(Vs.prototype,Js);var Hs=Vs;function Gs(n,e){return n.push(e),function(){var t=n.indexOf(e);t>-1&&n.splice(t,1)}}Vs.install=function n(e){if(!n.installed||Jo!==e){n.installed=!0,Jo=e;var t=function(n){return void 0!==n},r=function(n,e){var r=n.$options._parentVnode;t(r)&&t(r=r.data)&&t(r=r.registerRouteInstance)&&r(n,e)};e.mixin({beforeCreate:function(){t(this.$options.router)?(this._routerRoot=this,this._router=this.$options.router,this._router.init(this),e.util.defineReactive(this,"_route",this._router.history.current)):this._routerRoot=this.$parent&&this.$parent._routerRoot||this,r(this,this)},destroyed:function(){r(this)}}),Object.defineProperty(e.prototype,"$router",{get:function(){return this._routerRoot._router}}),Object.defineProperty(e.prototype,"$route",{get:function(){return this._routerRoot._route}}),e.component("RouterView",ko),e.component("RouterLink",Go);var a=e.config.optionMergeStrategies;a.beforeRouteEnter=a.beforeRouteLeave=a.beforeRouteUpdate=a.created}},Vs.version="3.6.5",Vs.isNavigationFailure=Es,Vs.NavigationFailureType=bs,Vs.START_LOCATION=go,Ko&&window.Vue&&window.Vue.use(Vs);t(100);t(129),t(16);var $s={NotFound:()=>Promise.all([t.e(0),t.e(4)]).then(t.bind(null,330)),Layout:()=>Promise.all([t.e(0),t.e(2)]).then(t.bind(null,329))},Ks={"v-22282852":()=>t.e(119).then(t.bind(null,332)),"v-1ede408b":()=>t.e(6).then(t.bind(null,333)),"v-302e23f4":()=>t.e(8).then(t.bind(null,334)),"v-d1a6c318":()=>t.e(9).then(t.bind(null,335)),"v-7a11f4c8":()=>t.e(10).then(t.bind(null,336)),"v-4932a3f8":()=>t.e(11).then(t.bind(null,337)),"v-033d1db6":()=>t.e(12).then(t.bind(null,338)),"v-b983bcaa":()=>t.e(7).then(t.bind(null,339)),"v-a4110f34":()=>t.e(13).then(t.bind(null,340)),"v-718cb9b0":()=>t.e(14).then(t.bind(null,341)),"v-7e40cffe":()=>t.e(15).then(t.bind(null,342)),"v-566b048c":()=>t.e(16).then(t.bind(null,343)),"v-34e42639":()=>t.e(17).then(t.bind(null,344)),"v-423655cc":()=>t.e(18).then(t.bind(null,345)),"v-1b5f1ee8":()=>t.e(19).then(t.bind(null,346)),"v-b8532098":()=>t.e(20).then(t.bind(null,347)),"v-d5c1a816":()=>t.e(21).then(t.bind(null,348)),"v-0b03f7cc":()=>t.e(22).then(t.bind(null,349)),"v-7b03b51c":()=>t.e(23).then(t.bind(null,350)),"v-f9a862c8":()=>t.e(25).then(t.bind(null,351)),"v-6bd8e8aa":()=>t.e(26).then(t.bind(null,352)),"v-5a7b351e":()=>t.e(27).then(t.bind(null,353)),"v-0379b906":()=>t.e(28).then(t.bind(null,354)),"v-3223b15c":()=>t.e(24).then(t.bind(null,355)),"v-8cb0bf1a":()=>t.e(29).then(t.bind(null,356)),"v-4d95c10a":()=>t.e(33).then(t.bind(null,357)),"v-47b0b8a9":()=>t.e(32).then(t.bind(null,358)),"v-437ba2ee":()=>t.e(34).then(t.bind(null,359)),"v-7413a666":()=>t.e(37).then(t.bind(null,360)),"v-fdfd34bc":()=>t.e(38).then(t.bind(null,361)),"v-d51b20aa":()=>t.e(30).then(t.bind(null,362)),"v-74234f32":()=>t.e(39).then(t.bind(null,363)),"v-0fd7c93e":()=>t.e(40).then(t.bind(null,364)),"v-064e6b52":()=>t.e(41).then(t.bind(null,365)),"v-86796282":()=>t.e(42).then(t.bind(null,366)),"v-1a0f65c8":()=>t.e(36).then(t.bind(null,367)),"v-642acf34":()=>t.e(43).then(t.bind(null,368)),"v-86799138":()=>t.e(44).then(t.bind(null,369)),"v-1eacf608":()=>t.e(45).then(t.bind(null,370)),"v-77369d13":()=>t.e(35).then(t.bind(null,371)),"v-8f1b0f62":()=>t.e(46).then(t.bind(null,372)),"v-f08b0a92":()=>t.e(47).then(t.bind(null,373)),"v-0fd01db7":()=>t.e(48).then(t.bind(null,374)),"v-11e81284":()=>t.e(50).then(t.bind(null,375)),"v-be038f46":()=>t.e(49).then(t.bind(null,376)),"v-6cbb1851":()=>t.e(51).then(t.bind(null,377)),"v-67c4fe98":()=>t.e(53).then(t.bind(null,378)),"v-cc91cd44":()=>t.e(54).then(t.bind(null,379)),"v-16efd28d":()=>t.e(55).then(t.bind(null,380)),"v-079101b0":()=>t.e(52).then(t.bind(null,381)),"v-27753cf3":()=>t.e(56).then(t.bind(null,382)),"v-d04209ac":()=>t.e(57).then(t.bind(null,383)),"v-7a226c10":()=>t.e(58).then(t.bind(null,384)),"v-97fa14a4":()=>t.e(59).then(t.bind(null,385)),"v-8855b59c":()=>t.e(60).then(t.bind(null,386)),"v-3dc84304":()=>t.e(61).then(t.bind(null,387)),"v-cee6b5d2":()=>t.e(62).then(t.bind(null,388)),"v-5be0bc4c":()=>t.e(64).then(t.bind(null,389)),"v-54ae2f6d":()=>t.e(65).then(t.bind(null,390)),"v-6b5349e8":()=>t.e(63).then(t.bind(null,391)),"v-788e5ef9":()=>t.e(67).then(t.bind(null,392)),"v-597fc7ce":()=>t.e(66).then(t.bind(null,393)),"v-0e418e98":()=>t.e(68).then(t.bind(null,394)),"v-208228f3":()=>t.e(69).then(t.bind(null,395)),"v-4534d8ad":()=>t.e(70).then(t.bind(null,396)),"v-98683fbe":()=>t.e(71).then(t.bind(null,397)),"v-7dfe11b0":()=>t.e(72).then(t.bind(null,398)),"v-502d161c":()=>t.e(74).then(t.bind(null,399)),"v-abb9096c":()=>t.e(75).then(t.bind(null,400)),"v-2c646377":()=>t.e(76).then(t.bind(null,401)),"v-bb440a42":()=>t.e(77).then(t.bind(null,402)),"v-50cf7a82":()=>t.e(78).then(t.bind(null,403)),"v-6e6e165e":()=>t.e(79).then(t.bind(null,404)),"v-72f4b6b0":()=>t.e(80).then(t.bind(null,405)),"v-3e16c4d8":()=>t.e(81).then(t.bind(null,406)),"v-242c57bc":()=>t.e(82).then(t.bind(null,407)),"v-580c8dac":()=>t.e(83).then(t.bind(null,408)),"v-669ddbd6":()=>t.e(84).then(t.bind(null,409)),"v-5f11081e":()=>t.e(85).then(t.bind(null,410)),"v-e8f812b8":()=>t.e(86).then(t.bind(null,411)),"v-35d0167d":()=>t.e(87).then(t.bind(null,412)),"v-788c4982":()=>t.e(88).then(t.bind(null,413)),"v-f7e64afe":()=>t.e(89).then(t.bind(null,414)),"v-3c157da4":()=>t.e(90).then(t.bind(null,415)),"v-069fea3d":()=>t.e(91).then(t.bind(null,416)),"v-2e6d253f":()=>t.e(92).then(t.bind(null,417)),"v-573b59b6":()=>t.e(94).then(t.bind(null,418)),"v-0056c406":()=>t.e(95).then(t.bind(null,419)),"v-fc3c6860":()=>t.e(93).then(t.bind(null,420)),"v-3b941cbe":()=>t.e(97).then(t.bind(null,421)),"v-05407dda":()=>t.e(96).then(t.bind(null,422)),"v-a1f03dba":()=>t.e(98).then(t.bind(null,423)),"v-ec68963a":()=>t.e(99).then(t.bind(null,424)),"v-37dbc27d":()=>t.e(100).then(t.bind(null,425)),"v-118bdc85":()=>t.e(101).then(t.bind(null,426)),"v-fdcf4762":()=>t.e(102).then(t.bind(null,427)),"v-21216af8":()=>t.e(104).then(t.bind(null,428)),"v-325b46da":()=>t.e(105).then(t.bind(null,429)),"v-3e69314c":()=>t.e(106).then(t.bind(null,430)),"v-31a5e395":()=>t.e(103).then(t.bind(null,431)),"v-e9cb914e":()=>t.e(110).then(t.bind(null,432)),"v-087ac98a":()=>t.e(108).then(t.bind(null,433)),"v-05a28fa4":()=>t.e(111).then(t.bind(null,434)),"v-8c516c3e":()=>t.e(109).then(t.bind(null,435)),"v-54f1c73c":()=>t.e(113).then(t.bind(null,331)),"v-567cb3a8":()=>t.e(112).then(t.bind(null,436)),"v-0485a99b":()=>t.e(115).then(t.bind(null,437)),"v-e5fb5ede":()=>t.e(31).then(t.bind(null,438)),"v-e627318a":()=>t.e(107).then(t.bind(null,439)),"v-7ffecc44":()=>t.e(117).then(t.bind(null,440)),"v-25855433":()=>t.e(73).then(t.bind(null,441)),"v-8d4bc20e":()=>t.e(114).then(t.bind(null,442)),"v-6cd702fe":()=>t.e(116).then(t.bind(null,443)),"v-16e3f17e":()=>t.e(118).then(t.bind(null,444))};function Zs(n){const e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}const Ws=/-(\w)/g,Xs=Zs(n=>n.replace(Ws,(n,e)=>e?e.toUpperCase():"")),Qs=/\B([A-Z])/g,Ys=Zs(n=>n.replace(Qs,"-$1").toLowerCase()),ni=Zs(n=>n.charAt(0).toUpperCase()+n.slice(1));function ei(n,e){if(!e)return;if(n(e))return n(e);return e.includes("-")?n(ni(Xs(e))):n(ni(e))||n(Ys(e))}const ti=Object.assign({},$s,Ks),ri=n=>ti[n],ai=n=>Ks[n],oi=n=>$s[n],si=n=>$t.component(n);function ii(n){return ei(ai,n)}function li(n){return ei(oi,n)}function ci(n){return ei(ri,n)}function pi(n){return ei(si,n)}function di(...n){return Promise.all(n.filter(n=>n).map(async n=>{if(!pi(n)&&ci(n)){const e=await ci(n)();$t.component(n,e.default)}}))}function ui(n,e){"undefined"!=typeof window&&window.__VUEPRESS__&&(window.__VUEPRESS__[n]=e)}var mi=t(93),fi=t.n(mi),gi=t(94),hi=t.n(gi),vi={created(){if(this.siteMeta=this.$site.headTags.filter(([n])=>"meta"===n).map(([n,e])=>e),this.$ssrContext){const e=this.getMergedMetaTags();this.$ssrContext.title=this.$title,this.$ssrContext.lang=this.$lang,this.$ssrContext.pageMeta=(n=e)?n.map(n=>{let e="<meta";return Object.keys(n).forEach(t=>{e+=` ${t}="${hi()(n[t])}"`}),e+">"}).join("\n    "):"",this.$ssrContext.canonicalLink=yi(this.$canonicalUrl)}var n},mounted(){this.currentMetaTags=[...document.querySelectorAll("meta")],this.updateMeta(),this.updateCanonicalLink()},methods:{updateMeta(){document.title=this.$title,document.documentElement.lang=this.$lang;const n=this.getMergedMetaTags();this.currentMetaTags=_i(n,this.currentMetaTags)},getMergedMetaTags(){const n=this.$page.frontmatter.meta||[];return fi()([{name:"description",content:this.$description}],n,this.siteMeta,ki)},updateCanonicalLink(){bi(),this.$canonicalUrl&&document.head.insertAdjacentHTML("beforeend",yi(this.$canonicalUrl))}},watch:{$page(){this.updateMeta(),this.updateCanonicalLink()}},beforeDestroy(){_i(null,this.currentMetaTags),bi()}};function bi(){const n=document.querySelector("link[rel='canonical']");n&&n.remove()}function yi(n=""){return n?`<link href="${n}" rel="canonical" />`:""}function _i(n,e){if(e&&[...e].filter(n=>n.parentNode===document.head).forEach(n=>document.head.removeChild(n)),n)return n.map(n=>{const e=document.createElement("meta");return Object.keys(n).forEach(t=>{e.setAttribute(t,n[t])}),document.head.appendChild(e),e})}function ki(n){for(const e of["name","property","itemprop"])if(n.hasOwnProperty(e))return n[e]+e;return JSON.stringify(n)}var wi=t(49),xi={mounted(){window.addEventListener("scroll",this.onScroll)},methods:{onScroll:t.n(wi)()((function(){this.setActiveHash()}),300),setActiveHash(){const n=[].slice.call(document.querySelectorAll(".sidebar-link")),e=[].slice.call(document.querySelectorAll(".header-anchor")).filter(e=>n.some(n=>n.hash===e.hash)),t=Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop),r=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),a=window.innerHeight+t;for(let n=0;n<e.length;n++){const o=e[n],s=e[n+1],i=0===n&&0===t||t>=o.parentElement.offsetTop+10&&(!s||t<s.parentElement.offsetTop-10),l=decodeURIComponent(this.$route.hash);if(i&&l!==decodeURIComponent(o.hash)){const t=o;if(a===r)for(let t=n+1;t<e.length;t++)if(l===decodeURIComponent(e[t].hash))return;return this.$vuepress.$set("disableScrollBehavior",!0),void this.$router.replace(decodeURIComponent(t.hash),()=>{this.$nextTick(()=>{this.$vuepress.$set("disableScrollBehavior",!1)})})}}}},beforeDestroy(){window.removeEventListener("scroll",this.onScroll)}},Ei=t(24),ji=t.n(Ei),Ai={mounted(){ji.a.configure({showSpinner:!1}),this.$router.beforeEach((n,e,t)=>{n.path===e.path||$t.component(n.name)||ji.a.start(),t()}),this.$router.afterEach(()=>{ji.a.done(),this.isSidebarOpen=!1})}};t(242),t(243);class Ti{constructor(){this.containerEl=document.getElementById("message-container"),this.containerEl||(this.containerEl=document.createElement("div"),this.containerEl.id="message-container",document.body.appendChild(this.containerEl))}show({text:n="",duration:e=3e3}){let t=document.createElement("div");t.className="message move-in",t.innerHTML=`\n      <i style="fill: #06a35a;font-size: 14px;display:inline-flex;align-items: center;">\n        <svg style="fill: #06a35a;font-size: 14px;" t="1572421810237" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2323" width="16" height="16"><path d="M822.811993 824.617989c-83.075838 81.99224-188.546032 124.613757-316.049383 127.86455-122.085362-3.250794-223.943563-45.87231-305.935802-127.86455s-124.613757-184.21164-127.86455-305.935802c3.250794-127.503351 45.87231-232.973545 127.86455-316.049383 81.99224-83.075838 184.21164-126.058554 305.935802-129.309347 127.503351 3.250794 232.973545 46.23351 316.049383 129.309347 83.075838 83.075838 126.058554 188.546032 129.309347 316.049383C949.231746 640.406349 905.887831 742.62575 822.811993 824.617989zM432.716755 684.111464c3.973192 3.973192 8.307584 5.779189 13.364374 6.140388 5.05679 0.361199 9.752381-1.444797 13.364374-5.417989l292.571429-287.514638c3.973192-3.973192 5.779189-8.307584 5.779189-13.364374 0-5.05679-1.805996-9.752381-5.779189-13.364374l1.805996 1.805996c-3.973192-3.973192-8.668783-5.779189-14.086772-6.140388-5.417989-0.361199-10.47478 1.444797-14.809171 5.417989l-264.397884 220.33157c-3.973192 3.250794-8.668783 4.695591-14.447972 4.695591-5.779189 0-10.835979-1.444797-15.53157-3.973192l-94.273016-72.962257c-4.334392-3.250794-9.391182-4.334392-14.447972-3.973192s-9.391182 3.250794-12.641975 7.585185l-2.889594 3.973192c-3.250794 4.334392-4.334392 9.391182-3.973192 14.809171 0.722399 5.417989 2.528395 10.11358 5.779189 14.086772L432.716755 684.111464z" p-id="2324"></path></svg>\n      </i>\n      <div class="text">${n}</div>\n    `,this.containerEl.appendChild(t),e>0&&setTimeout(()=>{this.close(t)},e)}close(n){n.className=n.className.replace("move-in",""),n.className+="move-out",n.addEventListener("animationend",()=>{n.remove()})}}var Si={mounted(){!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.updateCopy()},updated(){!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.updateCopy()},methods:{updateCopy(){setTimeout(()=>{(['div[class*="language-"] pre','div[class*="aside-code"] aside']instanceof Array||Array.isArray(['div[class*="language-"] pre','div[class*="aside-code"] aside']))&&['div[class*="language-"] pre','div[class*="aside-code"] aside'].forEach(n=>{document.querySelectorAll(n).forEach(this.generateCopyButton)})},1e3)},generateCopyButton(n){if(n.classList.contains("codecopy-enabled"))return;const e=document.createElement("i");e.className="code-copy",e.innerHTML='<svg  style="color:#aaa;font-size:14px" t="1572422231464" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3201" width="14" height="14"><path d="M866.461538 39.384615H354.461538c-43.323077 0-78.769231 35.446154-78.76923 78.769231v39.384616h472.615384c43.323077 0 78.769231 35.446154 78.769231 78.76923v551.384616h39.384615c43.323077 0 78.769231-35.446154 78.769231-78.769231V118.153846c0-43.323077-35.446154-78.769231-78.769231-78.769231z m-118.153846 275.692308c0-43.323077-35.446154-78.769231-78.76923-78.769231H157.538462c-43.323077 0-78.769231 35.446154-78.769231 78.769231v590.769231c0 43.323077 35.446154 78.769231 78.769231 78.769231h512c43.323077 0 78.769231-35.446154 78.76923-78.769231V315.076923z m-354.461538 137.846154c0 11.815385-7.876923 19.692308-19.692308 19.692308h-157.538461c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h157.538461c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z m157.538461 315.076923c0 11.815385-7.876923 19.692308-19.692307 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h315.076923c11.815385 0 19.692308 7.876923 19.692307 19.692308v39.384615z m78.769231-157.538462c0 11.815385-7.876923 19.692308-19.692308 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h393.846153c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z" p-id="3202"></path></svg>',e.title="Copy to clipboard",e.addEventListener("click",()=>{this.copyToClipboard(n.innerText)}),n.appendChild(e),n.classList.add("codecopy-enabled")},copyToClipboard(n){const e=document.createElement("textarea");e.value=n,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e);const t=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);e.select(),document.execCommand("copy");(new Ti).show({text:"å¤å¶æå",duration:1e3}),document.body.removeChild(e),t&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(t))}}};!function(n,e){void 0===e&&(e={});var t=e.insertAt;if(n&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===t&&r.firstChild?r.insertBefore(a,r.firstChild):r.appendChild(a),a.styleSheet?a.styleSheet.cssText=n:a.appendChild(document.createTextNode(n))}}("@media (max-width: 1000px) {\n  .vuepress-plugin-demo-block__h_code {\n    display: none;\n  }\n  .vuepress-plugin-demo-block__app {\n    margin-left: auto !important;\n    margin-right: auto !important;\n  }\n}\n.vuepress-plugin-demo-block__wrapper {\n  margin-top: 10px;\n  border: 1px solid #ebebeb;\n  border-radius: 4px;\n  transition: all 0.2s;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display {\n  height: 400px;\n  display: flex;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__app {\n  width: 300px;\n  border: 1px solid #ebebeb;\n  box-shadow: 1px 1px 3px #ebebeb;\n  margin-right: 5px;\n  overflow: auto;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__h_code {\n  flex: 1;\n  overflow: auto;\n  height: 100%;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__h_code > pre {\n  overflow: visible;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__display {\n  max-height: 400px;\n  overflow: auto;\n}\n.vuepress-plugin-demo-block__wrapper div {\n  box-sizing: border-box;\n}\n.vuepress-plugin-demo-block__wrapper:hover {\n  box-shadow: 0 0 11px rgba(33, 33, 33, 0.2);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__code {\n  overflow: hidden;\n  height: 0;\n  padding: 0 !important;\n  background-color: #282c34;\n  border-radius: 0 !important;\n  transition: height 0.5s;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__code pre {\n  margin: 0 !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__display {\n  padding: 20px;\n  border-bottom: 1px solid #ebebeb;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer {\n  position: relative;\n  text-align: center;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__codepen {\n  opacity: 1;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__expand::before {\n  border-top: none;\n  border-right: 6px solid transparent;\n  border-bottom: 6px solid #ccc;\n  border-left: 6px solid transparent;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__codepen,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand span,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand {\n  opacity: 1;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand::before {\n  border-top-color: #3eaf7c !important;\n  border-bottom-color: #3eaf7c !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover svg {\n  fill: #3eaf7c !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand-text {\n  transition: all 0.5s;\n  opacity: 0;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer form:nth-last-child(2) {\n  right: 50px;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer form:last-child {\n  right: 10px;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button {\n  border-color: transparent;\n  background-color: transparent;\n  font-size: 14px;\n  color: #3eaf7c;\n  cursor: pointer;\n  outline: none;\n  margin: 0;\n  width: 46px;\n  position: relative;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button:hover::before {\n  content: attr(data-tip);\n  white-space: nowrap;\n  position: absolute;\n  top: -30px;\n  left: 50%;\n  color: #eee;\n  line-height: 1;\n  z-index: 1000;\n  border-radius: 4px;\n  padding: 6px;\n  -webkit-transform: translateX(-50%);\n          transform: translateX(-50%);\n  background-color: rgba(0, 0, 0, 0.8);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button:hover::after {\n  content: '' !important;\n  display: block;\n  position: absolute;\n  left: 50%;\n  top: -5px;\n  -webkit-transform: translateX(-50%);\n          transform: translateX(-50%);\n  border: 5px solid transparent;\n  border-top-color: rgba(0, 0, 0, 0.8);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button svg {\n  width: 34px;\n  height: 20px;\n  fill: #ccc;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__codepen {\n  position: absolute;\n  top: 10px;\n  transition: all 0.5s;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand {\n  position: relative;\n  width: 100px;\n  height: 40px;\n  margin: 0;\n  color: #3eaf7c;\n  font-size: 14px;\n  background-color: transparent;\n  border-color: transparent;\n  outline: none;\n  transition: all 0.5s;\n  cursor: pointer;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand::before {\n  content: \"\";\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 0;\n  height: 0;\n  border-top: 6px solid #ccc;\n  border-right: 6px solid transparent;\n  border-left: 6px solid transparent;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n");var Ci={jsLib:[],cssLib:[],jsfiddle:!0,codepen:!0,codepenLayout:"left",codepenJsProcessor:"babel",codepenEditors:"101",horizontal:!1,vue:"https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js",react:"https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js",reactDOM:"https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"},Bi={},zi=function(n){return'<div id="app">\n'.concat(n,"\n</div>")},Pi=function(n){return window.$VUEPRESS_DEMO_BLOCK&&void 0!==window.$VUEPRESS_DEMO_BLOCK[n]?window.$VUEPRESS_DEMO_BLOCK[n]:Ci[n]},Ii=function n(e,t,r){var a=document.createElement(e);return t&&Object.keys(t).forEach((function(n){if(n.indexOf("data"))a[n]=t[n];else{var e=n.replace("data","");a.dataset[e]=t[n]}})),r&&r.forEach((function(e){var t=e.tag,r=e.attrs,o=e.children;a.appendChild(n(t,r,o))})),a},qi=function(n,e,t){var r,a=(r=n.querySelectorAll(".".concat(e)),Array.prototype.slice.call(r));return 1!==a.length||t?a:a[0]},Ni=function(n,e){var t,r,a=n.match(/<style>([\s\S]+)<\/style>/),o=n.match(/<template>([\s\S]+)<\/template>/),s=n.match(/<script>([\s\S]+)<\/script>/),i={css:a&&a[1].replace(/^\n|\n$/g,""),html:o&&o[1].replace(/^\n|\n$/g,""),js:s&&s[1].replace(/^\n|\n$/g,""),jsLib:e.jsLib||[],cssLib:e.cssLib||[]};i.htmlTpl=zi(i.html),i.jsTpl=(t=i.js,r=t.replace(/export\s+default\s*?\{\n*/,"").replace(/\n*\}\s*$/,"").trim(),"new Vue({\n  el: '#app',\n  ".concat(r,"\n})")),i.script=function(n,e){var t=n.split(/export\s+default/),r="(function() {".concat(t[0]," ; return ").concat(t[1],"})()"),a=window.Babel?window.Babel.transform(r,{presets:["es2015"]}).code:r,o=[eval][0](a);return o.template=e,o}(i.js,i.html);var l=Pi("vue");return i.jsLib.unshift(l),i},Di=function(n,e){var t,r=n.match(/<style>([\s\S]+)<\/style>/),a=n.match(/<html>([\s\S]+)<\/html>/),o=n.match(/<script>([\s\S]+)<\/script>/),s={css:r&&r[1].replace(/^\n|\n$/g,""),html:a&&a[1].replace(/^\n|\n$/g,""),js:o&&o[1].replace(/^\n|\n$/g,""),jsLib:e.jsLib||[],cssLib:e.cssLib||[]};return s.htmlTpl=s.html,s.jsTpl=s.js,s.script=(t=s.js,window.Babel?window.Babel.transform(t,{presets:["es2015"]}).code:t),s},Fi=function(n){return n=n.replace("export default ","").replace(/App\.__style__(\s*)=(\s*)`([\s\S]*)?`/,""),n+='ReactDOM.render(React.createElement(App), document.getElementById("app"))'};function Oi(){var n=qi(document,"vuepress-plugin-demo-block__wrapper",!0);n.length?n.forEach((function(n){if("true"!==n.dataset.created){n.style.display="block";var e=qi(n,"vuepress-plugin-demo-block__code"),t=qi(n,"vuepress-plugin-demo-block__display"),r=qi(n,"vuepress-plugin-demo-block__footer"),a=qi(t,"vuepress-plugin-demo-block__app"),o=decodeURIComponent(n.dataset.code),s=decodeURIComponent(n.dataset.config),i=decodeURIComponent(n.dataset.type);s=s?JSON.parse(s):{};var l=e.querySelector("div").clientHeight,c="react"===i?function(n,e){var t=(0,window.Babel.transform)(n,{presets:["es2015","react"]}).code,r="(function(exports){var module={};module.exports=exports;".concat(t,";return module.exports.__esModule?module.exports.default:module.exports;})({})"),a=new Function("return ".concat(r))(),o={js:a,css:a.__style__||"",jsLib:e.jsLib||[],cssLib:e.cssLib||[],jsTpl:Fi(n),htmlTpl:zi("")},s=Pi("react"),i=Pi("reactDOM");return o.jsLib.unshift(s,i),o}(o,s):"vanilla"===i?Di(o,s):Ni(o,s),p=Ii("button",{className:"".concat("vuepress-plugin-demo-block__expand")});if(r.appendChild(p),p.addEventListener("click",Li.bind(null,p,l,e,r)),Pi("jsfiddle")&&r.appendChild(function(n){var e=n.css,t=n.htmlTpl,r=n.jsTpl,a=n.jsLib,o=n.cssLib,s=a.concat(o).concat(Pi("cssLib")).concat(Pi("jsLib")).join(",");return Ii("form",{className:"vuepress-plugin-demo-block__jsfiddle",target:"_blank",action:"https://jsfiddle.net/api/post/library/pure/",method:"post"},[{tag:"input",attrs:{type:"hidden",name:"css",value:e}},{tag:"input",attrs:{type:"hidden",name:"html",value:t}},{tag:"input",attrs:{type:"hidden",name:"js",value:r}},{tag:"input",attrs:{type:"hidden",name:"panel_js",value:3}},{tag:"input",attrs:{type:"hidden",name:"wrap",value:1}},{tag:"input",attrs:{type:"hidden",name:"resources",value:s}},{tag:"button",attrs:{type:"submit",className:"vuepress-plugin-demo-block__button",innerHTML:'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1547088289967" class="icon" style="" viewBox="0 0 1170 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1952" xmlns:xlink="http://www.w3.org/1999/xlink" width="228.515625" height="200"><defs><style type="text/css"></style></defs><path d="M1028.571429 441.142857q63.428571 26.285714 102.571428 83.142857T1170.285714 650.857143q0 93.714286-67.428571 160.285714T940 877.714286q-2.285714 0-6.571429-0.285715t-6-0.285714H232q-97.142857-5.714286-164.571429-71.714286T0 645.142857q0-62.857143 31.428571-116t84-84q-6.857143-22.285714-6.857142-46.857143 0-65.714286 46.857142-112t113.714286-46.285714q54.285714 0 98.285714 33.142857 42.857143-88 127.142858-141.714286t186.571428-53.714285q94.857143 0 174.857143 46T982.571429 248.571429t46.571428 172q0 3.428571-0.285714 10.285714t-0.285714 10.285714zM267.428571 593.142857q0 69.714286 48 110.285714t118.857143 40.571429q78.285714 0 137.142857-56.571429-9.142857-11.428571-27.142857-32.285714T519.428571 626.285714q-38.285714 37.142857-82.285714 37.142857-31.428571 0-53.428571-19.142857T361.714286 594.285714q0-30.285714 22-49.714285t52.285714-19.428572q25.142857 0 48.285714 12t41.714286 31.428572 37.142857 42.857142 39.428572 46.857143 44 42.857143 55.428571 31.428572 69.428571 12q69.142857 0 116.857143-40.857143T936 594.857143q0-69.142857-48-109.714286t-118.285714-40.571428q-81.714286 0-137.714286 55.428571l53.142857 61.714286q37.714286-36.571429 81.142857-36.571429 29.714286 0 52.571429 18.857143t22.857143 48q0 32.571429-21.142857 52.285714t-53.714286 19.714286q-24.571429 0-47.142857-12t-41.142857-31.428571-37.428572-42.857143-39.714286-46.857143-44.285714-42.857143-55.142857-31.428571T434.285714 444.571429q-69.714286 0-118.285714 40.285714T267.428571 593.142857z" p-id="1953"></path></svg>',datatip:"JSFiddle"}}])}(c)),Pi("codepen")&&r.appendChild(function(n){var e=n.css,t=n.htmlTpl,r=n.jsTpl,a=n.jsLib,o=n.cssLib,s=JSON.stringify({css:e,html:t,js:r,js_external:a.concat(Pi("jsLib")).join(";"),css_external:o.concat(Pi("cssLib")).join(";"),layout:Pi("codepenLayout"),js_pre_processor:Pi("codepenJsProcessor"),editors:Pi("codepenEditors")});return Ii("form",{className:"vuepress-plugin-demo-block__codepen",target:"_blank",action:"https://codepen.io/pen/define",method:"post"},[{tag:"input",attrs:{type:"hidden",name:"data",value:s}},{tag:"button",attrs:{type:"submit",innerHTML:'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1547088271207" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1737" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M123.428571 668l344.571429 229.714286v-205.142857L277.142857 565.142857z m-35.428571-82.285714l110.285714-73.714286-110.285714-73.714286v147.428572z m468 312l344.571429-229.714286-153.714286-102.857143-190.857143 127.428572v205.142857z m-44-281.714286l155.428571-104-155.428571-104-155.428571 104zM277.142857 458.857143l190.857143-127.428572V126.285714L123.428571 356z m548.571429 53.142857l110.285714 73.714286V438.285714z m-78.857143-53.142857l153.714286-102.857143-344.571429-229.714286v205.142857z m277.142857-102.857143v312q0 23.428571-19.428571 36.571429l-468 312q-12 7.428571-24.571429 7.428571t-24.571429-7.428571L19.428571 704.571429q-19.428571-13.142857-19.428571-36.571429V356q0-23.428571 19.428571-36.571429L487.428571 7.428571q12-7.428571 24.571429-7.428571t24.571429 7.428571l468 312q19.428571 13.142857 19.428571 36.571429z" p-id="1738"></path></svg>',className:"vuepress-plugin-demo-block__button",datatip:"Codepen"}}])}(c)),void 0!==s.horizontal?s.horizontal:Pi("horizontal")){n.classList.add("vuepress-plugin-demo-block__horizontal");var d=e.firstChild.cloneNode(!0);d.classList.add("vuepress-plugin-demo-block__h_code"),t.appendChild(d)}if(c.css&&function(n){if(!Bi[n]){var e=Ii("style",{innerHTML:n});document.body.appendChild(e),Bi[n]=!0}}(c.css),"react"===i)ReactDOM.render(React.createElement(c.js),a);else if("vue"===i){var u=(new(Vue.extend(c.script))).$mount();a.appendChild(u.$el)}else"vanilla"===i&&(a.innerHTML=c.html,new Function("return (function(){".concat(c.script,"})()"))());n.dataset.created="true"}})):setTimeout((function(n){Oi()}),300)}function Li(n,e,t,r){var a="1"!==n.dataset.isExpand;t.style.height=a?"".concat(e,"px"):0,a?r.classList.add("vuepress-plugin-demo-block__show-link"):r.classList.remove("vuepress-plugin-demo-block__show-link"),n.dataset.isExpand=a?"1":"0"}var Ri={mounted:function(){window.$VUEPRESS_DEMO_BLOCK={jsfiddle:!1,codepen:!0,horizontal:!1},Oi()},updated:function(){Oi()}},Mi="auto",Ui="zoom-in",Vi="zoom-out",Ji="grab",Hi="move";function Gi(n,e,t){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a={passive:!1};r?n.addEventListener(e,t,a):n.removeEventListener(e,t,a)}function $i(n,e){if(n){var t=new Image;t.onload=function(){e&&e(t)},t.src=n}}function Ki(n){return n.dataset.original?n.dataset.original:"A"===n.parentNode.tagName?n.parentNode.getAttribute("href"):null}function Zi(n,e,t){!function(n){var e=Wi,t=Xi;if(n.transition){var r=n.transition;delete n.transition,n[e]=r}if(n.transform){var a=n.transform;delete n.transform,n[t]=a}}(e);var r=n.style,a={};for(var o in e)t&&(a[o]=r[o]||""),r[o]=e[o];return a}var Wi="transition",Xi="transform",Qi="transform",Yi="transitionend";var nl=function(){},el={enableGrab:!0,preloadImage:!1,closeOnWindowResize:!0,transitionDuration:.4,transitionTimingFunction:"cubic-bezier(0.4, 0, 0, 1)",bgColor:"rgb(255, 255, 255)",bgOpacity:1,scaleBase:1,scaleExtra:.5,scrollThreshold:40,zIndex:998,customSize:null,onOpen:nl,onClose:nl,onGrab:nl,onMove:nl,onRelease:nl,onBeforeOpen:nl,onBeforeClose:nl,onBeforeGrab:nl,onBeforeRelease:nl,onImageLoading:nl,onImageLoaded:nl},tl={init:function(n){var e,t;e=this,t=n,Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach((function(n){e[n]=e[n].bind(t)}))},click:function(n){if(n.preventDefault(),al(n))return window.open(this.target.srcOriginal||n.currentTarget.src,"_blank");this.shown?this.released?this.close():this.release():this.open(n.currentTarget)},scroll:function(){var n=document.documentElement||document.body.parentNode||document.body,e=window.pageXOffset||n.scrollLeft,t=window.pageYOffset||n.scrollTop;null===this.lastScrollPosition&&(this.lastScrollPosition={x:e,y:t});var r=this.lastScrollPosition.x-e,a=this.lastScrollPosition.y-t,o=this.options.scrollThreshold;(Math.abs(a)>=o||Math.abs(r)>=o)&&(this.lastScrollPosition=null,this.close())},keydown:function(n){(function(n){return"Escape"===(n.key||n.code)||27===n.keyCode})(n)&&(this.released?this.close():this.release(this.close))},mousedown:function(n){if(rl(n)&&!al(n)){n.preventDefault();var e=n.clientX,t=n.clientY;this.pressTimer=setTimeout(function(){this.grab(e,t)}.bind(this),200)}},mousemove:function(n){this.released||this.move(n.clientX,n.clientY)},mouseup:function(n){rl(n)&&!al(n)&&(clearTimeout(this.pressTimer),this.released?this.close():this.release())},touchstart:function(n){n.preventDefault();var e=n.touches[0],t=e.clientX,r=e.clientY;this.pressTimer=setTimeout(function(){this.grab(t,r)}.bind(this),200)},touchmove:function(n){if(!this.released){var e=n.touches[0],t=e.clientX,r=e.clientY;this.move(t,r)}},touchend:function(n){(function(n){n.targetTouches.length})(n)||(clearTimeout(this.pressTimer),this.released?this.close():this.release())},clickOverlay:function(){this.close()},resizeWindow:function(){this.close()}};function rl(n){return 0===n.button}function al(n){return n.metaKey||n.ctrlKey}var ol={init:function(n){this.el=document.createElement("div"),this.instance=n,this.parent=document.body,Zi(this.el,{position:"fixed",top:0,left:0,right:0,bottom:0,opacity:0}),this.updateStyle(n.options),Gi(this.el,"click",n.handler.clickOverlay.bind(n))},updateStyle:function(n){Zi(this.el,{zIndex:n.zIndex,backgroundColor:n.bgColor,transition:"opacity\n        "+n.transitionDuration+"s\n        "+n.transitionTimingFunction})},insert:function(){this.parent.appendChild(this.el)},remove:function(){this.parent.removeChild(this.el)},fadeIn:function(){this.el.offsetWidth,this.el.style.opacity=this.instance.options.bgOpacity},fadeOut:function(){this.el.style.opacity=0}},sl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},il=function(){function n(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),ll=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},cl={init:function(n,e){this.el=n,this.instance=e,this.srcThumbnail=this.el.getAttribute("src"),this.srcset=this.el.getAttribute("srcset"),this.srcOriginal=Ki(this.el),this.rect=this.el.getBoundingClientRect(),this.translate=null,this.scale=null,this.styleOpen=null,this.styleClose=null},zoomIn:function(){var n=this.instance.options,e=n.zIndex,t=n.enableGrab,r=n.transitionDuration,a=n.transitionTimingFunction;this.translate=this.calculateTranslate(),this.scale=this.calculateScale(),this.styleOpen={position:"relative",zIndex:e+1,cursor:t?Ji:Vi,transition:Qi+"\n        "+r+"s\n        "+a,transform:"translate3d("+this.translate.x+"px, "+this.translate.y+"px, 0px)\n        scale("+this.scale.x+","+this.scale.y+")",height:this.rect.height+"px",width:this.rect.width+"px"},this.el.offsetWidth,this.styleClose=Zi(this.el,this.styleOpen,!0)},zoomOut:function(){this.el.offsetWidth,Zi(this.el,{transform:"none"})},grab:function(n,e,t){var r=pl(),a=r.x-n,o=r.y-e;Zi(this.el,{cursor:Hi,transform:"translate3d(\n        "+(this.translate.x+a)+"px, "+(this.translate.y+o)+"px, 0px)\n        scale("+(this.scale.x+t)+","+(this.scale.y+t)+")"})},move:function(n,e,t){var r=pl(),a=r.x-n,o=r.y-e;Zi(this.el,{transition:Qi,transform:"translate3d(\n        "+(this.translate.x+a)+"px, "+(this.translate.y+o)+"px, 0px)\n        scale("+(this.scale.x+t)+","+(this.scale.y+t)+")"})},restoreCloseStyle:function(){Zi(this.el,this.styleClose)},restoreOpenStyle:function(){Zi(this.el,this.styleOpen)},upgradeSource:function(){if(this.srcOriginal){var n=this.el.parentNode;this.srcset&&this.el.removeAttribute("srcset");var e=this.el.cloneNode(!1);e.setAttribute("src",this.srcOriginal),e.style.position="fixed",e.style.visibility="hidden",n.appendChild(e),setTimeout(function(){this.el.setAttribute("src",this.srcOriginal),n.removeChild(e)}.bind(this),50)}},downgradeSource:function(){this.srcOriginal&&(this.srcset&&this.el.setAttribute("srcset",this.srcset),this.el.setAttribute("src",this.srcThumbnail))},calculateTranslate:function(){var n=pl(),e=this.rect.left+this.rect.width/2,t=this.rect.top+this.rect.height/2;return{x:n.x-e,y:n.y-t}},calculateScale:function(){var n=this.el.dataset,e=n.zoomingHeight,t=n.zoomingWidth,r=this.instance.options,a=r.customSize,o=r.scaleBase;if(!a&&e&&t)return{x:t/this.rect.width,y:e/this.rect.height};if(a&&"object"===(void 0===a?"undefined":sl(a)))return{x:a.width/this.rect.width,y:a.height/this.rect.height};var s=this.rect.width/2,i=this.rect.height/2,l=pl(),c={x:l.x-s,y:l.y-i},p=c.x/s,d=c.y/i,u=o+Math.min(p,d);if(a&&"string"==typeof a){var m=t||this.el.naturalWidth,f=e||this.el.naturalHeight,g=parseFloat(a)*m/(100*this.rect.width),h=parseFloat(a)*f/(100*this.rect.height);if(u>g||u>h)return{x:g,y:h}}return{x:u,y:u}}};function pl(){var n=document.documentElement;return{x:Math.min(n.clientWidth,window.innerWidth)/2,y:Math.min(n.clientHeight,window.innerHeight)/2}}function dl(n,e,t){["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"].forEach((function(r){Gi(n,r,e[r],t)}))}var ul=function(){function n(e){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.target=Object.create(cl),this.overlay=Object.create(ol),this.handler=Object.create(tl),this.body=document.body,this.shown=!1,this.lock=!1,this.released=!0,this.lastScrollPosition=null,this.pressTimer=null,this.options=ll({},el,e),this.overlay.init(this),this.handler.init(this)}return il(n,[{key:"listen",value:function(n){if("string"==typeof n)for(var e=document.querySelectorAll(n),t=e.length;t--;)this.listen(e[t]);else"IMG"===n.tagName&&(n.style.cursor=Ui,Gi(n,"click",this.handler.click),this.options.preloadImage&&$i(Ki(n)));return this}},{key:"config",value:function(n){return n?(ll(this.options,n),this.overlay.updateStyle(this.options),this):this.options}},{key:"open",value:function(n){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.onOpen;if(!this.shown&&!this.lock){var r="string"==typeof n?document.querySelector(n):n;if("IMG"===r.tagName){if(this.options.onBeforeOpen(r),this.target.init(r,this),!this.options.preloadImage){var a=this.target.srcOriginal;null!=a&&(this.options.onImageLoading(r),$i(a,this.options.onImageLoaded))}this.shown=!0,this.lock=!0,this.target.zoomIn(),this.overlay.insert(),this.overlay.fadeIn(),Gi(document,"scroll",this.handler.scroll),Gi(document,"keydown",this.handler.keydown),this.options.closeOnWindowResize&&Gi(window,"resize",this.handler.resizeWindow);var o=function n(){Gi(r,Yi,n,!1),e.lock=!1,e.target.upgradeSource(),e.options.enableGrab&&dl(document,e.handler,!0),t(r)};return Gi(r,Yi,o),this}}}},{key:"close",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onClose;if(this.shown&&!this.lock){var t=this.target.el;this.options.onBeforeClose(t),this.lock=!0,this.body.style.cursor=Mi,this.overlay.fadeOut(),this.target.zoomOut(),Gi(document,"scroll",this.handler.scroll,!1),Gi(document,"keydown",this.handler.keydown,!1),this.options.closeOnWindowResize&&Gi(window,"resize",this.handler.resizeWindow,!1);var r=function r(){Gi(t,Yi,r,!1),n.shown=!1,n.lock=!1,n.target.downgradeSource(),n.options.enableGrab&&dl(document,n.handler,!1),n.target.restoreCloseStyle(),n.overlay.remove(),e(t)};return Gi(t,Yi,r),this}}},{key:"grab",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onGrab;if(this.shown&&!this.lock){var a=this.target.el;this.options.onBeforeGrab(a),this.released=!1,this.target.grab(n,e,t);var o=function n(){Gi(a,Yi,n,!1),r(a)};return Gi(a,Yi,o),this}}},{key:"move",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onMove;if(this.shown&&!this.lock){this.released=!1,this.body.style.cursor=Hi,this.target.move(n,e,t);var a=this.target.el,o=function n(){Gi(a,Yi,n,!1),r(a)};return Gi(a,Yi,o),this}}},{key:"release",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onRelease;if(this.shown&&!this.lock){var t=this.target.el;this.options.onBeforeRelease(t),this.lock=!0,this.body.style.cursor=Mi,this.target.restoreOpenStyle();var r=function r(){Gi(t,Yi,r,!1),n.lock=!1,n.released=!0,e(t)};return Gi(t,Yi,r),this}}}]),n}();const ml=JSON.parse('{"bgColor":"rgba(0,0,0,0.6)"}'),fl=Number("500");class gl{constructor(){this.instance=new ul(ml)}update(n=".theme-vdoing-content img:not(.no-zoom)"){"undefined"!=typeof window&&this.instance.listen(n)}updateDelay(n=".theme-vdoing-content img:not(.no-zoom)",e=fl){setTimeout(()=>this.update(n),e)}}var hl=[vi,xi,Ai,Si,Ri,{watch:{"$page.path"(){void 0!==this.$vuepress.zooming&&this.$vuepress.zooming.updateDelay()}},mounted(){this.$vuepress.zooming=new gl,this.$vuepress.zooming.updateDelay()}}],vl={name:"GlobalLayout",computed:{layout(){const n=this.getLayout();return ui("layout",n),$t.component(n)}},methods:{getLayout(){if(this.$page.path){const n=this.$page.frontmatter.layout;return n&&(this.$vuepress.getLayoutAsyncComponent(n)||this.$vuepress.getVueComponent(n))?n:"Layout"}return"NotFound"}}},bl=t(0),yl=Object(bl.a)(vl,(function(){var n=this.$createElement;return(this._self._c||n)(this.layout,{tag:"component"})}),[],!1,null,null,null).exports;!function(n,e,t){switch(e){case"components":n[e]||(n[e]={}),Object.assign(n[e],t);break;case"mixins":n[e]||(n[e]=[]),n[e].push(...t);break;default:throw new Error("Unknown option name.")}}(yl,"mixins",hl);const _l=[{name:"v-22282852",path:"/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-22282852").then(t)}},{path:"/index.html",redirect:"/"},{name:"v-1ede408b",path:"/python/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-1ede408b").then(t)}},{path:"/python/index.html",redirect:"/python/"},{path:"/00.ç®å½/01.pythonä¹è·¯.html",redirect:"/python/"},{name:"v-302e23f4",path:"/code/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-302e23f4").then(t)}},{path:"/code/index.html",redirect:"/code/"},{path:"/00.ç®å½/03.ç¼ç¨.html",redirect:"/code/"},{name:"v-d1a6c318",path:"/k8s/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-d1a6c318").then(t)}},{path:"/k8s/index.html",redirect:"/k8s/"},{path:"/00.ç®å½/04.k8s.html",redirect:"/k8s/"},{name:"v-7a11f4c8",path:"/redis/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-7a11f4c8").then(t)}},{path:"/redis/index.html",redirect:"/redis/"},{path:"/00.ç®å½/05.redis.html",redirect:"/redis/"},{name:"v-4932a3f8",path:"/mysql/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-4932a3f8").then(t)}},{path:"/mysql/index.html",redirect:"/mysql/"},{path:"/00.ç®å½/06.mysql.html",redirect:"/mysql/"},{name:"v-033d1db6",path:"/readbook/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-033d1db6").then(t)}},{path:"/readbook/index.html",redirect:"/readbook/"},{path:"/00.ç®å½/07.è¯»ä¹¦ç ´ä¸å·.html",redirect:"/readbook/"},{name:"v-b983bcaa",path:"/go/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-b983bcaa").then(t)}},{path:"/go/index.html",redirect:"/go/"},{path:"/00.ç®å½/02.goä¹è·¯.html",redirect:"/go/"},{name:"v-a4110f34",path:"/CloudNative/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-a4110f34").then(t)}},{path:"/CloudNative/index.html",redirect:"/CloudNative/"},{path:"/00.ç®å½/08.äºåç.html",redirect:"/CloudNative/"},{name:"v-718cb9b0",path:"/docker/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-718cb9b0").then(t)}},{path:"/docker/index.html",redirect:"/docker/"},{path:"/00.ç®å½/10.docker.html",redirect:"/docker/"},{name:"v-7e40cffe",path:"/more/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-7e40cffe").then(t)}},{path:"/more/index.html",redirect:"/more/"},{path:"/00.ç®å½/100.æ´å¤.html",redirect:"/more/"},{name:"v-566b048c",path:"/kafka/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-566b048c").then(t)}},{path:"/kafka/index.html",redirect:"/kafka/"},{path:"/00.ç®å½/12.kafka.html",redirect:"/kafka/"},{name:"v-34e42639",path:"/middleware/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-34e42639").then(t)}},{path:"/middleware/index.html",redirect:"/middleware/"},{path:"/00.ç®å½/13.ä¸­é´ä»¶.html",redirect:"/middleware/"},{name:"v-423655cc",path:"/linux/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-423655cc").then(t)}},{path:"/linux/index.html",redirect:"/linux/"},{path:"/00.ç®å½/14.linux.html",redirect:"/linux/"},{name:"v-1b5f1ee8",path:"/pages/11aacc/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-1b5f1ee8").then(t)}},{path:"/pages/11aacc/index.html",redirect:"/pages/11aacc/"},{path:"/01.java/01.åºç¡ç¯/01.Javaåºç¡å°ç».html",redirect:"/pages/11aacc/"},{name:"v-b8532098",path:"/pages/b3eb48/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-b8532098").then(t)}},{path:"/pages/b3eb48/index.html",redirect:"/pages/b3eb48/"},{path:"/01.java/01.åºç¡ç¯/02.Javaåºæ¬æ°æ®ç±»å.html",redirect:"/pages/b3eb48/"},{name:"v-d5c1a816",path:"/pages/2e780e/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-d5c1a816").then(t)}},{path:"/pages/2e780e/index.html",redirect:"/pages/2e780e/"},{path:"/01.java/02.éåç¯/01.Javaéåæ¦è¿°.html",redirect:"/pages/2e780e/"},{name:"v-0b03f7cc",path:"/pages/dcfa33/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-0b03f7cc").then(t)}},{path:"/pages/dcfa33/index.html",redirect:"/pages/dcfa33/"},{path:"/01.java/02.éåç¯/02.Listæ¥å£.html",redirect:"/pages/dcfa33/"},{name:"v-7b03b51c",path:"/pages/4d8b8b/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-7b03b51c").then(t)}},{path:"/pages/4d8b8b/index.html",redirect:"/pages/4d8b8b/"},{path:"/01.java/02.éåç¯/03.Setæ¥å£.html",redirect:"/pages/4d8b8b/"},{name:"v-f9a862c8",path:"/pages/4c1680/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-f9a862c8").then(t)}},{path:"/pages/4c1680/index.html",redirect:"/pages/4c1680/"},{path:"/01.java/02.éåç¯/05.Mapæ¥å£.html",redirect:"/pages/4c1680/"},{name:"v-6bd8e8aa",path:"/pages/846d88/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-6bd8e8aa").then(t)}},{path:"/pages/846d88/index.html",redirect:"/pages/846d88/"},{path:"/01.java/03.å¹¶åç¯/01.Javaå¹¶ååºç¡å°ç».html",redirect:"/pages/846d88/"},{name:"v-5a7b351e",path:"/pages/5a6aca/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-5a7b351e").then(t)}},{path:"/pages/5a6aca/index.html",redirect:"/pages/5a6aca/"},{path:"/01.java/03.å¹¶åç¯/02.éè¯¦è§£.html",redirect:"/pages/5a6aca/"},{name:"v-0379b906",path:"/pages/e19c5d/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-0379b906").then(t)}},{path:"/pages/e19c5d/index.html",redirect:"/pages/e19c5d/"},{path:"/01.java/03.å¹¶åç¯/03.SynchronizedåVolatileçä½¿ç¨ä¸åºå«.html",redirect:"/pages/e19c5d/"},{name:"v-3223b15c",path:"/pages/887881/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-3223b15c").then(t)}},{path:"/pages/887881/index.html",redirect:"/pages/887881/"},{path:"/01.java/02.éåç¯/04.Queueæ¥å£.html",redirect:"/pages/887881/"},{name:"v-8cb0bf1a",path:"/pages/040070/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-8cb0bf1a").then(t)}},{path:"/pages/040070/index.html",redirect:"/pages/040070/"},{path:"/01.java/03.å¹¶åç¯/04.çº¿ç¨æ± è¯¦è§£.html",redirect:"/pages/040070/"},{name:"v-4d95c10a",path:"/pages/ff3623/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-4d95c10a").then(t)}},{path:"/pages/ff3623/index.html",redirect:"/pages/ff3623/"},{path:"/01.java/04.JVM/02.JVMå¸¸é®.html",redirect:"/pages/ff3623/"},{name:"v-47b0b8a9",path:"/pages/562a37/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-47b0b8a9").then(t)}},{path:"/pages/562a37/index.html",redirect:"/pages/562a37/"},{path:"/01.java/04.JVM/01.JVMåºç¡å¥é¨.html",redirect:"/pages/562a37/"},{name:"v-437ba2ee",path:"/pages/f3cf17/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-437ba2ee").then(t)}},{path:"/pages/f3cf17/index.html",redirect:"/pages/f3cf17/"},{path:"/01.äºåç/06.docker/01.å®¹å¨çæ¬è´¨.html",redirect:"/pages/f3cf17/"},{name:"v-7413a666",path:"/pages/0ddeb7/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-7413a666").then(t)}},{path:"/pages/0ddeb7/index.html",redirect:"/pages/0ddeb7/"},{path:"/01.äºåç/06.docker/04.dockerå®¹å¨åæºç½ç».html",redirect:"/pages/0ddeb7/"},{name:"v-fdfd34bc",path:"/pages/2b547f/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-fdfd34bc").then(t)}},{path:"/pages/2b547f/index.html",redirect:"/pages/2b547f/"},{path:"/01.äºåç/07.k8s/03.k8sä¹pod.html",redirect:"/pages/2b547f/"},{name:"v-d51b20aa",path:"/pages/f6a447/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-d51b20aa").then(t)}},{path:"/pages/f6a447/index.html",redirect:"/pages/f6a447/"},{path:"/01.java/03.å¹¶åç¯/05.CompletableFutureå­¦ä¹ .html",redirect:"/pages/f6a447/"},{name:"v-74234f32",path:"/pages/d73c88/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-74234f32").then(t)}},{path:"/pages/d73c88/index.html",redirect:"/pages/d73c88/"},{path:"/01.äºåç/07.k8s/04.k8sä¹deployment.html",redirect:"/pages/d73c88/"},{name:"v-0fd7c93e",path:"/pages/1f860b/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-0fd7c93e").then(t)}},{path:"/pages/1f860b/index.html",redirect:"/pages/1f860b/"},{path:"/01.äºåç/07.k8s/05.k8sä¹service.html",redirect:"/pages/1f860b/"},{name:"v-064e6b52",path:"/pages/ff8188/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-064e6b52").then(t)}},{path:"/pages/ff8188/index.html",redirect:"/pages/ff8188/"},{path:"/01.äºåç/07.k8s/06.k8sä¹ConfigMapåSecret.html",redirect:"/pages/ff8188/"},{name:"v-86796282",path:"/pages/c96905/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-86796282").then(t)}},{path:"/pages/c96905/index.html",redirect:"/pages/c96905/"},{path:"/01.äºåç/07.k8s/07.k8sä¹JobåCronJob.html",redirect:"/pages/c96905/"},{name:"v-1a0f65c8",path:"/pages/d3768c/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-1a0f65c8").then(t)}},{path:"/pages/d3768c/index.html",redirect:"/pages/d3768c/"},{path:"/01.äºåç/06.docker/03.æå¨å®ç°dockerå®¹å¨bridgeç½ç»æ¨¡å.html",redirect:"/pages/d3768c/"},{name:"v-642acf34",path:"/pages/92bee4/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-642acf34").then(t)}},{path:"/pages/92bee4/index.html",redirect:"/pages/92bee4/"},{path:"/01.äºåç/07.k8s/08.k8sä¹DaemonSet.html",redirect:"/pages/92bee4/"},{name:"v-86799138",path:"/pages/095c75/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-86799138").then(t)}},{path:"/pages/095c75/index.html",redirect:"/pages/095c75/"},{path:"/01.äºåç/07.k8s/09.k8sä¹PVãPVCåStorageClass.html",redirect:"/pages/095c75/"},{name:"v-1eacf608",path:"/pages/d178a2/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-1eacf608").then(t)}},{path:"/pages/d178a2/index.html",redirect:"/pages/d178a2/"},{path:"/01.äºåç/07.k8s/10.k8sä¹StatefulSet.html",redirect:"/pages/d178a2/"},{name:"v-77369d13",path:"/pages/39f36e/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-77369d13").then(t)}},{path:"/pages/39f36e/index.html",redirect:"/pages/39f36e/"},{path:"/01.äºåç/06.docker/02.dockerå®¹å¨.html",redirect:"/pages/39f36e/"},{name:"v-8f1b0f62",path:"/pages/9e17c8/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-8f1b0f62").then(t)}},{path:"/pages/9e17c8/index.html",redirect:"/pages/9e17c8/"},{path:"/01.äºåç/07.k8s/11.ä½¿ç¨kubeadmå®è£k8s.html",redirect:"/pages/9e17c8/"},{name:"v-f08b0a92",path:"/pages/27987d/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-f08b0a92").then(t)}},{path:"/pages/27987d/index.html",redirect:"/pages/27987d/"},{path:"/01.äºåç/07.k8s/12.podä¸­å°ä»£ç ä¸è¿è¡ç¯å¢åç¦».html",redirect:"/pages/27987d/"},{name:"v-0fd01db7",path:"/pages/b1b4a3/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-0fd01db7").then(t)}},{path:"/pages/b1b4a3/index.html",redirect:"/pages/b1b4a3/"},{path:"/01.äºåç/07.k8s/13.djangoåç«¯æå¡ãlogstashåflinkæ¥å¥VictoriaMetricsææ çæ§.html",redirect:"/pages/b1b4a3/"},{name:"v-11e81284",path:"/pages/f0f725/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-11e81284").then(t)}},{path:"/pages/f0f725/index.html",redirect:"/pages/f0f725/"},{path:"/01.äºåç/07.k8s/15.çè§£calicoå®¹å¨ç½ç»éä¿¡æ¹æ¡åç.html",redirect:"/pages/f0f725/"},{name:"v-be038f46",path:"/pages/d9d0ce/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-be038f46").then(t)}},{path:"/pages/d9d0ce/index.html",redirect:"/pages/d9d0ce/"},{path:"/01.äºåç/07.k8s/14.çè§£flannelçä¸ç§å®¹å¨ç½ç»æ¹æ¡åç.html",redirect:"/pages/d9d0ce/"},{name:"v-6cbb1851",path:"/pages/b3955c/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-6cbb1851").then(t)}},{path:"/pages/b3955c/index.html",redirect:"/pages/b3955c/"},{path:"/01.äºåç/07.k8s/16.kubernetes serviceå¦ä½éè¿iptablesè½¬å.html",redirect:"/pages/b3955c/"},{name:"v-67c4fe98",path:"/pages/fa114f/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-67c4fe98").then(t)}},{path:"/pages/fa114f/index.html",redirect:"/pages/fa114f/"},{path:"/03.ä¸­é´ä»¶/01.kafka/01.listeneråadvertised.listenersçä½ç¨.html",redirect:"/pages/fa114f/"},{name:"v-cc91cd44",path:"/pages/2d69c7/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-cc91cd44").then(t)}},{path:"/pages/2d69c7/index.html",redirect:"/pages/2d69c7/"},{path:"/03.ä¸­é´ä»¶/03.mysql/01.mysqlä¹æ¥å¿.html",redirect:"/pages/2d69c7/"},{name:"v-16efd28d",path:"/pages/0d8f4a/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-16efd28d").then(t)}},{path:"/pages/0d8f4a/index.html",redirect:"/pages/0d8f4a/"},{path:"/03.ä¸­é´ä»¶/03.mysql/02.mysqlä¹MVCCåç.html",redirect:"/pages/0d8f4a/"},{name:"v-079101b0",path:"/pages/6e0045/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-079101b0").then(t)}},{path:"/pages/6e0045/index.html",redirect:"/pages/6e0045/"},{path:"/01.äºåç/07.k8s/17.kube-proxyæºç åæ.html",redirect:"/pages/6e0045/"},{name:"v-27753cf3",path:"/pages/2bbeb3/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-27753cf3").then(t)}},{path:"/pages/2bbeb3/index.html",redirect:"/pages/2bbeb3/"},{path:"/03.ä¸­é´ä»¶/05.redis/01.redisä¹äºç§åºæ¬æ°æ®ç±»å.html",redirect:"/pages/2bbeb3/"},{name:"v-d04209ac",path:"/pages/4c6b13/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-d04209ac").then(t)}},{path:"/pages/4c6b13/index.html",redirect:"/pages/4c6b13/"},{path:"/03.ä¸­é´ä»¶/05.redis/02.redisä¹æä¹å.html",redirect:"/pages/4c6b13/"},{name:"v-7a226c10",path:"/pages/8072eb/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-7a226c10").then(t)}},{path:"/pages/8072eb/index.html",redirect:"/pages/8072eb/"},{path:"/03.ä¸­é´ä»¶/05.redis/03. redisä¹ä¸»ä»åºåæ­¥.html",redirect:"/pages/8072eb/"},{name:"v-97fa14a4",path:"/pages/ffee9e/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-97fa14a4").then(t)}},{path:"/pages/ffee9e/index.html",redirect:"/pages/ffee9e/"},{path:"/03.ä¸­é´ä»¶/05.redis/04. redisä¹å¨åµæºå¶.html",redirect:"/pages/ffee9e/"},{name:"v-8855b59c",path:"/pages/1c2914/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-8855b59c").then(t)}},{path:"/pages/1c2914/index.html",redirect:"/pages/1c2914/"},{path:"/03.ä¸­é´ä»¶/05.redis/05. redisä¹åçéç¾¤.html",redirect:"/pages/1c2914/"},{name:"v-3dc84304",path:"/pages/0d7b25/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-3dc84304").then(t)}},{path:"/pages/0d7b25/index.html",redirect:"/pages/0d7b25/"},{path:"/03.ä¸­é´ä»¶/05.redis/06. redisä¹ç¼å­.html",redirect:"/pages/0d7b25/"},{name:"v-cee6b5d2",path:"/pages/e31b06/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-cee6b5d2").then(t)}},{path:"/pages/e31b06/index.html",redirect:"/pages/e31b06/"},{path:"/04.ç¼ç¨/01.python/01.åºç¡/01.pythonè¿­ä»£å¨ä¸çæå¨.html",redirect:"/pages/e31b06/"},{name:"v-5be0bc4c",path:"/pages/78c648/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-5be0bc4c").then(t)}},{path:"/pages/78c648/index.html",redirect:"/pages/78c648/"},{path:"/04.ç¼ç¨/01.python/01.åºç¡/03.pythonåå¾åæ¶æºå¶.html",redirect:"/pages/78c648/"},{name:"v-54ae2f6d",path:"/pages/a6b804/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-54ae2f6d").then(t)}},{path:"/pages/a6b804/index.html",redirect:"/pages/a6b804/"},{path:"/04.ç¼ç¨/01.python/01.åºç¡/04.pythonä¸ä¸æç®¡çå¨.html",redirect:"/pages/a6b804/"},{name:"v-6b5349e8",path:"/pages/5fa368/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-6b5349e8").then(t)}},{path:"/pages/5fa368/index.html",redirect:"/pages/5fa368/"},{path:"/04.ç¼ç¨/01.python/01.åºç¡/02.pythonåç¼ç¨.html",redirect:"/pages/5fa368/"},{name:"v-788e5ef9",path:"/pages/33b8d0/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-788e5ef9").then(t)}},{path:"/pages/33b8d0/index.html",redirect:"/pages/33b8d0/"},{path:"/04.ç¼ç¨/01.python/01.åºç¡/06.ä½¿ç¨pythonå®ç°åä¾æ¨¡å¼çä¸ç§æ¹å¼.html",redirect:"/pages/33b8d0/"},{name:"v-597fc7ce",path:"/pages/7434f1/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-597fc7ce").then(t)}},{path:"/pages/7434f1/index.html",redirect:"/pages/7434f1/"},{path:"/04.ç¼ç¨/01.python/01.åºç¡/05.pythonè£é¥°å¨çä½¿ç¨æ¹æ³.html",redirect:"/pages/7434f1/"},{name:"v-0e418e98",path:"/pages/d8fd49/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-0e418e98").then(t)}},{path:"/pages/d8fd49/index.html",redirect:"/pages/d8fd49/"},{path:"/04.ç¼ç¨/01.python/01.åºç¡/07.pythonä¸­importåç.html",redirect:"/pages/d8fd49/"},{name:"v-208228f3",path:"/pages/8d9ab9/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-208228f3").then(t)}},{path:"/pages/8d9ab9/index.html",redirect:"/pages/8d9ab9/"},{path:"/04.ç¼ç¨/01.python/02.ç¬¬ä¸æ¹åº/01.ä½¿ç¨ddtå®ç°unittestçåæ°åæµè¯.html",redirect:"/pages/8d9ab9/"},{name:"v-4534d8ad",path:"/pages/069c65/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-4534d8ad").then(t)}},{path:"/pages/069c65/index.html",redirect:"/pages/069c65/"},{path:"/04.ç¼ç¨/01.python/02.ç¬¬ä¸æ¹åº/02.ddtæºç åæ.html",redirect:"/pages/069c65/"},{name:"v-98683fbe",path:"/pages/ec5110/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-98683fbe").then(t)}},{path:"/pages/ec5110/index.html",redirect:"/pages/ec5110/"},{path:"/04.ç¼ç¨/01.python/02.ç¬¬ä¸æ¹åº/03.django-apscheduleå®æ¶ä»»å¡å¼å¸¸åæ­¢.html",redirect:"/pages/ec5110/"},{name:"v-7dfe11b0",path:"/pages/853501/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-7dfe11b0").then(t)}},{path:"/pages/853501/index.html",redirect:"/pages/853501/"},{path:"/04.ç¼ç¨/01.python/06.django/01.django celery ç»åä½¿ç¨.html",redirect:"/pages/853501/"},{name:"v-502d161c",path:"/pages/626675/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-502d161c").then(t)}},{path:"/pages/626675/index.html",redirect:"/pages/626675/"},{path:"/04.ç¼ç¨/01.python/06.django/03.django rest_framework Authentication.html",redirect:"/pages/626675/"},{name:"v-abb9096c",path:"/pages/070fec/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-abb9096c").then(t)}},{path:"/pages/070fec/index.html",redirect:"/pages/070fec/"},{path:"/04.ç¼ç¨/01.python/06.django/04.django rest_frameworkå¼å¸¸å¤ç.html",redirect:"/pages/070fec/"},{name:"v-2c646377",path:"/pages/c3af6a/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-2c646377").then(t)}},{path:"/pages/c3af6a/index.html",redirect:"/pages/c3af6a/"},{path:"/04.ç¼ç¨/01.python/06.django/05.django rest_framework èªå®ä¹ææ¡£.html",redirect:"/pages/c3af6a/"},{name:"v-bb440a42",path:"/pages/f2738b/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-bb440a42").then(t)}},{path:"/pages/f2738b/index.html",redirect:"/pages/f2738b/"},{path:"/04.ç¼ç¨/01.python/06.django/06.djangoåç¼©æä»¶ä¸è½½.html",redirect:"/pages/f2738b/"},{name:"v-50cf7a82",path:"/pages/c28126/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-50cf7a82").then(t)}},{path:"/pages/c28126/index.html",redirect:"/pages/c28126/"},{path:"/04.ç¼ç¨/01.python/06.django/07.django rest_frameworkä½¿ç¨pytestååæµè¯.html",redirect:"/pages/c28126/"},{name:"v-6e6e165e",path:"/pages/b90015/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-6e6e165e").then(t)}},{path:"/pages/b90015/index.html",redirect:"/pages/b90015/"},{path:"/04.ç¼ç¨/01.python/06.django/08.django restframework choice èªå®ä¹è¾åºæ°æ®.html",redirect:"/pages/b90015/"},{name:"v-72f4b6b0",path:"/pages/cfdb5f/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-72f4b6b0").then(t)}},{path:"/pages/cfdb5f/index.html",redirect:"/pages/cfdb5f/"},{path:"/04.ç¼ç¨/01.python/06.django/09.django Filtering ä½¿ç¨.html",redirect:"/pages/cfdb5f/"},{name:"v-3e16c4d8",path:"/pages/e75ceb/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-3e16c4d8").then(t)}},{path:"/pages/e75ceb/index.html",redirect:"/pages/e75ceb/"},{path:"/04.ç¼ç¨/01.python/06.django/10.django viewset å Router éåä½¿ç¨æ¶æ¥çé.html",redirect:"/pages/e75ceb/"},{name:"v-242c57bc",path:"/pages/acdd50/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-242c57bc").then(t)}},{path:"/pages/acdd50/index.html",redirect:"/pages/acdd50/"},{path:"/04.ç¼ç¨/01.python/06.django/11.django modelçåºåå.html",redirect:"/pages/acdd50/"},{name:"v-580c8dac",path:"/pages/382755/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-580c8dac").then(t)}},{path:"/pages/382755/index.html",redirect:"/pages/382755/"},{path:"/04.ç¼ç¨/01.python/06.django/12.djangoä¸­ä½¿ç¨AbStractUser.html",redirect:"/pages/382755/"},{name:"v-669ddbd6",path:"/pages/060c51/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-669ddbd6").then(t)}},{path:"/pages/060c51/index.html",redirect:"/pages/060c51/"},{path:"/04.ç¼ç¨/01.python/06.django/13.django.core.exceptions.ImproperlyConfigured Application labels aren't unique, duplicates users.html",redirect:"/pages/060c51/"},{name:"v-5f11081e",path:"/pages/de01e2/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-5f11081e").then(t)}},{path:"/pages/de01e2/index.html",redirect:"/pages/de01e2/"},{path:"/04.ç¼ç¨/01.python/06.django/14.django ä¸­ mediaéç½®.html",redirect:"/pages/de01e2/"},{name:"v-e8f812b8",path:"/pages/b422bd/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-e8f812b8").then(t)}},{path:"/pages/b422bd/index.html",redirect:"/pages/b422bd/"},{path:"/04.ç¼ç¨/01.python/06.django/15.django å¤é®å¼ç¨èªèº«åon_deleteåæ°.html",redirect:"/pages/b422bd/"},{name:"v-35d0167d",path:"/pages/f0d816/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-35d0167d").then(t)}},{path:"/pages/f0d816/index.html",redirect:"/pages/f0d816/"},{path:"/04.ç¼ç¨/01.python/06.django/16.django è­¦å while time zone support is active.html",redirect:"/pages/f0d816/"},{name:"v-788c4982",path:"/pages/cb262f/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-788c4982").then(t)}},{path:"/pages/cb262f/index.html",redirect:"/pages/cb262f/"},{path:"/04.ç¼ç¨/01.python/06.django/17.django rest_framework åé¡µ.html",redirect:"/pages/cb262f/"},{name:"v-f7e64afe",path:"/pages/b71dc2/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-f7e64afe").then(t)}},{path:"/pages/b71dc2/index.html",redirect:"/pages/b71dc2/"},{path:"/04.ç¼ç¨/01.python/07.flask/01.Flaskä½¿ç¨flask_socketioå®ç°websocket.html",redirect:"/pages/b71dc2/"},{name:"v-3c157da4",path:"/pages/c59edf/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-3c157da4").then(t)}},{path:"/pages/c59edf/index.html",redirect:"/pages/c59edf/"},{path:"/04.ç¼ç¨/01.python/07.flask/02.flaskç»åmongo.html",redirect:"/pages/c59edf/"},{name:"v-069fea3d",path:"/pages/4c38f5/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-069fea3d").then(t)}},{path:"/pages/4c38f5/index.html",redirect:"/pages/4c38f5/"},{path:"/04.ç¼ç¨/01.python/08.tornado/01.tornado æä»¶ä¸ä¼ .html",redirect:"/pages/4c38f5/"},{name:"v-2e6d253f",path:"/pages/c24905/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-2e6d253f").then(t)}},{path:"/pages/c24905/index.html",redirect:"/pages/c24905/"},{path:"/04.ç¼ç¨/01.python/08.tornado/02.tornado ä½¿ç¨jwtå®æç¨æ·å¼æ­¥è®¤è¯.html",redirect:"/pages/c24905/"},{name:"v-573b59b6",path:"/pages/7ac01f/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-573b59b6").then(t)}},{path:"/pages/7ac01f/index.html",redirect:"/pages/7ac01f/"},{path:"/04.ç¼ç¨/01.python/08.tornado/04.tornado ç»åwtformsä½¿ç¨è¡¨åæä½.html",redirect:"/pages/7ac01f/"},{name:"v-0056c406",path:"/pages/d18657/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-0056c406").then(t)}},{path:"/pages/d18657/index.html",redirect:"/pages/d18657/"},{path:"/04.ç¼ç¨/01.python/08.tornado/05.tornado finishåwriteåºå«.html",redirect:"/pages/d18657/"},{name:"v-fc3c6860",path:"/pages/22f35b/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-fc3c6860").then(t)}},{path:"/pages/22f35b/index.html",redirect:"/pages/22f35b/"},{path:"/04.ç¼ç¨/01.python/08.tornado/03.tornado ç¨æ·å¯ç  bcryptå å¯.html",redirect:"/pages/22f35b/"},{name:"v-3b941cbe",path:"/pages/f9d78c/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-3b941cbe").then(t)}},{path:"/pages/f9d78c/index.html",redirect:"/pages/f9d78c/"},{path:"/04.ç¼ç¨/01.python/09.å¶ä»/01.pythonç®åä½¿ç¨grpc.html",redirect:"/pages/f9d78c/"},{name:"v-05407dda",path:"/pages/113ab1/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-05407dda").then(t)}},{path:"/pages/113ab1/index.html",redirect:"/pages/113ab1/"},{path:"/04.ç¼ç¨/01.python/08.tornado/06.tornado ä½¿ç¨peewee-async å®æå¼æ­¥ormæ°æ®åºæä½.html",redirect:"/pages/113ab1/"},{name:"v-a1f03dba",path:"/pages/72664a/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-a1f03dba").then(t)}},{path:"/pages/72664a/index.html",redirect:"/pages/72664a/"},{path:"/04.ç¼ç¨/01.python/09.å¶ä»/02.pyspark streamingç®ä» å æ¶è´¹ kafkaç¤ºä¾.html",redirect:"/pages/72664a/"},{name:"v-ec68963a",path:"/pages/87014e/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-ec68963a").then(t)}},{path:"/pages/87014e/index.html",redirect:"/pages/87014e/"},{path:"/04.ç¼ç¨/02.go/01.goç®åä½¿ç¨grpc.html",redirect:"/pages/87014e/"},{name:"v-37dbc27d",path:"/pages/c41003/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-37dbc27d").then(t)}},{path:"/pages/c41003/index.html",redirect:"/pages/c41003/"},{path:"/04.ç¼ç¨/02.go/02. ginä¸­validatoræ¨¡åçæºç åæ.html",redirect:"/pages/c41003/"},{name:"v-118bdc85",path:"/pages/cf9a4d/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-118bdc85").then(t)}},{path:"/pages/cf9a4d/index.html",redirect:"/pages/cf9a4d/"},{path:"/04.ç¼ç¨/02.go/03.ä¼åginè¡¨åçéè¯¯æç¤ºä¿¡æ¯.html",redirect:"/pages/cf9a4d/"},{name:"v-fdcf4762",path:"/pages/d93df5/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-fdcf4762").then(t)}},{path:"/pages/d93df5/index.html",redirect:"/pages/d93df5/"},{path:"/04.ç¼ç¨/02.go/04.goä¸­å¦ä½å¤çerror.html",redirect:"/pages/d93df5/"},{name:"v-21216af8",path:"/pages/72ba9a/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-21216af8").then(t)}},{path:"/pages/72ba9a/index.html",redirect:"/pages/72ba9a/"},{path:"/04.ç¼ç¨/03.linux/01.å¿«éäºè§£iptables.html",redirect:"/pages/72ba9a/"},{name:"v-325b46da",path:"/pages/143447/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-325b46da").then(t)}},{path:"/pages/143447/index.html",redirect:"/pages/143447/"},{path:"/04.ç¼ç¨/03.linux/02.çè§£Linux TunTapè®¾å¤.html",redirect:"/pages/143447/"},{name:"v-3e69314c",path:"/pages/8a4b28/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-3e69314c").then(t)}},{path:"/pages/8a4b28/index.html",redirect:"/pages/8a4b28/"},{path:"/04.ç¼ç¨/03.linux/03.çè§£VXLANç½ç».html",redirect:"/pages/8a4b28/"},{name:"v-31a5e395",path:"/pages/36b0b2/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-31a5e395").then(t)}},{path:"/pages/36b0b2/index.html",redirect:"/pages/36b0b2/"},{path:"/04.ç¼ç¨/02.go/05.tcpç¼å­å¼èµ·çæ¥å¿ä¸¢å¤±.html",redirect:"/pages/36b0b2/"},{name:"v-e9cb914e",path:"/pages/7f16f6/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-e9cb914e").then(t)}},{path:"/pages/7f16f6/index.html",redirect:"/pages/7f16f6/"},{path:"/04.ç¼ç¨/09.å¶ä»/03.ä½¿ç¨javaå¼ålogstashçfilteræä»¶.html",redirect:"/pages/7f16f6/"},{name:"v-087ac98a",path:"/pages/d91dfb/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-087ac98a").then(t)}},{path:"/pages/d91dfb/index.html",redirect:"/pages/d91dfb/"},{path:"/04.ç¼ç¨/09.å¶ä»/01.åå¸å¼é.html",redirect:"/pages/d91dfb/"},{name:"v-05a28fa4",path:"/pages/19cfb6/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-05a28fa4").then(t)}},{path:"/pages/19cfb6/index.html",redirect:"/pages/19cfb6/"},{path:"/04.ç¼ç¨/09.å¶ä»/20.countçæ§è½ä¼å.html",redirect:"/pages/19cfb6/"},{name:"v-8c516c3e",path:"/pages/aba491/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-8c516c3e").then(t)}},{path:"/pages/aba491/index.html",redirect:"/pages/aba491/"},{path:"/04.ç¼ç¨/09.å¶ä»/02.ä½¿ç¨hueåå»ºozzieçpyspark action workflow.html",redirect:"/pages/aba491/"},{name:"v-54f1c73c",path:"/about/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-54f1c73c").then(t)}},{path:"/about/index.html",redirect:"/about/"},{path:"/08.å³äº/01.å³äº.html",redirect:"/about/"},{name:"v-567cb3a8",path:"/pages/8bdb8d/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-567cb3a8").then(t)}},{path:"/pages/8bdb8d/index.html",redirect:"/pages/8bdb8d/"},{path:"/05.è¯»ä¹¦ç ´ä¸å·/01.å¦ä½éè¯»ä¸æ¬ä¹¦.html",redirect:"/pages/8bdb8d/"},{name:"v-0485a99b",path:"/friends/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-0485a99b").then(t)}},{path:"/friends/index.html",redirect:"/friends/"},{path:"/09.æ´å¤/02.åé¾.html",redirect:"/friends/"},{name:"v-e5fb5ede",path:"/pages/277c5b/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-e5fb5ede").then(t)}},{path:"/pages/277c5b/index.html",redirect:"/pages/277c5b/"},{path:"/01.java/03.å¹¶åç¯/10.Javaåå­ç®¡çæ»ç».html",redirect:"/pages/277c5b/"},{name:"v-e627318a",path:"/pages/c128e7/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-e627318a").then(t)}},{path:"/pages/c128e7/index.html",redirect:"/pages/c128e7/"},{path:"/04.ç¼ç¨/03.linux/04.çè§£Linux IPIPé§é.html",redirect:"/pages/c128e7/"},{name:"v-7ffecc44",path:"/categories/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-7ffecc44").then(t)}},{path:"/categories/index.html",redirect:"/categories/"},{path:"/@pages/categoriesPage.html",redirect:"/categories/"},{name:"v-25855433",path:"/pages/25eafd/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-25855433").then(t)}},{path:"/pages/25eafd/index.html",redirect:"/pages/25eafd/"},{path:"/04.ç¼ç¨/01.python/06.django/02.django rest_frameworkä½¿ç¨jwt.html",redirect:"/pages/25eafd/"},{name:"v-8d4bc20e",path:"/pages/beb6c0bd8a66cea6/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-8d4bc20e").then(t)}},{path:"/pages/beb6c0bd8a66cea6/index.html",redirect:"/pages/beb6c0bd8a66cea6/"},{path:"/09.æ´å¤/01.æ¶è.html",redirect:"/pages/beb6c0bd8a66cea6/"},{name:"v-6cd702fe",path:"/archives/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-6cd702fe").then(t)}},{path:"/archives/index.html",redirect:"/archives/"},{path:"/@pages/archivesPage.html",redirect:"/archives/"},{name:"v-16e3f17e",path:"/tags/",component:yl,beforeEnter:(n,e,t)=>{di("Layout","v-16e3f17e").then(t)}},{path:"/tags/index.html",redirect:"/tags/"},{path:"/@pages/tagsPage.html",redirect:"/tags/"},{path:"*",component:yl}],kl={title:"éä¸æ¸é£çåå®¢",description:"ææ¯åå®¢ï¼ä¸æ³¨äºåç«¯å­¦ä¹ ä¸æ»ç»ï¼python,go,redis,k8s,mysql,kafka,flask,django,tornado,git,github,markdownç­ææ¯ç±»æç« ",base:"/",headTags:[["link",{rel:"icon",href:"/img/favicon.ico"}],["meta",{name:"keywords",content:"åç«¯åå®¢,ä¸ªäººææ¯åå®¢,åç«¯,åç«¯å¼å,åç«¯æ¡æ¶,åç«¯é¢è¯é¢,ææ¯ææ¡£,å­¦ä¹ ,é¢è¯,python,go,redis,k8s,mysql,kafka,flask,django,tornado,git,github,markdown"}],["meta",{name:"baidu-site-verification",content:"7F55weZDDc"}],["meta",{name:"theme-color",content:"#11a8cd"}],["meta",{name:"viewport",content:"width=device-width, initial-scale=1"}],["script",{},'var _hmt = _hmt || [];\n      (function() {\n        var hm = document.createElement("script");\n        hm.src = "https://hm.baidu.com/hm.js?7c28cc47ffa100de44e976f816b0b294";\n        var s = document.getElementsByTagName("script")[0]; \n        s.parentNode.insertBefore(hm, s);\n      })();'],["link",{rel:"alternate",type:"application/rss+xml",href:"https://www.zhengwenfeng.com/rss.xml",title:"éä¸æ¸é£çåå®¢ RSS Feed"}],["link",{rel:"alternate",type:"application/atom+xml",href:"https://www.zhengwenfeng.com/feed.atom",title:"éä¸æ¸é£çåå®¢ Atom Feed"}],["link",{rel:"alternate",type:"application/json",href:"https://www.zhengwenfeng.com/feed.json",title:"éä¸æ¸é£çåå®¢ JSON Feed"}]],pages:[{title:"Home",frontmatter:{home:!0,heroText:"éä¸æ¸é£çåå®¢",tagline:"æé»é,å¤æ­»å¯ç£ã",hideRightBar:!1,description:"ææ¯åå®¢ï¼ä¸æ³¨äºåç«¯å­¦ä¹ ä¸æ»ç»ï¼python,go,redis,k8s,mysql,kafka,flask,django,tornado,git,github,markdownç­ææ¯ç±»æç« ",meta:[{name:"image",content:"https://www.msqfx.cc/img/panda-waving.png"},{name:"twitter:title",content:"éä¸æ¸é£çåå®¢"},{name:"twitter:description",content:"ææ¯åå®¢ï¼ä¸æ³¨äºåç«¯å­¦ä¹ ä¸æ»ç»ï¼python,go,redis,k8s,mysql,kafka,flask,django,tornado,git,github,markdownç­ææ¯ç±»æç« "},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://www.msqfx.cc/img/panda-waving.png"},{name:"twitter:url",content:"https://www.msqfx.cc/"},{property:"og:type",content:"website"},{property:"og:title",content:"éä¸æ¸é£çåå®¢"},{property:"og:description",content:"ææ¯åå®¢ï¼ä¸æ³¨äºåç«¯å­¦ä¹ ä¸æ»ç»ï¼python,go,redis,k8s,mysql,kafka,flask,django,tornado,git,github,markdownç­ææ¯ç±»æç« "},{property:"og:image",content:"https://www.msqfx.cc/img/panda-waving.png"},{property:"og:url",content:"https://www.msqfx.cc/"},{property:"og:site_name",content:"msqfx"},{itemprop:"name",content:"éä¸æ¸é£çåå®¢"},{itemprop:"description",content:"ææ¯åå®¢ï¼ä¸æ³¨äºåç«¯å­¦ä¹ ä¸æ»ç»ï¼python,go,redis,k8s,mysql,kafka,flask,django,tornado,git,github,markdownç­ææ¯ç±»æç« "},{itemprop:"image",content:"https://www.msqfx.cc/img/panda-waving.png"}],readingShow:"top"},regularPath:"/",relativePath:"index.md",key:"v-22282852",path:"/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2022/10/31, 21:57:05",lastUpdatedTimestamp:1667224625e3},{title:"pythonä¹è·¯",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.ç¼ç¨/01.python",description:"äººçè¦ç­ï¼æç¨python"}},title:"pythonä¹è·¯",date:"2022-09-07T22:23:24.000Z",permalink:"/python/",sidebar:!1,article:!1,comment:!1,editLink:!1,description:"",author:{name:"msqfx",link:"https://github.com/msqfx"},meta:[{name:"twitter:title",content:"pythonä¹è·¯"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/01.python%E4%B9%8B%E8%B7%AF.html"},{property:"og:type",content:"article"},{property:"og:title",content:"pythonä¹è·¯"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/01.python%E4%B9%8B%E8%B7%AF.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-09-07T22:23:24.000Z"},{itemprop:"name",content:"pythonä¹è·¯"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/00.%E7%9B%AE%E5%BD%95/01.python%E4%B9%8B%E8%B7%AF.html",relativePath:"00.ç®å½/01.pythonä¹è·¯.md",key:"v-1ede408b",path:"/python/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"ç¼ç¨",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.ç¼ç¨",description:"ç¼ç¨"}},title:"ç¼ç¨",date:"2022-09-07T22:23:26.000Z",permalink:"/code/",sidebar:!1,article:!1,comment:!1,editLink:!1,description:"",author:{name:"msqfx",link:"https://github.com/msqfx"},meta:[{name:"twitter:title",content:"ç¼ç¨"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/03.%E7%BC%96%E7%A8%8B.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ç¼ç¨"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/03.%E7%BC%96%E7%A8%8B.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-09-07T22:23:26.000Z"},{itemprop:"name",content:"ç¼ç¨"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/00.%E7%9B%AE%E5%BD%95/03.%E7%BC%96%E7%A8%8B.html",relativePath:"00.ç®å½/03.ç¼ç¨.md",key:"v-302e23f4",path:"/code/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"k8s",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"01.äºåç/07.k8s",description:"k8s"}},title:"k8s",date:"2023-01-07T18:33:01.000Z",permalink:"/k8s/",sidebar:!1,article:!1,comment:!1,editLink:!1,description:"",author:{name:"msqfx",link:"https://github.com/msqfx"},meta:[{name:"twitter:title",content:"k8s"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/04.k8s.html"},{property:"og:type",content:"article"},{property:"og:title",content:"k8s"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/04.k8s.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-01-07T18:33:01.000Z"},{itemprop:"name",content:"k8s"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/00.%E7%9B%AE%E5%BD%95/04.k8s.html",relativePath:"00.ç®å½/04.k8s.md",key:"v-d1a6c318",path:"/k8s/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/01/08, 21:19:56",lastUpdatedTimestamp:1673183996e3},{title:"redis",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"03.ä¸­é´ä»¶/05.redis",description:"redis"}},title:"redis",date:"2023-01-07T18:33:02.000Z",permalink:"/redis/",sidebar:!1,article:!1,comment:!1,editLink:!1,description:"",author:{name:"msqfx",link:"https://github.com/msqfx"},meta:[{name:"twitter:title",content:"redis"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/05.redis.html"},{property:"og:type",content:"article"},{property:"og:title",content:"redis"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/05.redis.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-01-07T18:33:02.000Z"},{itemprop:"name",content:"redis"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/00.%E7%9B%AE%E5%BD%95/05.redis.html",relativePath:"00.ç®å½/05.redis.md",key:"v-7a11f4c8",path:"/redis/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/11/01, 11:48:43",lastUpdatedTimestamp:1698810523e3},{title:"mysql",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"03.ä¸­é´ä»¶/03.mysql",description:"mysql"}},title:"mysql",date:"2023-01-07T18:33:03.000Z",permalink:"/mysql/",sidebar:!1,article:!1,comment:!1,editLink:!1,description:"",author:{name:"msqfx",link:"https://github.com/msqfx"},meta:[{name:"twitter:title",content:"mysql"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/06.mysql.html"},{property:"og:type",content:"article"},{property:"og:title",content:"mysql"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/06.mysql.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-01-07T18:33:03.000Z"},{itemprop:"name",content:"mysql"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/00.%E7%9B%AE%E5%BD%95/06.mysql.html",relativePath:"00.ç®å½/06.mysql.md",key:"v-4932a3f8",path:"/mysql/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/11/01, 11:48:43",lastUpdatedTimestamp:1698810523e3},{title:"è¯»ä¹¦ç ´ä¸å·",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"05.è¯»ä¹¦ç ´ä¸å·",description:"è¯»ä¹¦ç ´ä¸å·"}},title:"è¯»ä¹¦ç ´ä¸å·",date:"2023-01-07T18:33:04.000Z",permalink:"/readbook/",sidebar:!1,article:!1,comment:!1,editLink:!1,description:"",author:{name:"msqfx",link:"https://github.com/msqfx"},meta:[{name:"twitter:title",content:"è¯»ä¹¦ç ´ä¸å·"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/07.%E8%AF%BB%E4%B9%A6%E7%A0%B4%E4%B8%87%E5%8D%B7.html"},{property:"og:type",content:"article"},{property:"og:title",content:"è¯»ä¹¦ç ´ä¸å·"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/07.%E8%AF%BB%E4%B9%A6%E7%A0%B4%E4%B8%87%E5%8D%B7.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-01-07T18:33:04.000Z"},{itemprop:"name",content:"è¯»ä¹¦ç ´ä¸å·"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/00.%E7%9B%AE%E5%BD%95/07.%E8%AF%BB%E4%B9%A6%E7%A0%B4%E4%B8%87%E5%8D%B7.html",relativePath:"00.ç®å½/07.è¯»ä¹¦ç ´ä¸å·.md",key:"v-033d1db6",path:"/readbook/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"goä¹è·¯",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.ç¼ç¨/02.go",description:"å°±æ¯å¹²"}},title:"goä¹è·¯",permalink:"/go/",sidebar:!1,article:!1,comment:!1,editLink:!1,author:{name:"msqfx",link:"https://github.com/msqfx"},date:"2022-09-07T22:23:25.000Z",description:"",feed:{enable:!0},meta:[{name:"twitter:title",content:"goä¹è·¯"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/02.go%E4%B9%8B%E8%B7%AF.html"},{property:"og:type",content:"article"},{property:"og:title",content:"goä¹è·¯"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/02.go%E4%B9%8B%E8%B7%AF.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-09-07T22:23:25.000Z"},{itemprop:"name",content:"goä¹è·¯"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/00.%E7%9B%AE%E5%BD%95/02.go%E4%B9%8B%E8%B7%AF.html",relativePath:"00.ç®å½/02.goä¹è·¯.md",key:"v-b983bcaa",path:"/go/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"äºåç",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"01.äºåç",description:"äºåç"}},title:"äºåç",date:"2023-01-07T18:33:04.000Z",permalink:"/CloudNative/",sidebar:!1,article:!1,comment:!1,editLink:!1,description:"",author:{name:"msqfx",link:"https://github.com/msqfx"},meta:[{name:"twitter:title",content:"äºåç"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/08.%E4%BA%91%E5%8E%9F%E7%94%9F.html"},{property:"og:type",content:"article"},{property:"og:title",content:"äºåç"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/08.%E4%BA%91%E5%8E%9F%E7%94%9F.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-01-07T18:33:04.000Z"},{itemprop:"name",content:"äºåç"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/00.%E7%9B%AE%E5%BD%95/08.%E4%BA%91%E5%8E%9F%E7%94%9F.html",relativePath:"00.ç®å½/08.äºåç.md",key:"v-a4110f34",path:"/CloudNative/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/01/08, 21:19:56",lastUpdatedTimestamp:1673183996e3},{title:"docker",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"01.äºåç/06.docker",description:"docker"}},title:"docker",date:"2023-01-07T18:33:01.000Z",permalink:"/docker/",sidebar:!1,article:!1,comment:!1,editLink:!1,description:"",author:{name:"msqfx",link:"https://github.com/msqfx"},meta:[{name:"twitter:title",content:"docker"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/10.docker.html"},{property:"og:type",content:"article"},{property:"og:title",content:"docker"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/10.docker.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-01-07T18:33:01.000Z"},{itemprop:"name",content:"docker"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/00.%E7%9B%AE%E5%BD%95/10.docker.html",relativePath:"00.ç®å½/10.docker.md",key:"v-718cb9b0",path:"/docker/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/01/08, 21:19:56",lastUpdatedTimestamp:1673183996e3},{title:"æ´å¤",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"06.æ´å¤",description:"æ´å¤åå®¹"}},title:"æ´å¤",date:"2020-03-11T21:50:53.000Z",permalink:"/more",sidebar:!1,article:!1,comment:!1,editLink:!1,description:"",author:{name:"msqfx",link:"https://github.com/msqfx"},meta:[{name:"twitter:title",content:"æ´å¤"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/100.%E6%9B%B4%E5%A4%9A.html"},{property:"og:type",content:"article"},{property:"og:title",content:"æ´å¤"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/100.%E6%9B%B4%E5%A4%9A.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2020-03-11T21:50:53.000Z"},{itemprop:"name",content:"æ´å¤"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/00.%E7%9B%AE%E5%BD%95/100.%E6%9B%B4%E5%A4%9A.html",relativePath:"00.ç®å½/100.æ´å¤.md",key:"v-7e40cffe",path:"/more/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/01/07, 18:38:30",lastUpdatedTimestamp:167308791e4},{title:"kafka",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"03.ä¸­é´ä»¶/01.kafka",description:"kafka"}},title:"kafka",permalink:"/kafka/",sidebar:!1,article:!1,comment:!1,editLink:!1,description:"",author:{name:"msqfx",link:"https://github.com/msqfx"},date:"2023-05-01T17:41:25.000Z",meta:[{name:"twitter:title",content:"kafka"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/12.kafka.html"},{property:"og:type",content:"article"},{property:"og:title",content:"kafka"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/12.kafka.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-05-01T17:41:25.000Z"},{itemprop:"name",content:"kafka"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/00.%E7%9B%AE%E5%BD%95/12.kafka.html",relativePath:"00.ç®å½/12.kafka.md",key:"v-566b048c",path:"/kafka/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"ä¸­é´ä»¶",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"03.ä¸­é´ä»¶",description:"ä¸­é´ä»¶"}},title:"ä¸­é´ä»¶",permalink:"/middleware/",sidebar:!1,article:!1,comment:!1,editLink:!1,description:"",author:{name:"msqfx",link:"https://github.com/msqfx"},date:"2023-05-01T17:46:08.000Z",meta:[{name:"twitter:title",content:"ä¸­é´ä»¶"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/13.%E4%B8%AD%E9%97%B4%E4%BB%B6.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ä¸­é´ä»¶"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/13.%E4%B8%AD%E9%97%B4%E4%BB%B6.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-05-01T17:46:08.000Z"},{itemprop:"name",content:"ä¸­é´ä»¶"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/00.%E7%9B%AE%E5%BD%95/13.%E4%B8%AD%E9%97%B4%E4%BB%B6.html",relativePath:"00.ç®å½/13.ä¸­é´ä»¶.md",key:"v-34e42639",path:"/middleware/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"linux",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.ç¼ç¨/03.linux",description:"linux"}},title:"linux",permalink:"/linux/",sidebar:!1,article:!1,comment:!1,editLink:!1,description:"",author:{name:"msqfx",link:"https://github.com/msqfx"},date:"2023-05-01T17:46:08.000Z",meta:[{name:"twitter:title",content:"linux"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/14.linux.html"},{property:"og:type",content:"article"},{property:"og:title",content:"linux"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/00.%E7%9B%AE%E5%BD%95/14.linux.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-05-01T17:46:08.000Z"},{itemprop:"name",content:"linux"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/00.%E7%9B%AE%E5%BD%95/14.linux.html",relativePath:"00.ç®å½/14.linux.md",key:"v-423655cc",path:"/linux/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/05/15, 19:34:26",lastUpdatedTimestamp:1684150466e3},{title:"Javaåºç¡å°ç»",frontmatter:{title:"Javaåºç¡å°ç»",date:"2023-06-15T11:11:15.000Z",permalink:"/pages/11aacc/",author:{name:"éä¸æ¸é£",link:"https://github.com/msqfx"},categories:["java","åºç¡ç¯"],tags:[null],description:"Java æ¯ 1995 å¹´ç± sun å¬å¸æ¨åºçä¸é¨é«çº§è¯­è¨ã",comment:!0,meta:[{name:"image",content:"https://cmty256.github.io/imgs-blog/Java/image.u47c2l50zow.webp"},{name:"twitter:title",content:"Javaåºç¡å°ç»"},{name:"twitter:description",content:"Java æ¯ 1995 å¹´ç± sun å¬å¸æ¨åºçä¸é¨é«çº§è¯­è¨ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://cmty256.github.io/imgs-blog/Java/image.u47c2l50zow.webp"},{name:"twitter:url",content:"https://www.msqfx.cc/01.java/01.%E5%9F%BA%E7%A1%80%E7%AF%87/01.Java%E5%9F%BA%E7%A1%80%E5%B0%8F%E7%BB%93.html"},{property:"og:type",content:"article"},{property:"og:title",content:"Javaåºç¡å°ç»"},{property:"og:description",content:"Java æ¯ 1995 å¹´ç± sun å¬å¸æ¨åºçä¸é¨é«çº§è¯­è¨ã"},{property:"og:image",content:"https://cmty256.github.io/imgs-blog/Java/image.u47c2l50zow.webp"},{property:"og:url",content:"https://www.msqfx.cc/01.java/01.%E5%9F%BA%E7%A1%80%E7%AF%87/01.Java%E5%9F%BA%E7%A1%80%E5%B0%8F%E7%BB%93.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-06-15T11:11:15.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"Javaåºç¡å°ç»"},{itemprop:"description",content:"Java æ¯ 1995 å¹´ç± sun å¬å¸æ¨åºçä¸é¨é«çº§è¯­è¨ã"},{itemprop:"image",content:"https://cmty256.github.io/imgs-blog/Java/image.u47c2l50zow.webp"}],readingShow:"top"},regularPath:"/01.java/01.%E5%9F%BA%E7%A1%80%E7%AF%87/01.Java%E5%9F%BA%E7%A1%80%E5%B0%8F%E7%BB%93.html",relativePath:"01.java/01.åºç¡ç¯/01.Javaåºç¡å°ç».md",key:"v-1b5f1ee8",path:"/pages/11aacc/",headers:[{level:2,title:"Java åºç¡æ¦å¿µä¸å¸¸è¯",slug:"java-åºç¡æ¦å¿µä¸å¸¸è¯",normalizedTitle:"java åºç¡æ¦å¿µä¸å¸¸è¯",charIndex:16},{level:3,title:"ä»ä¹æ¯ Java ?",slug:"ä»ä¹æ¯-java",normalizedTitle:"ä»ä¹æ¯ java ?",charIndex:33},{level:3,title:"Java çä¸ç§ææ¯æ¶æ",slug:"java-çä¸ç§ææ¯æ¶æ",normalizedTitle:"java çä¸ç§ææ¯æ¶æ",charIndex:849},{level:3,title:"ä»ä¹æ¯ JVM ?",slug:"ä»ä¹æ¯-jvm",normalizedTitle:"ä»ä¹æ¯ jvm ?",charIndex:948},{level:3,title:"ä»ä¹æ¯ JDK ?",slug:"ä»ä¹æ¯-jdk",normalizedTitle:"ä»ä¹æ¯ jdk ?",charIndex:1184},{level:3,title:"ä»ä¹æ¯ JRE ?",slug:"ä»ä¹æ¯-jre",normalizedTitle:"ä»ä¹æ¯ jre ?",charIndex:1275},{level:3,title:"Java ä¸ C++ çåºå«",slug:"java-ä¸-c-çåºå«",normalizedTitle:"java ä¸ c++ çåºå«",charIndex:1468},{level:2,title:"åºæ¬è¯­æ³",slug:"åºæ¬è¯­æ³",normalizedTitle:"åºæ¬è¯­æ³",charIndex:1653},{level:3,title:"æ³¨éæåªå ç§å½¢å¼ï¼",slug:"æ³¨éæåªå ç§å½¢å¼",normalizedTitle:"æ³¨éæåªå ç§å½¢å¼ï¼",charIndex:1662},{level:3,title:"æ è¯ç¬¦åå³é®å­çåºå«æ¯ä»ä¹ï¼",slug:"æ è¯ç¬¦åå³é®å­çåºå«æ¯ä»ä¹",normalizedTitle:"æ è¯ç¬¦åå³é®å­çåºå«æ¯ä»ä¹ï¼",charIndex:1785},{level:3,title:"Java æåªäºå³é®å­ï¼",slug:"java-æåªäºå³é®å­",normalizedTitle:"java æåªäºå³é®å­ï¼",charIndex:1889},{level:3,title:"è®¿é®æ§å¶å³é®å­è§£æ",slug:"è®¿é®æ§å¶å³é®å­è§£æ",normalizedTitle:"è®¿é®æ§å¶å³é®å­è§£æ",charIndex:1908},{level:3,title:"final å³é®å­è§£æ",slug:"final-å³é®å­è§£æ",normalizedTitle:"final å³é®å­è§£æ",charIndex:2442},{level:3,title:"if å else if",slug:"if-å-else-if",normalizedTitle:"if å else if",charIndex:2814},{level:2,title:"åé",slug:"åé",normalizedTitle:"åé",charIndex:1932},{level:3,title:"æååéä¸å±é¨åéçåºå«ï¼",slug:"æååéä¸å±é¨åéçåºå«",normalizedTitle:"æååéä¸å±é¨åéçåºå«ï¼",charIndex:3561},{level:3,title:"éæåéæä»ä¹ç¨ï¼",slug:"éæåéæä»ä¹ç¨",normalizedTitle:"éæåéæä»ä¹ç¨ï¼",charIndex:4265},{level:3,title:"å­ç¬¦åå¸¸éåå­ç¬¦ä¸²å¸¸éçåºå«ï¼",slug:"å­ç¬¦åå¸¸éåå­ç¬¦ä¸²å¸¸éçåºå«",normalizedTitle:"å­ç¬¦åå¸¸éåå­ç¬¦ä¸²å¸¸éçåºå«ï¼",charIndex:4713},{level:2,title:"æ¹æ³",slug:"æ¹æ³",normalizedTitle:"æ¹æ³",charIndex:1570},{level:3,title:"ä»ä¹æ¯æ¹æ³çè¿åå¼?æ¹æ³æåªå ç§ç±»åï¼",slug:"ä»ä¹æ¯æ¹æ³çè¿åå¼-æ¹æ³æåªå ç§ç±»å",normalizedTitle:"ä»ä¹æ¯æ¹æ³çè¿åå¼?æ¹æ³æåªå ç§ç±»åï¼",charIndex:4974},{level:3,title:"éææ¹æ³ä¸ºä»ä¹ä¸è½è°ç¨ééææå?",slug:"éææ¹æ³ä¸ºä»ä¹ä¸è½è°ç¨ééææå",normalizedTitle:"éææ¹æ³ä¸ºä»ä¹ä¸è½è°ç¨ééææå?",charIndex:5102},{level:3,title:"éææ¹æ³åå®ä¾æ¹æ³æä½ä¸åï¼",slug:"éææ¹æ³åå®ä¾æ¹æ³æä½ä¸å",normalizedTitle:"éææ¹æ³åå®ä¾æ¹æ³æä½ä¸åï¼",charIndex:5266},{level:3,title:"éè½½åéåæä»ä¹åºå«ï¼",slug:"éè½½åéåæä»ä¹åºå«",normalizedTitle:"éè½½åéåæä»ä¹åºå«ï¼",charIndex:5482},{level:3,title:"ä»ä¹æ¯å¯åé¿åæ°ï¼",slug:"ä»ä¹æ¯å¯åé¿åæ°",normalizedTitle:"ä»ä¹æ¯å¯åé¿åæ°ï¼",charIndex:5766},{level:2,title:"æ³¨è§£",slug:"æ³¨è§£",normalizedTitle:"æ³¨è§£",charIndex:6343},{level:3,title:"è°è°å¯¹ Java æ³¨è§£ççè§£ï¼è§£å³äºä»ä¹é®é¢ï¼",slug:"è°è°å¯¹-java-æ³¨è§£ççè§£-è§£å³äºä»ä¹é®é¢",normalizedTitle:"è°è°å¯¹ java æ³¨è§£ççè§£ï¼è§£å³äºä»ä¹é®é¢ï¼",charIndex:6350},{level:3,title:"æ³¨è§£çè§£ææ¹æ³æåªå ç§ï¼",slug:"æ³¨è§£çè§£ææ¹æ³æåªå ç§",normalizedTitle:"æ³¨è§£çè§£ææ¹æ³æåªå ç§ï¼",charIndex:6600},{level:2,title:"SPI",slug:"spi",normalizedTitle:"spi",charIndex:8524},{level:3,title:"ä»ä¹æ¯ Java ç SPI æºå¶ï¼",slug:"ä»ä¹æ¯-java-ç-spi-æºå¶",normalizedTitle:"ä»ä¹æ¯ java ç spi æºå¶ï¼",charIndex:8532},{level:3,title:"SPI æºå¶çä¼ç¼ºç¹æ¯ä»ä¹ï¼",slug:"spi-æºå¶çä¼ç¼ºç¹æ¯ä»ä¹",normalizedTitle:"spi æºå¶çä¼ç¼ºç¹æ¯ä»ä¹ï¼",charIndex:8665},{level:3,title:"å¦ä½å¨ Java ä¸­ä½¿ç¨ SPI æºå¶ï¼",slug:"å¦ä½å¨-java-ä¸­ä½¿ç¨-spi-æºå¶",normalizedTitle:"å¦ä½å¨ java ä¸­ä½¿ç¨ spi æºå¶ï¼",charIndex:8771},{level:3,title:"å¦ä½é¿å SPI æºå¶ä¸­çå²çªé®é¢ï¼",slug:"å¦ä½é¿å-spi-æºå¶ä¸­çå²çªé®é¢",normalizedTitle:"å¦ä½é¿å spi æºå¶ä¸­çå²çªé®é¢ï¼",charIndex:8981},{level:3,title:"SPI æºå¶å Spring ç BeanFactory æä»ä¹åºå«ï¼",slug:"spi-æºå¶å-spring-ç-beanfactory-æä»ä¹åºå«",normalizedTitle:"spi æºå¶å spring ç beanfactory æä»ä¹åºå«ï¼",charIndex:9123},{level:2,title:"åºåååååºåå",slug:"åºåååååºåå",normalizedTitle:"åºåååååºåå",charIndex:9354},{level:3,title:"ä»ä¹æ¯åºååï¼ä»ä¹æ¯ååºååï¼",slug:"ä»ä¹æ¯åºåå-ä»ä¹æ¯ååºåå",normalizedTitle:"ä»ä¹æ¯åºååï¼ä»ä¹æ¯ååºååï¼",charIndex:9367},{level:3,title:"åºåååè®®å¯¹åºäº TCP/IP 4 å±æ¨¡åçåªä¸å±ï¼",slug:"åºåååè®®å¯¹åºäº-tcp-ip-4-å±æ¨¡åçåªä¸å±",normalizedTitle:"åºåååè®®å¯¹åºäº tcp/ip 4 å±æ¨¡åçåªä¸å±ï¼",charIndex:9576},{level:3,title:"é¡¹ç®ä¸­ï¼JSON æ°æ®çä¼ è¾ä½ç°å¨åªï¼",slug:"é¡¹ç®ä¸­-json-æ°æ®çä¼ è¾ä½ç°å¨åª",normalizedTitle:"é¡¹ç®ä¸­ï¼json æ°æ®çä¼ è¾ä½ç°å¨åªï¼",charIndex:9644},{level:2,title:"è¯­æ³ç³",slug:"è¯­æ³ç³",normalizedTitle:"è¯­æ³ç³",charIndex:10267},{level:3,title:"ä»ä¹æ¯è¯­æ³ç³ï¼",slug:"ä»ä¹æ¯è¯­æ³ç³",normalizedTitle:"ä»ä¹æ¯è¯­æ³ç³ï¼",charIndex:10275},{level:3,title:"Java ä¸­æåªäºå¸¸è§çè¯­æ³ç³ï¼",slug:"java-ä¸­æåªäºå¸¸è§çè¯­æ³ç³",normalizedTitle:"java ä¸­æåªäºå¸¸è§çè¯­æ³ç³ï¼",charIndex:10611},{level:3,title:"åé¨ç±»äºè§£åï¼",slug:"åé¨ç±»äºè§£å",normalizedTitle:"åé¨ç±»äºè§£åï¼",charIndex:10715},{level:3,title:"å¿ååé¨ç±»äºè§£åï¼",slug:"å¿ååé¨ç±»äºè§£å",normalizedTitle:"å¿ååé¨ç±»äºè§£åï¼",charIndex:10929}],headersStr:"Java åºç¡æ¦å¿µä¸å¸¸è¯ ä»ä¹æ¯ Java ? Java çä¸ç§ææ¯æ¶æ ä»ä¹æ¯ JVM ? ä»ä¹æ¯ JDK ? ä»ä¹æ¯ JRE ? Java ä¸ C++ çåºå« åºæ¬è¯­æ³ æ³¨éæåªå ç§å½¢å¼ï¼ æ è¯ç¬¦åå³é®å­çåºå«æ¯ä»ä¹ï¼ Java æåªäºå³é®å­ï¼ è®¿é®æ§å¶å³é®å­è§£æ final å³é®å­è§£æ if å else if åé æååéä¸å±é¨åéçåºå«ï¼ éæåéæä»ä¹ç¨ï¼ å­ç¬¦åå¸¸éåå­ç¬¦ä¸²å¸¸éçåºå«ï¼ æ¹æ³ ä»ä¹æ¯æ¹æ³çè¿åå¼?æ¹æ³æåªå ç§ç±»åï¼ éææ¹æ³ä¸ºä»ä¹ä¸è½è°ç¨ééææå? éææ¹æ³åå®ä¾æ¹æ³æä½ä¸åï¼ éè½½åéåæä»ä¹åºå«ï¼ ä»ä¹æ¯å¯åé¿åæ°ï¼ æ³¨è§£ è°è°å¯¹ Java æ³¨è§£ççè§£ï¼è§£å³äºä»ä¹é®é¢ï¼ æ³¨è§£çè§£ææ¹æ³æåªå ç§ï¼ SPI ä»ä¹æ¯ Java ç SPI æºå¶ï¼ SPI æºå¶çä¼ç¼ºç¹æ¯ä»ä¹ï¼ å¦ä½å¨ Java ä¸­ä½¿ç¨ SPI æºå¶ï¼ å¦ä½é¿å SPI æºå¶ä¸­çå²çªé®é¢ï¼ SPI æºå¶å Spring ç BeanFactory æä»ä¹åºå«ï¼ åºåååååºåå ä»ä¹æ¯åºååï¼ä»ä¹æ¯ååºååï¼ åºåååè®®å¯¹åºäº TCP/IP 4 å±æ¨¡åçåªä¸å±ï¼ é¡¹ç®ä¸­ï¼JSON æ°æ®çä¼ è¾ä½ç°å¨åªï¼ è¯­æ³ç³ ä»ä¹æ¯è¯­æ³ç³ï¼ Java ä¸­æåªäºå¸¸è§çè¯­æ³ç³ï¼ åé¨ç±»äºè§£åï¼ å¿ååé¨ç±»äºè§£åï¼",content:'# Java åºç¡å°ç»\n\n\n# Java åºç¡æ¦å¿µä¸å¸¸è¯\n\n\n# ä»ä¹æ¯ Java ?\n\nJava æ¯ 1995 å¹´ç± sun å¬å¸æ¨åºçä¸é¨é«çº§è¯­è¨ã\n\nJava çåä¸ªåºæ¬ç¹æ§æ¯é¢åå¯¹è±¡ãå¹³å°æ å³æ§ãå®å¨æ§åç®åæ§ã\n\nå·ä½ç¹ç¹å¦ä¸:\n\n 1. ç®åæå­¦ã\n\n 2. å¹³å°æ å³æ§ã\n\n 3. é¢åå¯¹è±¡\n    \n    * é¢åå¯¹è±¡æ¯ä¸ç§ç¨åºè®¾è®¡ææ¯ï¼ä»¥æ¨å å·¥ä½ä¸ºä¾ï¼ä½¿ç¨é¢åå¯¹è±¡æ¹å¼å®ç°çæ¨å çå·¥ä½å³æ³¨éç¹æ°¸è¿æ¯å¶ä½æ¤å­ï¼å¶æ¬¡ææ¯å·¥å·ã\n    \n    * èé¢åè¿ç¨åä¼åå³æ³¨å¶ä½å·¥å·ã\n    \n    * ä¸ C++ ä¸åçæ¯ï¼Java ä¸æ¯æå¤ç»§æ¿ï¼åèä»£ä¹çæ¯æ´å ç®åçæ¥å£çæ¦å¿µã\n    \n    * é¢åå¯¹è±¡ä¸å¤§ç¹æ§: å°è£ãå¤æãç»§æ¿ã\n\n 4. ç¼è¯ä¸è§£éå¹¶å­\n\n 5. å¯é æ§\n    \n    * Java éè¿æ©ææ£æµä»¥åè¿è¡æ¶æ£æµæ¶é¤äºå®¹æåºéçæåµã\n    * ä¸ C++ ä¸åçæ¯ï¼C++ å¨æä½æ°ç»ãå­ç¬¦ä¸²æ¹å¼ä¸å©ç¨æéæ¨¡åé¿åäºéååå­æèæåæ°æ®çé®é¢ã\n\n 6. å®å¨æ§: Java éç¨äºç½ç»/åå¸å¼ç¯å¢ï¼ä¸ºäºè¾¾å°è¿ä¸ªç®æ ï¼Java å¨é²çæ¯ï¼é²ç¯¡æ¹ååºå¾å¤§çåªåã\n\n 7. æ¯æç½ç»ç¼ç¨å¹¶ä¸éå¸¸æ¹ä¾¿ã\n\n 8. æ¯æå¤çº¿ç¨ã\n\n> ä»ä¹æ¯ãç¼è¯åãè¯­è¨åãè§£éåãè¯­è¨ï¼\n> \n> ç¼è¯åï¼ç¼è¯åè¯­è¨ ä¼éè¿ç¼è¯å¨å°æºä»£ç ä¸æ¬¡æ§ç¿»è¯æå¯è¢«è¯¥å¹³å°æ§è¡çæºå¨ç ãä¸è¬æåµä¸ï¼ç¼è¯è¯­è¨çæ§è¡éåº¦æ¯è¾å¿«ï¼å¼åæçæ¯è¾ä½ãå¸¸è§çç¼è¯æ§è¯­è¨æ CãC++ãGoãRust ç­ç­ã\n> \n> è§£éåï¼è§£éåè¯­è¨ä¼éè¿è§£éå¨ä¸å¥ä¸å¥çå°ä»£ç è§£éï¼interpretï¼ä¸ºæºå¨ä»£ç ååæ§è¡ãè§£éåè¯­è¨å¼åæçæ¯è¾å¿«ï¼æ§è¡éåº¦æ¯è¾æ¢ãå¸¸è§çè§£éæ§è¯­è¨æ PythonãJavaScriptãPHP ç­ç­ã\n> \n> è Java æ¯ç¼è¯ä¸è§£éå¹¶å­ï¼å ä¸º java æºä»£ç è¿è¡æ¶éè¦åç¼è¯æä¸ºå­èç æä»¶ (.class)ï¼ç¶ååéè¿è§£éå¨ç¿»è¯ææºå¨ç è¿è¡ã\n\n\n# Java çä¸ç§ææ¯æ¶æ\n\n 1. JavaSEï¼æ åçï¼å³å­¦çæ¶æå­¦ä¹ æ¶ä½¿ç¨ççæ¬ã\n 2. JavaEEï¼web å¼åéç¨çææ¯æ¶æã\n 3. JavaMEï¼ä¸ºåµå¥å¼è®¾å¤æä¾çè§£å³æ¹æ¡\n\n\n# ä»ä¹æ¯ JVM ?\n\nJava èææºï¼JVMï¼æ¯è¿è¡ Java å­èç çèææºã\n\nJVM æéå¯¹ä¸åç³»ç»çç¹å®å®ç°ï¼Windowsï¼Linuxï¼macOSï¼ï¼ç®çæ¯ä½¿ç¨ç¸åçå­èç ï¼å®ä»¬é½ä¼ç»åºç¸åçç»æã\n\nå­èç åä¸åç³»ç»ç JVM å®ç°æ¯ Java è¯­è¨ âä¸æ¬¡ç¼è¯ï¼éå¤å¯ä»¥è¿è¡â çå³é®æå¨ã\n\nJVM å¹¶ä¸æ¯åªæä¸ç§ï¼åªè¦éµå® JVM è®¾è®¡è§èå°±è½å¼ååºèªå·±æéè¦ç Java èææºï¼æä»¬æ¥å¸¸æç¨ç HotSpot VM åªæ¯å¶ä¸­ä¸ç§å®ç°èå·²ã\n\n\n# ä»ä¹æ¯ JDK ?\n\nJDK(Java Development Kit) æ¯ Java å¼åå·¥å·åï¼åå«äº JRE ææçä¸è¥¿ï¼æä»¥ä½ä¸ºå¼åäººåï¼åªéè¦å®è£ JDK å³å¯ã\n\n\n# ä»ä¹æ¯ JRE ?\n\nJRE(Java Runtime Environment) æ¯ Java è¿è¡ç¯å¢ï¼åå«è¿è¡æéè¦çç±»åºä»¥å JVMã\n\nä½ å¯è½è®¤ä¸ºå¦æä»ä»è¦è¿è¡ Java ç¨åºï¼å®è£ JRE å³å¯ï¼ä½æ¯æäº web ç¨åºä¾å¦ï¼éè¦å° JSP è½¬æ¢ä¸º Java servlet å°±éè¦ jdk ç¼è¯äºï¼æä»¥ä¿å®èµ·è§ï¼æ è®ºè¿è¡è¿æ¯å¼åï¼æä»¬é½å»ºè®®å¨æä½ç³»ç»ä¸å®è£ JDKã\n\n\n# Java ä¸ C++ çåºå«\n\n 1. Java æ²¡ææéçæ¦å¿µï¼ä¸è½å C++ ä¸æ ·ç´æ¥æä½åå­ï¼æä»¥æ´å å®å¨ã\n 2. Java ä¸æ¯æå¤ç»§æ¿ï¼ä½æ¯å¯ä»¥éè¿å¤æ¥å£å®ç°å¤ç»§æ¿ã\n 3. Java åªæ¯ææ¹æ³éè½½ï¼ä¸å C++ ä¸æ ·å¯ä»¥è¿ç®ç¬¦éè½½ã\n 4. Java æèªå¨åå­ç®¡çåå¾åæ¶æºå¶ (GC)ï¼æ éå C++ ä¸æ ·æå¨éæ¾ã\n\n> ä»ä¹æ¯ GC ?\n\n\n# åºæ¬è¯­æ³\n\n\n# æ³¨éæåªå ç§å½¢å¼ï¼\n\næä¸ç§ï¼\n\n 1. åè¡æ³¨éï¼éå¸¸ç¨äºè§£éæ¹æ³åæåè¡ä»£ç çä½ç¨ã(//)\n 2. å¤è¡æ³¨éï¼éå¸¸ç¨äºè§£éä¸æ®µä»£ç çä½ç¨ãï¼/* */)\n 3. ææ¡£æ³¨éï¼éå¸¸ç¨äºçæ Java å¼åææ¡£ãï¼å³ java docï¼\n\n\n# æ è¯ç¬¦åå³é®å­çåºå«æ¯ä»ä¹ï¼\n\næ è¯ç¬¦ï¼ç®åæ¥è¯´å°±æ¯ä¸ä¸ªåå­ï¼æ¯å¦ æä¸ªåºéºåã\n\nå³é®å­ï¼è¢«èµäºç¹æ®å«ä¹çæ è¯ç¬¦ï¼æ¯å¦ è­¦å¯å±ï¼å»é¢ã\n\næ³¨æï¼ææå³é®å­é½æ¯å°åï¼å¨ IDE ä¸­ä¼ä»¥ç¹æ®é¢è²å±ç¤ºã\n\n\n# Java æåªäºå³é®å­ï¼\n\n\n\n\n# è®¿é®æ§å¶å³é®å­è§£æ\n\nå®ä»¬çä½ç¨æ¯æ§å¶ç±»ãæ¹æ³ååéçè®¿é®æéã\n\nJava ä¸­çè®¿é®æ§å¶å³é®å­ä¸»è¦æä»¥ä¸åä¸ªï¼\n\n 1. public: è¡¨ç¤ºå¬å±çï¼ä»»ä½å°æ¹é½å¯ä»¥è®¿é®ãå¨åä¸é¡¹ç®ä¸­æå¶ä»é¡¹ç®ä¸­ï¼é½å¯ä»¥éè¿å¼å¥ç±»ææ¨¡åè¿è¡è®¿é®ã\n 2. protected: è¡¨ç¤ºåä¿æ¤çï¼åªææ¬ç±»åå¶å­ç±»ä»¥ååä¸åä¸­çå¶ä»ç±»å¯ä»¥è®¿é®ãå¨å¶ä»åä¸­çå­ç±»ä¸å¯ä»¥è®¿é®ã\n 3. defaultï¼å³ä¸åè®¿é®æ§å¶ç¬¦ï¼: è¡¨ç¤ºé»è®¤çï¼åªææ¬ç±»ååä¸åä¸­çå¶ä»ç±»å¯ä»¥è®¿é®ï¼å¶ä»åä¸­çç±»é½ä¸å¯ä»¥è®¿é®ã\n 4. private: è¡¨ç¤ºç§æçï¼åªææ¬ç±»ä¸­å¯ä»¥è®¿é®ï¼å¶ä»ç±»é½ä¸å¯ä»¥è®¿é®ã\n\nå¯è§æ§\n\nåä¸ä¸ªç±» -> åä¸ä¸ªå -> å­ç±» -> å¨å±èå´\n\nå¯è§æ§     PRIVATE   DEFAULT   PROTECTED   PUBLIC\nåä¸ä¸ªç±»ä¸­   âï¸        âï¸        âï¸          âï¸\nåä¸ä¸ªåä¸­   â         â         âï¸          âï¸\nå­ç±»ä¸­     â         â         âï¸          âï¸\nå¨å±èå´    â         â         â           âï¸\n\n\n# final å³é®å­è§£æ\n\nfinal æ¯ Java ä¸­çä¸ä¸ªå³é®å­ï¼å¯ä»¥ç¨æ¥ä¿®é¥°ç±»ãæ¹æ³ååéï¼è¡¨ç¤ºå®ä»¬ä¸å¯è¢«ä¿®æ¹ã\n\n> è¢« final å³é®å­ä¿®é¥°ä¼æä¹æ ·ï¼\n\n 1. final ä¿®é¥°ç±»ï¼è¡¨ç¤ºè¯¥ç±»æ¯ä¸å¯ç»§æ¿çï¼å³ä¸è½æå­ç±»ã\n 2. final ä¿®é¥°æ¹æ³ï¼è¡¨ç¤ºè¯¥æ¹æ³ä¸è½è¢«å­ç±»éåï¼å³ä¸è½è¢«ä¿®æ¹ã\n 3. final ä¿®é¥°åéï¼è¡¨ç¤ºè¯¥åéæ¯ä¸ä¸ªå¸¸éï¼åªè½è¢«èµå¼ä¸æ¬¡ï¼ä¸è½è¢«ä¿®æ¹ã\n\nfinal å³é®å­çä¸»è¦ä½ç¨å¦ä¸ï¼\n\n * æé«ä»£ç çå®å¨æ§ï¼final å³é®å­å¯ä»¥ä¿è¯ç±»ãæ¹æ³ååéå¨ç¨åºè¿è¡æ¶ä¸è¢«ä¿®æ¹ï¼ä»èæé«äºä»£ç çå®å¨æ§åå¯ç»´æ¤æ§ã\n * æé«ä»£ç çæ§è½ï¼final å³é®å­å¯ä»¥ä½¿å¾ç¼è¯å¨å¨ç¼è¯æ¶è¿è¡ä¼åï¼ä»èæé«äºä»£ç çæ§è½ã\n * æç¡®ä»£ç çå«ä¹ï¼finalå³é®å­å¯ä»¥ä½¿å¾ä»£ç çå«ä¹æ´å æç¡®ï¼ä»èæ¹ä¾¿ä»£ç çç»´æ¤åçè§£ã\n\n\n# if å else if\n\nif å else if æ¯ç¨äºæ¡ä»¶å¤æ­çæ§å¶ç»æãå®ä»¬ç¨äºå¨ä¸åçæ¡ä»¶ä¸æ§è¡ä¸åçä»£ç åã\n\nåºæ¬çè¯­æ³å¦ä¸ï¼\n\nif (condition1) {\n    // å¦æ condition1 ä¸ºçï¼æ§è¡è¿éçä»£ç å\n} else if (condition2) {\n    // å¦æ condition1 ä¸ºåï¼è condition2 ä¸ºçï¼æ§è¡è¿éçä»£ç å\n} else {\n    // å¦æåé¢çæ¡ä»¶é½ä¸ºåï¼æ§è¡è¿éçä»£ç å\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¨æ§è¡æ¶ï¼é¦åå¤æ­ condition1 æ¯å¦ä¸ºçãå¦æä¸ºçï¼æ§è¡ if ä»£ç åï¼å¦æä¸ºåï¼ç»§ç»­å¤æ­ condition2ãå¦æ condition2 ä¸ºçï¼æ§è¡ else if ä»£ç åï¼å¦æ condition2 ä¸ºåï¼æ§è¡ else ä»£ç åã\n\néè¦çä¸ç¹æ¯ï¼ä¸æ¦æä¸ä¸ªæ¡ä»¶ä¸ºçï¼åç»­ç else if æ else é½ä¸ä¼åæ§è¡ï¼å ä¸º Java ä¸­ç if - else if - else ç»ææ¯äºæ¥çã\n\nä»¥ä¸æ¯ä¸ä¸ªç®åçä¾å­ï¼\n\nint number = 10;\n\nif (number > 0) {\n    System.out.println("Number is positive");\n} else if (number < 0) {\n    System.out.println("Number is negative");\n} else {\n    System.out.println("Number is zero");\n}\n\n// è¾åº Number is positive\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# åé\n\n\n# æååéä¸å±é¨åéçåºå«ï¼\n\nä¸»è¦æ¯åä¸ªåºå«ï¼\n\n 1. ä»è¯­æ³å½¢å¼ä¸çï¼\n    \n    * æååéæ¯å±äºç±»çï¼\n    * èå±é¨åéæ¯å¨ä»£ç åææ¹æ³ä¸­å®ä¹çåéææ¯æ¹æ³çåæ°ã\n    * æååéå¯ä»¥è¢« public,private,static ç­ä¿®é¥°ç¬¦æä¿®é¥°ï¼\n    * èå±é¨åéä¸è½è¢«è®¿é®æ§å¶ä¿®é¥°ç¬¦å static æä¿®é¥°ï¼\n    * ä½æ¯ï¼æååéåå±é¨åéé½è½è¢« final æä¿®é¥°ã\n\n 2. ä»åéå¨åå­ä¸­çå­å¨æ¹å¼æ¥çï¼\n    \n    * å¦ææååéæ¯ä½¿ç¨ static ä¿®é¥°çï¼é£ä¹è¿ä¸ªæååéæ¯å±äºç±»çï¼\n    \n    * å¦ææ²¡æä½¿ç¨ static ä¿®é¥°ï¼è¿ä¸ªæååéæ¯å±äºå®ä¾çã\n      \n      > å¯¹è±¡å­å¨äºå åå­ï¼æ¯ãç±»çå®ä¾åã\n      > \n      > å±é¨åéåå­å¨äºæ åå­ï¼æ¯ãå¨æ¹æ³éå®ä¹çã\n\n 3. ä»åéå¨åå­ä¸­ççå­æ¶é´ä¸çï¼\n    \n    * æååéæ¯å¯¹è±¡çä¸é¨åï¼å®éçå¯¹è±¡çåå»ºèå­å¨ï¼\n    \n    * èå±é¨åééçæ¹æ³çè°ç¨èèªå¨çæï¼éçæ¹æ³çè°ç¨ç»æèæ¶äº¡ã\n\n 4. ä»åéæ¯å¦æé»è®¤å¼æ¥çï¼\n    \n    * æååéå¦ææ²¡æè¢«èµåå§å¼ï¼åä¼èªå¨ä»¥ç±»åçé»è®¤å¼èèµå¼ï¼ä¸ç§æåµä¾å¤:è¢« final ä¿®é¥°çæååéä¹å¿é¡»æ¾å¼å°èµå¼ï¼ï¼\n    * èå±é¨åéåä¸ä¼èªå¨èµå¼ãï¼Java ç¼è¯å¨ä¸ä¼å¯¹å±é¨åéè¿è¡é»è®¤åå§åï¼å ä¸ºè¿äºåéçå¼åªå¨æ¹æ³æä»£ç åä¸­ä½¿ç¨ï¼æ²¡æé»è®¤å¼ãå¦æç¨åºåæ²¡ææ¾å¼å°åå§åå±é¨åéï¼åç¼è¯å¨ä¼å¨ç¼è¯æ¶æåºéè¯¯ãå³ä½¿å®ä¹åè£ç±»åçå±é¨åéä¹ä¸æ ·ï¼\n\n\n# éæåéæä»ä¹ç¨ï¼\n\néæåéä¹å°±æ¯è¢« static å³é®å­ä¿®é¥°çåéã\n\nå®å¯ä»¥è¢«ç±»çææå®ä¾å±äº«ï¼æ è®ºä¸ä¸ªç±»åå»ºäºå¤å°ä¸ªå¯¹è±¡ï¼å®ä»¬é½å±äº«åä¸ä»½éæåéãä¹å°±æ¯è¯´ï¼éæåéåªä¼è¢«åéä¸æ¬¡åå­ï¼å±äºç±»ï¼åªå è½½ä¸ä¸ï¼ï¼å³ä½¿åå»ºå¤ä¸ªå¯¹è±¡ï¼è¿æ ·å¯ä»¥èçåå­ã\n\néæåéæ¯éè¿ç±»åæ¥è®¿é®çï¼ä¾å¦ StaticVariableExample.staticVarï¼å¦æè¢« private å³é®å­ä¿®é¥°å°±æ æ³è¿æ ·è®¿é®äºï¼ã\n\npublic class StaticVariableExample {\n    // éæåé\n    public static int staticVar = 0;\n}\n\n\n1\n2\n3\n4\n\n\néå¸¸æåµä¸ï¼éæåéä¼è¢« final å³é®å­ä¿®é¥°æä¸ºå¸¸éã\n\npublic class ConstantVariableExample {\n    // å¸¸é\n    public static final int constantVar = 0;\n}\n\n\n1\n2\n3\n4\n\n\n\n# å­ç¬¦åå¸¸éåå­ç¬¦ä¸²å¸¸éçåºå«ï¼\n\n 1. å½¢å¼:\n    * å­ç¬¦å¸¸éæ¯åå¼å·å¼èµ·çä¸ä¸ªå­ç¬¦ï¼\n    * å­ç¬¦ä¸²å¸¸éæ¯åå¼å·å¼èµ·ç 0 ä¸ªæè¥å¹²ä¸ªå­ç¬¦ã\n 2. å«ä¹:\n    * å­ç¬¦å¸¸éç¸å½äºä¸ä¸ªæ´åå¼( ASCII å¼),å¯ä»¥åå è¡¨è¾¾å¼è¿ç®;\n    * å­ç¬¦ä¸²å¸¸éä»£è¡¨ä¸ä¸ªå°åå¼(è¯¥å­ç¬¦ä¸²å¨åå­ä¸­å­æ¾ä½ç½®)ã\n 3. å åå­å¤§å°ï¼\n    * å­ç¬¦å¸¸éï¼charï¼åªå  2 ä¸ªå­è;\n    * å­ç¬¦ä¸²å¸¸éï¼Stringï¼å è¥å¹²ä¸ªå­èã\n\n> æ³¨æ char å¨ Java ä¸­å ä¸¤ä¸ªå­èã\n\n\n# æ¹æ³\n\n\n# ä»ä¹æ¯æ¹æ³çè¿åå¼?æ¹æ³æåªå ç§ç±»åï¼\n\næ¹æ³çè¿åå¼ æ¯ææä»¬è·åå°çæä¸ªæ¹æ³ä½ä¸­çä»£ç æ§è¡åäº§ççç»æï¼\n\næåç§ç±»åï¼\n\n 1. æ åæ°æ è¿åå¼çæ¹æ³\n 2. æåæ°æ è¿åå¼çæ¹æ³\n 3. æè¿åå¼æ åæ°çæ¹æ³\n 4. æè¿åå¼æåæ°çæ¹æ³\n\n\n# éææ¹æ³ä¸ºä»ä¹ä¸è½è°ç¨ééææå?\n\nè¿æ¯å ä¸º\n\n * éææ¹æ³æ¯å±äºç±»çï¼å¨ç±»å è½½çæ¶åå°±ä¼åéåå­ï¼å¯ä»¥éè¿ç±»åç´æ¥è®¿é®ãèééææåå±äºå®ä¾å¯¹è±¡ï¼åªæå¨å¯¹è±¡å®ä¾åä¹åæå­å¨ï¼éè¦éè¿ç±»çå®ä¾å¯¹è±¡å»è®¿é®ã\n * å¨ç±»çééææåä¸å­å¨çæ¶åéææ¹æ³å°±å·²ç»å­å¨äºï¼æ­¤æ¶è°ç¨å¨åå­ä¸­è¿ä¸å­å¨çééææåï¼å±äºéæ³æä½ã\n\n\n# éææ¹æ³åå®ä¾æ¹æ³æä½ä¸åï¼\n\n1ãè°ç¨æ¹å¼\n\n * å¨å¤é¨è°ç¨éææ¹æ³æ¶ï¼å¯ä»¥ä½¿ç¨ ç±»å.æ¹æ³å çæ¹å¼ï¼ä¹å¯ä»¥ä½¿ç¨ å¯¹è±¡.æ¹æ³å çæ¹å¼ï¼\n\n * èå®ä¾æ¹æ³åªæåé¢è¿ç§æ¹å¼ãä¹å°±æ¯è¯´ï¼è°ç¨éææ¹æ³å¯ä»¥æ éåå»ºå¯¹è±¡ ã\n\n2ãè®¿é®ç±»æåæ¯å¦å­å¨éå¶\n\n * éææ¹æ³å¨è®¿é®æ¬ç±»çæåæ¶ï¼åªåè®¸è®¿é®éææåï¼å³éææååéåéææ¹æ³ï¼ï¼ä¸åè®¸è®¿é®å®ä¾æåï¼å³å®ä¾æååéåå®ä¾æ¹æ³ï¼ï¼\n\n * èå®ä¾æ¹æ³ä¸å­å¨è¿ä¸ªéå¶ã\n\n\n# éè½½åéåæä»ä¹åºå«ï¼\n\néè½½å°±æ¯åä¸ä¸ªç±»ä¸­å¤ä¸ªååæ¹æ³æ ¹æ®ä¸åçä¼ åæ¥æ§è¡ä¸åçé»è¾å¤çã\n\néåå°±æ¯å­ç±»å¯¹ç¶ç±»æ¹æ³çéæ°æ¹é ï¼å¤é¨æ ·å­ä¸è½æ¹åï¼åé¨é»è¾å¯ä»¥æ¹åã\n\nåºå«ç¹    éè½½æ¹æ³   éåæ¹æ³\nåçèå´   åä¸ä¸ªç±»   å­ç±»\nåæ°åè¡¨   å¿é¡»ä¿®æ¹   ä¸å®ä¸è½ä¿®æ¹\nè¿åç±»å   å¯ä¿®æ¹    å­ç±»æ¹æ³è¿åå¼ç±»ååºæ¯ç¶ç±»æ¹æ³è¿åå¼ç±»åæ´å°æç¸ç­\nå¼å¸¸     å¯ä¿®æ¹    å­ç±»æ¹æ³å£°ææåºçå¼å¸¸ç±»åºæ¯ç¶ç±»æ¹æ³å£°ææåºçå¼å¸¸ç±»æ´å°æç¸ç­\nè®¿é®ä¿®é¥°   å¯ä¿®æ¹    ä¸å®ä¸è½åæ´ä¸¥æ ¼çéå¶ï¼å¯ä»¥éä½éå¶ï¼\nåçé¶æ®µ   ç¼è¯æ    è¿è¡æ\n\n\n# ä»ä¹æ¯å¯åé¿åæ°ï¼\n\nå¯åé¿åæ°æ¯æå¨å½æ°ææ¹æ³ä¸­ï¼åæ°çæ°éæ¯å¯åçï¼å³å½æ°ææ¹æ³å¯ä»¥æ¥åä¸ç¡®å®æ°éçåæ°ã\n\nå¯åé¿åæ°å¿é¡»æ¾å¨åæ°åè¡¨çæåä¸ä¸ªä½ç½®ï¼å¹¶ä¸ä½¿ç¨çç¥å·ï¼...ï¼æ¥è¡¨ç¤ºã\n\nä¾å¦ï¼\n\npublic static int sum(int... nums) {\n    int result = 0;\n    for (int num : nums) {\n        result += num;\n    }\n    return result;\n}\n\nint sum1 = sum(1, 2, 3);     // sum1 = 6\nint sum2 = sum(1, 2, 3, 4);  // sum2 = 10\nint sum3 = sum(1);           // sum3 = 1\nint sum4 = sum();            // sum4 = 0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nä¹å¯ä¼ å¥æ°ç»\n\nint[] nums = {1, 2, 3};\nint sum5 = sum(nums);        // sum5 = 6\n\n\n1\n2\n\n\n> éå°æ¹æ³éè½½æ¶ä¼ä¼åå¹éåºå®åæ°è¿æ¯å¯ååæ°çæ¹æ³å¢ï¼\n\nä¼ä¼åå¹éåºå®åæ°çæ¹æ³ï¼å ä¸ºåºå®åæ°çæ¹æ³å¹éåº¦æ´é«ã\n\n\n# æ³¨è§£\n\n\n# è°è°å¯¹ Java æ³¨è§£ççè§£ï¼è§£å³äºä»ä¹é®é¢ï¼\n\næ³¨è§£å¯ä»¥çä½æ¯ä¸ç§ç¹æ®çæ³¨éï¼æ¬è´¨ä¸æ¯ç»§æ¿äº Annotation è¿ä¸ç¹æ®æ¥å£ï¼ä¸»è¦ç¨äºä¿®é¥°ç±»ãæ¹æ³æèåéï¼æä¾æäºä¿¡æ¯ä¾ç¨åºå¨ç¼è¯æèè¿è¡æ¶ä½¿ç¨ã\n\næ³¨è§£åªæè¢«è§£æä¹åæä¼çæãæä»¬å¯ä»¥ä½¿ç¨ JDK æä¾çåç½®æ³¨è§£ä¹å¯ä»¥èªå®ä¹æ³¨è§£ã\n\nJava æ³¨è§£çåºç°ä¸»è¦æ¯ä¸ºäºè§£å³ä»£ç ä¸­å¤§ééå¤æ§å·¥ä½ï¼ä¾å¦ï¼éç½®æä»¶çè¯»åãæ¥å¿è®°å½ãæ°æ®æ ¡éªç­ãå¯ä»¥å¸®å©å¼åèæ´å æ¹ä¾¿å°ç®¡çåç»´æ¤ä»£ç ï¼è¿å¯ä»¥å®ç°ä¸äºç¹å®çåè½ï¼ï¼æé«ç¨åºçè´¨éï¼åå¼åæçï¼ã\n\n\n# æ³¨è§£çè§£ææ¹æ³æåªå ç§ï¼\n\nå¸¸è§çè§£ææ¹æ³æä¸¤ç§ï¼\n\n * ç¼è¯æç´æ¥æ«æï¼ç¼è¯å¨å¨ç¼è¯ Java ä»£ç çæ¶åæ«æå¯¹åºçæ³¨è§£å¹¶å¤çï¼æ¯å¦æä¸ªæ¹æ³ä½¿ç¨ @Override æ³¨è§£ï¼ç¼è¯å¨å¨ç¼è¯çæ¶åå°±ä¼æ£æµå½åçæ¹æ³æ¯å¦éåäºç¶ç±»å¯¹åºçæ¹æ³ã\n\n * è¿è¡æéè¿åå°å¤çï¼åæ¡æ¶ä¸­èªå¸¦çæ³¨è§£(æ¯å¦ Spring æ¡æ¶ç @Valueã@Component)é½æ¯éè¿åå°æ¥è¿è¡å¤ççã\n   \n   å®ä¹ä¸ä¸ªæ³¨è§£ MyAnnotationï¼\n   \n   @Retention(RetentionPolicy.RUNTIME)\n   @Target(ElementType.TYPE)\n   public @interface MyAnnotation {\n       String value();\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   \n   \n   å¨ä»£ç ä¸­ä½¿ç¨æ³¨è§£ï¼å¹¶éè¿åå°æºå¶è·åæ³¨è§£ä¿¡æ¯ï¼\n   \n   @MyAnnotation("hello")\n   public class MyClass {\n       public static void main(String[] args) {\n           MyClass obj = new MyClass();\n           Class<?> clazz = obj.getClass();\n           MyAnnotation annotation = clazz.getAnnotation(MyAnnotation.class);\n           System.out.println(annotation.value()); // è¾åº "hello"\n       }\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   \n\n * å­èç æ³¨è§£è§£æï¼å¨ç±»å è½½æé´ï¼éè¿ ASM æ Javassist ç­å­èç æä½åºæ¥è§£ææ³¨è§£ä¿¡æ¯ï¼å¹¶ä¿®æ¹å­èç æä»¶ãè¿ç§æ¹å¼å¯ä»¥å¨ä¸æ¹åæºä»£ç çæåµä¸ï¼å¯¹ä»£ç è¿è¡å¨æçä¿®æ¹åå¢å¼ºã\n   \n   å®ä¹ä¸ä¸ªæ³¨è§£ MyAnnotationï¼\n   \n   @Retention(RetentionPolicy.RUNTIME)\n   @Target(ElementType.TYPE)\n   public @interface MyAnnotation {\n       String value();\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   \n   \n   ä½¿ç¨ ASM æä½åºå¨ç±»å è½½æé´è§£ææ³¨è§£ä¿¡æ¯ï¼\n   \n   public class MyClassLoader extends ClassLoader {\n       @Override\n       protected Class<?> findClass(String name) throws ClassNotFoundException {\n           byte[] bytes = loadClassData(name);\n           Class<?> clazz = defineClass(name, bytes, 0, bytes.length);\n           // è§£ææ³¨è§£ä¿¡æ¯\n           return clazz;\n       }\n   \n       private byte[] loadClassData(String name) {\n           // è¯»åç±»å­èç æä»¶\n       }\n   }\n   \n   MyClassLoader loader = new MyClassLoader();\n   Class<?> clazz = loader.loadClass("com.example.MyClass");\n   MyAnnotation annotation = clazz.getAnnotation(MyAnnotation.class);\n   System.out.println(annotation.value()); // è¾åº "hello"\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   15\n   16\n   17\n   18\n   \n\n\n# SPI\n\n\n# ä»ä¹æ¯ Java ç SPI æºå¶ï¼\n\nJava ç SPIï¼Service Provider Interfaceï¼æºå¶æ¯ä¸ç§ç¨äºå¨æå è½½åæ©å±æå¡çæºå¶ï¼å®éè¿å®ä¹æå¡æ¥å£ãæå¡æä¾èæ¥å£åå è½½éç½®æä»¶çæ¹å¼ï¼å®ç°äºå¨è¿è¡æ¶å¨æå è½½æå¡æä¾èå®ç°çåè½ã\n\n\n# SPI æºå¶çä¼ç¼ºç¹æ¯ä»ä¹ï¼\n\nSPI æºå¶ç\n\n * ä¼ç¹æ¯å¯ä»¥å¨ä¸ä¿®æ¹ä»£ç çæåµä¸ï¼å¨æå°æ©å±åºç¨ç¨åºçåè½ï¼æé«äºç¨åºççµæ´»æ§åå¯æ©å±æ§ã\n * ç¼ºç¹æ¯å®¹æåçå²çªåéå¤å è½½ç­é®é¢ï¼éè¦è°¨æä½¿ç¨ã\n\n\n# å¦ä½å¨ Java ä¸­ä½¿ç¨ SPI æºå¶ï¼\n\nå¨ Java ä¸­ä½¿ç¨ SPI æºå¶éè¦å®æä»¥ä¸æ­¥éª¤ï¼\n\n * å®ä¹æå¡æ¥å£åæå¡æä¾èæ¥å£ï¼\n * ç¼åæå¡æä¾èå®ç°ï¼å¹¶å°å®ç°ç±»ææ jar åï¼\n * å¨ META-INF/services ç®å½ä¸åå»ºä¸ä¸ªåä¸ºæå¡æ¥å£å¨éå®åçéç½®æä»¶ï¼æä»¶åå®¹ä¸ºæå¡æä¾èæ¥å£çå¨éå®ç±»åï¼\n * å¨ç¨åºä¸­å è½½æå¡æä¾èå®ç°ï¼å¯ä»¥éè¿ ClassLoader ååå°æºå¶å®ç°ã\n\n\n# å¦ä½é¿å SPI æºå¶ä¸­çå²çªé®é¢ï¼\n\nä¸ºäºé¿å SPI æºå¶ä¸­çå²çªé®é¢ï¼å¯ä»¥ä½¿ç¨ç±»å è½½å¨éç¦»æºå¶ï¼å³åå»ºå¤ä¸ªç±»å è½½å¨ï¼æ¯ä¸ªç±»å è½½å¨å è½½ä¸åç jar ååéç½®æä»¶ï¼ä»èå®ç°æå¡æä¾èå®ç°çéç¦»ãåæ¶ï¼ä¹å¯ä»¥è§èå½åç©ºé´çä½¿ç¨ï¼é¿åä¸åçæå¡æä¾èå®ç°ä½¿ç¨ç¸åçå½åç©ºé´ã\n\n\n# SPI æºå¶å Spring ç BeanFactory æä»ä¹åºå«ï¼\n\nSPI æºå¶å Spring ç BeanFactory é½æ¯ç¨äºå®ç°æä»¶ååæ©å±æ§çæºå¶ï¼ä½æ¯å®ä»¬çå®ç°æ¹å¼ä¸åãSPI æºå¶æ¯åºäºæ¥å£åéç½®æä»¶çæ¹å¼å®ç°çï¼è Spring ç BeanFactory æ¯åºäºä¾èµæ³¨å¥ååå°æºå¶å®ç°çãSPI æºå¶æ´å è½»éçº§åçµæ´»ï¼éç¨äºç®åçåºç¨åºæ¯ï¼è Spring ç BeanFactory æ´å å¼ºå¤§åå¤æï¼éç¨äºå¤§åçä¼ä¸çº§åºç¨ã\n\n\n# åºåååååºåå\n\n\n# ä»ä¹æ¯åºååï¼ä»ä¹æ¯ååºååï¼\n\nå¦ææä»¬éè¦æä¹å Java å¯¹è±¡æ¯å¦å° Java å¯¹è±¡ä¿å­å¨æä»¶ä¸­ï¼æèå¨ç½ç»ä¼ è¾ Java å¯¹è±¡ï¼è¿äºåºæ¯é½éè¦ç¨å°åºååã\n\nç®åæ¥è¯´ï¼\n\n * åºååï¼ å°æ°æ®ç»ææå¯¹è±¡è½¬æ¢æäºè¿å¶å­èæµçè¿ç¨\n * ååºååï¼å°å¨åºååè¿ç¨ä¸­æçæçäºè¿å¶å­èæµè½¬æ¢ææ°æ®ç»ææèå¯¹è±¡çè¿ç¨\n\nåºååçä¸»è¦ç®çæ¯ï¼\n\néè¿ç½ç»ä¼ è¾å¯¹è±¡æèè¯´æ¯å°å¯¹è±¡å­å¨å°æä»¶ç³»ç»ãæ°æ®åºãåå­ä¸­ã\n\n\n# åºåååè®®å¯¹åºäº TCP/IP 4 å±æ¨¡åçåªä¸å±ï¼\n\n * OSI æ¨¡åä¸­çè¡¨ç¤ºå±\n * TCP/IP 4 å±æ¨¡åä¸­çåºç¨å±\n\n\n# é¡¹ç®ä¸­ï¼JSON æ°æ®çä¼ è¾ä½ç°å¨åªï¼\n\nå¨é¡¹ç®ä¸­ï¼JSON æ°æ®çä¼ è¾æ¯éå¸¸å¸¸è§çæ¹å¼ãJSON æ¯ä¸ç§è½»éçº§çæ°æ®äº¤æ¢æ ¼å¼ï¼å¯ä»¥æ¹ä¾¿å°å¨ååç«¯ä¹é´ä¼ è¾æ°æ®ã\n\nä»¥ä¸æ¯ä¸äºå¸¸è§çå¨é¡¹ç®ä¸­ä½¿ç¨ JSON ä¼ è¾æ°æ®çåºæ¯ï¼\n\n 1. ååç«¯ API äº¤äºï¼å¨ååç«¯åç¦»çé¡¹ç®ä¸­ï¼åç«¯ååç«¯éå¸¸éè¿ API è¿è¡äº¤äºãå¨è¿ç§æåµä¸ï¼åç«¯å°æ°æ®ä»¥ JSON æ ¼å¼è¿åç»åç«¯ï¼åç«¯å¯ä»¥ä½¿ç¨ JavaScript è§£æ JSON æ°æ®ï¼å°å¶è½¬æ¢ä¸ºå¯¹è±¡ï¼å¹¶å¨é¡µé¢ä¸æ¸²ææ°æ®ã\n\n 2. RESTful APIï¼RESTful API æ¯ä¸ç§åºäº HTTP åè®®ç API è®¾è®¡é£æ ¼ï¼éå¸¸ä½¿ç¨ JSON ä½ä¸ºæ°æ®ä¼ è¾æ ¼å¼ãå¨ Java é¡¹ç®ä¸­ï¼å¯ä»¥ä½¿ç¨ Spring MVC æ JAX-RS ç­æ¡æ¶æ¥æå»º RESTful APIï¼å¹¶ä½¿ç¨ä¸äº JSON è§£æåºå° JSON è¯·æ±åååºè½¬æ¢ä¸º Java å¯¹è±¡ã\n\n 3. WebSocket éä¿¡ï¼å¨ååç«¯åç¦»çå®æ¶éä¿¡åºç¨ä¸­ï¼WebSocket æ¯ä¸ç§å¸¸è§çéä¿¡åè®®ãå¨è¿ç§æåµä¸ï¼ååç«¯å¯ä»¥ä½¿ç¨ JSON ä½ä¸ºéä¿¡åè®®ï¼å°æ¶æ¯ä»¥ JSON æ ¼å¼ä¼ è¾ã\n\n 4. éæèµæºå è½½ï¼å¨ååç«¯åç¦»çé¡¹ç®ä¸­ï¼åç«¯éå¸¸ä½¿ç¨ AJAX æ Fetch API ä»åç«¯è·åæ°æ®ãå¨è¿ç§æåµä¸ï¼åç«¯å¯ä»¥å°æ°æ®ä»¥ JSON æ ¼å¼è¿åç»åç«¯ï¼åç«¯å¯ä»¥ä½¿ç¨ JavaScript è§£æ JSON æ°æ®ï¼å¹¶å¨é¡µé¢ä¸æ¸²ææ°æ®ã\n\n\n# è¯­æ³ç³\n\n\n# ä»ä¹æ¯è¯­æ³ç³ï¼\n\nè¯­æ³ç³ï¼Syntactic sugarï¼ä»£æçæ¯ç¼ç¨è¯­è¨ä¸ºäºæ¹ä¾¿ç¨åºåå¼åç¨åºèè®¾è®¡çä¸ç§ç¹æ®è¯­æ³ï¼è¿ç§è¯­æ³å¯¹ç¼ç¨è¯­è¨çåè½å¹¶æ²¡æå½±åã\n\nå®ç°ç¸åçåè½ï¼åºäºè¯­æ³ç³ååºæ¥çä»£ç å¾å¾æ´ç®åç®æ´ä¸æ´æéè¯»ã\n\n> ä¸è¿ï¼JVM å¶å®å¹¶ä¸è½è¯å«è¯­æ³ç³ï¼Java è¯­æ³ç³è¦æ³è¢«æ­£ç¡®æ§è¡ï¼éè¦åéè¿ç¼è¯å¨è¿è¡è§£ç³ï¼ä¹å°±æ¯å¨ç¨åºç¼è¯é¶æ®µå°å¶è½¬æ¢æ JVM è®¤è¯çåºæ¬è¯­æ³ãè¿ä¹ä¾§é¢è¯´æï¼Java ä¸­çæ­£æ¯æè¯­æ³ç³çæ¯ Java ç¼è¯å¨èä¸æ¯ JVMãå¦æä½ å»ç com.sun.tools.javac.main.JavaCompiler çæºç ï¼ä½ ä¼åç°å¨ compile() ä¸­æä¸ä¸ªæ­¥éª¤å°±æ¯è°ç¨ desugar()ï¼è¿ä¸ªæ¹æ³å°±æ¯è´è´£è§£è¯­æ³ç³çå®ç°çã\n\n\n# Java ä¸­æåªäºå¸¸è§çè¯­æ³ç³ï¼\n\nJava ä¸­æå¸¸ç¨çè¯­æ³ç³ä¸»è¦ææ³åãèªå¨æè£ç®±ãåé¿åæ°ãæä¸¾ãåé¨ç±»ãå¢å¼º for å¾ªç¯ãtry-with-resources è¯­æ³ãlambda è¡¨è¾¾å¼ç­ã\n\n\n# åé¨ç±»äºè§£åï¼\n\nåé¨ç±»æ¯æå®ä¹å¨ç±»åé¨çç±»ï¼å®å¯ä»¥è®¿é®å¤é¨ç±»çç§æåéåæ¹æ³ï¼ä»èå®ç°å¯¹å¤é¨ç±»çè®¿é®åæ§å¶ã\n\nåé¨ç±»ä¸»è¦åä¸ºä»¥ä¸å ç§ï¼\n\n 1. **æååé¨ç±»ï¼**å®ä¹å¨ç±»ä¸­çæ®éåé¨ç±»ï¼å¯ä»¥è®¿é®å¤é¨ç±»çç§æåéåæ¹æ³ï¼ï¼ç±»ä¸­ç±»ï¼\n 2. **éæåé¨ç±»ï¼**å®ä¹å¨ç±»ä¸­çéæåé¨ç±»ï¼ä¸è½è®¿é®å¤é¨ç±»çééæåéåæ¹æ³ï¼ï¼éæçç±»ä¸­ç±»ï¼\n 3. å±é¨åé¨ç±»ï¼å®ä¹å¨æ¹æ³åçåé¨ç±»ï¼åªè½å¨æ¹æ³åé¨ä½¿ç¨ãï¼æ¹æ³ä¸­çç±»ï¼\n\n\n# å¿ååé¨ç±»äºè§£åï¼\n\nå¿ååé¨ç±»æ¯ææ²¡æåå­çåé¨ç±»ï¼å®æ¯ä¸ç§ç®åçåé¨ç±»è¯­æ³ï¼å¯ä»¥ç¨æ¥åå»ºä¸ä¸ªä¸´æ¶çãåªä½¿ç¨ä¸æ¬¡çç±»ã\n\nå¿ååé¨ç±»éå¸¸ç¨äºå®ç°æ¥å£ææ½è±¡ç±»ï¼è±æ¬å·ä¸­çåå®¹æ¯å¿ååé¨ç±»çå·ä½å®ç°ï¼ï¼å¿ååé¨ç±»å¯ä»¥ä½¿å¾ä»£ç æ´å ç®æ´ï¼ä½ä¹ä¼ä½¿å¾ä»£ç çå¯è¯»æ§åå¯ç»´æ¤æ§éä½ï¼å æ­¤éè¦è°¨æä½¿ç¨ã\n\nä¾å¦ï¼ä¸é¢çä»£ç æ¼ç¤ºäºå¦ä½ä½¿ç¨å¿ååé¨ç±»å®ç°ä¸ä¸ª Runnable æ¥å£ï¼\n\nThread t = new Thread(new Runnable() {\n    public void run() {\n        // çº¿ç¨æ§è¡çä»£ç \n    }\n});\nt.start();\n\n\n1\n2\n3\n4\n5\n6\n',normalizedContent:'# java åºç¡å°ç»\n\n\n# java åºç¡æ¦å¿µä¸å¸¸è¯\n\n\n# ä»ä¹æ¯ java ?\n\njava æ¯ 1995 å¹´ç± sun å¬å¸æ¨åºçä¸é¨é«çº§è¯­è¨ã\n\njava çåä¸ªåºæ¬ç¹æ§æ¯é¢åå¯¹è±¡ãå¹³å°æ å³æ§ãå®å¨æ§åç®åæ§ã\n\nå·ä½ç¹ç¹å¦ä¸:\n\n 1. ç®åæå­¦ã\n\n 2. å¹³å°æ å³æ§ã\n\n 3. é¢åå¯¹è±¡\n    \n    * é¢åå¯¹è±¡æ¯ä¸ç§ç¨åºè®¾è®¡ææ¯ï¼ä»¥æ¨å å·¥ä½ä¸ºä¾ï¼ä½¿ç¨é¢åå¯¹è±¡æ¹å¼å®ç°çæ¨å çå·¥ä½å³æ³¨éç¹æ°¸è¿æ¯å¶ä½æ¤å­ï¼å¶æ¬¡ææ¯å·¥å·ã\n    \n    * èé¢åè¿ç¨åä¼åå³æ³¨å¶ä½å·¥å·ã\n    \n    * ä¸ c++ ä¸åçæ¯ï¼java ä¸æ¯æå¤ç»§æ¿ï¼åèä»£ä¹çæ¯æ´å ç®åçæ¥å£çæ¦å¿µã\n    \n    * é¢åå¯¹è±¡ä¸å¤§ç¹æ§: å°è£ãå¤æãç»§æ¿ã\n\n 4. ç¼è¯ä¸è§£éå¹¶å­\n\n 5. å¯é æ§\n    \n    * java éè¿æ©ææ£æµä»¥åè¿è¡æ¶æ£æµæ¶é¤äºå®¹æåºéçæåµã\n    * ä¸ c++ ä¸åçæ¯ï¼c++ å¨æä½æ°ç»ãå­ç¬¦ä¸²æ¹å¼ä¸å©ç¨æéæ¨¡åé¿åäºéååå­æèæåæ°æ®çé®é¢ã\n\n 6. å®å¨æ§: java éç¨äºç½ç»/åå¸å¼ç¯å¢ï¼ä¸ºäºè¾¾å°è¿ä¸ªç®æ ï¼java å¨é²çæ¯ï¼é²ç¯¡æ¹ååºå¾å¤§çåªåã\n\n 7. æ¯æç½ç»ç¼ç¨å¹¶ä¸éå¸¸æ¹ä¾¿ã\n\n 8. æ¯æå¤çº¿ç¨ã\n\n> ä»ä¹æ¯ãç¼è¯åãè¯­è¨åãè§£éåãè¯­è¨ï¼\n> \n> ç¼è¯åï¼ç¼è¯åè¯­è¨ ä¼éè¿ç¼è¯å¨å°æºä»£ç ä¸æ¬¡æ§ç¿»è¯æå¯è¢«è¯¥å¹³å°æ§è¡çæºå¨ç ãä¸è¬æåµä¸ï¼ç¼è¯è¯­è¨çæ§è¡éåº¦æ¯è¾å¿«ï¼å¼åæçæ¯è¾ä½ãå¸¸è§çç¼è¯æ§è¯­è¨æ cãc++ãgoãrust ç­ç­ã\n> \n> è§£éåï¼è§£éåè¯­è¨ä¼éè¿è§£éå¨ä¸å¥ä¸å¥çå°ä»£ç è§£éï¼interpretï¼ä¸ºæºå¨ä»£ç ååæ§è¡ãè§£éåè¯­è¨å¼åæçæ¯è¾å¿«ï¼æ§è¡éåº¦æ¯è¾æ¢ãå¸¸è§çè§£éæ§è¯­è¨æ pythonãjavascriptãphp ç­ç­ã\n> \n> è java æ¯ç¼è¯ä¸è§£éå¹¶å­ï¼å ä¸º java æºä»£ç è¿è¡æ¶éè¦åç¼è¯æä¸ºå­èç æä»¶ (.class)ï¼ç¶ååéè¿è§£éå¨ç¿»è¯ææºå¨ç è¿è¡ã\n\n\n# java çä¸ç§ææ¯æ¶æ\n\n 1. javaseï¼æ åçï¼å³å­¦çæ¶æå­¦ä¹ æ¶ä½¿ç¨ççæ¬ã\n 2. javaeeï¼web å¼åéç¨çææ¯æ¶æã\n 3. javameï¼ä¸ºåµå¥å¼è®¾å¤æä¾çè§£å³æ¹æ¡\n\n\n# ä»ä¹æ¯ jvm ?\n\njava èææºï¼jvmï¼æ¯è¿è¡ java å­èç çèææºã\n\njvm æéå¯¹ä¸åç³»ç»çç¹å®å®ç°ï¼windowsï¼linuxï¼macosï¼ï¼ç®çæ¯ä½¿ç¨ç¸åçå­èç ï¼å®ä»¬é½ä¼ç»åºç¸åçç»æã\n\nå­èç åä¸åç³»ç»ç jvm å®ç°æ¯ java è¯­è¨ âä¸æ¬¡ç¼è¯ï¼éå¤å¯ä»¥è¿è¡â çå³é®æå¨ã\n\njvm å¹¶ä¸æ¯åªæä¸ç§ï¼åªè¦éµå® jvm è®¾è®¡è§èå°±è½å¼ååºèªå·±æéè¦ç java èææºï¼æä»¬æ¥å¸¸æç¨ç hotspot vm åªæ¯å¶ä¸­ä¸ç§å®ç°èå·²ã\n\n\n# ä»ä¹æ¯ jdk ?\n\njdk(java development kit) æ¯ java å¼åå·¥å·åï¼åå«äº jre ææçä¸è¥¿ï¼æä»¥ä½ä¸ºå¼åäººåï¼åªéè¦å®è£ jdk å³å¯ã\n\n\n# ä»ä¹æ¯ jre ?\n\njre(java runtime environment) æ¯ java è¿è¡ç¯å¢ï¼åå«è¿è¡æéè¦çç±»åºä»¥å jvmã\n\nä½ å¯è½è®¤ä¸ºå¦æä»ä»è¦è¿è¡ java ç¨åºï¼å®è£ jre å³å¯ï¼ä½æ¯æäº web ç¨åºä¾å¦ï¼éè¦å° jsp è½¬æ¢ä¸º java servlet å°±éè¦ jdk ç¼è¯äºï¼æä»¥ä¿å®èµ·è§ï¼æ è®ºè¿è¡è¿æ¯å¼åï¼æä»¬é½å»ºè®®å¨æä½ç³»ç»ä¸å®è£ jdkã\n\n\n# java ä¸ c++ çåºå«\n\n 1. java æ²¡ææéçæ¦å¿µï¼ä¸è½å c++ ä¸æ ·ç´æ¥æä½åå­ï¼æä»¥æ´å å®å¨ã\n 2. java ä¸æ¯æå¤ç»§æ¿ï¼ä½æ¯å¯ä»¥éè¿å¤æ¥å£å®ç°å¤ç»§æ¿ã\n 3. java åªæ¯ææ¹æ³éè½½ï¼ä¸å c++ ä¸æ ·å¯ä»¥è¿ç®ç¬¦éè½½ã\n 4. java æèªå¨åå­ç®¡çåå¾åæ¶æºå¶ (gc)ï¼æ éå c++ ä¸æ ·æå¨éæ¾ã\n\n> ä»ä¹æ¯ gc ?\n\n\n# åºæ¬è¯­æ³\n\n\n# æ³¨éæåªå ç§å½¢å¼ï¼\n\næä¸ç§ï¼\n\n 1. åè¡æ³¨éï¼éå¸¸ç¨äºè§£éæ¹æ³åæåè¡ä»£ç çä½ç¨ã(//)\n 2. å¤è¡æ³¨éï¼éå¸¸ç¨äºè§£éä¸æ®µä»£ç çä½ç¨ãï¼/* */)\n 3. ææ¡£æ³¨éï¼éå¸¸ç¨äºçæ java å¼åææ¡£ãï¼å³ java docï¼\n\n\n# æ è¯ç¬¦åå³é®å­çåºå«æ¯ä»ä¹ï¼\n\næ è¯ç¬¦ï¼ç®åæ¥è¯´å°±æ¯ä¸ä¸ªåå­ï¼æ¯å¦ æä¸ªåºéºåã\n\nå³é®å­ï¼è¢«èµäºç¹æ®å«ä¹çæ è¯ç¬¦ï¼æ¯å¦ è­¦å¯å±ï¼å»é¢ã\n\næ³¨æï¼ææå³é®å­é½æ¯å°åï¼å¨ ide ä¸­ä¼ä»¥ç¹æ®é¢è²å±ç¤ºã\n\n\n# java æåªäºå³é®å­ï¼\n\n\n\n\n# è®¿é®æ§å¶å³é®å­è§£æ\n\nå®ä»¬çä½ç¨æ¯æ§å¶ç±»ãæ¹æ³ååéçè®¿é®æéã\n\njava ä¸­çè®¿é®æ§å¶å³é®å­ä¸»è¦æä»¥ä¸åä¸ªï¼\n\n 1. public: è¡¨ç¤ºå¬å±çï¼ä»»ä½å°æ¹é½å¯ä»¥è®¿é®ãå¨åä¸é¡¹ç®ä¸­æå¶ä»é¡¹ç®ä¸­ï¼é½å¯ä»¥éè¿å¼å¥ç±»ææ¨¡åè¿è¡è®¿é®ã\n 2. protected: è¡¨ç¤ºåä¿æ¤çï¼åªææ¬ç±»åå¶å­ç±»ä»¥ååä¸åä¸­çå¶ä»ç±»å¯ä»¥è®¿é®ãå¨å¶ä»åä¸­çå­ç±»ä¸å¯ä»¥è®¿é®ã\n 3. defaultï¼å³ä¸åè®¿é®æ§å¶ç¬¦ï¼: è¡¨ç¤ºé»è®¤çï¼åªææ¬ç±»ååä¸åä¸­çå¶ä»ç±»å¯ä»¥è®¿é®ï¼å¶ä»åä¸­çç±»é½ä¸å¯ä»¥è®¿é®ã\n 4. private: è¡¨ç¤ºç§æçï¼åªææ¬ç±»ä¸­å¯ä»¥è®¿é®ï¼å¶ä»ç±»é½ä¸å¯ä»¥è®¿é®ã\n\nå¯è§æ§\n\nåä¸ä¸ªç±» -> åä¸ä¸ªå -> å­ç±» -> å¨å±èå´\n\nå¯è§æ§     private   default   protected   public\nåä¸ä¸ªç±»ä¸­   âï¸        âï¸        âï¸          âï¸\nåä¸ä¸ªåä¸­   â         â         âï¸          âï¸\nå­ç±»ä¸­     â         â         âï¸          âï¸\nå¨å±èå´    â         â         â           âï¸\n\n\n# final å³é®å­è§£æ\n\nfinal æ¯ java ä¸­çä¸ä¸ªå³é®å­ï¼å¯ä»¥ç¨æ¥ä¿®é¥°ç±»ãæ¹æ³ååéï¼è¡¨ç¤ºå®ä»¬ä¸å¯è¢«ä¿®æ¹ã\n\n> è¢« final å³é®å­ä¿®é¥°ä¼æä¹æ ·ï¼\n\n 1. final ä¿®é¥°ç±»ï¼è¡¨ç¤ºè¯¥ç±»æ¯ä¸å¯ç»§æ¿çï¼å³ä¸è½æå­ç±»ã\n 2. final ä¿®é¥°æ¹æ³ï¼è¡¨ç¤ºè¯¥æ¹æ³ä¸è½è¢«å­ç±»éåï¼å³ä¸è½è¢«ä¿®æ¹ã\n 3. final ä¿®é¥°åéï¼è¡¨ç¤ºè¯¥åéæ¯ä¸ä¸ªå¸¸éï¼åªè½è¢«èµå¼ä¸æ¬¡ï¼ä¸è½è¢«ä¿®æ¹ã\n\nfinal å³é®å­çä¸»è¦ä½ç¨å¦ä¸ï¼\n\n * æé«ä»£ç çå®å¨æ§ï¼final å³é®å­å¯ä»¥ä¿è¯ç±»ãæ¹æ³ååéå¨ç¨åºè¿è¡æ¶ä¸è¢«ä¿®æ¹ï¼ä»èæé«äºä»£ç çå®å¨æ§åå¯ç»´æ¤æ§ã\n * æé«ä»£ç çæ§è½ï¼final å³é®å­å¯ä»¥ä½¿å¾ç¼è¯å¨å¨ç¼è¯æ¶è¿è¡ä¼åï¼ä»èæé«äºä»£ç çæ§è½ã\n * æç¡®ä»£ç çå«ä¹ï¼finalå³é®å­å¯ä»¥ä½¿å¾ä»£ç çå«ä¹æ´å æç¡®ï¼ä»èæ¹ä¾¿ä»£ç çç»´æ¤åçè§£ã\n\n\n# if å else if\n\nif å else if æ¯ç¨äºæ¡ä»¶å¤æ­çæ§å¶ç»æãå®ä»¬ç¨äºå¨ä¸åçæ¡ä»¶ä¸æ§è¡ä¸åçä»£ç åã\n\nåºæ¬çè¯­æ³å¦ä¸ï¼\n\nif (condition1) {\n    // å¦æ condition1 ä¸ºçï¼æ§è¡è¿éçä»£ç å\n} else if (condition2) {\n    // å¦æ condition1 ä¸ºåï¼è condition2 ä¸ºçï¼æ§è¡è¿éçä»£ç å\n} else {\n    // å¦æåé¢çæ¡ä»¶é½ä¸ºåï¼æ§è¡è¿éçä»£ç å\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¨æ§è¡æ¶ï¼é¦åå¤æ­ condition1 æ¯å¦ä¸ºçãå¦æä¸ºçï¼æ§è¡ if ä»£ç åï¼å¦æä¸ºåï¼ç»§ç»­å¤æ­ condition2ãå¦æ condition2 ä¸ºçï¼æ§è¡ else if ä»£ç åï¼å¦æ condition2 ä¸ºåï¼æ§è¡ else ä»£ç åã\n\néè¦çä¸ç¹æ¯ï¼ä¸æ¦æä¸ä¸ªæ¡ä»¶ä¸ºçï¼åç»­ç else if æ else é½ä¸ä¼åæ§è¡ï¼å ä¸º java ä¸­ç if - else if - else ç»ææ¯äºæ¥çã\n\nä»¥ä¸æ¯ä¸ä¸ªç®åçä¾å­ï¼\n\nint number = 10;\n\nif (number > 0) {\n    system.out.println("number is positive");\n} else if (number < 0) {\n    system.out.println("number is negative");\n} else {\n    system.out.println("number is zero");\n}\n\n// è¾åº number is positive\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# åé\n\n\n# æååéä¸å±é¨åéçåºå«ï¼\n\nä¸»è¦æ¯åä¸ªåºå«ï¼\n\n 1. ä»è¯­æ³å½¢å¼ä¸çï¼\n    \n    * æååéæ¯å±äºç±»çï¼\n    * èå±é¨åéæ¯å¨ä»£ç åææ¹æ³ä¸­å®ä¹çåéææ¯æ¹æ³çåæ°ã\n    * æååéå¯ä»¥è¢« public,private,static ç­ä¿®é¥°ç¬¦æä¿®é¥°ï¼\n    * èå±é¨åéä¸è½è¢«è®¿é®æ§å¶ä¿®é¥°ç¬¦å static æä¿®é¥°ï¼\n    * ä½æ¯ï¼æååéåå±é¨åéé½è½è¢« final æä¿®é¥°ã\n\n 2. ä»åéå¨åå­ä¸­çå­å¨æ¹å¼æ¥çï¼\n    \n    * å¦ææååéæ¯ä½¿ç¨ static ä¿®é¥°çï¼é£ä¹è¿ä¸ªæååéæ¯å±äºç±»çï¼\n    \n    * å¦ææ²¡æä½¿ç¨ static ä¿®é¥°ï¼è¿ä¸ªæååéæ¯å±äºå®ä¾çã\n      \n      > å¯¹è±¡å­å¨äºå åå­ï¼æ¯ãç±»çå®ä¾åã\n      > \n      > å±é¨åéåå­å¨äºæ åå­ï¼æ¯ãå¨æ¹æ³éå®ä¹çã\n\n 3. ä»åéå¨åå­ä¸­ççå­æ¶é´ä¸çï¼\n    \n    * æååéæ¯å¯¹è±¡çä¸é¨åï¼å®éçå¯¹è±¡çåå»ºèå­å¨ï¼\n    \n    * èå±é¨åééçæ¹æ³çè°ç¨èèªå¨çæï¼éçæ¹æ³çè°ç¨ç»æèæ¶äº¡ã\n\n 4. ä»åéæ¯å¦æé»è®¤å¼æ¥çï¼\n    \n    * æååéå¦ææ²¡æè¢«èµåå§å¼ï¼åä¼èªå¨ä»¥ç±»åçé»è®¤å¼èèµå¼ï¼ä¸ç§æåµä¾å¤:è¢« final ä¿®é¥°çæååéä¹å¿é¡»æ¾å¼å°èµå¼ï¼ï¼\n    * èå±é¨åéåä¸ä¼èªå¨èµå¼ãï¼java ç¼è¯å¨ä¸ä¼å¯¹å±é¨åéè¿è¡é»è®¤åå§åï¼å ä¸ºè¿äºåéçå¼åªå¨æ¹æ³æä»£ç åä¸­ä½¿ç¨ï¼æ²¡æé»è®¤å¼ãå¦æç¨åºåæ²¡ææ¾å¼å°åå§åå±é¨åéï¼åç¼è¯å¨ä¼å¨ç¼è¯æ¶æåºéè¯¯ãå³ä½¿å®ä¹åè£ç±»åçå±é¨åéä¹ä¸æ ·ï¼\n\n\n# éæåéæä»ä¹ç¨ï¼\n\néæåéä¹å°±æ¯è¢« static å³é®å­ä¿®é¥°çåéã\n\nå®å¯ä»¥è¢«ç±»çææå®ä¾å±äº«ï¼æ è®ºä¸ä¸ªç±»åå»ºäºå¤å°ä¸ªå¯¹è±¡ï¼å®ä»¬é½å±äº«åä¸ä»½éæåéãä¹å°±æ¯è¯´ï¼éæåéåªä¼è¢«åéä¸æ¬¡åå­ï¼å±äºç±»ï¼åªå è½½ä¸ä¸ï¼ï¼å³ä½¿åå»ºå¤ä¸ªå¯¹è±¡ï¼è¿æ ·å¯ä»¥èçåå­ã\n\néæåéæ¯éè¿ç±»åæ¥è®¿é®çï¼ä¾å¦ staticvariableexample.staticvarï¼å¦æè¢« private å³é®å­ä¿®é¥°å°±æ æ³è¿æ ·è®¿é®äºï¼ã\n\npublic class staticvariableexample {\n    // éæåé\n    public static int staticvar = 0;\n}\n\n\n1\n2\n3\n4\n\n\néå¸¸æåµä¸ï¼éæåéä¼è¢« final å³é®å­ä¿®é¥°æä¸ºå¸¸éã\n\npublic class constantvariableexample {\n    // å¸¸é\n    public static final int constantvar = 0;\n}\n\n\n1\n2\n3\n4\n\n\n\n# å­ç¬¦åå¸¸éåå­ç¬¦ä¸²å¸¸éçåºå«ï¼\n\n 1. å½¢å¼:\n    * å­ç¬¦å¸¸éæ¯åå¼å·å¼èµ·çä¸ä¸ªå­ç¬¦ï¼\n    * å­ç¬¦ä¸²å¸¸éæ¯åå¼å·å¼èµ·ç 0 ä¸ªæè¥å¹²ä¸ªå­ç¬¦ã\n 2. å«ä¹:\n    * å­ç¬¦å¸¸éç¸å½äºä¸ä¸ªæ´åå¼( ascii å¼),å¯ä»¥åå è¡¨è¾¾å¼è¿ç®;\n    * å­ç¬¦ä¸²å¸¸éä»£è¡¨ä¸ä¸ªå°åå¼(è¯¥å­ç¬¦ä¸²å¨åå­ä¸­å­æ¾ä½ç½®)ã\n 3. å åå­å¤§å°ï¼\n    * å­ç¬¦å¸¸éï¼charï¼åªå  2 ä¸ªå­è;\n    * å­ç¬¦ä¸²å¸¸éï¼stringï¼å è¥å¹²ä¸ªå­èã\n\n> æ³¨æ char å¨ java ä¸­å ä¸¤ä¸ªå­èã\n\n\n# æ¹æ³\n\n\n# ä»ä¹æ¯æ¹æ³çè¿åå¼?æ¹æ³æåªå ç§ç±»åï¼\n\næ¹æ³çè¿åå¼ æ¯ææä»¬è·åå°çæä¸ªæ¹æ³ä½ä¸­çä»£ç æ§è¡åäº§ççç»æï¼\n\næåç§ç±»åï¼\n\n 1. æ åæ°æ è¿åå¼çæ¹æ³\n 2. æåæ°æ è¿åå¼çæ¹æ³\n 3. æè¿åå¼æ åæ°çæ¹æ³\n 4. æè¿åå¼æåæ°çæ¹æ³\n\n\n# éææ¹æ³ä¸ºä»ä¹ä¸è½è°ç¨ééææå?\n\nè¿æ¯å ä¸º\n\n * éææ¹æ³æ¯å±äºç±»çï¼å¨ç±»å è½½çæ¶åå°±ä¼åéåå­ï¼å¯ä»¥éè¿ç±»åç´æ¥è®¿é®ãèééææåå±äºå®ä¾å¯¹è±¡ï¼åªæå¨å¯¹è±¡å®ä¾åä¹åæå­å¨ï¼éè¦éè¿ç±»çå®ä¾å¯¹è±¡å»è®¿é®ã\n * å¨ç±»çééææåä¸å­å¨çæ¶åéææ¹æ³å°±å·²ç»å­å¨äºï¼æ­¤æ¶è°ç¨å¨åå­ä¸­è¿ä¸å­å¨çééææåï¼å±äºéæ³æä½ã\n\n\n# éææ¹æ³åå®ä¾æ¹æ³æä½ä¸åï¼\n\n1ãè°ç¨æ¹å¼\n\n * å¨å¤é¨è°ç¨éææ¹æ³æ¶ï¼å¯ä»¥ä½¿ç¨ ç±»å.æ¹æ³å çæ¹å¼ï¼ä¹å¯ä»¥ä½¿ç¨ å¯¹è±¡.æ¹æ³å çæ¹å¼ï¼\n\n * èå®ä¾æ¹æ³åªæåé¢è¿ç§æ¹å¼ãä¹å°±æ¯è¯´ï¼è°ç¨éææ¹æ³å¯ä»¥æ éåå»ºå¯¹è±¡ ã\n\n2ãè®¿é®ç±»æåæ¯å¦å­å¨éå¶\n\n * éææ¹æ³å¨è®¿é®æ¬ç±»çæåæ¶ï¼åªåè®¸è®¿é®éææåï¼å³éææååéåéææ¹æ³ï¼ï¼ä¸åè®¸è®¿é®å®ä¾æåï¼å³å®ä¾æååéåå®ä¾æ¹æ³ï¼ï¼\n\n * èå®ä¾æ¹æ³ä¸å­å¨è¿ä¸ªéå¶ã\n\n\n# éè½½åéåæä»ä¹åºå«ï¼\n\néè½½å°±æ¯åä¸ä¸ªç±»ä¸­å¤ä¸ªååæ¹æ³æ ¹æ®ä¸åçä¼ åæ¥æ§è¡ä¸åçé»è¾å¤çã\n\néåå°±æ¯å­ç±»å¯¹ç¶ç±»æ¹æ³çéæ°æ¹é ï¼å¤é¨æ ·å­ä¸è½æ¹åï¼åé¨é»è¾å¯ä»¥æ¹åã\n\nåºå«ç¹    éè½½æ¹æ³   éåæ¹æ³\nåçèå´   åä¸ä¸ªç±»   å­ç±»\nåæ°åè¡¨   å¿é¡»ä¿®æ¹   ä¸å®ä¸è½ä¿®æ¹\nè¿åç±»å   å¯ä¿®æ¹    å­ç±»æ¹æ³è¿åå¼ç±»ååºæ¯ç¶ç±»æ¹æ³è¿åå¼ç±»åæ´å°æç¸ç­\nå¼å¸¸     å¯ä¿®æ¹    å­ç±»æ¹æ³å£°ææåºçå¼å¸¸ç±»åºæ¯ç¶ç±»æ¹æ³å£°ææåºçå¼å¸¸ç±»æ´å°æç¸ç­\nè®¿é®ä¿®é¥°   å¯ä¿®æ¹    ä¸å®ä¸è½åæ´ä¸¥æ ¼çéå¶ï¼å¯ä»¥éä½éå¶ï¼\nåçé¶æ®µ   ç¼è¯æ    è¿è¡æ\n\n\n# ä»ä¹æ¯å¯åé¿åæ°ï¼\n\nå¯åé¿åæ°æ¯æå¨å½æ°ææ¹æ³ä¸­ï¼åæ°çæ°éæ¯å¯åçï¼å³å½æ°ææ¹æ³å¯ä»¥æ¥åä¸ç¡®å®æ°éçåæ°ã\n\nå¯åé¿åæ°å¿é¡»æ¾å¨åæ°åè¡¨çæåä¸ä¸ªä½ç½®ï¼å¹¶ä¸ä½¿ç¨çç¥å·ï¼...ï¼æ¥è¡¨ç¤ºã\n\nä¾å¦ï¼\n\npublic static int sum(int... nums) {\n    int result = 0;\n    for (int num : nums) {\n        result += num;\n    }\n    return result;\n}\n\nint sum1 = sum(1, 2, 3);     // sum1 = 6\nint sum2 = sum(1, 2, 3, 4);  // sum2 = 10\nint sum3 = sum(1);           // sum3 = 1\nint sum4 = sum();            // sum4 = 0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nä¹å¯ä¼ å¥æ°ç»\n\nint[] nums = {1, 2, 3};\nint sum5 = sum(nums);        // sum5 = 6\n\n\n1\n2\n\n\n> éå°æ¹æ³éè½½æ¶ä¼ä¼åå¹éåºå®åæ°è¿æ¯å¯ååæ°çæ¹æ³å¢ï¼\n\nä¼ä¼åå¹éåºå®åæ°çæ¹æ³ï¼å ä¸ºåºå®åæ°çæ¹æ³å¹éåº¦æ´é«ã\n\n\n# æ³¨è§£\n\n\n# è°è°å¯¹ java æ³¨è§£ççè§£ï¼è§£å³äºä»ä¹é®é¢ï¼\n\næ³¨è§£å¯ä»¥çä½æ¯ä¸ç§ç¹æ®çæ³¨éï¼æ¬è´¨ä¸æ¯ç»§æ¿äº annotation è¿ä¸ç¹æ®æ¥å£ï¼ä¸»è¦ç¨äºä¿®é¥°ç±»ãæ¹æ³æèåéï¼æä¾æäºä¿¡æ¯ä¾ç¨åºå¨ç¼è¯æèè¿è¡æ¶ä½¿ç¨ã\n\næ³¨è§£åªæè¢«è§£æä¹åæä¼çæãæä»¬å¯ä»¥ä½¿ç¨ jdk æä¾çåç½®æ³¨è§£ä¹å¯ä»¥èªå®ä¹æ³¨è§£ã\n\njava æ³¨è§£çåºç°ä¸»è¦æ¯ä¸ºäºè§£å³ä»£ç ä¸­å¤§ééå¤æ§å·¥ä½ï¼ä¾å¦ï¼éç½®æä»¶çè¯»åãæ¥å¿è®°å½ãæ°æ®æ ¡éªç­ãå¯ä»¥å¸®å©å¼åèæ´å æ¹ä¾¿å°ç®¡çåç»´æ¤ä»£ç ï¼è¿å¯ä»¥å®ç°ä¸äºç¹å®çåè½ï¼ï¼æé«ç¨åºçè´¨éï¼åå¼åæçï¼ã\n\n\n# æ³¨è§£çè§£ææ¹æ³æåªå ç§ï¼\n\nå¸¸è§çè§£ææ¹æ³æä¸¤ç§ï¼\n\n * ç¼è¯æç´æ¥æ«æï¼ç¼è¯å¨å¨ç¼è¯ java ä»£ç çæ¶åæ«æå¯¹åºçæ³¨è§£å¹¶å¤çï¼æ¯å¦æä¸ªæ¹æ³ä½¿ç¨ @override æ³¨è§£ï¼ç¼è¯å¨å¨ç¼è¯çæ¶åå°±ä¼æ£æµå½åçæ¹æ³æ¯å¦éåäºç¶ç±»å¯¹åºçæ¹æ³ã\n\n * è¿è¡æéè¿åå°å¤çï¼åæ¡æ¶ä¸­èªå¸¦çæ³¨è§£(æ¯å¦ spring æ¡æ¶ç @valueã@component)é½æ¯éè¿åå°æ¥è¿è¡å¤ççã\n   \n   å®ä¹ä¸ä¸ªæ³¨è§£ myannotationï¼\n   \n   @retention(retentionpolicy.runtime)\n   @target(elementtype.type)\n   public @interface myannotation {\n       string value();\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   \n   \n   å¨ä»£ç ä¸­ä½¿ç¨æ³¨è§£ï¼å¹¶éè¿åå°æºå¶è·åæ³¨è§£ä¿¡æ¯ï¼\n   \n   @myannotation("hello")\n   public class myclass {\n       public static void main(string[] args) {\n           myclass obj = new myclass();\n           class<?> clazz = obj.getclass();\n           myannotation annotation = clazz.getannotation(myannotation.class);\n           system.out.println(annotation.value()); // è¾åº "hello"\n       }\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   \n\n * å­èç æ³¨è§£è§£æï¼å¨ç±»å è½½æé´ï¼éè¿ asm æ javassist ç­å­èç æä½åºæ¥è§£ææ³¨è§£ä¿¡æ¯ï¼å¹¶ä¿®æ¹å­èç æä»¶ãè¿ç§æ¹å¼å¯ä»¥å¨ä¸æ¹åæºä»£ç çæåµä¸ï¼å¯¹ä»£ç è¿è¡å¨æçä¿®æ¹åå¢å¼ºã\n   \n   å®ä¹ä¸ä¸ªæ³¨è§£ myannotationï¼\n   \n   @retention(retentionpolicy.runtime)\n   @target(elementtype.type)\n   public @interface myannotation {\n       string value();\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   \n   \n   ä½¿ç¨ asm æä½åºå¨ç±»å è½½æé´è§£ææ³¨è§£ä¿¡æ¯ï¼\n   \n   public class myclassloader extends classloader {\n       @override\n       protected class<?> findclass(string name) throws classnotfoundexception {\n           byte[] bytes = loadclassdata(name);\n           class<?> clazz = defineclass(name, bytes, 0, bytes.length);\n           // è§£ææ³¨è§£ä¿¡æ¯\n           return clazz;\n       }\n   \n       private byte[] loadclassdata(string name) {\n           // è¯»åç±»å­èç æä»¶\n       }\n   }\n   \n   myclassloader loader = new myclassloader();\n   class<?> clazz = loader.loadclass("com.example.myclass");\n   myannotation annotation = clazz.getannotation(myannotation.class);\n   system.out.println(annotation.value()); // è¾åº "hello"\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   15\n   16\n   17\n   18\n   \n\n\n# spi\n\n\n# ä»ä¹æ¯ java ç spi æºå¶ï¼\n\njava ç spiï¼service provider interfaceï¼æºå¶æ¯ä¸ç§ç¨äºå¨æå è½½åæ©å±æå¡çæºå¶ï¼å®éè¿å®ä¹æå¡æ¥å£ãæå¡æä¾èæ¥å£åå è½½éç½®æä»¶çæ¹å¼ï¼å®ç°äºå¨è¿è¡æ¶å¨æå è½½æå¡æä¾èå®ç°çåè½ã\n\n\n# spi æºå¶çä¼ç¼ºç¹æ¯ä»ä¹ï¼\n\nspi æºå¶ç\n\n * ä¼ç¹æ¯å¯ä»¥å¨ä¸ä¿®æ¹ä»£ç çæåµä¸ï¼å¨æå°æ©å±åºç¨ç¨åºçåè½ï¼æé«äºç¨åºççµæ´»æ§åå¯æ©å±æ§ã\n * ç¼ºç¹æ¯å®¹æåçå²çªåéå¤å è½½ç­é®é¢ï¼éè¦è°¨æä½¿ç¨ã\n\n\n# å¦ä½å¨ java ä¸­ä½¿ç¨ spi æºå¶ï¼\n\nå¨ java ä¸­ä½¿ç¨ spi æºå¶éè¦å®æä»¥ä¸æ­¥éª¤ï¼\n\n * å®ä¹æå¡æ¥å£åæå¡æä¾èæ¥å£ï¼\n * ç¼åæå¡æä¾èå®ç°ï¼å¹¶å°å®ç°ç±»ææ jar åï¼\n * å¨ meta-inf/services ç®å½ä¸åå»ºä¸ä¸ªåä¸ºæå¡æ¥å£å¨éå®åçéç½®æä»¶ï¼æä»¶åå®¹ä¸ºæå¡æä¾èæ¥å£çå¨éå®ç±»åï¼\n * å¨ç¨åºä¸­å è½½æå¡æä¾èå®ç°ï¼å¯ä»¥éè¿ classloader ååå°æºå¶å®ç°ã\n\n\n# å¦ä½é¿å spi æºå¶ä¸­çå²çªé®é¢ï¼\n\nä¸ºäºé¿å spi æºå¶ä¸­çå²çªé®é¢ï¼å¯ä»¥ä½¿ç¨ç±»å è½½å¨éç¦»æºå¶ï¼å³åå»ºå¤ä¸ªç±»å è½½å¨ï¼æ¯ä¸ªç±»å è½½å¨å è½½ä¸åç jar ååéç½®æä»¶ï¼ä»èå®ç°æå¡æä¾èå®ç°çéç¦»ãåæ¶ï¼ä¹å¯ä»¥è§èå½åç©ºé´çä½¿ç¨ï¼é¿åä¸åçæå¡æä¾èå®ç°ä½¿ç¨ç¸åçå½åç©ºé´ã\n\n\n# spi æºå¶å spring ç beanfactory æä»ä¹åºå«ï¼\n\nspi æºå¶å spring ç beanfactory é½æ¯ç¨äºå®ç°æä»¶ååæ©å±æ§çæºå¶ï¼ä½æ¯å®ä»¬çå®ç°æ¹å¼ä¸åãspi æºå¶æ¯åºäºæ¥å£åéç½®æä»¶çæ¹å¼å®ç°çï¼è spring ç beanfactory æ¯åºäºä¾èµæ³¨å¥ååå°æºå¶å®ç°çãspi æºå¶æ´å è½»éçº§åçµæ´»ï¼éç¨äºç®åçåºç¨åºæ¯ï¼è spring ç beanfactory æ´å å¼ºå¤§åå¤æï¼éç¨äºå¤§åçä¼ä¸çº§åºç¨ã\n\n\n# åºåååååºåå\n\n\n# ä»ä¹æ¯åºååï¼ä»ä¹æ¯ååºååï¼\n\nå¦ææä»¬éè¦æä¹å java å¯¹è±¡æ¯å¦å° java å¯¹è±¡ä¿å­å¨æä»¶ä¸­ï¼æèå¨ç½ç»ä¼ è¾ java å¯¹è±¡ï¼è¿äºåºæ¯é½éè¦ç¨å°åºååã\n\nç®åæ¥è¯´ï¼\n\n * åºååï¼ å°æ°æ®ç»ææå¯¹è±¡è½¬æ¢æäºè¿å¶å­èæµçè¿ç¨\n * ååºååï¼å°å¨åºååè¿ç¨ä¸­æçæçäºè¿å¶å­èæµè½¬æ¢ææ°æ®ç»ææèå¯¹è±¡çè¿ç¨\n\nåºååçä¸»è¦ç®çæ¯ï¼\n\néè¿ç½ç»ä¼ è¾å¯¹è±¡æèè¯´æ¯å°å¯¹è±¡å­å¨å°æä»¶ç³»ç»ãæ°æ®åºãåå­ä¸­ã\n\n\n# åºåååè®®å¯¹åºäº tcp/ip 4 å±æ¨¡åçåªä¸å±ï¼\n\n * osi æ¨¡åä¸­çè¡¨ç¤ºå±\n * tcp/ip 4 å±æ¨¡åä¸­çåºç¨å±\n\n\n# é¡¹ç®ä¸­ï¼json æ°æ®çä¼ è¾ä½ç°å¨åªï¼\n\nå¨é¡¹ç®ä¸­ï¼json æ°æ®çä¼ è¾æ¯éå¸¸å¸¸è§çæ¹å¼ãjson æ¯ä¸ç§è½»éçº§çæ°æ®äº¤æ¢æ ¼å¼ï¼å¯ä»¥æ¹ä¾¿å°å¨ååç«¯ä¹é´ä¼ è¾æ°æ®ã\n\nä»¥ä¸æ¯ä¸äºå¸¸è§çå¨é¡¹ç®ä¸­ä½¿ç¨ json ä¼ è¾æ°æ®çåºæ¯ï¼\n\n 1. ååç«¯ api äº¤äºï¼å¨ååç«¯åç¦»çé¡¹ç®ä¸­ï¼åç«¯ååç«¯éå¸¸éè¿ api è¿è¡äº¤äºãå¨è¿ç§æåµä¸ï¼åç«¯å°æ°æ®ä»¥ json æ ¼å¼è¿åç»åç«¯ï¼åç«¯å¯ä»¥ä½¿ç¨ javascript è§£æ json æ°æ®ï¼å°å¶è½¬æ¢ä¸ºå¯¹è±¡ï¼å¹¶å¨é¡µé¢ä¸æ¸²ææ°æ®ã\n\n 2. restful apiï¼restful api æ¯ä¸ç§åºäº http åè®®ç api è®¾è®¡é£æ ¼ï¼éå¸¸ä½¿ç¨ json ä½ä¸ºæ°æ®ä¼ è¾æ ¼å¼ãå¨ java é¡¹ç®ä¸­ï¼å¯ä»¥ä½¿ç¨ spring mvc æ jax-rs ç­æ¡æ¶æ¥æå»º restful apiï¼å¹¶ä½¿ç¨ä¸äº json è§£æåºå° json è¯·æ±åååºè½¬æ¢ä¸º java å¯¹è±¡ã\n\n 3. websocket éä¿¡ï¼å¨ååç«¯åç¦»çå®æ¶éä¿¡åºç¨ä¸­ï¼websocket æ¯ä¸ç§å¸¸è§çéä¿¡åè®®ãå¨è¿ç§æåµä¸ï¼ååç«¯å¯ä»¥ä½¿ç¨ json ä½ä¸ºéä¿¡åè®®ï¼å°æ¶æ¯ä»¥ json æ ¼å¼ä¼ è¾ã\n\n 4. éæèµæºå è½½ï¼å¨ååç«¯åç¦»çé¡¹ç®ä¸­ï¼åç«¯éå¸¸ä½¿ç¨ ajax æ fetch api ä»åç«¯è·åæ°æ®ãå¨è¿ç§æåµä¸ï¼åç«¯å¯ä»¥å°æ°æ®ä»¥ json æ ¼å¼è¿åç»åç«¯ï¼åç«¯å¯ä»¥ä½¿ç¨ javascript è§£æ json æ°æ®ï¼å¹¶å¨é¡µé¢ä¸æ¸²ææ°æ®ã\n\n\n# è¯­æ³ç³\n\n\n# ä»ä¹æ¯è¯­æ³ç³ï¼\n\nè¯­æ³ç³ï¼syntactic sugarï¼ä»£æçæ¯ç¼ç¨è¯­è¨ä¸ºäºæ¹ä¾¿ç¨åºåå¼åç¨åºèè®¾è®¡çä¸ç§ç¹æ®è¯­æ³ï¼è¿ç§è¯­æ³å¯¹ç¼ç¨è¯­è¨çåè½å¹¶æ²¡æå½±åã\n\nå®ç°ç¸åçåè½ï¼åºäºè¯­æ³ç³ååºæ¥çä»£ç å¾å¾æ´ç®åç®æ´ä¸æ´æéè¯»ã\n\n> ä¸è¿ï¼jvm å¶å®å¹¶ä¸è½è¯å«è¯­æ³ç³ï¼java è¯­æ³ç³è¦æ³è¢«æ­£ç¡®æ§è¡ï¼éè¦åéè¿ç¼è¯å¨è¿è¡è§£ç³ï¼ä¹å°±æ¯å¨ç¨åºç¼è¯é¶æ®µå°å¶è½¬æ¢æ jvm è®¤è¯çåºæ¬è¯­æ³ãè¿ä¹ä¾§é¢è¯´æï¼java ä¸­çæ­£æ¯æè¯­æ³ç³çæ¯ java ç¼è¯å¨èä¸æ¯ jvmãå¦æä½ å»ç com.sun.tools.javac.main.javacompiler çæºç ï¼ä½ ä¼åç°å¨ compile() ä¸­æä¸ä¸ªæ­¥éª¤å°±æ¯è°ç¨ desugar()ï¼è¿ä¸ªæ¹æ³å°±æ¯è´è´£è§£è¯­æ³ç³çå®ç°çã\n\n\n# java ä¸­æåªäºå¸¸è§çè¯­æ³ç³ï¼\n\njava ä¸­æå¸¸ç¨çè¯­æ³ç³ä¸»è¦ææ³åãèªå¨æè£ç®±ãåé¿åæ°ãæä¸¾ãåé¨ç±»ãå¢å¼º for å¾ªç¯ãtry-with-resources è¯­æ³ãlambda è¡¨è¾¾å¼ç­ã\n\n\n# åé¨ç±»äºè§£åï¼\n\nåé¨ç±»æ¯æå®ä¹å¨ç±»åé¨çç±»ï¼å®å¯ä»¥è®¿é®å¤é¨ç±»çç§æåéåæ¹æ³ï¼ä»èå®ç°å¯¹å¤é¨ç±»çè®¿é®åæ§å¶ã\n\nåé¨ç±»ä¸»è¦åä¸ºä»¥ä¸å ç§ï¼\n\n 1. **æååé¨ç±»ï¼**å®ä¹å¨ç±»ä¸­çæ®éåé¨ç±»ï¼å¯ä»¥è®¿é®å¤é¨ç±»çç§æåéåæ¹æ³ï¼ï¼ç±»ä¸­ç±»ï¼\n 2. **éæåé¨ç±»ï¼**å®ä¹å¨ç±»ä¸­çéæåé¨ç±»ï¼ä¸è½è®¿é®å¤é¨ç±»çééæåéåæ¹æ³ï¼ï¼éæçç±»ä¸­ç±»ï¼\n 3. å±é¨åé¨ç±»ï¼å®ä¹å¨æ¹æ³åçåé¨ç±»ï¼åªè½å¨æ¹æ³åé¨ä½¿ç¨ãï¼æ¹æ³ä¸­çç±»ï¼\n\n\n# å¿ååé¨ç±»äºè§£åï¼\n\nå¿ååé¨ç±»æ¯ææ²¡æåå­çåé¨ç±»ï¼å®æ¯ä¸ç§ç®åçåé¨ç±»è¯­æ³ï¼å¯ä»¥ç¨æ¥åå»ºä¸ä¸ªä¸´æ¶çãåªä½¿ç¨ä¸æ¬¡çç±»ã\n\nå¿ååé¨ç±»éå¸¸ç¨äºå®ç°æ¥å£ææ½è±¡ç±»ï¼è±æ¬å·ä¸­çåå®¹æ¯å¿ååé¨ç±»çå·ä½å®ç°ï¼ï¼å¿ååé¨ç±»å¯ä»¥ä½¿å¾ä»£ç æ´å ç®æ´ï¼ä½ä¹ä¼ä½¿å¾ä»£ç çå¯è¯»æ§åå¯ç»´æ¤æ§éä½ï¼å æ­¤éè¦è°¨æä½¿ç¨ã\n\nä¾å¦ï¼ä¸é¢çä»£ç æ¼ç¤ºäºå¦ä½ä½¿ç¨å¿ååé¨ç±»å®ç°ä¸ä¸ª runnable æ¥å£ï¼\n\nthread t = new thread(new runnable() {\n    public void run() {\n        // çº¿ç¨æ§è¡çä»£ç \n    }\n});\nt.start();\n\n\n1\n2\n3\n4\n5\n6\n',charsets:{cjk:!0}},{title:"Javaåºæ¬æ°æ®ç±»å",frontmatter:{title:"Javaåºæ¬æ°æ®ç±»å",date:"2023-06-15T11:13:54.000Z",permalink:"/pages/b3eb48/",author:{name:"éä¸æ¸é£",link:"https://github.com/msqfx"},categories:["java","åºç¡ç¯"],tags:[null],description:"8 ç§åºæ¬æ°æ®ç±»åï¼byte 1ï¼short 2ï¼int 4ï¼long 8ï¼float 4ï¼dobule 8ï¼char 2ï¼boolean 1",comment:!0,meta:[{name:"twitter:title",content:"Javaåºæ¬æ°æ®ç±»å"},{name:"twitter:description",content:"8 ç§åºæ¬æ°æ®ç±»åï¼byte 1ï¼short 2ï¼int 4ï¼long 8ï¼float 4ï¼dobule 8ï¼char 2ï¼boolean 1"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/01.java/01.%E5%9F%BA%E7%A1%80%E7%AF%87/02.Java%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html"},{property:"og:type",content:"article"},{property:"og:title",content:"Javaåºæ¬æ°æ®ç±»å"},{property:"og:description",content:"8 ç§åºæ¬æ°æ®ç±»åï¼byte 1ï¼short 2ï¼int 4ï¼long 8ï¼float 4ï¼dobule 8ï¼char 2ï¼boolean 1"},{property:"og:url",content:"https://www.msqfx.cc/01.java/01.%E5%9F%BA%E7%A1%80%E7%AF%87/02.Java%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-06-15T11:13:54.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"Javaåºæ¬æ°æ®ç±»å"},{itemprop:"description",content:"8 ç§åºæ¬æ°æ®ç±»åï¼byte 1ï¼short 2ï¼int 4ï¼long 8ï¼float 4ï¼dobule 8ï¼char 2ï¼boolean 1"}],readingShow:"top"},regularPath:"/01.java/01.%E5%9F%BA%E7%A1%80%E7%AF%87/02.Java%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html",relativePath:"01.java/01.åºç¡ç¯/02.Javaåºæ¬æ°æ®ç±»å.md",key:"v-b8532098",path:"/pages/b3eb48/",headers:[{level:2,title:"Java ä¸­çå ç§åºæ¬æ°æ®ç±»åæ¯ä»ä¹ï¼å¯¹åºçåè£ç±»åæ¯ä»ä¹ï¼åèªå ç¨å¤å°å­èï¼",slug:"java-ä¸­çå ç§åºæ¬æ°æ®ç±»åæ¯ä»ä¹-å¯¹åºçåè£ç±»åæ¯ä»ä¹-åèªå ç¨å¤å°å­è",normalizedTitle:"java ä¸­çå ç§åºæ¬æ°æ®ç±»åæ¯ä»ä¹ï¼å¯¹åºçåè£ç±»åæ¯ä»ä¹ï¼åèªå ç¨å¤å°å­èï¼",charIndex:18},{level:2,title:"è®²è®² int çåå¼èå´æ¯å¤å°ï¼",slug:"è®²è®²-int-çåå¼èå´æ¯å¤å°",normalizedTitle:"è®²è®² int çåå¼èå´æ¯å¤å°ï¼",charIndex:244},{level:2,title:"åºæ¬ç±»åååè£ç±»åçåºå«ï¼",slug:"åºæ¬ç±»åååè£ç±»åçåºå«",normalizedTitle:"åºæ¬ç±»åååè£ç±»åçåºå«ï¼",charIndex:497},{level:2,title:"åè£ç±»åçç¼å­æºå¶äºè§£åï¼",slug:"åè£ç±»åçç¼å­æºå¶äºè§£å",normalizedTitle:"åè£ç±»åçç¼å­æºå¶äºè§£åï¼",charIndex:1062},{level:2,title:"ä¸ºä»ä¹è¦æåè£ç±»åï¼",slug:"ä¸ºä»ä¹è¦æåè£ç±»å",normalizedTitle:"ä¸ºä»ä¹è¦æåè£ç±»åï¼",charIndex:1451},{level:2,title:"èªå¨è£ç®±ä¸æç®±äºè§£åï¼åçæ¯ä»ä¹ï¼",slug:"èªå¨è£ç®±ä¸æç®±äºè§£å-åçæ¯ä»ä¹",normalizedTitle:"èªå¨è£ç®±ä¸æç®±äºè§£åï¼åçæ¯ä»ä¹ï¼",charIndex:2018},{level:2,title:"ä¸ºä»ä¹æµ®ç¹æ°è¿ç®çæ¶åä¼æç²¾åº¦ä¸¢å¤±çé£é©ï¼",slug:"ä¸ºä»ä¹æµ®ç¹æ°è¿ç®çæ¶åä¼æç²¾åº¦ä¸¢å¤±çé£é©",normalizedTitle:"ä¸ºä»ä¹æµ®ç¹æ°è¿ç®çæ¶åä¼æç²¾åº¦ä¸¢å¤±çé£é©ï¼",charIndex:2490},{level:2,title:"å¦ä½è§£å³æµ®ç¹æ°è¿ç®çç²¾åº¦ä¸¢å¤±é®é¢ï¼",slug:"å¦ä½è§£å³æµ®ç¹æ°è¿ç®çç²¾åº¦ä¸¢å¤±é®é¢",normalizedTitle:"å¦ä½è§£å³æµ®ç¹æ°è¿ç®çç²¾åº¦ä¸¢å¤±é®é¢ï¼",charIndex:2769},{level:2,title:"è¶è¿ long æ´åçæ°æ®åºè¯¥å¦ä½è¡¨ç¤ºï¼",slug:"è¶è¿-long-æ´åçæ°æ®åºè¯¥å¦ä½è¡¨ç¤º",normalizedTitle:"è¶è¿ long æ´åçæ°æ®åºè¯¥å¦ä½è¡¨ç¤ºï¼",charIndex:3218},{level:2,title:"ä»ä¹æ¯å¼ç¨ç±»åï¼",slug:"ä»ä¹æ¯å¼ç¨ç±»å",normalizedTitle:"ä»ä¹æ¯å¼ç¨ç±»åï¼",charIndex:3849},{level:2,title:"NPE é®é¢ï¼",slug:"npe-é®é¢",normalizedTitle:"npe é®é¢ï¼",charIndex:4352}],headersStr:"Java ä¸­çå ç§åºæ¬æ°æ®ç±»åæ¯ä»ä¹ï¼å¯¹åºçåè£ç±»åæ¯ä»ä¹ï¼åèªå ç¨å¤å°å­èï¼ è®²è®² int çåå¼èå´æ¯å¤å°ï¼ åºæ¬ç±»åååè£ç±»åçåºå«ï¼ åè£ç±»åçç¼å­æºå¶äºè§£åï¼ ä¸ºä»ä¹è¦æåè£ç±»åï¼ èªå¨è£ç®±ä¸æç®±äºè§£åï¼åçæ¯ä»ä¹ï¼ ä¸ºä»ä¹æµ®ç¹æ°è¿ç®çæ¶åä¼æç²¾åº¦ä¸¢å¤±çé£é©ï¼ å¦ä½è§£å³æµ®ç¹æ°è¿ç®çç²¾åº¦ä¸¢å¤±é®é¢ï¼ è¶è¿ long æ´åçæ°æ®åºè¯¥å¦ä½è¡¨ç¤ºï¼ ä»ä¹æ¯å¼ç¨ç±»åï¼ NPE é®é¢ï¼",content:'# Java åºæ¬æ°æ®ç±»å\n\n\n# Java ä¸­çå ç§åºæ¬æ°æ®ç±»åæ¯ä»ä¹ï¼å¯¹åºçåè£ç±»åæ¯ä»ä¹ï¼åèªå ç¨å¤å°å­èï¼\n\n8 ç§åºæ¬æ°æ®ç±»åï¼byte 1ï¼short 2ï¼int 4ï¼long 8ï¼float 4ï¼dobule 8ï¼char 2ï¼boolean 1\n\nå¯¹åºçåè£ç±»åï¼Byteï¼Shortï¼Intergerï¼Longï¼Floatï¼Doubleï¼Characterï¼Boolean\n\nå¯¹åºå ç¨çå­èï¼1ï¼2ï¼4ï¼8ï¼4ï¼8ï¼2ï¼1\n\n> æ³¨æï¼short æ¯ 2 å­è\n\n\n# è®²è®² int çåå¼èå´æ¯å¤å°ï¼\n\næ³æ³å­èååå¼èå´çå³ç³»ã\n\n * int æ 4 ä¸ªå­èï¼ä¹å°±æ¯å  32 ä¸ªæ¯ç¹ä½ï¼\n * æä»¥åå¼èå´å°±æ¯ã-2 ç 31 æ¬¡æ¹å° 2 ç 31 æ¬¡æ¹å 1ãï¼å³çº¦ä¸º -2,147,483,648 å° 2,147,483,647ã\n\n> éè¦æ³¨æçæ¯ï¼è¿ä¸ªèå´æ¯éå¯¹æç¬¦å·çæ´æ°ç±»åã\n> \n> å¦æä½¿ç¨ãæ ç¬¦å·ãçæ´æ°ç±»åï¼å¦ Java ä¸­ç unsigned intï¼ï¼åèå´å°ä» 0 å° 2^32 - 1ï¼å³çº¦ä¸º 0 å° 4,294,967,295ã\n\n\n# åºæ¬ç±»åååè£ç±»åçåºå«ï¼\n\näºå¤§åºå«ï¼\n\nç¨éï¼\n\n * åºæ¬ç±»åä¸è¬ç¨æ¥å®ä¹ä¸äºå¸¸éåå±é¨åéï¼æä»¬å¨å¶ä»å°æ¹æ¯å¦æ¹æ³åæ°ãå¯¹è±¡å±æ§ä¸­å¾å°ä¼ä½¿ç¨åºæ¬ç±»åæ¥å®ä¹åéã\n * åè£ç±»åå¯ç¨äºæ³åï¼èåºæ¬ç±»åä¸å¯ä»¥ã\n\nå­å¨æ¹å¼ï¼\n\n * åºæ¬æ°æ®ç±»åçãå±é¨åéãå­æ¾å¨ Java èææºæ ä¸­çå±é¨åéè¡¨ä¸­ï¼åºæ¬æ°æ®ç±»åçãæååéãï¼æªè¢« static ä¿®é¥° ï¼å­æ¾å¨ Java èææºçå ä¸­ã\n * åè£ç±»åå±äºå¯¹è±¡ç±»åï¼å ä¹ææå¯¹è±¡å®ä¾é½å­å¨äºå ä¸­ã\n\nå ç¨ç©ºé´ï¼\n\nç¸æ¯äºåè£ç±»åï¼å¯¹è±¡ç±»åï¼ï¼åºæ¬æ°æ®ç±»åå ç¨çç©ºé´å¾å¾éå¸¸å°ã\n\né»è®¤å¼ï¼\n\n * æååéåè£ç±»åçé»è®¤å¼æ¯ nullï¼\n\n * åºæ¬ç±»åæé»è®¤å¼ï¼ä½ä¸åºå®ã\n   \n   >  * byteï¼0\n   >  * shortï¼0\n   >  * intï¼0\n   >  * longï¼0L\n   >  * floatï¼0.0f\n   >  * doubleï¼0.0d\n   >  * charï¼\'\\u0000\'\n   >  * booleanï¼false\n\næ¯è¾æ¹å¼ï¼\n\n * å¯¹äºåºæ¬æ°æ®ç±»åæ¥è¯´ï¼== æ¯è¾çæ¯å¼ã\n * å¯¹äºåè£æ°æ®ç±»åæ¥è¯´ï¼== æ¯è¾çæ¯å¯¹è±¡çåå­å°åãæææ´ååè£ç±»å¯¹è±¡ä¹é´å¼çæ¯è¾ï¼å¨é¨ä½¿ç¨ equals() æ¹æ³ã\n\n\n# åè£ç±»åçç¼å­æºå¶äºè§£åï¼\n\nå¦ä¸ç§è¯´æ³æ¯ï¼åè£ç±»åçå¸¸éæ± ææ¯ã\n\nJava åºæ¬æ°æ®ç±»åçåè£ç±»åå¤§é¨åé½ç¨å°äºç¼å­æºå¶æ¥æåæ§è½ï¼é¤äºæµ®ç¹åï¼ãå³ä¼é»è®¤åå»ºç¸åºç±»åçç¼å­æ°æ®ã\n\nä¾å¦ï¼Byte,Short,Interger,Long è¿ 4 ç§åè£ç±»é»è®¤åå»ºäºæ°å¼ [-128,127] çç¸åºç±»åçç¼å­æ°æ®ï¼Character åå»ºäºæ°å¼å¨ [0,127] èå´çç¼å­æ°æ®ï¼Boolean ç´æ¥è¿å True or Falseã\n\nå½ä½¿ç¨èªå¨è£ç®±çæ¹å¼å°ä¸ä¸ªåºæ¬æ°æ®ç±»åçå¼è½¬æ¢ä¸ºåè£ç±»åæ¶ï¼å¦æè¿ä¸ªå¼å¨ç¼å­èå´åï¼é£ä¹å°±ç´æ¥è¿åç¼å­ä¸­çå¯¹è±¡ï¼å¦åå°±åå»ºä¸ä¸ªæ°çå¯¹è±¡ã\n\n> ç±äºåè£ç±»åçå¼æ¯å­å¨å¨å åå­ä¸­çï¼å æ­¤å¨è¿è¡å¤§éçæ°å¼è®¡ç®æ¶ï¼ä½¿ç¨åè£ç±»åä¼æ¯ç´æ¥ä½¿ç¨åºæ¬æ°æ®ç±»åæ´å èæ¶åå ç¨åå­ãä¸ºäºæé«ç¨åºçæ§è½åæçï¼Java æä¾äºåè£ç±»åçç¼å­æºå¶ã\n\n\n# ä¸ºä»ä¹è¦æåè£ç±»åï¼\n\nå¨ Java ä¸­ï¼åè£ç±»åæ¯å°åºæ¬æ°æ®ç±»åï¼å¦ intãdouble ç­ï¼å°è£æå¯¹è±¡çä¸ç§æºå¶ã\n\nJava ä¸­å¼å¥åè£ç±»åçä¸»è¦åå æ¯ä¸ºäºæä¾ä¸äºé¢å¤çåè½åçµæ´»æ§ï¼è¿äºåè½å¨åºæ¬æ°æ®ç±»åä¸ä¸å¯ç¨ã\n\nä»¥ä¸æ¯ä¸äºåè£ç±»åçå¸¸è§ç¨éï¼\n\n 1. åè£ç±»åå¯ä»¥ä½¿åºæ¬æ°æ®ç±»åå·æå¯¹è±¡ç¹æ§ãä¾å¦ï¼å¯ä»¥å°åè£ç±»åå­å¨å¨éåä¸­ï¼å¦ ListãMap ç­ï¼ï¼èåºæ¬æ°æ®ç±»åä¸è½ã\n 2. åè£ç±»åå·æé¢åå¯¹è±¡çè¡ä¸ºãä¾å¦ï¼å¯ä»¥ä½¿ç¨ toString() æ¹æ³å°åè£ç±»åè½¬æ¢ä¸ºå­ç¬¦ä¸²ï¼èåºæ¬æ°æ®ç±»åä¸è½ã\n 3. åè£ç±»åå¯ä»¥ä¸º nullãä¾å¦ï¼å¦æå°è¯å°åºæ¬æ°æ®ç±»åèµå¼ä¸º nullï¼åä¼å¼åç©ºæéå¼å¸¸ãä½æ¯ï¼å°åè£ç±»åèµå¼ä¸º null æ¯å¯ä»¥çãï¼ä¸è¬å£°æåéæ¶ç¨å¼ç¨ç±»åï¼èåæ°ç±»åç¨åºæ¬æ°æ®ç±»åï¼\n 4. åè£ç±»åæ¯æèªå¨è£ç®±åæç®±ãèªå¨è£ç®±æ¯æå°åºæ¬æ°æ®ç±»åèªå¨è½¬æ¢ä¸ºç¸åºçåè£ç±»åï¼èèªå¨æç®±æ¯æå°åè£ç±»åèªå¨è½¬æ¢ä¸ºç¸åºçåºæ¬æ°æ®ç±»åãè¿ä½¿å¾ä»£ç æ´å ç®æ´åæäºç¼åã\n\næ»ä¹ï¼åè£ç±»åå¯ä»¥ä½¿ Java ä»£ç æ´å çµæ´»åæäºç»´æ¤ãå®ä»¬å¯ä»¥ä½¿åºæ¬æ°æ®ç±»åå·æå¯¹è±¡ç¹æ§ï¼å¹¶æä¾äºè®¸å¤åºæ¬æ°æ®ç±»åä¸ä¸å¯ç¨çåè½ãæ­¤å¤ï¼Java ä¸­çåè£ç±»åè¿å¯ä»¥ç¨äºå¤çç©ºå¼åè¿è¡ç±»åè½¬æ¢ï¼è¿äºå¨åºæ¬æ°æ®ç±»åä¸æ¯ä¸å¯è½å®ç°çã\n\n\n# èªå¨è£ç®±ä¸æç®±äºè§£åï¼åçæ¯ä»ä¹ï¼\n\nè£ç®±å°±æ¯å°åºæ¬ç±»åç¨å®ä»¬å¯¹åºçå¼ç¨ç±»ååè£èµ·æ¥ï¼åçæ¯è°ç¨äºåè£ç±»ç valueOf() æ¹æ³ï¼\n\næç®±æ¯å°åè£ç±»åè½¬æ¢ä¸ºåºæ¬æ°æ®ç±»åï¼ç¸åºçè°ç¨çæ¯ xxxValue() æ¹æ³ï¼æ¯å¦ intValue() æ¹æ³ã\n\n> egï¼\n> \n>  * Integer i = 10 ç­ä»·äº Integer i = Integer.valueOf(10) -- è£ç®±\n>  * int n = i ç­ä»·äº int n = i.intValue() -- æç®±\n\nåçï¼\n\nåºæ¬ç±»åä¸ç¸åºçåè£ç±»åç¨ == å·æ¯è¾ä¼æä¹æ ·ï¼\n\nInteger a = new Integer(10);\nInteger b = new Integer(10);\n\nSystem.out.println(a == b); // è¾åº falseï¼å ä¸ºæ¯è¾çæ¯å¼ç¨\n\nint c = 10;\nSystem.out.println(a == c); // è¾åº trueï¼å ä¸ºèªå¨æç®±åæ¯è¾çæ¯å¼\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# ä¸ºä»ä¹æµ®ç¹æ°è¿ç®çæ¶åä¼æç²¾åº¦ä¸¢å¤±çé£é©ï¼\n\næµ®ç¹æ°è¿ç®ç²¾åº¦ä¸¢å¤±ä»£ç æ¼ç¤ºï¼\n\nfloat a = 2.0f - 1.9f;\nfloat b = 1.8f - 1.7f;\nSystem.out.println(a); // 0.100000024\nSystem.out.println(b); // 0.099999905\nSystem.out.println(a == b); // false\n\n\n1\n2\n3\n4\n5\n\n\nè¿æ¯å ä¸ºè®¡ç®æºå¨è¡¨ç¤ºä¸ä¸ªæ°å­æ¶ï¼å®½åº¦æ¯æéçï¼æ éå¾ªç¯çå°æ°å­å¨å¨è®¡ç®æºæ¶ï¼åªè½è¢«æªæ­ï¼æä»¥å°±ä¼å¯¼è´å°æ°ç²¾åº¦åçæå¤±çæåµã\n\n\n# å¦ä½è§£å³æµ®ç¹æ°è¿ç®çç²¾åº¦ä¸¢å¤±é®é¢ï¼\n\nä½¿ç¨ BigDecimal å¯ä»¥å®ç°å¯¹æµ®ç¹æ°çè¿ç®ï¼å¹¶ä¸ä¸ä¼é æç²¾åº¦ä¸¢å¤±ã\n\néå¸¸æåµä¸ï¼å¤§é¨åéè¦æµ®ç¹æ°ç²¾ç¡®è¿ç®ç»æçä¸å¡åºæ¯ï¼æ¯å¦æ¶åå°é±çåºæ¯ï¼é½æ¯éè¿ BigDecimal æ¥åçã\n\nBigDecimal a = new BigDecimal("1.0");\nBigDecimal b = new BigDecimal("0.9");\nBigDecimal c = new BigDecimal("0.8");\n\nBigDecimal x = a.subtract(b); // sub åæ³\nBigDecimal y = b.subtract(c);\n\nSystem.out.println(x); /* 0.1 */\nSystem.out.println(y); /* 0.1 */\nSystem.out.println(Objects.equals(x, y)); /* true */\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# è¶è¿ long æ´åçæ°æ®åºè¯¥å¦ä½è¡¨ç¤ºï¼\n\n> åºæ¬æ°å¼ç±»åé½æä¸ä¸ªè¡¨è¾¾èå´ï¼å¦æè¶è¿è¿ä¸ªèå´å°±ä¼ææ°å¼æº¢åºçé£é©ã\n> \n> å¨ Java ä¸­ï¼64 ä½ï¼8å­èï¼ long æ´åæ¯æå¤§çæ´æ°ç±»åã\n\nå¦æéè¦è¡¨ç¤ºè¶è¿ long æ´åçæ°æ®ï¼å¯ä»¥ä½¿ç¨ Java æä¾ç BigInteger ç±»ã\n\nimport java.math.BigInteger;\npublic class BigIntegerDemo {\n    public static void main(String[] args) {\n        BigInteger a = new BigInteger("12345678901234567890");\n        BigInteger b = new BigInteger("98765432109876543210");\n        BigInteger c = a.add(b);\n        System.out.println(c);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n * BigInteger ç±»çå ãåãä¹ãé¤ç­è¿ç®é½æ¯éè¿è°ç¨æ¹æ³æ¥å®ç°çï¼èä¸æ¯ååºæ¬æ°æ®ç±»åé£æ ·ä½¿ç¨è¿ç®ç¬¦ã\n * BigInteger åé¨ä½¿ç¨ int[] æ°ç»æ¥å­å¨ä»»æå¤§å°çæ´å½¢æ°æ®ã\n * éè¦æ³¨æçæ¯ï¼BigInteger ç±»çè¿ç®æ¶é´åç©ºé´ææ¬æ¯åºæ¬æ°æ®ç±»åé«å¾å¤ï¼å³è¿ç®çæçç¸å¯¹è¾ä½ã\n\n\n# ä»ä¹æ¯å¼ç¨ç±»åï¼\n\nå¨ Java ä¸­ï¼é¤äºåºæ¬æ°æ®ç±»åå void ç±»åä»¥å¤ï¼å¶å®ææç±»åé½æ¯å¼ç¨ç±»åã\n\n * void ç±»åæ¯ä¸ç§ç¹æ®çç±»åï¼å®è¡¨ç¤ºæ²¡æè¿åå¼çæ¹æ³æè¡¨è¾¾å¼çç±»åã\n * å¨ Java ä¸­ï¼void ç±»åä¸å±äºåºæ¬æ°æ®ç±»åï¼ä¹ä¸å±äºå¼ç¨ç±»åï¼èæ¯ä¸ç§ç¬ç«çç±»åã\n\nå¸¸è§çå¼ç¨ç±»ååæ¬ï¼\n\n 1. ç±»ç±»åï¼Classï¼ï¼ä»£è¡¨ç±»çç±»åã\n 2. æ¥å£ç±»åï¼Interfaceï¼ï¼ä»£è¡¨æ¥å£çç±»åã\n 3. æ°ç»ç±»åï¼Arrayï¼ï¼ä»£è¡¨æ°ç»çç±»åã\n 4. æä¸¾ç±»åï¼Enumï¼ï¼ä»£è¡¨æä¸¾çç±»åã\n 5. æ³åç±»åï¼Genericsï¼ï¼ä»£è¡¨æ³åç±»ææ³åæ¹æ³çç±»åã\n 6. æ³¨è§£ç±»åï¼Annotationï¼ï¼ä»£è¡¨æ³¨è§£çç±»åã\n 7. èªå®ä¹ç±»åï¼Customï¼ï¼å¨ç¨åºä¸­èªå®ä¹çç±»åï¼å¦èªå®ä¹çç±»ãæ¥å£ãæä¸¾ç­ã\n\nMyClass obj = new MyClass();  // ä½¿ç¨ new å³é®å­åå»º MyClass ç±»çå¯¹è±¡ï¼å¹¶å°å¯¹è±¡èµå¼ç» obj åé\n\n\n1\n\n\næ­¤æ¶ï¼obj åéå­å¨çæ¯å¯¹è±¡çåå­å°åï¼å³å¯¹è±¡çå¼ç¨ãå æ­¤ï¼éè¿ obj åéå¯ä»¥è®¿é®å¯¹è±¡çå±æ§åæ¹æ³ã\n\n\n# NPE é®é¢ï¼\n\nNPE é®é¢å°±æ¯ï¼ç©ºæéå¼å¸¸ï¼NullPointerExceptionï¼NPEï¼é®é¢ã\n\nå¨ Java ä¸­ï¼èªå¨æç®±æ¯å°åè£ç±»åèªå¨è½¬æ¢ä¸ºç¸åºçåºæ¬æ°æ®ç±»åçè¿ç¨ï¼èå¦æåè£ç±»åä¸ºnullï¼èªå¨æç®±å°±ä¼å¼åç©ºæéå¼å¸¸ï¼NullPointerExceptionï¼NPEï¼ã\n\nè¿æ¯å ä¸ºåºæ¬æ°æ®ç±»åä¸æ¯æä¸º null å¼ï¼å æ­¤å¨å°è¯ä½¿ç¨ä¸º null çåè£ç±»åæ¶ï¼Java ä¼å°è¯å°å¶è½¬æ¢ä¸ºåºæ¬æ°æ®ç±»åï¼ä»èå¼å NPE å¼å¸¸ã\n\nä»¥ä¸æ¯ä¸ä¸ªç®åçç¤ºä¾ï¼å±ç¤ºäºèªå¨æç®±å¼å NP Eé®é¢çæåµï¼\n\nInteger num = null;\nint i = num; // èªå¨æç®±ï¼å°nullè½¬æ¢ä¸ºintç±»åï¼å¼åNPEå¼å¸¸\n\n\n1\n2\n\n\nä¸ºäºé¿åèªå¨æç®±å¼åç NPE é®é¢ï¼å¯ä»¥ä½¿ç¨æ¡ä»¶è¯­å¥ææ¾å¼æç®±æ¥æ£æ¥åè£ç±»åæ¯å¦ä¸º nullãä¾å¦ï¼å¯ä»¥ä½¿ç¨ä»¥ä¸ä»£ç æ£æ¥åè£ç±»åæ¯å¦ä¸º nullï¼\n\nInteger num = null;\n// æ¡ä»¶è¯­å¥\nint i = (num != null) ? num : 0;\n\n\n1\n2\n3\n\n\nä½¿ç¨æ¾å¼æç®±çä»£ç å¦ä¸ï¼\n\nInteger num = null;\n// æ¾ç¤ºæç®±\nint i = num != null ? num.intValue() : 0;\n\n\n1\n2\n3\n\n\nå¯ä»¥çåºæ¥ï¼ä¸¤èä»£ç å·®ä¸å¤ï¼å¨è¿éå¶å® num ç­ä»·äº num.intValue()ã\n\næåè¿ä¸ªä»£ç æ²¡å æ¬å·æ¯å ä¸ºï¼å¨ Java ä¸­ï¼ä¸ç®è¿ç®ç¬¦ï¼?:ï¼çä¼åçº§æ¯èµå¼è¿ç®ç¬¦ï¼=ï¼é«ï¼èæ¯ç¸ç­è¿ç®ç¬¦ï¼==ï¼åä¸ç­è¿ç®ç¬¦ï¼!=ï¼ä½ãå æ­¤ï¼num != null ä¼åæ§è¡ï¼ä»£ç å¯ä»¥ä¸å æ¬å·èç´æ¥ç¼åã',normalizedContent:'# java åºæ¬æ°æ®ç±»å\n\n\n# java ä¸­çå ç§åºæ¬æ°æ®ç±»åæ¯ä»ä¹ï¼å¯¹åºçåè£ç±»åæ¯ä»ä¹ï¼åèªå ç¨å¤å°å­èï¼\n\n8 ç§åºæ¬æ°æ®ç±»åï¼byte 1ï¼short 2ï¼int 4ï¼long 8ï¼float 4ï¼dobule 8ï¼char 2ï¼boolean 1\n\nå¯¹åºçåè£ç±»åï¼byteï¼shortï¼intergerï¼longï¼floatï¼doubleï¼characterï¼boolean\n\nå¯¹åºå ç¨çå­èï¼1ï¼2ï¼4ï¼8ï¼4ï¼8ï¼2ï¼1\n\n> æ³¨æï¼short æ¯ 2 å­è\n\n\n# è®²è®² int çåå¼èå´æ¯å¤å°ï¼\n\næ³æ³å­èååå¼èå´çå³ç³»ã\n\n * int æ 4 ä¸ªå­èï¼ä¹å°±æ¯å  32 ä¸ªæ¯ç¹ä½ï¼\n * æä»¥åå¼èå´å°±æ¯ã-2 ç 31 æ¬¡æ¹å° 2 ç 31 æ¬¡æ¹å 1ãï¼å³çº¦ä¸º -2,147,483,648 å° 2,147,483,647ã\n\n> éè¦æ³¨æçæ¯ï¼è¿ä¸ªèå´æ¯éå¯¹æç¬¦å·çæ´æ°ç±»åã\n> \n> å¦æä½¿ç¨ãæ ç¬¦å·ãçæ´æ°ç±»åï¼å¦ java ä¸­ç unsigned intï¼ï¼åèå´å°ä» 0 å° 2^32 - 1ï¼å³çº¦ä¸º 0 å° 4,294,967,295ã\n\n\n# åºæ¬ç±»åååè£ç±»åçåºå«ï¼\n\näºå¤§åºå«ï¼\n\nç¨éï¼\n\n * åºæ¬ç±»åä¸è¬ç¨æ¥å®ä¹ä¸äºå¸¸éåå±é¨åéï¼æä»¬å¨å¶ä»å°æ¹æ¯å¦æ¹æ³åæ°ãå¯¹è±¡å±æ§ä¸­å¾å°ä¼ä½¿ç¨åºæ¬ç±»åæ¥å®ä¹åéã\n * åè£ç±»åå¯ç¨äºæ³åï¼èåºæ¬ç±»åä¸å¯ä»¥ã\n\nå­å¨æ¹å¼ï¼\n\n * åºæ¬æ°æ®ç±»åçãå±é¨åéãå­æ¾å¨ java èææºæ ä¸­çå±é¨åéè¡¨ä¸­ï¼åºæ¬æ°æ®ç±»åçãæååéãï¼æªè¢« static ä¿®é¥° ï¼å­æ¾å¨ java èææºçå ä¸­ã\n * åè£ç±»åå±äºå¯¹è±¡ç±»åï¼å ä¹ææå¯¹è±¡å®ä¾é½å­å¨äºå ä¸­ã\n\nå ç¨ç©ºé´ï¼\n\nç¸æ¯äºåè£ç±»åï¼å¯¹è±¡ç±»åï¼ï¼åºæ¬æ°æ®ç±»åå ç¨çç©ºé´å¾å¾éå¸¸å°ã\n\né»è®¤å¼ï¼\n\n * æååéåè£ç±»åçé»è®¤å¼æ¯ nullï¼\n\n * åºæ¬ç±»åæé»è®¤å¼ï¼ä½ä¸åºå®ã\n   \n   >  * byteï¼0\n   >  * shortï¼0\n   >  * intï¼0\n   >  * longï¼0l\n   >  * floatï¼0.0f\n   >  * doubleï¼0.0d\n   >  * charï¼\'\\u0000\'\n   >  * booleanï¼false\n\næ¯è¾æ¹å¼ï¼\n\n * å¯¹äºåºæ¬æ°æ®ç±»åæ¥è¯´ï¼== æ¯è¾çæ¯å¼ã\n * å¯¹äºåè£æ°æ®ç±»åæ¥è¯´ï¼== æ¯è¾çæ¯å¯¹è±¡çåå­å°åãæææ´ååè£ç±»å¯¹è±¡ä¹é´å¼çæ¯è¾ï¼å¨é¨ä½¿ç¨ equals() æ¹æ³ã\n\n\n# åè£ç±»åçç¼å­æºå¶äºè§£åï¼\n\nå¦ä¸ç§è¯´æ³æ¯ï¼åè£ç±»åçå¸¸éæ± ææ¯ã\n\njava åºæ¬æ°æ®ç±»åçåè£ç±»åå¤§é¨åé½ç¨å°äºç¼å­æºå¶æ¥æåæ§è½ï¼é¤äºæµ®ç¹åï¼ãå³ä¼é»è®¤åå»ºç¸åºç±»åçç¼å­æ°æ®ã\n\nä¾å¦ï¼byte,short,interger,long è¿ 4 ç§åè£ç±»é»è®¤åå»ºäºæ°å¼ [-128,127] çç¸åºç±»åçç¼å­æ°æ®ï¼character åå»ºäºæ°å¼å¨ [0,127] èå´çç¼å­æ°æ®ï¼boolean ç´æ¥è¿å true or falseã\n\nå½ä½¿ç¨èªå¨è£ç®±çæ¹å¼å°ä¸ä¸ªåºæ¬æ°æ®ç±»åçå¼è½¬æ¢ä¸ºåè£ç±»åæ¶ï¼å¦æè¿ä¸ªå¼å¨ç¼å­èå´åï¼é£ä¹å°±ç´æ¥è¿åç¼å­ä¸­çå¯¹è±¡ï¼å¦åå°±åå»ºä¸ä¸ªæ°çå¯¹è±¡ã\n\n> ç±äºåè£ç±»åçå¼æ¯å­å¨å¨å åå­ä¸­çï¼å æ­¤å¨è¿è¡å¤§éçæ°å¼è®¡ç®æ¶ï¼ä½¿ç¨åè£ç±»åä¼æ¯ç´æ¥ä½¿ç¨åºæ¬æ°æ®ç±»åæ´å èæ¶åå ç¨åå­ãä¸ºäºæé«ç¨åºçæ§è½åæçï¼java æä¾äºåè£ç±»åçç¼å­æºå¶ã\n\n\n# ä¸ºä»ä¹è¦æåè£ç±»åï¼\n\nå¨ java ä¸­ï¼åè£ç±»åæ¯å°åºæ¬æ°æ®ç±»åï¼å¦ intãdouble ç­ï¼å°è£æå¯¹è±¡çä¸ç§æºå¶ã\n\njava ä¸­å¼å¥åè£ç±»åçä¸»è¦åå æ¯ä¸ºäºæä¾ä¸äºé¢å¤çåè½åçµæ´»æ§ï¼è¿äºåè½å¨åºæ¬æ°æ®ç±»åä¸ä¸å¯ç¨ã\n\nä»¥ä¸æ¯ä¸äºåè£ç±»åçå¸¸è§ç¨éï¼\n\n 1. åè£ç±»åå¯ä»¥ä½¿åºæ¬æ°æ®ç±»åå·æå¯¹è±¡ç¹æ§ãä¾å¦ï¼å¯ä»¥å°åè£ç±»åå­å¨å¨éåä¸­ï¼å¦ listãmap ç­ï¼ï¼èåºæ¬æ°æ®ç±»åä¸è½ã\n 2. åè£ç±»åå·æé¢åå¯¹è±¡çè¡ä¸ºãä¾å¦ï¼å¯ä»¥ä½¿ç¨ tostring() æ¹æ³å°åè£ç±»åè½¬æ¢ä¸ºå­ç¬¦ä¸²ï¼èåºæ¬æ°æ®ç±»åä¸è½ã\n 3. åè£ç±»åå¯ä»¥ä¸º nullãä¾å¦ï¼å¦æå°è¯å°åºæ¬æ°æ®ç±»åèµå¼ä¸º nullï¼åä¼å¼åç©ºæéå¼å¸¸ãä½æ¯ï¼å°åè£ç±»åèµå¼ä¸º null æ¯å¯ä»¥çãï¼ä¸è¬å£°æåéæ¶ç¨å¼ç¨ç±»åï¼èåæ°ç±»åç¨åºæ¬æ°æ®ç±»åï¼\n 4. åè£ç±»åæ¯æèªå¨è£ç®±åæç®±ãèªå¨è£ç®±æ¯æå°åºæ¬æ°æ®ç±»åèªå¨è½¬æ¢ä¸ºç¸åºçåè£ç±»åï¼èèªå¨æç®±æ¯æå°åè£ç±»åèªå¨è½¬æ¢ä¸ºç¸åºçåºæ¬æ°æ®ç±»åãè¿ä½¿å¾ä»£ç æ´å ç®æ´åæäºç¼åã\n\næ»ä¹ï¼åè£ç±»åå¯ä»¥ä½¿ java ä»£ç æ´å çµæ´»åæäºç»´æ¤ãå®ä»¬å¯ä»¥ä½¿åºæ¬æ°æ®ç±»åå·æå¯¹è±¡ç¹æ§ï¼å¹¶æä¾äºè®¸å¤åºæ¬æ°æ®ç±»åä¸ä¸å¯ç¨çåè½ãæ­¤å¤ï¼java ä¸­çåè£ç±»åè¿å¯ä»¥ç¨äºå¤çç©ºå¼åè¿è¡ç±»åè½¬æ¢ï¼è¿äºå¨åºæ¬æ°æ®ç±»åä¸æ¯ä¸å¯è½å®ç°çã\n\n\n# èªå¨è£ç®±ä¸æç®±äºè§£åï¼åçæ¯ä»ä¹ï¼\n\nè£ç®±å°±æ¯å°åºæ¬ç±»åç¨å®ä»¬å¯¹åºçå¼ç¨ç±»ååè£èµ·æ¥ï¼åçæ¯è°ç¨äºåè£ç±»ç valueof() æ¹æ³ï¼\n\næç®±æ¯å°åè£ç±»åè½¬æ¢ä¸ºåºæ¬æ°æ®ç±»åï¼ç¸åºçè°ç¨çæ¯ xxxvalue() æ¹æ³ï¼æ¯å¦ intvalue() æ¹æ³ã\n\n> egï¼\n> \n>  * integer i = 10 ç­ä»·äº integer i = integer.valueof(10) -- è£ç®±\n>  * int n = i ç­ä»·äº int n = i.intvalue() -- æç®±\n\nåçï¼\n\nåºæ¬ç±»åä¸ç¸åºçåè£ç±»åç¨ == å·æ¯è¾ä¼æä¹æ ·ï¼\n\ninteger a = new integer(10);\ninteger b = new integer(10);\n\nsystem.out.println(a == b); // è¾åº falseï¼å ä¸ºæ¯è¾çæ¯å¼ç¨\n\nint c = 10;\nsystem.out.println(a == c); // è¾åº trueï¼å ä¸ºèªå¨æç®±åæ¯è¾çæ¯å¼\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# ä¸ºä»ä¹æµ®ç¹æ°è¿ç®çæ¶åä¼æç²¾åº¦ä¸¢å¤±çé£é©ï¼\n\næµ®ç¹æ°è¿ç®ç²¾åº¦ä¸¢å¤±ä»£ç æ¼ç¤ºï¼\n\nfloat a = 2.0f - 1.9f;\nfloat b = 1.8f - 1.7f;\nsystem.out.println(a); // 0.100000024\nsystem.out.println(b); // 0.099999905\nsystem.out.println(a == b); // false\n\n\n1\n2\n3\n4\n5\n\n\nè¿æ¯å ä¸ºè®¡ç®æºå¨è¡¨ç¤ºä¸ä¸ªæ°å­æ¶ï¼å®½åº¦æ¯æéçï¼æ éå¾ªç¯çå°æ°å­å¨å¨è®¡ç®æºæ¶ï¼åªè½è¢«æªæ­ï¼æä»¥å°±ä¼å¯¼è´å°æ°ç²¾åº¦åçæå¤±çæåµã\n\n\n# å¦ä½è§£å³æµ®ç¹æ°è¿ç®çç²¾åº¦ä¸¢å¤±é®é¢ï¼\n\nä½¿ç¨ bigdecimal å¯ä»¥å®ç°å¯¹æµ®ç¹æ°çè¿ç®ï¼å¹¶ä¸ä¸ä¼é æç²¾åº¦ä¸¢å¤±ã\n\néå¸¸æåµä¸ï¼å¤§é¨åéè¦æµ®ç¹æ°ç²¾ç¡®è¿ç®ç»æçä¸å¡åºæ¯ï¼æ¯å¦æ¶åå°é±çåºæ¯ï¼é½æ¯éè¿ bigdecimal æ¥åçã\n\nbigdecimal a = new bigdecimal("1.0");\nbigdecimal b = new bigdecimal("0.9");\nbigdecimal c = new bigdecimal("0.8");\n\nbigdecimal x = a.subtract(b); // sub åæ³\nbigdecimal y = b.subtract(c);\n\nsystem.out.println(x); /* 0.1 */\nsystem.out.println(y); /* 0.1 */\nsystem.out.println(objects.equals(x, y)); /* true */\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# è¶è¿ long æ´åçæ°æ®åºè¯¥å¦ä½è¡¨ç¤ºï¼\n\n> åºæ¬æ°å¼ç±»åé½æä¸ä¸ªè¡¨è¾¾èå´ï¼å¦æè¶è¿è¿ä¸ªèå´å°±ä¼ææ°å¼æº¢åºçé£é©ã\n> \n> å¨ java ä¸­ï¼64 ä½ï¼8å­èï¼ long æ´åæ¯æå¤§çæ´æ°ç±»åã\n\nå¦æéè¦è¡¨ç¤ºè¶è¿ long æ´åçæ°æ®ï¼å¯ä»¥ä½¿ç¨ java æä¾ç biginteger ç±»ã\n\nimport java.math.biginteger;\npublic class bigintegerdemo {\n    public static void main(string[] args) {\n        biginteger a = new biginteger("12345678901234567890");\n        biginteger b = new biginteger("98765432109876543210");\n        biginteger c = a.add(b);\n        system.out.println(c);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n * biginteger ç±»çå ãåãä¹ãé¤ç­è¿ç®é½æ¯éè¿è°ç¨æ¹æ³æ¥å®ç°çï¼èä¸æ¯ååºæ¬æ°æ®ç±»åé£æ ·ä½¿ç¨è¿ç®ç¬¦ã\n * biginteger åé¨ä½¿ç¨ int[] æ°ç»æ¥å­å¨ä»»æå¤§å°çæ´å½¢æ°æ®ã\n * éè¦æ³¨æçæ¯ï¼biginteger ç±»çè¿ç®æ¶é´åç©ºé´ææ¬æ¯åºæ¬æ°æ®ç±»åé«å¾å¤ï¼å³è¿ç®çæçç¸å¯¹è¾ä½ã\n\n\n# ä»ä¹æ¯å¼ç¨ç±»åï¼\n\nå¨ java ä¸­ï¼é¤äºåºæ¬æ°æ®ç±»åå void ç±»åä»¥å¤ï¼å¶å®ææç±»åé½æ¯å¼ç¨ç±»åã\n\n * void ç±»åæ¯ä¸ç§ç¹æ®çç±»åï¼å®è¡¨ç¤ºæ²¡æè¿åå¼çæ¹æ³æè¡¨è¾¾å¼çç±»åã\n * å¨ java ä¸­ï¼void ç±»åä¸å±äºåºæ¬æ°æ®ç±»åï¼ä¹ä¸å±äºå¼ç¨ç±»åï¼èæ¯ä¸ç§ç¬ç«çç±»åã\n\nå¸¸è§çå¼ç¨ç±»ååæ¬ï¼\n\n 1. ç±»ç±»åï¼classï¼ï¼ä»£è¡¨ç±»çç±»åã\n 2. æ¥å£ç±»åï¼interfaceï¼ï¼ä»£è¡¨æ¥å£çç±»åã\n 3. æ°ç»ç±»åï¼arrayï¼ï¼ä»£è¡¨æ°ç»çç±»åã\n 4. æä¸¾ç±»åï¼enumï¼ï¼ä»£è¡¨æä¸¾çç±»åã\n 5. æ³åç±»åï¼genericsï¼ï¼ä»£è¡¨æ³åç±»ææ³åæ¹æ³çç±»åã\n 6. æ³¨è§£ç±»åï¼annotationï¼ï¼ä»£è¡¨æ³¨è§£çç±»åã\n 7. èªå®ä¹ç±»åï¼customï¼ï¼å¨ç¨åºä¸­èªå®ä¹çç±»åï¼å¦èªå®ä¹çç±»ãæ¥å£ãæä¸¾ç­ã\n\nmyclass obj = new myclass();  // ä½¿ç¨ new å³é®å­åå»º myclass ç±»çå¯¹è±¡ï¼å¹¶å°å¯¹è±¡èµå¼ç» obj åé\n\n\n1\n\n\næ­¤æ¶ï¼obj åéå­å¨çæ¯å¯¹è±¡çåå­å°åï¼å³å¯¹è±¡çå¼ç¨ãå æ­¤ï¼éè¿ obj åéå¯ä»¥è®¿é®å¯¹è±¡çå±æ§åæ¹æ³ã\n\n\n# npe é®é¢ï¼\n\nnpe é®é¢å°±æ¯ï¼ç©ºæéå¼å¸¸ï¼nullpointerexceptionï¼npeï¼é®é¢ã\n\nå¨ java ä¸­ï¼èªå¨æç®±æ¯å°åè£ç±»åèªå¨è½¬æ¢ä¸ºç¸åºçåºæ¬æ°æ®ç±»åçè¿ç¨ï¼èå¦æåè£ç±»åä¸ºnullï¼èªå¨æç®±å°±ä¼å¼åç©ºæéå¼å¸¸ï¼nullpointerexceptionï¼npeï¼ã\n\nè¿æ¯å ä¸ºåºæ¬æ°æ®ç±»åä¸æ¯æä¸º null å¼ï¼å æ­¤å¨å°è¯ä½¿ç¨ä¸º null çåè£ç±»åæ¶ï¼java ä¼å°è¯å°å¶è½¬æ¢ä¸ºåºæ¬æ°æ®ç±»åï¼ä»èå¼å npe å¼å¸¸ã\n\nä»¥ä¸æ¯ä¸ä¸ªç®åçç¤ºä¾ï¼å±ç¤ºäºèªå¨æç®±å¼å np eé®é¢çæåµï¼\n\ninteger num = null;\nint i = num; // èªå¨æç®±ï¼å°nullè½¬æ¢ä¸ºintç±»åï¼å¼ånpeå¼å¸¸\n\n\n1\n2\n\n\nä¸ºäºé¿åèªå¨æç®±å¼åç npe é®é¢ï¼å¯ä»¥ä½¿ç¨æ¡ä»¶è¯­å¥ææ¾å¼æç®±æ¥æ£æ¥åè£ç±»åæ¯å¦ä¸º nullãä¾å¦ï¼å¯ä»¥ä½¿ç¨ä»¥ä¸ä»£ç æ£æ¥åè£ç±»åæ¯å¦ä¸º nullï¼\n\ninteger num = null;\n// æ¡ä»¶è¯­å¥\nint i = (num != null) ? num : 0;\n\n\n1\n2\n3\n\n\nä½¿ç¨æ¾å¼æç®±çä»£ç å¦ä¸ï¼\n\ninteger num = null;\n// æ¾ç¤ºæç®±\nint i = num != null ? num.intvalue() : 0;\n\n\n1\n2\n3\n\n\nå¯ä»¥çåºæ¥ï¼ä¸¤èä»£ç å·®ä¸å¤ï¼å¨è¿éå¶å® num ç­ä»·äº num.intvalue()ã\n\næåè¿ä¸ªä»£ç æ²¡å æ¬å·æ¯å ä¸ºï¼å¨ java ä¸­ï¼ä¸ç®è¿ç®ç¬¦ï¼?:ï¼çä¼åçº§æ¯èµå¼è¿ç®ç¬¦ï¼=ï¼é«ï¼èæ¯ç¸ç­è¿ç®ç¬¦ï¼==ï¼åä¸ç­è¿ç®ç¬¦ï¼!=ï¼ä½ãå æ­¤ï¼num != null ä¼åæ§è¡ï¼ä»£ç å¯ä»¥ä¸å æ¬å·èç´æ¥ç¼åã',charsets:{cjk:!0}},{title:"Javaéåæ¦è¿°",frontmatter:{title:"Javaéåæ¦è¿°",date:"2023-05-11T12:12:40.000Z",permalink:"/pages/2e780e/",author:{name:"éä¸æ¸é£",link:"https://github.com/msqfx"},categories:["java","éåç¯"],tags:[null],description:"æ»ç»",comment:!0,meta:[{name:"image",content:"https://cmty256.github.io/imgs-blog/images/image-20230411210606868.50typmz8n440.jpg"},{name:"twitter:title",content:"Javaéåæ¦è¿°"},{name:"twitter:description",content:"æ»ç»"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://cmty256.github.io/imgs-blog/images/image-20230411210606868.50typmz8n440.jpg"},{name:"twitter:url",content:"https://www.msqfx.cc/01.java/02.%E9%9B%86%E5%90%88%E7%AF%87/01.Java%E9%9B%86%E5%90%88%E6%A6%82%E8%BF%B0.html"},{property:"og:type",content:"article"},{property:"og:title",content:"Javaéåæ¦è¿°"},{property:"og:description",content:"æ»ç»"},{property:"og:image",content:"https://cmty256.github.io/imgs-blog/images/image-20230411210606868.50typmz8n440.jpg"},{property:"og:url",content:"https://www.msqfx.cc/01.java/02.%E9%9B%86%E5%90%88%E7%AF%87/01.Java%E9%9B%86%E5%90%88%E6%A6%82%E8%BF%B0.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-05-11T12:12:40.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"Javaéåæ¦è¿°"},{itemprop:"description",content:"æ»ç»"},{itemprop:"image",content:"https://cmty256.github.io/imgs-blog/images/image-20230411210606868.50typmz8n440.jpg"}],readingShow:"top"},regularPath:"/01.java/02.%E9%9B%86%E5%90%88%E7%AF%87/01.Java%E9%9B%86%E5%90%88%E6%A6%82%E8%BF%B0.html",relativePath:"01.java/02.éåç¯/01.Javaéåæ¦è¿°.md",key:"v-d5c1a816",path:"/pages/2e780e/",headers:[{level:2,title:"éåä¸å®¹å¨",slug:"éåä¸å®¹å¨",normalizedTitle:"éåä¸å®¹å¨",charIndex:16},{level:2,title:"Java éåæ¡æ¶å¦ä¸å¾æç¤º",slug:"java-éåæ¡æ¶å¦ä¸å¾æç¤º",normalizedTitle:"java éåæ¡æ¶å¦ä¸å¾æç¤º",charIndex:273},{level:2,title:"è¯´è¯´ List, Set, Queue, Map åèçåºå«ï¼",slug:"è¯´è¯´-list-set-queue-map-åèçåºå«",normalizedTitle:"è¯´è¯´ list, set, queue, map åèçåºå«ï¼",charIndex:294},{level:2,title:"æ åºæ§åä¸å¯éå¤æ§çå«ä¹æ¯ä»ä¹",slug:"æ åºæ§åä¸å¯éå¤æ§çå«ä¹æ¯ä»ä¹",normalizedTitle:"æ åºæ§åä¸å¯éå¤æ§çå«ä¹æ¯ä»ä¹",charIndex:602},{level:2,title:"éåæ¡æ¶åºå±æ°æ®ç»æå¸¸è§å®ç°ç±»",slug:"éåæ¡æ¶åºå±æ°æ®ç»æå¸¸è§å®ç°ç±»",normalizedTitle:"éåæ¡æ¶åºå±æ°æ®ç»æå¸¸è§å®ç°ç±»",charIndex:759},{level:3,title:"1. List",slug:"_1-list",normalizedTitle:"1. list",charIndex:779},{level:3,title:"2. Set",slug:"_2-set",normalizedTitle:"2. set",charIndex:889},{level:3,title:"3. Queue",slug:"_3-queue",normalizedTitle:"3. queue",charIndex:1311},{level:3,title:"4. Map",slug:"_4-map",normalizedTitle:"4. map",charIndex:1413},{level:2,title:"åå¸å²çª",slug:"åå¸å²çª",normalizedTitle:"åå¸å²çª",charIndex:1487},{level:2,title:"ä¸ºä»ä¹é¾è¡¨å¯ä»¥è§£å³åå¸å²çªï¼æé¾æ³ï¼æ°ç»+é¾è¡¨ï¼",slug:"ä¸ºä»ä¹é¾è¡¨å¯ä»¥è§£å³åå¸å²çª-æé¾æ³-æ°ç»-é¾è¡¨",normalizedTitle:"ä¸ºä»ä¹é¾è¡¨å¯ä»¥è§£å³åå¸å²çªï¼æé¾æ³ï¼æ°ç»+é¾è¡¨ï¼",charIndex:2167},{level:2,title:"åå¸è¡¨æ¯ä»ä¹",slug:"åå¸è¡¨æ¯ä»ä¹",normalizedTitle:"åå¸è¡¨æ¯ä»ä¹",charIndex:2292},{level:2,title:"çº¿ç¨ä¸å®å¨çæ¥å£",slug:"çº¿ç¨ä¸å®å¨çæ¥å£",normalizedTitle:"çº¿ç¨ä¸å®å¨çæ¥å£",charIndex:2698},{level:2,title:"çº¿ç¨å®å¨çæ¥å£",slug:"çº¿ç¨å®å¨çæ¥å£",normalizedTitle:"çº¿ç¨å®å¨çæ¥å£",charIndex:2830},{level:2,title:"ä¸ºä»ä¹è¦ä½¿ç¨éå",slug:"ä¸ºä»ä¹è¦ä½¿ç¨éå",normalizedTitle:"ä¸ºä»ä¹è¦ä½¿ç¨éå",charIndex:2878},{level:2,title:"å­¦ä¹ åè",slug:"å­¦ä¹ åè",normalizedTitle:"å­¦ä¹ åè",charIndex:3025}],headersStr:"éåä¸å®¹å¨ Java éåæ¡æ¶å¦ä¸å¾æç¤º è¯´è¯´ List, Set, Queue, Map åèçåºå«ï¼ æ åºæ§åä¸å¯éå¤æ§çå«ä¹æ¯ä»ä¹ éåæ¡æ¶åºå±æ°æ®ç»æå¸¸è§å®ç°ç±» 1. List 2. Set 3. Queue 4. Map åå¸å²çª ä¸ºä»ä¹é¾è¡¨å¯ä»¥è§£å³åå¸å²çªï¼æé¾æ³ï¼æ°ç»+é¾è¡¨ï¼ åå¸è¡¨æ¯ä»ä¹ çº¿ç¨ä¸å®å¨çæ¥å£ çº¿ç¨å®å¨çæ¥å£ ä¸ºä»ä¹è¦ä½¿ç¨éå å­¦ä¹ åè",content:'# Java éåæ¦è¿°\n\n\n# éåä¸å®¹å¨\n\n 1. å®¹å¨ï¼Containerï¼æ¯ä¸ä¸ªæ´å¹¿æ³çæ¯è¯­ï¼ç¨äºè¡¨ç¤ºå¯ä»¥å®¹çº³ãç»ç»åç®¡çå¶ä»å¯¹è±¡çå¯¹è±¡ãå®æ¯ä¸ä¸ªæ´é«å±æ¬¡çæ¦å¿µï¼åæ¬éåï¼Collectionï¼å¨åã\n 2. éåï¼Collectionï¼æ¯ä¸ç§ç¹å®ç±»åçå®¹å¨ï¼ç¨äºå­å¨åæä½ä¸ç»å¯¹è±¡ãéåæä¾äºå¯¹åç´ çæ·»å ãå é¤ãæ¥æ¾åéåç­æä½ãListãSetãQueue å Map é½æ¯éåçå·ä½å®ç°ã\n\næ»ç»\n\n * å®¹å¨æ¯ä¸ä¸ªå¹¿æ³çæ¦å¿µï¼ç¨äºè¡¨ç¤ºå¯ä»¥å®¹çº³åç®¡çå¶ä»å¯¹è±¡çå¯¹è±¡ã\n * éåæ¯å®¹å¨çä¸ç§ç¹å®ç±»åï¼ç¨äºå­å¨åæä½ä¸ç»å¯¹è±¡ã\n\n\n# Java éåæ¡æ¶å¦ä¸å¾æç¤º\n\n\n\n\n# è¯´è¯´ List, Set, Queue, Map åèçåºå«ï¼\n\n * List(å¯¹ä»é¡ºåºçå¥½å¸®æ): å­å¨çåç´ æ¯æåºçãå¯éå¤çãï¼å¯ä»¥éè¿ç´¢å¼è®¿é®åä¿®æ¹åç´ ï¼\n * Set(æ³¨éç¬ä¸æ äºçæ§è´¨): å­å¨çåç´ æ¯æ åºçãä¸å¯éå¤çãï¼æ ç´¢å¼ï¼\n * Queue(å®ç°æéåè½çå«å·æº): æç¹å®çæéè§åæ¥ç¡®å®ååé¡ºåºï¼å­å¨çåç´ æ¯æåºçãå¯éå¤çã\n * Map(ç¨ key æ¥æç´¢çä¸å®¶): ä½¿ç¨é®å¼å¯¹ï¼key-valueï¼å­å¨ï¼ç±»ä¼¼äºæ°å­¦ä¸çå½æ° y=f(x)ï¼"x" ä»£è¡¨ keyï¼"y" ä»£è¡¨ valueï¼key æ¯æ åºçãä¸å¯éå¤çï¼value æ¯æ åºçãå¯éå¤çï¼æ¯ä¸ªé®æå¤æ å°å°ä¸ä¸ªå¼ã\n\n\n# æ åºæ§åä¸å¯éå¤æ§çå«ä¹æ¯ä»ä¹\n\n * æ åºæ§ä¸ç­äºéæºæ§ ï¼æ åºæ§æ¯æå­å¨çæ°æ®å¨åºå±æ°ç»ä¸­å¹¶éæç§æ°ç»ç´¢å¼çé¡ºåºæ·»å  ï¼èæ¯æ ¹æ®æ°æ®çåå¸å¼å³å®çã\n * ä¸å¯éå¤æ§æ¯ææ·»å çåç´ æç§ equals() å¤æ­æ¶ ï¼è¿å falseï¼éè¦åæ¶éå equals() æ¹æ³å hashCode() æ¹æ³ã\n\n\n# éåæ¡æ¶åºå±æ°æ®ç»æå¸¸è§å®ç°ç±»\n\n\n# 1. List\n\n * ArrayListï¼ Object[] æ°ç»\n * Vectorï¼Object[] æ°ç»\n * LinkedListï¼ ååé¾è¡¨(JDK1.6 ä¹åä¸ºå¾ªç¯é¾è¡¨ï¼JDK1.7 åæ¶äºå¾ªç¯)\n\n\n# 2. Set\n\n * HashSet(æ åºï¼å¯ä¸): åºäº HashMap å®ç°çï¼åºå±éç¨ HashMap æ¥ä¿å­åç´ \n\n * LinkedHashSet(æåºï¼å¯ä¸): LinkedHashSet æ¯ HashSet çå­ç±»ï¼å¹¶ä¸å¶åé¨æ¯éè¿ LinkedHashMap æ¥å®ç°çãæç¹ç±»ä¼¼äºæä»¬ä¹åè¯´ç LinkedHashMap å¶åé¨æ¯åºäº HashMap å®ç°ä¸æ ·ï¼ä¸è¿è¿æ¯æä¸ç¹ç¹åºå«ç\n\n * TreeSet(æåºï¼å¯ä¸): çº¢é»æ (èªå¹³è¡¡çæåºäºåæ )\n   \n   > çº¢é»æ ï¼Red-Black Treeï¼æ¯ä¸ç§èªå¹³è¡¡çäºåæ¥æ¾æ ãå®çç¹ç¹æ¯ï¼æ¯ä¸ªèç¹è¦ä¹æ¯çº¢è²ï¼è¦ä¹æ¯é»è²ï¼æ çæ ¹èç¹æ¯é»è²çï¼ææå¶å­èç¹é½æ¯é»è²çç©ºèç¹ï¼NILèç¹ï¼ï¼å¦æä¸ä¸ªèç¹æ¯çº¢è²çï¼åå¶å­èç¹å¿é¡»æ¯é»è²çï¼ä»æ ¹èç¹å°å¶å­èç¹çææè·¯å¾ä¸ï¼ä¸è½æä¸¤ä¸ªè¿ç»­ççº¢è²èç¹ï¼ä»ä»»æä¸ä¸ªèç¹å°å¶å­æ ä¸­æ¯ä¸ªå¶å­èç¹çè·¯å¾é½åå«ç¸åæ°ç®çé»è²èç¹ã\n\n\n# 3. Queue\n\n * PriorityQueue: Object[] æ°ç»æ¥å®ç°äºåå \n * ArrayQueue: Object[] æ°ç» + åæé\n\nåæ¥çç Map æ¥å£ä¸é¢çéåã\n\n\n# 4. Map\n\n * HashMapï¼ JDK1.8 ä¹å HashMap ç±æ°ç»+é¾è¡¨ç»æçï¼æ°ç»æ¯ HashMap çä¸»ä½ï¼é¾è¡¨åæ¯ä¸»è¦ä¸ºäºè§£å³åå¸å²çªèå­å¨çï¼âæé¾æ³âè§£å³å²çªï¼ãJDK1.8 ä»¥åå¨è§£å³åå¸å²çªæ¶æäºè¾å¤§çååï¼å½é¾è¡¨é¿åº¦å¤§äºéå¼ï¼é»è®¤ä¸º 8ï¼ï¼å°é¾è¡¨è½¬æ¢æçº¢é»æ åä¼å¤æ­ï¼å¦æå½åæ°ç»çé¿åº¦å°äº 64ï¼é£ä¹ä¼éæ©åè¿è¡æ°ç»æ©å®¹ï¼èä¸æ¯è½¬æ¢ä¸ºçº¢é»æ ï¼æ¶ï¼å°é¾è¡¨è½¬åä¸ºçº¢é»æ ï¼ä»¥åå°æç´¢æ¶é´\n\n * LinkedHashMapï¼æåºçï¼ï¼ LinkedHashMap ç»§æ¿èª HashMapï¼æä»¥å®çåºå±ä»ç¶æ¯åºäºæé¾å¼æ£åç»æå³ç±æ°ç»åé¾è¡¨æçº¢é»æ ç»æãå¦å¤ï¼LinkedHashMap å¨ä¸é¢ç»æçåºç¡ä¸ï¼å¢å äºä¸æ¡ååé¾è¡¨ï¼ä½¿å¾ä¸é¢çç»æå¯ä»¥ä¿æé®å¼å¯¹çæå¥é¡ºåºãåæ¶éè¿å¯¹é¾è¡¨è¿è¡ç¸åºçæä½ï¼å®ç°äºè®¿é®é¡ºåºç¸å³é»è¾ã\n\n * Hashtableï¼ æ°ç»+é¾è¡¨ç»æçï¼æ°ç»æ¯ Hashtable çä¸»ä½ï¼é¾è¡¨åæ¯ä¸»è¦ä¸ºäºè§£å³åå¸å²çªèå­å¨ç\n   \n   > HashTable æ¯çº¿ç¨å®å¨çï¼è HashMap ä¸æ¯ãå¨å¤çº¿ç¨ç¯å¢ä¸ï¼ä½¿ç¨ HashTable å¯ä»¥é¿åæ°æ®ç«äºåå¹¶åè®¿é®çé®é¢ï¼ä½æ¯å¯¹äºåçº¿ç¨ç¯å¢ï¼ä½¿ç¨ HashMap å¯ä»¥æé«æ§è½\n\n * TreeMapï¼ çº¢é»æ ï¼èªå¹³è¡¡çæåºäºåæ ï¼\n\n\n# åå¸å²çª\n\nåå¸å²çªæ¯æå¨åå¸è¡¨ä¸­ï¼ä¸åçå³é®å­ï¼Keyï¼éè¿åå¸å½æ°è¢«æ å°å°äºåä¸ä¸ªæ§½ä½ï¼Bucketï¼ä¸­ï¼å¯¼è´åä¸ä¸ªæ§½ä½ä¸­å­å¨äºå¤ä¸ªå³é®å­çæåµã\n\nå½ HashMap åçåå¸å²çªæ¶ï¼é¾è¡¨å­å¨çæ¯é®å¼å¯¹ï¼key-value pairsï¼ãå·ä½æ¥è¯´ï¼é¾è¡¨ä¸­çæ¯ä¸ªåç´ åå«ä¸ä¸ªé®ï¼keyï¼åä¸ä¸ªå¼ï¼valueï¼ãæä»¥ï¼é¾è¡¨ä¸ä»å­å¨åç´ æ¬èº«ï¼è¿åå«é®ã\n\n\n# ä¸ºä»ä¹é¾è¡¨å¯ä»¥è§£å³åå¸å²çªï¼æé¾æ³ï¼æ°ç»+é¾è¡¨ï¼\n\nå½ä¸ä¸ªæ¡¶ä¸­å­å¨å¤ä¸ªé®å¼å¯¹æ¶ï¼å¯ä»¥å°å®ä»¬å­å¨å¨ä¸ä¸ªé¾è¡¨ä¸­ï¼æ¯ä¸ªèç¹å­å¨ä¸ä¸ªé®å¼å¯¹ãå½éè¦æ¥æ¾æå é¤æä¸ªé®å¼å¯¹æ¶ï¼å¯ä»¥æç§åå¸å½æ°çè§åæ¾å°å¯¹åºçæ¡¶ï¼ç¶åéåé¾è¡¨ä¸­çèç¹ï¼æ¥æ¾æå é¤ç®æ é®å¼å¯¹\n\n\n# åå¸è¡¨æ¯ä»ä¹\n\nåå¸è¡¨ï¼Hash Tableï¼ï¼ä¹ç§°ä¸ºæ£åè¡¨ï¼æ¯ä¸ç§æ°æ®ç»æï¼ç¨äºå®ç°å³èæ°ç»ï¼Associative Arrayï¼ææ å°ï¼Mapï¼ç­æ½è±¡æ°æ®ç±»åãå®éè¿å°å³é®å­æ å°å°è¡¨ä¸­ä¸ä¸ªä½ç½®æ¥è®¿é®è®°å½ï¼ä»¥å å¿«æ¥æ¾çéåº¦ãåå¸è¡¨å®éä¸æ¯ä¸ä¸ªæ°ç»ï¼å¶ä¸­æ¯ä¸ªåç´ é½æ¯ä¸ä¸ªé¾è¡¨çå¤´èç¹ï¼æ¯ä¸ªé¾è¡¨ä¸­åå«äºåå¸å¼ç¸åçææåç´ ã åå¸è¡¨çåºæ¬ææ³æ¯ï¼å°å³é®å­éè¿åå¸å½æ°è®¡ç®åºä¸ä¸ªåå¸å¼ï¼ç¶åå°è¯¥å¼ä½ä¸ºæ°ç»çä¸æ ï¼å°åç´ å­å¨å¨å¯¹åºçæ°ç»ä½ç½®ä¸­ãå¨æ¥æ¾åç´ æ¶ï¼éè¿åå¸å½æ°è®¡ç®åºå³é®å­çåå¸å¼ï¼ç¶åå¨å¯¹åºçæ°ç»ä½ç½®ä¸­æ¥æ¾åç´ ã åå¸è¡¨çä¼ç¹æ¯æ¥æ¾éåº¦å¿«ï¼æ¶é´å¤æåº¦ä¸º O(1)ï¼èä¸åçº¿æ§è¡¨çæ¥æ¾æ¶é´å¤æåº¦ä¸º O(n)ãä½æ¯ï¼åå¸è¡¨çç¼ºç¹æ¯ç©ºé´å©ç¨çç¸å¯¹è¾ä½ï¼å ä¸ºéè¦é¢çè¶³å¤çç©ºé´æ¥å­å¨åå¸å²çªçåç´ ãæ­¤å¤ï¼åå¸è¡¨çæ§è½è¿åå°åå¸å½æ°çå½±åï¼å¦æåå¸å½æ°è®¾è®¡ä¸å¥½ï¼å¯è½ä¼å¯¼è´åå¸å²çªçè¿é«ï¼éä½åå¸è¡¨çæ§è½ã\n\n\n# çº¿ç¨ä¸å®å¨çæ¥å£\n\nArrayListï¼LinkedListï¼ HashSetï¼LinkedHashSetï¼TreeSetï¼PriorityQueue ï¼ArrayQueueï¼HashMapï¼LinkedHashMap ï¼TreeMap é½æ¯çº¿ç¨ä¸å®å¨ç\n\n\n# çº¿ç¨å®å¨çæ¥å£\n\nVectorï¼Hashtableï¼ConcurrentHashMap\n\n\n# ä¸ºä»ä¹è¦ä½¿ç¨éå\n\næ¯å ä¸ºæ°ç»ä¸æ¦å£°æä¹åï¼é¿åº¦å°±ä¸å¯åäºï¼åæ¶ï¼å£°ææ°ç»æ¶çæ°æ®ç±»åä¹å³å®äºè¯¥æ°ç»å­å¨çæ°æ®çç±»åï¼èä¸ï¼æ°ç»å­å¨çæ°æ®æ¯æåºçãå¯éå¤çï¼ç¹ç¹åä¸ã èéåæé«äºæ°æ®å­å¨ççµæ´»æ§ï¼Java éåä¸ä»å¯ä»¥ç¨æ¥å­å¨ä¸åç±»åä¸åæ°éçå¯¹è±¡ï¼è¿å¯ä»¥ä¿å­å·ææ å°å³ç³»çæ°æ®ã\n\n\n# å­¦ä¹ åè\n\n * Javaåºç¡å¸¸è§é¢è¯é¢æ»ç»(ä¸) | JavaGuide(Javaé¢è¯ + å­¦ä¹ æå)\n * Javaé¢è¯é¢ä¹Javaéåæ¡æ¶ç¯ï¼Javaå®¹å¨ç¯ï¼ï¼30éJavaéåæ¡æ¶å«è¡æï¼7åå­38å¼ æç»å¾ï¼ï¼é¢æ¸£éè¢­å¿çð | äºå¥çJavaè¿é¶ä¹è·¯ (javabetter.cn)',normalizedContent:'# java éåæ¦è¿°\n\n\n# éåä¸å®¹å¨\n\n 1. å®¹å¨ï¼containerï¼æ¯ä¸ä¸ªæ´å¹¿æ³çæ¯è¯­ï¼ç¨äºè¡¨ç¤ºå¯ä»¥å®¹çº³ãç»ç»åç®¡çå¶ä»å¯¹è±¡çå¯¹è±¡ãå®æ¯ä¸ä¸ªæ´é«å±æ¬¡çæ¦å¿µï¼åæ¬éåï¼collectionï¼å¨åã\n 2. éåï¼collectionï¼æ¯ä¸ç§ç¹å®ç±»åçå®¹å¨ï¼ç¨äºå­å¨åæä½ä¸ç»å¯¹è±¡ãéåæä¾äºå¯¹åç´ çæ·»å ãå é¤ãæ¥æ¾åéåç­æä½ãlistãsetãqueue å map é½æ¯éåçå·ä½å®ç°ã\n\næ»ç»\n\n * å®¹å¨æ¯ä¸ä¸ªå¹¿æ³çæ¦å¿µï¼ç¨äºè¡¨ç¤ºå¯ä»¥å®¹çº³åç®¡çå¶ä»å¯¹è±¡çå¯¹è±¡ã\n * éåæ¯å®¹å¨çä¸ç§ç¹å®ç±»åï¼ç¨äºå­å¨åæä½ä¸ç»å¯¹è±¡ã\n\n\n# java éåæ¡æ¶å¦ä¸å¾æç¤º\n\n\n\n\n# è¯´è¯´ list, set, queue, map åèçåºå«ï¼\n\n * list(å¯¹ä»é¡ºåºçå¥½å¸®æ): å­å¨çåç´ æ¯æåºçãå¯éå¤çãï¼å¯ä»¥éè¿ç´¢å¼è®¿é®åä¿®æ¹åç´ ï¼\n * set(æ³¨éç¬ä¸æ äºçæ§è´¨): å­å¨çåç´ æ¯æ åºçãä¸å¯éå¤çãï¼æ ç´¢å¼ï¼\n * queue(å®ç°æéåè½çå«å·æº): æç¹å®çæéè§åæ¥ç¡®å®ååé¡ºåºï¼å­å¨çåç´ æ¯æåºçãå¯éå¤çã\n * map(ç¨ key æ¥æç´¢çä¸å®¶): ä½¿ç¨é®å¼å¯¹ï¼key-valueï¼å­å¨ï¼ç±»ä¼¼äºæ°å­¦ä¸çå½æ° y=f(x)ï¼"x" ä»£è¡¨ keyï¼"y" ä»£è¡¨ valueï¼key æ¯æ åºçãä¸å¯éå¤çï¼value æ¯æ åºçãå¯éå¤çï¼æ¯ä¸ªé®æå¤æ å°å°ä¸ä¸ªå¼ã\n\n\n# æ åºæ§åä¸å¯éå¤æ§çå«ä¹æ¯ä»ä¹\n\n * æ åºæ§ä¸ç­äºéæºæ§ ï¼æ åºæ§æ¯æå­å¨çæ°æ®å¨åºå±æ°ç»ä¸­å¹¶éæç§æ°ç»ç´¢å¼çé¡ºåºæ·»å  ï¼èæ¯æ ¹æ®æ°æ®çåå¸å¼å³å®çã\n * ä¸å¯éå¤æ§æ¯ææ·»å çåç´ æç§ equals() å¤æ­æ¶ ï¼è¿å falseï¼éè¦åæ¶éå equals() æ¹æ³å hashcode() æ¹æ³ã\n\n\n# éåæ¡æ¶åºå±æ°æ®ç»æå¸¸è§å®ç°ç±»\n\n\n# 1. list\n\n * arraylistï¼ object[] æ°ç»\n * vectorï¼object[] æ°ç»\n * linkedlistï¼ ååé¾è¡¨(jdk1.6 ä¹åä¸ºå¾ªç¯é¾è¡¨ï¼jdk1.7 åæ¶äºå¾ªç¯)\n\n\n# 2. set\n\n * hashset(æ åºï¼å¯ä¸): åºäº hashmap å®ç°çï¼åºå±éç¨ hashmap æ¥ä¿å­åç´ \n\n * linkedhashset(æåºï¼å¯ä¸): linkedhashset æ¯ hashset çå­ç±»ï¼å¹¶ä¸å¶åé¨æ¯éè¿ linkedhashmap æ¥å®ç°çãæç¹ç±»ä¼¼äºæä»¬ä¹åè¯´ç linkedhashmap å¶åé¨æ¯åºäº hashmap å®ç°ä¸æ ·ï¼ä¸è¿è¿æ¯æä¸ç¹ç¹åºå«ç\n\n * treeset(æåºï¼å¯ä¸): çº¢é»æ (èªå¹³è¡¡çæåºäºåæ )\n   \n   > çº¢é»æ ï¼red-black treeï¼æ¯ä¸ç§èªå¹³è¡¡çäºåæ¥æ¾æ ãå®çç¹ç¹æ¯ï¼æ¯ä¸ªèç¹è¦ä¹æ¯çº¢è²ï¼è¦ä¹æ¯é»è²ï¼æ çæ ¹èç¹æ¯é»è²çï¼ææå¶å­èç¹é½æ¯é»è²çç©ºèç¹ï¼nilèç¹ï¼ï¼å¦æä¸ä¸ªèç¹æ¯çº¢è²çï¼åå¶å­èç¹å¿é¡»æ¯é»è²çï¼ä»æ ¹èç¹å°å¶å­èç¹çææè·¯å¾ä¸ï¼ä¸è½æä¸¤ä¸ªè¿ç»­ççº¢è²èç¹ï¼ä»ä»»æä¸ä¸ªèç¹å°å¶å­æ ä¸­æ¯ä¸ªå¶å­èç¹çè·¯å¾é½åå«ç¸åæ°ç®çé»è²èç¹ã\n\n\n# 3. queue\n\n * priorityqueue: object[] æ°ç»æ¥å®ç°äºåå \n * arrayqueue: object[] æ°ç» + åæé\n\nåæ¥çç map æ¥å£ä¸é¢çéåã\n\n\n# 4. map\n\n * hashmapï¼ jdk1.8 ä¹å hashmap ç±æ°ç»+é¾è¡¨ç»æçï¼æ°ç»æ¯ hashmap çä¸»ä½ï¼é¾è¡¨åæ¯ä¸»è¦ä¸ºäºè§£å³åå¸å²çªèå­å¨çï¼âæé¾æ³âè§£å³å²çªï¼ãjdk1.8 ä»¥åå¨è§£å³åå¸å²çªæ¶æäºè¾å¤§çååï¼å½é¾è¡¨é¿åº¦å¤§äºéå¼ï¼é»è®¤ä¸º 8ï¼ï¼å°é¾è¡¨è½¬æ¢æçº¢é»æ åä¼å¤æ­ï¼å¦æå½åæ°ç»çé¿åº¦å°äº 64ï¼é£ä¹ä¼éæ©åè¿è¡æ°ç»æ©å®¹ï¼èä¸æ¯è½¬æ¢ä¸ºçº¢é»æ ï¼æ¶ï¼å°é¾è¡¨è½¬åä¸ºçº¢é»æ ï¼ä»¥åå°æç´¢æ¶é´\n\n * linkedhashmapï¼æåºçï¼ï¼ linkedhashmap ç»§æ¿èª hashmapï¼æä»¥å®çåºå±ä»ç¶æ¯åºäºæé¾å¼æ£åç»æå³ç±æ°ç»åé¾è¡¨æçº¢é»æ ç»æãå¦å¤ï¼linkedhashmap å¨ä¸é¢ç»æçåºç¡ä¸ï¼å¢å äºä¸æ¡ååé¾è¡¨ï¼ä½¿å¾ä¸é¢çç»æå¯ä»¥ä¿æé®å¼å¯¹çæå¥é¡ºåºãåæ¶éè¿å¯¹é¾è¡¨è¿è¡ç¸åºçæä½ï¼å®ç°äºè®¿é®é¡ºåºç¸å³é»è¾ã\n\n * hashtableï¼ æ°ç»+é¾è¡¨ç»æçï¼æ°ç»æ¯ hashtable çä¸»ä½ï¼é¾è¡¨åæ¯ä¸»è¦ä¸ºäºè§£å³åå¸å²çªèå­å¨ç\n   \n   > hashtable æ¯çº¿ç¨å®å¨çï¼è hashmap ä¸æ¯ãå¨å¤çº¿ç¨ç¯å¢ä¸ï¼ä½¿ç¨ hashtable å¯ä»¥é¿åæ°æ®ç«äºåå¹¶åè®¿é®çé®é¢ï¼ä½æ¯å¯¹äºåçº¿ç¨ç¯å¢ï¼ä½¿ç¨ hashmap å¯ä»¥æé«æ§è½\n\n * treemapï¼ çº¢é»æ ï¼èªå¹³è¡¡çæåºäºåæ ï¼\n\n\n# åå¸å²çª\n\nåå¸å²çªæ¯æå¨åå¸è¡¨ä¸­ï¼ä¸åçå³é®å­ï¼keyï¼éè¿åå¸å½æ°è¢«æ å°å°äºåä¸ä¸ªæ§½ä½ï¼bucketï¼ä¸­ï¼å¯¼è´åä¸ä¸ªæ§½ä½ä¸­å­å¨äºå¤ä¸ªå³é®å­çæåµã\n\nå½ hashmap åçåå¸å²çªæ¶ï¼é¾è¡¨å­å¨çæ¯é®å¼å¯¹ï¼key-value pairsï¼ãå·ä½æ¥è¯´ï¼é¾è¡¨ä¸­çæ¯ä¸ªåç´ åå«ä¸ä¸ªé®ï¼keyï¼åä¸ä¸ªå¼ï¼valueï¼ãæä»¥ï¼é¾è¡¨ä¸ä»å­å¨åç´ æ¬èº«ï¼è¿åå«é®ã\n\n\n# ä¸ºä»ä¹é¾è¡¨å¯ä»¥è§£å³åå¸å²çªï¼æé¾æ³ï¼æ°ç»+é¾è¡¨ï¼\n\nå½ä¸ä¸ªæ¡¶ä¸­å­å¨å¤ä¸ªé®å¼å¯¹æ¶ï¼å¯ä»¥å°å®ä»¬å­å¨å¨ä¸ä¸ªé¾è¡¨ä¸­ï¼æ¯ä¸ªèç¹å­å¨ä¸ä¸ªé®å¼å¯¹ãå½éè¦æ¥æ¾æå é¤æä¸ªé®å¼å¯¹æ¶ï¼å¯ä»¥æç§åå¸å½æ°çè§åæ¾å°å¯¹åºçæ¡¶ï¼ç¶åéåé¾è¡¨ä¸­çèç¹ï¼æ¥æ¾æå é¤ç®æ é®å¼å¯¹\n\n\n# åå¸è¡¨æ¯ä»ä¹\n\nåå¸è¡¨ï¼hash tableï¼ï¼ä¹ç§°ä¸ºæ£åè¡¨ï¼æ¯ä¸ç§æ°æ®ç»æï¼ç¨äºå®ç°å³èæ°ç»ï¼associative arrayï¼ææ å°ï¼mapï¼ç­æ½è±¡æ°æ®ç±»åãå®éè¿å°å³é®å­æ å°å°è¡¨ä¸­ä¸ä¸ªä½ç½®æ¥è®¿é®è®°å½ï¼ä»¥å å¿«æ¥æ¾çéåº¦ãåå¸è¡¨å®éä¸æ¯ä¸ä¸ªæ°ç»ï¼å¶ä¸­æ¯ä¸ªåç´ é½æ¯ä¸ä¸ªé¾è¡¨çå¤´èç¹ï¼æ¯ä¸ªé¾è¡¨ä¸­åå«äºåå¸å¼ç¸åçææåç´ ã åå¸è¡¨çåºæ¬ææ³æ¯ï¼å°å³é®å­éè¿åå¸å½æ°è®¡ç®åºä¸ä¸ªåå¸å¼ï¼ç¶åå°è¯¥å¼ä½ä¸ºæ°ç»çä¸æ ï¼å°åç´ å­å¨å¨å¯¹åºçæ°ç»ä½ç½®ä¸­ãå¨æ¥æ¾åç´ æ¶ï¼éè¿åå¸å½æ°è®¡ç®åºå³é®å­çåå¸å¼ï¼ç¶åå¨å¯¹åºçæ°ç»ä½ç½®ä¸­æ¥æ¾åç´ ã åå¸è¡¨çä¼ç¹æ¯æ¥æ¾éåº¦å¿«ï¼æ¶é´å¤æåº¦ä¸º o(1)ï¼èä¸åçº¿æ§è¡¨çæ¥æ¾æ¶é´å¤æåº¦ä¸º o(n)ãä½æ¯ï¼åå¸è¡¨çç¼ºç¹æ¯ç©ºé´å©ç¨çç¸å¯¹è¾ä½ï¼å ä¸ºéè¦é¢çè¶³å¤çç©ºé´æ¥å­å¨åå¸å²çªçåç´ ãæ­¤å¤ï¼åå¸è¡¨çæ§è½è¿åå°åå¸å½æ°çå½±åï¼å¦æåå¸å½æ°è®¾è®¡ä¸å¥½ï¼å¯è½ä¼å¯¼è´åå¸å²çªçè¿é«ï¼éä½åå¸è¡¨çæ§è½ã\n\n\n# çº¿ç¨ä¸å®å¨çæ¥å£\n\narraylistï¼linkedlistï¼ hashsetï¼linkedhashsetï¼treesetï¼priorityqueue ï¼arrayqueueï¼hashmapï¼linkedhashmap ï¼treemap é½æ¯çº¿ç¨ä¸å®å¨ç\n\n\n# çº¿ç¨å®å¨çæ¥å£\n\nvectorï¼hashtableï¼concurrenthashmap\n\n\n# ä¸ºä»ä¹è¦ä½¿ç¨éå\n\næ¯å ä¸ºæ°ç»ä¸æ¦å£°æä¹åï¼é¿åº¦å°±ä¸å¯åäºï¼åæ¶ï¼å£°ææ°ç»æ¶çæ°æ®ç±»åä¹å³å®äºè¯¥æ°ç»å­å¨çæ°æ®çç±»åï¼èä¸ï¼æ°ç»å­å¨çæ°æ®æ¯æåºçãå¯éå¤çï¼ç¹ç¹åä¸ã èéåæé«äºæ°æ®å­å¨ççµæ´»æ§ï¼java éåä¸ä»å¯ä»¥ç¨æ¥å­å¨ä¸åç±»åä¸åæ°éçå¯¹è±¡ï¼è¿å¯ä»¥ä¿å­å·ææ å°å³ç³»çæ°æ®ã\n\n\n# å­¦ä¹ åè\n\n * javaåºç¡å¸¸è§é¢è¯é¢æ»ç»(ä¸) | javaguide(javaé¢è¯ + å­¦ä¹ æå)\n * javaé¢è¯é¢ä¹javaéåæ¡æ¶ç¯ï¼javaå®¹å¨ç¯ï¼ï¼30éjavaéåæ¡æ¶å«è¡æï¼7åå­38å¼ æç»å¾ï¼ï¼é¢æ¸£éè¢­å¿çð | äºå¥çjavaè¿é¶ä¹è·¯ (javabetter.cn)',charsets:{cjk:!0}},{title:"Listæ¥å£",frontmatter:{title:"Listæ¥å£",date:"2023-06-19T12:42:58.000Z",permalink:"/pages/dcfa33/",author:{name:"éä¸æ¸é£",link:"https://github.com/msqfx"},categories:["java","éåç¯"],tags:[null],description:"æ»ç»",comment:!0,meta:[{name:"twitter:title",content:"Listæ¥å£"},{name:"twitter:description",content:"æ»ç»"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/01.java/02.%E9%9B%86%E5%90%88%E7%AF%87/02.List%E6%8E%A5%E5%8F%A3.html"},{property:"og:type",content:"article"},{property:"og:title",content:"Listæ¥å£"},{property:"og:description",content:"æ»ç»"},{property:"og:url",content:"https://www.msqfx.cc/01.java/02.%E9%9B%86%E5%90%88%E7%AF%87/02.List%E6%8E%A5%E5%8F%A3.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-06-19T12:42:58.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"Listæ¥å£"},{itemprop:"description",content:"æ»ç»"}],readingShow:"top"},regularPath:"/01.java/02.%E9%9B%86%E5%90%88%E7%AF%87/02.List%E6%8E%A5%E5%8F%A3.html",relativePath:"01.java/02.éåç¯/02.Listæ¥å£.md",key:"v-0b03f7cc",path:"/pages/dcfa33/",headers:[{level:2,title:"ArrayList å Vector çåºå«",slug:"arraylist-å-vector-çåºå«",normalizedTitle:"arraylist å vector çåºå«",charIndex:16},{level:2,title:"ArrayList ä¸ LinkedList åºå«",slug:"arraylist-ä¸-linkedlist-åºå«",normalizedTitle:"arraylist ä¸ linkedlist åºå«",charIndex:666},{level:3,title:"å·ä½å®ç°åè",slug:"å·ä½å®ç°åè",normalizedTitle:"å·ä½å®ç°åè",charIndex:1492},{level:3,title:"ä»ä¹æ¯è¿­ä»£å¨",slug:"ä»ä¹æ¯è¿­ä»£å¨",normalizedTitle:"ä»ä¹æ¯è¿­ä»£å¨",charIndex:1567}],headersStr:"ArrayList å Vector çåºå« ArrayList ä¸ LinkedList åºå« å·ä½å®ç°åè ä»ä¹æ¯è¿­ä»£å¨",content:'# List éåè¯¦è§£\n\n\n# ArrayList å Vector çåºå«\n\n 1. çº¿ç¨å®å¨æ§ï¼\n    * Vector æ¯çº¿ç¨å®å¨çï¼å®çæ¹æ³é½æ¯åæ­¥çï¼å¤ä¸ªçº¿ç¨å¯ä»¥åæ¶è®¿é®åä¿®æ¹ Vector å¯¹è±¡ï¼\n    * è ArrayList æ¯éçº¿ç¨å®å¨çï¼å®çæ¹æ³ä¸æ¯åæ­¥çï¼å¤ä¸ªçº¿ç¨è®¿é®åä¿®æ¹åä¸ä¸ª ArrayList å¯¹è±¡å¯è½ä¼å¯¼è´æ°æ®ç«äºåå¹¶åè®¿é®çé®é¢ã\n 2. æ©å®¹æ¹å¼ï¼Vector å ArrayList å¨æ©å®¹æ¶éç¨ä¸åçç­ç¥ãVector å¨æ©å®¹æ¶ä¼å¢å ä¸åçå®¹éï¼è ArrayList åä¼å¢å  50% çå®¹éã\n 3. æ§è½ï¼\n    * ç±äº Vector æ¯çº¿ç¨å®å¨çï¼å®å¨å¹¶åè®¿é®æ¶éè¦è¿è¡åæ­¥æä½ï¼å æ­¤æ§è½ç¸å¯¹è¾ä½ï¼\n    * è ArrayList å¨åçº¿ç¨ç¯å¢ä¸çæ§è½è¾å¥½ï¼ä½å¨å¤çº¿ç¨ç¯å¢ä¸éè¦ä½¿ç¨åæ­¥æºå¶æ¥ä¿è¯çº¿ç¨å®å¨ã\n 4. åå§å®¹éï¼å½åå»º Vector æ ArrayList å¯¹è±¡æ¶ï¼å¯ä»¥æå®å®ä»¬çåå§å®¹éãVector çé»è®¤åå§å®¹éä¸º 10ï¼è ArrayList çé»è®¤åå§å®¹éä¸º 0ãå¨å®éä½¿ç¨ä¸­ï¼å¯ä»¥æ ¹æ®æ°æ®éåæ§è½éæ±ç­å ç´ ï¼éæ©åéçåå§å®¹éã\n\næ»ç»\n\n * Vector å ArrayList é½æ¯å¨ææ°ç»çå®ç°ï¼\n * ä½ Vector æ¯çº¿ç¨å®å¨çï¼æ©å®¹æ¹å¼åæ§è½ç¸å¯¹è¾å·®ï¼åå§å®¹éä¸º 10ï¼\n * è ArrayList æ¯éçº¿ç¨å®å¨çï¼æ©å®¹æ¹å¼åæ§è½ç¸å¯¹è¾å¥½ï¼åå§å®¹éä¸º 0ã\n * å¨å®éä½¿ç¨ä¸­ï¼åºæ ¹æ®å·ä½éæ±éæ©åéçå¨ææ°ç»å®ç°ã\n\n\n# ArrayList ä¸ LinkedList åºå«\n\n 1. åºå±æ°æ®ç»æï¼\n    \n    * ArrayList åºå±éç¨æ°ç»å®ç°ï¼\n    * è LinkedList åºå±éç¨é¾è¡¨å®ç°ã\n\n 2. éæºè®¿é®(ç¸å½äºæ¥è¯¢ï¼åæå¥/å é¤æä½çæ§è½ï¼\n    \n    * ç±äº ArrayList çåºå±å®ç°æ¯æ°ç»ï¼å æ­¤éæºè®¿é®çæ§è½è¾å¥½ï¼æ¶é´å¤æåº¦ä¸º O(1)ï¼èæå¥/å é¤æä½éè¦ç§»å¨å¶ä»åç´ ï¼æ¶é´å¤æåº¦ä¸º O(n)ã\n    \n    * ç¸åï¼LinkedList çåºå±å®ç°æ¯é¾è¡¨ï¼å æ­¤æå¥/å é¤æä½çæ§è½è¾å¥½ï¼å¹³åæ¶é´å¤æåº¦ä¸º O(1)ï¼èéæºè®¿é®éè¦éåé¾è¡¨ï¼æ¶é´å¤æåº¦ä¸º O(n)ã\n      \n      > é¾è¡¨è¿è¡ãæå¥/å é¤æä½ãæ¶ï¼å¨æåçæåµä¸ï¼ç®æ ä½ç½®å¨é¾è¡¨çä¸­é´ï¼éè¦éåé¾è¡¨æ¥æ¾å°ç®æ ä½ç½®ï¼å¯¼è´æ¶é´å¤æåº¦ä¸º O(n)ã\n\n 3. åå­å ç¨ï¼\n    \n    * ç±äº ArrayList åºå±éç¨æ°ç»å®ç°ï¼å æ­¤éè¦é¢ååéä¸å®å¤§å°çè¿ç»­åå­ç©ºé´ï¼å æ­¤å¯è½ä¼æµªè´¹ä¸äºåå­ç©ºé´ï¼\n    * è LinkedList çåºå±éç¨é¾è¡¨å®ç°ï¼å æ­¤æ¯ä¸ªèç¹å¯ä»¥åå¸å¨ä¸åçåå­ç©ºé´ï¼åå­å©ç¨çç¸å¯¹è¾é«ã\n\n 4. è¿­ä»£å¨çæ§è½ï¼\n    \n    * ç±äº ArrayList çåºå±å®ç°æ¯æ°ç»ï¼å æ­¤è¿­ä»£å¨çæ§è½ç¸å¯¹è¾å¥½ï¼\n    * è LinkedList çåºå±å®ç°æ¯é¾è¡¨ï¼å æ­¤è¿­ä»£å¨éè¦éåé¾è¡¨ï¼æ§è½è¾å·®ã\n\næ»ç»\n\nArrayList å LinkedList é½æ¯çº¿æ§è¡¨æ°æ®ç»æå®ç°ï¼ä½åºå±æ°æ®ç»æãéæºè®¿é®åæå¥/å é¤æä½çæ§è½ãåå­å ç¨åè¿­ä»£å¨çæ§è½ç­æ¹é¢ææä¸åãå¨å®éä½¿ç¨ä¸­ï¼åºæ ¹æ®å·ä½éæ±éæ©åéççº¿æ§è¡¨æ°æ®ç»æå®ç°ã\n\n> æä»¬å¨é¡¹ç®ä¸­ä¸è¬æ¯ä¸ä¼ä½¿ç¨å° LinkedList çï¼éè¦ç¨å° LinkedList çåºæ¯å ä¹é½å¯ä»¥ä½¿ç¨ ArrayList æ¥ä»£æ¿ï¼å¹¶ä¸ï¼æ§è½éå¸¸ä¼æ´å¥½ï¼\n\n\n# å·ä½å®ç°åè\n\nè¿ä¸¤ç§æ°æ®ç»æçä»£ç å®ç°å¯éè¯»ä»¥ä¸ä¸¤ç¯æç« ï¼\n\n * ãæä¸æ°æ®ç»æãå¨ææ°ç»å­¦ä¹ ç¬è®°\n\n * ãæä¸æ°æ®ç»æãé¾è¡¨å­¦ä¹ ç¬è®°\n\n\n# ä»ä¹æ¯è¿­ä»£å¨\n\nè¿­ä»£å¨æ¯ä¸ç§ Java ä¸­çæ¥å£ï¼ç¨äºéåéåç±»ï¼Collectionï¼åæ å°ç±»ï¼Mapï¼ä¸­çåç´ ã\n\nä½¿ç¨è¿­ä»£å¨å¯ä»¥ä¾æ¬¡è®¿é®éåä¸­çæ¯ä¸ªåç´ ï¼èä¸éè¦ç¥ééåçåé¨å®ç°æ¹å¼ã\n\nå¨è¿­ä»£å¨è®¾è®¡æ¨¡å¼ä¸­ï¼è¿­ä»£å¨æä¾äºä¸ä¸ªéç¨çè®¿é®æ¹æ³ï¼ä½¿å¾å¯ä»¥å¨ä¸æ´é²éååé¨å®ç°çæåµä¸å¯¹éåè¿è¡è¿­ä»£éåã\n\nè¿­ä»£å¨éå¸¸åå«ä»¥ä¸æ¹æ³ï¼\n\n * hasNext()ï¼å¤æ­éåä¸­æ¯å¦è¿æä¸ä¸ä¸ªåç´ ï¼å¦ææè¿å trueï¼å¦åè¿å falseã\n * next()ï¼è·åéåä¸­çä¸ä¸ä¸ªåç´ ã\n * remove()ï¼ä»éåä¸­å é¤ä¸ä¸æ¬¡è¿åçåç´ ã\n\néè¦æ³¨æçæ¯ï¼å¨å¤çº¿ç¨ç¯å¢ä¸ï¼ä½¿ç¨è¿­ä»£å¨éåéåæ¶éè¦è¿è¡åæ­¥æä½ï¼ä»¥é¿åå¹¶åä¿®æ¹éåå¯¼è´çæ°æ®ç«äºåä¸ä¸è´æ§é®é¢ã\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.Iterator;\nimport java.util.List;\npublic class ArrayListExample {\n    public static void main(String[] args) {\n        // åå»ºä¸ä¸ª ArrayList å¯¹è±¡\n        List<String> arrayList = new ArrayList<>();\n        // å ArrayList ä¸­æ·»å åç´ \n        arrayList.add("apple");\n        arrayList.add("banana");\n        arrayList.add("orange");\n        // åå»ºä¸ä¸ªåæ­¥ç ArrayList å¯¹è±¡\n        List<String> synchronizedArrayList = Collections.synchronizedList(arrayList);\n        // ä½¿ç¨è¿­ä»£å¨éå ArrayList\n        synchronized (synchronizedArrayList) {\n            Iterator<String> iterator = synchronizedArrayList.iterator();\n            while (iterator.hasNext()) {\n                String element = iterator.next();\n                System.out.println(element);\n            }\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n',normalizedContent:'# list éåè¯¦è§£\n\n\n# arraylist å vector çåºå«\n\n 1. çº¿ç¨å®å¨æ§ï¼\n    * vector æ¯çº¿ç¨å®å¨çï¼å®çæ¹æ³é½æ¯åæ­¥çï¼å¤ä¸ªçº¿ç¨å¯ä»¥åæ¶è®¿é®åä¿®æ¹ vector å¯¹è±¡ï¼\n    * è arraylist æ¯éçº¿ç¨å®å¨çï¼å®çæ¹æ³ä¸æ¯åæ­¥çï¼å¤ä¸ªçº¿ç¨è®¿é®åä¿®æ¹åä¸ä¸ª arraylist å¯¹è±¡å¯è½ä¼å¯¼è´æ°æ®ç«äºåå¹¶åè®¿é®çé®é¢ã\n 2. æ©å®¹æ¹å¼ï¼vector å arraylist å¨æ©å®¹æ¶éç¨ä¸åçç­ç¥ãvector å¨æ©å®¹æ¶ä¼å¢å ä¸åçå®¹éï¼è arraylist åä¼å¢å  50% çå®¹éã\n 3. æ§è½ï¼\n    * ç±äº vector æ¯çº¿ç¨å®å¨çï¼å®å¨å¹¶åè®¿é®æ¶éè¦è¿è¡åæ­¥æä½ï¼å æ­¤æ§è½ç¸å¯¹è¾ä½ï¼\n    * è arraylist å¨åçº¿ç¨ç¯å¢ä¸çæ§è½è¾å¥½ï¼ä½å¨å¤çº¿ç¨ç¯å¢ä¸éè¦ä½¿ç¨åæ­¥æºå¶æ¥ä¿è¯çº¿ç¨å®å¨ã\n 4. åå§å®¹éï¼å½åå»º vector æ arraylist å¯¹è±¡æ¶ï¼å¯ä»¥æå®å®ä»¬çåå§å®¹éãvector çé»è®¤åå§å®¹éä¸º 10ï¼è arraylist çé»è®¤åå§å®¹éä¸º 0ãå¨å®éä½¿ç¨ä¸­ï¼å¯ä»¥æ ¹æ®æ°æ®éåæ§è½éæ±ç­å ç´ ï¼éæ©åéçåå§å®¹éã\n\næ»ç»\n\n * vector å arraylist é½æ¯å¨ææ°ç»çå®ç°ï¼\n * ä½ vector æ¯çº¿ç¨å®å¨çï¼æ©å®¹æ¹å¼åæ§è½ç¸å¯¹è¾å·®ï¼åå§å®¹éä¸º 10ï¼\n * è arraylist æ¯éçº¿ç¨å®å¨çï¼æ©å®¹æ¹å¼åæ§è½ç¸å¯¹è¾å¥½ï¼åå§å®¹éä¸º 0ã\n * å¨å®éä½¿ç¨ä¸­ï¼åºæ ¹æ®å·ä½éæ±éæ©åéçå¨ææ°ç»å®ç°ã\n\n\n# arraylist ä¸ linkedlist åºå«\n\n 1. åºå±æ°æ®ç»æï¼\n    \n    * arraylist åºå±éç¨æ°ç»å®ç°ï¼\n    * è linkedlist åºå±éç¨é¾è¡¨å®ç°ã\n\n 2. éæºè®¿é®(ç¸å½äºæ¥è¯¢ï¼åæå¥/å é¤æä½çæ§è½ï¼\n    \n    * ç±äº arraylist çåºå±å®ç°æ¯æ°ç»ï¼å æ­¤éæºè®¿é®çæ§è½è¾å¥½ï¼æ¶é´å¤æåº¦ä¸º o(1)ï¼èæå¥/å é¤æä½éè¦ç§»å¨å¶ä»åç´ ï¼æ¶é´å¤æåº¦ä¸º o(n)ã\n    \n    * ç¸åï¼linkedlist çåºå±å®ç°æ¯é¾è¡¨ï¼å æ­¤æå¥/å é¤æä½çæ§è½è¾å¥½ï¼å¹³åæ¶é´å¤æåº¦ä¸º o(1)ï¼èéæºè®¿é®éè¦éåé¾è¡¨ï¼æ¶é´å¤æåº¦ä¸º o(n)ã\n      \n      > é¾è¡¨è¿è¡ãæå¥/å é¤æä½ãæ¶ï¼å¨æåçæåµä¸ï¼ç®æ ä½ç½®å¨é¾è¡¨çä¸­é´ï¼éè¦éåé¾è¡¨æ¥æ¾å°ç®æ ä½ç½®ï¼å¯¼è´æ¶é´å¤æåº¦ä¸º o(n)ã\n\n 3. åå­å ç¨ï¼\n    \n    * ç±äº arraylist åºå±éç¨æ°ç»å®ç°ï¼å æ­¤éè¦é¢ååéä¸å®å¤§å°çè¿ç»­åå­ç©ºé´ï¼å æ­¤å¯è½ä¼æµªè´¹ä¸äºåå­ç©ºé´ï¼\n    * è linkedlist çåºå±éç¨é¾è¡¨å®ç°ï¼å æ­¤æ¯ä¸ªèç¹å¯ä»¥åå¸å¨ä¸åçåå­ç©ºé´ï¼åå­å©ç¨çç¸å¯¹è¾é«ã\n\n 4. è¿­ä»£å¨çæ§è½ï¼\n    \n    * ç±äº arraylist çåºå±å®ç°æ¯æ°ç»ï¼å æ­¤è¿­ä»£å¨çæ§è½ç¸å¯¹è¾å¥½ï¼\n    * è linkedlist çåºå±å®ç°æ¯é¾è¡¨ï¼å æ­¤è¿­ä»£å¨éè¦éåé¾è¡¨ï¼æ§è½è¾å·®ã\n\næ»ç»\n\narraylist å linkedlist é½æ¯çº¿æ§è¡¨æ°æ®ç»æå®ç°ï¼ä½åºå±æ°æ®ç»æãéæºè®¿é®åæå¥/å é¤æä½çæ§è½ãåå­å ç¨åè¿­ä»£å¨çæ§è½ç­æ¹é¢ææä¸åãå¨å®éä½¿ç¨ä¸­ï¼åºæ ¹æ®å·ä½éæ±éæ©åéççº¿æ§è¡¨æ°æ®ç»æå®ç°ã\n\n> æä»¬å¨é¡¹ç®ä¸­ä¸è¬æ¯ä¸ä¼ä½¿ç¨å° linkedlist çï¼éè¦ç¨å° linkedlist çåºæ¯å ä¹é½å¯ä»¥ä½¿ç¨ arraylist æ¥ä»£æ¿ï¼å¹¶ä¸ï¼æ§è½éå¸¸ä¼æ´å¥½ï¼\n\n\n# å·ä½å®ç°åè\n\nè¿ä¸¤ç§æ°æ®ç»æçä»£ç å®ç°å¯éè¯»ä»¥ä¸ä¸¤ç¯æç« ï¼\n\n * ãæä¸æ°æ®ç»æãå¨ææ°ç»å­¦ä¹ ç¬è®°\n\n * ãæä¸æ°æ®ç»æãé¾è¡¨å­¦ä¹ ç¬è®°\n\n\n# ä»ä¹æ¯è¿­ä»£å¨\n\nè¿­ä»£å¨æ¯ä¸ç§ java ä¸­çæ¥å£ï¼ç¨äºéåéåç±»ï¼collectionï¼åæ å°ç±»ï¼mapï¼ä¸­çåç´ ã\n\nä½¿ç¨è¿­ä»£å¨å¯ä»¥ä¾æ¬¡è®¿é®éåä¸­çæ¯ä¸ªåç´ ï¼èä¸éè¦ç¥ééåçåé¨å®ç°æ¹å¼ã\n\nå¨è¿­ä»£å¨è®¾è®¡æ¨¡å¼ä¸­ï¼è¿­ä»£å¨æä¾äºä¸ä¸ªéç¨çè®¿é®æ¹æ³ï¼ä½¿å¾å¯ä»¥å¨ä¸æ´é²éååé¨å®ç°çæåµä¸å¯¹éåè¿è¡è¿­ä»£éåã\n\nè¿­ä»£å¨éå¸¸åå«ä»¥ä¸æ¹æ³ï¼\n\n * hasnext()ï¼å¤æ­éåä¸­æ¯å¦è¿æä¸ä¸ä¸ªåç´ ï¼å¦ææè¿å trueï¼å¦åè¿å falseã\n * next()ï¼è·åéåä¸­çä¸ä¸ä¸ªåç´ ã\n * remove()ï¼ä»éåä¸­å é¤ä¸ä¸æ¬¡è¿åçåç´ ã\n\néè¦æ³¨æçæ¯ï¼å¨å¤çº¿ç¨ç¯å¢ä¸ï¼ä½¿ç¨è¿­ä»£å¨éåéåæ¶éè¦è¿è¡åæ­¥æä½ï¼ä»¥é¿åå¹¶åä¿®æ¹éåå¯¼è´çæ°æ®ç«äºåä¸ä¸è´æ§é®é¢ã\n\nimport java.util.arraylist;\nimport java.util.collections;\nimport java.util.iterator;\nimport java.util.list;\npublic class arraylistexample {\n    public static void main(string[] args) {\n        // åå»ºä¸ä¸ª arraylist å¯¹è±¡\n        list<string> arraylist = new arraylist<>();\n        // å arraylist ä¸­æ·»å åç´ \n        arraylist.add("apple");\n        arraylist.add("banana");\n        arraylist.add("orange");\n        // åå»ºä¸ä¸ªåæ­¥ç arraylist å¯¹è±¡\n        list<string> synchronizedarraylist = collections.synchronizedlist(arraylist);\n        // ä½¿ç¨è¿­ä»£å¨éå arraylist\n        synchronized (synchronizedarraylist) {\n            iterator<string> iterator = synchronizedarraylist.iterator();\n            while (iterator.hasnext()) {\n                string element = iterator.next();\n                system.out.println(element);\n            }\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n',charsets:{cjk:!0}},{title:"Setæ¥å£",frontmatter:{title:"Setæ¥å£",date:"2023-06-21T14:49:19.000Z",permalink:"/pages/4d8b8b/",author:{name:"éä¸æ¸é£",link:"https://github.com/msqfx"},categories:["java","éåç¯"],tags:[null],description:"ç»¼ä¸æè¿°ï¼Comparable å Comparator é½æ¯ç¨äºæ¯è¾å¯¹è±¡çæ¥å£ï¼ä½æ¯å®ä»¬ä¹é´çåºå«ä¸»è¦å¨äºå®ç°æ¹å¼ãåºç¨åºæ¯åä½¿ç¨æ¹å¼ç­æ¹é¢ãéè¦æ ¹æ®å®éæåµéæ©åéçæ¥å£æ¥è¿è¡å¯¹è±¡çæ¯è¾ã",comment:!0,meta:[{name:"twitter:title",content:"Setæ¥å£"},{name:"twitter:description",content:"ç»¼ä¸æè¿°ï¼Comparable å Comparator é½æ¯ç¨äºæ¯è¾å¯¹è±¡çæ¥å£ï¼ä½æ¯å®ä»¬ä¹é´çåºå«ä¸»è¦å¨äºå®ç°æ¹å¼ãåºç¨åºæ¯åä½¿ç¨æ¹å¼ç­æ¹é¢ãéè¦æ ¹æ®å®éæåµéæ©åéçæ¥å£æ¥è¿è¡å¯¹è±¡çæ¯è¾ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/01.java/02.%E9%9B%86%E5%90%88%E7%AF%87/03.Set%E6%8E%A5%E5%8F%A3.html"},{property:"og:type",content:"article"},{property:"og:title",content:"Setæ¥å£"},{property:"og:description",content:"ç»¼ä¸æè¿°ï¼Comparable å Comparator é½æ¯ç¨äºæ¯è¾å¯¹è±¡çæ¥å£ï¼ä½æ¯å®ä»¬ä¹é´çåºå«ä¸»è¦å¨äºå®ç°æ¹å¼ãåºç¨åºæ¯åä½¿ç¨æ¹å¼ç­æ¹é¢ãéè¦æ ¹æ®å®éæåµéæ©åéçæ¥å£æ¥è¿è¡å¯¹è±¡çæ¯è¾ã"},{property:"og:url",content:"https://www.msqfx.cc/01.java/02.%E9%9B%86%E5%90%88%E7%AF%87/03.Set%E6%8E%A5%E5%8F%A3.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-06-21T14:49:19.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"Setæ¥å£"},{itemprop:"description",content:"ç»¼ä¸æè¿°ï¼Comparable å Comparator é½æ¯ç¨äºæ¯è¾å¯¹è±¡çæ¥å£ï¼ä½æ¯å®ä»¬ä¹é´çåºå«ä¸»è¦å¨äºå®ç°æ¹å¼ãåºç¨åºæ¯åä½¿ç¨æ¹å¼ç­æ¹é¢ãéè¦æ ¹æ®å®éæåµéæ©åéçæ¥å£æ¥è¿è¡å¯¹è±¡çæ¯è¾ã"}],readingShow:"top"},regularPath:"/01.java/02.%E9%9B%86%E5%90%88%E7%AF%87/03.Set%E6%8E%A5%E5%8F%A3.html",relativePath:"01.java/02.éåç¯/03.Setæ¥å£.md",key:"v-7b03b51c",path:"/pages/4d8b8b/",headers:[{level:2,title:"Comparable å Comparator çåºå«",slug:"comparable-å-comparator-çåºå«",normalizedTitle:"comparable å comparator çåºå«",charIndex:15},{level:3,title:"Comparator å®å¶æåºï¼ç´æ¥æ¹æ³ä¸­éåï¼",slug:"comparator-å®å¶æåº-ç´æ¥æ¹æ³ä¸­éå",normalizedTitle:"comparator å®å¶æåºï¼ç´æ¥æ¹æ³ä¸­éåï¼",charIndex:1026},{level:3,title:"éå compareTo æ¹æ³å®ç°æå¹´é¾æ¥æåºï¼å¨å®ä½ç±»ä¸­éåæ¹æ³ï¼",slug:"éå-compareto-æ¹æ³å®ç°æå¹´é¾æ¥æåº-å¨å®ä½ç±»ä¸­éåæ¹æ³",normalizedTitle:"éå compareto æ¹æ³å®ç°æå¹´é¾æ¥æåºï¼å¨å®ä½ç±»ä¸­éåæ¹æ³ï¼",charIndex:2155},{level:2,title:"æ¯è¾ HashSetãLinkedHashSet å TreeSet ä¸èçå¼å",slug:"æ¯è¾-hashsetãlinkedhashset-å-treeset-ä¸èçå¼å",normalizedTitle:"æ¯è¾ hashsetãlinkedhashset å treeset ä¸èçå¼å",charIndex:3803},{level:2,title:"æºç è§£æ",slug:"æºç è§£æ",normalizedTitle:"æºç è§£æ",charIndex:4215},{level:3,title:"HashSet ç¹ç¹",slug:"hashset-ç¹ç¹",normalizedTitle:"hashset ç¹ç¹",charIndex:9339},{level:3,title:"è§£æ",slug:"è§£æ",normalizedTitle:"è§£æ",charIndex:4217},{level:3,title:"HashSet çå®ç°",slug:"hashset-çå®ç°",normalizedTitle:"hashset çå®ç°",charIndex:9733},{level:2,title:"åè",slug:"åè",normalizedTitle:"åè",charIndex:10024}],headersStr:"Comparable å Comparator çåºå« Comparator å®å¶æåºï¼ç´æ¥æ¹æ³ä¸­éåï¼ éå compareTo æ¹æ³å®ç°æå¹´é¾æ¥æåºï¼å¨å®ä½ç±»ä¸­éåæ¹æ³ï¼ æ¯è¾ HashSetãLinkedHashSet å TreeSet ä¸èçå¼å æºç è§£æ HashSet ç¹ç¹ è§£æ HashSet çå®ç° åè",content:'# Set éåè¯¦è§£\n\n\n# Comparable å Comparator çåºå«\n\n 1. Comparable æ¥å£åªæä¸ä¸ªæ¹æ³ compareTo()ï¼ç¨äºæ¯è¾å¯¹è±¡èªèº«ä¸å¦ä¸ä¸ªå¯¹è±¡çå¤§å°å³ç³»ãå®ç° Comparable æ¥å£çç±»å¯ä»¥ç´æ¥éè¿è°ç¨ Arrays.sort() æ Collections.sort() æ¹æ³è¿è¡æåºã Comparator æ¥å£æä¸¤ä¸ªæ¹æ³ compare() å equals()ï¼å¶ä¸­ compare() æ¹æ³ç¨äºæ¯è¾ä¸¤ä¸ªå¯¹è±¡çå¤§å°å³ç³»ï¼å¯ä»¥éè¿ Collections.sort() æ¹æ³çéè½½çæ¬æèä½¿ç¨ TreeMapãPriorityQueue ç­éè¦æ¯è¾å¯¹è±¡çéåç±»æ¥è¿è¡æåºãequals() æ¹æ³ç¨äºæ¯è¾ä¸¤ä¸ªå¯¹è±¡æ¯å¦ç¸ç­ï¼ä½å¨æ¯è¾å¤§å°æ¶å¹¶ä¸ä¼ä½¿ç¨å°ã\n 2. Comparable æ¥å£æ¯å¨ç±»çå®ä¹æ¶å°±å®ç°çï¼å®ç° Comparable æ¥å£æå³çè¯¥ç±»æ¯æèªç¶æåºï¼natural orderingï¼ï¼å³å¯ä»¥æ ¹æ®å¯¹è±¡èªèº«çå±æ§è¿è¡æåºãè Comparator æ¥å£æ¯å¨æåºæ¶ä½ä¸ºåæ°ä¼ éè¿å»çï¼å¯ä»¥æ ¹æ®ä¸åçæ¯è¾è§åè¿è¡æåºï¼ä¹å°±æ¯è¯´å¯ä»¥å®ä¹å¤ä¸ª Comparator æ¥æ¯è¾åä¸ä¸ªç±»çå¯¹è±¡ã\n 3. Comparable æ¥å£çå®ç°å¨éåç±»ä¸­è¢«å¹¿æ³ä½¿ç¨ï¼ä¾å¦å¨ TreeSetãTreeMap ç­éåç±»ä¸­éè¦æ¯è¾åç´ çå¤§å°å³ç³»æ¶ï¼ä¼é¦åå°è¯ä½¿ç¨åç´ èªèº«å®ç°ç Comparable æ¥å£è¿è¡æ¯è¾ãå¦æåç´ æ²¡æå®ç° Comparable æ¥å£ï¼åéè¦éè¿ä¼ éä¸ä¸ª Comparator å¯¹è±¡æ¥è¿è¡æ¯è¾ãå æ­¤ï¼å®ç° Comparable æ¥å£å¯ä»¥ä½¿å¾ç±»æ´å éç¨ï¼å ä¸ºå®å¯ä»¥è¢«å¹¿æ³åºç¨äºä¸åçéåç±»ä¸­ã\n 4. Comparable æ¥å£æ¯ Java çåé¨æ¥å£ï¼å®ä¹å¨ java.lang åä¸­ï¼è Comparator æ¥å£æ¯ Java çæ åç±»åºä¸­çæ¥å£ï¼å®ä¹å¨ java.util åä¸­ã ç»¼ä¸æè¿°ï¼Comparable å Comparator é½æ¯ç¨äºæ¯è¾å¯¹è±¡çæ¥å£ï¼ä½æ¯å®ä»¬ä¹é´çåºå«ä¸»è¦å¨äºå®ç°æ¹å¼ãåºç¨åºæ¯åä½¿ç¨æ¹å¼ç­æ¹é¢ãéè¦æ ¹æ®å®éæåµéæ©åéçæ¥å£æ¥è¿è¡å¯¹è±¡çæ¯è¾ã\n\n> ç»¼ä¸æè¿°ï¼Comparable å Comparator é½æ¯ç¨äºæ¯è¾å¯¹è±¡çæ¥å£ï¼ä½æ¯å®ä»¬ä¹é´çåºå«ä¸»è¦å¨äºå®ç°æ¹å¼ãåºç¨åºæ¯åä½¿ç¨æ¹å¼ç­æ¹é¢ãéè¦æ ¹æ®å®éæåµéæ©åéçæ¥å£æ¥è¿è¡å¯¹è±¡çæ¯è¾ã\n\n\n# Comparator å®å¶æåºï¼ç´æ¥æ¹æ³ä¸­éåï¼\n\nArrayList<Integer> arrayList = new ArrayList<Integer>();\narrayList.add(-1);\narrayList.add(3);\narrayList.add(3);\narrayList.add(-5);\narrayList.add(7);\narrayList.add(4);\narrayList.add(-9);\narrayList.add(-7);\nSystem.out.println("åå§æ°ç»:");\nSystem.out.println(arrayList);\n// void reverse(List list)ï¼åè½¬\nCollections.reverse(arrayList);\nSystem.out.println("Collections.reverse(arrayList):");\nSystem.out.println(arrayList);\n\n// void sort(List list),æèªç¶æåºçååºæåº\nCollections.sort(arrayList);\nSystem.out.println("Collections.sort(arrayList):");\nSystem.out.println(arrayList);\n// å®å¶æåºçç¨æ³\nCollections.sort(arrayList, new Comparator<Integer>() {\n\n    @Override\n    public int compare(Integer o1, Integer o2) {\n        return o2.compareTo(o1);\n    }\n});\nSystem.out.println("å®å¶æåºåï¼");\nSystem.out.println(arrayList);\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\nOutput:\n\nåå§æ°ç»:\n[-1, 3, 3, -5, 7, 4, -9, -7]\nCollections.reverse(arrayList):\n[-7, -9, 4, 7, -5, 3, 3, -1]\nCollections.sort(arrayList):\n[-9, -7, -5, -1, 3, 3, 4, 7]\nå®å¶æåºåï¼\n[7, 4, 3, 3, -1, -5, -7, -9]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# éå compareTo æ¹æ³å®ç°æå¹´é¾æ¥æåºï¼å¨å®ä½ç±»ä¸­éåæ¹æ³ï¼\n\n// personå¯¹è±¡æ²¡æå®ç°Comparableæ¥å£ï¼æä»¥å¿é¡»å®ç°ï¼è¿æ ·æä¸ä¼åºéï¼æå¯ä»¥ä½¿treemapä¸­çæ°æ®æé¡ºåºæå\n// åé¢ä¸ä¸ªä¾å­çStringç±»å·²ç»é»è®¤å®ç°äºComparableæ¥å£ï¼è¯¦ç»å¯ä»¥æ¥çStringç±»çAPIææ¡£ï¼å¦å¤å¶ä»\n// åIntegerç±»ç­é½å·²ç»å®ç°äºComparableæ¥å£ï¼æä»¥ä¸éè¦å¦å¤å®ç°äº\npublic  class Person implements Comparable<Person> {\n    private String name;\n    private int age;\n\n    public Person(String name, int age) {\n        super();\n        this.name = name;\n        this.age = age;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public int getAge() {\n        return age;\n    }\n\n    public void setAge(int age) {\n        this.age = age;\n    }\n\n    /**\n     * TéåcompareToæ¹æ³å®ç°æå¹´é¾æ¥æåº\n     */\n    @Override\n    public int compareTo(Person o) {\n        if (this.age > o.getAge()) {\n            return 1;\n        }\n        if (this.age < o.getAge()) {\n            return -1;\n        }\n        return 0;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n\n\n public static void main(String[] args) {\n        TreeMap<Person, String> pdata = new TreeMap<Person, String>();\n        pdata.put(new Person("å¼ ä¸", 30), "zhangsan");\n        pdata.put(new Person("æå", 20), "lisi");\n        pdata.put(new Person("çäº", 10), "wangwu");\n        pdata.put(new Person("å°çº¢", 5), "xiaohong");\n        // å¾å°keyçå¼çåæ¶å¾å°keyæå¯¹åºçå¼\n        Set<Person> keys = pdata.keySet();\n        for (Person key : keys) {\n            System.out.println(key.getAge() + "-" + key.getName());\n\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nOutputï¼\n\n5-å°çº¢\n10-çäº\n20-æå\n30-å¼ ä¸\n\n\n1\n2\n3\n4\n\n\n\n# æ¯è¾ HashSetãLinkedHashSet å TreeSet ä¸èçå¼å\n\n * HashSetãLinkedHashSet å TreeSet é½æ¯ Set æ¥å£çå®ç°ç±»ï¼é½è½ä¿è¯åç´ å¯ä¸ï¼å¹¶ä¸é½ä¸æ¯çº¿ç¨å®å¨çã\n * HashSetãLinkedHashSet å TreeSet çä¸»è¦åºå«å¨äºåºå±æ°æ®ç»æä¸åãHashSet çåºå±æ°æ®ç»ææ¯åå¸è¡¨ï¼åºäº HashMap å®ç°ï¼ãLinkedHashSet çåºå±æ°æ®ç»ææ¯é¾è¡¨ååå¸è¡¨ï¼åç´ çæå¥åååºé¡ºåºæ»¡è¶³ FIFOãTreeSet åºå±æ°æ®ç»ææ¯çº¢é»æ ï¼åç´ æ¯æåºçï¼æåºçæ¹å¼æèªç¶æåºåå®å¶æåºã\n * åºå±æ°æ®ç»æä¸ååå¯¼è´è¿ä¸èçåºç¨åºæ¯ä¸åãHashSet ç¨äºä¸éè¦ä¿è¯åç´ æå¥åååºé¡ºåºçåºæ¯ï¼LinkedHashSet ç¨äºä¿è¯åç´ çæå¥åååºé¡ºåºæ»¡è¶³ FIFO çåºæ¯ï¼TreeSet ç¨äºæ¯æå¯¹åç´ èªå®ä¹æåºè§åçåºæ¯ã\n\n\n# æºç è§£æ\n\npublic class HashSet<E>  \n   extends AbstractSet<E>  \n   implements Set<E>, Cloneable, java.io.Serializable  \n{  \n   static final long serialVersionUID = -5024744406713321676L;  \n \n   // åºå±ä½¿ç¨HashMapæ¥ä¿å­HashSetä¸­ææåç´ ã  \n   private transient HashMap<E,Object> map;  \n     \n   // å®ä¹ä¸ä¸ªèæçObjectå¯¹è±¡ä½ä¸ºHashMapçvalueï¼å°æ­¤å¯¹è±¡å®ä¹ä¸ºstatic finalã  \n   private static final Object PRESENT = new Object();  \n \n   /** \n    * é»è®¤çæ åæé å¨ï¼æé ä¸ä¸ªç©ºçHashSetã \n    *  \n    * å®éåºå±ä¼åå§åä¸ä¸ªç©ºçHashMapï¼å¹¶ä½¿ç¨é»è®¤åå§å®¹éä¸º16åå è½½å å­0.75ã \n    */  \n   public HashSet() {  \n   map = new HashMap<E,Object>();  \n   }  \n \n   /** \n    * æé ä¸ä¸ªåå«æå®collectionä¸­çåç´ çæ°setã \n    * \n    * å®éåºå±ä½¿ç¨é»è®¤çå è½½å å­0.75åè¶³ä»¥åå«æå® \n    * collectionä¸­ææåç´ çåå§å®¹éæ¥åå»ºä¸ä¸ªHashMapã \n    * @param c å¶ä¸­çåç´ å°å­æ¾å¨æ­¤setä¸­çcollectionã \n    */  \n   public HashSet(Collection<? extends E> c) {  \n   map = new HashMap<E,Object>(Math.max((int) (c.size()/.75f) + 1, 16));  \n   addAll(c);  \n   }  \n \n   /** \n    * ä»¥æå®çinitialCapacityåloadFactoræé ä¸ä¸ªç©ºçHashSetã \n    * \n    * å®éåºå±ä»¥ç¸åºçåæ°æé ä¸ä¸ªç©ºçHashMapã \n    * @param initialCapacity åå§å®¹éã \n    * @param loadFactor å è½½å å­ã \n    */  \n   public HashSet(int initialCapacity, float loadFactor) {  \n   map = new HashMap<E,Object>(initialCapacity, loadFactor);  \n   }  \n \n   /** \n    * ä»¥æå®çinitialCapacityæé ä¸ä¸ªç©ºçHashSetã \n    * \n    * å®éåºå±ä»¥ç¸åºçåæ°åå è½½å å­loadFactorä¸º0.75æé ä¸ä¸ªç©ºçHashMapã \n    * @param initialCapacity åå§å®¹éã \n    */  \n   public HashSet(int initialCapacity) {  \n   map = new HashMap<E,Object>(initialCapacity);  \n   }  \n \n   /** \n    * ä»¥æå®çinitialCapacityåloadFactoræé ä¸ä¸ªæ°çç©ºé¾æ¥åå¸éåã \n    * æ­¤æé å½æ°ä¸ºåè®¿é®æéï¼ä¸å¯¹å¤å¬å¼ï¼å®éåªæ¯æ¯å¯¹LinkedHashSetçæ¯æã \n    * \n    * å®éåºå±ä¼ä»¥æå®çåæ°æé ä¸ä¸ªç©ºLinkedHashMapå®ä¾æ¥å®ç°ã \n    * @param initialCapacity åå§å®¹éã \n    * @param loadFactor å è½½å å­ã \n    * @param dummy æ è®°ã \n    */  \n   HashSet(int initialCapacity, float loadFactor, boolean dummy) {  \n   map = new LinkedHashMap<E,Object>(initialCapacity, loadFactor);  \n   }  \n \n   /** \n    * è¿åå¯¹æ­¤setä¸­åç´ è¿è¡è¿­ä»£çè¿­ä»£å¨ãè¿ååç´ çé¡ºåºå¹¶ä¸æ¯ç¹å®çã \n    *  \n    * åºå±å®éè°ç¨åºå±HashMapçkeySetæ¥è¿åææçkeyã \n    * å¯è§HashSetä¸­çåç´ ï¼åªæ¯å­æ¾å¨äºåºå±HashMapçkeyä¸ï¼ \n    * valueä½¿ç¨ä¸ä¸ªstatic finalçObjectå¯¹è±¡æ è¯ã \n    * @return å¯¹æ­¤setä¸­åç´ è¿è¡è¿­ä»£çIteratorã \n    */  \n   public Iterator<E> iterator() {  \n   return map.keySet().iterator();  \n   }  \n \n   /** \n    * è¿åæ­¤setä¸­çåç´ çæ°éï¼setçå®¹éï¼ã \n    * \n    * åºå±å®éè°ç¨HashMapçsize()æ¹æ³è¿åEntryçæ°éï¼å°±å¾å°è¯¥Setä¸­åç´ çä¸ªæ°ã \n    * @return æ­¤setä¸­çåç´ çæ°éï¼setçå®¹éï¼ã \n    */  \n   public int size() {  \n   return map.size();  \n   }  \n \n   /** \n    * å¦ææ­¤setä¸åå«ä»»ä½åç´ ï¼åè¿åtrueã \n    * \n    * åºå±å®éè°ç¨HashMapçisEmpty()å¤æ­è¯¥HashSetæ¯å¦ä¸ºç©ºã \n    * @return å¦ææ­¤setä¸åå«ä»»ä½åç´ ï¼åè¿åtrueã \n    */  \n   public boolean isEmpty() {  \n   return map.isEmpty();  \n   }  \n \n   /** \n    * å¦ææ­¤setåå«æå®åç´ ï¼åè¿åtrueã \n    * æ´ç¡®åå°è®²ï¼å½ä¸ä»å½æ­¤setåå«ä¸ä¸ªæ»¡è¶³(o==null ? e==null : o.equals(e)) \n    * çeåç´ æ¶ï¼è¿åtrueã \n    * \n    * åºå±å®éè°ç¨HashMapçcontainsKeyå¤æ­æ¯å¦åå«æå®keyã \n    * @param o å¨æ­¤setä¸­çå­å¨å·²å¾å°æµè¯çåç´ ã \n    * @return å¦ææ­¤setåå«æå®åç´ ï¼åè¿åtrueã \n    */  \n   public boolean contains(Object o) {  \n   return map.containsKey(o);  \n   }  \n \n   /** \n    * å¦ææ­¤setä¸­å°æªåå«æå®åç´ ï¼åæ·»å æå®åç´ ã \n    * æ´ç¡®åå°è®²ï¼å¦ææ­¤ set æ²¡æåå«æ»¡è¶³(e==null ? e2==null : e.equals(e2)) \n    * çåç´ e2ï¼ååæ­¤set æ·»å æå®çåç´ eã \n    * å¦ææ­¤setå·²åå«è¯¥åç´ ï¼åè¯¥è°ç¨ä¸æ´æ¹setå¹¶è¿åfalseã \n    * \n    * åºå±å®éå°å°è¯¥åç´ ä½ä¸ºkeyæ¾å¥HashMapã \n    * ç±äºHashMapçput()æ¹æ³æ·»å key-valueå¯¹æ¶ï¼å½æ°æ¾å¥HashMapçEntryä¸­key \n    * ä¸éåä¸­åæEntryçkeyç¸åï¼hashCode()è¿åå¼ç¸ç­ï¼éè¿equalsæ¯è¾ä¹è¿åtrueï¼ï¼ \n    * æ°æ·»å çEntryçvalueä¼å°è¦çåæ¥Entryçvalueï¼ä½keyä¸ä¼æä»»ä½æ¹åï¼ \n    * å æ­¤å¦æåHashSetä¸­æ·»å ä¸ä¸ªå·²ç»å­å¨çåç´ æ¶ï¼æ°æ·»å çéååç´ å°ä¸ä¼è¢«æ¾å¥HashMapä¸­ï¼ \n    * åæ¥çåç´ ä¹ä¸ä¼æä»»ä½æ¹åï¼è¿ä¹å°±æ»¡è¶³äºSetä¸­åç´ ä¸éå¤çç¹æ§ã \n    * @param e å°æ·»å å°æ­¤setä¸­çåç´ ã \n    * @return å¦ææ­¤setå°æªåå«æå®åç´ ï¼åè¿åtrueã \n    */  \n   public boolean add(E e) {  \n   return map.put(e, PRESENT)==null;  \n   }  \n \n   /** \n    * å¦ææå®åç´ å­å¨äºæ­¤setä¸­ï¼åå°å¶ç§»é¤ã \n    * æ´ç¡®åå°è®²ï¼å¦ææ­¤setåå«ä¸ä¸ªæ»¡è¶³(o==null ? e==null : o.equals(e))çåç´ eï¼ \n    * åå°å¶ç§»é¤ãå¦ææ­¤setå·²åå«è¯¥åç´ ï¼åè¿åtrue \n    * ï¼æèï¼å¦ææ­¤setå è°ç¨èåçæ´æ¹ï¼åè¿åtrueï¼ãï¼ä¸æ¦è°ç¨è¿åï¼åæ­¤setä¸ååå«è¯¥åç´ ï¼ã \n    * \n    * åºå±å®éè°ç¨HashMapçremoveæ¹æ³å é¤æå®Entryã \n    * @param o å¦æå­å¨äºæ­¤setä¸­åéè¦å°å¶ç§»é¤çå¯¹è±¡ã \n    * @return å¦æsetåå«æå®åç´ ï¼åè¿åtrueã \n    */  \n   public boolean remove(Object o) {  \n   return map.remove(o)==PRESENT;  \n   }  \n \n   /** \n    * ä»æ­¤setä¸­ç§»é¤ææåç´ ãæ­¤è°ç¨è¿ååï¼è¯¥setå°ä¸ºç©ºã \n    * \n    * åºå±å®éè°ç¨HashMapçclearæ¹æ³æ¸ç©ºEntryä¸­ææåç´ ã \n    */  \n   public void clear() {  \n   map.clear();  \n   }  \n \n   /** \n    * è¿åæ­¤HashSetå®ä¾çæµè¡¨å¯æ¬ï¼å¹¶æ²¡æå¤å¶è¿äºåç´ æ¬èº«ã \n    * \n    * åºå±å®éè°ç¨HashMapçclone()æ¹æ³ï¼è·åHashMapçæµè¡¨å¯æ¬ï¼å¹¶è®¾ç½®å°  HashSetä¸­ã \n    */  \n   public Object clone() {  \n       try {  \n           HashSet<E> newSet = (HashSet<E>) super.clone();  \n           newSet.map = (HashMap<E, Object>) map.clone();  \n           return newSet;  \n       } catch (CloneNotSupportedException e) {  \n           throw new InternalError();  \n       }  \n   }  \n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n\n\n\n# HashSet ç¹ç¹\n\n * éçº¿ç¨å®å¨\n * åè®¸ null å¼\n * æ·»å å¼å¾æ¶åä¼åè·åå¯¹è±¡ç hashCode æ¹æ³ï¼å¦æ hashCode æ¹æ³è¿åçå¼ä¸è´ï¼ååè°ç¨ equals æ¹æ³å¤æ­æ¯å¦ä¸è´ï¼å¦æä¸ä¸è´æ add åç´ ã\n\n\n# è§£æ\n\nadd()\n\nHashSet éé¢ç add æ¹æ³ä½¿ç¨çå°±æ¯ HashMap ç put æ¹æ³ï¼map.put(e,PRESENT)==null; å°è¦å­å¥çéååç´ ä½ä¸ºé®ï¼ç¶åæ PRESENT è¿ä¸ªèæå¯¹è±¡ä½ä¸ºå¼ï¼èè¿ä¸ªå¼æ¯ä¸ä¸ªåºå®å¸¸éã\n\næ¥é\n\nHashSet æ¥éçè¯ï¼åºè¯¥å°±æ¯å©ç¨å°äº HashMap çé®å¯ä¸æ§æ¥å»éï¼æ°çåç´ ä¼è¦çææ§çåç´ ï¼== å·çå¤æ­ç»ææ¥ç¡®å®æ¯å¦åå«è¦æ·»å çåç´ ï¼ä¸åå«å°±æ·»å åç´ å¹¶è¿å trueï¼åå«å°±å¿½ç¥æ­¤æ·»å æä½å¹¶è¿å falseï¼ä»èä¿è¯äº HashSet ä¸­åç´ çå¯ä¸æ§ã\n\n\n# HashSet çå®ç°\n\nHashSet å®éä¸æ¯åºäº HashMap å®ç°çï¼å®åªä½¿ç¨äº HashMap çé®æ¥å­å¨æ°æ®ãå¨ HashSet ä¸­ï¼åç´ è¢«å­å¨ä¸º HashMap çé®ï¼èå¼é½æ¯åºå®çä¸ä¸ªå¸¸éå¯¹è±¡ã\n\nå æ­¤ï¼å½æä»¬å HashSet æ·»å åç´ æ¶ï¼å®éä¸æ¯å°è¿ä¸ªåç´ ä½ä¸ºé®ï¼å¸¸éå¯¹è±¡ä½ä¸ºå¯¹åºçå¼å­å¨å¨ HashMap ä¸­ã\n\nå¨ HashSet ä¸­ï¼å¯ä¸æ§æ¯éè¿ HashMap ä¸­é®çå¯ä¸æ§ä¿è¯çï¼å ä¸º HashMap çé®æ¯å¯ä¸çãå½æä»¬ä½¿ç¨ HashSet æ¥å­å¨åç´ æ¶ï¼å®éä¸æ¯å¨å©ç¨ HashMap çå»éç¹æ§æ¥ä¿è¯ HashSet ä¸­çåç´ å¯ä¸æ§ã\n\n\n# åè\n\nhttps://blog.csdn.net/fighterandknight/article/details/66585997',normalizedContent:'# set éåè¯¦è§£\n\n\n# comparable å comparator çåºå«\n\n 1. comparable æ¥å£åªæä¸ä¸ªæ¹æ³ compareto()ï¼ç¨äºæ¯è¾å¯¹è±¡èªèº«ä¸å¦ä¸ä¸ªå¯¹è±¡çå¤§å°å³ç³»ãå®ç° comparable æ¥å£çç±»å¯ä»¥ç´æ¥éè¿è°ç¨ arrays.sort() æ collections.sort() æ¹æ³è¿è¡æåºã comparator æ¥å£æä¸¤ä¸ªæ¹æ³ compare() å equals()ï¼å¶ä¸­ compare() æ¹æ³ç¨äºæ¯è¾ä¸¤ä¸ªå¯¹è±¡çå¤§å°å³ç³»ï¼å¯ä»¥éè¿ collections.sort() æ¹æ³çéè½½çæ¬æèä½¿ç¨ treemapãpriorityqueue ç­éè¦æ¯è¾å¯¹è±¡çéåç±»æ¥è¿è¡æåºãequals() æ¹æ³ç¨äºæ¯è¾ä¸¤ä¸ªå¯¹è±¡æ¯å¦ç¸ç­ï¼ä½å¨æ¯è¾å¤§å°æ¶å¹¶ä¸ä¼ä½¿ç¨å°ã\n 2. comparable æ¥å£æ¯å¨ç±»çå®ä¹æ¶å°±å®ç°çï¼å®ç° comparable æ¥å£æå³çè¯¥ç±»æ¯æèªç¶æåºï¼natural orderingï¼ï¼å³å¯ä»¥æ ¹æ®å¯¹è±¡èªèº«çå±æ§è¿è¡æåºãè comparator æ¥å£æ¯å¨æåºæ¶ä½ä¸ºåæ°ä¼ éè¿å»çï¼å¯ä»¥æ ¹æ®ä¸åçæ¯è¾è§åè¿è¡æåºï¼ä¹å°±æ¯è¯´å¯ä»¥å®ä¹å¤ä¸ª comparator æ¥æ¯è¾åä¸ä¸ªç±»çå¯¹è±¡ã\n 3. comparable æ¥å£çå®ç°å¨éåç±»ä¸­è¢«å¹¿æ³ä½¿ç¨ï¼ä¾å¦å¨ treesetãtreemap ç­éåç±»ä¸­éè¦æ¯è¾åç´ çå¤§å°å³ç³»æ¶ï¼ä¼é¦åå°è¯ä½¿ç¨åç´ èªèº«å®ç°ç comparable æ¥å£è¿è¡æ¯è¾ãå¦æåç´ æ²¡æå®ç° comparable æ¥å£ï¼åéè¦éè¿ä¼ éä¸ä¸ª comparator å¯¹è±¡æ¥è¿è¡æ¯è¾ãå æ­¤ï¼å®ç° comparable æ¥å£å¯ä»¥ä½¿å¾ç±»æ´å éç¨ï¼å ä¸ºå®å¯ä»¥è¢«å¹¿æ³åºç¨äºä¸åçéåç±»ä¸­ã\n 4. comparable æ¥å£æ¯ java çåé¨æ¥å£ï¼å®ä¹å¨ java.lang åä¸­ï¼è comparator æ¥å£æ¯ java çæ åç±»åºä¸­çæ¥å£ï¼å®ä¹å¨ java.util åä¸­ã ç»¼ä¸æè¿°ï¼comparable å comparator é½æ¯ç¨äºæ¯è¾å¯¹è±¡çæ¥å£ï¼ä½æ¯å®ä»¬ä¹é´çåºå«ä¸»è¦å¨äºå®ç°æ¹å¼ãåºç¨åºæ¯åä½¿ç¨æ¹å¼ç­æ¹é¢ãéè¦æ ¹æ®å®éæåµéæ©åéçæ¥å£æ¥è¿è¡å¯¹è±¡çæ¯è¾ã\n\n> ç»¼ä¸æè¿°ï¼comparable å comparator é½æ¯ç¨äºæ¯è¾å¯¹è±¡çæ¥å£ï¼ä½æ¯å®ä»¬ä¹é´çåºå«ä¸»è¦å¨äºå®ç°æ¹å¼ãåºç¨åºæ¯åä½¿ç¨æ¹å¼ç­æ¹é¢ãéè¦æ ¹æ®å®éæåµéæ©åéçæ¥å£æ¥è¿è¡å¯¹è±¡çæ¯è¾ã\n\n\n# comparator å®å¶æåºï¼ç´æ¥æ¹æ³ä¸­éåï¼\n\narraylist<integer> arraylist = new arraylist<integer>();\narraylist.add(-1);\narraylist.add(3);\narraylist.add(3);\narraylist.add(-5);\narraylist.add(7);\narraylist.add(4);\narraylist.add(-9);\narraylist.add(-7);\nsystem.out.println("åå§æ°ç»:");\nsystem.out.println(arraylist);\n// void reverse(list list)ï¼åè½¬\ncollections.reverse(arraylist);\nsystem.out.println("collections.reverse(arraylist):");\nsystem.out.println(arraylist);\n\n// void sort(list list),æèªç¶æåºçååºæåº\ncollections.sort(arraylist);\nsystem.out.println("collections.sort(arraylist):");\nsystem.out.println(arraylist);\n// å®å¶æåºçç¨æ³\ncollections.sort(arraylist, new comparator<integer>() {\n\n    @override\n    public int compare(integer o1, integer o2) {\n        return o2.compareto(o1);\n    }\n});\nsystem.out.println("å®å¶æåºåï¼");\nsystem.out.println(arraylist);\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\noutput:\n\nåå§æ°ç»:\n[-1, 3, 3, -5, 7, 4, -9, -7]\ncollections.reverse(arraylist):\n[-7, -9, 4, 7, -5, 3, 3, -1]\ncollections.sort(arraylist):\n[-9, -7, -5, -1, 3, 3, 4, 7]\nå®å¶æåºåï¼\n[7, 4, 3, 3, -1, -5, -7, -9]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# éå compareto æ¹æ³å®ç°æå¹´é¾æ¥æåºï¼å¨å®ä½ç±»ä¸­éåæ¹æ³ï¼\n\n// personå¯¹è±¡æ²¡æå®ç°comparableæ¥å£ï¼æä»¥å¿é¡»å®ç°ï¼è¿æ ·æä¸ä¼åºéï¼æå¯ä»¥ä½¿treemapä¸­çæ°æ®æé¡ºåºæå\n// åé¢ä¸ä¸ªä¾å­çstringç±»å·²ç»é»è®¤å®ç°äºcomparableæ¥å£ï¼è¯¦ç»å¯ä»¥æ¥çstringç±»çapiææ¡£ï¼å¦å¤å¶ä»\n// åintegerç±»ç­é½å·²ç»å®ç°äºcomparableæ¥å£ï¼æä»¥ä¸éè¦å¦å¤å®ç°äº\npublic  class person implements comparable<person> {\n    private string name;\n    private int age;\n\n    public person(string name, int age) {\n        super();\n        this.name = name;\n        this.age = age;\n    }\n\n    public string getname() {\n        return name;\n    }\n\n    public void setname(string name) {\n        this.name = name;\n    }\n\n    public int getage() {\n        return age;\n    }\n\n    public void setage(int age) {\n        this.age = age;\n    }\n\n    /**\n     * téåcomparetoæ¹æ³å®ç°æå¹´é¾æ¥æåº\n     */\n    @override\n    public int compareto(person o) {\n        if (this.age > o.getage()) {\n            return 1;\n        }\n        if (this.age < o.getage()) {\n            return -1;\n        }\n        return 0;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n\n\n public static void main(string[] args) {\n        treemap<person, string> pdata = new treemap<person, string>();\n        pdata.put(new person("å¼ ä¸", 30), "zhangsan");\n        pdata.put(new person("æå", 20), "lisi");\n        pdata.put(new person("çäº", 10), "wangwu");\n        pdata.put(new person("å°çº¢", 5), "xiaohong");\n        // å¾å°keyçå¼çåæ¶å¾å°keyæå¯¹åºçå¼\n        set<person> keys = pdata.keyset();\n        for (person key : keys) {\n            system.out.println(key.getage() + "-" + key.getname());\n\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\noutputï¼\n\n5-å°çº¢\n10-çäº\n20-æå\n30-å¼ ä¸\n\n\n1\n2\n3\n4\n\n\n\n# æ¯è¾ hashsetãlinkedhashset å treeset ä¸èçå¼å\n\n * hashsetãlinkedhashset å treeset é½æ¯ set æ¥å£çå®ç°ç±»ï¼é½è½ä¿è¯åç´ å¯ä¸ï¼å¹¶ä¸é½ä¸æ¯çº¿ç¨å®å¨çã\n * hashsetãlinkedhashset å treeset çä¸»è¦åºå«å¨äºåºå±æ°æ®ç»æä¸åãhashset çåºå±æ°æ®ç»ææ¯åå¸è¡¨ï¼åºäº hashmap å®ç°ï¼ãlinkedhashset çåºå±æ°æ®ç»ææ¯é¾è¡¨ååå¸è¡¨ï¼åç´ çæå¥åååºé¡ºåºæ»¡è¶³ fifoãtreeset åºå±æ°æ®ç»ææ¯çº¢é»æ ï¼åç´ æ¯æåºçï¼æåºçæ¹å¼æèªç¶æåºåå®å¶æåºã\n * åºå±æ°æ®ç»æä¸ååå¯¼è´è¿ä¸èçåºç¨åºæ¯ä¸åãhashset ç¨äºä¸éè¦ä¿è¯åç´ æå¥åååºé¡ºåºçåºæ¯ï¼linkedhashset ç¨äºä¿è¯åç´ çæå¥åååºé¡ºåºæ»¡è¶³ fifo çåºæ¯ï¼treeset ç¨äºæ¯æå¯¹åç´ èªå®ä¹æåºè§åçåºæ¯ã\n\n\n# æºç è§£æ\n\npublic class hashset<e>  \n   extends abstractset<e>  \n   implements set<e>, cloneable, java.io.serializable  \n{  \n   static final long serialversionuid = -5024744406713321676l;  \n \n   // åºå±ä½¿ç¨hashmapæ¥ä¿å­hashsetä¸­ææåç´ ã  \n   private transient hashmap<e,object> map;  \n     \n   // å®ä¹ä¸ä¸ªèæçobjectå¯¹è±¡ä½ä¸ºhashmapçvalueï¼å°æ­¤å¯¹è±¡å®ä¹ä¸ºstatic finalã  \n   private static final object present = new object();  \n \n   /** \n    * é»è®¤çæ åæé å¨ï¼æé ä¸ä¸ªç©ºçhashsetã \n    *  \n    * å®éåºå±ä¼åå§åä¸ä¸ªç©ºçhashmapï¼å¹¶ä½¿ç¨é»è®¤åå§å®¹éä¸º16åå è½½å å­0.75ã \n    */  \n   public hashset() {  \n   map = new hashmap<e,object>();  \n   }  \n \n   /** \n    * æé ä¸ä¸ªåå«æå®collectionä¸­çåç´ çæ°setã \n    * \n    * å®éåºå±ä½¿ç¨é»è®¤çå è½½å å­0.75åè¶³ä»¥åå«æå® \n    * collectionä¸­ææåç´ çåå§å®¹éæ¥åå»ºä¸ä¸ªhashmapã \n    * @param c å¶ä¸­çåç´ å°å­æ¾å¨æ­¤setä¸­çcollectionã \n    */  \n   public hashset(collection<? extends e> c) {  \n   map = new hashmap<e,object>(math.max((int) (c.size()/.75f) + 1, 16));  \n   addall(c);  \n   }  \n \n   /** \n    * ä»¥æå®çinitialcapacityåloadfactoræé ä¸ä¸ªç©ºçhashsetã \n    * \n    * å®éåºå±ä»¥ç¸åºçåæ°æé ä¸ä¸ªç©ºçhashmapã \n    * @param initialcapacity åå§å®¹éã \n    * @param loadfactor å è½½å å­ã \n    */  \n   public hashset(int initialcapacity, float loadfactor) {  \n   map = new hashmap<e,object>(initialcapacity, loadfactor);  \n   }  \n \n   /** \n    * ä»¥æå®çinitialcapacityæé ä¸ä¸ªç©ºçhashsetã \n    * \n    * å®éåºå±ä»¥ç¸åºçåæ°åå è½½å å­loadfactorä¸º0.75æé ä¸ä¸ªç©ºçhashmapã \n    * @param initialcapacity åå§å®¹éã \n    */  \n   public hashset(int initialcapacity) {  \n   map = new hashmap<e,object>(initialcapacity);  \n   }  \n \n   /** \n    * ä»¥æå®çinitialcapacityåloadfactoræé ä¸ä¸ªæ°çç©ºé¾æ¥åå¸éåã \n    * æ­¤æé å½æ°ä¸ºåè®¿é®æéï¼ä¸å¯¹å¤å¬å¼ï¼å®éåªæ¯æ¯å¯¹linkedhashsetçæ¯æã \n    * \n    * å®éåºå±ä¼ä»¥æå®çåæ°æé ä¸ä¸ªç©ºlinkedhashmapå®ä¾æ¥å®ç°ã \n    * @param initialcapacity åå§å®¹éã \n    * @param loadfactor å è½½å å­ã \n    * @param dummy æ è®°ã \n    */  \n   hashset(int initialcapacity, float loadfactor, boolean dummy) {  \n   map = new linkedhashmap<e,object>(initialcapacity, loadfactor);  \n   }  \n \n   /** \n    * è¿åå¯¹æ­¤setä¸­åç´ è¿è¡è¿­ä»£çè¿­ä»£å¨ãè¿ååç´ çé¡ºåºå¹¶ä¸æ¯ç¹å®çã \n    *  \n    * åºå±å®éè°ç¨åºå±hashmapçkeysetæ¥è¿åææçkeyã \n    * å¯è§hashsetä¸­çåç´ ï¼åªæ¯å­æ¾å¨äºåºå±hashmapçkeyä¸ï¼ \n    * valueä½¿ç¨ä¸ä¸ªstatic finalçobjectå¯¹è±¡æ è¯ã \n    * @return å¯¹æ­¤setä¸­åç´ è¿è¡è¿­ä»£çiteratorã \n    */  \n   public iterator<e> iterator() {  \n   return map.keyset().iterator();  \n   }  \n \n   /** \n    * è¿åæ­¤setä¸­çåç´ çæ°éï¼setçå®¹éï¼ã \n    * \n    * åºå±å®éè°ç¨hashmapçsize()æ¹æ³è¿åentryçæ°éï¼å°±å¾å°è¯¥setä¸­åç´ çä¸ªæ°ã \n    * @return æ­¤setä¸­çåç´ çæ°éï¼setçå®¹éï¼ã \n    */  \n   public int size() {  \n   return map.size();  \n   }  \n \n   /** \n    * å¦ææ­¤setä¸åå«ä»»ä½åç´ ï¼åè¿åtrueã \n    * \n    * åºå±å®éè°ç¨hashmapçisempty()å¤æ­è¯¥hashsetæ¯å¦ä¸ºç©ºã \n    * @return å¦ææ­¤setä¸åå«ä»»ä½åç´ ï¼åè¿åtrueã \n    */  \n   public boolean isempty() {  \n   return map.isempty();  \n   }  \n \n   /** \n    * å¦ææ­¤setåå«æå®åç´ ï¼åè¿åtrueã \n    * æ´ç¡®åå°è®²ï¼å½ä¸ä»å½æ­¤setåå«ä¸ä¸ªæ»¡è¶³(o==null ? e==null : o.equals(e)) \n    * çeåç´ æ¶ï¼è¿åtrueã \n    * \n    * åºå±å®éè°ç¨hashmapçcontainskeyå¤æ­æ¯å¦åå«æå®keyã \n    * @param o å¨æ­¤setä¸­çå­å¨å·²å¾å°æµè¯çåç´ ã \n    * @return å¦ææ­¤setåå«æå®åç´ ï¼åè¿åtrueã \n    */  \n   public boolean contains(object o) {  \n   return map.containskey(o);  \n   }  \n \n   /** \n    * å¦ææ­¤setä¸­å°æªåå«æå®åç´ ï¼åæ·»å æå®åç´ ã \n    * æ´ç¡®åå°è®²ï¼å¦ææ­¤ set æ²¡æåå«æ»¡è¶³(e==null ? e2==null : e.equals(e2)) \n    * çåç´ e2ï¼ååæ­¤set æ·»å æå®çåç´ eã \n    * å¦ææ­¤setå·²åå«è¯¥åç´ ï¼åè¯¥è°ç¨ä¸æ´æ¹setå¹¶è¿åfalseã \n    * \n    * åºå±å®éå°å°è¯¥åç´ ä½ä¸ºkeyæ¾å¥hashmapã \n    * ç±äºhashmapçput()æ¹æ³æ·»å key-valueå¯¹æ¶ï¼å½æ°æ¾å¥hashmapçentryä¸­key \n    * ä¸éåä¸­åæentryçkeyç¸åï¼hashcode()è¿åå¼ç¸ç­ï¼éè¿equalsæ¯è¾ä¹è¿åtrueï¼ï¼ \n    * æ°æ·»å çentryçvalueä¼å°è¦çåæ¥entryçvalueï¼ä½keyä¸ä¼æä»»ä½æ¹åï¼ \n    * å æ­¤å¦æåhashsetä¸­æ·»å ä¸ä¸ªå·²ç»å­å¨çåç´ æ¶ï¼æ°æ·»å çéååç´ å°ä¸ä¼è¢«æ¾å¥hashmapä¸­ï¼ \n    * åæ¥çåç´ ä¹ä¸ä¼æä»»ä½æ¹åï¼è¿ä¹å°±æ»¡è¶³äºsetä¸­åç´ ä¸éå¤çç¹æ§ã \n    * @param e å°æ·»å å°æ­¤setä¸­çåç´ ã \n    * @return å¦ææ­¤setå°æªåå«æå®åç´ ï¼åè¿åtrueã \n    */  \n   public boolean add(e e) {  \n   return map.put(e, present)==null;  \n   }  \n \n   /** \n    * å¦ææå®åç´ å­å¨äºæ­¤setä¸­ï¼åå°å¶ç§»é¤ã \n    * æ´ç¡®åå°è®²ï¼å¦ææ­¤setåå«ä¸ä¸ªæ»¡è¶³(o==null ? e==null : o.equals(e))çåç´ eï¼ \n    * åå°å¶ç§»é¤ãå¦ææ­¤setå·²åå«è¯¥åç´ ï¼åè¿åtrue \n    * ï¼æèï¼å¦ææ­¤setå è°ç¨èåçæ´æ¹ï¼åè¿åtrueï¼ãï¼ä¸æ¦è°ç¨è¿åï¼åæ­¤setä¸ååå«è¯¥åç´ ï¼ã \n    * \n    * åºå±å®éè°ç¨hashmapçremoveæ¹æ³å é¤æå®entryã \n    * @param o å¦æå­å¨äºæ­¤setä¸­åéè¦å°å¶ç§»é¤çå¯¹è±¡ã \n    * @return å¦æsetåå«æå®åç´ ï¼åè¿åtrueã \n    */  \n   public boolean remove(object o) {  \n   return map.remove(o)==present;  \n   }  \n \n   /** \n    * ä»æ­¤setä¸­ç§»é¤ææåç´ ãæ­¤è°ç¨è¿ååï¼è¯¥setå°ä¸ºç©ºã \n    * \n    * åºå±å®éè°ç¨hashmapçclearæ¹æ³æ¸ç©ºentryä¸­ææåç´ ã \n    */  \n   public void clear() {  \n   map.clear();  \n   }  \n \n   /** \n    * è¿åæ­¤hashsetå®ä¾çæµè¡¨å¯æ¬ï¼å¹¶æ²¡æå¤å¶è¿äºåç´ æ¬èº«ã \n    * \n    * åºå±å®éè°ç¨hashmapçclone()æ¹æ³ï¼è·åhashmapçæµè¡¨å¯æ¬ï¼å¹¶è®¾ç½®å°  hashsetä¸­ã \n    */  \n   public object clone() {  \n       try {  \n           hashset<e> newset = (hashset<e>) super.clone();  \n           newset.map = (hashmap<e, object>) map.clone();  \n           return newset;  \n       } catch (clonenotsupportedexception e) {  \n           throw new internalerror();  \n       }  \n   }  \n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n\n\n\n# hashset ç¹ç¹\n\n * éçº¿ç¨å®å¨\n * åè®¸ null å¼\n * æ·»å å¼å¾æ¶åä¼åè·åå¯¹è±¡ç hashcode æ¹æ³ï¼å¦æ hashcode æ¹æ³è¿åçå¼ä¸è´ï¼ååè°ç¨ equals æ¹æ³å¤æ­æ¯å¦ä¸è´ï¼å¦æä¸ä¸è´æ add åç´ ã\n\n\n# è§£æ\n\nadd()\n\nhashset éé¢ç add æ¹æ³ä½¿ç¨çå°±æ¯ hashmap ç put æ¹æ³ï¼map.put(e,present)==null; å°è¦å­å¥çéååç´ ä½ä¸ºé®ï¼ç¶åæ present è¿ä¸ªèæå¯¹è±¡ä½ä¸ºå¼ï¼èè¿ä¸ªå¼æ¯ä¸ä¸ªåºå®å¸¸éã\n\næ¥é\n\nhashset æ¥éçè¯ï¼åºè¯¥å°±æ¯å©ç¨å°äº hashmap çé®å¯ä¸æ§æ¥å»éï¼æ°çåç´ ä¼è¦çææ§çåç´ ï¼== å·çå¤æ­ç»ææ¥ç¡®å®æ¯å¦åå«è¦æ·»å çåç´ ï¼ä¸åå«å°±æ·»å åç´ å¹¶è¿å trueï¼åå«å°±å¿½ç¥æ­¤æ·»å æä½å¹¶è¿å falseï¼ä»èä¿è¯äº hashset ä¸­åç´ çå¯ä¸æ§ã\n\n\n# hashset çå®ç°\n\nhashset å®éä¸æ¯åºäº hashmap å®ç°çï¼å®åªä½¿ç¨äº hashmap çé®æ¥å­å¨æ°æ®ãå¨ hashset ä¸­ï¼åç´ è¢«å­å¨ä¸º hashmap çé®ï¼èå¼é½æ¯åºå®çä¸ä¸ªå¸¸éå¯¹è±¡ã\n\nå æ­¤ï¼å½æä»¬å hashset æ·»å åç´ æ¶ï¼å®éä¸æ¯å°è¿ä¸ªåç´ ä½ä¸ºé®ï¼å¸¸éå¯¹è±¡ä½ä¸ºå¯¹åºçå¼å­å¨å¨ hashmap ä¸­ã\n\nå¨ hashset ä¸­ï¼å¯ä¸æ§æ¯éè¿ hashmap ä¸­é®çå¯ä¸æ§ä¿è¯çï¼å ä¸º hashmap çé®æ¯å¯ä¸çãå½æä»¬ä½¿ç¨ hashset æ¥å­å¨åç´ æ¶ï¼å®éä¸æ¯å¨å©ç¨ hashmap çå»éç¹æ§æ¥ä¿è¯ hashset ä¸­çåç´ å¯ä¸æ§ã\n\n\n# åè\n\nhttps://blog.csdn.net/fighterandknight/article/details/66585997',charsets:{cjk:!0}},{title:"Mapæ¥å£",frontmatter:{title:"Mapæ¥å£",date:"2023-08-10T14:51:12.000Z",permalink:"/pages/4c1680/",author:{name:"éä¸æ¸é£",link:"https://github.com/msqfx"},categories:["java","éåç¯"],tags:[null],description:"çº¿ç¨å®å¨æ§ï¼",comment:!0,meta:[{name:"image",content:"https://cmty256.github.io/imgs-blog/images/image-20230412165201719.2bc46rnd9474.jpg"},{name:"twitter:title",content:"Mapæ¥å£"},{name:"twitter:description",content:"çº¿ç¨å®å¨æ§ï¼"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://cmty256.github.io/imgs-blog/images/image-20230412165201719.2bc46rnd9474.jpg"},{name:"twitter:url",content:"https://www.msqfx.cc/01.java/02.%E9%9B%86%E5%90%88%E7%AF%87/05.Map%E6%8E%A5%E5%8F%A3.html"},{property:"og:type",content:"article"},{property:"og:title",content:"Mapæ¥å£"},{property:"og:description",content:"çº¿ç¨å®å¨æ§ï¼"},{property:"og:image",content:"https://cmty256.github.io/imgs-blog/images/image-20230412165201719.2bc46rnd9474.jpg"},{property:"og:url",content:"https://www.msqfx.cc/01.java/02.%E9%9B%86%E5%90%88%E7%AF%87/05.Map%E6%8E%A5%E5%8F%A3.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-08-10T14:51:12.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"Mapæ¥å£"},{itemprop:"description",content:"çº¿ç¨å®å¨æ§ï¼"},{itemprop:"image",content:"https://cmty256.github.io/imgs-blog/images/image-20230412165201719.2bc46rnd9474.jpg"}],readingShow:"top"},regularPath:"/01.java/02.%E9%9B%86%E5%90%88%E7%AF%87/05.Map%E6%8E%A5%E5%8F%A3.html",relativePath:"01.java/02.éåç¯/05.Mapæ¥å£.md",key:"v-f9a862c8",path:"/pages/4c1680/",headers:[{level:2,title:"HashMap å Hashtable çåºå«",slug:"hashmap-å-hashtable-çåºå«",normalizedTitle:"hashmap å hashtable çåºå«",charIndex:15},{level:2,title:"HashMap å HashSet åºå«",slug:"hashmap-å-hashset-åºå«",normalizedTitle:"hashmap å hashset åºå«",charIndex:888},{level:2,title:"hashCode æºç ",slug:"hashcode-æºç ",normalizedTitle:"hashcode æºç ",charIndex:1577},{level:2,title:"ä¸ºä»ä¹åå¸å½æ°è½éä½åå¸ç¢°æï¼",slug:"ä¸ºä»ä¹åå¸å½æ°è½éä½åå¸ç¢°æ",normalizedTitle:"ä¸ºä»ä¹åå¸å½æ°è½éä½åå¸ç¢°æï¼",charIndex:2178},{level:2,title:"HashMap å TreeMap åºå«",slug:"hashmap-å-treemap-åºå«",normalizedTitle:"hashmap å treemap åºå«",charIndex:2261},{level:2,title:"HashSet å¦ä½æ£æ¥éå¤?",slug:"hashset-å¦ä½æ£æ¥éå¤",normalizedTitle:"hashset å¦ä½æ£æ¥éå¤?",charIndex:3784},{level:2,title:"HashMapçåºå±å®ç°",slug:"hashmapçåºå±å®ç°",normalizedTitle:"hashmapçåºå±å®ç°",charIndex:4881},{level:3,title:"JDK1.8 ä¹å",slug:"jdk1-8-ä¹å",normalizedTitle:"jdk1.8 ä¹å",charIndex:4898},{level:3,title:"JDK1.8 ä¹å",slug:"jdk1-8-ä¹å",normalizedTitle:"jdk1.8 ä¹å",charIndex:5139},{level:3,title:"JDK1.7åJDK1.8çhashæ¹æ³æºç å¯¹æ¯ï¼",slug:"jdk1-7åjdk1-8çhashæ¹æ³æºç å¯¹æ¯",normalizedTitle:"jdk1.7åjdk1.8çhashæ¹æ³æºç å¯¹æ¯ï¼",charIndex:5373},{level:2,title:"HashMap çé¿åº¦ä¸ºä»ä¹æ¯ 2 çå¹æ¬¡æ¹",slug:"hashmap-çé¿åº¦ä¸ºä»ä¹æ¯-2-çå¹æ¬¡æ¹",normalizedTitle:"hashmap çé¿åº¦ä¸ºä»ä¹æ¯ 2 çå¹æ¬¡æ¹",charIndex:5533},{level:2,title:"HashMap å¤çº¿ç¨æä½å¯¼è´æ­»å¾ªç¯é®é¢",slug:"hashmap-å¤çº¿ç¨æä½å¯¼è´æ­»å¾ªç¯é®é¢",normalizedTitle:"hashmap å¤çº¿ç¨æä½å¯¼è´æ­»å¾ªç¯é®é¢",charIndex:6012},{level:2,title:"HashMap æåªå ç§å¸¸è§çéåæ¹å¼?",slug:"hashmap-æåªå ç§å¸¸è§çéåæ¹å¼",normalizedTitle:"hashmap æåªå ç§å¸¸è§çéåæ¹å¼?",charIndex:6608},{level:2,title:"ConcurrentHashMap å Hashtable çåºå«",slug:"concurrenthashmap-å-hashtable-çåºå«",normalizedTitle:"concurrenthashmap å hashtable çåºå«",charIndex:6658},{level:2,title:"ConcurrentHashMap çº¿ç¨å®å¨åºå±å·ä½å®ç°",slug:"concurrenthashmap-çº¿ç¨å®å¨åºå±å·ä½å®ç°",normalizedTitle:"concurrenthashmap çº¿ç¨å®å¨åºå±å·ä½å®ç°",charIndex:7815},{level:3,title:"JDK1.8 ä¹å",slug:"jdk1-8-ä¹å-2",normalizedTitle:"jdk1.8 ä¹å",charIndex:4898},{level:3,title:"JDK1.8 ä¹å",slug:"jdk1-8-ä¹å-2",normalizedTitle:"jdk1.8 ä¹å",charIndex:5139},{level:3,title:"éç²åº¦è§£æ",slug:"éç²åº¦è§£æ",normalizedTitle:"éç²åº¦è§£æ",charIndex:8681},{level:2,title:"JDK 1.7 å JDK 1.8 ç ConcurrentHashMap å®ç°æä»ä¹ä¸åï¼",slug:"jdk-1-7-å-jdk-1-8-ç-concurrenthashmap-å®ç°æä»ä¹ä¸å",normalizedTitle:"jdk 1.7 å jdk 1.8 ç concurrenthashmap å®ç°æä»ä¹ä¸åï¼",charIndex:9001},{level:3,title:"ä¸ºä»ä¹ HashMap é¾è¡¨è½¬çº¢é»æ çéå¼ä¸º 8 å¢ï¼",slug:"ä¸ºä»ä¹-hashmap-é¾è¡¨è½¬çº¢é»æ çéå¼ä¸º-8-å¢",normalizedTitle:"ä¸ºä»ä¹ hashmap é¾è¡¨è½¬çº¢é»æ çéå¼ä¸º 8 å¢ï¼",charIndex:9389},{level:2,title:"HashMap çæ©å®¹æºå¶äºè§£åï¼",slug:"hashmap-çæ©å®¹æºå¶äºè§£å",normalizedTitle:"hashmap çæ©å®¹æºå¶äºè§£åï¼",charIndex:9579},{level:3,title:"æ©å®¹å¨ä»ä¹æ¶åå¢ï¼ä¸ºä»ä¹æ©å®¹å å­æ¯ 0.75ï¼",slug:"æ©å®¹å¨ä»ä¹æ¶åå¢-ä¸ºä»ä¹æ©å®¹å å­æ¯-0-75",normalizedTitle:"æ©å®¹å¨ä»ä¹æ¶åå¢ï¼ä¸ºä»ä¹æ©å®¹å å­æ¯ 0.75ï¼",charIndex:9986},{level:3,title:"ä¸ºä»ä¹æ¯ 2 åï¼",slug:"ä¸ºä»ä¹æ¯-2-å",normalizedTitle:"ä¸ºä»ä¹æ¯ 2 åï¼",charIndex:10289}],headersStr:"HashMap å Hashtable çåºå« HashMap å HashSet åºå« hashCode æºç  ä¸ºä»ä¹åå¸å½æ°è½éä½åå¸ç¢°æï¼ HashMap å TreeMap åºå« HashSet å¦ä½æ£æ¥éå¤? HashMapçåºå±å®ç° JDK1.8 ä¹å JDK1.8 ä¹å JDK1.7åJDK1.8çhashæ¹æ³æºç å¯¹æ¯ï¼ HashMap çé¿åº¦ä¸ºä»ä¹æ¯ 2 çå¹æ¬¡æ¹ HashMap å¤çº¿ç¨æä½å¯¼è´æ­»å¾ªç¯é®é¢ HashMap æåªå ç§å¸¸è§çéåæ¹å¼? ConcurrentHashMap å Hashtable çåºå« ConcurrentHashMap çº¿ç¨å®å¨åºå±å·ä½å®ç° JDK1.8 ä¹å JDK1.8 ä¹å éç²åº¦è§£æ JDK 1.7 å JDK 1.8 ç ConcurrentHashMap å®ç°æä»ä¹ä¸åï¼ ä¸ºä»ä¹ HashMap é¾è¡¨è½¬çº¢é»æ çéå¼ä¸º 8 å¢ï¼ HashMap çæ©å®¹æºå¶äºè§£åï¼ æ©å®¹å¨ä»ä¹æ¶åå¢ï¼ä¸ºä»ä¹æ©å®¹å å­æ¯ 0.75ï¼ ä¸ºä»ä¹æ¯ 2 åï¼",content:'# Map éåè¯¦è§£\n\n\n# HashMap å Hashtable çåºå«\n\nçº¿ç¨å®å¨æ§ï¼\n\nHashMap æ¯éçº¿ç¨å®å¨çï¼Hashtable æ¯çº¿ç¨å®å¨ç,å ä¸º Hashtable åé¨çæ¹æ³åºæ¬é½ç»è¿synchronized ä¿®é¥°ãï¼å¦æä½ è¦ä¿è¯çº¿ç¨å®å¨çè¯å°±ä½¿ç¨ ConcurrentHashMap å§ï¼ï¼ï¼\n\næçï¼\n\nå ä¸ºçº¿ç¨å®å¨çé®é¢ï¼HashMap è¦æ¯ Hashtable æçé«ä¸ç¹ãå¦å¤ï¼Hashtable åºæ¬è¢«æ·æ±°ï¼ä¸è¦å¨ä»£ç ä¸­ä½¿ç¨å®ï¼\n\nå¯¹ null é® å null å¼ çæ¯æï¼\n\nHashMap å¯ä»¥å­å¨ null ç key å valueï¼ä½ null ä½ä¸ºé®åªè½æä¸ä¸ªï¼null ä½ä¸ºå¼å¯ä»¥æå¤ä¸ªï¼Hashtable ä¸åè®¸æ null é®å null å¼ï¼å¦åä¼æåº NullPointerExceptionã\n\nåå§å®¹éå¤§å°åæ¯æ¬¡æ©åå®¹éå¤§å°çä¸å ï¼\n\nâ  åå»ºæ¶å¦æä¸æå®å®¹éåå§å¼ï¼Hashtable é»è®¤çåå§å¤§å°ä¸º 11ï¼ä¹åæ¯æ¬¡æ©åï¼å®¹éåä¸ºåæ¥ç 2n+1ãHashMap é»è®¤çåå§åå¤§å°ä¸º 16ãä¹åæ¯æ¬¡æ©åï¼å®¹éåä¸ºåæ¥ç 2 åã\n\nâ¡ åå»ºæ¶å¦æç»å®äºå®¹éåå§å¼ï¼é£ä¹ Hashtable ä¼ç´æ¥ä½¿ç¨ä½ ç»å®çå¤§å°ï¼è HashMap ä¼å°å¶æ©åä¸º 2 çå¹æ¬¡æ¹å¤§å°ï¼HashMap ä¸­çtableSizeFor()æ¹æ³ä¿è¯ï¼å©ç¨å³ä½ç§»è¿ç®ï¼ãä¹å°±æ¯è¯´ HashMap æ»æ¯ä½¿ç¨ 2 çå¹ä½ä¸ºåå¸è¡¨çå¤§å°,åé¢ä¼ä»ç»å°ä¸ºä»ä¹æ¯ 2 çå¹æ¬¡æ¹ã\n\nåºå±æ°æ®ç»æï¼\n\n * JDK1.8 ä»¥åç HashMap å¨è§£å³åå¸å²çªæ¶æäºè¾å¤§çååï¼å½é¾è¡¨é¿åº¦å¤§äºéå¼ï¼é»è®¤ä¸º 8ï¼æ¶ï¼å°é¾è¡¨è½¬åä¸ºçº¢é»æ ï¼å°é¾è¡¨è½¬æ¢æçº¢é»æ åä¼å¤æ­ï¼å¦æå½åæ°ç»çé¿åº¦å°äº 64ï¼é£ä¹ä¼éæ©åè¿è¡æ°ç»æ©å®¹ï¼èä¸æ¯è½¬æ¢ä¸ºçº¢é»æ ï¼ï¼ä»¥åå°æç´¢æ¶é´ï¼åæä¸­æä¼ç»åæºç å¯¹è¿ä¸è¿ç¨è¿è¡åæï¼ã\n   \n   > æ¡¶æ°ç»æ¯ç¨æ¥å­å¨æ°æ®åç´ ï¼é¾è¡¨æ¯ç¨æ¥è§£å³å²çªï¼çº¢é»æ æ¯ä¸ºäºæé«æ¥è¯¢çæçã\n\n * Hashtable æ²¡æè¿æ ·çæºå¶ã\n\n\n# HashMap å HashSet åºå«\n\n\n\nç¨éï¼\n\n * HashMapï¼ç¨äºå­å¨é®å¼å¯¹ï¼Key-Valueï¼æ å°å³ç³»çæ°æ®ç»æï¼å¶ä¸­æ¯ä¸ªé®å¯ä¸å¯¹åºä¸ä¸ªå¼ã\n * HashSetï¼ç¨äºå­å¨ä¸éå¤åç´ çéåï¼å®åºäº HashMap å®ç°ï¼åªå­å¨åç´ èæ²¡æé®å¼å¯¹çæ å°å³ç³»ã\n\nå­å¨æ¹å¼ï¼\n\n * HashMapï¼å­å¨é®å¼å¯¹ï¼éè¿é®æ¥æ¾å¼ãé®å¯ä»¥æ¯ä»»ä½éç©ºå¯¹è±¡ï¼å¼å¯ä»¥æ¯ä»»ä½å¯¹è±¡ã\n * HashSetï¼å­å¨ä¸éå¤çåç´ ï¼éè¿åç´ æ¬èº«æ¥è¿è¡æ¥æ¾åå¤éã\n\nåé¨å®ç°ï¼\n\n * HashMapï¼åé¨ä½¿ç¨æ°ç»åé¾è¡¨ï¼æçº¢é»æ ï¼çç»åæ¥å®ç°ï¼éè¿åå¸å½æ°å°é®æ å°å°æ°ç»çç´¢å¼ä½ç½®ï¼ä»¥æé«é®çæ¥æ¾æçã\n * HashSetï¼åºäº HashMap å®ç°ï¼å®çåç´ å°±æ¯ HashMap çé®ï¼å¼åæ¯ä¸ä¸ªåºå®çå¸¸éï¼ä¸ç´æ¯ä¸ä¸ª Object å¯¹è±¡ï¼ã\n\næä½åç¨æ³ï¼\n\n * HashMapï¼éç¨äºéè¦å­å¨é®å¼å¯¹å³ç³»çæåµï¼ä¾å¦ç¼å­ãæ å°å³ç³»ç­ã\n * HashSetï¼éç¨äºå­å¨ä¸éå¤åç´ çæåµï¼ä¾å¦éè¦å¿«éå¤æ­æä¸ªåç´ æ¯å¦å­å¨ç­ã\n\næ§è½ï¼\n\n * HashMapï¼ç¸å¯¹äº HashSetï¼HashMap éè¦å­å¨é®å¼å¯¹ï¼å æ­¤é¢å¤å ç¨ä¸äºåå­ï¼ä½å¯ä»¥å­å¨æ´å¤çä¿¡æ¯ã\n * HashSetï¼ç¸å¯¹äº HashMapï¼HashSet åªéè¦å­å¨åç´ ï¼å ç¨çåå­è¾å°ï¼ä½ä¸è½å­å¨é®å¼å¯¹å³ç³»ã\n\næ»ä¹ï¼HashMap éç¨äºå­å¨é®å¼å¯¹å³ç³»ï¼è HashSet éç¨äºå­å¨ä¸éå¤åç´ çéåãå®éä¸ï¼HashSet å¨åé¨ä½¿ç¨äº HashMap æ¥å®ç°ï¼å®ä»¬ä¹é´å­å¨ä¸å®çå³èåç¸ä¼¼æ§ã\n\n\n# hashCode æºç \n\nhashCode() æ¹æ³è¿åçå¼æ¯ä¸ä¸ª int ç±»åçæ°å­ï¼ç¨äºè¡¨ç¤ºå¯¹è±¡çåå¸å¼ãè¿ä¸ªåå¸å¼ä¸ä¸å®æ¯å¯¹è±¡çå°åï¼ä¹ä¸ä¸å®æ¯å¯ä¸çãå¨è®¡ç®åå¸å¼æ¶ï¼ä¸è¬ä¼ä½¿ç¨å¯¹è±¡çå±æ§æ¥è®¡ç®ãä¾å¦ï¼å¦æä¸ä¸ª Person ç±»å·æ name å age ä¸¤ä¸ªå±æ§ï¼é£ä¹å¯ä»¥å°å®ä»¬çåå¸å¼åå¹¶èµ·æ¥è®¡ç®ï¼\n\npublic int hashCode() {\n    int result = 17;\n    result = 31 * result + name.hashCode();\n    result = 31 * result + age;\n    return result;\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nè¿æ®µä»£ç ä¸­ä½¿ç¨äºä¸ä¸ªç»å¸çåå¸ç®æ³ï¼ç§°ä¸ºâ31 åå¸æ³âãè¿ä¸ªç®æ³å°åå§å¼è®¾ä¸ºä¸ä¸ªè´¨æ° 17ï¼ç¶åå°å±æ§çåå¸å¼ä¾æ¬¡ä¹ä»¥ 31 å¹¶ç¸å ï¼å¾å°æç»çåå¸å¼ãç±äº 31 æ¯ä¸ä¸ªå¥ç´ æ°ï¼å¯ä»¥ä¿è¯ä¹æ³è¿ç¨ä¸ä¼äº§çåå¸å²çªã\n\n> éè¦æ³¨æçæ¯ï¼è½ç¶åå¸å¼ä¸ä¸å®æ¯å°åï¼ä½æ¯å¨ Java ä¸­ï¼å¦ææ²¡æä¸ºå¯¹è±¡æå® hashCode() æ¹æ³çå®ç°ï¼é£ä¹é»è®¤æåµä¸ï¼å®ç hashCode() æ¹æ³ä¼è¿åå¯¹è±¡çå°åï¼å æ­¤å¨è¿ç§æåµä¸ï¼ä¸¤ä¸ªå¯¹è±¡çåå¸å¼å¯è½ä¼ç¸åï¼ä½è¿å¹¶ä¸æ¯ä¸ä¸ªå¥½çåå¸ç®æ³ãå æ­¤ï¼å¨å®ç°èªå®ä¹çåå¸ç®æ³æ¶ï¼éè¦ä¿è¯åå¸å¼çåå¸å°½å¯è½ååï¼å¹¶ä¸ä¸å®¹æäº§çåå¸å²çªã\n\n\n# ä¸ºä»ä¹åå¸å½æ°è½éä½åå¸ç¢°æï¼\n\nå ä¸ºå¥½çåå¸å½æ°å¯ä»¥å°è¾å¥çæ°æ®ååãéæºå°æ å°å°åå¸ç©ºé´ï¼éä½äºç¢°æçå¯è½æ§ï¼ä»èæé«äºåå¸è¡¨ç­æ°æ®ç»æçæ§è½åç¨³å®æ§ã\n\n\n# HashMap å TreeMap åºå«\n\nTreeMap åHashMap é½ç»§æ¿èªAbstractMap ï¼ä½æ¯éè¦æ³¨æçæ¯TreeMapå®è¿å®ç°äºNavigableMapæ¥å£åSortedMap æ¥å£ã\n\n\n\nå®ç° NavigableMap æ¥å£è®© TreeMap æäºå¯¹éåååç´ çæç´¢çè½åã\n\nå®ç°SortedMapæ¥å£è®© TreeMap æäºå¯¹éåä¸­çåç´ æ ¹æ®é®æåºçè½åãé»è®¤æ¯æ key çååºæåºï¼ä¸è¿æä»¬ä¹å¯ä»¥æå®æåºçæ¯è¾å¨ãç¤ºä¾ä»£ç å¦ä¸ï¼\n\npublic class Person {\n    private Integer age;\n    public Person(Integer age) {\n        this.age = age;\n    }\n    public Integer getAge() {\n        return age;\n    }\n\n    public static void main(String[] args) {\n        TreeMap<Person, String> treeMap = new TreeMap<>(new Comparator<Person>() {\n            @Override\n            public int compare(Person person1, Person person2) {\n                int num = person1.getAge() - person2.getAge();\n                return Integer.compare(num, 0);\n            }\n        });\n        treeMap.put(new Person(3), "person1");\n        treeMap.put(new Person(18), "person2");\n        treeMap.put(new Person(35), "person3");\n        treeMap.put(new Person(16), "person4");\n        treeMap.entrySet().stream().forEach(personStringEntry -> {\n            System.out.println(personStringEntry.getValue());\n        });\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\nå¯ä»¥çåºï¼TreeMap ä¸­çåç´ å·²ç»æ¯æç§ Person ç age å­æ®µçååºæ¥æåäºã\n\nä¸é¢ï¼æä»¬æ¯éè¿ä¼ å¥å¿ååé¨ç±»çæ¹å¼å®ç°çï¼ä½ å¯ä»¥å°ä»£ç æ¿æ¢æ Lambda è¡¨è¾¾å¼å®ç°çæ¹å¼ï¼\n\nTreeMap<Person, String> treeMap = new TreeMap<>((person1, person2) -> {\n  int num = person1.getAge() - person2.getAge();\n  return Integer.compare(num, 0);\n});\n\n\n1\n2\n3\n4\n\n\nç»¼ä¸ï¼ç¸æ¯äºHashMapæ¥è¯´ TreeMap ä¸»è¦å¤äºå¯¹éåä¸­çåç´ æ ¹æ®é®æåºçè½åï¼SortedMapï¼ä»¥åå¯¹éåååç´ çæç´¢çè½åï¼NavigableMapï¼ã\n\n\n# HashSet å¦ä½æ£æ¥éå¤?\n\n> å½ä½ æå¯¹è±¡å å¥HashSetæ¶ï¼HashSet ä¼åè®¡ç®å¯¹è±¡çhashcodeå¼æ¥å¤æ­å¯¹è±¡å å¥çä½ç½®ï¼åæ¶ä¹ä¼ä¸å¶ä»å å¥çå¯¹è±¡ç hashcode å¼ä½æ¯è¾ï¼å¦ææ²¡æç¸ç¬¦ç hashcodeï¼HashSet ä¼åè®¾å¯¹è±¡æ²¡æéå¤åºç°ãä½æ¯å¦æåç°æç¸å hashcode å¼çå¯¹è±¡ï¼è¿æ¶ä¼è°ç¨equals()æ¹æ³æ¥æ£æ¥ hashcode ç¸ç­çå¯¹è±¡æ¯å¦ççç¸åãå¦æä¸¤èç¸åï¼HashSet å°±ä¸ä¼è®©å å¥æä½æåã\n\nç´æ¥çä¸ä¸HashSetä¸­çæºç ï¼\n\nå¨ JDK1.8 ä¸­ï¼å®éä¸æ è®º HashSet ä¸­æ¯å¦å·²ç»å­å¨äºæåç´ ï¼HashSet é½ä¼ç´æ¥æå¥ï¼åªæ¯ä¼å¨ add() æ¹æ³çè¿åå¼å¤åè¯æä»¬æå¥åæ¯å¦å­å¨ç¸ååç´ \n\n// Returns: true if this set did not already contain the specified element\n// è¿åå¼ï¼å½ set ä¸­æ²¡æåå« add çåç´ æ¶è¿åç\npublic boolean add(E e) {\n        return map.put(e, PRESENT)==null;\n}\n\n\n1\n2\n3\n4\n5\n\n\nHashSet éè¿ HashMap çé®çå¯ä¸æ§æ¥å®ç°å¯¹åç´ çéå¤æ£æ¥ãå¨ HashSet ä¸­ï¼åç´ è¢«å­å¨ä¸º HashMap çé®ï¼èå¼é½æ¯åºå®çä¸ä¸ªå¸¸éå¯¹è±¡ãå½æä»¬å HashSet æ·»å åç´ æ¶ï¼å®éä¸æ¯å°è¿ä¸ªåç´ ä½ä¸ºé®ï¼å¸¸éå¯¹è±¡ä½ä¸ºå¯¹åºçå¼å­å¨å¨ HashMap ä¸­ã\n\nå¨ HashMap ä¸­ï¼é®æ¯å¯ä¸çï¼è¿æå³çå½æä»¬å°è¯å°ç¸åçåç´ ä½ä¸ºé®æ·»å å° HashMap ä¸­æ¶ï¼æ°çåç´ ä¼è¦çææ§çåç´ ãå æ­¤ï¼å½æä»¬å HashSet æ·»å åç´ æ¶ï¼å®éä¸æ¯å¨å©ç¨ HashMap çå»éç¹æ§æ¥ä¿è¯ HashSet ä¸­çåç´ å¯ä¸æ§ã\n\nä¾å¦ï¼èèä»¥ä¸ä»£ç ï¼\n\nHashSet<Integer> set = new HashSet<>();\nset.add(1);\nset.add(2);\nset.add(3);\nset.add(1);  // å°è¯æ·»å éå¤åç´ \nSystem.out.println(set.size());  // è¾åºä¸º 3ï¼å ä¸ºéå¤åç´ è¢«å»é\n\n\n1\n2\n3\n4\n5\n6\n\n\nå¨ä¸è¿°ç¤ºä¾ä¸­ï¼å°è¯å HashSet ä¸­æ·»å éå¤çåç´  1 æ¶ï¼å¹¶æ²¡æå¯¼è´ HashSet ä¸­åºç°éå¤åç´ ï¼è¿æ¯å ä¸º HashSet å©ç¨äº HashMap çé®å¯ä¸æ§æ¥è¿è¡å»éã\n\nå æ­¤ï¼HashSet è½å¤èªå¨æ£æ¥å¹¶é²æ­¢éå¤åç´ çå­å¨ã\n\n\n# HashMapçåºå±å®ç°\n\n\n# JDK1.8 ä¹å\n\nJDK1.8 ä¹å HashMap åºå±æ¯ æ°ç»åé¾è¡¨ ç»åå¨ä¸èµ·ä½¿ç¨ä¹å°±æ¯ é¾è¡¨æ£åãHashMap éè¿ key ç hashcode ç»è¿æ°å¨å½æ°ï¼hashæ¹æ³ï¼å¤çè¿åå¾å° hash å¼ï¼ç¶åéè¿ (n - 1) & hash å¤æ­å½ååç´ å­æ¾çä½ç½®ï¼è¿éç n æçæ¯æ°ç»çé¿åº¦ï¼ï¼å¦æå½åä½ç½®å­å¨åç´ çè¯ï¼å°±å¤æ­è¯¥åç´ ä¸è¦å­å¥çåç´ ç hash å¼ä»¥å key æ¯å¦ç¸åï¼å¦æç¸åçè¯ï¼ç´æ¥è¦çï¼ä¸ç¸åå°±éè¿æé¾æ³ï¼æ°ç»+é¾è¡¨ï¼è§£å³å²çªã\n\n\n# JDK1.8 ä¹å\n\nç¸æ¯äºä¹åççæ¬ï¼ JDK1.8 ä¹åå¨è§£å³åå¸å²çªæ¶æäºè¾å¤§çååï¼å½é¾è¡¨é¿åº¦å¤§äºéå¼ï¼é»è®¤ä¸º 8ï¼ï¼å°é¾è¡¨è½¬æ¢æçº¢é»æ åä¼å¤æ­ï¼å¦æå½åæ°ç»çé¿åº¦å°äº 64ï¼é£ä¹ä¼éæ©åè¿è¡æ°ç»æ©å®¹ï¼èä¸æ¯è½¬æ¢ä¸ºçº¢é»æ ï¼æ¶ï¼å°é¾è¡¨è½¬åä¸ºçº¢é»æ ï¼ä»¥åå°æç´¢æ¶é´ã\n\n> TreeMapãTreeSet ä»¥å JDK1.8 ä¹åç HashMap åºå±é½ç¨å°äºçº¢é»æ ãçº¢é»æ å°±æ¯ä¸ºäºè§£å³äºåæ¥æ¾æ çç¼ºé·ï¼å ä¸ºäºåæ¥æ¾æ å¨æäºæåµä¸ä¼éåæä¸ä¸ªçº¿æ§ç»æã\n\n\n# JDK1.7åJDK1.8çhashæ¹æ³æºç å¯¹æ¯ï¼\n\n 1. JDK 1.8 ç hash æ¹æ³ ï¼è¿ç¨äºä¸ç®è¿ç®ç¬¦ï¼ç¸æ¯äº JDK 1.7 hash æ¹æ³æ´å ç®åï¼ä½æ¯åçä¸åï¼\n 2. JDK 1.7 ç hash æ¹æ³çæ§è½ä¼ç¨å·®ä¸ç¹ç¹ï¼å ä¸ºæ°å¨äº 4 æ¬¡\n\nä½¿ç¨æ°å¨å½æ°ï¼hashæ¹æ³ï¼ä¹åå¯ä»¥åå°ç¢°æ\n\n\n# HashMap çé¿åº¦ä¸ºä»ä¹æ¯ 2 çå¹æ¬¡æ¹\n\nè¿æ¯å ä¸º HashMap å¨è®¡ç® key çåå¸å¼åï¼éè¦éè¿åå¸å¼åæ°ç»é¿åº¦è®¡ç®åºè¯¥ key å¨æ°ç»ä¸­çä½ç½®ã\n\nå·ä½çè®¡ç®æ¹å¼æ¯ (n - 1) & hashï¼æ°ç»çé¿åº¦åä¸çå·®å key çåå¸å¼ç¸ä¸ï¼ï¼å¶ä¸­ n æ¯æ°ç»çé¿åº¦ï¼hash æ¯ key çåå¸å¼ã\n\nè¿ä¸ªè®¡ç®æ¹å¼çä½ç¨æ¯å°åå¸å¼çé«ä½åä½ä½è¿è¡ä¸æ¬¡å¼æè¿ç®ï¼å¾å° key å¨æ°ç»ä¸­çä½ç½®ã å¦ææ°ç»çé¿åº¦ä¸æ¯ 2 çå¹æ¬¡æ¹ï¼é£ä¹å¨è®¡ç® (n - 1) & hash æ¶ï¼å¾å°çç»æå¯è½ä¼å­å¨ä¸äºåå¸å¼æ æ³åååå¸å°æ°ç»ä¸­çä½ç½®çæåµï¼ä»èå¯¼è´æäºä½ç½®ä¸çé¾è¡¨æçº¢é»æ ä¼åå¾è¿é¿ï¼å½±å HashMap çæ§è½ãå æ­¤ï¼ä¸ºäºé¿åè¿ç§æåµçåçï¼HashMap çé¿åº¦æ»æ¯ä¿æä¸º 2 çå¹æ¬¡æ¹ã å¦å¤ï¼å¯¹äºé¿åº¦ä¸º 2 çå¹æ¬¡æ¹çæ°ç»ï¼è®¡ç® (n - 1) & hash æ¶ï¼ç­ä»·äºå¯¹æ°ç»é¿åº¦åæ¨¡ï¼è¿ç§è®¡ç®æ¹å¼çæçæ¯è¾é«ï¼èä¸å¯ä»¥ä¿è¯åååå¸ãå æ­¤ï¼HashMap éç¨é¿åº¦ä¸º 2 çå¹æ¬¡æ¹çæ°ç»ï¼å¯ä»¥æé« HashMap çæ§è½åæçã\n\n\n# HashMap å¤çº¿ç¨æä½å¯¼è´æ­»å¾ªç¯é®é¢\n\nå¨å¤çº¿ç¨ç¯å¢ä¸ï¼å¦æå¤ä¸ªçº¿ç¨åæ¶å¯¹ HashMap è¿è¡æä½ï¼å¯è½ä¼å¯¼è´ HashMap çé¾è¡¨æçº¢é»æ åºç°ç¯å½¢ï¼ä»èå¯¼è´æ­»å¾ªç¯é®é¢ãè¿ç§é®é¢éå¸¸åçå¨ä»¥ä¸æåµä¸ï¼\n\n 1. å¤ä¸ªçº¿ç¨åæ¶è°ç¨ put() æ¹æ³ï¼å¯¼è´é¾è¡¨æçº¢é»æ çç»æåçååï¼ä»èå¯¼è´é¾è¡¨æçº¢é»æ åºç°ç¯å½¢ã\n 2. å¤ä¸ªçº¿ç¨åæ¶è°ç¨ resize() æ¹æ³ï¼å¯¼è´æ°ç»æ©å®¹æ¶é¾è¡¨æçº¢é»æ çç»æåçååï¼ä»èå¯¼è´é¾è¡¨æçº¢é»æ åºç°ç¯å½¢ã å½åºç°é¾è¡¨æçº¢é»æ ç¯å½¢æ¶ï¼ä¼å¯¼è´ HashMap çéåæä½è¿å¥æ­»å¾ªç¯ï¼ä»èå½±åç¨åºçæ§è½åå¯é æ§ã\n\nä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼å¯ä»¥éç¨ä»¥ä¸å ç§æ¹å¼ï¼\n\n 1. ä½¿ç¨çº¿ç¨å®å¨ç ConcurrentHashMapï¼å®æ¯çº¿ç¨å®å¨ç HashMapï¼å¯ä»¥å®å¨å°å¨å¤çº¿ç¨ç¯å¢ä¸è¿è¡æä½ã\n 2. å¯¹äºéè¦å¨å¤çº¿ç¨ç¯å¢ä¸ä½¿ç¨ HashMap çæåµï¼å¯ä»¥ä½¿ç¨éæ¥ä¿è¯åä¸æ¶é´åªæä¸ä¸ªçº¿ç¨è½å¤å¯¹ HashMap è¿è¡æä½ã\n 3. é¿åå¤ä¸ªçº¿ç¨åæ¶å¯¹ HashMap è¿è¡æä½ï¼å¯ä»¥å°å¯¹ HashMap çæä½æ¾å¨åæ­¥åä¸­ï¼ç¡®ä¿åä¸æ¶é´åªæä¸ä¸ªçº¿ç¨è½å¤å¯¹ HashMap è¿è¡ä¿®æ¹ã\n 4. éè¿ä½¿ç¨çº¿ç¨å®å¨çå¹¶åæ°æ®ç»æï¼ä¾å¦ ConcurrentLinkedQueueãConcurrentHashMap ç­ï¼é¿åå¨å¤çº¿ç¨ç¯å¢ä¸ä½¿ç¨ HashMapã\n\n\n# HashMap æåªå ç§å¸¸è§çéåæ¹å¼?\n\nHashMap ç 7 ç§éåæ¹å¼ä¸æ§è½åæï¼\n\n\n# ConcurrentHashMap å Hashtable çåºå«\n\nConcurrentHashMap å Hashtable é½æ¯çº¿ç¨å®å¨çéåç±»ï¼ä½æ¯å®ä»¬å¨å®ç°åæ§è½ä¸æä¸äºåºå«ï¼\n\n 1. åºå±æ°æ®ç»æï¼\n    * JDK1.7 ç ConcurrentHashMap åºå±éç¨ åæ®µçæ°ç»+é¾è¡¨ å®ç°ï¼JDK1.8 éç¨çæ°æ®ç»æè· HashMap1.8 çç»æä¸æ ·ï¼æ°ç»+é¾è¡¨/çº¢é»äºåæ ã\n    * Hashtable å JDK1.8 ä¹åç HashMap çåºå±æ°æ®ç»æç±»ä¼¼é½æ¯éç¨ æ°ç»+é¾è¡¨ çå½¢å¼ï¼æ°ç»æ¯ HashMap çä¸»ä½ï¼é¾è¡¨åæ¯ä¸»è¦ä¸ºäºè§£å³åå¸å²çªèå­å¨çï¼\n 2. å®ç°çº¿ç¨å®å¨çæ¹å¼ï¼éè¦ï¼ï¼\n\n * å¨ JDK1.7 çæ¶åï¼ConcurrentHashMap å¯¹æ´ä¸ªæ¡¶æ°ç»è¿è¡äºåå²åæ®µ(Segmentï¼åæ®µé)ï¼æ¯ä¸æéåªéå®¹å¨å¶ä¸­ä¸é¨åæ°æ®ï¼å¤çº¿ç¨è®¿é®å®¹å¨éä¸åæ°æ®æ®µçæ°æ®ï¼å°±ä¸ä¼å­å¨éç«äºï¼æé«å¹¶åè®¿é®çã\n * å°äº JDK1.8 çæ¶åï¼ConcurrentHashMap å·²ç»æå¼äº Segment çæ¦å¿µï¼èæ¯ç´æ¥ç¨ Node æ°ç»+é¾è¡¨ / çº¢é»æ çæ°æ®ç»ææ¥å®ç°ï¼å¹¶åæ§å¶ä½¿ç¨ synchronized å CAS æ¥æä½ãï¼JDK1.6 ä»¥å synchronized éåäºå¾å¤ä¼åï¼ æ´ä¸ªçèµ·æ¥å°±åæ¯ä¼åè¿ä¸çº¿ç¨å®å¨ç HashMapï¼è½ç¶å¨ JDK1.8 ä¸­è¿è½çå° Segment çæ°æ®ç»æï¼ä½æ¯å·²ç»ç®åäºå±æ§ï¼åªæ¯ä¸ºäºå¼å®¹æ§çæ¬ï¼\n * Hashtable(åä¸æé): ä½¿ç¨ synchronized æ¥ä¿è¯çº¿ç¨å®å¨ï¼æçéå¸¸ä½ä¸ãå½ä¸ä¸ªçº¿ç¨è®¿é®åæ­¥æ¹æ³æ¶ï¼å¶ä»çº¿ç¨ä¹è®¿é®åæ­¥æ¹æ³ï¼å¯è½ä¼è¿å¥é»å¡æè½®è¯¢ç¶æï¼å¦ä½¿ç¨ put æ·»å åç´ ï¼å¦ä¸ä¸ªçº¿ç¨ä¸è½ä½¿ç¨ put æ·»å åç´ ï¼ä¹ä¸è½ä½¿ç¨ getï¼ç«äºä¼è¶æ¥è¶æ¿çæçè¶ä½ã\n\n 3. å¯¹ null å¼çæ¯æä¸åï¼\n    \n    * Hashtable ä¸åè®¸ key ä¸º nullï¼\n    * è ConcurrentHashMap å**ï¼ JDK7 æ¶ï¼**åè®¸ key å value åä¸º nullï¼JDK8 åä¸ååè®¸ï¼å ä¸ºä½¿ç¨äº CAS -- ä¿è¯çº¿ç¨å®å¨çï¼å¯¹ null å¼çæ¯æåçäºååï¼ã\n\n 4. æ©å®¹æºå¶ä¸åï¼Hashtable å¨æ©å®¹æ¶ä½¿ç¨çæ¯åæ¥å®¹éç 2 åå  1ï¼è ConcurrentHashMap å¨æ©å®¹æ¶éç¨çåæ¯åæ®µéææ¯ï¼å½ä¸ä¸ªæ®µéè¦è¿è¡æ©å®¹æ¶ï¼åªéè¦éå®è¿ä¸ªæ®µï¼èä¸éè¦éå®æ´ä¸ªåå¸è¡¨ã\n    \n    > ConcurrentHashMap å¨è®¾è®¡ä¸æ´å æ³¨éå¹¶åæ§è½ï¼éè¿åæ®µéæ¥åå°éç²åº¦ï¼èä¸æ¯ä»å¯¹ä¸ä¸ªæ®µè¿è¡æ©å®¹ã\n\n\n# ConcurrentHashMap çº¿ç¨å®å¨åºå±å·ä½å®ç°\n\n\n# JDK1.8 ä¹å\n\nConcurrentHashMap æ¯ç± Segment æ°ç»ç»æå HashEntry æ°ç»ç»æç»æã\n\nSegment ç»§æ¿äº ReentrantLock,æä»¥ Segment æ¯ä¸ç§å¯éå¥éï¼æ®æ¼éçè§è²ãHashEntry ç¨äºå­å¨é®å¼å¯¹æ°æ®ã\n\nä¸ä¸ª ConcurrentHashMap éåå«ä¸ä¸ª Segment æ°ç»ï¼Segment çä¸ªæ°ä¸æ¦åå§åå°±ä¸è½æ¹åã Segment æ°ç»çå¤§å°é»è®¤æ¯ 16ï¼ä¹å°±æ¯è¯´é»è®¤å¯ä»¥åæ¶æ¯æ 16 ä¸ªçº¿ç¨å¹¶ååã\n\nSegment çç»æå HashMap ç±»ä¼¼ï¼æ¯ä¸ç§æ°ç»åé¾è¡¨ç»æï¼ä¸ä¸ª Segment åå«ä¸ä¸ª HashEntry æ°ç»ï¼æ¯ä¸ª HashEntry æ¯ä¸ä¸ªé¾è¡¨ç»æçåç´ ï¼æ¯ä¸ª Segment å®æ¤çä¸ä¸ª HashEntry æ°ç»éçåç´ ï¼å½å¯¹ HashEntry æ°ç»çæ°æ®è¿è¡ä¿®æ¹æ¶ï¼å¿é¡»é¦åè·å¾å¯¹åºç Segment çéãä¹å°±æ¯è¯´ï¼å¯¹åä¸ Segment çå¹¶ååå¥ä¼è¢«é»å¡ï¼ä¸å Segment çåå¥æ¯å¯ä»¥å¹¶åæ§è¡çã\n\n\n# JDK1.8 ä¹å\n\n * Java 8 å ä¹å®å¨éåäº ConcurrentHashMapï¼ä»£ç éä»åæ¥ Java 7 ä¸­ç 1000 å¤è¡ï¼åæäºç°å¨ç 6000 å¤è¡ã\n * ConcurrentHashMap åæ¶äº Segment åæ®µéï¼éç¨ Node + CAS + synchronized æ¥ä¿è¯å¹¶åå®å¨ãæ°æ®ç»æè· HashMap 1.8 çç»æç±»ä¼¼ï¼æ°ç»+é¾è¡¨/çº¢é»äºåæ ãJava 8 å¨é¾è¡¨é¿åº¦è¶è¿ä¸å®éå¼ï¼8ï¼æ¶å°é¾è¡¨ï¼å¯»åæ¶é´å¤æåº¦ä¸º O(N)ï¼è½¬æ¢ä¸ºçº¢é»æ ï¼å¯»åæ¶é´å¤æåº¦ä¸º O(log(N))ï¼ã\n * Java 8 ä¸­ï¼éç²åº¦æ´ç»ï¼synchronized åªéå®å½åé¾è¡¨æçº¢é»äºåæ çé¦èç¹ï¼è¿æ ·åªè¦ hash ä¸å²çªï¼å°±ä¸ä¼äº§çå¹¶åï¼å°±ä¸ä¼å½±åå¶ä» Node çè¯»åï¼æçå¤§å¹æåã\n\n\n# éç²åº¦è§£æ\n\néç²åº¦æçæ¯éå®çèå´å¤§å°ï¼éå¸¸åä¸ºç²ç²åº¦éåç»ç²åº¦éä¸¤ç§ç±»åã\n\n 1. ç²ç²åº¦é ç²ç²åº¦éæçæ¯éå®èå´è¾å¤§çéï¼éå¸¸æ¯å¯¹æ´ä¸ªå¯¹è±¡ææ´ä¸ªæ¹æ³è¿è¡å éãç²ç²åº¦éçä¼ç¹æ¯å®ç°ç®åï¼æäºæ§å¶ï¼ç¼ºç¹æ¯éå®èå´å¤ªå¤§ï¼ä¼å¯¼è´å¹¶åæ§è½ä¸éï¼éä½ç¨åºçå¹¶ååº¦ã\n 2. ç»ç²åº¦é ç»ç²åº¦éæçæ¯éå®èå´è¾å°çéï¼éå¸¸æ¯å¯¹å¯¹è±¡ä¸­çæä¸ªå±æ§ææä¸æ®µä»£ç è¿è¡å éãç»ç²åº¦éçä¼ç¹æ¯éå®èå´å°ï¼å¯ä»¥æé«ç¨åºçå¹¶ååº¦ï¼ç¼ºç¹æ¯å®ç°å¤æï¼å®¹æåºç°æ­»éç­é®é¢ã\n\nå¨å®éå¼åä¸­ï¼åºè¯¥æ ¹æ®å®éæåµéæ©åéçéç²åº¦ãå¦æéçèå´å¤ªå¤§ï¼ä¼å¯¼è´å¹¶åæ§è½ä¸éï¼å¦æéçèå´å¤ªå°ï¼ä¼å¢å éçç«äºï¼éä½ç¨åºçå¹¶ååº¦ãå¯ä»¥éè¿ååæµè¯ç­æ¹å¼æ¥ç¡®å®åéçéç²åº¦ã\n\n\n# JDK 1.7 å JDK 1.8 ç ConcurrentHashMap å®ç°æä»ä¹ä¸åï¼\n\nçº¿ç¨å®å¨å®ç°æ¹å¼ ï¼\n\n * JDK 1.7 éç¨ Segment åæ®µéæ¥ä¿è¯å®å¨ï¼ Segment æ¯ç»§æ¿èª ReentrantLockã\n * JDK1.8 æ¾å¼äº Segment åæ®µéçè®¾è®¡ï¼éç¨ Node + CAS + synchronized ä¿è¯çº¿ç¨å®å¨ï¼éç²åº¦æ´ç»ï¼synchronized åªéå®å½åé¾è¡¨æçº¢é»äºåæ çé¦èç¹ã\n\nHash ç¢°æè§£å³æ¹æ³ :\n\n * JDK 1.7 éç¨æé¾æ³ï¼\n * JDK1.8 éç¨æé¾æ³ç»åçº¢é»æ ï¼é¾è¡¨é¿åº¦è¶è¿ä¸å®éå¼æ¶ï¼å°é¾è¡¨è½¬æ¢ä¸ºçº¢é»æ ï¼ã\n\nå¹¶ååº¦ ï¼\n\n * JDK 1.7 æå¤§å¹¶ååº¦æ¯ Segment çä¸ªæ°ï¼é»è®¤æ¯ 16ã\n * JDK 1.8 æå¤§å¹¶ååº¦æ¯ Node æ°ç»çå¤§å°ï¼å¹¶ååº¦æ´å¤§ã\n\n\n# ä¸ºä»ä¹ HashMap é¾è¡¨è½¬çº¢é»æ çéå¼ä¸º 8 å¢ï¼\n\nè¿æ¯ä¸ä¸ªç»éªæ§çè®¾å®ãè¿ä¸ªè®¾å®æ¯ä¸ºäºå¨åå¸è¡¨ä¸­ç»´æ¤åéçæ§è½åç©ºé´å¼éä¹é´æ¾å°å¹³è¡¡ã\n\néæ© 8 æ¯åºäºä¸ç³»åæ§è½æµè¯åå®éåºç¨åºæ¯å¾åºçãå½é¾è¡¨é¿åº¦è¶è¿è¿ä¸ªéå¼æ¶ï¼é¾è¡¨çæ¥æ¾æ§è½å¯è½ä¼ä¸éï¼èè½¬æ¢ä¸ºçº¢é»æ å¯ä»¥æé«æ§è½ãç¶èï¼å¦æé¾è¡¨é¿åº¦è¾ç­ï¼è½¬æ¢ä¸ºçº¢é»æ å¯è½ä¼å¸¦æ¥é¢å¤çå¼éï¼æä»¥éæ©ä¸ä¸ªåéçéå¼æ¯ä¸ä¸ªæè¡¡ã\n\n\n# HashMap çæ©å®¹æºå¶äºè§£åï¼\n\näºè§£ãå½ HashMap ä¸­çåç´ æ°éè¾¾å°ä¸å®éå¼æ¶ï¼å°±ä¼è§¦åæ©å®¹æä½ï¼ä»¥ä¿æåå¸æ¡¶çè´è½½å å­å¨ä¸ä¸ªåéçèå´åï¼ä»èåå°åå¸å²çªï¼æé«æ¥æ¾ãæå¥åå é¤çæ§è½ã\n\nHashMap çæ©å®¹æºå¶ä¸»è¦åæ¬ä»¥ä¸ 3 ä¸ªæ­¥éª¤ï¼\n\n 1. åå»ºæ°çåå¸æ¡¶æ°ç»ï¼å½ HashMap ä¸­çåç´ æ°éè¾¾å°éå¼æ¶ï¼åå»ºä¸ä¸ªæ°çæ°ç»ï¼å¶å¤§å°æ¯åæ°ç»çä¸¤åã\n 2. å°æ§æ°æ®è½¬ç§»å°æ°æ°ç»ï¼éåæ§çåå¸æ¡¶æ°ç»ä¸­çæ¯ä¸ªåç´ ï¼å°å¶éæ°è®¡ç®åå¸å¼åæ¾å¥æ°çåå¸æ¡¶æ°ç»ä¸­ãè¿æ¯ä¸ä¸ªèæ¶æä½ï¼ä½åªéè¦è¿è¡ä¸æ¬¡ã\n 3. æ´æ°å¼ç¨ï¼å° HashMap çåå¸æ¡¶æ°ç»å¼ç¨æåæ°çæ°ç»ï¼åæ¶æ´æ°éå¼ç­ä¿¡æ¯ã\n\næ©å®¹æä½ä¼å¨ HashMap çæå¥æä½ä¸­è§¦åï¼å·ä½çè§¦åæ¶æºæ¯å½åç´ æ°éè¶è¿äºè´è½½å å­ä¹ä»¥å½åæ°ç»å®¹éæ¶ãé»è®¤æåµä¸ï¼è´è½½å å­ä¸º 0.75ï¼å³å½åç´ æ°éè¶è¿å½åæ°ç»å®¹éç 75% æ¶ï¼ä¼è§¦åæ©å®¹ã\n\n\n# æ©å®¹å¨ä»ä¹æ¶åå¢ï¼ä¸ºä»ä¹æ©å®¹å å­æ¯ 0.75ï¼\n\nHashMap å¨è¿è¡æ©å®¹çæ¶åï¼éå¸¸æ¯å½å½åå®¹å¨ä¸­çåç´ æ°éè¶è¿äºå®¹å¨å¤§å°ç 75% æ¶è§¦åæ©å®¹æä½ã\n\nè¿ä¸ªæ©å®¹å å­ï¼load factorï¼çéæ©æ¯ä¸ºäºå¨ç©ºé´åæ¶é´ä¸è¾¾å°ä¸ä¸ªå¹³è¡¡ï¼ä»èä¿è¯ HashMap å¨ä¸è³äºæµªè´¹è¿å¤åå­çæåµä¸ï¼ä»è½ä¿æè¾ä½çåå¸å²çªï¼æä¾é«æçæ¥æ¾ãæå¥åå é¤æä½ã\n\nä¸ºä»ä¹æ©å®¹å å­éæ© 0.75 å¢ï¼\n\nè¿æ¯ä¸ä¸ªæä¸­çéæ©ï¼èèäºæ¶é´åç©ºé´çå¹³è¡¡ãå¦ææ©å®¹å å­è®¾ç½®å¾å¤ªå°ï¼ä¼å¯¼è´åå¸å²çªè¿å¤ï¼å½±åäº HashMap çæ§è½ï¼å¦æè®¾ç½®å¾å¤ªå¤§ï¼è½ç¶åå¸å²çªå¯è½åå°ï¼ä½æ¯ä¼å¯¼è´ HashMap å ç¨æ´å¤çåå­ç©ºé´ã\n\n\n# ä¸ºä»ä¹æ¯ 2 åï¼\n\nä½¿ç¨ 2 çæ¬¡å¹ä½ä¸ºæ°ç»çå®¹éå¯ä»¥ç¡®ä¿ hashCode çé«ä½åä½ä½è½å¤æ´å¥½å°åååå¸å¨æ°ç»çç´¢å¼ä½ç½®ä¸ãè¿æ ·ä¸æ¥ï¼å¨è®¡ç®åç´ å­æ¾ä½ç½®æ¶ï¼åªéè¦è¿è¡ä½è¿ç®ï¼èä¸éè¦ä½¿ç¨åæ¨¡ç­èæ¶çæä½ï¼æé«äºè®¡ç®æçã\n\nå¦å¤ï¼ä½¿ç¨ 2 çæ¬¡å¹ä½ä¸ºå®¹éä¹æ¹ä¾¿è¿è¡æ©å®¹æä½ï¼å ä¸º 2 çæ¬¡å¹çäºè¿å¶è¡¨ç¤ºåªæä¸ä¸ª 1ï¼è¿æ ·å¨æ©å®¹æ¶åªéè¦å°é«ä½å¤åºç 1 åä¸º 0ï¼å°±å¯ä»¥å¾å°æ°çå®¹éãè¿ç§è®¾è®¡å¯ä»¥åå°åå­ç©ºé´çæµªè´¹ã\n\næ»çæ¥è¯´å°±æ¯ï¼\n\n * è¿æ ·è®¾è®¡å¨è®¡ç®åç´ å­æ¾ä½ç½®æ¶å¯ä»¥æé«è®¡ç®æçï¼\n * å¨è¿è¡æ©å®¹æ¶å¯ä»¥åå°åå­ç©ºé´çæµªè´¹ã\n * æ¢æé«äºæçååå°äºæ¶é´ã\n\n> é«ä½æ¯å¨å·¦è¾¹',normalizedContent:'# map éåè¯¦è§£\n\n\n# hashmap å hashtable çåºå«\n\nçº¿ç¨å®å¨æ§ï¼\n\nhashmap æ¯éçº¿ç¨å®å¨çï¼hashtable æ¯çº¿ç¨å®å¨ç,å ä¸º hashtable åé¨çæ¹æ³åºæ¬é½ç»è¿synchronized ä¿®é¥°ãï¼å¦æä½ è¦ä¿è¯çº¿ç¨å®å¨çè¯å°±ä½¿ç¨ concurrenthashmap å§ï¼ï¼ï¼\n\næçï¼\n\nå ä¸ºçº¿ç¨å®å¨çé®é¢ï¼hashmap è¦æ¯ hashtable æçé«ä¸ç¹ãå¦å¤ï¼hashtable åºæ¬è¢«æ·æ±°ï¼ä¸è¦å¨ä»£ç ä¸­ä½¿ç¨å®ï¼\n\nå¯¹ null é® å null å¼ çæ¯æï¼\n\nhashmap å¯ä»¥å­å¨ null ç key å valueï¼ä½ null ä½ä¸ºé®åªè½æä¸ä¸ªï¼null ä½ä¸ºå¼å¯ä»¥æå¤ä¸ªï¼hashtable ä¸åè®¸æ null é®å null å¼ï¼å¦åä¼æåº nullpointerexceptionã\n\nåå§å®¹éå¤§å°åæ¯æ¬¡æ©åå®¹éå¤§å°çä¸å ï¼\n\nâ  åå»ºæ¶å¦æä¸æå®å®¹éåå§å¼ï¼hashtable é»è®¤çåå§å¤§å°ä¸º 11ï¼ä¹åæ¯æ¬¡æ©åï¼å®¹éåä¸ºåæ¥ç 2n+1ãhashmap é»è®¤çåå§åå¤§å°ä¸º 16ãä¹åæ¯æ¬¡æ©åï¼å®¹éåä¸ºåæ¥ç 2 åã\n\nâ¡ åå»ºæ¶å¦æç»å®äºå®¹éåå§å¼ï¼é£ä¹ hashtable ä¼ç´æ¥ä½¿ç¨ä½ ç»å®çå¤§å°ï¼è hashmap ä¼å°å¶æ©åä¸º 2 çå¹æ¬¡æ¹å¤§å°ï¼hashmap ä¸­çtablesizefor()æ¹æ³ä¿è¯ï¼å©ç¨å³ä½ç§»è¿ç®ï¼ãä¹å°±æ¯è¯´ hashmap æ»æ¯ä½¿ç¨ 2 çå¹ä½ä¸ºåå¸è¡¨çå¤§å°,åé¢ä¼ä»ç»å°ä¸ºä»ä¹æ¯ 2 çå¹æ¬¡æ¹ã\n\nåºå±æ°æ®ç»æï¼\n\n * jdk1.8 ä»¥åç hashmap å¨è§£å³åå¸å²çªæ¶æäºè¾å¤§çååï¼å½é¾è¡¨é¿åº¦å¤§äºéå¼ï¼é»è®¤ä¸º 8ï¼æ¶ï¼å°é¾è¡¨è½¬åä¸ºçº¢é»æ ï¼å°é¾è¡¨è½¬æ¢æçº¢é»æ åä¼å¤æ­ï¼å¦æå½åæ°ç»çé¿åº¦å°äº 64ï¼é£ä¹ä¼éæ©åè¿è¡æ°ç»æ©å®¹ï¼èä¸æ¯è½¬æ¢ä¸ºçº¢é»æ ï¼ï¼ä»¥åå°æç´¢æ¶é´ï¼åæä¸­æä¼ç»åæºç å¯¹è¿ä¸è¿ç¨è¿è¡åæï¼ã\n   \n   > æ¡¶æ°ç»æ¯ç¨æ¥å­å¨æ°æ®åç´ ï¼é¾è¡¨æ¯ç¨æ¥è§£å³å²çªï¼çº¢é»æ æ¯ä¸ºäºæé«æ¥è¯¢çæçã\n\n * hashtable æ²¡æè¿æ ·çæºå¶ã\n\n\n# hashmap å hashset åºå«\n\n\n\nç¨éï¼\n\n * hashmapï¼ç¨äºå­å¨é®å¼å¯¹ï¼key-valueï¼æ å°å³ç³»çæ°æ®ç»æï¼å¶ä¸­æ¯ä¸ªé®å¯ä¸å¯¹åºä¸ä¸ªå¼ã\n * hashsetï¼ç¨äºå­å¨ä¸éå¤åç´ çéåï¼å®åºäº hashmap å®ç°ï¼åªå­å¨åç´ èæ²¡æé®å¼å¯¹çæ å°å³ç³»ã\n\nå­å¨æ¹å¼ï¼\n\n * hashmapï¼å­å¨é®å¼å¯¹ï¼éè¿é®æ¥æ¾å¼ãé®å¯ä»¥æ¯ä»»ä½éç©ºå¯¹è±¡ï¼å¼å¯ä»¥æ¯ä»»ä½å¯¹è±¡ã\n * hashsetï¼å­å¨ä¸éå¤çåç´ ï¼éè¿åç´ æ¬èº«æ¥è¿è¡æ¥æ¾åå¤éã\n\nåé¨å®ç°ï¼\n\n * hashmapï¼åé¨ä½¿ç¨æ°ç»åé¾è¡¨ï¼æçº¢é»æ ï¼çç»åæ¥å®ç°ï¼éè¿åå¸å½æ°å°é®æ å°å°æ°ç»çç´¢å¼ä½ç½®ï¼ä»¥æé«é®çæ¥æ¾æçã\n * hashsetï¼åºäº hashmap å®ç°ï¼å®çåç´ å°±æ¯ hashmap çé®ï¼å¼åæ¯ä¸ä¸ªåºå®çå¸¸éï¼ä¸ç´æ¯ä¸ä¸ª object å¯¹è±¡ï¼ã\n\næä½åç¨æ³ï¼\n\n * hashmapï¼éç¨äºéè¦å­å¨é®å¼å¯¹å³ç³»çæåµï¼ä¾å¦ç¼å­ãæ å°å³ç³»ç­ã\n * hashsetï¼éç¨äºå­å¨ä¸éå¤åç´ çæåµï¼ä¾å¦éè¦å¿«éå¤æ­æä¸ªåç´ æ¯å¦å­å¨ç­ã\n\næ§è½ï¼\n\n * hashmapï¼ç¸å¯¹äº hashsetï¼hashmap éè¦å­å¨é®å¼å¯¹ï¼å æ­¤é¢å¤å ç¨ä¸äºåå­ï¼ä½å¯ä»¥å­å¨æ´å¤çä¿¡æ¯ã\n * hashsetï¼ç¸å¯¹äº hashmapï¼hashset åªéè¦å­å¨åç´ ï¼å ç¨çåå­è¾å°ï¼ä½ä¸è½å­å¨é®å¼å¯¹å³ç³»ã\n\næ»ä¹ï¼hashmap éç¨äºå­å¨é®å¼å¯¹å³ç³»ï¼è hashset éç¨äºå­å¨ä¸éå¤åç´ çéåãå®éä¸ï¼hashset å¨åé¨ä½¿ç¨äº hashmap æ¥å®ç°ï¼å®ä»¬ä¹é´å­å¨ä¸å®çå³èåç¸ä¼¼æ§ã\n\n\n# hashcode æºç \n\nhashcode() æ¹æ³è¿åçå¼æ¯ä¸ä¸ª int ç±»åçæ°å­ï¼ç¨äºè¡¨ç¤ºå¯¹è±¡çåå¸å¼ãè¿ä¸ªåå¸å¼ä¸ä¸å®æ¯å¯¹è±¡çå°åï¼ä¹ä¸ä¸å®æ¯å¯ä¸çãå¨è®¡ç®åå¸å¼æ¶ï¼ä¸è¬ä¼ä½¿ç¨å¯¹è±¡çå±æ§æ¥è®¡ç®ãä¾å¦ï¼å¦æä¸ä¸ª person ç±»å·æ name å age ä¸¤ä¸ªå±æ§ï¼é£ä¹å¯ä»¥å°å®ä»¬çåå¸å¼åå¹¶èµ·æ¥è®¡ç®ï¼\n\npublic int hashcode() {\n    int result = 17;\n    result = 31 * result + name.hashcode();\n    result = 31 * result + age;\n    return result;\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nè¿æ®µä»£ç ä¸­ä½¿ç¨äºä¸ä¸ªç»å¸çåå¸ç®æ³ï¼ç§°ä¸ºâ31 åå¸æ³âãè¿ä¸ªç®æ³å°åå§å¼è®¾ä¸ºä¸ä¸ªè´¨æ° 17ï¼ç¶åå°å±æ§çåå¸å¼ä¾æ¬¡ä¹ä»¥ 31 å¹¶ç¸å ï¼å¾å°æç»çåå¸å¼ãç±äº 31 æ¯ä¸ä¸ªå¥ç´ æ°ï¼å¯ä»¥ä¿è¯ä¹æ³è¿ç¨ä¸ä¼äº§çåå¸å²çªã\n\n> éè¦æ³¨æçæ¯ï¼è½ç¶åå¸å¼ä¸ä¸å®æ¯å°åï¼ä½æ¯å¨ java ä¸­ï¼å¦ææ²¡æä¸ºå¯¹è±¡æå® hashcode() æ¹æ³çå®ç°ï¼é£ä¹é»è®¤æåµä¸ï¼å®ç hashcode() æ¹æ³ä¼è¿åå¯¹è±¡çå°åï¼å æ­¤å¨è¿ç§æåµä¸ï¼ä¸¤ä¸ªå¯¹è±¡çåå¸å¼å¯è½ä¼ç¸åï¼ä½è¿å¹¶ä¸æ¯ä¸ä¸ªå¥½çåå¸ç®æ³ãå æ­¤ï¼å¨å®ç°èªå®ä¹çåå¸ç®æ³æ¶ï¼éè¦ä¿è¯åå¸å¼çåå¸å°½å¯è½ååï¼å¹¶ä¸ä¸å®¹æäº§çåå¸å²çªã\n\n\n# ä¸ºä»ä¹åå¸å½æ°è½éä½åå¸ç¢°æï¼\n\nå ä¸ºå¥½çåå¸å½æ°å¯ä»¥å°è¾å¥çæ°æ®ååãéæºå°æ å°å°åå¸ç©ºé´ï¼éä½äºç¢°æçå¯è½æ§ï¼ä»èæé«äºåå¸è¡¨ç­æ°æ®ç»æçæ§è½åç¨³å®æ§ã\n\n\n# hashmap å treemap åºå«\n\ntreemap åhashmap é½ç»§æ¿èªabstractmap ï¼ä½æ¯éè¦æ³¨æçæ¯treemapå®è¿å®ç°äºnavigablemapæ¥å£åsortedmap æ¥å£ã\n\n\n\nå®ç° navigablemap æ¥å£è®© treemap æäºå¯¹éåååç´ çæç´¢çè½åã\n\nå®ç°sortedmapæ¥å£è®© treemap æäºå¯¹éåä¸­çåç´ æ ¹æ®é®æåºçè½åãé»è®¤æ¯æ key çååºæåºï¼ä¸è¿æä»¬ä¹å¯ä»¥æå®æåºçæ¯è¾å¨ãç¤ºä¾ä»£ç å¦ä¸ï¼\n\npublic class person {\n    private integer age;\n    public person(integer age) {\n        this.age = age;\n    }\n    public integer getage() {\n        return age;\n    }\n\n    public static void main(string[] args) {\n        treemap<person, string> treemap = new treemap<>(new comparator<person>() {\n            @override\n            public int compare(person person1, person person2) {\n                int num = person1.getage() - person2.getage();\n                return integer.compare(num, 0);\n            }\n        });\n        treemap.put(new person(3), "person1");\n        treemap.put(new person(18), "person2");\n        treemap.put(new person(35), "person3");\n        treemap.put(new person(16), "person4");\n        treemap.entryset().stream().foreach(personstringentry -> {\n            system.out.println(personstringentry.getvalue());\n        });\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\nå¯ä»¥çåºï¼treemap ä¸­çåç´ å·²ç»æ¯æç§ person ç age å­æ®µçååºæ¥æåäºã\n\nä¸é¢ï¼æä»¬æ¯éè¿ä¼ å¥å¿ååé¨ç±»çæ¹å¼å®ç°çï¼ä½ å¯ä»¥å°ä»£ç æ¿æ¢æ lambda è¡¨è¾¾å¼å®ç°çæ¹å¼ï¼\n\ntreemap<person, string> treemap = new treemap<>((person1, person2) -> {\n  int num = person1.getage() - person2.getage();\n  return integer.compare(num, 0);\n});\n\n\n1\n2\n3\n4\n\n\nç»¼ä¸ï¼ç¸æ¯äºhashmapæ¥è¯´ treemap ä¸»è¦å¤äºå¯¹éåä¸­çåç´ æ ¹æ®é®æåºçè½åï¼sortedmapï¼ä»¥åå¯¹éåååç´ çæç´¢çè½åï¼navigablemapï¼ã\n\n\n# hashset å¦ä½æ£æ¥éå¤?\n\n> å½ä½ æå¯¹è±¡å å¥hashsetæ¶ï¼hashset ä¼åè®¡ç®å¯¹è±¡çhashcodeå¼æ¥å¤æ­å¯¹è±¡å å¥çä½ç½®ï¼åæ¶ä¹ä¼ä¸å¶ä»å å¥çå¯¹è±¡ç hashcode å¼ä½æ¯è¾ï¼å¦ææ²¡æç¸ç¬¦ç hashcodeï¼hashset ä¼åè®¾å¯¹è±¡æ²¡æéå¤åºç°ãä½æ¯å¦æåç°æç¸å hashcode å¼çå¯¹è±¡ï¼è¿æ¶ä¼è°ç¨equals()æ¹æ³æ¥æ£æ¥ hashcode ç¸ç­çå¯¹è±¡æ¯å¦ççç¸åãå¦æä¸¤èç¸åï¼hashset å°±ä¸ä¼è®©å å¥æä½æåã\n\nç´æ¥çä¸ä¸hashsetä¸­çæºç ï¼\n\nå¨ jdk1.8 ä¸­ï¼å®éä¸æ è®º hashset ä¸­æ¯å¦å·²ç»å­å¨äºæåç´ ï¼hashset é½ä¼ç´æ¥æå¥ï¼åªæ¯ä¼å¨ add() æ¹æ³çè¿åå¼å¤åè¯æä»¬æå¥åæ¯å¦å­å¨ç¸ååç´ \n\n// returns: true if this set did not already contain the specified element\n// è¿åå¼ï¼å½ set ä¸­æ²¡æåå« add çåç´ æ¶è¿åç\npublic boolean add(e e) {\n        return map.put(e, present)==null;\n}\n\n\n1\n2\n3\n4\n5\n\n\nhashset éè¿ hashmap çé®çå¯ä¸æ§æ¥å®ç°å¯¹åç´ çéå¤æ£æ¥ãå¨ hashset ä¸­ï¼åç´ è¢«å­å¨ä¸º hashmap çé®ï¼èå¼é½æ¯åºå®çä¸ä¸ªå¸¸éå¯¹è±¡ãå½æä»¬å hashset æ·»å åç´ æ¶ï¼å®éä¸æ¯å°è¿ä¸ªåç´ ä½ä¸ºé®ï¼å¸¸éå¯¹è±¡ä½ä¸ºå¯¹åºçå¼å­å¨å¨ hashmap ä¸­ã\n\nå¨ hashmap ä¸­ï¼é®æ¯å¯ä¸çï¼è¿æå³çå½æä»¬å°è¯å°ç¸åçåç´ ä½ä¸ºé®æ·»å å° hashmap ä¸­æ¶ï¼æ°çåç´ ä¼è¦çææ§çåç´ ãå æ­¤ï¼å½æä»¬å hashset æ·»å åç´ æ¶ï¼å®éä¸æ¯å¨å©ç¨ hashmap çå»éç¹æ§æ¥ä¿è¯ hashset ä¸­çåç´ å¯ä¸æ§ã\n\nä¾å¦ï¼èèä»¥ä¸ä»£ç ï¼\n\nhashset<integer> set = new hashset<>();\nset.add(1);\nset.add(2);\nset.add(3);\nset.add(1);  // å°è¯æ·»å éå¤åç´ \nsystem.out.println(set.size());  // è¾åºä¸º 3ï¼å ä¸ºéå¤åç´ è¢«å»é\n\n\n1\n2\n3\n4\n5\n6\n\n\nå¨ä¸è¿°ç¤ºä¾ä¸­ï¼å°è¯å hashset ä¸­æ·»å éå¤çåç´  1 æ¶ï¼å¹¶æ²¡æå¯¼è´ hashset ä¸­åºç°éå¤åç´ ï¼è¿æ¯å ä¸º hashset å©ç¨äº hashmap çé®å¯ä¸æ§æ¥è¿è¡å»éã\n\nå æ­¤ï¼hashset è½å¤èªå¨æ£æ¥å¹¶é²æ­¢éå¤åç´ çå­å¨ã\n\n\n# hashmapçåºå±å®ç°\n\n\n# jdk1.8 ä¹å\n\njdk1.8 ä¹å hashmap åºå±æ¯ æ°ç»åé¾è¡¨ ç»åå¨ä¸èµ·ä½¿ç¨ä¹å°±æ¯ é¾è¡¨æ£åãhashmap éè¿ key ç hashcode ç»è¿æ°å¨å½æ°ï¼hashæ¹æ³ï¼å¤çè¿åå¾å° hash å¼ï¼ç¶åéè¿ (n - 1) & hash å¤æ­å½ååç´ å­æ¾çä½ç½®ï¼è¿éç n æçæ¯æ°ç»çé¿åº¦ï¼ï¼å¦æå½åä½ç½®å­å¨åç´ çè¯ï¼å°±å¤æ­è¯¥åç´ ä¸è¦å­å¥çåç´ ç hash å¼ä»¥å key æ¯å¦ç¸åï¼å¦æç¸åçè¯ï¼ç´æ¥è¦çï¼ä¸ç¸åå°±éè¿æé¾æ³ï¼æ°ç»+é¾è¡¨ï¼è§£å³å²çªã\n\n\n# jdk1.8 ä¹å\n\nç¸æ¯äºä¹åççæ¬ï¼ jdk1.8 ä¹åå¨è§£å³åå¸å²çªæ¶æäºè¾å¤§çååï¼å½é¾è¡¨é¿åº¦å¤§äºéå¼ï¼é»è®¤ä¸º 8ï¼ï¼å°é¾è¡¨è½¬æ¢æçº¢é»æ åä¼å¤æ­ï¼å¦æå½åæ°ç»çé¿åº¦å°äº 64ï¼é£ä¹ä¼éæ©åè¿è¡æ°ç»æ©å®¹ï¼èä¸æ¯è½¬æ¢ä¸ºçº¢é»æ ï¼æ¶ï¼å°é¾è¡¨è½¬åä¸ºçº¢é»æ ï¼ä»¥åå°æç´¢æ¶é´ã\n\n> treemapãtreeset ä»¥å jdk1.8 ä¹åç hashmap åºå±é½ç¨å°äºçº¢é»æ ãçº¢é»æ å°±æ¯ä¸ºäºè§£å³äºåæ¥æ¾æ çç¼ºé·ï¼å ä¸ºäºåæ¥æ¾æ å¨æäºæåµä¸ä¼éåæä¸ä¸ªçº¿æ§ç»æã\n\n\n# jdk1.7åjdk1.8çhashæ¹æ³æºç å¯¹æ¯ï¼\n\n 1. jdk 1.8 ç hash æ¹æ³ ï¼è¿ç¨äºä¸ç®è¿ç®ç¬¦ï¼ç¸æ¯äº jdk 1.7 hash æ¹æ³æ´å ç®åï¼ä½æ¯åçä¸åï¼\n 2. jdk 1.7 ç hash æ¹æ³çæ§è½ä¼ç¨å·®ä¸ç¹ç¹ï¼å ä¸ºæ°å¨äº 4 æ¬¡\n\nä½¿ç¨æ°å¨å½æ°ï¼hashæ¹æ³ï¼ä¹åå¯ä»¥åå°ç¢°æ\n\n\n# hashmap çé¿åº¦ä¸ºä»ä¹æ¯ 2 çå¹æ¬¡æ¹\n\nè¿æ¯å ä¸º hashmap å¨è®¡ç® key çåå¸å¼åï¼éè¦éè¿åå¸å¼åæ°ç»é¿åº¦è®¡ç®åºè¯¥ key å¨æ°ç»ä¸­çä½ç½®ã\n\nå·ä½çè®¡ç®æ¹å¼æ¯ (n - 1) & hashï¼æ°ç»çé¿åº¦åä¸çå·®å key çåå¸å¼ç¸ä¸ï¼ï¼å¶ä¸­ n æ¯æ°ç»çé¿åº¦ï¼hash æ¯ key çåå¸å¼ã\n\nè¿ä¸ªè®¡ç®æ¹å¼çä½ç¨æ¯å°åå¸å¼çé«ä½åä½ä½è¿è¡ä¸æ¬¡å¼æè¿ç®ï¼å¾å° key å¨æ°ç»ä¸­çä½ç½®ã å¦ææ°ç»çé¿åº¦ä¸æ¯ 2 çå¹æ¬¡æ¹ï¼é£ä¹å¨è®¡ç® (n - 1) & hash æ¶ï¼å¾å°çç»æå¯è½ä¼å­å¨ä¸äºåå¸å¼æ æ³åååå¸å°æ°ç»ä¸­çä½ç½®çæåµï¼ä»èå¯¼è´æäºä½ç½®ä¸çé¾è¡¨æçº¢é»æ ä¼åå¾è¿é¿ï¼å½±å hashmap çæ§è½ãå æ­¤ï¼ä¸ºäºé¿åè¿ç§æåµçåçï¼hashmap çé¿åº¦æ»æ¯ä¿æä¸º 2 çå¹æ¬¡æ¹ã å¦å¤ï¼å¯¹äºé¿åº¦ä¸º 2 çå¹æ¬¡æ¹çæ°ç»ï¼è®¡ç® (n - 1) & hash æ¶ï¼ç­ä»·äºå¯¹æ°ç»é¿åº¦åæ¨¡ï¼è¿ç§è®¡ç®æ¹å¼çæçæ¯è¾é«ï¼èä¸å¯ä»¥ä¿è¯åååå¸ãå æ­¤ï¼hashmap éç¨é¿åº¦ä¸º 2 çå¹æ¬¡æ¹çæ°ç»ï¼å¯ä»¥æé« hashmap çæ§è½åæçã\n\n\n# hashmap å¤çº¿ç¨æä½å¯¼è´æ­»å¾ªç¯é®é¢\n\nå¨å¤çº¿ç¨ç¯å¢ä¸ï¼å¦æå¤ä¸ªçº¿ç¨åæ¶å¯¹ hashmap è¿è¡æä½ï¼å¯è½ä¼å¯¼è´ hashmap çé¾è¡¨æçº¢é»æ åºç°ç¯å½¢ï¼ä»èå¯¼è´æ­»å¾ªç¯é®é¢ãè¿ç§é®é¢éå¸¸åçå¨ä»¥ä¸æåµä¸ï¼\n\n 1. å¤ä¸ªçº¿ç¨åæ¶è°ç¨ put() æ¹æ³ï¼å¯¼è´é¾è¡¨æçº¢é»æ çç»æåçååï¼ä»èå¯¼è´é¾è¡¨æçº¢é»æ åºç°ç¯å½¢ã\n 2. å¤ä¸ªçº¿ç¨åæ¶è°ç¨ resize() æ¹æ³ï¼å¯¼è´æ°ç»æ©å®¹æ¶é¾è¡¨æçº¢é»æ çç»æåçååï¼ä»èå¯¼è´é¾è¡¨æçº¢é»æ åºç°ç¯å½¢ã å½åºç°é¾è¡¨æçº¢é»æ ç¯å½¢æ¶ï¼ä¼å¯¼è´ hashmap çéåæä½è¿å¥æ­»å¾ªç¯ï¼ä»èå½±åç¨åºçæ§è½åå¯é æ§ã\n\nä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼å¯ä»¥éç¨ä»¥ä¸å ç§æ¹å¼ï¼\n\n 1. ä½¿ç¨çº¿ç¨å®å¨ç concurrenthashmapï¼å®æ¯çº¿ç¨å®å¨ç hashmapï¼å¯ä»¥å®å¨å°å¨å¤çº¿ç¨ç¯å¢ä¸è¿è¡æä½ã\n 2. å¯¹äºéè¦å¨å¤çº¿ç¨ç¯å¢ä¸ä½¿ç¨ hashmap çæåµï¼å¯ä»¥ä½¿ç¨éæ¥ä¿è¯åä¸æ¶é´åªæä¸ä¸ªçº¿ç¨è½å¤å¯¹ hashmap è¿è¡æä½ã\n 3. é¿åå¤ä¸ªçº¿ç¨åæ¶å¯¹ hashmap è¿è¡æä½ï¼å¯ä»¥å°å¯¹ hashmap çæä½æ¾å¨åæ­¥åä¸­ï¼ç¡®ä¿åä¸æ¶é´åªæä¸ä¸ªçº¿ç¨è½å¤å¯¹ hashmap è¿è¡ä¿®æ¹ã\n 4. éè¿ä½¿ç¨çº¿ç¨å®å¨çå¹¶åæ°æ®ç»æï¼ä¾å¦ concurrentlinkedqueueãconcurrenthashmap ç­ï¼é¿åå¨å¤çº¿ç¨ç¯å¢ä¸ä½¿ç¨ hashmapã\n\n\n# hashmap æåªå ç§å¸¸è§çéåæ¹å¼?\n\nhashmap ç 7 ç§éåæ¹å¼ä¸æ§è½åæï¼\n\n\n# concurrenthashmap å hashtable çåºå«\n\nconcurrenthashmap å hashtable é½æ¯çº¿ç¨å®å¨çéåç±»ï¼ä½æ¯å®ä»¬å¨å®ç°åæ§è½ä¸æä¸äºåºå«ï¼\n\n 1. åºå±æ°æ®ç»æï¼\n    * jdk1.7 ç concurrenthashmap åºå±éç¨ åæ®µçæ°ç»+é¾è¡¨ å®ç°ï¼jdk1.8 éç¨çæ°æ®ç»æè· hashmap1.8 çç»æä¸æ ·ï¼æ°ç»+é¾è¡¨/çº¢é»äºåæ ã\n    * hashtable å jdk1.8 ä¹åç hashmap çåºå±æ°æ®ç»æç±»ä¼¼é½æ¯éç¨ æ°ç»+é¾è¡¨ çå½¢å¼ï¼æ°ç»æ¯ hashmap çä¸»ä½ï¼é¾è¡¨åæ¯ä¸»è¦ä¸ºäºè§£å³åå¸å²çªèå­å¨çï¼\n 2. å®ç°çº¿ç¨å®å¨çæ¹å¼ï¼éè¦ï¼ï¼\n\n * å¨ jdk1.7 çæ¶åï¼concurrenthashmap å¯¹æ´ä¸ªæ¡¶æ°ç»è¿è¡äºåå²åæ®µ(segmentï¼åæ®µé)ï¼æ¯ä¸æéåªéå®¹å¨å¶ä¸­ä¸é¨åæ°æ®ï¼å¤çº¿ç¨è®¿é®å®¹å¨éä¸åæ°æ®æ®µçæ°æ®ï¼å°±ä¸ä¼å­å¨éç«äºï¼æé«å¹¶åè®¿é®çã\n * å°äº jdk1.8 çæ¶åï¼concurrenthashmap å·²ç»æå¼äº segment çæ¦å¿µï¼èæ¯ç´æ¥ç¨ node æ°ç»+é¾è¡¨ / çº¢é»æ çæ°æ®ç»ææ¥å®ç°ï¼å¹¶åæ§å¶ä½¿ç¨ synchronized å cas æ¥æä½ãï¼jdk1.6 ä»¥å synchronized éåäºå¾å¤ä¼åï¼ æ´ä¸ªçèµ·æ¥å°±åæ¯ä¼åè¿ä¸çº¿ç¨å®å¨ç hashmapï¼è½ç¶å¨ jdk1.8 ä¸­è¿è½çå° segment çæ°æ®ç»æï¼ä½æ¯å·²ç»ç®åäºå±æ§ï¼åªæ¯ä¸ºäºå¼å®¹æ§çæ¬ï¼\n * hashtable(åä¸æé): ä½¿ç¨ synchronized æ¥ä¿è¯çº¿ç¨å®å¨ï¼æçéå¸¸ä½ä¸ãå½ä¸ä¸ªçº¿ç¨è®¿é®åæ­¥æ¹æ³æ¶ï¼å¶ä»çº¿ç¨ä¹è®¿é®åæ­¥æ¹æ³ï¼å¯è½ä¼è¿å¥é»å¡æè½®è¯¢ç¶æï¼å¦ä½¿ç¨ put æ·»å åç´ ï¼å¦ä¸ä¸ªçº¿ç¨ä¸è½ä½¿ç¨ put æ·»å åç´ ï¼ä¹ä¸è½ä½¿ç¨ getï¼ç«äºä¼è¶æ¥è¶æ¿çæçè¶ä½ã\n\n 3. å¯¹ null å¼çæ¯æä¸åï¼\n    \n    * hashtable ä¸åè®¸ key ä¸º nullï¼\n    * è concurrenthashmap å**ï¼ jdk7 æ¶ï¼**åè®¸ key å value åä¸º nullï¼jdk8 åä¸ååè®¸ï¼å ä¸ºä½¿ç¨äº cas -- ä¿è¯çº¿ç¨å®å¨çï¼å¯¹ null å¼çæ¯æåçäºååï¼ã\n\n 4. æ©å®¹æºå¶ä¸åï¼hashtable å¨æ©å®¹æ¶ä½¿ç¨çæ¯åæ¥å®¹éç 2 åå  1ï¼è concurrenthashmap å¨æ©å®¹æ¶éç¨çåæ¯åæ®µéææ¯ï¼å½ä¸ä¸ªæ®µéè¦è¿è¡æ©å®¹æ¶ï¼åªéè¦éå®è¿ä¸ªæ®µï¼èä¸éè¦éå®æ´ä¸ªåå¸è¡¨ã\n    \n    > concurrenthashmap å¨è®¾è®¡ä¸æ´å æ³¨éå¹¶åæ§è½ï¼éè¿åæ®µéæ¥åå°éç²åº¦ï¼èä¸æ¯ä»å¯¹ä¸ä¸ªæ®µè¿è¡æ©å®¹ã\n\n\n# concurrenthashmap çº¿ç¨å®å¨åºå±å·ä½å®ç°\n\n\n# jdk1.8 ä¹å\n\nconcurrenthashmap æ¯ç± segment æ°ç»ç»æå hashentry æ°ç»ç»æç»æã\n\nsegment ç»§æ¿äº reentrantlock,æä»¥ segment æ¯ä¸ç§å¯éå¥éï¼æ®æ¼éçè§è²ãhashentry ç¨äºå­å¨é®å¼å¯¹æ°æ®ã\n\nä¸ä¸ª concurrenthashmap éåå«ä¸ä¸ª segment æ°ç»ï¼segment çä¸ªæ°ä¸æ¦åå§åå°±ä¸è½æ¹åã segment æ°ç»çå¤§å°é»è®¤æ¯ 16ï¼ä¹å°±æ¯è¯´é»è®¤å¯ä»¥åæ¶æ¯æ 16 ä¸ªçº¿ç¨å¹¶ååã\n\nsegment çç»æå hashmap ç±»ä¼¼ï¼æ¯ä¸ç§æ°ç»åé¾è¡¨ç»æï¼ä¸ä¸ª segment åå«ä¸ä¸ª hashentry æ°ç»ï¼æ¯ä¸ª hashentry æ¯ä¸ä¸ªé¾è¡¨ç»æçåç´ ï¼æ¯ä¸ª segment å®æ¤çä¸ä¸ª hashentry æ°ç»éçåç´ ï¼å½å¯¹ hashentry æ°ç»çæ°æ®è¿è¡ä¿®æ¹æ¶ï¼å¿é¡»é¦åè·å¾å¯¹åºç segment çéãä¹å°±æ¯è¯´ï¼å¯¹åä¸ segment çå¹¶ååå¥ä¼è¢«é»å¡ï¼ä¸å segment çåå¥æ¯å¯ä»¥å¹¶åæ§è¡çã\n\n\n# jdk1.8 ä¹å\n\n * java 8 å ä¹å®å¨éåäº concurrenthashmapï¼ä»£ç éä»åæ¥ java 7 ä¸­ç 1000 å¤è¡ï¼åæäºç°å¨ç 6000 å¤è¡ã\n * concurrenthashmap åæ¶äº segment åæ®µéï¼éç¨ node + cas + synchronized æ¥ä¿è¯å¹¶åå®å¨ãæ°æ®ç»æè· hashmap 1.8 çç»æç±»ä¼¼ï¼æ°ç»+é¾è¡¨/çº¢é»äºåæ ãjava 8 å¨é¾è¡¨é¿åº¦è¶è¿ä¸å®éå¼ï¼8ï¼æ¶å°é¾è¡¨ï¼å¯»åæ¶é´å¤æåº¦ä¸º o(n)ï¼è½¬æ¢ä¸ºçº¢é»æ ï¼å¯»åæ¶é´å¤æåº¦ä¸º o(log(n))ï¼ã\n * java 8 ä¸­ï¼éç²åº¦æ´ç»ï¼synchronized åªéå®å½åé¾è¡¨æçº¢é»äºåæ çé¦èç¹ï¼è¿æ ·åªè¦ hash ä¸å²çªï¼å°±ä¸ä¼äº§çå¹¶åï¼å°±ä¸ä¼å½±åå¶ä» node çè¯»åï¼æçå¤§å¹æåã\n\n\n# éç²åº¦è§£æ\n\néç²åº¦æçæ¯éå®çèå´å¤§å°ï¼éå¸¸åä¸ºç²ç²åº¦éåç»ç²åº¦éä¸¤ç§ç±»åã\n\n 1. ç²ç²åº¦é ç²ç²åº¦éæçæ¯éå®èå´è¾å¤§çéï¼éå¸¸æ¯å¯¹æ´ä¸ªå¯¹è±¡ææ´ä¸ªæ¹æ³è¿è¡å éãç²ç²åº¦éçä¼ç¹æ¯å®ç°ç®åï¼æäºæ§å¶ï¼ç¼ºç¹æ¯éå®èå´å¤ªå¤§ï¼ä¼å¯¼è´å¹¶åæ§è½ä¸éï¼éä½ç¨åºçå¹¶ååº¦ã\n 2. ç»ç²åº¦é ç»ç²åº¦éæçæ¯éå®èå´è¾å°çéï¼éå¸¸æ¯å¯¹å¯¹è±¡ä¸­çæä¸ªå±æ§ææä¸æ®µä»£ç è¿è¡å éãç»ç²åº¦éçä¼ç¹æ¯éå®èå´å°ï¼å¯ä»¥æé«ç¨åºçå¹¶ååº¦ï¼ç¼ºç¹æ¯å®ç°å¤æï¼å®¹æåºç°æ­»éç­é®é¢ã\n\nå¨å®éå¼åä¸­ï¼åºè¯¥æ ¹æ®å®éæåµéæ©åéçéç²åº¦ãå¦æéçèå´å¤ªå¤§ï¼ä¼å¯¼è´å¹¶åæ§è½ä¸éï¼å¦æéçèå´å¤ªå°ï¼ä¼å¢å éçç«äºï¼éä½ç¨åºçå¹¶ååº¦ãå¯ä»¥éè¿ååæµè¯ç­æ¹å¼æ¥ç¡®å®åéçéç²åº¦ã\n\n\n# jdk 1.7 å jdk 1.8 ç concurrenthashmap å®ç°æä»ä¹ä¸åï¼\n\nçº¿ç¨å®å¨å®ç°æ¹å¼ ï¼\n\n * jdk 1.7 éç¨ segment åæ®µéæ¥ä¿è¯å®å¨ï¼ segment æ¯ç»§æ¿èª reentrantlockã\n * jdk1.8 æ¾å¼äº segment åæ®µéçè®¾è®¡ï¼éç¨ node + cas + synchronized ä¿è¯çº¿ç¨å®å¨ï¼éç²åº¦æ´ç»ï¼synchronized åªéå®å½åé¾è¡¨æçº¢é»äºåæ çé¦èç¹ã\n\nhash ç¢°æè§£å³æ¹æ³ :\n\n * jdk 1.7 éç¨æé¾æ³ï¼\n * jdk1.8 éç¨æé¾æ³ç»åçº¢é»æ ï¼é¾è¡¨é¿åº¦è¶è¿ä¸å®éå¼æ¶ï¼å°é¾è¡¨è½¬æ¢ä¸ºçº¢é»æ ï¼ã\n\nå¹¶ååº¦ ï¼\n\n * jdk 1.7 æå¤§å¹¶ååº¦æ¯ segment çä¸ªæ°ï¼é»è®¤æ¯ 16ã\n * jdk 1.8 æå¤§å¹¶ååº¦æ¯ node æ°ç»çå¤§å°ï¼å¹¶ååº¦æ´å¤§ã\n\n\n# ä¸ºä»ä¹ hashmap é¾è¡¨è½¬çº¢é»æ çéå¼ä¸º 8 å¢ï¼\n\nè¿æ¯ä¸ä¸ªç»éªæ§çè®¾å®ãè¿ä¸ªè®¾å®æ¯ä¸ºäºå¨åå¸è¡¨ä¸­ç»´æ¤åéçæ§è½åç©ºé´å¼éä¹é´æ¾å°å¹³è¡¡ã\n\néæ© 8 æ¯åºäºä¸ç³»åæ§è½æµè¯åå®éåºç¨åºæ¯å¾åºçãå½é¾è¡¨é¿åº¦è¶è¿è¿ä¸ªéå¼æ¶ï¼é¾è¡¨çæ¥æ¾æ§è½å¯è½ä¼ä¸éï¼èè½¬æ¢ä¸ºçº¢é»æ å¯ä»¥æé«æ§è½ãç¶èï¼å¦æé¾è¡¨é¿åº¦è¾ç­ï¼è½¬æ¢ä¸ºçº¢é»æ å¯è½ä¼å¸¦æ¥é¢å¤çå¼éï¼æä»¥éæ©ä¸ä¸ªåéçéå¼æ¯ä¸ä¸ªæè¡¡ã\n\n\n# hashmap çæ©å®¹æºå¶äºè§£åï¼\n\näºè§£ãå½ hashmap ä¸­çåç´ æ°éè¾¾å°ä¸å®éå¼æ¶ï¼å°±ä¼è§¦åæ©å®¹æä½ï¼ä»¥ä¿æåå¸æ¡¶çè´è½½å å­å¨ä¸ä¸ªåéçèå´åï¼ä»èåå°åå¸å²çªï¼æé«æ¥æ¾ãæå¥åå é¤çæ§è½ã\n\nhashmap çæ©å®¹æºå¶ä¸»è¦åæ¬ä»¥ä¸ 3 ä¸ªæ­¥éª¤ï¼\n\n 1. åå»ºæ°çåå¸æ¡¶æ°ç»ï¼å½ hashmap ä¸­çåç´ æ°éè¾¾å°éå¼æ¶ï¼åå»ºä¸ä¸ªæ°çæ°ç»ï¼å¶å¤§å°æ¯åæ°ç»çä¸¤åã\n 2. å°æ§æ°æ®è½¬ç§»å°æ°æ°ç»ï¼éåæ§çåå¸æ¡¶æ°ç»ä¸­çæ¯ä¸ªåç´ ï¼å°å¶éæ°è®¡ç®åå¸å¼åæ¾å¥æ°çåå¸æ¡¶æ°ç»ä¸­ãè¿æ¯ä¸ä¸ªèæ¶æä½ï¼ä½åªéè¦è¿è¡ä¸æ¬¡ã\n 3. æ´æ°å¼ç¨ï¼å° hashmap çåå¸æ¡¶æ°ç»å¼ç¨æåæ°çæ°ç»ï¼åæ¶æ´æ°éå¼ç­ä¿¡æ¯ã\n\næ©å®¹æä½ä¼å¨ hashmap çæå¥æä½ä¸­è§¦åï¼å·ä½çè§¦åæ¶æºæ¯å½åç´ æ°éè¶è¿äºè´è½½å å­ä¹ä»¥å½åæ°ç»å®¹éæ¶ãé»è®¤æåµä¸ï¼è´è½½å å­ä¸º 0.75ï¼å³å½åç´ æ°éè¶è¿å½åæ°ç»å®¹éç 75% æ¶ï¼ä¼è§¦åæ©å®¹ã\n\n\n# æ©å®¹å¨ä»ä¹æ¶åå¢ï¼ä¸ºä»ä¹æ©å®¹å å­æ¯ 0.75ï¼\n\nhashmap å¨è¿è¡æ©å®¹çæ¶åï¼éå¸¸æ¯å½å½åå®¹å¨ä¸­çåç´ æ°éè¶è¿äºå®¹å¨å¤§å°ç 75% æ¶è§¦åæ©å®¹æä½ã\n\nè¿ä¸ªæ©å®¹å å­ï¼load factorï¼çéæ©æ¯ä¸ºäºå¨ç©ºé´åæ¶é´ä¸è¾¾å°ä¸ä¸ªå¹³è¡¡ï¼ä»èä¿è¯ hashmap å¨ä¸è³äºæµªè´¹è¿å¤åå­çæåµä¸ï¼ä»è½ä¿æè¾ä½çåå¸å²çªï¼æä¾é«æçæ¥æ¾ãæå¥åå é¤æä½ã\n\nä¸ºä»ä¹æ©å®¹å å­éæ© 0.75 å¢ï¼\n\nè¿æ¯ä¸ä¸ªæä¸­çéæ©ï¼èèäºæ¶é´åç©ºé´çå¹³è¡¡ãå¦ææ©å®¹å å­è®¾ç½®å¾å¤ªå°ï¼ä¼å¯¼è´åå¸å²çªè¿å¤ï¼å½±åäº hashmap çæ§è½ï¼å¦æè®¾ç½®å¾å¤ªå¤§ï¼è½ç¶åå¸å²çªå¯è½åå°ï¼ä½æ¯ä¼å¯¼è´ hashmap å ç¨æ´å¤çåå­ç©ºé´ã\n\n\n# ä¸ºä»ä¹æ¯ 2 åï¼\n\nä½¿ç¨ 2 çæ¬¡å¹ä½ä¸ºæ°ç»çå®¹éå¯ä»¥ç¡®ä¿ hashcode çé«ä½åä½ä½è½å¤æ´å¥½å°åååå¸å¨æ°ç»çç´¢å¼ä½ç½®ä¸ãè¿æ ·ä¸æ¥ï¼å¨è®¡ç®åç´ å­æ¾ä½ç½®æ¶ï¼åªéè¦è¿è¡ä½è¿ç®ï¼èä¸éè¦ä½¿ç¨åæ¨¡ç­èæ¶çæä½ï¼æé«äºè®¡ç®æçã\n\nå¦å¤ï¼ä½¿ç¨ 2 çæ¬¡å¹ä½ä¸ºå®¹éä¹æ¹ä¾¿è¿è¡æ©å®¹æä½ï¼å ä¸º 2 çæ¬¡å¹çäºè¿å¶è¡¨ç¤ºåªæä¸ä¸ª 1ï¼è¿æ ·å¨æ©å®¹æ¶åªéè¦å°é«ä½å¤åºç 1 åä¸º 0ï¼å°±å¯ä»¥å¾å°æ°çå®¹éãè¿ç§è®¾è®¡å¯ä»¥åå°åå­ç©ºé´çæµªè´¹ã\n\næ»çæ¥è¯´å°±æ¯ï¼\n\n * è¿æ ·è®¾è®¡å¨è®¡ç®åç´ å­æ¾ä½ç½®æ¶å¯ä»¥æé«è®¡ç®æçï¼\n * å¨è¿è¡æ©å®¹æ¶å¯ä»¥åå°åå­ç©ºé´çæµªè´¹ã\n * æ¢æé«äºæçååå°äºæ¶é´ã\n\n> é«ä½æ¯å¨å·¦è¾¹',charsets:{cjk:!0}},{title:"Javaå¹¶ååºç¡å°ç»",frontmatter:{title:"Javaå¹¶ååºç¡å°ç»",date:"2023-06-12T22:24:58.000Z",permalink:"/pages/846d88/",author:{name:"éä¸æ¸é£",link:"https://msqfx.github.io"},categories:["java","å¹¶åç¯"],tags:[null],description:"è¿ç¨æ¯ç³»ç»è¿è¡ç¨åºçåºæ¬åä½ï¼æä»¬è®¡ç®æºå¯å¨çæ¯ä¸ä¸ªåºç¨ç¨åºé½æ¯ä¸ä¸ªè¿ç¨ãå¦ä¸å¾æç¤ºï¼å¨ Windows ä¸­è¿ä¸ä¸ªä¸ª exe æä»¶ï¼é½æ¯ä¸ä¸ªè¿ç¨ãèå¨ JVM ä¸ï¼æ¯ä¸ä¸ªå¯å¨ç Main æ¹æ³é½å¯ä»¥çä½ä¸ä¸ªè¿ç¨ã",comment:!0,meta:[{name:"image",content:"https://cmty256.github.io/imgs-blog/Java/image.1nbsrx7zj5ds.webp"},{name:"twitter:title",content:"Javaå¹¶ååºç¡å°ç»"},{name:"twitter:description",content:"è¿ç¨æ¯ç³»ç»è¿è¡ç¨åºçåºæ¬åä½ï¼æä»¬è®¡ç®æºå¯å¨çæ¯ä¸ä¸ªåºç¨ç¨åºé½æ¯ä¸ä¸ªè¿ç¨ãå¦ä¸å¾æç¤ºï¼å¨ Windows ä¸­è¿ä¸ä¸ªä¸ª exe æä»¶ï¼é½æ¯ä¸ä¸ªè¿ç¨ãèå¨ JVM ä¸ï¼æ¯ä¸ä¸ªå¯å¨ç Main æ¹æ³é½å¯ä»¥çä½ä¸ä¸ªè¿ç¨ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://cmty256.github.io/imgs-blog/Java/image.1nbsrx7zj5ds.webp"},{name:"twitter:url",content:"https://www.msqfx.cc/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/01.Java%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80%E5%B0%8F%E7%BB%93.html"},{property:"og:type",content:"article"},{property:"og:title",content:"Javaå¹¶ååºç¡å°ç»"},{property:"og:description",content:"è¿ç¨æ¯ç³»ç»è¿è¡ç¨åºçåºæ¬åä½ï¼æä»¬è®¡ç®æºå¯å¨çæ¯ä¸ä¸ªåºç¨ç¨åºé½æ¯ä¸ä¸ªè¿ç¨ãå¦ä¸å¾æç¤ºï¼å¨ Windows ä¸­è¿ä¸ä¸ªä¸ª exe æä»¶ï¼é½æ¯ä¸ä¸ªè¿ç¨ãèå¨ JVM ä¸ï¼æ¯ä¸ä¸ªå¯å¨ç Main æ¹æ³é½å¯ä»¥çä½ä¸ä¸ªè¿ç¨ã"},{property:"og:image",content:"https://cmty256.github.io/imgs-blog/Java/image.1nbsrx7zj5ds.webp"},{property:"og:url",content:"https://www.msqfx.cc/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/01.Java%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80%E5%B0%8F%E7%BB%93.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-06-12T22:24:58.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"Javaå¹¶ååºç¡å°ç»"},{itemprop:"description",content:"è¿ç¨æ¯ç³»ç»è¿è¡ç¨åºçåºæ¬åä½ï¼æä»¬è®¡ç®æºå¯å¨çæ¯ä¸ä¸ªåºç¨ç¨åºé½æ¯ä¸ä¸ªè¿ç¨ãå¦ä¸å¾æç¤ºï¼å¨ Windows ä¸­è¿ä¸ä¸ªä¸ª exe æä»¶ï¼é½æ¯ä¸ä¸ªè¿ç¨ãèå¨ JVM ä¸ï¼æ¯ä¸ä¸ªå¯å¨ç Main æ¹æ³é½å¯ä»¥çä½ä¸ä¸ªè¿ç¨ã"},{itemprop:"image",content:"https://cmty256.github.io/imgs-blog/Java/image.1nbsrx7zj5ds.webp"}],readingShow:"top"},regularPath:"/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/01.Java%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80%E5%B0%8F%E7%BB%93.html",relativePath:"01.java/03.å¹¶åç¯/01.Javaå¹¶ååºç¡å°ç».md",key:"v-6bd8e8aa",path:"/pages/846d88/",headers:[{level:2,title:"çº¿ç¨åè¿ç¨çåºå«",slug:"çº¿ç¨åè¿ç¨çåºå«",normalizedTitle:"çº¿ç¨åè¿ç¨çåºå«",charIndex:17},{level:3,title:"ä»ä¹æ¯è¿ç¨ï¼",slug:"ä»ä¹æ¯è¿ç¨",normalizedTitle:"ä»ä¹æ¯è¿ç¨ï¼",charIndex:30},{level:3,title:"ä»ä¹æ¯çº¿ç¨ï¼",slug:"ä»ä¹æ¯çº¿ç¨",normalizedTitle:"ä»ä¹æ¯çº¿ç¨ï¼",charIndex:151},{level:3,title:"åºå«",slug:"åºå«",normalizedTitle:"åºå«",charIndex:23},{level:2,title:"å åæ¹æ³åºäºè§£åï¼",slug:"å åæ¹æ³åºäºè§£å",normalizedTitle:"å åæ¹æ³åºäºè§£åï¼",charIndex:687},{level:2,title:"å¹¶åä¸å¹¶è¡çåºå«",slug:"å¹¶åä¸å¹¶è¡çåºå«",normalizedTitle:"å¹¶åä¸å¹¶è¡çåºå«",charIndex:814},{level:2,title:"åæ­¥åå¼æ­¥çåºå«",slug:"åæ­¥åå¼æ­¥çåºå«",normalizedTitle:"åæ­¥åå¼æ­¥çåºå«",charIndex:903},{level:2,title:"ä¸ºä»ä¹è¦ä½¿ç¨å¤çº¿ç¨?",slug:"ä¸ºä»ä¹è¦ä½¿ç¨å¤çº¿ç¨",normalizedTitle:"ä¸ºä»ä¹è¦ä½¿ç¨å¤çº¿ç¨?",charIndex:991},{level:2,title:"è¯´è¯´çº¿ç¨ççå½å¨æåç¶æï¼",slug:"è¯´è¯´çº¿ç¨ççå½å¨æåç¶æ",normalizedTitle:"è¯´è¯´çº¿ç¨ççå½å¨æåç¶æï¼",charIndex:1223},{level:2,title:"å¦ä½åå»ºä¸ä¸ªçº¿ç¨ï¼",slug:"å¦ä½åå»ºä¸ä¸ªçº¿ç¨",normalizedTitle:"å¦ä½åå»ºä¸ä¸ªçº¿ç¨ï¼",charIndex:2033},{level:2,title:"ä»ä¹æ¯çº¿ç¨ä¸ä¸æåæ¢?",slug:"ä»ä¹æ¯çº¿ç¨ä¸ä¸æåæ¢",normalizedTitle:"ä»ä¹æ¯çº¿ç¨ä¸ä¸æåæ¢?",charIndex:3398},{level:2,title:"sleep() å wait() æ¹æ³å¯¹æ¯",slug:"sleep-å-wait-æ¹æ³å¯¹æ¯",normalizedTitle:"sleep() å wait() æ¹æ³å¯¹æ¯",charIndex:3903},{level:3,title:"å±åç¹",slug:"å±åç¹",normalizedTitle:"å±åç¹",charIndex:3929},{level:3,title:"åºå«",slug:"åºå«-2",normalizedTitle:"åºå«",charIndex:23},{level:2,title:"ä¸ºä»ä¹ wait() æ¹æ³ä¸å®ä¹å¨ Thread ä¸­ï¼",slug:"ä¸ºä»ä¹-wait-æ¹æ³ä¸å®ä¹å¨-thread-ä¸­",normalizedTitle:"ä¸ºä»ä¹ wait() æ¹æ³ä¸å®ä¹å¨ thread ä¸­ï¼",charIndex:4230},{level:3,title:"ä»ä¹æ¯å¯¹è±¡é",slug:"ä»ä¹æ¯å¯¹è±¡é",normalizedTitle:"ä»ä¹æ¯å¯¹è±¡é",charIndex:4799},{level:2,title:"ä¸ºä»ä¹ sleep() æ¹æ³å®ä¹å¨ Thread ä¸­ï¼",slug:"ä¸ºä»ä¹-sleep-æ¹æ³å®ä¹å¨-thread-ä¸­",normalizedTitle:"ä¸ºä»ä¹ sleep() æ¹æ³å®ä¹å¨ thread ä¸­ï¼",charIndex:4977},{level:2,title:"å¯ä»¥ç´æ¥è°ç¨ Thread ç±»ç run æ¹æ³åï¼",slug:"å¯ä»¥ç´æ¥è°ç¨-thread-ç±»ç-run-æ¹æ³å",normalizedTitle:"å¯ä»¥ç´æ¥è°ç¨ thread ç±»ç run æ¹æ³åï¼",charIndex:5051},{level:2,title:"å®æ¤çº¿ç¨äºè§£åï¼",slug:"å®æ¤çº¿ç¨äºè§£å",normalizedTitle:"å®æ¤çº¿ç¨äºè§£åï¼",charIndex:5362},{level:2,title:"è®²ä¸ä¸ JMM(Java åå­æ¨¡å)",slug:"è®²ä¸ä¸-jmm-java-åå­æ¨¡å",normalizedTitle:"è®²ä¸ä¸ jmm(java åå­æ¨¡å)",charIndex:5684},{level:2,title:"AQS",slug:"aqs",normalizedTitle:"aqs",charIndex:6521},{level:3,title:"ä»ä¹æ¯ AQS",slug:"ä»ä¹æ¯-aqs",normalizedTitle:"ä»ä¹æ¯ aqs",charIndex:6529},{level:3,title:"AQS åçäºè§£ä¹ï¼",slug:"aqs-åçäºè§£ä¹",normalizedTitle:"aqs åçäºè§£ä¹ï¼",charIndex:6640},{level:3,title:"ç¨è¿ CountDownLatch ä¹ï¼ä»ä¹åºæ¯ä¸ç¨çï¼",slug:"ç¨è¿-countdownlatch-ä¹-ä»ä¹åºæ¯ä¸ç¨ç",normalizedTitle:"ç¨è¿ countdownlatch ä¹ï¼ä»ä¹åºæ¯ä¸ç¨çï¼",charIndex:6813},{level:2,title:"åèæç®",slug:"åèæç®",normalizedTitle:"åèæç®",charIndex:7415}],headersStr:"çº¿ç¨åè¿ç¨çåºå« ä»ä¹æ¯è¿ç¨ï¼ ä»ä¹æ¯çº¿ç¨ï¼ åºå« å åæ¹æ³åºäºè§£åï¼ å¹¶åä¸å¹¶è¡çåºå« åæ­¥åå¼æ­¥çåºå« ä¸ºä»ä¹è¦ä½¿ç¨å¤çº¿ç¨? è¯´è¯´çº¿ç¨ççå½å¨æåç¶æï¼ å¦ä½åå»ºä¸ä¸ªçº¿ç¨ï¼ ä»ä¹æ¯çº¿ç¨ä¸ä¸æåæ¢? sleep() å wait() æ¹æ³å¯¹æ¯ å±åç¹ åºå« ä¸ºä»ä¹ wait() æ¹æ³ä¸å®ä¹å¨ Thread ä¸­ï¼ ä»ä¹æ¯å¯¹è±¡é ä¸ºä»ä¹ sleep() æ¹æ³å®ä¹å¨ Thread ä¸­ï¼ å¯ä»¥ç´æ¥è°ç¨ Thread ç±»ç run æ¹æ³åï¼ å®æ¤çº¿ç¨äºè§£åï¼ è®²ä¸ä¸ JMM(Java åå­æ¨¡å) AQS ä»ä¹æ¯ AQS AQS åçäºè§£ä¹ï¼ ç¨è¿ CountDownLatch ä¹ï¼ä»ä¹åºæ¯ä¸ç¨çï¼ åèæç®",content:'# Javaå¹¶ååºç¡å°ç»\n\n\n# çº¿ç¨åè¿ç¨çåºå«\n\n\n# ä»ä¹æ¯è¿ç¨ï¼\n\nè¿ç¨æ¯ç³»ç»è¿è¡ç¨åºçåºæ¬åä½ï¼æä»¬è®¡ç®æºå¯å¨çæ¯ä¸ä¸ªåºç¨ç¨åºé½æ¯ä¸ä¸ªè¿ç¨ãå¦ä¸å¾æç¤ºï¼å¨ Windows ä¸­è¿ä¸ä¸ªä¸ª exe æä»¶ï¼é½æ¯ä¸ä¸ªè¿ç¨ãèå¨ JVM ä¸ï¼æ¯ä¸ä¸ªå¯å¨ç Main æ¹æ³é½å¯ä»¥çä½ä¸ä¸ªè¿ç¨ã\n\n\n\n\n# ä»ä¹æ¯çº¿ç¨ï¼\n\nçº¿ç¨æ¯ä¸ä¸ªæ¯è¿ç¨æ´å°çæ§è¡åä½ï¼æ¯ CPU è°åº¦çåºæ¬åä½ãä¸ä¸ªè¿ç¨å¨å¶æ§è¡çè¿ç¨ä¸­å¯ä»¥äº§çå¤ä¸ªçº¿ç¨ãæä»¥å¨è¿è¡çº¿ç¨åæ¢æ¶çå¼éä¼è¿è¿å°äºè¿ç¨ï¼çº¿ç¨ä¹å¸¸å¸¸è¢«ç§°ä¸ºè½»éçº§è¿ç¨ã\n\nä¸è¿ç¨ä¸åçæ¯åç±»çå¤ä¸ªçº¿ç¨å±äº«è¿ç¨çå åæ¹æ³åºèµæºï¼ä½æ¯ä¸ªçº¿ç¨æèªå·±çç¨åºè®¡æ°å¨ãèææºæ åæ¬å°æ¹æ³æ ã\n\n\n# åºå«\n\n 1. çº¿ç¨æ¯è½»éçº§çæ§è¡ååï¼èè¿ç¨æ¯ééçº§çæ§è¡ååãå¨ Java ä¸­ï¼çº¿ç¨ç± Java èææºæ¥åå»ºåç®¡çï¼ä¸ä¸ªè¿ç¨å¯ä»¥åå«å¤ä¸ªçº¿ç¨ã\n 2. çº¿ç¨å±äº«è¿ç¨çåå­ç©ºé´åèµæºï¼å¯ä»¥éè¿å±äº«åå­æ¥è¿è¡éä¿¡ååæ­¥ãè¿ç¨æ¥æèªå·±çåå­ç©ºé´åèµæºï¼éè¦éè¿è¿ç¨é´éä¿¡ï¼IPCï¼æ¥è¿è¡éä¿¡ååæ­¥ã\n 3. çº¿ç¨ä¹é´çåæ¢å¼éæ¯è¿ç¨å°ï¼å ä¸ºçº¿ç¨å±äº«è¿ç¨çèµæºï¼ä¸éè¦åæ¢è¿ç¨çåå­ç©ºé´åèµæºãçº¿ç¨ä¹é´çåæ¢åªéè¦åæ¢çº¿ç¨çæ§è¡ä¸ä¸æå³å¯ã\n 4. çº¿ç¨ä¹é´çåæ­¥åéä¿¡æ¯è¿ç¨æ´å®¹æï¼å ä¸ºçº¿ç¨ä¹é´å±äº«è¿ç¨çåå­ç©ºé´ï¼å¯ä»¥ç´æ¥å±äº«æ°æ®åå¯¹è±¡ãèè¿ç¨ä¹é´éè¦éè¿ IPC æºå¶æ¥è¿è¡éä¿¡ååæ­¥ï¼å¼éè¾å¤§ã\n 5. çº¿ç¨ççå½å¨æåå°è¿ç¨çå½±åï¼ä¸ä¸ªè¿ç¨éåºæ¶ï¼å®åå«çææçº¿ç¨é½ä¼è¢«å¼ºå¶éåºãèè¿ç¨ççå½å¨æä¸åå¶ä»è¿ç¨çå½±åï¼ä¸ä¸ªè¿ç¨å¯ä»¥ç¬ç«äºå¶ä»è¿ç¨è¿è¡ã\n\n\n# å åæ¹æ³åºäºè§£åï¼\n\nå åæ¹æ³åºæ¯ææçº¿ç¨å±äº«çèµæºã\n\n * å¶ä¸­å æ¯è¿ç¨ä¸­æå¤§çä¸ååå­ï¼ä¸»è¦ç¨äºå­æ¾æ°åå»ºçå¯¹è±¡ (å ä¹ææå¯¹è±¡é½å¨è¿éåéåå­)ï¼\n * æ¹æ³åºä¸»è¦ç¨äºå­æ¾å·²è¢«å è½½çç±»ä¿¡æ¯ãå¸¸éãéæåéãå³æ¶ç¼è¯å¨ç¼è¯åçä»£ç ç­æ°æ®ã\n\n\n# å¹¶åä¸å¹¶è¡çåºå«\n\n * å¹¶åï¼ä¸¤ä¸ªåä¸¤ä¸ªä»¥ä¸çä½ä¸å¨åä¸ æ¶é´æ®µ åæ§è¡ã\n * å¹¶è¡ï¼ä¸¤ä¸ªåä¸¤ä¸ªä»¥ä¸çä½ä¸å¨åä¸ æ¶å» æ§è¡ã\n\næå³é®çç¹æ¯ï¼æ¯å¦æ¯ åæ¶ æ§è¡ã\n\n\n# åæ­¥åå¼æ­¥çåºå«\n\n * åæ­¥ï¼ååºä¸ä¸ªè°ç¨ä¹åï¼å¨æ²¡æå¾å°ç»æä¹åï¼ è¯¥è°ç¨å°±ä¸å¯ä»¥è¿åï¼ä¸ç´ç­å¾ã\n * å¼æ­¥ï¼è°ç¨å¨ååºä¹åï¼ä¸ç¨ç­å¾è¿åç»æï¼è¯¥è°ç¨ç´æ¥è¿åã\n\n\n# ä¸ºä»ä¹è¦ä½¿ç¨å¤çº¿ç¨?\n\nä¸»è¦æ¯ä¸ºäºæé«ç¨åºçæ§è½åå¹¶åè½åã\n\n * **ä»è®¡ç®æºåºå±æ¥è¯´ï¼**çº¿ç¨å¯ä»¥æ¯ä½æ¯è½»éçº§çè¿ç¨ï¼æ¯ç¨åºæ§è¡çæå°åä½ï¼çº¿ç¨é´çåæ¢åè°åº¦çææ¬è¿è¿å°äºè¿ç¨ãå¦å¤ï¼å¤æ ¸ CPU æ¶ä»£æå³çå¤ä¸ªçº¿ç¨å¯ä»¥åæ¶è¿è¡ï¼è¿åå°äºçº¿ç¨ä¸ä¸æåæ¢çå¼éã\n * **ä»å½ä»£äºèç½åå±è¶å¿æ¥è¯´ï¼**ç°å¨çç³»ç»å¨ä¸å¨å°±è¦æ±ç¾ä¸çº§çè³åä¸çº§çå¹¶åéï¼èå¤çº¿ç¨å¹¶åç¼ç¨æ­£æ¯å¼åé«å¹¶åç³»ç»çåºç¡ï¼å©ç¨å¥½å¤çº¿ç¨æºå¶å¯ä»¥å¤§å¤§æé«ç³»ç»æ´ä½çå¹¶åè½åä»¥åæ§è½ã\n\n\n# è¯´è¯´çº¿ç¨ççå½å¨æåç¶æï¼\n\nJava çº¿ç¨å¨è¿è¡ççå½å¨æä¸­çæå®æ¶å»åªå¯è½å¤äºä¸é¢ 6 ç§ä¸åç¶æçå¶ä¸­ä¸ä¸ªç¶æï¼\n\n 1. NEW: åå§ç¶æï¼çº¿ç¨è¢«åå»ºåºæ¥ä½æ²¡æè¢«è°ç¨ start() ã\n 2. RUNNABLE: è¿è¡ç¶æï¼çº¿ç¨è¢«è°ç¨äº start() ç­å¾è¿è¡çç¶æã\n 3. BLOCKEDï¼é»å¡ç¶æï¼éè¦ç­å¾ééæ¾ã\n 4. WAITINGï¼ç­å¾ç¶æï¼è¡¨ç¤ºè¯¥çº¿ç¨éè¦ç­å¾å¶ä»çº¿ç¨ååºä¸äºç¹å®å¨ä½ï¼éç¥æä¸­æ­ï¼ã\n 5. TIME_WAITINGï¼è¶æ¶ç­å¾ç¶æï¼å¯ä»¥å¨æå®çæ¶é´åèªè¡è¿åèä¸æ¯å WAITING é£æ ·ä¸ç´ç­å¾ã\n 6. TERMINATEDï¼ç»æ­¢ç¶æï¼è¡¨ç¤ºè¯¥çº¿ç¨å·²ç»è¿è¡å®æ¯ã\n\nçº¿ç¨å¨çå½å¨æä¸­å¹¶ä¸æ¯åºå®å¤äºæä¸ä¸ªç¶æèæ¯éçä»£ç çæ§è¡å¨ä¸åç¶æä¹é´åæ¢ã\n\nå·ä½æ¥è¯´ï¼\n\n 1. çº¿ç¨åå»ºä¹åå®å°å¤äº **NEWï¼æ°å»ºï¼**ç¶æï¼\n\n 2. è°ç¨ start() æ¹æ³åå¼å§è¿è¡ï¼çº¿ç¨è¿æ¶åå¤äº **READYï¼å¯è¿è¡ï¼**ç¶æã\n\n 3. å¯è¿è¡ç¶æççº¿ç¨è·å¾äº CPU æ¶é´çï¼timesliceï¼åå°±å¤äº **RUNNINGï¼è¿è¡ï¼**ç¶æã\n    \n    * TIMED_WAITING(è¶æ¶ç­å¾) ç¶æç¸å½äºå¨ç­å¾ç¶æçåºç¡ä¸å¢å äºè¶æ¶éå¶ï¼æ¯å¦éè¿ sleepï¼long millisï¼æ¹æ³æ waitï¼long millisï¼æ¹æ³å¯ä»¥å°çº¿ç¨ç½®äº TIMED_WAITING ç¶æãå½è¶æ¶æ¶é´ç»æåï¼çº¿ç¨å°ä¼è¿åå° RUNNABLE ç¶æã\n    * å½çº¿ç¨è¿å¥ synchronized æ¹æ³/åæèè°ç¨ wait åï¼è¢« notifyï¼éæ°è¿å¥ synchronized æ¹æ³/åï¼ä½æ¯éè¢«å¶å®çº¿ç¨å æï¼è¿ä¸ªæ¶åçº¿ç¨å°±ä¼è¿å¥ BLOCKEDï¼é»å¡ï¼ ç¶æã\n\n 4. çº¿ç¨å¨æ§è¡å®äº run()æ¹æ³ä¹åå°ä¼è¿å¥å° TERMINATEDï¼ç»æ­¢ï¼ ç¶æã\n\n\n# å¦ä½åå»ºä¸ä¸ªçº¿ç¨ï¼\n\nå¸¸è§çæ 5 ç§æ¹å¼ï¼\n\n 1. ç»§æ¿ Thread ç±»ï¼ è¿æ¯ä¸ç§æ¯è¾ä¼ ç»çåå»ºçº¿ç¨çæ¹å¼ãä½ å¯ä»¥åå»ºä¸ä¸ªç±»ï¼ç»§æ¿èª Thread ç±»ï¼å¹¶éå run æ¹æ³æ¥å®ä¹çº¿ç¨çæ§è¡é»è¾ã\n\nclass MyThread extends Thread {\n    @Override\n    public void run() {\n        // çº¿ç¨çæ§è¡é»è¾\n    }\n}\n\n// åå»ºå¹¶å¯å¨çº¿ç¨\nMyThread thread = new MyThread();\nthread.start();\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n 2. å®ç° Runnable æ¥å£ï¼è¿ç§æ¹å¼æ´å¸¸ç¨ï¼å®é¿åäº Java çåç»§æ¿éå¶ï¼ä½ å¯ä»¥å®ç° Runnable æ¥å£ï¼ç¶åå°å¶å®ä¾ä½ä¸ºåæ°ä¼ éç» Thread æé å½æ°ã\n\nclass MyRunnable implements Runnable {\n    @Override\n    public void run() {\n        // çº¿ç¨çæ§è¡é»è¾\n    }\n}\n\n// åå»ºå¹¶å¯å¨çº¿ç¨\nThread thread = new Thread(new MyRunnable());\nthread.start();\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n 3. ä½¿ç¨å¿ååé¨ç±»ï¼ä½ å¯ä»¥å¨åå»ºçº¿ç¨æ¶ä½¿ç¨å¿ååé¨ç±»ï¼å®ç° Runnable æ¥å£ç run æ¹æ³ã\n\nThread thread = new Thread(new Runnable() {\n    @Override\n    public void run() {\n        // çº¿ç¨çæ§è¡é»è¾\n    }\n});\nthread.start();\n\n\n1\n2\n3\n4\n5\n6\n7\n\n 4. ä½¿ç¨ Java 8 ç Lambda è¡¨è¾¾å¼ï¼å¦æ Runnable æ¥å£åªæä¸ä¸ªæ½è±¡æ¹æ³ï¼ä½ å¯ä»¥ä½¿ç¨ Lambda è¡¨è¾¾å¼ç®åä»£ç ã\n\nThread thread = new Thread(() -> {\n    // çº¿ç¨çæ§è¡é»è¾\n});\nthread.start();\n\n\n1\n2\n3\n4\n\n 5. å®ç° Callable æ¥å£ï¼ Callable æ¥å£åè®¸çº¿ç¨è¿åç»æææåºå¼å¸¸ãéè¦éè¿ ExecutorService æ¥æ§è¡ã\n\nclass MyCallable implements Callable<String> {\n    @Override\n    public String call() throws Exception {\n        // çº¿ç¨çæ§è¡é»è¾\n        return "Hello from Callable";\n    }\n}\n\nExecutorService executor = Executors.newFixedThreadPool(1);\nFuture<String> future = executor.submit(new MyCallable());\nString result = future.get(); // è·åçº¿ç¨æ§è¡ç»æ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# ä»ä¹æ¯çº¿ç¨ä¸ä¸æåæ¢?\n\nçº¿ç¨ä¸ä¸æåæ¢æ¯æï¼CPU ä»ä¸ä¸ªçº¿ç¨ä¸­æ­æ§è¡è½¬èæ§è¡å¦ä¸ä¸ªçº¿ç¨çè¿ç¨ã\n\nå¨å¤çº¿ç¨ç¼ç¨ä¸­ï¼çº¿ç¨ä¸ä¸æåæ¢æ¯éå¸¸å¸¸è§çæä½ã\n\nè¿ä¸ªè¿ç¨éè¦èè´¹ä¸å®çæ¶é´åèµæºï¼å æ­¤çº¿ç¨ä¸ä¸æåæ¢çé¢ç¹åçä¼å¯¼è´ç³»ç»çæ§è½ä¸éã\n\n\n\n> 1ãä»ä¹æ¯ä¸ä¸æ\n\nçº¿ç¨å¨æ§è¡è¿ç¨ä¸­ä¼æèªå·±çè¿è¡æ¡ä»¶åç¶æï¼ä¹ç§°ä¸ä¸æï¼ã\n\næ¯å¦ç¨åºè®¡æ°å¨ï¼æ ä¿¡æ¯ç­ãå½åºç°å¦ä¸æåµçæ¶åï¼çº¿ç¨ä¼ä»å ç¨ CPU ç¶æä¸­éåºãï¼ä¸ä¸æåæ¢éå¸¸åçå¨ä»¥ä¸å ç§æåµï¼\n\n * ä¸»å¨è®©åº CPUï¼æ¯å¦è°ç¨äº sleep(), wait() ç­ã\n * æ¶é´çç¨å®ï¼å ä¸ºæä½ç³»ç»è¦é²æ­¢ä¸ä¸ªçº¿ç¨æèè¿ç¨é¿æ¶é´å ç¨ CPU å¯¼è´å¶ä»çº¿ç¨æèè¿ç¨é¥¿æ­»ã\n * è°ç¨äºé»å¡ç±»åçç³»ç»ä¸­æ­ï¼æ¯å¦è¯·æ± IOï¼çº¿ç¨è¢«é»å¡ã\n * è¢«ç»æ­¢æç»æè¿è¡ã\n\n> 2ãä¸ºäºåå°çº¿ç¨ä¸ä¸æåæ¢å¸¦æ¥çæ§è½æå¤±ï¼å¯ä»¥éåä»¥ä¸æªæ½ï¼\n\n * åå°çº¿ç¨æ°ï¼é¿åæ è°çä¸ä¸æåæ¢ï¼\n * éç¨çº¿ç¨æ± ææ¯ï¼é¿åçº¿ç¨çé¢ç¹åå»ºåéæ¯ï¼\n * ä½¿ç¨éé»å¡å¼ I/Oï¼é¿åçº¿ç¨ç­å¾ I/O å®ææ¶çä¸ä¸æåæ¢ï¼\n * ä¼åçº¿ç¨çè°åº¦ç®æ³ï¼åå°çº¿ç¨ä¸ä¸æåæ¢çæ¬¡æ°ã\n\n\n# sleep() å wait() æ¹æ³å¯¹æ¯\n\n\n# å±åç¹\n\nä¸¤èé½å¯ä»¥æåçº¿ç¨çæ§è¡ã\n\n\n# åºå«\n\n 1. sleep() æ¹æ³æ²¡æéæ¾éï¼è wait() æ¹æ³éæ¾äºé ã\n 2. wait() éå¸¸è¢«ç¨äºçº¿ç¨é´äº¤äº/éä¿¡ï¼sleep() éå¸¸è¢«ç¨äºæåæ§è¡ã\n 3. wait() æ¹æ³è¢«è°ç¨åï¼çº¿ç¨ä¸ä¼èªå¨èéï¼éè¦å«ççº¿ç¨è°ç¨åä¸ä¸ªå¯¹è±¡ä¸ç notify() æè notifyAll() æ¹æ³ãsleep() æ¹æ³æ§è¡å®æåï¼çº¿ç¨ä¼èªå¨èéï¼æèä¹å¯ä»¥ä½¿ç¨ wait(long timeout) è¶æ¶åçº¿ç¨ä¼èªå¨èéã\n 4. sleep() æ¯ Thread ç±»çéææ¬å°æ¹æ³ï¼wait() åæ¯ Object ç±»çæ¬å°æ¹æ³ã\n\n\n# ä¸ºä»ä¹ wait() æ¹æ³ä¸å®ä¹å¨ Thread ä¸­ï¼\n\nå ä¸º wait() æ¯è®©è·å¾å¯¹è±¡éççº¿ç¨å®ç°ç­å¾ï¼ä¼èªå¨éæ¾å½åçº¿ç¨å æçå¯¹è±¡éã\n\n>  * è¿å¥è¯æåºäº wait() æ¹æ³çä¸¤ä¸ªå³é®ä½ç¨ï¼ç­å¾åéæ¾å¯¹è±¡éã\n>  * å½ä¸ä¸ªçº¿ç¨è°ç¨äºå¯¹è±¡ç wait() æ¹æ³ï¼å®ä¼è¿å¥ç­å¾ç¶æï¼ç­å¾å¶ä»çº¿ç¨éè¿ notify() æ notifyAll() æ¹æ³å¤éå®ã\n>  * åæ¶ï¼è¯¥çº¿ç¨ä¼èªå¨éæ¾å®å½åå æçå¯¹è±¡éï¼è¿ä½¿å¾å¶ä»ç­å¾è¿ä¸ªå¯¹è±¡éççº¿ç¨ææºä¼è·å¾éå¹¶æ§è¡ä¸´çåºä»£ç ã\n\næ¯ä¸ªå¯¹è±¡ï¼Objectï¼é½æ¥æå¯¹è±¡éï¼æ¢ç¶è¦éæ¾å½åçº¿ç¨å æçå¯¹è±¡éå¹¶è®©å¶è¿å¥ WAITING ç¶æï¼èªç¶æ¯è¦æä½å¯¹åºçå¯¹è±¡ï¼Objectï¼èéå½åççº¿ç¨ï¼Threadï¼ã\n\nwait() æ¹æ³æ¯éå¯¹å¯¹è±¡éè¿è¡æä½ï¼èä¸æ¯éå¯¹çº¿ç¨æ¬èº«çæä½ã\n\n>  * è¿å¥è¯å¼ºè°äºå¯¹è±¡éæ¯åå¯¹è±¡ç»å®çï¼èä¸æ¯ä¸çº¿ç¨ç»å®çã\n>  * æ¯ä¸ª Java å¯¹è±¡é½æä¸ä¸ªå³èçå¯¹è±¡éï¼çè§å¨éï¼ï¼è¿ä¸ªéç¨äºå¯¹è¯¥å¯¹è±¡çåæ­¥è®¿é®ã\n>  * å½çº¿ç¨è°ç¨äºæä¸ªå¯¹è±¡ç wait() æ¹æ³ï¼å®ä¼è®©åºè¿ä¸ªå¯¹è±¡çéï¼è®©å¶ä»çº¿ç¨ææºä¼è¿å¥ä¸´çåºææ§è¡åæ­¥ä»£ç ã\n>  * éæ¾çæ¯å¯¹è±¡éï¼èä¸æ¯å½åçº¿ç¨çéãè¿ä¹æ¯ä¸ºä»ä¹å¨ä½¿ç¨ wait() æ¶éè¦æç¡®è°ç¨çæ¯åªä¸ªå¯¹è±¡çéã\n\n\n# ä»ä¹æ¯å¯¹è±¡é\n\nå¯¹è±¡éæ¯ä¸ç§å¤çº¿ç¨åæ­¥æºå¶ï¼å®ç¨äºä¿æ¤å¯¹è±¡çç¶æåæä½ï¼ä»¥ç¡®ä¿å¨å¤çº¿ç¨ç¯å¢ä¸å¯¹è±¡çæ°æ®ä¸è´æ§åçº¿ç¨å®å¨æ§ã\n\nå¨ Java ä¸­ï¼æ¯ä¸ªå¯¹è±¡é½æä¸ä¸ªå³èçå¯¹è±¡éï¼ä¹ç§°ä¸ºçè§å¨éæåç½®éãå¯¹è±¡éçä½ç¨æ¯é²æ­¢å¤ä¸ªçº¿ç¨åæ¶è®¿é®ä¸ä¸ªå¯¹è±¡çä¸´çåºä»£ç ï¼ä»èé¿åå¹¶åè®¿é®é æçæ°æ®éè¯¯åä¸ä¸è´æ§ã\n\nå¯ç¨ synchronized å³é®å­æ¥å®ç°ã\n\n\n# ä¸ºä»ä¹ sleep() æ¹æ³å®ä¹å¨ Thread ä¸­ï¼\n\nå ä¸º sleep() æ¯è®©å½åçº¿ç¨æåæ§è¡ï¼ä¸æ¶åå°å¯¹è±¡ç±»ï¼ä¹ä¸éè¦è·å¾å¯¹è±¡éã\n\n\n# å¯ä»¥ç´æ¥è°ç¨ Thread ç±»ç run æ¹æ³åï¼\n\n 1. new ä¸ä¸ª Threadï¼çº¿ç¨è¿å¥äºæ°å»ºç¶æã\n 2. è°ç¨ start()æ¹æ³ï¼ä¼å¯å¨ä¸ä¸ªçº¿ç¨å¹¶ä½¿çº¿ç¨è¿å¥äºå°±ç»ªç¶æï¼å½åéå°æ¶é´çåå°±å¯ä»¥å¼å§è¿è¡äºã\n 3. start() ä¼æ§è¡çº¿ç¨çç¸åºåå¤å·¥ä½ï¼ç¶åèªå¨æ§è¡ run() æ¹æ³çåå®¹ï¼è¿æ¯çæ­£çå¤çº¿ç¨å·¥ä½ã\n\nä½æ¯ï¼ç´æ¥æ§è¡ run() æ¹æ³ï¼ä¼æ run() æ¹æ³å½æä¸ä¸ª main çº¿ç¨ä¸çæ®éæ¹æ³å»æ§è¡ï¼å¹¶ä¸ä¼å¨æä¸ªçº¿ç¨ä¸­æ§è¡å®ï¼æä»¥è¿å¹¶ä¸æ¯å¤çº¿ç¨å·¥ä½ã\n\næ»ç»ï¼\n\nè°ç¨ start() æ¹æ³æ¹å¯å¯å¨çº¿ç¨å¹¶ä½¿çº¿ç¨è¿å¥å°±ç»ªç¶æï¼ç´æ¥æ§è¡ run() æ¹æ³çè¯ä¸ä¼ä»¥å¤çº¿ç¨çæ¹å¼æ§è¡ã\n\n\n# å®æ¤çº¿ç¨äºè§£åï¼\n\nJava ä¸­ççº¿ç¨åä¸ºä¸¤ç±»ï¼åå«ä¸º daemon çº¿ç¨ï¼å®æ¤çº¿ç¨ï¼å user çº¿ç¨ï¼ç¨æ·çº¿ç¨ï¼ã\n\nå¨ JVM å¯å¨æ¶ä¼è°ç¨ main å½æ°ï¼main å½æ°æå¨ççº¿ç¨å°±æ¯ä¸ä¸ªç¨æ·çº¿ç¨ãå¶å®å¨ JVM åé¨åæ¶è¿å¯å¨äºå¾å¤å®æ¤çº¿ç¨ï¼å®æ¤çº¿ç¨æ¯ç¨æ¥æå¡ç¨æ·çº¿ç¨ççº¿ç¨ï¼æ¯å¦åå¾åæ¶çº¿ç¨ãå¤ç¨äºæ§è¡åå°ä»»å¡ã\n\né£ä¹å®æ¤çº¿ç¨åç¨æ·çº¿ç¨æä»ä¹åºå«å¢ï¼\n\nåºå«ä¹ä¸æ¯å½æåä¸ä¸ªéå®æ¤çº¿ç¨ææ¶ï¼JVM ä¼æ­£å¸¸éåºï¼èä¸ç®¡å½åæ¯å¦å­å¨å®æ¤çº¿ç¨ï¼ä¹å°±æ¯è¯´å®æ¤çº¿ç¨æ¯å¦ç»æå¹¶ä¸å½±å JVM éåºãæ¢èè¨ä¹ï¼åªè¦æä¸ä¸ªç¨æ·çº¿ç¨è¿æ²¡ç»æï¼æ­£å¸¸æåµä¸ JVM å°±ä¸ä¼éåºã\n\nç®åæ¥è¯´å°±æ¯ç¨æ·çº¿ç¨ä¼é»æ­¢ JVM çéåºï¼èå®æ¤çº¿ç¨ä¸ä¼ã\n\n\n# è®²ä¸ä¸ JMM(Java åå­æ¨¡å)\n\nJava åå­æ¨¡åï¼Java Memory Modelï¼JMMï¼æ¯ Java èææºè§èä¸­çä¸é¨åï¼å®å®ä¹äº Java ç¨åºä¸­åç§åéçè®¿é®æ¹å¼åå­å¨æ¹å¼ã\n\nJMM çä½ç¨æ¯ï¼è§£å³å¹¶åç¼ç¨ä¸­ççº¿ç¨å®å¨é®é¢ï¼ç¡®ä¿å¤çº¿ç¨ç¯å¢ä¸ç¨åºçæ­£ç¡®æ§åç¨³å®æ§ã\n\nä¸»è¦åæ¬ä»¥ä¸å ä¸ªæ¹é¢ï¼\n\n 1. ä¸»åå­åå·¥ä½åå­ï¼Java åå­æ¨¡åå°åå­åä¸ºä¸»åå­åå·¥ä½åå­ä¸¤é¨åã\n    \n    * ä¸»åå­æ¯ææçº¿ç¨å±äº«çåå­åºåï¼èæ¯ä¸ªçº¿ç¨é½æèªå·±çå·¥ä½åå­ï¼å·¥ä½åå­ä¸­ä¿å­äºè¯¥çº¿ç¨ä½¿ç¨å°çåéçå¯æ¬ã\n    \n    * çº¿ç¨ä¸è½ç´æ¥å¯¹ä¸»åå­è¿è¡æä½ï¼èæ¯éè¦åå°åéçå¯æ¬ä»ä¸»åå­ä¸­è¯»åå°å·¥ä½åå­ä¸­ï¼ç¶ååå¯¹åéè¿è¡æä½ï¼æä½å®æååå°åéçå¯æ¬ååå°ä¸»åå­ä¸­ã\n\n 2. åå­å±éï¼åå­å±éï¼Memory Barrierï¼æ¯ä¸ç§æºå¶ï¼ç¨äºç¡®ä¿çº¿ç¨ä¹é´çåå­å¯è§æ§åæä½çæåºæ§ã\n    \n    * JMM ä¸­å®ä¹äºåç§åå­å±éï¼Load BarrierãStore BarrierãRead BarrierãWrite Barrierï¼åå«ç¨äºç¡®ä¿åéçè¯»ãååè¯»åæä½çé¡ºåºåå¯è§æ§ã\n\n 3. happens-before å³ç³»ï¼happens-before æ¯ Java åå­æ¨¡åä¸­çä¸ä¸ªæ¦å¿µï¼ç¨äºæè¿°åéä¹é´çååé¡ºåºåå¯è§æ§ã\n    \n    * å¦æä¸ä¸ªæä½ happens-before å¦ä¸ä¸ªæä½ï¼é£ä¹ç¬¬ä¸ä¸ªæä½çç»æå¯¹ç¬¬äºä¸ªæä½æ¯å¯è§çï¼èä¸ç¬¬ä¸ä¸ªæä½çæ§è¡é¡ºåºå¨ç¬¬äºä¸ªæä½ä¹åã\n\n 4. åå­æ§ãå¯è§æ§åæåºæ§ï¼JMM ä¿è¯äºåå­æ§ãå¯è§æ§åæåºæ§çåå­æä½ã\n    \n    * åå­æ§æçæ¯ä¸ä¸ªæä½æ¯ä¸å¯åå²çæ´ä½ï¼è¦ä¹å¨é¨æ§è¡ï¼è¦ä¹å¨é¨ä¸æ§è¡ï¼\n    \n    * å¯è§æ§æçæ¯ä¸ä¸ªçº¿ç¨å¯¹åéçä¿®æ¹å¯¹å¶ä»çº¿ç¨æ¯å¯è§çï¼\n    \n    * æåºæ§æçæ¯æä»¤çæ§è¡é¡ºåºæ¯æåºçï¼ä¿è¯äºç¨åºçæ­£ç¡®æ§ã\n\n\n# AQS\n\n\n# ä»ä¹æ¯ AQS\n\nAQSï¼å¨ç§°ä¸º AbstractQueuedSynchronizerï¼æ¯ Java å¹¶åç¼ç¨ä¸­çä¸ä¸ªéè¦ç»ä»¶ã\n\nå®æä¾äºä¸ç§çµæ´»çæ¡æ¶ï¼å¯ä»¥ç¨æ¥å®ç°åç§åæ­¥å·¥å·ï¼æ¯å¦éãä¿¡å·éãåè®¡æ¶é¨æ ç­ã\n\n\n# AQS åçäºè§£ä¹ï¼\n\nAQS çæ ¸å¿ææ³æ¯ä½¿ç¨ä¸ä¸ª FIFO çç­å¾éåæ¥ç®¡ççº¿ç¨çè·ååéæ¾èµæºã\n\nAQS ç»´æ¤ä¸ä¸ª state åéï¼ç¨æ¥è¡¨ç¤ºåæ­¥ç¶æï¼åæ¶éè¿ä¸ä¸ªååé¾è¡¨æ¥å®ç°ç­å¾éåï¼å¹¶æä¾äº acquireãreleaseãtryAcquireãtryRelease ç­æ¹æ³ï¼åè®¸å­ç±»éè¿éåè¿äºæ¹æ³æ¥å®ç°ç¹å®çåæ­¥é»è¾ã\n\n\n# ç¨è¿ CountDownLatch ä¹ï¼ä»ä¹åºæ¯ä¸ç¨çï¼\n\n> æ¦å¿µ\n\nCountDownLatch æ¯ Java å¹¶åç¼ç¨ä¸­çä¸ä¸ªåæ­¥å·¥å·ï¼å®åè®¸ä¸ä¸ªæå¤ä¸ªçº¿ç¨ç­å¾å¶ä»çº¿ç¨å®ææä½ååæ§è¡ã\n\n> åç\n\nCountDownLatch çæ ¸å¿ææ³æ¯ï¼éè¿ä¸ä¸ªè®¡æ°å¨æ¥å®ç°ï¼è®¡æ°å¨åå§å¼ä¸ºçº¿ç¨æ°ï¼æ¯ä¸ªçº¿ç¨å®ææä½åä¼å°è®¡æ°å¨ -1ï¼å½è®¡æ°å¨åä¸º 0 æ¶ï¼ææç­å¾ççº¿ç¨é½ä¼è¢«å¤éã\n\n> ç¨æ³\n\nCountDownLatch çç¨æ³å¦ä¸ï¼\n\n 1. åå»º CountDownLatch å¯¹è±¡ï¼å¹¶æå®è®¡æ°å¨çåå§å¼ã\n 2. åä¸ªçº¿ç¨æ§è¡ä»»å¡ï¼å¹¶å¨ä»»å¡å®æåè°ç¨ CountDownLatch ç countDown æ¹æ³ï¼å°è®¡æ°å¨ -1ã\n 3. ä¸»çº¿ç¨è°ç¨ CountDownLatch ç await æ¹æ³ï¼ç­å¾ææä»»å¡å®æã\n\n> åºç¨åºæ¯\n\nCountDownLatch çåºç¨åºæ¯åæ¬ï¼\n\n 1. ä¸»çº¿ç¨ç­å¾å¤ä¸ªå­çº¿ç¨å®æä»»å¡ååæ§è¡ï¼å¯ä»¥ä½¿ç¨ CountDownLatch æ¥å®ç°ã\n 2. ä¸äºä»»å¡éè¦ç­å¾å¶ä»ä»»å¡å®æåæè½æ§è¡ï¼å¯ä»¥ä½¿ç¨ CountDownLatch æ¥å®ç°ã\n 3. æµè¯åºæ¯ä¸­ï¼å¯ä»¥ä½¿ç¨ CountDownLatch æ¥æ§å¶æµè¯ç¨ä¾çæ§è¡é¡ºåºã\n 4. å¤ä¸ªçº¿ç¨å¹¶åæ§è¡ï¼éè¦ç­å¾ææçº¿ç¨å®æååè¿è¡åå¹¶æä½ï¼å¯ä»¥ä½¿ç¨ CountDownLatch æ¥å®ç°ã\n\n\n# åèæç®\n\n * Javaå¹¶åå¸¸è§é¢è¯é¢æ»ç»ï¼ä¸ï¼\n * é¢æ¸£éè¢­ï¼Javaå¹¶åç¼ç¨é¢è¯é¢å«è¡æï¼å¿çð',normalizedContent:'# javaå¹¶ååºç¡å°ç»\n\n\n# çº¿ç¨åè¿ç¨çåºå«\n\n\n# ä»ä¹æ¯è¿ç¨ï¼\n\nè¿ç¨æ¯ç³»ç»è¿è¡ç¨åºçåºæ¬åä½ï¼æä»¬è®¡ç®æºå¯å¨çæ¯ä¸ä¸ªåºç¨ç¨åºé½æ¯ä¸ä¸ªè¿ç¨ãå¦ä¸å¾æç¤ºï¼å¨ windows ä¸­è¿ä¸ä¸ªä¸ª exe æä»¶ï¼é½æ¯ä¸ä¸ªè¿ç¨ãèå¨ jvm ä¸ï¼æ¯ä¸ä¸ªå¯å¨ç main æ¹æ³é½å¯ä»¥çä½ä¸ä¸ªè¿ç¨ã\n\n\n\n\n# ä»ä¹æ¯çº¿ç¨ï¼\n\nçº¿ç¨æ¯ä¸ä¸ªæ¯è¿ç¨æ´å°çæ§è¡åä½ï¼æ¯ cpu è°åº¦çåºæ¬åä½ãä¸ä¸ªè¿ç¨å¨å¶æ§è¡çè¿ç¨ä¸­å¯ä»¥äº§çå¤ä¸ªçº¿ç¨ãæä»¥å¨è¿è¡çº¿ç¨åæ¢æ¶çå¼éä¼è¿è¿å°äºè¿ç¨ï¼çº¿ç¨ä¹å¸¸å¸¸è¢«ç§°ä¸ºè½»éçº§è¿ç¨ã\n\nä¸è¿ç¨ä¸åçæ¯åç±»çå¤ä¸ªçº¿ç¨å±äº«è¿ç¨çå åæ¹æ³åºèµæºï¼ä½æ¯ä¸ªçº¿ç¨æèªå·±çç¨åºè®¡æ°å¨ãèææºæ åæ¬å°æ¹æ³æ ã\n\n\n# åºå«\n\n 1. çº¿ç¨æ¯è½»éçº§çæ§è¡ååï¼èè¿ç¨æ¯ééçº§çæ§è¡ååãå¨ java ä¸­ï¼çº¿ç¨ç± java èææºæ¥åå»ºåç®¡çï¼ä¸ä¸ªè¿ç¨å¯ä»¥åå«å¤ä¸ªçº¿ç¨ã\n 2. çº¿ç¨å±äº«è¿ç¨çåå­ç©ºé´åèµæºï¼å¯ä»¥éè¿å±äº«åå­æ¥è¿è¡éä¿¡ååæ­¥ãè¿ç¨æ¥æèªå·±çåå­ç©ºé´åèµæºï¼éè¦éè¿è¿ç¨é´éä¿¡ï¼ipcï¼æ¥è¿è¡éä¿¡ååæ­¥ã\n 3. çº¿ç¨ä¹é´çåæ¢å¼éæ¯è¿ç¨å°ï¼å ä¸ºçº¿ç¨å±äº«è¿ç¨çèµæºï¼ä¸éè¦åæ¢è¿ç¨çåå­ç©ºé´åèµæºãçº¿ç¨ä¹é´çåæ¢åªéè¦åæ¢çº¿ç¨çæ§è¡ä¸ä¸æå³å¯ã\n 4. çº¿ç¨ä¹é´çåæ­¥åéä¿¡æ¯è¿ç¨æ´å®¹æï¼å ä¸ºçº¿ç¨ä¹é´å±äº«è¿ç¨çåå­ç©ºé´ï¼å¯ä»¥ç´æ¥å±äº«æ°æ®åå¯¹è±¡ãèè¿ç¨ä¹é´éè¦éè¿ ipc æºå¶æ¥è¿è¡éä¿¡ååæ­¥ï¼å¼éè¾å¤§ã\n 5. çº¿ç¨ççå½å¨æåå°è¿ç¨çå½±åï¼ä¸ä¸ªè¿ç¨éåºæ¶ï¼å®åå«çææçº¿ç¨é½ä¼è¢«å¼ºå¶éåºãèè¿ç¨ççå½å¨æä¸åå¶ä»è¿ç¨çå½±åï¼ä¸ä¸ªè¿ç¨å¯ä»¥ç¬ç«äºå¶ä»è¿ç¨è¿è¡ã\n\n\n# å åæ¹æ³åºäºè§£åï¼\n\nå åæ¹æ³åºæ¯ææçº¿ç¨å±äº«çèµæºã\n\n * å¶ä¸­å æ¯è¿ç¨ä¸­æå¤§çä¸ååå­ï¼ä¸»è¦ç¨äºå­æ¾æ°åå»ºçå¯¹è±¡ (å ä¹ææå¯¹è±¡é½å¨è¿éåéåå­)ï¼\n * æ¹æ³åºä¸»è¦ç¨äºå­æ¾å·²è¢«å è½½çç±»ä¿¡æ¯ãå¸¸éãéæåéãå³æ¶ç¼è¯å¨ç¼è¯åçä»£ç ç­æ°æ®ã\n\n\n# å¹¶åä¸å¹¶è¡çåºå«\n\n * å¹¶åï¼ä¸¤ä¸ªåä¸¤ä¸ªä»¥ä¸çä½ä¸å¨åä¸ æ¶é´æ®µ åæ§è¡ã\n * å¹¶è¡ï¼ä¸¤ä¸ªåä¸¤ä¸ªä»¥ä¸çä½ä¸å¨åä¸ æ¶å» æ§è¡ã\n\næå³é®çç¹æ¯ï¼æ¯å¦æ¯ åæ¶ æ§è¡ã\n\n\n# åæ­¥åå¼æ­¥çåºå«\n\n * åæ­¥ï¼ååºä¸ä¸ªè°ç¨ä¹åï¼å¨æ²¡æå¾å°ç»æä¹åï¼ è¯¥è°ç¨å°±ä¸å¯ä»¥è¿åï¼ä¸ç´ç­å¾ã\n * å¼æ­¥ï¼è°ç¨å¨ååºä¹åï¼ä¸ç¨ç­å¾è¿åç»æï¼è¯¥è°ç¨ç´æ¥è¿åã\n\n\n# ä¸ºä»ä¹è¦ä½¿ç¨å¤çº¿ç¨?\n\nä¸»è¦æ¯ä¸ºäºæé«ç¨åºçæ§è½åå¹¶åè½åã\n\n * **ä»è®¡ç®æºåºå±æ¥è¯´ï¼**çº¿ç¨å¯ä»¥æ¯ä½æ¯è½»éçº§çè¿ç¨ï¼æ¯ç¨åºæ§è¡çæå°åä½ï¼çº¿ç¨é´çåæ¢åè°åº¦çææ¬è¿è¿å°äºè¿ç¨ãå¦å¤ï¼å¤æ ¸ cpu æ¶ä»£æå³çå¤ä¸ªçº¿ç¨å¯ä»¥åæ¶è¿è¡ï¼è¿åå°äºçº¿ç¨ä¸ä¸æåæ¢çå¼éã\n * **ä»å½ä»£äºèç½åå±è¶å¿æ¥è¯´ï¼**ç°å¨çç³»ç»å¨ä¸å¨å°±è¦æ±ç¾ä¸çº§çè³åä¸çº§çå¹¶åéï¼èå¤çº¿ç¨å¹¶åç¼ç¨æ­£æ¯å¼åé«å¹¶åç³»ç»çåºç¡ï¼å©ç¨å¥½å¤çº¿ç¨æºå¶å¯ä»¥å¤§å¤§æé«ç³»ç»æ´ä½çå¹¶åè½åä»¥åæ§è½ã\n\n\n# è¯´è¯´çº¿ç¨ççå½å¨æåç¶æï¼\n\njava çº¿ç¨å¨è¿è¡ççå½å¨æä¸­çæå®æ¶å»åªå¯è½å¤äºä¸é¢ 6 ç§ä¸åç¶æçå¶ä¸­ä¸ä¸ªç¶æï¼\n\n 1. new: åå§ç¶æï¼çº¿ç¨è¢«åå»ºåºæ¥ä½æ²¡æè¢«è°ç¨ start() ã\n 2. runnable: è¿è¡ç¶æï¼çº¿ç¨è¢«è°ç¨äº start() ç­å¾è¿è¡çç¶æã\n 3. blockedï¼é»å¡ç¶æï¼éè¦ç­å¾ééæ¾ã\n 4. waitingï¼ç­å¾ç¶æï¼è¡¨ç¤ºè¯¥çº¿ç¨éè¦ç­å¾å¶ä»çº¿ç¨ååºä¸äºç¹å®å¨ä½ï¼éç¥æä¸­æ­ï¼ã\n 5. time_waitingï¼è¶æ¶ç­å¾ç¶æï¼å¯ä»¥å¨æå®çæ¶é´åèªè¡è¿åèä¸æ¯å waiting é£æ ·ä¸ç´ç­å¾ã\n 6. terminatedï¼ç»æ­¢ç¶æï¼è¡¨ç¤ºè¯¥çº¿ç¨å·²ç»è¿è¡å®æ¯ã\n\nçº¿ç¨å¨çå½å¨æä¸­å¹¶ä¸æ¯åºå®å¤äºæä¸ä¸ªç¶æèæ¯éçä»£ç çæ§è¡å¨ä¸åç¶æä¹é´åæ¢ã\n\nå·ä½æ¥è¯´ï¼\n\n 1. çº¿ç¨åå»ºä¹åå®å°å¤äº **newï¼æ°å»ºï¼**ç¶æï¼\n\n 2. è°ç¨ start() æ¹æ³åå¼å§è¿è¡ï¼çº¿ç¨è¿æ¶åå¤äº **readyï¼å¯è¿è¡ï¼**ç¶æã\n\n 3. å¯è¿è¡ç¶æççº¿ç¨è·å¾äº cpu æ¶é´çï¼timesliceï¼åå°±å¤äº **runningï¼è¿è¡ï¼**ç¶æã\n    \n    * timed_waiting(è¶æ¶ç­å¾) ç¶æç¸å½äºå¨ç­å¾ç¶æçåºç¡ä¸å¢å äºè¶æ¶éå¶ï¼æ¯å¦éè¿ sleepï¼long millisï¼æ¹æ³æ waitï¼long millisï¼æ¹æ³å¯ä»¥å°çº¿ç¨ç½®äº timed_waiting ç¶æãå½è¶æ¶æ¶é´ç»æåï¼çº¿ç¨å°ä¼è¿åå° runnable ç¶æã\n    * å½çº¿ç¨è¿å¥ synchronized æ¹æ³/åæèè°ç¨ wait åï¼è¢« notifyï¼éæ°è¿å¥ synchronized æ¹æ³/åï¼ä½æ¯éè¢«å¶å®çº¿ç¨å æï¼è¿ä¸ªæ¶åçº¿ç¨å°±ä¼è¿å¥ blockedï¼é»å¡ï¼ ç¶æã\n\n 4. çº¿ç¨å¨æ§è¡å®äº run()æ¹æ³ä¹åå°ä¼è¿å¥å° terminatedï¼ç»æ­¢ï¼ ç¶æã\n\n\n# å¦ä½åå»ºä¸ä¸ªçº¿ç¨ï¼\n\nå¸¸è§çæ 5 ç§æ¹å¼ï¼\n\n 1. ç»§æ¿ thread ç±»ï¼ è¿æ¯ä¸ç§æ¯è¾ä¼ ç»çåå»ºçº¿ç¨çæ¹å¼ãä½ å¯ä»¥åå»ºä¸ä¸ªç±»ï¼ç»§æ¿èª thread ç±»ï¼å¹¶éå run æ¹æ³æ¥å®ä¹çº¿ç¨çæ§è¡é»è¾ã\n\nclass mythread extends thread {\n    @override\n    public void run() {\n        // çº¿ç¨çæ§è¡é»è¾\n    }\n}\n\n// åå»ºå¹¶å¯å¨çº¿ç¨\nmythread thread = new mythread();\nthread.start();\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n 2. å®ç° runnable æ¥å£ï¼è¿ç§æ¹å¼æ´å¸¸ç¨ï¼å®é¿åäº java çåç»§æ¿éå¶ï¼ä½ å¯ä»¥å®ç° runnable æ¥å£ï¼ç¶åå°å¶å®ä¾ä½ä¸ºåæ°ä¼ éç» thread æé å½æ°ã\n\nclass myrunnable implements runnable {\n    @override\n    public void run() {\n        // çº¿ç¨çæ§è¡é»è¾\n    }\n}\n\n// åå»ºå¹¶å¯å¨çº¿ç¨\nthread thread = new thread(new myrunnable());\nthread.start();\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n 3. ä½¿ç¨å¿ååé¨ç±»ï¼ä½ å¯ä»¥å¨åå»ºçº¿ç¨æ¶ä½¿ç¨å¿ååé¨ç±»ï¼å®ç° runnable æ¥å£ç run æ¹æ³ã\n\nthread thread = new thread(new runnable() {\n    @override\n    public void run() {\n        // çº¿ç¨çæ§è¡é»è¾\n    }\n});\nthread.start();\n\n\n1\n2\n3\n4\n5\n6\n7\n\n 4. ä½¿ç¨ java 8 ç lambda è¡¨è¾¾å¼ï¼å¦æ runnable æ¥å£åªæä¸ä¸ªæ½è±¡æ¹æ³ï¼ä½ å¯ä»¥ä½¿ç¨ lambda è¡¨è¾¾å¼ç®åä»£ç ã\n\nthread thread = new thread(() -> {\n    // çº¿ç¨çæ§è¡é»è¾\n});\nthread.start();\n\n\n1\n2\n3\n4\n\n 5. å®ç° callable æ¥å£ï¼ callable æ¥å£åè®¸çº¿ç¨è¿åç»æææåºå¼å¸¸ãéè¦éè¿ executorservice æ¥æ§è¡ã\n\nclass mycallable implements callable<string> {\n    @override\n    public string call() throws exception {\n        // çº¿ç¨çæ§è¡é»è¾\n        return "hello from callable";\n    }\n}\n\nexecutorservice executor = executors.newfixedthreadpool(1);\nfuture<string> future = executor.submit(new mycallable());\nstring result = future.get(); // è·åçº¿ç¨æ§è¡ç»æ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# ä»ä¹æ¯çº¿ç¨ä¸ä¸æåæ¢?\n\nçº¿ç¨ä¸ä¸æåæ¢æ¯æï¼cpu ä»ä¸ä¸ªçº¿ç¨ä¸­æ­æ§è¡è½¬èæ§è¡å¦ä¸ä¸ªçº¿ç¨çè¿ç¨ã\n\nå¨å¤çº¿ç¨ç¼ç¨ä¸­ï¼çº¿ç¨ä¸ä¸æåæ¢æ¯éå¸¸å¸¸è§çæä½ã\n\nè¿ä¸ªè¿ç¨éè¦èè´¹ä¸å®çæ¶é´åèµæºï¼å æ­¤çº¿ç¨ä¸ä¸æåæ¢çé¢ç¹åçä¼å¯¼è´ç³»ç»çæ§è½ä¸éã\n\n\n\n> 1ãä»ä¹æ¯ä¸ä¸æ\n\nçº¿ç¨å¨æ§è¡è¿ç¨ä¸­ä¼æèªå·±çè¿è¡æ¡ä»¶åç¶æï¼ä¹ç§°ä¸ä¸æï¼ã\n\næ¯å¦ç¨åºè®¡æ°å¨ï¼æ ä¿¡æ¯ç­ãå½åºç°å¦ä¸æåµçæ¶åï¼çº¿ç¨ä¼ä»å ç¨ cpu ç¶æä¸­éåºãï¼ä¸ä¸æåæ¢éå¸¸åçå¨ä»¥ä¸å ç§æåµï¼\n\n * ä¸»å¨è®©åº cpuï¼æ¯å¦è°ç¨äº sleep(), wait() ç­ã\n * æ¶é´çç¨å®ï¼å ä¸ºæä½ç³»ç»è¦é²æ­¢ä¸ä¸ªçº¿ç¨æèè¿ç¨é¿æ¶é´å ç¨ cpu å¯¼è´å¶ä»çº¿ç¨æèè¿ç¨é¥¿æ­»ã\n * è°ç¨äºé»å¡ç±»åçç³»ç»ä¸­æ­ï¼æ¯å¦è¯·æ± ioï¼çº¿ç¨è¢«é»å¡ã\n * è¢«ç»æ­¢æç»æè¿è¡ã\n\n> 2ãä¸ºäºåå°çº¿ç¨ä¸ä¸æåæ¢å¸¦æ¥çæ§è½æå¤±ï¼å¯ä»¥éåä»¥ä¸æªæ½ï¼\n\n * åå°çº¿ç¨æ°ï¼é¿åæ è°çä¸ä¸æåæ¢ï¼\n * éç¨çº¿ç¨æ± ææ¯ï¼é¿åçº¿ç¨çé¢ç¹åå»ºåéæ¯ï¼\n * ä½¿ç¨éé»å¡å¼ i/oï¼é¿åçº¿ç¨ç­å¾ i/o å®ææ¶çä¸ä¸æåæ¢ï¼\n * ä¼åçº¿ç¨çè°åº¦ç®æ³ï¼åå°çº¿ç¨ä¸ä¸æåæ¢çæ¬¡æ°ã\n\n\n# sleep() å wait() æ¹æ³å¯¹æ¯\n\n\n# å±åç¹\n\nä¸¤èé½å¯ä»¥æåçº¿ç¨çæ§è¡ã\n\n\n# åºå«\n\n 1. sleep() æ¹æ³æ²¡æéæ¾éï¼è wait() æ¹æ³éæ¾äºé ã\n 2. wait() éå¸¸è¢«ç¨äºçº¿ç¨é´äº¤äº/éä¿¡ï¼sleep() éå¸¸è¢«ç¨äºæåæ§è¡ã\n 3. wait() æ¹æ³è¢«è°ç¨åï¼çº¿ç¨ä¸ä¼èªå¨èéï¼éè¦å«ççº¿ç¨è°ç¨åä¸ä¸ªå¯¹è±¡ä¸ç notify() æè notifyall() æ¹æ³ãsleep() æ¹æ³æ§è¡å®æåï¼çº¿ç¨ä¼èªå¨èéï¼æèä¹å¯ä»¥ä½¿ç¨ wait(long timeout) è¶æ¶åçº¿ç¨ä¼èªå¨èéã\n 4. sleep() æ¯ thread ç±»çéææ¬å°æ¹æ³ï¼wait() åæ¯ object ç±»çæ¬å°æ¹æ³ã\n\n\n# ä¸ºä»ä¹ wait() æ¹æ³ä¸å®ä¹å¨ thread ä¸­ï¼\n\nå ä¸º wait() æ¯è®©è·å¾å¯¹è±¡éççº¿ç¨å®ç°ç­å¾ï¼ä¼èªå¨éæ¾å½åçº¿ç¨å æçå¯¹è±¡éã\n\n>  * è¿å¥è¯æåºäº wait() æ¹æ³çä¸¤ä¸ªå³é®ä½ç¨ï¼ç­å¾åéæ¾å¯¹è±¡éã\n>  * å½ä¸ä¸ªçº¿ç¨è°ç¨äºå¯¹è±¡ç wait() æ¹æ³ï¼å®ä¼è¿å¥ç­å¾ç¶æï¼ç­å¾å¶ä»çº¿ç¨éè¿ notify() æ notifyall() æ¹æ³å¤éå®ã\n>  * åæ¶ï¼è¯¥çº¿ç¨ä¼èªå¨éæ¾å®å½åå æçå¯¹è±¡éï¼è¿ä½¿å¾å¶ä»ç­å¾è¿ä¸ªå¯¹è±¡éççº¿ç¨ææºä¼è·å¾éå¹¶æ§è¡ä¸´çåºä»£ç ã\n\næ¯ä¸ªå¯¹è±¡ï¼objectï¼é½æ¥æå¯¹è±¡éï¼æ¢ç¶è¦éæ¾å½åçº¿ç¨å æçå¯¹è±¡éå¹¶è®©å¶è¿å¥ waiting ç¶æï¼èªç¶æ¯è¦æä½å¯¹åºçå¯¹è±¡ï¼objectï¼èéå½åççº¿ç¨ï¼threadï¼ã\n\nwait() æ¹æ³æ¯éå¯¹å¯¹è±¡éè¿è¡æä½ï¼èä¸æ¯éå¯¹çº¿ç¨æ¬èº«çæä½ã\n\n>  * è¿å¥è¯å¼ºè°äºå¯¹è±¡éæ¯åå¯¹è±¡ç»å®çï¼èä¸æ¯ä¸çº¿ç¨ç»å®çã\n>  * æ¯ä¸ª java å¯¹è±¡é½æä¸ä¸ªå³èçå¯¹è±¡éï¼çè§å¨éï¼ï¼è¿ä¸ªéç¨äºå¯¹è¯¥å¯¹è±¡çåæ­¥è®¿é®ã\n>  * å½çº¿ç¨è°ç¨äºæä¸ªå¯¹è±¡ç wait() æ¹æ³ï¼å®ä¼è®©åºè¿ä¸ªå¯¹è±¡çéï¼è®©å¶ä»çº¿ç¨ææºä¼è¿å¥ä¸´çåºææ§è¡åæ­¥ä»£ç ã\n>  * éæ¾çæ¯å¯¹è±¡éï¼èä¸æ¯å½åçº¿ç¨çéãè¿ä¹æ¯ä¸ºä»ä¹å¨ä½¿ç¨ wait() æ¶éè¦æç¡®è°ç¨çæ¯åªä¸ªå¯¹è±¡çéã\n\n\n# ä»ä¹æ¯å¯¹è±¡é\n\nå¯¹è±¡éæ¯ä¸ç§å¤çº¿ç¨åæ­¥æºå¶ï¼å®ç¨äºä¿æ¤å¯¹è±¡çç¶æåæä½ï¼ä»¥ç¡®ä¿å¨å¤çº¿ç¨ç¯å¢ä¸å¯¹è±¡çæ°æ®ä¸è´æ§åçº¿ç¨å®å¨æ§ã\n\nå¨ java ä¸­ï¼æ¯ä¸ªå¯¹è±¡é½æä¸ä¸ªå³èçå¯¹è±¡éï¼ä¹ç§°ä¸ºçè§å¨éæåç½®éãå¯¹è±¡éçä½ç¨æ¯é²æ­¢å¤ä¸ªçº¿ç¨åæ¶è®¿é®ä¸ä¸ªå¯¹è±¡çä¸´çåºä»£ç ï¼ä»èé¿åå¹¶åè®¿é®é æçæ°æ®éè¯¯åä¸ä¸è´æ§ã\n\nå¯ç¨ synchronized å³é®å­æ¥å®ç°ã\n\n\n# ä¸ºä»ä¹ sleep() æ¹æ³å®ä¹å¨ thread ä¸­ï¼\n\nå ä¸º sleep() æ¯è®©å½åçº¿ç¨æåæ§è¡ï¼ä¸æ¶åå°å¯¹è±¡ç±»ï¼ä¹ä¸éè¦è·å¾å¯¹è±¡éã\n\n\n# å¯ä»¥ç´æ¥è°ç¨ thread ç±»ç run æ¹æ³åï¼\n\n 1. new ä¸ä¸ª threadï¼çº¿ç¨è¿å¥äºæ°å»ºç¶æã\n 2. è°ç¨ start()æ¹æ³ï¼ä¼å¯å¨ä¸ä¸ªçº¿ç¨å¹¶ä½¿çº¿ç¨è¿å¥äºå°±ç»ªç¶æï¼å½åéå°æ¶é´çåå°±å¯ä»¥å¼å§è¿è¡äºã\n 3. start() ä¼æ§è¡çº¿ç¨çç¸åºåå¤å·¥ä½ï¼ç¶åèªå¨æ§è¡ run() æ¹æ³çåå®¹ï¼è¿æ¯çæ­£çå¤çº¿ç¨å·¥ä½ã\n\nä½æ¯ï¼ç´æ¥æ§è¡ run() æ¹æ³ï¼ä¼æ run() æ¹æ³å½æä¸ä¸ª main çº¿ç¨ä¸çæ®éæ¹æ³å»æ§è¡ï¼å¹¶ä¸ä¼å¨æä¸ªçº¿ç¨ä¸­æ§è¡å®ï¼æä»¥è¿å¹¶ä¸æ¯å¤çº¿ç¨å·¥ä½ã\n\næ»ç»ï¼\n\nè°ç¨ start() æ¹æ³æ¹å¯å¯å¨çº¿ç¨å¹¶ä½¿çº¿ç¨è¿å¥å°±ç»ªç¶æï¼ç´æ¥æ§è¡ run() æ¹æ³çè¯ä¸ä¼ä»¥å¤çº¿ç¨çæ¹å¼æ§è¡ã\n\n\n# å®æ¤çº¿ç¨äºè§£åï¼\n\njava ä¸­ççº¿ç¨åä¸ºä¸¤ç±»ï¼åå«ä¸º daemon çº¿ç¨ï¼å®æ¤çº¿ç¨ï¼å user çº¿ç¨ï¼ç¨æ·çº¿ç¨ï¼ã\n\nå¨ jvm å¯å¨æ¶ä¼è°ç¨ main å½æ°ï¼main å½æ°æå¨ççº¿ç¨å°±æ¯ä¸ä¸ªç¨æ·çº¿ç¨ãå¶å®å¨ jvm åé¨åæ¶è¿å¯å¨äºå¾å¤å®æ¤çº¿ç¨ï¼å®æ¤çº¿ç¨æ¯ç¨æ¥æå¡ç¨æ·çº¿ç¨ççº¿ç¨ï¼æ¯å¦åå¾åæ¶çº¿ç¨ãå¤ç¨äºæ§è¡åå°ä»»å¡ã\n\né£ä¹å®æ¤çº¿ç¨åç¨æ·çº¿ç¨æä»ä¹åºå«å¢ï¼\n\nåºå«ä¹ä¸æ¯å½æåä¸ä¸ªéå®æ¤çº¿ç¨ææ¶ï¼jvm ä¼æ­£å¸¸éåºï¼èä¸ç®¡å½åæ¯å¦å­å¨å®æ¤çº¿ç¨ï¼ä¹å°±æ¯è¯´å®æ¤çº¿ç¨æ¯å¦ç»æå¹¶ä¸å½±å jvm éåºãæ¢èè¨ä¹ï¼åªè¦æä¸ä¸ªç¨æ·çº¿ç¨è¿æ²¡ç»æï¼æ­£å¸¸æåµä¸ jvm å°±ä¸ä¼éåºã\n\nç®åæ¥è¯´å°±æ¯ç¨æ·çº¿ç¨ä¼é»æ­¢ jvm çéåºï¼èå®æ¤çº¿ç¨ä¸ä¼ã\n\n\n# è®²ä¸ä¸ jmm(java åå­æ¨¡å)\n\njava åå­æ¨¡åï¼java memory modelï¼jmmï¼æ¯ java èææºè§èä¸­çä¸é¨åï¼å®å®ä¹äº java ç¨åºä¸­åç§åéçè®¿é®æ¹å¼åå­å¨æ¹å¼ã\n\njmm çä½ç¨æ¯ï¼è§£å³å¹¶åç¼ç¨ä¸­ççº¿ç¨å®å¨é®é¢ï¼ç¡®ä¿å¤çº¿ç¨ç¯å¢ä¸ç¨åºçæ­£ç¡®æ§åç¨³å®æ§ã\n\nä¸»è¦åæ¬ä»¥ä¸å ä¸ªæ¹é¢ï¼\n\n 1. ä¸»åå­åå·¥ä½åå­ï¼java åå­æ¨¡åå°åå­åä¸ºä¸»åå­åå·¥ä½åå­ä¸¤é¨åã\n    \n    * ä¸»åå­æ¯ææçº¿ç¨å±äº«çåå­åºåï¼èæ¯ä¸ªçº¿ç¨é½æèªå·±çå·¥ä½åå­ï¼å·¥ä½åå­ä¸­ä¿å­äºè¯¥çº¿ç¨ä½¿ç¨å°çåéçå¯æ¬ã\n    \n    * çº¿ç¨ä¸è½ç´æ¥å¯¹ä¸»åå­è¿è¡æä½ï¼èæ¯éè¦åå°åéçå¯æ¬ä»ä¸»åå­ä¸­è¯»åå°å·¥ä½åå­ä¸­ï¼ç¶ååå¯¹åéè¿è¡æä½ï¼æä½å®æååå°åéçå¯æ¬ååå°ä¸»åå­ä¸­ã\n\n 2. åå­å±éï¼åå­å±éï¼memory barrierï¼æ¯ä¸ç§æºå¶ï¼ç¨äºç¡®ä¿çº¿ç¨ä¹é´çåå­å¯è§æ§åæä½çæåºæ§ã\n    \n    * jmm ä¸­å®ä¹äºåç§åå­å±éï¼load barrierãstore barrierãread barrierãwrite barrierï¼åå«ç¨äºç¡®ä¿åéçè¯»ãååè¯»åæä½çé¡ºåºåå¯è§æ§ã\n\n 3. happens-before å³ç³»ï¼happens-before æ¯ java åå­æ¨¡åä¸­çä¸ä¸ªæ¦å¿µï¼ç¨äºæè¿°åéä¹é´çååé¡ºåºåå¯è§æ§ã\n    \n    * å¦æä¸ä¸ªæä½ happens-before å¦ä¸ä¸ªæä½ï¼é£ä¹ç¬¬ä¸ä¸ªæä½çç»æå¯¹ç¬¬äºä¸ªæä½æ¯å¯è§çï¼èä¸ç¬¬ä¸ä¸ªæä½çæ§è¡é¡ºåºå¨ç¬¬äºä¸ªæä½ä¹åã\n\n 4. åå­æ§ãå¯è§æ§åæåºæ§ï¼jmm ä¿è¯äºåå­æ§ãå¯è§æ§åæåºæ§çåå­æä½ã\n    \n    * åå­æ§æçæ¯ä¸ä¸ªæä½æ¯ä¸å¯åå²çæ´ä½ï¼è¦ä¹å¨é¨æ§è¡ï¼è¦ä¹å¨é¨ä¸æ§è¡ï¼\n    \n    * å¯è§æ§æçæ¯ä¸ä¸ªçº¿ç¨å¯¹åéçä¿®æ¹å¯¹å¶ä»çº¿ç¨æ¯å¯è§çï¼\n    \n    * æåºæ§æçæ¯æä»¤çæ§è¡é¡ºåºæ¯æåºçï¼ä¿è¯äºç¨åºçæ­£ç¡®æ§ã\n\n\n# aqs\n\n\n# ä»ä¹æ¯ aqs\n\naqsï¼å¨ç§°ä¸º abstractqueuedsynchronizerï¼æ¯ java å¹¶åç¼ç¨ä¸­çä¸ä¸ªéè¦ç»ä»¶ã\n\nå®æä¾äºä¸ç§çµæ´»çæ¡æ¶ï¼å¯ä»¥ç¨æ¥å®ç°åç§åæ­¥å·¥å·ï¼æ¯å¦éãä¿¡å·éãåè®¡æ¶é¨æ ç­ã\n\n\n# aqs åçäºè§£ä¹ï¼\n\naqs çæ ¸å¿ææ³æ¯ä½¿ç¨ä¸ä¸ª fifo çç­å¾éåæ¥ç®¡ççº¿ç¨çè·ååéæ¾èµæºã\n\naqs ç»´æ¤ä¸ä¸ª state åéï¼ç¨æ¥è¡¨ç¤ºåæ­¥ç¶æï¼åæ¶éè¿ä¸ä¸ªååé¾è¡¨æ¥å®ç°ç­å¾éåï¼å¹¶æä¾äº acquireãreleaseãtryacquireãtryrelease ç­æ¹æ³ï¼åè®¸å­ç±»éè¿éåè¿äºæ¹æ³æ¥å®ç°ç¹å®çåæ­¥é»è¾ã\n\n\n# ç¨è¿ countdownlatch ä¹ï¼ä»ä¹åºæ¯ä¸ç¨çï¼\n\n> æ¦å¿µ\n\ncountdownlatch æ¯ java å¹¶åç¼ç¨ä¸­çä¸ä¸ªåæ­¥å·¥å·ï¼å®åè®¸ä¸ä¸ªæå¤ä¸ªçº¿ç¨ç­å¾å¶ä»çº¿ç¨å®ææä½ååæ§è¡ã\n\n> åç\n\ncountdownlatch çæ ¸å¿ææ³æ¯ï¼éè¿ä¸ä¸ªè®¡æ°å¨æ¥å®ç°ï¼è®¡æ°å¨åå§å¼ä¸ºçº¿ç¨æ°ï¼æ¯ä¸ªçº¿ç¨å®ææä½åä¼å°è®¡æ°å¨ -1ï¼å½è®¡æ°å¨åä¸º 0 æ¶ï¼ææç­å¾ççº¿ç¨é½ä¼è¢«å¤éã\n\n> ç¨æ³\n\ncountdownlatch çç¨æ³å¦ä¸ï¼\n\n 1. åå»º countdownlatch å¯¹è±¡ï¼å¹¶æå®è®¡æ°å¨çåå§å¼ã\n 2. åä¸ªçº¿ç¨æ§è¡ä»»å¡ï¼å¹¶å¨ä»»å¡å®æåè°ç¨ countdownlatch ç countdown æ¹æ³ï¼å°è®¡æ°å¨ -1ã\n 3. ä¸»çº¿ç¨è°ç¨ countdownlatch ç await æ¹æ³ï¼ç­å¾ææä»»å¡å®æã\n\n> åºç¨åºæ¯\n\ncountdownlatch çåºç¨åºæ¯åæ¬ï¼\n\n 1. ä¸»çº¿ç¨ç­å¾å¤ä¸ªå­çº¿ç¨å®æä»»å¡ååæ§è¡ï¼å¯ä»¥ä½¿ç¨ countdownlatch æ¥å®ç°ã\n 2. ä¸äºä»»å¡éè¦ç­å¾å¶ä»ä»»å¡å®æåæè½æ§è¡ï¼å¯ä»¥ä½¿ç¨ countdownlatch æ¥å®ç°ã\n 3. æµè¯åºæ¯ä¸­ï¼å¯ä»¥ä½¿ç¨ countdownlatch æ¥æ§å¶æµè¯ç¨ä¾çæ§è¡é¡ºåºã\n 4. å¤ä¸ªçº¿ç¨å¹¶åæ§è¡ï¼éè¦ç­å¾ææçº¿ç¨å®æååè¿è¡åå¹¶æä½ï¼å¯ä»¥ä½¿ç¨ countdownlatch æ¥å®ç°ã\n\n\n# åèæç®\n\n * javaå¹¶åå¸¸è§é¢è¯é¢æ»ç»ï¼ä¸ï¼\n * é¢æ¸£éè¢­ï¼javaå¹¶åç¼ç¨é¢è¯é¢å«è¡æï¼å¿çð',charsets:{cjk:!0}},{title:"éè¯¦è§£",frontmatter:{title:"éè¯¦è§£",date:"2023-06-14T20:16:24.000Z",permalink:"/pages/5a6aca/",author:{name:"éä¸æ¸é£",link:"https://msqfx.github.io"},categories:["java","å¹¶åç¯"],tags:[null],description:"çº¿ç¨æ­»éæ¯æï¼ä¸¤ä¸ªæå¤ä¸ªçº¿ç¨äºç¸ææå¯¹æ¹æéè¦çèµæºèäºç¸ç­å¾çç¶æï¼å¯¼è´ç¨åºæ æ³ç»§ç»­æ§è¡ä¸å»ï¼è¿èé·å¥æ­»å¾ªç¯ï¼æ æ³å®æä»»å¡ã",comment:!0,meta:[{name:"twitter:title",content:"éè¯¦è§£"},{name:"twitter:description",content:"çº¿ç¨æ­»éæ¯æï¼ä¸¤ä¸ªæå¤ä¸ªçº¿ç¨äºç¸ææå¯¹æ¹æéè¦çèµæºèäºç¸ç­å¾çç¶æï¼å¯¼è´ç¨åºæ æ³ç»§ç»­æ§è¡ä¸å»ï¼è¿èé·å¥æ­»å¾ªç¯ï¼æ æ³å®æä»»å¡ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/02.%E9%94%81%E8%AF%A6%E8%A7%A3.html"},{property:"og:type",content:"article"},{property:"og:title",content:"éè¯¦è§£"},{property:"og:description",content:"çº¿ç¨æ­»éæ¯æï¼ä¸¤ä¸ªæå¤ä¸ªçº¿ç¨äºç¸ææå¯¹æ¹æéè¦çèµæºèäºç¸ç­å¾çç¶æï¼å¯¼è´ç¨åºæ æ³ç»§ç»­æ§è¡ä¸å»ï¼è¿èé·å¥æ­»å¾ªç¯ï¼æ æ³å®æä»»å¡ã"},{property:"og:url",content:"https://www.msqfx.cc/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/02.%E9%94%81%E8%AF%A6%E8%A7%A3.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-06-14T20:16:24.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"éè¯¦è§£"},{itemprop:"description",content:"çº¿ç¨æ­»éæ¯æï¼ä¸¤ä¸ªæå¤ä¸ªçº¿ç¨äºç¸ææå¯¹æ¹æéè¦çèµæºèäºç¸ç­å¾çç¶æï¼å¯¼è´ç¨åºæ æ³ç»§ç»­æ§è¡ä¸å»ï¼è¿èé·å¥æ­»å¾ªç¯ï¼æ æ³å®æä»»å¡ã"}],readingShow:"top"},regularPath:"/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/02.%E9%94%81%E8%AF%A6%E8%A7%A3.html",relativePath:"01.java/03.å¹¶åç¯/02.éè¯¦è§£.md",key:"v-5a7b351e",path:"/pages/5a6aca/",headers:[{level:2,title:"æ­»éé®é¢",slug:"æ­»éé®é¢",normalizedTitle:"æ­»éé®é¢",charIndex:10},{level:3,title:"ä»ä¹æ¯çº¿ç¨æ­»é?",slug:"ä»ä¹æ¯çº¿ç¨æ­»é",normalizedTitle:"ä»ä¹æ¯çº¿ç¨æ­»é?",charIndex:19},{level:3,title:"æ­»éäº§ççåå ",slug:"æ­»éäº§ççåå ",normalizedTitle:"æ­»éäº§ççåå ",charIndex:97},{level:3,title:"æ­»éäº§ççæ¡ä»¶",slug:"æ­»éäº§ççæ¡ä»¶",normalizedTitle:"æ­»éäº§ççæ¡ä»¶",charIndex:151},{level:3,title:"å¦ä½é¢é²æ­»éï¼",slug:"å¦ä½é¢é²æ­»é",normalizedTitle:"å¦ä½é¢é²æ­»éï¼",charIndex:345},{level:3,title:"å¦ä½é¿åæ­»éï¼",slug:"å¦ä½é¿åæ­»é",normalizedTitle:"å¦ä½é¿åæ­»éï¼",charIndex:513},{level:2,title:"ä¹è§éåæ²è§é",slug:"ä¹è§éåæ²è§é",normalizedTitle:"ä¹è§éåæ²è§é",charIndex:575},{level:3,title:"ä»ä¹æ¯ä¹è§éï¼",slug:"ä»ä¹æ¯ä¹è§é",normalizedTitle:"ä»ä¹æ¯ä¹è§éï¼",charIndex:587},{level:3,title:"ä»ä¹æ¯æ²è§éï¼",slug:"ä»ä¹æ¯æ²è§é",normalizedTitle:"ä»ä¹æ¯æ²è§éï¼",charIndex:968},{level:3,title:"å¦ä½å®ç°ä¹è§éï¼",slug:"å¦ä½å®ç°ä¹è§é",normalizedTitle:"å¦ä½å®ç°ä¹è§éï¼",charIndex:1252},{level:4,title:"çæ¬æ§å¶",slug:"çæ¬æ§å¶",normalizedTitle:"çæ¬æ§å¶",charIndex:1264},{level:4,title:"CAS ç®æ³",slug:"cas-ç®æ³",normalizedTitle:"cas ç®æ³",charIndex:757},{level:3,title:"å¦ä½å®ç°æ²è§éï¼",slug:"å¦ä½å®ç°æ²è§é",normalizedTitle:"å¦ä½å®ç°æ²è§éï¼",charIndex:1543},{level:2,title:"å­¦ä¹ åè",slug:"å­¦ä¹ åè",normalizedTitle:"å­¦ä¹ åè",charIndex:2129}],headersStr:"æ­»éé®é¢ ä»ä¹æ¯çº¿ç¨æ­»é? æ­»éäº§ççåå  æ­»éäº§ççæ¡ä»¶ å¦ä½é¢é²æ­»éï¼ å¦ä½é¿åæ­»éï¼ ä¹è§éåæ²è§é ä»ä¹æ¯ä¹è§éï¼ ä»ä¹æ¯æ²è§éï¼ å¦ä½å®ç°ä¹è§éï¼ çæ¬æ§å¶ CAS ç®æ³ å¦ä½å®ç°æ²è§éï¼ å­¦ä¹ åè",content:"# éè¯¦è§£\n\n\n# æ­»éé®é¢\n\n\n# ä»ä¹æ¯çº¿ç¨æ­»é?\n\nçº¿ç¨æ­»éæ¯æï¼ä¸¤ä¸ªæå¤ä¸ªçº¿ç¨äºç¸ææå¯¹æ¹æéè¦çèµæºèäºç¸ç­å¾çç¶æï¼å¯¼è´ç¨åºæ æ³ç»§ç»­æ§è¡ä¸å»ï¼è¿èé·å¥æ­»å¾ªç¯ï¼æ æ³å®æä»»å¡ã\n\n\n# æ­»éäº§ççåå \n\néå¸¸æåµä¸ï¼çº¿ç¨æ­»éäº§ççåå æ¯: ä¸¤ä¸ªæå¤ä¸ªçº¿ç¨å¯¹èµæºçç«äºåä¸å½çèµæºåéã\n\n\n# æ­»éäº§ççæ¡ä»¶\n\nçº¿ç¨æ­»éçäº§çéå¸¸éè¦åæ¶æ»¡è¶³ä»¥ä¸åä¸ªæ¡ä»¶ï¼\n\n 1. äºæ¥æ¡ä»¶ï¼è¯¥èµæºä»»æä¸ä¸ªæ¶å»åªç±ä¸ä¸ªçº¿ç¨å ç¨ã\n 2. è¯·æ±ä¸ä¿ææ¡ä»¶ï¼ä¸ä¸ªçº¿ç¨å è¯·æ±èµæºèé»å¡æ¶ï¼å¯¹å·²è·å¾çèµæºä¿æä¸æ¾ã\n 3. ä¸å¥å¤ºæ¡ä»¶ï¼çº¿ç¨å·²è·å¾çèµæºå¨æªä½¿ç¨å®ä¹åä¸è½è¢«å¶ä»çº¿ç¨å¼ºè¡å¥å¤ºï¼åªæèªå·±ä½¿ç¨å®æ¯åæéæ¾èµæºã\n 4. å¾ªç¯ç­å¾æ¡ä»¶: è¥å¹²çº¿ç¨ä¹é´å½¢æä¸ç§å¤´å°¾ç¸æ¥çå¾ªç¯ç­å¾èµæºå³ç³»ã\n\n\n# å¦ä½é¢é²æ­»éï¼\n\né¢é²æ­»éåªè¦ç ´åæ­»éäº§ççå¿è¦æ¡ä»¶å³å¯ï¼\n\n 1. ç ´åè¯·æ±ä¸ä¿ææ¡ä»¶ï¼ä¸æ¬¡æ§ç³è¯·ææçèµæºã\n 2. ç ´åä¸å¥å¤ºæ¡ä»¶ï¼å ç¨é¨åèµæºççº¿ç¨è¿ä¸æ­¥ç³è¯·å¶ä»èµæºæ¶ï¼å¦æç³è¯·ä¸å°ï¼å¯ä»¥ä¸»å¨éæ¾å®å æçèµæºã\n 3. ç ´åå¾ªç¯ç­å¾æ¡ä»¶ï¼é æåºç³è¯·èµæºæ¥é¢é²ãææä¸é¡ºåºç³è¯·èµæºï¼éæ¾èµæºåååºéæ¾ãç ´åå¾ªç¯ç­å¾æ¡ä»¶ã\n\n\n# å¦ä½é¿åæ­»éï¼\n\né¿åæ­»éå°±æ¯å¨èµæºåéæ¶ï¼åå©äºç®æ³ï¼æ¯å¦é¶è¡å®¶ç®æ³ï¼å¯¹èµæºåéè¿è¡è®¡ç®è¯ä¼°ï¼ä½¿å¶è¿å¥å®å¨ç¶æã\n\n\n# ä¹è§éåæ²è§é\n\n\n# ä»ä¹æ¯ä¹è§éï¼\n\nä¹è§éæ»æ¯åè®¾æå¥½çæåµï¼è®¤ä¸ºå±äº«èµæºæ¯æ¬¡è¢«è®¿é®çæ¶åä¸ä¼åºç°é®é¢ï¼çº¿ç¨å¯ä»¥ä¸åå°æ§è¡ï¼æ éå éä¹æ éç­å¾ï¼åªæ¯å¨æäº¤ä¿®æ¹çæ¶åå»éªè¯å¯¹åºçèµæºæ¯å¦è¢«å¶å®çº¿ç¨ä¿®æ¹äºã\n\nä¼ç¹\n\nä¸ä¼é æçº¿ç¨é»å¡\n\nç¼ºç¹\n\nå¨å¹¶åæ´æ°çæåµä¸ï¼å¯è½ä¼åºç° ABA é®é¢ï¼éè¦ä½¿ç¨çæ¬å·ææ¶é´æ³ç­æºå¶æ¥è§£å³ã\n\n> ABA é®é¢æ¯: å¨ä½¿ç¨ CAS ç®æ³æ¶å¯è½åºç°çä¸ä¸ªé®é¢ã\n> \n> å®çæ¬è´¨æ¯: ç±äºçº¿ç¨ä¹é´çç«äºï¼å¯¼è´å±äº«æ°æ®çå¼å¨æä¸ªæ¶é´ç¹è¢«ä¿®æ¹ä¸º Aï¼ç¶ååè¢«ä¿®æ¹ä¸º Bï¼æååè¢«ä¿®æ¹å Aï¼\n> \n> è¿æ¶åä½¿ç¨ CAS ç®æ³æ¶ï¼æ¯è¾çæ¯å±äº«æ°æ®çå¼æ¯å¦ç­äº Aï¼å¦æç­äº Aï¼åæ§è¡æä½ï¼ä½å®éä¸å±äº«æ°æ®çå¼å·²ç»è¢«ä¿®æ¹è¿äºã\n> \n> ç®åæ¥è¯´ï¼å°±æ¯å¨ä½¿ç¨ CAS ç®æ³çæ¶ååçäºè¯¯å¤ã\n\nå¸åä»£è¡¨\n\næ¯å¦ï¼ä½¿ç¨çæ¬å·æºå¶ãCAS ç®æ³\n\n\n# ä»ä¹æ¯æ²è§éï¼\n\næ²è§éæ»æ¯åè®¾æåçæåµï¼è®¤ä¸ºå±äº«èµæºæ¯æ¬¡è¢«è®¿é®çæ¶åå°±ä¼åºç°é®é¢(æ¯å¦å±äº«æ°æ®è¢«ä¿®æ¹)ï¼æä»¥æ¯æ¬¡å¨è·åèµæºæä½çæ¶åé½ä¼ä¸éï¼è¿æ ·å¶ä»çº¿ç¨æ³æ¿å°è¿ä¸ªèµæºå°±ä¼é»å¡ç´å°éè¢«ä¸ä¸ä¸ªææèéæ¾ãä¹å°±æ¯è¯´ï¼å±äº«èµæºæ¯æ¬¡åªç»ä¸ä¸ªçº¿ç¨ä½¿ç¨ï¼å¶å®çº¿ç¨é»å¡ï¼ç¨å®ååæèµæºè½¬è®©ç»å¶å®çº¿ç¨ã\n\nä¼ç¹\n\nå®å¨ï¼è½å¤ä¿è¯æ°æ®æä½çæ­£ç¡®æ§åä¸è´æ§ã\n\nç¼ºç¹\n\næ²è§éçç¼ºç¹æ¯å¨é«å¹¶åçæåµä¸ï¼ä¼é æå¤§éççº¿ç¨é»å¡ï¼éä½ç³»ç»çæ§è½ã\n\nå¸åä»£è¡¨\n\næ¯å¦ï¼Java ä¸­ ç synchronized å ReentrantLock ç­ç¬å éï¼æ°æ®åºä¸­çè¡çº§éåè¡¨çº§éã\n\n\n# å¦ä½å®ç°ä¹è§éï¼\n\n# çæ¬æ§å¶\n\nå¨æä½å±äº«èµæºä¹åï¼åè¯»åæ°æ®ççæ¬å·ï¼ç¶åå°æä½ç»æä¸å½åçæ¬å·è¿è¡æ¯è¾ï¼å¦æçæ¬å·ä¸è´ï¼åå¯ä»¥è¿è¡æä½ï¼å¦æçæ¬å·ä¸ä¸è´ï¼åè¯´ææ°æ®å·²è¢«å¶ä»çº¿ç¨ä¿®æ¹ï¼éè¦åæ»å¹¶éè¯ã\n\n# CAS ç®æ³\n\nCAS çå¨ç§°æ¯ Compare And Swapï¼æ¯è¾ä¸äº¤æ¢ï¼ï¼ç¨äºå®ç°ä¹è§éï¼è¢«å¹¿æ³åºç¨äºåå¤§æ¡æ¶ä¸­ã\n\nCAS çææ³å¾ç®åï¼å°±æ¯ç¨ä¸ä¸ªé¢æå¼åè¦æ´æ°çåéå¼è¿è¡æ¯è¾ï¼ä¸¤å¼ç¸ç­æä¼è¿è¡æ´æ°ã\n\næ¯ä¸ä¸ªåå­æä½ï¼åºå±ä¾èµäºä¸æ¡ CPU çåå­æä»¤ã\n\n> åå­æä½ å³æå°ä¸å¯æåçæä½ï¼ä¹å°±æ¯è¯´æä½ä¸æ¦å¼å§ï¼å°±ä¸è½è¢«ææ­ï¼ç´å°æä½å®æã\n\n\n# å¦ä½å®ç°æ²è§éï¼\n\næ²è§éçå®ç°æ¹å¼ä¸»è¦æä¸¤ç§ï¼åºäºæ°æ®åºçæ²è§éååºäºä»£ç çæ²è§éã\n\n 1. åºäºæ°æ®åºçæ²è§é\n    \n    åºäºæ°æ®åºçæ²è§éæ¯éè¿æ°æ®åºçéæºå¶æ¥å®ç°çãå¨æ°æ®åºä¸­ï¼å¯ä»¥éè¿ SELECT ... FOR UPDATE è¯­å¥æ SELECT ... FOR SHARE è¯­å¥æ¥è·åæ²è§éã\n    \n    * å½ä¸ä¸ªäºå¡æ§è¡ SELECT ... FOR UPDATE è¯­å¥æ¶ï¼æ°æ®åºä¼å°æéçè¡å ä¸æä»éï¼å¶ä»äºå¡ä¸è½ä¿®æ¹è¿äºè¡ï¼\n    * å½ä¸ä¸ªäºå¡æ§è¡ SELECT ... FOR SHARE è¯­å¥æ¶ï¼æ°æ®åºä¼å°æéçè¡å ä¸å±äº«éï¼å¶ä»äºå¡åªè½è¯»åè¿äºè¡ï¼ä¸è½ä¿®æ¹ãå¨ä½¿ç¨å®éåï¼éè¦åæ¶éæ¾éï¼é¿åé¿æ¶é´å ç¨æ°æ®åºèµæºã\n\n 2. åºäºä»£ç çæ²è§é\n    \n    åºäºä»£ç çæ²è§éæ¯éè¿ç¨åºä»£ç æ¥å®ç°çãå¨ Java ä¸­ï¼å¯ä»¥ä½¿ç¨ synchronized å³é®å­æ Lock æ¥å£æ¥å®ç°æ²è§éã\n    \n    * ä½¿ç¨ synchronized å³é®å­æ¶ï¼éè¦å¨æ¹æ³æä»£ç åä¸å éï¼ä»¥ç¡®ä¿åä¸æ¶é´åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡è¿æ®µä»£ç ï¼\n    * ä½¿ç¨ Lock æ¥å£æ¶ï¼éè¦åè·åéï¼è°ç¨ lock() æ¹æ³ï¼ï¼ç¶åæ§è¡æä½ï¼æåéæ¾éï¼è°ç¨ unlock() æ¹æ³ï¼ï¼ä»¥ç¡®ä¿åä¸æ¶é´åªæä¸ä¸ªçº¿ç¨å¯ä»¥æä½å±äº«èµæºã\n\n\n# å­¦ä¹ åè\n\n * Javaå¹¶åå¸¸è§é¢è¯é¢æ»ç»ï¼ä¸­ï¼ | JavaGuide(Javaé¢è¯ + å­¦ä¹ æå)\n\n * JUCåä¸åç§éä½¿ç¨è¯¦è§£ | Shark Chili",normalizedContent:"# éè¯¦è§£\n\n\n# æ­»éé®é¢\n\n\n# ä»ä¹æ¯çº¿ç¨æ­»é?\n\nçº¿ç¨æ­»éæ¯æï¼ä¸¤ä¸ªæå¤ä¸ªçº¿ç¨äºç¸ææå¯¹æ¹æéè¦çèµæºèäºç¸ç­å¾çç¶æï¼å¯¼è´ç¨åºæ æ³ç»§ç»­æ§è¡ä¸å»ï¼è¿èé·å¥æ­»å¾ªç¯ï¼æ æ³å®æä»»å¡ã\n\n\n# æ­»éäº§ççåå \n\néå¸¸æåµä¸ï¼çº¿ç¨æ­»éäº§ççåå æ¯: ä¸¤ä¸ªæå¤ä¸ªçº¿ç¨å¯¹èµæºçç«äºåä¸å½çèµæºåéã\n\n\n# æ­»éäº§ççæ¡ä»¶\n\nçº¿ç¨æ­»éçäº§çéå¸¸éè¦åæ¶æ»¡è¶³ä»¥ä¸åä¸ªæ¡ä»¶ï¼\n\n 1. äºæ¥æ¡ä»¶ï¼è¯¥èµæºä»»æä¸ä¸ªæ¶å»åªç±ä¸ä¸ªçº¿ç¨å ç¨ã\n 2. è¯·æ±ä¸ä¿ææ¡ä»¶ï¼ä¸ä¸ªçº¿ç¨å è¯·æ±èµæºèé»å¡æ¶ï¼å¯¹å·²è·å¾çèµæºä¿æä¸æ¾ã\n 3. ä¸å¥å¤ºæ¡ä»¶ï¼çº¿ç¨å·²è·å¾çèµæºå¨æªä½¿ç¨å®ä¹åä¸è½è¢«å¶ä»çº¿ç¨å¼ºè¡å¥å¤ºï¼åªæèªå·±ä½¿ç¨å®æ¯åæéæ¾èµæºã\n 4. å¾ªç¯ç­å¾æ¡ä»¶: è¥å¹²çº¿ç¨ä¹é´å½¢æä¸ç§å¤´å°¾ç¸æ¥çå¾ªç¯ç­å¾èµæºå³ç³»ã\n\n\n# å¦ä½é¢é²æ­»éï¼\n\né¢é²æ­»éåªè¦ç ´åæ­»éäº§ççå¿è¦æ¡ä»¶å³å¯ï¼\n\n 1. ç ´åè¯·æ±ä¸ä¿ææ¡ä»¶ï¼ä¸æ¬¡æ§ç³è¯·ææçèµæºã\n 2. ç ´åä¸å¥å¤ºæ¡ä»¶ï¼å ç¨é¨åèµæºççº¿ç¨è¿ä¸æ­¥ç³è¯·å¶ä»èµæºæ¶ï¼å¦æç³è¯·ä¸å°ï¼å¯ä»¥ä¸»å¨éæ¾å®å æçèµæºã\n 3. ç ´åå¾ªç¯ç­å¾æ¡ä»¶ï¼é æåºç³è¯·èµæºæ¥é¢é²ãææä¸é¡ºåºç³è¯·èµæºï¼éæ¾èµæºåååºéæ¾ãç ´åå¾ªç¯ç­å¾æ¡ä»¶ã\n\n\n# å¦ä½é¿åæ­»éï¼\n\né¿åæ­»éå°±æ¯å¨èµæºåéæ¶ï¼åå©äºç®æ³ï¼æ¯å¦é¶è¡å®¶ç®æ³ï¼å¯¹èµæºåéè¿è¡è®¡ç®è¯ä¼°ï¼ä½¿å¶è¿å¥å®å¨ç¶æã\n\n\n# ä¹è§éåæ²è§é\n\n\n# ä»ä¹æ¯ä¹è§éï¼\n\nä¹è§éæ»æ¯åè®¾æå¥½çæåµï¼è®¤ä¸ºå±äº«èµæºæ¯æ¬¡è¢«è®¿é®çæ¶åä¸ä¼åºç°é®é¢ï¼çº¿ç¨å¯ä»¥ä¸åå°æ§è¡ï¼æ éå éä¹æ éç­å¾ï¼åªæ¯å¨æäº¤ä¿®æ¹çæ¶åå»éªè¯å¯¹åºçèµæºæ¯å¦è¢«å¶å®çº¿ç¨ä¿®æ¹äºã\n\nä¼ç¹\n\nä¸ä¼é æçº¿ç¨é»å¡\n\nç¼ºç¹\n\nå¨å¹¶åæ´æ°çæåµä¸ï¼å¯è½ä¼åºç° aba é®é¢ï¼éè¦ä½¿ç¨çæ¬å·ææ¶é´æ³ç­æºå¶æ¥è§£å³ã\n\n> aba é®é¢æ¯: å¨ä½¿ç¨ cas ç®æ³æ¶å¯è½åºç°çä¸ä¸ªé®é¢ã\n> \n> å®çæ¬è´¨æ¯: ç±äºçº¿ç¨ä¹é´çç«äºï¼å¯¼è´å±äº«æ°æ®çå¼å¨æä¸ªæ¶é´ç¹è¢«ä¿®æ¹ä¸º aï¼ç¶ååè¢«ä¿®æ¹ä¸º bï¼æååè¢«ä¿®æ¹å aï¼\n> \n> è¿æ¶åä½¿ç¨ cas ç®æ³æ¶ï¼æ¯è¾çæ¯å±äº«æ°æ®çå¼æ¯å¦ç­äº aï¼å¦æç­äº aï¼åæ§è¡æä½ï¼ä½å®éä¸å±äº«æ°æ®çå¼å·²ç»è¢«ä¿®æ¹è¿äºã\n> \n> ç®åæ¥è¯´ï¼å°±æ¯å¨ä½¿ç¨ cas ç®æ³çæ¶ååçäºè¯¯å¤ã\n\nå¸åä»£è¡¨\n\næ¯å¦ï¼ä½¿ç¨çæ¬å·æºå¶ãcas ç®æ³\n\n\n# ä»ä¹æ¯æ²è§éï¼\n\næ²è§éæ»æ¯åè®¾æåçæåµï¼è®¤ä¸ºå±äº«èµæºæ¯æ¬¡è¢«è®¿é®çæ¶åå°±ä¼åºç°é®é¢(æ¯å¦å±äº«æ°æ®è¢«ä¿®æ¹)ï¼æä»¥æ¯æ¬¡å¨è·åèµæºæä½çæ¶åé½ä¼ä¸éï¼è¿æ ·å¶ä»çº¿ç¨æ³æ¿å°è¿ä¸ªèµæºå°±ä¼é»å¡ç´å°éè¢«ä¸ä¸ä¸ªææèéæ¾ãä¹å°±æ¯è¯´ï¼å±äº«èµæºæ¯æ¬¡åªç»ä¸ä¸ªçº¿ç¨ä½¿ç¨ï¼å¶å®çº¿ç¨é»å¡ï¼ç¨å®ååæèµæºè½¬è®©ç»å¶å®çº¿ç¨ã\n\nä¼ç¹\n\nå®å¨ï¼è½å¤ä¿è¯æ°æ®æä½çæ­£ç¡®æ§åä¸è´æ§ã\n\nç¼ºç¹\n\næ²è§éçç¼ºç¹æ¯å¨é«å¹¶åçæåµä¸ï¼ä¼é æå¤§éççº¿ç¨é»å¡ï¼éä½ç³»ç»çæ§è½ã\n\nå¸åä»£è¡¨\n\næ¯å¦ï¼java ä¸­ ç synchronized å reentrantlock ç­ç¬å éï¼æ°æ®åºä¸­çè¡çº§éåè¡¨çº§éã\n\n\n# å¦ä½å®ç°ä¹è§éï¼\n\n# çæ¬æ§å¶\n\nå¨æä½å±äº«èµæºä¹åï¼åè¯»åæ°æ®ççæ¬å·ï¼ç¶åå°æä½ç»æä¸å½åçæ¬å·è¿è¡æ¯è¾ï¼å¦æçæ¬å·ä¸è´ï¼åå¯ä»¥è¿è¡æä½ï¼å¦æçæ¬å·ä¸ä¸è´ï¼åè¯´ææ°æ®å·²è¢«å¶ä»çº¿ç¨ä¿®æ¹ï¼éè¦åæ»å¹¶éè¯ã\n\n# cas ç®æ³\n\ncas çå¨ç§°æ¯ compare and swapï¼æ¯è¾ä¸äº¤æ¢ï¼ï¼ç¨äºå®ç°ä¹è§éï¼è¢«å¹¿æ³åºç¨äºåå¤§æ¡æ¶ä¸­ã\n\ncas çææ³å¾ç®åï¼å°±æ¯ç¨ä¸ä¸ªé¢æå¼åè¦æ´æ°çåéå¼è¿è¡æ¯è¾ï¼ä¸¤å¼ç¸ç­æä¼è¿è¡æ´æ°ã\n\næ¯ä¸ä¸ªåå­æä½ï¼åºå±ä¾èµäºä¸æ¡ cpu çåå­æä»¤ã\n\n> åå­æä½ å³æå°ä¸å¯æåçæä½ï¼ä¹å°±æ¯è¯´æä½ä¸æ¦å¼å§ï¼å°±ä¸è½è¢«ææ­ï¼ç´å°æä½å®æã\n\n\n# å¦ä½å®ç°æ²è§éï¼\n\næ²è§éçå®ç°æ¹å¼ä¸»è¦æä¸¤ç§ï¼åºäºæ°æ®åºçæ²è§éååºäºä»£ç çæ²è§éã\n\n 1. åºäºæ°æ®åºçæ²è§é\n    \n    åºäºæ°æ®åºçæ²è§éæ¯éè¿æ°æ®åºçéæºå¶æ¥å®ç°çãå¨æ°æ®åºä¸­ï¼å¯ä»¥éè¿ select ... for update è¯­å¥æ select ... for share è¯­å¥æ¥è·åæ²è§éã\n    \n    * å½ä¸ä¸ªäºå¡æ§è¡ select ... for update è¯­å¥æ¶ï¼æ°æ®åºä¼å°æéçè¡å ä¸æä»éï¼å¶ä»äºå¡ä¸è½ä¿®æ¹è¿äºè¡ï¼\n    * å½ä¸ä¸ªäºå¡æ§è¡ select ... for share è¯­å¥æ¶ï¼æ°æ®åºä¼å°æéçè¡å ä¸å±äº«éï¼å¶ä»äºå¡åªè½è¯»åè¿äºè¡ï¼ä¸è½ä¿®æ¹ãå¨ä½¿ç¨å®éåï¼éè¦åæ¶éæ¾éï¼é¿åé¿æ¶é´å ç¨æ°æ®åºèµæºã\n\n 2. åºäºä»£ç çæ²è§é\n    \n    åºäºä»£ç çæ²è§éæ¯éè¿ç¨åºä»£ç æ¥å®ç°çãå¨ java ä¸­ï¼å¯ä»¥ä½¿ç¨ synchronized å³é®å­æ lock æ¥å£æ¥å®ç°æ²è§éã\n    \n    * ä½¿ç¨ synchronized å³é®å­æ¶ï¼éè¦å¨æ¹æ³æä»£ç åä¸å éï¼ä»¥ç¡®ä¿åä¸æ¶é´åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡è¿æ®µä»£ç ï¼\n    * ä½¿ç¨ lock æ¥å£æ¶ï¼éè¦åè·åéï¼è°ç¨ lock() æ¹æ³ï¼ï¼ç¶åæ§è¡æä½ï¼æåéæ¾éï¼è°ç¨ unlock() æ¹æ³ï¼ï¼ä»¥ç¡®ä¿åä¸æ¶é´åªæä¸ä¸ªçº¿ç¨å¯ä»¥æä½å±äº«èµæºã\n\n\n# å­¦ä¹ åè\n\n * javaå¹¶åå¸¸è§é¢è¯é¢æ»ç»ï¼ä¸­ï¼ | javaguide(javaé¢è¯ + å­¦ä¹ æå)\n\n * jucåä¸åç§éä½¿ç¨è¯¦è§£ | shark chili",charsets:{cjk:!0}},{title:"SynchronizedåVolatileçä½¿ç¨ä¸åºå«",frontmatter:{title:"SynchronizedåVolatileçä½¿ç¨ä¸åºå«",date:"2023-06-14T20:16:57.000Z",permalink:"/pages/e19c5d/",author:{name:"éä¸æ¸é£",link:"https://msqfx.github.io"},categories:["java","å¹¶åç¯"],tags:[null],description:"synchronized æ¯ Java ä¸­çä¸ä¸ªå³é®å­ï¼ç¿»è¯æä¸­ææ¯åæ­¥çææã",comment:!0,meta:[{name:"twitter:title",content:"SynchronizedåVolatileçä½¿ç¨ä¸åºå«"},{name:"twitter:description",content:"synchronized æ¯ Java ä¸­çä¸ä¸ªå³é®å­ï¼ç¿»è¯æä¸­ææ¯åæ­¥çææã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/03.Synchronized%E5%92%8CVolatile%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%8C%BA%E5%88%AB.html"},{property:"og:type",content:"article"},{property:"og:title",content:"SynchronizedåVolatileçä½¿ç¨ä¸åºå«"},{property:"og:description",content:"synchronized æ¯ Java ä¸­çä¸ä¸ªå³é®å­ï¼ç¿»è¯æä¸­ææ¯åæ­¥çææã"},{property:"og:url",content:"https://www.msqfx.cc/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/03.Synchronized%E5%92%8CVolatile%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%8C%BA%E5%88%AB.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-06-14T20:16:57.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"SynchronizedåVolatileçä½¿ç¨ä¸åºå«"},{itemprop:"description",content:"synchronized æ¯ Java ä¸­çä¸ä¸ªå³é®å­ï¼ç¿»è¯æä¸­ææ¯åæ­¥çææã"}],readingShow:"top"},regularPath:"/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/03.Synchronized%E5%92%8CVolatile%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%8C%BA%E5%88%AB.html",relativePath:"01.java/03.å¹¶åç¯/03.SynchronizedåVolatileçä½¿ç¨ä¸åºå«.md",key:"v-0379b906",path:"/pages/e19c5d/",headers:[{level:2,title:"synchronized å³é®å­",slug:"synchronized-å³é®å­",normalizedTitle:"synchronized å³é®å­",charIndex:34},{level:3,title:"ä»ä¹æ¯ synchronized å³é®å­ï¼",slug:"ä»ä¹æ¯-synchronized-å³é®å­",normalizedTitle:"ä»ä¹æ¯ synchronized å³é®å­ï¼",charIndex:55},{level:3,title:"æé æ¹æ³å¯ä»¥ç¨ synchronized ä¿®é¥°ä¹ï¼",slug:"æé æ¹æ³å¯ä»¥ç¨-synchronized-ä¿®é¥°ä¹",normalizedTitle:"æé æ¹æ³å¯ä»¥ç¨ synchronized ä¿®é¥°ä¹ï¼",charIndex:242},{level:3,title:"synchronized çåºå±åçæ¯ä»ä¹ï¼",slug:"synchronized-çåºå±åçæ¯ä»ä¹",normalizedTitle:"synchronized çåºå±åçæ¯ä»ä¹ï¼",charIndex:310},{level:2,title:"volatile å³é®å­",slug:"volatile-å³é®å­",normalizedTitle:"volatile å³é®å­",charIndex:573},{level:3,title:"ä»ä¹æ¯ volatile å³é®å­ï¼",slug:"ä»ä¹æ¯-volatile-å³é®å­",normalizedTitle:"ä»ä¹æ¯ volatile å³é®å­ï¼",charIndex:590},{level:3,title:"volatile å³é®å­è§£å³äºä»ä¹é®é¢ï¼",slug:"volatile-å³é®å­è§£å³äºä»ä¹é®é¢",normalizedTitle:"volatile å³é®å­è§£å³äºä»ä¹é®é¢ï¼",charIndex:685},{level:2,title:"synchronized å volatile æä»ä¹åºå«ï¼",slug:"synchronized-å-volatile-æä»ä¹åºå«",normalizedTitle:"synchronized å volatile æä»ä¹åºå«ï¼",charIndex:1114},{level:2,title:"volatile çå®ç°åçäºè§£åï¼",slug:"volatile-çå®ç°åçäºè§£å",normalizedTitle:"volatile çå®ç°åçäºè§£åï¼",charIndex:1451},{level:2,title:"è¯´ä¸ä¸ä½ å¯¹ Java åå­æ¨¡åï¼JMMï¼ççè§£ï¼",slug:"è¯´ä¸ä¸ä½ å¯¹-java-åå­æ¨¡å-jmm-ççè§£",normalizedTitle:"è¯´ä¸ä¸ä½ å¯¹ java åå­æ¨¡åï¼jmmï¼ççè§£ï¼",charIndex:2048},{level:2,title:"å­¦ä¹ åè",slug:"å­¦ä¹ åè",normalizedTitle:"å­¦ä¹ åè",charIndex:3284}],headersStr:"synchronized å³é®å­ ä»ä¹æ¯ synchronized å³é®å­ï¼ æé æ¹æ³å¯ä»¥ç¨ synchronized ä¿®é¥°ä¹ï¼ synchronized çåºå±åçæ¯ä»ä¹ï¼ volatile å³é®å­ ä»ä¹æ¯ volatile å³é®å­ï¼ volatile å³é®å­è§£å³äºä»ä¹é®é¢ï¼ synchronized å volatile æä»ä¹åºå«ï¼ volatile çå®ç°åçäºè§£åï¼ è¯´ä¸ä¸ä½ å¯¹ Java åå­æ¨¡åï¼JMMï¼ççè§£ï¼ å­¦ä¹ åè",content:'# SynchronizedåVolatileçä½¿ç¨ä¸åºå«\n\n\n# synchronized å³é®å­\n\n\n# ä»ä¹æ¯ synchronized å³é®å­ï¼\n\nsynchronized æ¯ Java ä¸­çä¸ä¸ªå³é®å­ï¼ç¿»è¯æä¸­ææ¯åæ­¥çææã\n\nä¸»è¦è§£å³çæ¯ï¼å¤ä¸ªçº¿ç¨ä¹é´è®¿é®èµæºçåæ­¥æ§ãå¯ä»¥ä¿è¯è¢«å®ä¿®é¥°çæ¹æ³æèä»£ç åå¨ä»»ææ¶å»åªè½æä¸ä¸ªçº¿ç¨æ§è¡ã\n\nä½¿ç¨æ¹å¼\n\nä½¿ç¨ synchronized å³é®å­æ¶ï¼éè¦å¨æ¹æ³æä»£ç åä¸å éï¼ä»¥ç¡®ä¿åä¸æ¶é´åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡è¿æ®µä»£ç ï¼\n\n\n# æé æ¹æ³å¯ä»¥ç¨ synchronized ä¿®é¥°ä¹ï¼\n\nä¸å¯ä»¥ã\n\nå ä¸ºæé æ¹æ³æ¬èº«å°±å±äºçº¿ç¨å®å¨çï¼ä¸å­å¨åæ­¥çæé æ¹æ³ä¸è¯´ã\n\n\n# synchronized çåºå±åçæ¯ä»ä¹ï¼\n\n * synchronized åæ­¥è¯­å¥åæ¶\n   \n   ä½¿ç¨çæ¯ monitorenter å monitorexit æä»¤ï¼å¶ä¸­ monitorenter æä»¤æååæ­¥ä»£ç åçå¼å§ä½ç½®ï¼monitorexit æä»¤åææåæ­¥ä»£ç åçç»æä½ç½®ã\n\n * synchronized ä¿®é¥°æ¹æ³æ¶\n   \n   æ²¡æ monitorenter æä»¤å monitorexit æä»¤ï¼åèä»£ä¹çæ¯ ACC_SYNCHRONIZED æ è¯ï¼è¯¥æ è¯ææäºè¯¥æ¹æ³æ¯ä¸ä¸ªåæ­¥æ¹æ³ã\n\n\n# volatile å³é®å­\n\n\n# ä»ä¹æ¯ volatile å³é®å­ï¼\n\nvolatile å³é®å­æ¯ Java ä¸­ç¨äºä¿è¯åéå¯è§æ§åç¦æ­¢æä»¤éæåºä¼åçä¸ç§æºå¶ãåªè½ä¿è¯åä¸ªåéçåå­æ§ï¼ä¸è½ä¿è¯å¤åæä½çåå­æ§ã\n\n\n# volatile å³é®å­è§£å³äºä»ä¹é®é¢ï¼\n\nvolatile å³é®å­ä¸»è¦è§£å³äºä¸¤ä¸ªé®é¢ï¼å¯è§æ§é®é¢åæä»¤éæåºé®é¢ã\n\n 1. å¯è§æ§é®é¢\n    \n    å¨å¤çº¿ç¨ç¯å¢ä¸ï¼æ¯ä¸ªçº¿ç¨é½æèªå·±çå·¥ä½åå­ï¼ç¨äºå­å¨çº¿ç¨éè¦ä½¿ç¨çåéãå½ä¸ä¸ªçº¿ç¨ä¿®æ¹äºæä¸ªåéçå¼æ¶ï¼è¿ä¸ªåéçå¼å¹¶ä¸ä¼ç«å³è¢«å¶ä»çº¿ç¨çå°ï¼éè¦å°è¯¥åéçå¼åæ­¥å°ä¸»åå­ä¸­ï¼å¶ä»çº¿ç¨æè½çå°è¯¥åéçææ°å¼ã\n    \n    è volatile å³é®å­å¯ä»¥ä¿è¯åéçä¿®æ¹å¯¹å¶ä»çº¿ç¨å¯è§ï¼ä»èé¿åäºå¯è§æ§é®é¢ã\n\n 2. æä»¤éæåºé®é¢\n    \n    å¨å¤çº¿ç¨ç¯å¢ä¸ï¼ä¸ºäºæé«ç¨åºæ§è½ï¼CPU å¯è½ä¼å¯¹æä»¤è¿è¡éæåºï¼ä½æä»¤éæåºå¯è½ä¼å¯¼è´ç¨åºåºç°ææ³ä¸å°çç»æãä¾å¦ï¼å¨ä¸ä¸ªåéæ£æ¥éå®ä¸­ï¼å¦æä¸ä½¿ç¨ volatile å³é®å­ï¼å¯è½ä¼å¯¼è´å¦ä¸ä¸ªçº¿ç¨è·åå°æªå®å¨åå§åçå¯¹è±¡ï¼ä»èåºç°é®é¢ã\n    \n    èä½¿ç¨ volatile å³é®å­å¯ä»¥ç¦æ­¢æä»¤éæåºä¼åï¼ä¿è¯äºç¨åºçæ­£ç¡®æ§ã\n\n\n# synchronized å volatile æä»ä¹åºå«ï¼\n\nsynchronized å³é®å­å volatile å³é®å­æ¯ä¸¤ä¸ªäºè¡¥çå­å¨ï¼èä¸æ¯å¯¹ç«çå­å¨ï¼\n\n * volatile å³é®å­æ¯çº¿ç¨åæ­¥çè½»éçº§å®ç°ï¼æä»¥ volatile æ§è½è¯å®æ¯ synchronized å³é®å­è¦å¥½ ãä½æ¯ volatile å³é®å­åªè½ç¨äºåä¸ªåéè synchronized å³é®å­å¯ä»¥ä¿®é¥°æ¹æ³ä»¥åä»£ç åã\n * volatile å³é®å­è½ä¿è¯æ°æ®çå¯è§æ§ï¼ä½ä¸è½ä¿è¯æ°æ®çåå­æ§ãsynchronized å³é®å­ä¸¤èé½è½ä¿è¯ã\n * volatile å³é®å­ä¸»è¦ç¨äºè§£å³åä¸ªåéå¨å¤ä¸ªçº¿ç¨ä¹é´çå¯è§æ§ï¼è synchronized å³é®å­è§£å³çæ¯å¤çº¿ç¨ä¹é´çèµæºåæ­¥ã\n\n\n# volatile çå®ç°åçäºè§£åï¼\n\n> åè®²ä¸ volatile æ¯æä¹ä¿è¯å¯è§æ§çå§\n\nvolatile å¯ä»¥ç¡®ä¿å¯¹æä¸ªåéçæ´æ°å¯¹å¶ä»çº¿ç¨é©¬ä¸å¯è§ï¼ä¸ä¸ªåéè¢«å£°æä¸º volatile æ¶ï¼çº¿ç¨å¨åå¥åéæ¶ä¸ä¼æå¼ç¼å­å¨å¯å­å¨æèå¶ä»å°æ¹ï¼èæ¯ä¼æå¼å·æ°åä¸»åå­ å½å¶å®çº¿ç¨è¯»åè¯¥å±äº«åéï¼ä¼ä»ä¸»åå­éæ°è·åææ°å¼ï¼èä¸æ¯ä½¿ç¨å½åçº¿ç¨çæ¬å°åå­ä¸­çå¼ã\n\nä¾å¦ï¼æä»¬å£°æä¸ä¸ª volatile åé volatile int x = 0ï¼çº¿ç¨ A ä¿®æ¹ x=1ï¼ä¿®æ¹å®ä¹åå°±ä¼ææ°çå¼å·æ°åä¸»åå­ï¼çº¿ç¨ B è¯»å x çæ¶åï¼å°±ä¼æ¸ç©ºæ¬å°åå­åéï¼ç¶ååä»ä¸»åå­è·åææ°å¼ã\n\né£çº¿ç¨ B æ¯æä¹ç¥é x è¢«ä¿®æ¹äºçå¢ï¼\n\nå¨ Java åå­æ¨¡åä¸­ï¼å½ä¸ä¸ªçº¿ç¨ä¿®æ¹äº volatile åéçå¼ï¼ä¼å°è¿ä¸ªåéçæ°å¼å·æ°åä¸»åå­ï¼å¹¶ä¸éç¥å¶ä»çº¿ç¨ï¼åè¯å®ä»¬è¿ä¸ªåéçå¼å·²ç»åçäºæ¹åãå½å¶ä»çº¿ç¨ï¼æ¯å¦çº¿ç¨Bï¼éè¦è¯»åè¿ä¸ª volatile åéçå¼æ¶ï¼å®ä»¬ä¼ä»ä¸»åå­ä¸­è·åææ°çå¼ï¼èä¸æ¯ä»æ¬å°åå­ä¸­è¯»åã\n\nå·ä½æ¥è¯´ï¼å½çº¿ç¨ A ä¿®æ¹äº volatile åé x çå¼ä¸º 1ï¼å¹¶å°æ°çå¼å·æ°åä¸»åå­åï¼ä¸»åå­ä¼è®°å½è¿ä¸ªååï¼å¹¶å¨åé¨ç»´æ¤ä¸ä¸ªåéçæ¬å·ãå¶ä»çº¿ç¨ï¼å¦çº¿ç¨ Bï¼å¨è¯»å volatile åéæ¶ï¼ä¼ä»ä¸»åå­ä¸­è·åææ°çå¼ï¼å¹¶æ£æ¥çæ¬å·ï¼ä»¥ç¡®ä¿å®ä»¬è¯»åçæ¯ææ°çå¼ã\n\n\n# è¯´ä¸ä¸ä½ å¯¹ Java åå­æ¨¡åï¼JMMï¼ççè§£ï¼\n\nJava åå­æ¨¡åï¼JMMï¼æ¯ä¸ç§è§èï¼æ¯ä¸ç§æ½è±¡çæ¨¡åï¼ç¨äºå®ä¹å¨å¤çº¿ç¨ç¯å¢ä¸ï¼çº¿ç¨ä¹é´å¦ä½ä¸ä¸»åå­åå·¥ä½åå­è¿è¡äº¤äºï¼ä»¥åå¦ä½ä¿è¯çº¿ç¨ä¹é´çå¯è§æ§ãæåºæ§ååå­æ§ã\n\nJMM ä¸»è¦å³æ³¨ä»¥ä¸å ä¸ªæ¦å¿µï¼\n\n 1. **ä¸»åå­åå·¥ä½åå­ï¼**ä¸»åå­æ¯ææçº¿ç¨å±äº«çåå­åºåï¼èæ¯ä¸ªçº¿ç¨é½æèªå·±çå·¥ä½åå­ï¼å·¥ä½åå­å­å¨äºä¸»åå­çå¯æ¬ãçº¿ç¨å¯¹åéçæä½é¦åå¨å·¥ä½åå­ä¸­è¿è¡ï¼ç¶åéè¿ç¹å®çæä½å°ç»æåæ­¥å°ä¸»åå­ã\n 2. **å¯è§æ§ï¼**JMM ä¿è¯ä¸ä¸ªçº¿ç¨å¯¹å±äº«åéçä¿®æ¹å¯¹å¶ä»çº¿ç¨æ¯å¯è§çãéè¿ volatile å³é®å­å synchronized å³é®å­ç­æºå¶ï¼å¯ä»¥ç¡®ä¿åéçæ´æ°å¨ä¸åçº¿ç¨é´å¯è§ã\n 3. **æåºæ§ï¼**JMM å®ä¹äºä¸åæä½ä¹é´çæ§è¡é¡ºåºãç¼è¯å¨åå¤çå¨å¯è½ä¼å¯¹æä»¤éæåºï¼ä½æ¯ JMM è§å®äºä¸äºè§åæ¥ç¡®ä¿ç¨åºçæ§è¡é¡ºåºç¬¦åé¢æã\n 4. **åå­æ§ï¼**JMM ä¿è¯ä¸äºæä½çåå­æ§ï¼å¦å¯¹ volatile åéçè¯»åæä½å·æåå­æ§ãæ­¤å¤ï¼å¯ä»¥éè¿ synchronized å³é®å­æ Lock æºå¶æ¥ä¿è¯ä»£ç åçåå­æ§ã\n\næ»çæ¥è¯´ï¼Java åå­æ¨¡åæ¯ä¸ºäºè§£å³å¤çº¿ç¨ç¯å¢ä¸å¯è½åºç°çå¯è§æ§ãæåºæ§ååå­æ§é®é¢èè®¾è®¡çãå®è§å®äºçº¿ç¨ä¹é´å¦ä½ä¸åå­äº¤äºï¼ä»¥åå¦ä½ä¿è¯çº¿ç¨å®å¨ãäºè§£ JMM å¯¹äºç¼åå¹¶åå®å¨çå¤çº¿ç¨ç¨åºè³å³éè¦ï¼å ä¸ºå®å¸®å©å¼åäººåçè§£çº¿ç¨ä¹é´çäº¤äºè§åï¼ä»èé¿ååºç°æå¤çå¹¶åé®é¢ã\n\nä¸ºä»ä¹å¯¹ volatile åéçè¯»åæä½å·æåå­æ§ï¼\n\nå¨ Java ä¸­ï¼å¯¹ volatile åéçè¯»åæä½å·æåå­æ§ï¼è¿æå³çåä¸ªè¯»åæåå¥ volatile åéçæä½å¨æ§è¡è¿ç¨ä¸­ä¸ä¼è¢«ä¸­æ­ï¼ä¹ä¸ä¼åå°å¶ä»çº¿ç¨çå¹²æ°ï¼ä»èç¡®ä¿äºæä½çå®æ´æ§ã\n\n-- è¿ç§ç¹æ§æ¯ç± Java åå­æ¨¡åï¼JMMï¼æè§å®çã\n\n 1. **åå­å¯è§æ§ï¼**volatile å³é®å­ä¸ä»ä¿è¯äºå¯¹åéçä¿®æ¹å¯¹å¶ä»çº¿ç¨æ¯å¯è§çï¼è¿ä¿è¯äºåä¸ªè¯»åæåå¥æä½å¨ä¸»åå­åå·¥ä½åå­ä¹é´çåæ­¥ãè¿æ ·ï¼çº¿ç¨å¨è¯»å volatile åéæ¶ï¼æ»æ¯è½å¤çå°ææ°çå¼ãï¼æ´æ°å¯è§ï¼\n 2. **ç¦æ­¢æä»¤éæåºï¼**volatile å³é®å­ä¹ä¼ç¦æ­¢ç¼è¯å¨åå¤çå¨å¯¹ volatile åéçè¯»åæä»¤è¿è¡éæåºãè¿æå³çå¨åå¥ volatile åéåï¼è¯¥æä½ä¹åçæææä½é½ä¼è¢«å®æï¼èå¨è¯»å volatile åéåï¼è¯¥æä½ä¹åçæææä½é½ä¼è¢«å»¶è¿ãï¼æç»æ§è¡ç»æä¸ä¼åï¼\n 3. **æä½ä¸å·å¤åå­æ§ï¼**éè¦æ³¨æçæ¯ï¼è½ç¶å¯¹ volatile åéçåä¸ªè¯»åæä½å·æåå­æ§ï¼ä½æ¯å¤ä¸ªæä½ç»åå¨ä¸èµ·å¯è½ä¸å·å¤åå­æ§ãä¾å¦ï¼éå¢æä½ "x++" æ¯ä¸ä¸ªå¤åæä½ï¼x+1 ä¸ºä¸æ¬¡ï¼x=x+1 ä¸ºä¸æ¬¡ï¼ï¼è½ç¶åä¸ªçè¯»åååå¥æä½é½æ¯åå­çï¼ä½æ¯ç»åå¨ä¸èµ·æ¶å¹¶ä¸æ¯åå­çãå¨è¿ç§æåµä¸ï¼åºè¯¥ä½¿ç¨éæå¶ä»åæ­¥æºå¶æ¥ç¡®ä¿åå­æ§ã\n\n\n# å­¦ä¹ åè\n\n * Javaå¹¶åå¸¸è§é¢è¯é¢æ»ç»ï¼ä¸­ï¼ | JavaGuide(Javaé¢è¯ + å­¦ä¹ æå)\n\n * èèJavaå³é®å­synchronized | Shark Chili\n\n * é¢æ¸£éè¢­ | Javaå¹¶åç¼ç¨',normalizedContent:'# synchronizedåvolatileçä½¿ç¨ä¸åºå«\n\n\n# synchronized å³é®å­\n\n\n# ä»ä¹æ¯ synchronized å³é®å­ï¼\n\nsynchronized æ¯ java ä¸­çä¸ä¸ªå³é®å­ï¼ç¿»è¯æä¸­ææ¯åæ­¥çææã\n\nä¸»è¦è§£å³çæ¯ï¼å¤ä¸ªçº¿ç¨ä¹é´è®¿é®èµæºçåæ­¥æ§ãå¯ä»¥ä¿è¯è¢«å®ä¿®é¥°çæ¹æ³æèä»£ç åå¨ä»»ææ¶å»åªè½æä¸ä¸ªçº¿ç¨æ§è¡ã\n\nä½¿ç¨æ¹å¼\n\nä½¿ç¨ synchronized å³é®å­æ¶ï¼éè¦å¨æ¹æ³æä»£ç åä¸å éï¼ä»¥ç¡®ä¿åä¸æ¶é´åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡è¿æ®µä»£ç ï¼\n\n\n# æé æ¹æ³å¯ä»¥ç¨ synchronized ä¿®é¥°ä¹ï¼\n\nä¸å¯ä»¥ã\n\nå ä¸ºæé æ¹æ³æ¬èº«å°±å±äºçº¿ç¨å®å¨çï¼ä¸å­å¨åæ­¥çæé æ¹æ³ä¸è¯´ã\n\n\n# synchronized çåºå±åçæ¯ä»ä¹ï¼\n\n * synchronized åæ­¥è¯­å¥åæ¶\n   \n   ä½¿ç¨çæ¯ monitorenter å monitorexit æä»¤ï¼å¶ä¸­ monitorenter æä»¤æååæ­¥ä»£ç åçå¼å§ä½ç½®ï¼monitorexit æä»¤åææåæ­¥ä»£ç åçç»æä½ç½®ã\n\n * synchronized ä¿®é¥°æ¹æ³æ¶\n   \n   æ²¡æ monitorenter æä»¤å monitorexit æä»¤ï¼åèä»£ä¹çæ¯ acc_synchronized æ è¯ï¼è¯¥æ è¯ææäºè¯¥æ¹æ³æ¯ä¸ä¸ªåæ­¥æ¹æ³ã\n\n\n# volatile å³é®å­\n\n\n# ä»ä¹æ¯ volatile å³é®å­ï¼\n\nvolatile å³é®å­æ¯ java ä¸­ç¨äºä¿è¯åéå¯è§æ§åç¦æ­¢æä»¤éæåºä¼åçä¸ç§æºå¶ãåªè½ä¿è¯åä¸ªåéçåå­æ§ï¼ä¸è½ä¿è¯å¤åæä½çåå­æ§ã\n\n\n# volatile å³é®å­è§£å³äºä»ä¹é®é¢ï¼\n\nvolatile å³é®å­ä¸»è¦è§£å³äºä¸¤ä¸ªé®é¢ï¼å¯è§æ§é®é¢åæä»¤éæåºé®é¢ã\n\n 1. å¯è§æ§é®é¢\n    \n    å¨å¤çº¿ç¨ç¯å¢ä¸ï¼æ¯ä¸ªçº¿ç¨é½æèªå·±çå·¥ä½åå­ï¼ç¨äºå­å¨çº¿ç¨éè¦ä½¿ç¨çåéãå½ä¸ä¸ªçº¿ç¨ä¿®æ¹äºæä¸ªåéçå¼æ¶ï¼è¿ä¸ªåéçå¼å¹¶ä¸ä¼ç«å³è¢«å¶ä»çº¿ç¨çå°ï¼éè¦å°è¯¥åéçå¼åæ­¥å°ä¸»åå­ä¸­ï¼å¶ä»çº¿ç¨æè½çå°è¯¥åéçææ°å¼ã\n    \n    è volatile å³é®å­å¯ä»¥ä¿è¯åéçä¿®æ¹å¯¹å¶ä»çº¿ç¨å¯è§ï¼ä»èé¿åäºå¯è§æ§é®é¢ã\n\n 2. æä»¤éæåºé®é¢\n    \n    å¨å¤çº¿ç¨ç¯å¢ä¸ï¼ä¸ºäºæé«ç¨åºæ§è½ï¼cpu å¯è½ä¼å¯¹æä»¤è¿è¡éæåºï¼ä½æä»¤éæåºå¯è½ä¼å¯¼è´ç¨åºåºç°ææ³ä¸å°çç»æãä¾å¦ï¼å¨ä¸ä¸ªåéæ£æ¥éå®ä¸­ï¼å¦æä¸ä½¿ç¨ volatile å³é®å­ï¼å¯è½ä¼å¯¼è´å¦ä¸ä¸ªçº¿ç¨è·åå°æªå®å¨åå§åçå¯¹è±¡ï¼ä»èåºç°é®é¢ã\n    \n    èä½¿ç¨ volatile å³é®å­å¯ä»¥ç¦æ­¢æä»¤éæåºä¼åï¼ä¿è¯äºç¨åºçæ­£ç¡®æ§ã\n\n\n# synchronized å volatile æä»ä¹åºå«ï¼\n\nsynchronized å³é®å­å volatile å³é®å­æ¯ä¸¤ä¸ªäºè¡¥çå­å¨ï¼èä¸æ¯å¯¹ç«çå­å¨ï¼\n\n * volatile å³é®å­æ¯çº¿ç¨åæ­¥çè½»éçº§å®ç°ï¼æä»¥ volatile æ§è½è¯å®æ¯ synchronized å³é®å­è¦å¥½ ãä½æ¯ volatile å³é®å­åªè½ç¨äºåä¸ªåéè synchronized å³é®å­å¯ä»¥ä¿®é¥°æ¹æ³ä»¥åä»£ç åã\n * volatile å³é®å­è½ä¿è¯æ°æ®çå¯è§æ§ï¼ä½ä¸è½ä¿è¯æ°æ®çåå­æ§ãsynchronized å³é®å­ä¸¤èé½è½ä¿è¯ã\n * volatile å³é®å­ä¸»è¦ç¨äºè§£å³åä¸ªåéå¨å¤ä¸ªçº¿ç¨ä¹é´çå¯è§æ§ï¼è synchronized å³é®å­è§£å³çæ¯å¤çº¿ç¨ä¹é´çèµæºåæ­¥ã\n\n\n# volatile çå®ç°åçäºè§£åï¼\n\n> åè®²ä¸ volatile æ¯æä¹ä¿è¯å¯è§æ§çå§\n\nvolatile å¯ä»¥ç¡®ä¿å¯¹æä¸ªåéçæ´æ°å¯¹å¶ä»çº¿ç¨é©¬ä¸å¯è§ï¼ä¸ä¸ªåéè¢«å£°æä¸º volatile æ¶ï¼çº¿ç¨å¨åå¥åéæ¶ä¸ä¼æå¼ç¼å­å¨å¯å­å¨æèå¶ä»å°æ¹ï¼èæ¯ä¼æå¼å·æ°åä¸»åå­ å½å¶å®çº¿ç¨è¯»åè¯¥å±äº«åéï¼ä¼ä»ä¸»åå­éæ°è·åææ°å¼ï¼èä¸æ¯ä½¿ç¨å½åçº¿ç¨çæ¬å°åå­ä¸­çå¼ã\n\nä¾å¦ï¼æä»¬å£°æä¸ä¸ª volatile åé volatile int x = 0ï¼çº¿ç¨ a ä¿®æ¹ x=1ï¼ä¿®æ¹å®ä¹åå°±ä¼ææ°çå¼å·æ°åä¸»åå­ï¼çº¿ç¨ b è¯»å x çæ¶åï¼å°±ä¼æ¸ç©ºæ¬å°åå­åéï¼ç¶ååä»ä¸»åå­è·åææ°å¼ã\n\né£çº¿ç¨ b æ¯æä¹ç¥é x è¢«ä¿®æ¹äºçå¢ï¼\n\nå¨ java åå­æ¨¡åä¸­ï¼å½ä¸ä¸ªçº¿ç¨ä¿®æ¹äº volatile åéçå¼ï¼ä¼å°è¿ä¸ªåéçæ°å¼å·æ°åä¸»åå­ï¼å¹¶ä¸éç¥å¶ä»çº¿ç¨ï¼åè¯å®ä»¬è¿ä¸ªåéçå¼å·²ç»åçäºæ¹åãå½å¶ä»çº¿ç¨ï¼æ¯å¦çº¿ç¨bï¼éè¦è¯»åè¿ä¸ª volatile åéçå¼æ¶ï¼å®ä»¬ä¼ä»ä¸»åå­ä¸­è·åææ°çå¼ï¼èä¸æ¯ä»æ¬å°åå­ä¸­è¯»åã\n\nå·ä½æ¥è¯´ï¼å½çº¿ç¨ a ä¿®æ¹äº volatile åé x çå¼ä¸º 1ï¼å¹¶å°æ°çå¼å·æ°åä¸»åå­åï¼ä¸»åå­ä¼è®°å½è¿ä¸ªååï¼å¹¶å¨åé¨ç»´æ¤ä¸ä¸ªåéçæ¬å·ãå¶ä»çº¿ç¨ï¼å¦çº¿ç¨ bï¼å¨è¯»å volatile åéæ¶ï¼ä¼ä»ä¸»åå­ä¸­è·åææ°çå¼ï¼å¹¶æ£æ¥çæ¬å·ï¼ä»¥ç¡®ä¿å®ä»¬è¯»åçæ¯ææ°çå¼ã\n\n\n# è¯´ä¸ä¸ä½ å¯¹ java åå­æ¨¡åï¼jmmï¼ççè§£ï¼\n\njava åå­æ¨¡åï¼jmmï¼æ¯ä¸ç§è§èï¼æ¯ä¸ç§æ½è±¡çæ¨¡åï¼ç¨äºå®ä¹å¨å¤çº¿ç¨ç¯å¢ä¸ï¼çº¿ç¨ä¹é´å¦ä½ä¸ä¸»åå­åå·¥ä½åå­è¿è¡äº¤äºï¼ä»¥åå¦ä½ä¿è¯çº¿ç¨ä¹é´çå¯è§æ§ãæåºæ§ååå­æ§ã\n\njmm ä¸»è¦å³æ³¨ä»¥ä¸å ä¸ªæ¦å¿µï¼\n\n 1. **ä¸»åå­åå·¥ä½åå­ï¼**ä¸»åå­æ¯ææçº¿ç¨å±äº«çåå­åºåï¼èæ¯ä¸ªçº¿ç¨é½æèªå·±çå·¥ä½åå­ï¼å·¥ä½åå­å­å¨äºä¸»åå­çå¯æ¬ãçº¿ç¨å¯¹åéçæä½é¦åå¨å·¥ä½åå­ä¸­è¿è¡ï¼ç¶åéè¿ç¹å®çæä½å°ç»æåæ­¥å°ä¸»åå­ã\n 2. **å¯è§æ§ï¼**jmm ä¿è¯ä¸ä¸ªçº¿ç¨å¯¹å±äº«åéçä¿®æ¹å¯¹å¶ä»çº¿ç¨æ¯å¯è§çãéè¿ volatile å³é®å­å synchronized å³é®å­ç­æºå¶ï¼å¯ä»¥ç¡®ä¿åéçæ´æ°å¨ä¸åçº¿ç¨é´å¯è§ã\n 3. **æåºæ§ï¼**jmm å®ä¹äºä¸åæä½ä¹é´çæ§è¡é¡ºåºãç¼è¯å¨åå¤çå¨å¯è½ä¼å¯¹æä»¤éæåºï¼ä½æ¯ jmm è§å®äºä¸äºè§åæ¥ç¡®ä¿ç¨åºçæ§è¡é¡ºåºç¬¦åé¢æã\n 4. **åå­æ§ï¼**jmm ä¿è¯ä¸äºæä½çåå­æ§ï¼å¦å¯¹ volatile åéçè¯»åæä½å·æåå­æ§ãæ­¤å¤ï¼å¯ä»¥éè¿ synchronized å³é®å­æ lock æºå¶æ¥ä¿è¯ä»£ç åçåå­æ§ã\n\næ»çæ¥è¯´ï¼java åå­æ¨¡åæ¯ä¸ºäºè§£å³å¤çº¿ç¨ç¯å¢ä¸å¯è½åºç°çå¯è§æ§ãæåºæ§ååå­æ§é®é¢èè®¾è®¡çãå®è§å®äºçº¿ç¨ä¹é´å¦ä½ä¸åå­äº¤äºï¼ä»¥åå¦ä½ä¿è¯çº¿ç¨å®å¨ãäºè§£ jmm å¯¹äºç¼åå¹¶åå®å¨çå¤çº¿ç¨ç¨åºè³å³éè¦ï¼å ä¸ºå®å¸®å©å¼åäººåçè§£çº¿ç¨ä¹é´çäº¤äºè§åï¼ä»èé¿ååºç°æå¤çå¹¶åé®é¢ã\n\nä¸ºä»ä¹å¯¹ volatile åéçè¯»åæä½å·æåå­æ§ï¼\n\nå¨ java ä¸­ï¼å¯¹ volatile åéçè¯»åæä½å·æåå­æ§ï¼è¿æå³çåä¸ªè¯»åæåå¥ volatile åéçæä½å¨æ§è¡è¿ç¨ä¸­ä¸ä¼è¢«ä¸­æ­ï¼ä¹ä¸ä¼åå°å¶ä»çº¿ç¨çå¹²æ°ï¼ä»èç¡®ä¿äºæä½çå®æ´æ§ã\n\n-- è¿ç§ç¹æ§æ¯ç± java åå­æ¨¡åï¼jmmï¼æè§å®çã\n\n 1. **åå­å¯è§æ§ï¼**volatile å³é®å­ä¸ä»ä¿è¯äºå¯¹åéçä¿®æ¹å¯¹å¶ä»çº¿ç¨æ¯å¯è§çï¼è¿ä¿è¯äºåä¸ªè¯»åæåå¥æä½å¨ä¸»åå­åå·¥ä½åå­ä¹é´çåæ­¥ãè¿æ ·ï¼çº¿ç¨å¨è¯»å volatile åéæ¶ï¼æ»æ¯è½å¤çå°ææ°çå¼ãï¼æ´æ°å¯è§ï¼\n 2. **ç¦æ­¢æä»¤éæåºï¼**volatile å³é®å­ä¹ä¼ç¦æ­¢ç¼è¯å¨åå¤çå¨å¯¹ volatile åéçè¯»åæä»¤è¿è¡éæåºãè¿æå³çå¨åå¥ volatile åéåï¼è¯¥æä½ä¹åçæææä½é½ä¼è¢«å®æï¼èå¨è¯»å volatile åéåï¼è¯¥æä½ä¹åçæææä½é½ä¼è¢«å»¶è¿ãï¼æç»æ§è¡ç»æä¸ä¼åï¼\n 3. **æä½ä¸å·å¤åå­æ§ï¼**éè¦æ³¨æçæ¯ï¼è½ç¶å¯¹ volatile åéçåä¸ªè¯»åæä½å·æåå­æ§ï¼ä½æ¯å¤ä¸ªæä½ç»åå¨ä¸èµ·å¯è½ä¸å·å¤åå­æ§ãä¾å¦ï¼éå¢æä½ "x++" æ¯ä¸ä¸ªå¤åæä½ï¼x+1 ä¸ºä¸æ¬¡ï¼x=x+1 ä¸ºä¸æ¬¡ï¼ï¼è½ç¶åä¸ªçè¯»åååå¥æä½é½æ¯åå­çï¼ä½æ¯ç»åå¨ä¸èµ·æ¶å¹¶ä¸æ¯åå­çãå¨è¿ç§æåµä¸ï¼åºè¯¥ä½¿ç¨éæå¶ä»åæ­¥æºå¶æ¥ç¡®ä¿åå­æ§ã\n\n\n# å­¦ä¹ åè\n\n * javaå¹¶åå¸¸è§é¢è¯é¢æ»ç»ï¼ä¸­ï¼ | javaguide(javaé¢è¯ + å­¦ä¹ æå)\n\n * èèjavaå³é®å­synchronized | shark chili\n\n * é¢æ¸£éè¢­ | javaå¹¶åç¼ç¨',charsets:{cjk:!0}},{title:"Queueæ¥å£",frontmatter:{title:"Queueæ¥å£",date:"2023-07-12T14:50:53.000Z",permalink:"/pages/887881/",author:{name:"éä¸æ¸é£",link:"https://github.com/msqfx"},categories:["java","éåç¯"],tags:[null],description:"Queue æ¯åç«¯éåï¼åªè½ä»ä¸ç«¯æå¥åç´ ï¼å¦ä¸ç«¯å é¤åç´ ï¼å®ç°ä¸ä¸è¬éµå¾ª åè¿ååºï¼FIFOï¼ è§åã",comment:!0,meta:[{name:"twitter:title",content:"Queueæ¥å£"},{name:"twitter:description",content:"Queue æ¯åç«¯éåï¼åªè½ä»ä¸ç«¯æå¥åç´ ï¼å¦ä¸ç«¯å é¤åç´ ï¼å®ç°ä¸ä¸è¬éµå¾ª åè¿ååºï¼FIFOï¼ è§åã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/01.java/02.%E9%9B%86%E5%90%88%E7%AF%87/04.Queue%E6%8E%A5%E5%8F%A3.html"},{property:"og:type",content:"article"},{property:"og:title",content:"Queueæ¥å£"},{property:"og:description",content:"Queue æ¯åç«¯éåï¼åªè½ä»ä¸ç«¯æå¥åç´ ï¼å¦ä¸ç«¯å é¤åç´ ï¼å®ç°ä¸ä¸è¬éµå¾ª åè¿ååºï¼FIFOï¼ è§åã"},{property:"og:url",content:"https://www.msqfx.cc/01.java/02.%E9%9B%86%E5%90%88%E7%AF%87/04.Queue%E6%8E%A5%E5%8F%A3.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-07-12T14:50:53.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"Queueæ¥å£"},{itemprop:"description",content:"Queue æ¯åç«¯éåï¼åªè½ä»ä¸ç«¯æå¥åç´ ï¼å¦ä¸ç«¯å é¤åç´ ï¼å®ç°ä¸ä¸è¬éµå¾ª åè¿ååºï¼FIFOï¼ è§åã"}],readingShow:"top"},regularPath:"/01.java/02.%E9%9B%86%E5%90%88%E7%AF%87/04.Queue%E6%8E%A5%E5%8F%A3.html",relativePath:"01.java/02.éåç¯/04.Queueæ¥å£.md",key:"v-3223b15c",path:"/pages/887881/",headers:[{level:2,title:"Queue ä¸ Deque çåºå«",slug:"queue-ä¸-deque-çåºå«",normalizedTitle:"queue ä¸ deque çåºå«",charIndex:17},{level:2,title:"ArrayDeque ä¸ LinkedList çåºå«",slug:"arraydeque-ä¸-linkedlist-çåºå«",normalizedTitle:"arraydeque ä¸ linkedlist çåºå«",charIndex:715},{level:2,title:"è¯´ä¸è¯´ PriorityQueueï¼ä¼åçº§éåï¼",slug:"è¯´ä¸è¯´-priorityqueue-ä¼åçº§éå",normalizedTitle:"è¯´ä¸è¯´ priorityqueueï¼ä¼åçº§éåï¼",charIndex:1135}],headersStr:"Queue ä¸ Deque çåºå« ArrayDeque ä¸ LinkedList çåºå« è¯´ä¸è¯´ PriorityQueueï¼ä¼åçº§éåï¼",content:"# Queue éåè¯¦è§£\n\n\n# Queue ä¸ Deque çåºå«\n\nQueue æ¯åç«¯éåï¼åªè½ä»ä¸ç«¯æå¥åç´ ï¼å¦ä¸ç«¯å é¤åç´ ï¼å®ç°ä¸ä¸è¬éµå¾ª åè¿ååºï¼FIFOï¼ è§åã\n\nQueue æ©å±äº Collection çæ¥å£ï¼æ ¹æ® å ä¸ºå®¹éé®é¢èå¯¼è´æä½å¤±è´¥åå¤çæ¹å¼çä¸å å¯ä»¥åä¸ºä¸¤ç±»æ¹æ³: ä¸ç§å¨æä½å¤±è´¥åä¼æåºå¼å¸¸ï¼å¦ä¸ç§åä¼è¿åç¹æ®å¼ã\n\nQUEUE æ¥å£   æåºå¼å¸¸        è¿åç¹æ®å¼\næå¥éå°¾       add(E e)    offer(E e)\nå é¤éé¦       remove()    poll()\næ¥è¯¢éé¦åç´      element()   peek()\n\nDeque æ¯åç«¯éåï¼å¨éåçä¸¤ç«¯åå¯ä»¥æå¥æå é¤åç´ ã\n\nDeque æ©å±äº Queue çæ¥å£, å¢å äºå¨éé¦åéå°¾è¿è¡æå¥åå é¤çæ¹æ³ï¼åæ ·æ ¹æ®å¤±è´¥åå¤çæ¹å¼çä¸ååä¸ºä¸¤ç±»ï¼\n\nDEQUE æ¥å£   æåºå¼å¸¸            è¿åç¹æ®å¼\næå¥éé¦       addFirst(E e)   offerFirst(E e)\næå¥éå°¾       addLast(E e)    offerLast(E e)\nå é¤éé¦       removeFirst()   pollFirst()\nå é¤éå°¾       removeLast()    pollLast()\næ¥è¯¢éé¦åç´      getFirst()      peekFirst()\næ¥è¯¢éå°¾åç´      getLast()       peekLast()\n\näºå®ä¸ï¼Deque è¿æä¾æ push() å pop() ç­å¶ä»æ¹æ³ï¼å¯ç¨äºæ¨¡ææ ã\n\n\n# ArrayDeque ä¸ LinkedList çåºå«\n\nArrayDeque å LinkedList é½å®ç°äº Deque æ¥å£ï¼ä¸¤èé½å·æéåçåè½ï¼ä½ä¸¤èæä»ä¹åºå«å¢ï¼\n\n * ArrayDeque æ¯åºäºå¯åé¿çæ°ç»ååæéæ¥å®ç°ï¼è LinkedList åéè¿é¾è¡¨æ¥å®ç°ã\n * ArrayDeque ä¸æ¯æå­å¨ NULL æ°æ®ï¼ä½ LinkedList æ¯æã\n * ArrayDeque æ¯å¨ JDK1.6 æè¢«å¼å¥çï¼èLinkedList æ©å¨ JDK1.2 æ¶å°±å·²ç»å­å¨ã\n * ArrayDeque æå¥æ¶å¯è½å­å¨æ©å®¹è¿ç¨, ä¸è¿åæåçæå¥æä½ä¾ç¶ä¸º O(1)ãè½ç¶ LinkedList ä¸éè¦æ©å®¹ï¼ä½æ¯æ¯æ¬¡æå¥æ°æ®æ¶åéè¦ç³è¯·æ°çå ç©ºé´ï¼åææ§è½ç¸æ¯æ´æ¢ã\n\n> ä»æ§è½çè§åº¦ä¸ï¼éç¨ ArrayDeque æ¥å®ç°éåè¦æ¯ LinkedList æ´å¥½ãæ­¤å¤ï¼ArrayDeque ä¹å¯ä»¥ç¨äºå®ç°æ ã\n\n\n# è¯´ä¸è¯´ PriorityQueueï¼ä¼åçº§éåï¼\n\nPriorityQueue æ¯å¨ JDK1.5 ä¸­è¢«å¼å¥ç, å¶ä¸ Queue çåºå«å¨äºåç´ åºéé¡ºåºæ¯ä¸ä¼åçº§ç¸å³çï¼å³æ»æ¯ä¼åçº§æé«çåç´ ååºéã\n\nè¿éåä¸¾å¶ç¸å³çä¸äºè¦ç¹ï¼\n\n * PriorityQueue å©ç¨äºäºåå çæ°æ®ç»ææ¥å®ç°çï¼åºå±ä½¿ç¨å¯åé¿çæ°ç»æ¥å­å¨æ°æ®\n * PriorityQueue éè¿å åç´ çä¸æµ®åä¸æ²ï¼å®ç°äºå¨ O(logn) çæ¶é´å¤æåº¦åæå¥åç´ åå é¤å é¡¶åç´ ã\n * PriorityQueue æ¯éçº¿ç¨å®å¨çï¼ä¸ä¸æ¯æå­å¨ NULL å non-comparable çå¯¹è±¡ã\n * PriorityQueue é»è®¤æ¯å°é¡¶å ï¼ä½å¯ä»¥æ¥æ¶ä¸ä¸ª Comparator ä½ä¸ºæé åæ°ï¼ä»èæ¥èªå®ä¹åç´ ä¼åçº§çååã\n\n> äºåå ï¼binary heapï¼æ¯ä¸ç§åºäºå®å¨äºåæ çæ°æ®ç»æï¼å®æ»¡è¶³å¦ä¸ä¸¤ä¸ªæ§è´¨ï¼\n> \n>  1. ç¶èç¹çé®å¼æ»æ¯å¤§äºæç­äºï¼å°äºæç­äºï¼ä»»ä½ä¸ä¸ªå­èç¹çé®å¼ã\n>  2. æ¯ä¸ªèç¹çå·¦å­æ åå³å­æ é½æ¯ä¸ä¸ªäºåå ï¼ç§°ä¸ºå çæ§è´¨ï¼ã æ ¹æ®æ§è´¨1ï¼æä»¬å¯ä»¥å°äºåå ååä¸ºä¸¤ç§ç±»åï¼æå¤§å åæå°å ã\n> \n>  * å¨æå¤§å ä¸­ï¼ç¶èç¹çé®å¼æ»æ¯å¤§äºæç­äºä»»ä½ä¸ä¸ªå­èç¹çé®å¼ã\n>  * å¨æå°å ä¸­ï¼ç¶èç¹çé®å¼æ»æ¯å°äºæç­äºä»»ä½ä¸ä¸ªå­èç¹çé®å¼ã\n> \n> PriorityQueue å¨é¢è¯ä¸­å¯è½æ´å¤çä¼åºç°å¨ææç®æ³çæ¶åï¼å¸åä¾é¢åæ¬å æåºãæ±ç¬¬Kå¤§çæ°ãå¸¦æå¾çéåç­ï¼æä»¥éè¦ä¼çç»ä½¿ç¨æè¡ã",normalizedContent:"# queue éåè¯¦è§£\n\n\n# queue ä¸ deque çåºå«\n\nqueue æ¯åç«¯éåï¼åªè½ä»ä¸ç«¯æå¥åç´ ï¼å¦ä¸ç«¯å é¤åç´ ï¼å®ç°ä¸ä¸è¬éµå¾ª åè¿ååºï¼fifoï¼ è§åã\n\nqueue æ©å±äº collection çæ¥å£ï¼æ ¹æ® å ä¸ºå®¹éé®é¢èå¯¼è´æä½å¤±è´¥åå¤çæ¹å¼çä¸å å¯ä»¥åä¸ºä¸¤ç±»æ¹æ³: ä¸ç§å¨æä½å¤±è´¥åä¼æåºå¼å¸¸ï¼å¦ä¸ç§åä¼è¿åç¹æ®å¼ã\n\nqueue æ¥å£   æåºå¼å¸¸        è¿åç¹æ®å¼\næå¥éå°¾       add(e e)    offer(e e)\nå é¤éé¦       remove()    poll()\næ¥è¯¢éé¦åç´      element()   peek()\n\ndeque æ¯åç«¯éåï¼å¨éåçä¸¤ç«¯åå¯ä»¥æå¥æå é¤åç´ ã\n\ndeque æ©å±äº queue çæ¥å£, å¢å äºå¨éé¦åéå°¾è¿è¡æå¥åå é¤çæ¹æ³ï¼åæ ·æ ¹æ®å¤±è´¥åå¤çæ¹å¼çä¸ååä¸ºä¸¤ç±»ï¼\n\ndeque æ¥å£   æåºå¼å¸¸            è¿åç¹æ®å¼\næå¥éé¦       addfirst(e e)   offerfirst(e e)\næå¥éå°¾       addlast(e e)    offerlast(e e)\nå é¤éé¦       removefirst()   pollfirst()\nå é¤éå°¾       removelast()    polllast()\næ¥è¯¢éé¦åç´      getfirst()      peekfirst()\næ¥è¯¢éå°¾åç´      getlast()       peeklast()\n\näºå®ä¸ï¼deque è¿æä¾æ push() å pop() ç­å¶ä»æ¹æ³ï¼å¯ç¨äºæ¨¡ææ ã\n\n\n# arraydeque ä¸ linkedlist çåºå«\n\narraydeque å linkedlist é½å®ç°äº deque æ¥å£ï¼ä¸¤èé½å·æéåçåè½ï¼ä½ä¸¤èæä»ä¹åºå«å¢ï¼\n\n * arraydeque æ¯åºäºå¯åé¿çæ°ç»ååæéæ¥å®ç°ï¼è linkedlist åéè¿é¾è¡¨æ¥å®ç°ã\n * arraydeque ä¸æ¯æå­å¨ null æ°æ®ï¼ä½ linkedlist æ¯æã\n * arraydeque æ¯å¨ jdk1.6 æè¢«å¼å¥çï¼èlinkedlist æ©å¨ jdk1.2 æ¶å°±å·²ç»å­å¨ã\n * arraydeque æå¥æ¶å¯è½å­å¨æ©å®¹è¿ç¨, ä¸è¿åæåçæå¥æä½ä¾ç¶ä¸º o(1)ãè½ç¶ linkedlist ä¸éè¦æ©å®¹ï¼ä½æ¯æ¯æ¬¡æå¥æ°æ®æ¶åéè¦ç³è¯·æ°çå ç©ºé´ï¼åææ§è½ç¸æ¯æ´æ¢ã\n\n> ä»æ§è½çè§åº¦ä¸ï¼éç¨ arraydeque æ¥å®ç°éåè¦æ¯ linkedlist æ´å¥½ãæ­¤å¤ï¼arraydeque ä¹å¯ä»¥ç¨äºå®ç°æ ã\n\n\n# è¯´ä¸è¯´ priorityqueueï¼ä¼åçº§éåï¼\n\npriorityqueue æ¯å¨ jdk1.5 ä¸­è¢«å¼å¥ç, å¶ä¸ queue çåºå«å¨äºåç´ åºéé¡ºåºæ¯ä¸ä¼åçº§ç¸å³çï¼å³æ»æ¯ä¼åçº§æé«çåç´ ååºéã\n\nè¿éåä¸¾å¶ç¸å³çä¸äºè¦ç¹ï¼\n\n * priorityqueue å©ç¨äºäºåå çæ°æ®ç»ææ¥å®ç°çï¼åºå±ä½¿ç¨å¯åé¿çæ°ç»æ¥å­å¨æ°æ®\n * priorityqueue éè¿å åç´ çä¸æµ®åä¸æ²ï¼å®ç°äºå¨ o(logn) çæ¶é´å¤æåº¦åæå¥åç´ åå é¤å é¡¶åç´ ã\n * priorityqueue æ¯éçº¿ç¨å®å¨çï¼ä¸ä¸æ¯æå­å¨ null å non-comparable çå¯¹è±¡ã\n * priorityqueue é»è®¤æ¯å°é¡¶å ï¼ä½å¯ä»¥æ¥æ¶ä¸ä¸ª comparator ä½ä¸ºæé åæ°ï¼ä»èæ¥èªå®ä¹åç´ ä¼åçº§çååã\n\n> äºåå ï¼binary heapï¼æ¯ä¸ç§åºäºå®å¨äºåæ çæ°æ®ç»æï¼å®æ»¡è¶³å¦ä¸ä¸¤ä¸ªæ§è´¨ï¼\n> \n>  1. ç¶èç¹çé®å¼æ»æ¯å¤§äºæç­äºï¼å°äºæç­äºï¼ä»»ä½ä¸ä¸ªå­èç¹çé®å¼ã\n>  2. æ¯ä¸ªèç¹çå·¦å­æ åå³å­æ é½æ¯ä¸ä¸ªäºåå ï¼ç§°ä¸ºå çæ§è´¨ï¼ã æ ¹æ®æ§è´¨1ï¼æä»¬å¯ä»¥å°äºåå ååä¸ºä¸¤ç§ç±»åï¼æå¤§å åæå°å ã\n> \n>  * å¨æå¤§å ä¸­ï¼ç¶èç¹çé®å¼æ»æ¯å¤§äºæç­äºä»»ä½ä¸ä¸ªå­èç¹çé®å¼ã\n>  * å¨æå°å ä¸­ï¼ç¶èç¹çé®å¼æ»æ¯å°äºæç­äºä»»ä½ä¸ä¸ªå­èç¹çé®å¼ã\n> \n> priorityqueue å¨é¢è¯ä¸­å¯è½æ´å¤çä¼åºç°å¨ææç®æ³çæ¶åï¼å¸åä¾é¢åæ¬å æåºãæ±ç¬¬kå¤§çæ°ãå¸¦æå¾çéåç­ï¼æä»¥éè¦ä¼çç»ä½¿ç¨æè¡ã",charsets:{cjk:!0}},{title:"çº¿ç¨æ± è¯¦è§£",frontmatter:{title:"çº¿ç¨æ± è¯¦è§£",date:"2023-06-14T20:18:11.000Z",permalink:"/pages/040070/",author:{name:"éä¸æ¸é£",link:"https://msqfx.github.io"},categories:["java","å¹¶åç¯"],tags:[null],description:"è¿æ¯ä¸ç§æ¯è¾ä¼ ç»çåå»ºçº¿ç¨çæ¹å¼ãä½ å¯ä»¥åå»ºä¸ä¸ªç±»ï¼ç»§æ¿èª Thread ç±»ï¼å¹¶éå run æ¹æ³æ¥å®ä¹çº¿ç¨çæ§è¡é»è¾ã",comment:!0,meta:[{name:"image",content:"https://cmty256.github.io/imgs-blog/Java/image.6282d56i3hg0.webp"},{name:"twitter:title",content:"çº¿ç¨æ± è¯¦è§£"},{name:"twitter:description",content:"è¿æ¯ä¸ç§æ¯è¾ä¼ ç»çåå»ºçº¿ç¨çæ¹å¼ãä½ å¯ä»¥åå»ºä¸ä¸ªç±»ï¼ç»§æ¿èª Thread ç±»ï¼å¹¶éå run æ¹æ³æ¥å®ä¹çº¿ç¨çæ§è¡é»è¾ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://cmty256.github.io/imgs-blog/Java/image.6282d56i3hg0.webp"},{name:"twitter:url",content:"https://www.msqfx.cc/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/04.%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%A6%E8%A7%A3.html"},{property:"og:type",content:"article"},{property:"og:title",content:"çº¿ç¨æ± è¯¦è§£"},{property:"og:description",content:"è¿æ¯ä¸ç§æ¯è¾ä¼ ç»çåå»ºçº¿ç¨çæ¹å¼ãä½ å¯ä»¥åå»ºä¸ä¸ªç±»ï¼ç»§æ¿èª Thread ç±»ï¼å¹¶éå run æ¹æ³æ¥å®ä¹çº¿ç¨çæ§è¡é»è¾ã"},{property:"og:image",content:"https://cmty256.github.io/imgs-blog/Java/image.6282d56i3hg0.webp"},{property:"og:url",content:"https://www.msqfx.cc/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/04.%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%A6%E8%A7%A3.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-06-14T20:18:11.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"çº¿ç¨æ± è¯¦è§£"},{itemprop:"description",content:"è¿æ¯ä¸ç§æ¯è¾ä¼ ç»çåå»ºçº¿ç¨çæ¹å¼ãä½ å¯ä»¥åå»ºä¸ä¸ªç±»ï¼ç»§æ¿èª Thread ç±»ï¼å¹¶éå run æ¹æ³æ¥å®ä¹çº¿ç¨çæ§è¡é»è¾ã"},{itemprop:"image",content:"https://cmty256.github.io/imgs-blog/Java/image.6282d56i3hg0.webp"}],readingShow:"top"},regularPath:"/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/04.%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%A6%E8%A7%A3.html",relativePath:"01.java/03.å¹¶åç¯/04.çº¿ç¨æ± è¯¦è§£.md",key:"v-8cb0bf1a",path:"/pages/040070/",headers:[{level:2,title:"é¦ååé¡¾ä¸ä¸åä¸ªçº¿ç¨çåå»ºæ¹å¼",slug:"é¦ååé¡¾ä¸ä¸åä¸ªçº¿ç¨çåå»ºæ¹å¼",normalizedTitle:"é¦ååé¡¾ä¸ä¸åä¸ªçº¿ç¨çåå»ºæ¹å¼",charIndex:12},{level:3,title:"1ãç»§æ¿ Thread ç±»",slug:"_1ãç»§æ¿-thread-ç±»",normalizedTitle:"1ãç»§æ¿ thread ç±»",charIndex:32},{level:3,title:"2ãå®ç° Runnable æ¥å£",slug:"_2ãå®ç°-runnable-æ¥å£",normalizedTitle:"2ãå®ç° runnable æ¥å£",charIndex:296},{level:3,title:"3ãä½¿ç¨å¿ååé¨ç±»",slug:"_3ãä½¿ç¨å¿ååé¨ç±»",normalizedTitle:"3ãä½¿ç¨å¿ååé¨ç±»",charIndex:591},{level:3,title:"4ãä½¿ç¨ Java 8 ç Lambda è¡¨è¾¾å¼",slug:"_4ãä½¿ç¨-java-8-ç-lambda-è¡¨è¾¾å¼",normalizedTitle:"4ãä½¿ç¨ java 8 ç lambda è¡¨è¾¾å¼",charIndex:792},{level:3,title:"5ãå®ç° Callable æ¥å£",slug:"_5ãå®ç°-callable-æ¥å£",normalizedTitle:"5ãå®ç° callable æ¥å£",charIndex:949},{level:3,title:"å®ç° Runnable æ¥å£å Callable æ¥å£çåºå«ï¼",slug:"å®ç°-runnable-æ¥å£å-callable-æ¥å£çåºå«",normalizedTitle:"å®ç° runnable æ¥å£å callable æ¥å£çåºå«ï¼",charIndex:1382},{level:2,title:"ä»ä¹æ¯çº¿ç¨æ± ï¼",slug:"ä»ä¹æ¯çº¿ç¨æ± ",normalizedTitle:"ä»ä¹æ¯çº¿ç¨æ± ï¼",charIndex:1990},{level:2,title:"ä¸ºä»ä¹è¦ç¨çº¿ç¨æ± ï¼",slug:"ä¸ºä»ä¹è¦ç¨çº¿ç¨æ± ",normalizedTitle:"ä¸ºä»ä¹è¦ç¨çº¿ç¨æ± ï¼",charIndex:2073},{level:2,title:"è®²è®²çº¿ç¨æ± çå·¥ä½æµç¨",slug:"è®²è®²çº¿ç¨æ± çå·¥ä½æµç¨",normalizedTitle:"è®²è®²çº¿ç¨æ± çå·¥ä½æµç¨",charIndex:2401},{level:2,title:"çº¿ç¨æ± ä½¿ç¨å¥é¨",slug:"çº¿ç¨æ± ä½¿ç¨å¥é¨",normalizedTitle:"çº¿ç¨æ± ä½¿ç¨å¥é¨",charIndex:2910},{level:2,title:"Executor æ¡æ¶ä»ç»",slug:"executor-æ¡æ¶ä»ç»",normalizedTitle:"executor æ¡æ¶ä»ç»",charIndex:4003},{level:3,title:"æ¦è¿°",slug:"æ¦è¿°",normalizedTitle:"æ¦è¿°",charIndex:4021},{level:3,title:"ç»æ",slug:"ç»æ",normalizedTitle:"ç»æ",charIndex:4367},{level:3,title:"ä½¿ç¨æµç¨",slug:"ä½¿ç¨æµç¨",normalizedTitle:"ä½¿ç¨æµç¨",charIndex:4660},{level:2,title:"çº¿ç¨æ± åçè§£æ",slug:"çº¿ç¨æ± åçè§£æ",normalizedTitle:"çº¿ç¨æ± åçè§£æ",charIndex:6522},{level:3,title:"çº¿ç¨æ± æåªäºåæ°ï¼",slug:"çº¿ç¨æ± æåªäºåæ°",normalizedTitle:"çº¿ç¨æ± æåªäºåæ°ï¼",charIndex:6534},{level:3,title:"è®²è®²æ ¸å¿çº¿ç¨æ°åæå¤§çº¿ç¨æ°çåºå«ï¼",slug:"è®²è®²æ ¸å¿çº¿ç¨æ°åæå¤§çº¿ç¨æ°çåºå«",normalizedTitle:"è®²è®²æ ¸å¿çº¿ç¨æ°åæå¤§çº¿ç¨æ°çåºå«ï¼",charIndex:7200},{level:3,title:"è®²è®²æåªäºæç»ç­ç¥ï¼",slug:"è®²è®²æåªäºæç»ç­ç¥",normalizedTitle:"è®²è®²æåªäºæç»ç­ç¥ï¼",charIndex:7323},{level:3,title:"é»å¡éåæåªäºï¼",slug:"é»å¡éåæåªäº",normalizedTitle:"é»å¡éåæåªäºï¼",charIndex:7508},{level:3,title:"æ°çº¿ç¨æ·»å çæµç¨?",slug:"æ°çº¿ç¨æ·»å çæµç¨",normalizedTitle:"æ°çº¿ç¨æ·»å çæµç¨?",charIndex:7812},{level:3,title:"çº¿ç¨æ± çä¸¤ç§åå»ºæ¹å¼",slug:"çº¿ç¨æ± çä¸¤ç§åå»ºæ¹å¼",normalizedTitle:"çº¿ç¨æ± çä¸¤ç§åå»ºæ¹å¼",charIndex:8095},{level:4,title:"ThreadPoolExecutor",slug:"threadpoolexecutor",normalizedTitle:"threadpoolexecutor",charIndex:4553},{level:4,title:"Executors",slug:"executors",normalizedTitle:"executors",charIndex:1217},{level:3,title:"çº¿ç¨æ± æäº¤ execute å submit æä»ä¹åºå«ï¼",slug:"çº¿ç¨æ± æäº¤-execute-å-submit-æä»ä¹åºå«",normalizedTitle:"çº¿ç¨æ± æäº¤ execute å submit æä»ä¹åºå«ï¼",charIndex:9145},{level:3,title:"çº¿ç¨æ± çå³é­æ¹å¼",slug:"çº¿ç¨æ± çå³é­æ¹å¼",normalizedTitle:"çº¿ç¨æ± çå³é­æ¹å¼",charIndex:9730},{level:2,title:"å­¦ä¹ åè",slug:"å­¦ä¹ åè",normalizedTitle:"å­¦ä¹ åè",charIndex:9883}],headersStr:"é¦ååé¡¾ä¸ä¸åä¸ªçº¿ç¨çåå»ºæ¹å¼ 1ãç»§æ¿ Thread ç±» 2ãå®ç° Runnable æ¥å£ 3ãä½¿ç¨å¿ååé¨ç±» 4ãä½¿ç¨ Java 8 ç Lambda è¡¨è¾¾å¼ 5ãå®ç° Callable æ¥å£ å®ç° Runnable æ¥å£å Callable æ¥å£çåºå«ï¼ ä»ä¹æ¯çº¿ç¨æ± ï¼ ä¸ºä»ä¹è¦ç¨çº¿ç¨æ± ï¼ è®²è®²çº¿ç¨æ± çå·¥ä½æµç¨ çº¿ç¨æ± ä½¿ç¨å¥é¨ Executor æ¡æ¶ä»ç» æ¦è¿° ç»æ ä½¿ç¨æµç¨ çº¿ç¨æ± åçè§£æ çº¿ç¨æ± æåªäºåæ°ï¼ è®²è®²æ ¸å¿çº¿ç¨æ°åæå¤§çº¿ç¨æ°çåºå«ï¼ è®²è®²æåªäºæç»ç­ç¥ï¼ é»å¡éåæåªäºï¼ æ°çº¿ç¨æ·»å çæµç¨? çº¿ç¨æ± çä¸¤ç§åå»ºæ¹å¼ ThreadPoolExecutor Executors çº¿ç¨æ± æäº¤ execute å submit æä»ä¹åºå«ï¼ çº¿ç¨æ± çå³é­æ¹å¼ å­¦ä¹ åè",content:'# çº¿ç¨æ± è¯¦è§£\n\n\n# é¦ååé¡¾ä¸ä¸åä¸ªçº¿ç¨çåå»ºæ¹å¼\n\n\n# 1ãç»§æ¿ Thread ç±»\n\nè¿æ¯ä¸ç§æ¯è¾ä¼ ç»çåå»ºçº¿ç¨çæ¹å¼ãä½ å¯ä»¥åå»ºä¸ä¸ªç±»ï¼ç»§æ¿èª Thread ç±»ï¼å¹¶éå run æ¹æ³æ¥å®ä¹çº¿ç¨çæ§è¡é»è¾ã\n\nclass MyThread extends Thread {\n    @Override\n    public void run() {\n        // çº¿ç¨çæ§è¡é»è¾\n    }\n}\n\n// åå»ºå¹¶å¯å¨çº¿ç¨\nMyThread thread = new MyThread();\nthread.start();\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# 2ãå®ç° Runnable æ¥å£\n\nè¿ç§æ¹å¼æ´å¸¸ç¨ï¼å®é¿åäº Java çåç»§æ¿éå¶ï¼ä½ å¯ä»¥å®ç° Runnable æ¥å£ï¼ç¶åå°å¶å®ä¾ä½ä¸ºåæ°ä¼ éç» Thread æé å½æ°ã\n\nclass MyRunnable implements Runnable {\n    @Override\n    public void run() {\n        // çº¿ç¨çæ§è¡é»è¾\n    }\n}\n\n// åå»ºå¹¶å¯å¨çº¿ç¨\nThread thread = new Thread(new MyRunnable());\nthread.start();\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# 3ãä½¿ç¨å¿ååé¨ç±»\n\nä½ å¯ä»¥å¨åå»ºçº¿ç¨æ¶ä½¿ç¨å¿ååé¨ç±»ï¼å®ç° Runnable æ¥å£ç run æ¹æ³ã\n\nThread thread = new Thread(new Runnable() {\n    @Override\n    public void run() {\n        // çº¿ç¨çæ§è¡é»è¾\n    }\n});\nthread.start();\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# 4ãä½¿ç¨ Java 8 ç Lambda è¡¨è¾¾å¼\n\nå¦æ Runnable æ¥å£åªæä¸ä¸ªæ½è±¡æ¹æ³ï¼ä½ å¯ä»¥ä½¿ç¨ Lambda è¡¨è¾¾å¼ç®åä»£ç ã\n\nThread thread = new Thread(() -> {\n    // çº¿ç¨çæ§è¡é»è¾\n});\nthread.start();\n\n\n1\n2\n3\n4\n\n\n\n# 5ãå®ç° Callable æ¥å£\n\nCallable æ¥å£åè®¸çº¿ç¨è¿åç»æææåºå¼å¸¸ãéè¦éè¿ ExecutorService æ¥æ§è¡ã\n\nclass MyCallable implements Callable<String> {\n    @Override\n    public String call() throws Exception {\n        // çº¿ç¨çæ§è¡é»è¾\n        return "Hello from Callable";\n    }\n}\n\nExecutorService executor = Executors.newFixedThreadPool(1);\nFuture<String> future = executor.submit(new MyCallable());\nString result = future.get(); // è·åçº¿ç¨æ§è¡ç»æ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# å®ç° Runnable æ¥å£å Callable æ¥å£çåºå«ï¼\n\nJava ä¸­ç Runnable æ¥å£å Callable æ¥å£é½æ¯ç¨æ¥åå»ºå¤çº¿ç¨çæ¥å£ï¼å®ä»¬çåºå«å¦ä¸ï¼\n\n 1. æ¹æ³åä¸åã\n    \n    * Runnable æ¥å£åªæä¸ä¸ª run() æ¹æ³ï¼\n    * è Callable æ¥å£åªæä¸ä¸ª call() æ¹æ³ã\n\n 2. è¿åå¼ä¸åã\n    \n    * Runnable ç run() æ¹æ³æ²¡æè¿åå¼ï¼\n    \n    * è Callable ç call() æ¹æ³å¯ä»¥è¿åæ§è¡ç»æã\n\n 3. å¼å¸¸å¤çä¸åã\n    \n    * Runnable ç run() æ¹æ³ä¸è½æåºå¼å¸¸ï¼\n    * è Callable ç call() æ¹æ³å¯ä»¥æåºå¼å¸¸ï¼å¹¶ä¸éè¦å¨è°ç¨ Future.get() æ¹æ³æ¶è¿è¡å¼å¸¸å¤çã\n\n 4. è°ç¨æ¹å¼ä¸åã\n    \n    * Runnable æ¥å£å¯ä»¥éè¿ Thread ç±»çæé æ¹æ³æ¥åå»ºä¸ä¸ªæ°ççº¿ç¨å¹¶å¯å¨å®ï¼\n    * è Callable æ¥å£åéè¦åå© Executor æ¡æ¶æ¥æ§è¡ã\n\n 5. ç¨éä¸åã\n    \n    * Runnable æ¥å£éå¸¸ç¨äºéè¦æ§è¡ä¸äºç®åçä»»å¡çåºæ¯ï¼\n    * Callable æ¥å£éå¸¸ç¨äºéè¦è¿åç»æãæèéè¦æåºå¼å¸¸ãæèéè¦å¨æ§è¡ä»»å¡åè¿è¡ä¸äºåå§åæä½çåºæ¯ã\n\n\n# ä»ä¹æ¯çº¿ç¨æ± ï¼\n\nçº¿ç¨æ± å°±æ¯ç®¡çä¸ç³»åçº¿ç¨çèµæºæ± ã\n\nå½æä»»å¡è¦å¤çæ¶ï¼ç´æ¥ä»çº¿ç¨æ± ä¸­è·åçº¿ç¨æ¥å¤çï¼å¤çå®ä¹åçº¿ç¨å¹¶ä¸ä¼ç«å³è¢«éæ¯ï¼èæ¯ç­å¾ä¸ä¸ä¸ªä»»å¡ã\n\n\n# ä¸ºä»ä¹è¦ç¨çº¿ç¨æ± ï¼\n\nç®åæ¥è¯´ï¼æ¯å ä¸ºä½¿ç¨çº¿ç¨æ± å¯ä»¥æé«èµæºçå©ç¨çã\n\n> çº¿ç¨æ± å¯ä»¥å¸®æä»¬ç®¡ççº¿ç¨ï¼é¿åå¢å åå»ºçº¿ç¨åéæ¯çº¿ç¨çèµæºæèã\n> \n> æä»¬åä»£ç çè¿ç¨ä¸­ï¼å­¦ä¼æ± åææ³ï¼æç´æ¥ç¸å³çå°±æ¯ä½¿ç¨çº¿ç¨æ± èä¸æ¯å»newä¸ä¸ªçº¿ç¨ã\n\nä½¿ç¨çº¿ç¨æ± æä¸å¤§å¥½å¤ï¼\n\n 1. æé«ååºéåº¦ãéè¿çº¿ç¨æ± åå»ºä¸ç³»åçº¿ç¨ï¼ä½¿ç¨æ¶ç´æ¥éè¿çº¿ç¨æ± è·åï¼ä¸åéè¦æå¨åå»ºçº¿ç¨ï¼ååºéåº¦èªç¶å°±å¤§å¤§æé«äºã\n 2. éä½èµæºæ¶èãç±äºçº¿ç¨æ± è¢«æ± åç®¡çäºï¼æä»¬æ éä¸ºäºæäºåè½å»æå¨åå»ºåéæ¯çº¿ç¨ï¼èµæºæ¶èèªç¶éä½ã\n 3. æé«çº¿ç¨çå¯ç®¡çæ§ãçº¿ç¨æ¯ç¨ç¼ºèµæºï¼å¦ææ éå¶çåå»ºï¼ä¸ä»ä¼æ¶èç³»ç»èµæºï¼è¿ä¼éä½ç³»ç»çç¨³å®æ§ï¼ä½¿ç¨çº¿ç¨æ± å¯ä»¥è¿è¡ç»ä¸çåéï¼è°ä¼åçæ§ã\n\n\n# è®²è®²çº¿ç¨æ± çå·¥ä½æµç¨\n\n 1. çº¿ç¨æ± ååå»ºæ¶ï¼éé¢æ²¡æä¸ä¸ªçº¿ç¨ãä»»å¡éåæ¯ä½ä¸ºåæ°ä¼ è¿æ¥çãä¸è¿ï¼å°±ç®éåéé¢æä»»å¡ï¼çº¿ç¨æ± ä¹ä¸ä¼é©¬ä¸æ§è¡å®ä»¬ã\n 2. å½è°ç¨ execute() æ¹æ³æ·»å ä¸ä¸ªä»»å¡æ¶ï¼çº¿ç¨æ± ä¼åå¦ä¸å¤æ­ï¼\n    * å¦ææ­£å¨è¿è¡ççº¿ç¨æ°éå°äº corePoolSizeï¼é£ä¹é©¬ä¸åå»ºçº¿ç¨è¿è¡è¿ä¸ªä»»å¡ï¼\n    * å¦ææ­£å¨è¿è¡ççº¿ç¨æ°éå¤§äºæç­äº corePoolSizeï¼é£ä¹å°è¿ä¸ªä»»å¡æ¾å¥éåï¼\n    * å¦æè¿æ¶åéåæ»¡äºï¼èä¸æ­£å¨è¿è¡ççº¿ç¨æ°éå°äº maximumPoolSizeï¼é£ä¹è¿æ¯è¦åå»ºéæ ¸å¿çº¿ç¨ç«å»è¿è¡è¿ä¸ªä»»å¡ï¼\n    * å¦æéåæ»¡äºï¼èä¸æ­£å¨è¿è¡ççº¿ç¨æ°éå¤§äºæç­äº maximumPoolSizeï¼é£ä¹çº¿ç¨æ± ä¼æ ¹æ®æç»ç­ç¥æ¥å¯¹åºå¤çã\n 3. å½ä¸ä¸ªçº¿ç¨å®æä»»å¡æ¶ï¼å®ä¼ä»éåä¸­åä¸ä¸ä¸ªä»»å¡æ¥æ§è¡ã\n 4. å½ä¸ä¸ªçº¿ç¨æ äºå¯åï¼è¶è¿ä¸å®çæ¶é´ï¼keepAliveTimeï¼æ¶ï¼çº¿ç¨æ± ä¼å¤æ­ï¼å¦æå½åè¿è¡ççº¿ç¨æ°å¤§äº corePoolSizeï¼é£ä¹è¿ä¸ªçº¿ç¨å°±è¢«åæãæä»¥çº¿ç¨æ± çææä»»å¡å®æåï¼å®æç»ä¼æ¶ç¼©å° corePoolSize çå¤§å°ã\n\nå¾è§£ï¼\n\n\n\n\n# çº¿ç¨æ± ä½¿ç¨å¥é¨\n\n 1. é¦ååå»ºä¸ä¸ªå«æ 3 ä¸ªçº¿ç¨ççº¿ç¨ï¼\n 2. ç¶åæäº¤ 3 ä¸ªä»»å¡å°çº¿ç¨æ± ä¸­ï¼è®©çº¿ç¨æ± ä¸­ççº¿ç¨æ± æ§è¡ï¼\n 3. å®æåéè¿ shutdown åæ­¢çº¿ç¨æ± ï¼çº¿ç¨æ± æ¶å°éç¥åä¼å°æå¤´çä»»å¡é½æ§è¡å®ï¼åå°çº¿ç¨æ± åæ­¢ã\n\nè¿éä½¿ç¨ isTerminated å¤æ­çº¿ç¨æ± æ¯å¦å®å¨åæ­¢äºãåªæç¶æä¸º terminated æè½è¯´æçº¿ç¨æ± å³é­äºï¼ç»æå¾ªç¯ï¼éåºæ¹æ³ã\n\n @Test\n    void contextLoads() {\n        //åå»ºå«æ3ä¸ªçº¿ç¨ççº¿ç¨æ± \n        ExecutorService threadPool = Executors.newFixedThreadPool(3);\n\n        //æäº¤3ä¸ªä»»å¡å°çº¿ç¨æ± ä¸­\n        for (int i = 0; i < 3; i++) {\n            final int taskNo = i;\n            threadPool.execute(() -> {\n                logger.info("æ§è¡ä»»å¡{}", taskNo);\n            });\n        }\n\n        //å³é­çº¿ç¨æ± \n        threadPool.shutdown();\n        //å¦æçº¿ç¨æ± è¿æ²¡è¾¾å°Terminatedç¶æï¼è¯´æçº¿ç¨æ± ä¸­è¿æä»»å¡æ²¡ææ§è¡å®ï¼åç»§ç»­å¾ªç¯ç­å¾çº¿ç¨æ± æ§è¡å®ä»»å¡\n        while (!threadPool.isTerminated()) {\n\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nè¾åºç»æ\n\n2023-03-21 23:01:16.198  INFO 40176 --- [pool-4-thread-1] .j.JavaCommonMistakes100ApplicationTests : æ§è¡ä»»å¡0\n2023-03-21 23:01:16.198  INFO 40176 --- [pool-4-thread-2] .j.JavaCommonMistakes100ApplicationTests : æ§è¡ä»»å¡1\n2023-03-21 23:01:16.225  INFO 40176 --- [pool-4-thread-3] .j.JavaCommonMistakes100ApplicationTests : æ§è¡ä»»å¡2\n\n\n1\n2\n3\n\n\n\n# Executor æ¡æ¶ä»ç»\n\n\n# æ¦è¿°\n\nå¨ Java 5 ä¹åï¼éè¿ Executor æ¥å¯å¨çº¿ç¨æ¯ä½¿ç¨ Thread ç start æ¹æ³æ´å¥½ï¼é¤äºæ´æç®¡çï¼æçæ´å¥½ï¼ç¨çº¿ç¨æ± å®ç°ï¼èçº¦å¼éï¼å¤ï¼è¿æå³é®çä¸ç¹ï¼æå©äºé¿å this éé¸é®é¢ã\n\nè¿æ¯å ä¸ºçº¿ç¨æ± çæ§è¡è¿ç¨ä¼ç­å¾æé å®æååè¿è¡ä»»å¡çæ§è¡ï¼ä»èé¿åäº this éé¸é®é¢çåçã\n\nä»ä¹æ¯ this éé¸é®é¢ï¼\n\nå¨ Java ä¸­ï¼å¯¹è±¡çæé è¿ç¨å¯è½ä¼æ¶åå°å¤ä¸ªçº¿ç¨ï¼èå½ä¸ä¸ªå¯¹è±¡å°æªå®å¨æé å®æä½å·²ç»è¢«å¶ä»çº¿ç¨å¼ç¨æ¶ï¼å°±å¯è½äº§ç this éé¸é®é¢ã\n\nå·ä½æ¥è¯´ï¼å½ä¸ä¸ªå¯¹è±¡æ­£å¨æé è¿ç¨ä¸­ï¼å®çå¼ç¨å°±è¢«åå¸å°äºå¶ä»çº¿ç¨ï¼è¿æ¶å¶ä»çº¿ç¨å¯è½ä¼ä½¿ç¨è¿ä¸ªå°æªå®å¨æé çå¯¹è±¡ï¼ä»èå¯¼è´ææä¹å¤çè¡ä¸ºåéè¯¯ãè¿å¯è½ä¼å ä¸ºå¯¹è±¡çç¶æä¸ç¨³å®èå¼åçº¿ç¨å®å¨é®é¢ã\n\n\n# ç»æ\n\nExecutor æ¡æ¶ç»æä¸»è¦ç±ä¸å¤§é¨åç»æï¼\n\n 1. ä»»å¡ãåæ¬è¢«æ§è¡ä»»å¡éè¦å®ç°çæ¥å£ï¼Runnable æ¥å£æ Callable æ¥å£ã\n 2. ä»»å¡çæ§è¡ãåæ¬ä»»å¡æ§è¡æºå¶çæ ¸å¿æ¥å£ Executorï¼ä»¥åç»§æ¿èª Executor ç ExecutorService æ¥å£ãExecutor æ¡æ¶æä¸¤ä¸ªå³é®ç±»å®ç°äº ExecutorService æ¥å£ï¼ThreadPoolExecutor å ScheduleThreadPoolExecutorï¼ã\n 3. å¼æ­¥è®¡ç®çç»æãåæ¬æ¥å£ Future åå®ç° Future æ¥å£ç FutureTask ç±»ã\n\n\n# ä½¿ç¨æµç¨\n\n 1. ä¸»çº¿ç¨é¦åè¦åå»ºå®ç° Runnable æè Callable æ¥å£çä»»å¡å¯¹è±¡ã\n 2. æåå»ºå®æçå®ç° Runnable/Callable æ¥å£çãå¯¹è±¡ãç´æ¥äº¤ç» ExecutorService æ§è¡: ExecutorService.executeï¼Runnable commandï¼æèä¹å¯ä»¥æ Runnable å¯¹è±¡æCallable å¯¹è±¡æäº¤ç» ExecutorService æ§è¡ï¼ExecutorService.submitï¼Runnable taskï¼æ ExecutorService.submitï¼Callable <T> taskï¼ï¼ã\n 3. å¦ææ§è¡ ExecutorService.submitï¼â¦ï¼ï¼ExecutorService å°è¿åä¸ä¸ªå®ç°Futureæ¥å£çå¯¹è±¡ï¼æä»¬ååä¹æå°è¿äºæ§è¡ execute()æ¹æ³å submit()æ¹æ³çåºå«ï¼submit()ä¼è¿åä¸ä¸ª FutureTask å¯¹è±¡ï¼ãç±äº FutureTask å®ç°äº Runnableï¼æä»¬ä¹å¯ä»¥åå»º FutureTaskï¼ç¶åç´æ¥äº¤ç» ExecutorService æ§è¡ã\n 4. æåï¼ä¸»çº¿ç¨å¯ä»¥æ§è¡ FutureTask.get()æ¹æ³æ¥ç­å¾ä»»å¡æ§è¡å®æãä¸»çº¿ç¨ä¹å¯ä»¥æ§è¡ FutureTask.cancelï¼boolean mayInterruptIfRunningï¼æ¥åæ¶æ­¤ä»»å¡çæ§è¡ã\n\nä»£ç ç¤ºä¾ï¼\n\nimport java.util.concurrent.*;\n\npublic class ThreadPoolExample {\n    public static void main(String[] args) {\n        // åå»ºä¸ä¸ªçº¿ç¨æ± \n        ExecutorService executorService = Executors.newFixedThreadPool(2);\n\n        // åå»ºå®ç°Runnableæ¥å£çä»»å¡\n        Runnable task1 = () -> {\n            System.out.println("Task 1 is running on thread: " + Thread.currentThread().getName());\n        };\n\n        // åå»ºå®ç°Callableæ¥å£çä»»å¡\n        Callable<String> task2 = () -> {\n            System.out.println("Task 2 is running on thread: " + Thread.currentThread().getName());\n            return "Task 2 Result";\n        };\n\n        try {\n            // æ§è¡Runnableä»»å¡\n            executorService.execute(task1);\n\n            // æäº¤Callableä»»å¡ï¼å¹¶è·åFutureå¯¹è±¡\n            Future<String> future = executorService.submit(task2);\n\n            // ä¸»çº¿ç¨ç­å¾Callableä»»å¡æ§è¡å®æï¼å¹¶è·åç»æ\n            String result = future.get();\n            System.out.println("Task 2 Result: " + result);\n\n        } catch (InterruptedException | ExecutionException e) {\n            e.printStackTrace();\n        } finally {\n            // å³é­çº¿ç¨æ± \n            executorService.shutdown();\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\n\n# çº¿ç¨æ± åçè§£æ\n\n\n# çº¿ç¨æ± æåªäºåæ°ï¼\n\néè¿ Executors æ¡æ¶åå»ºççº¿ç¨æ± ï¼ä»æºç å¯ä»¥çå°ï¼å®åºå±æ¯éè¿ ThreadPoolExecutor å®æçº¿ç¨æ± çåå»ºï¼å·ä½åæ°å¦ä¸ï¼\n\n public static ExecutorService newFixedThreadPool(int nThreads) {\n        return new ThreadPoolExecutor(nThreads, nThreads,\n                                      0L, TimeUnit.MILLISECONDS,\n                                      new LinkedBlockingQueue<Runnable>());\n    }\n\n\n1\n2\n3\n4\n5\n\n\n 1. corePoolSizeï¼çº¿ç¨æ± çæ ¸å¿çº¿ç¨æ°ï¼å³çº¿ç¨æ± ä¸­å§ç»ä¿æççº¿ç¨æ°ã\n\n 2. maximumPoolSizeï¼çº¿ç¨æ± ä¸­æå¤§ççº¿ç¨æ°ï¼åæ¬æ ¸å¿çº¿ç¨æ°åéæ ¸å¿çº¿ç¨æ°ã\n\n 3. keepAliveTimeï¼éæ ¸å¿çº¿ç¨çé²ç½®æ¶é´ï¼è¶è¿è¯¥æ¶é´åå°è¢«åæ¶ã\n\n 4. unitï¼keepAliveTime éæ ¸å¿çº¿ç¨çé²ç½®æ¶é´çåä½ã\n\n 5. workQueueï¼ä»»å¡éåï¼ç¨äºå­å¨è¿æªè¢«æ§è¡çä»»å¡ã\n\n 6. threadFactoryï¼çº¿ç¨å·¥åï¼ç¨äºåå»ºçº¿ç¨ã\n\n 7. handlerï¼é¥±åç­ç¥ï¼å³å½çº¿ç¨æ± ä¸­ççº¿ç¨é½å¨æ§è¡ä»»å¡æ¶ï¼æ°çä»»å¡ä¼å¦ä½å¤çãï¼ä¹ç§°ä¸ºæç»ç­ç¥ï¼\n\n\n# è®²è®²æ ¸å¿çº¿ç¨æ°åæå¤§çº¿ç¨æ°çåºå«ï¼\n\næ ¸å¿çº¿ç¨æ°åæå¤§çº¿ç¨æ°çåºå«å¨äºï¼\n\nå¨ä»»å¡æ°è¶è¿æ ¸å¿çº¿ç¨æ°æ¶ï¼çº¿ç¨æ± ä¼ä¼ååå»ºæ ¸å¿çº¿ç¨æ¥æ§è¡ä»»å¡ï¼åªæå½ä»»å¡éåå·²æ»¡ä¸æ ¸å¿çº¿ç¨é½å¨æ§è¡ä»»å¡æ¶ï¼æä¼åå»ºéæ ¸å¿çº¿ç¨æ¥æ§è¡ä»»å¡ï¼ç´å°è¾¾å°æå¤§çº¿ç¨æ°ä¸ºæ­¢ã\n\n\n# è®²è®²æåªäºæç»ç­ç¥ï¼\n\næåç§å¸¸è§çæç»ç­ç¥ï¼\n\n 1. AbortPolicyï¼é»è®¤ï¼ï¼ç´æ¥æåºå¼å¸¸ï¼é»æ­¢ç³»ç»æ­£å¸¸è¿è¡ã\n 2. CallerRunsPolicyï¼åªç¨è°ç¨èæå¨çº¿ç¨æ¥æ§è¡ä»»å¡ã\n 3. DiscardOldestPolicyï¼ä¸¢å¼éåä¸­æèçä¸ä¸ªä»»å¡ï¼å°è¯åæ¬¡æäº¤å½åä»»å¡ã\n 4. DiscardPolicyï¼ç´æ¥ä¸¢å¼ä»»å¡ï¼ä¸åä»»ä½å¤çã\n\n\n# é»å¡éåæåªäºï¼\n\nJava ä¸­å¸¸ç¨çé»å¡éåæä»¥ä¸ 4 ç§ï¼\n\n 1. ArrayBlockingQueueï¼ä¸ä¸ªç±æ°ç»ç»æç»æçæçé»å¡éåï¼æç§åè¿ååºçååå¯¹åç´ è¿è¡æåºã\n\n 2. LinkedBlockingQueueï¼ä¸ä¸ªç±é¾è¡¨ç»æç»æçå¯éæçé»å¡éåï¼æç§åè¿ååºçååå¯¹åç´ è¿è¡æåºã\n    \n    å¦æéåå®¹éæ²¡æéå¶ï¼åä¸ºæ çé»å¡éåã\n\n 3. PriorityBlockingQueueï¼ä¸ä¸ªæ¯æä¼åçº§æåºçæ çé»å¡éåã\n\n 4. SynchronousQueueï¼ä¸ä¸ªä¸å­å¨åç´ çé»å¡éåï¼æ¯ä¸ªæå¥æä½å¿é¡»ç­å¾å¦ä¸ä¸ªçº¿ç¨çç§»é¤æä½ï¼å¦åæå¥æä½ä¸ç´å¤äºé»å¡ç¶æã\n\n\n# æ°çº¿ç¨æ·»å çæµç¨?\n\næ°çº¿ç¨çæ·»å æä»¥ä¸ 4 ä¸ªæµç¨ï¼\n\n 1. å¦æå½åçº¿ç¨æ± ä¸­ççº¿ç¨æ°å°äºæ ¸å¿çº¿ç¨æ°ï¼é£ä¹å°±åå»ºä¸ä¸ªæ°çæ ¸å¿çº¿ç¨æ¥æ§è¡è¿ä¸ªä»»å¡ï¼\n\n 2. å¦æå½åçº¿ç¨æ± ä¸­ççº¿ç¨æ°å·²ç»è¾¾å°äºæ ¸å¿çº¿ç¨æ°ï¼é£ä¹å°±å°ä»»å¡æ·»å å°ä»»å¡éåä¸­ç­å¾æ§è¡ï¼\n\n 3. å¦æä»»å¡éåå·²æ»¡ï¼ä½å½åçº¿ç¨æ± ä¸­ççº¿ç¨æ°è¿æ²¡æè¾¾å°æå¤§çº¿ç¨æ°ï¼é£ä¹å°±åå»ºä¸ä¸ªæ°çéæ ¸å¿çº¿ç¨æ¥æ§è¡è¿ä¸ªä»»å¡ï¼\n    \n    > éæ ¸å¿çº¿ç¨å¨æ§è¡å®ä»»å¡ä¹åä¼è¢«åæ¶ï¼ç´å°çº¿ç¨æ± ä¸­ççº¿ç¨æ°åéæ°éè³æ ¸å¿çº¿ç¨æ°ã\n\n 4. å¦æå½åçº¿ç¨æ± ä¸­ççº¿ç¨æ°å·²ç»è¾¾å°äºæå¤§çº¿ç¨æ°ï¼é£ä¹å°±æ ¹æ®é¥±åç­ç¥æ¥å¤çè¿ä¸ªä»»å¡ã\n\n\n# çº¿ç¨æ± çä¸¤ç§åå»ºæ¹å¼\n\n# ThreadPoolExecutor\n\næ¹å¼ä¸ï¼éè¿ ThreadPoolExecutor æé å½æ°æ¥åå»ºï¼æ¨èï¼ã\n\næä»¬å¯ä»¥åå»ºå¤ç§ç±»åç ThreadPoolExecutorï¼\n\n * FixedThreadPoolï¼è¯¥æ¹æ³è¿åä¸ä¸ªåºå®çº¿ç¨æ°éççº¿ç¨æ± ãè¯¥çº¿ç¨æ± ä¸­ççº¿ç¨æ°éå§ç»ä¸åãå½æä¸ä¸ªæ°çä»»å¡æäº¤æ¶ï¼çº¿ç¨æ± ä¸­è¥æç©ºé²çº¿ç¨ï¼åç«å³æ§è¡ãè¥æ²¡æï¼åæ°çä»»å¡ä¼è¢«æå­å¨ä¸ä¸ªä»»å¡éåä¸­ï¼å¾æçº¿ç¨ç©ºé²æ¶ï¼ä¾¿å¤çå¨ä»»å¡éåä¸­çä»»å¡ã\n * SingleThreadExecutorï¼è¯¥æ¹æ³è¿åä¸ä¸ªåªæä¸ä¸ªçº¿ç¨ççº¿ç¨æ± ãè¥å¤ä½ä¸ä¸ªä»»å¡è¢«æäº¤å°è¯¥çº¿ç¨æ± ï¼ä»»å¡ä¼è¢«ä¿å­å¨ä¸ä¸ªä»»å¡éåä¸­ï¼å¾çº¿ç¨ç©ºé²ï¼æåå¥ååºçé¡ºåºæ§è¡éåä¸­çä»»å¡ã\n * CachedThreadPoolï¼ è¯¥æ¹æ³è¿åä¸ä¸ªå¯æ ¹æ®å®éæåµè°æ´çº¿ç¨æ°éççº¿ç¨æ± ãçº¿ç¨æ± ççº¿ç¨æ°éä¸ç¡®å®ï¼ä½è¥æç©ºé²çº¿ç¨å¯ä»¥å¤ç¨ï¼åä¼ä¼åä½¿ç¨å¯å¤ç¨ççº¿ç¨ãè¥ææçº¿ç¨åå¨å·¥ä½ï¼åææ°çä»»å¡æäº¤ï¼åä¼åå»ºæ°ççº¿ç¨å¤çä»»å¡ãææçº¿ç¨å¨å½åä»»å¡æ§è¡å®æ¯åï¼å°è¿åçº¿ç¨æ± è¿è¡å¤ç¨ã\n * ScheduledThreadPoolï¼è¯¥è¿åä¸ä¸ªç¨æ¥å¨ç»å®çå»¶è¿åè¿è¡ä»»å¡æèå®ææ§è¡ä»»å¡ççº¿ç¨æ± ã\n\n# Executors\n\næ¹å¼äºï¼éè¿ Executor æ¡æ¶çå·¥å·ç±» Executors æ¥åå»ºã\n\nExecutors è¿åçº¿ç¨æ± å¯¹è±¡çå¼ç«¯å¦ä¸ï¼\n\n * FixedThreadPool å SingleThreadExecutorï¼ä½¿ç¨çæ¯æ çç LinkedBlockingQueueï¼ä»»å¡éåæå¤§é¿åº¦ä¸º Integer.MAX_VALUE,å¯è½å ç§¯å¤§éçè¯·æ±ï¼ä»èå¯¼è´ OOMã\n\n * CachedThreadPoolï¼ä½¿ç¨çæ¯åæ­¥éå SynchronousQueue, åè®¸åå»ºççº¿ç¨æ°éä¸º Integer.MAX_VALUE ï¼å¯è½ä¼åå»ºå¤§éçº¿ç¨ï¼ä»èå¯¼è´ OOMã\n\n * ScheduledThreadPool å SingleThreadScheduledExecutor : ä½¿ç¨çæ ççå»¶è¿é»å¡éå DelayedWorkQueueï¼ä»»å¡éåæå¤§é¿åº¦ä¸º Integer.MAX_VALUE, å¯è½å ç§¯å¤§éçè¯·æ±ï¼ä»èå¯¼è´ OOMã\n   \n   > OOMï¼Out of Memoryï¼æ¯æåå­æº¢åºï¼å³ç¨åºå¨è¿è¡è¿ç¨ä¸­ç³è¯·çåå­è¶è¿äºJVMæè½æä¾çæå¤§åå­éå¶ï¼å¯¼è´æ æ³ç»§ç»­åéåå­ï¼ä»èæåºåå­æº¢åºå¼å¸¸ã\n\n\n# çº¿ç¨æ± æäº¤ execute å submit æä»ä¹åºå«ï¼\n\n 1. execute ç¨äºæäº¤ä¸éè¦è¿åå¼çä»»å¡\n\nthreadsPool.execute(new Runnable() { \n    @Override public void run() { \n        // TODO Auto-generated method stub } \n    });\n\n\n1\n2\n3\n4\n\n\n 2. submit() æ¹æ³ç¨äºæäº¤éè¦è¿åå¼çä»»å¡\n    \n    çº¿ç¨æ± ä¼è¿åä¸ä¸ª future ç±»åçå¯¹è±¡ï¼éè¿è¿ä¸ª future å¯¹è±¡å¯ä»¥å¤æ­ä»»å¡æ¯å¦æ§è¡æåï¼å¹¶ä¸å¯ä»¥éè¿ future ç get() æ¹æ³æ¥è·åè¿åå¼ã\n\nFuture<Object> future = executor.submit(harReturnValuetask); \ntry { Object s = future.get(); } catch (InterruptedException e) { \n    // å¤çä¸­æ­å¼å¸¸ \n} catch (ExecutionException e) { \n    // å¤çæ æ³æ§è¡ä»»å¡å¼å¸¸ \n} finally { \n    // å³é­çº¿ç¨æ±  executor.shutdown();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# çº¿ç¨æ± çå³é­æ¹å¼\n\nçº¿ç¨æ± çåæ­¢æ¹å¼æä¸¤ç§:\n\n 1. shutdown: ä½¿ç¨è¿ä¸ªæ¹æ³ä¹åï¼æä»¬æ æ³æäº¤æ°çä»»å¡è¿æ¥ï¼çº¿ç¨æ± ä¼ç»§ç»­å·¥ä½ï¼å°æå¤´çä»»å¡æ§è¡å®ååæ­¢ã\n 2. shutdownNow: è¿ç§åæ­¢æ¹å¼æ¯è¾ç²æ´ï¼çº¿ç¨æ± ä¼ç´æ¥å°æå¤´çä»»å¡é½å¼ºè¡åæ­¢ï¼ä¸ä¸æ¥åæ°ä»»å¡è¿æ¥ï¼çº¿ç¨åæ­¢ç«å³çæã\n\n\n# å­¦ä¹ åè\n\n * Java çº¿ç¨æ± è¯¦è§£ | JavaGuide)\n * Javaçº¿ç¨æ± è¯¦è§£ | Shark Chili\n * é¢æ¸£éè¢­-Javaå¹¶åç¼ç¨\n * Executoræ¡æ¶è¯¦è§£\n * å®ææ»ç»ï¼18ç§æ¥å£ä¼åæ¹æ¡çæ»ç»',normalizedContent:'# çº¿ç¨æ± è¯¦è§£\n\n\n# é¦ååé¡¾ä¸ä¸åä¸ªçº¿ç¨çåå»ºæ¹å¼\n\n\n# 1ãç»§æ¿ thread ç±»\n\nè¿æ¯ä¸ç§æ¯è¾ä¼ ç»çåå»ºçº¿ç¨çæ¹å¼ãä½ å¯ä»¥åå»ºä¸ä¸ªç±»ï¼ç»§æ¿èª thread ç±»ï¼å¹¶éå run æ¹æ³æ¥å®ä¹çº¿ç¨çæ§è¡é»è¾ã\n\nclass mythread extends thread {\n    @override\n    public void run() {\n        // çº¿ç¨çæ§è¡é»è¾\n    }\n}\n\n// åå»ºå¹¶å¯å¨çº¿ç¨\nmythread thread = new mythread();\nthread.start();\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# 2ãå®ç° runnable æ¥å£\n\nè¿ç§æ¹å¼æ´å¸¸ç¨ï¼å®é¿åäº java çåç»§æ¿éå¶ï¼ä½ å¯ä»¥å®ç° runnable æ¥å£ï¼ç¶åå°å¶å®ä¾ä½ä¸ºåæ°ä¼ éç» thread æé å½æ°ã\n\nclass myrunnable implements runnable {\n    @override\n    public void run() {\n        // çº¿ç¨çæ§è¡é»è¾\n    }\n}\n\n// åå»ºå¹¶å¯å¨çº¿ç¨\nthread thread = new thread(new myrunnable());\nthread.start();\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# 3ãä½¿ç¨å¿ååé¨ç±»\n\nä½ å¯ä»¥å¨åå»ºçº¿ç¨æ¶ä½¿ç¨å¿ååé¨ç±»ï¼å®ç° runnable æ¥å£ç run æ¹æ³ã\n\nthread thread = new thread(new runnable() {\n    @override\n    public void run() {\n        // çº¿ç¨çæ§è¡é»è¾\n    }\n});\nthread.start();\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# 4ãä½¿ç¨ java 8 ç lambda è¡¨è¾¾å¼\n\nå¦æ runnable æ¥å£åªæä¸ä¸ªæ½è±¡æ¹æ³ï¼ä½ å¯ä»¥ä½¿ç¨ lambda è¡¨è¾¾å¼ç®åä»£ç ã\n\nthread thread = new thread(() -> {\n    // çº¿ç¨çæ§è¡é»è¾\n});\nthread.start();\n\n\n1\n2\n3\n4\n\n\n\n# 5ãå®ç° callable æ¥å£\n\ncallable æ¥å£åè®¸çº¿ç¨è¿åç»æææåºå¼å¸¸ãéè¦éè¿ executorservice æ¥æ§è¡ã\n\nclass mycallable implements callable<string> {\n    @override\n    public string call() throws exception {\n        // çº¿ç¨çæ§è¡é»è¾\n        return "hello from callable";\n    }\n}\n\nexecutorservice executor = executors.newfixedthreadpool(1);\nfuture<string> future = executor.submit(new mycallable());\nstring result = future.get(); // è·åçº¿ç¨æ§è¡ç»æ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# å®ç° runnable æ¥å£å callable æ¥å£çåºå«ï¼\n\njava ä¸­ç runnable æ¥å£å callable æ¥å£é½æ¯ç¨æ¥åå»ºå¤çº¿ç¨çæ¥å£ï¼å®ä»¬çåºå«å¦ä¸ï¼\n\n 1. æ¹æ³åä¸åã\n    \n    * runnable æ¥å£åªæä¸ä¸ª run() æ¹æ³ï¼\n    * è callable æ¥å£åªæä¸ä¸ª call() æ¹æ³ã\n\n 2. è¿åå¼ä¸åã\n    \n    * runnable ç run() æ¹æ³æ²¡æè¿åå¼ï¼\n    \n    * è callable ç call() æ¹æ³å¯ä»¥è¿åæ§è¡ç»æã\n\n 3. å¼å¸¸å¤çä¸åã\n    \n    * runnable ç run() æ¹æ³ä¸è½æåºå¼å¸¸ï¼\n    * è callable ç call() æ¹æ³å¯ä»¥æåºå¼å¸¸ï¼å¹¶ä¸éè¦å¨è°ç¨ future.get() æ¹æ³æ¶è¿è¡å¼å¸¸å¤çã\n\n 4. è°ç¨æ¹å¼ä¸åã\n    \n    * runnable æ¥å£å¯ä»¥éè¿ thread ç±»çæé æ¹æ³æ¥åå»ºä¸ä¸ªæ°ççº¿ç¨å¹¶å¯å¨å®ï¼\n    * è callable æ¥å£åéè¦åå© executor æ¡æ¶æ¥æ§è¡ã\n\n 5. ç¨éä¸åã\n    \n    * runnable æ¥å£éå¸¸ç¨äºéè¦æ§è¡ä¸äºç®åçä»»å¡çåºæ¯ï¼\n    * callable æ¥å£éå¸¸ç¨äºéè¦è¿åç»æãæèéè¦æåºå¼å¸¸ãæèéè¦å¨æ§è¡ä»»å¡åè¿è¡ä¸äºåå§åæä½çåºæ¯ã\n\n\n# ä»ä¹æ¯çº¿ç¨æ± ï¼\n\nçº¿ç¨æ± å°±æ¯ç®¡çä¸ç³»åçº¿ç¨çèµæºæ± ã\n\nå½æä»»å¡è¦å¤çæ¶ï¼ç´æ¥ä»çº¿ç¨æ± ä¸­è·åçº¿ç¨æ¥å¤çï¼å¤çå®ä¹åçº¿ç¨å¹¶ä¸ä¼ç«å³è¢«éæ¯ï¼èæ¯ç­å¾ä¸ä¸ä¸ªä»»å¡ã\n\n\n# ä¸ºä»ä¹è¦ç¨çº¿ç¨æ± ï¼\n\nç®åæ¥è¯´ï¼æ¯å ä¸ºä½¿ç¨çº¿ç¨æ± å¯ä»¥æé«èµæºçå©ç¨çã\n\n> çº¿ç¨æ± å¯ä»¥å¸®æä»¬ç®¡ççº¿ç¨ï¼é¿åå¢å åå»ºçº¿ç¨åéæ¯çº¿ç¨çèµæºæèã\n> \n> æä»¬åä»£ç çè¿ç¨ä¸­ï¼å­¦ä¼æ± åææ³ï¼æç´æ¥ç¸å³çå°±æ¯ä½¿ç¨çº¿ç¨æ± èä¸æ¯å»newä¸ä¸ªçº¿ç¨ã\n\nä½¿ç¨çº¿ç¨æ± æä¸å¤§å¥½å¤ï¼\n\n 1. æé«ååºéåº¦ãéè¿çº¿ç¨æ± åå»ºä¸ç³»åçº¿ç¨ï¼ä½¿ç¨æ¶ç´æ¥éè¿çº¿ç¨æ± è·åï¼ä¸åéè¦æå¨åå»ºçº¿ç¨ï¼ååºéåº¦èªç¶å°±å¤§å¤§æé«äºã\n 2. éä½èµæºæ¶èãç±äºçº¿ç¨æ± è¢«æ± åç®¡çäºï¼æä»¬æ éä¸ºäºæäºåè½å»æå¨åå»ºåéæ¯çº¿ç¨ï¼èµæºæ¶èèªç¶éä½ã\n 3. æé«çº¿ç¨çå¯ç®¡çæ§ãçº¿ç¨æ¯ç¨ç¼ºèµæºï¼å¦ææ éå¶çåå»ºï¼ä¸ä»ä¼æ¶èç³»ç»èµæºï¼è¿ä¼éä½ç³»ç»çç¨³å®æ§ï¼ä½¿ç¨çº¿ç¨æ± å¯ä»¥è¿è¡ç»ä¸çåéï¼è°ä¼åçæ§ã\n\n\n# è®²è®²çº¿ç¨æ± çå·¥ä½æµç¨\n\n 1. çº¿ç¨æ± ååå»ºæ¶ï¼éé¢æ²¡æä¸ä¸ªçº¿ç¨ãä»»å¡éåæ¯ä½ä¸ºåæ°ä¼ è¿æ¥çãä¸è¿ï¼å°±ç®éåéé¢æä»»å¡ï¼çº¿ç¨æ± ä¹ä¸ä¼é©¬ä¸æ§è¡å®ä»¬ã\n 2. å½è°ç¨ execute() æ¹æ³æ·»å ä¸ä¸ªä»»å¡æ¶ï¼çº¿ç¨æ± ä¼åå¦ä¸å¤æ­ï¼\n    * å¦ææ­£å¨è¿è¡ççº¿ç¨æ°éå°äº corepoolsizeï¼é£ä¹é©¬ä¸åå»ºçº¿ç¨è¿è¡è¿ä¸ªä»»å¡ï¼\n    * å¦ææ­£å¨è¿è¡ççº¿ç¨æ°éå¤§äºæç­äº corepoolsizeï¼é£ä¹å°è¿ä¸ªä»»å¡æ¾å¥éåï¼\n    * å¦æè¿æ¶åéåæ»¡äºï¼èä¸æ­£å¨è¿è¡ççº¿ç¨æ°éå°äº maximumpoolsizeï¼é£ä¹è¿æ¯è¦åå»ºéæ ¸å¿çº¿ç¨ç«å»è¿è¡è¿ä¸ªä»»å¡ï¼\n    * å¦æéåæ»¡äºï¼èä¸æ­£å¨è¿è¡ççº¿ç¨æ°éå¤§äºæç­äº maximumpoolsizeï¼é£ä¹çº¿ç¨æ± ä¼æ ¹æ®æç»ç­ç¥æ¥å¯¹åºå¤çã\n 3. å½ä¸ä¸ªçº¿ç¨å®æä»»å¡æ¶ï¼å®ä¼ä»éåä¸­åä¸ä¸ä¸ªä»»å¡æ¥æ§è¡ã\n 4. å½ä¸ä¸ªçº¿ç¨æ äºå¯åï¼è¶è¿ä¸å®çæ¶é´ï¼keepalivetimeï¼æ¶ï¼çº¿ç¨æ± ä¼å¤æ­ï¼å¦æå½åè¿è¡ççº¿ç¨æ°å¤§äº corepoolsizeï¼é£ä¹è¿ä¸ªçº¿ç¨å°±è¢«åæãæä»¥çº¿ç¨æ± çææä»»å¡å®æåï¼å®æç»ä¼æ¶ç¼©å° corepoolsize çå¤§å°ã\n\nå¾è§£ï¼\n\n\n\n\n# çº¿ç¨æ± ä½¿ç¨å¥é¨\n\n 1. é¦ååå»ºä¸ä¸ªå«æ 3 ä¸ªçº¿ç¨ççº¿ç¨ï¼\n 2. ç¶åæäº¤ 3 ä¸ªä»»å¡å°çº¿ç¨æ± ä¸­ï¼è®©çº¿ç¨æ± ä¸­ççº¿ç¨æ± æ§è¡ï¼\n 3. å®æåéè¿ shutdown åæ­¢çº¿ç¨æ± ï¼çº¿ç¨æ± æ¶å°éç¥åä¼å°æå¤´çä»»å¡é½æ§è¡å®ï¼åå°çº¿ç¨æ± åæ­¢ã\n\nè¿éä½¿ç¨ isterminated å¤æ­çº¿ç¨æ± æ¯å¦å®å¨åæ­¢äºãåªæç¶æä¸º terminated æè½è¯´æçº¿ç¨æ± å³é­äºï¼ç»æå¾ªç¯ï¼éåºæ¹æ³ã\n\n @test\n    void contextloads() {\n        //åå»ºå«æ3ä¸ªçº¿ç¨ççº¿ç¨æ± \n        executorservice threadpool = executors.newfixedthreadpool(3);\n\n        //æäº¤3ä¸ªä»»å¡å°çº¿ç¨æ± ä¸­\n        for (int i = 0; i < 3; i++) {\n            final int taskno = i;\n            threadpool.execute(() -> {\n                logger.info("æ§è¡ä»»å¡{}", taskno);\n            });\n        }\n\n        //å³é­çº¿ç¨æ± \n        threadpool.shutdown();\n        //å¦æçº¿ç¨æ± è¿æ²¡è¾¾å°terminatedç¶æï¼è¯´æçº¿ç¨æ± ä¸­è¿æä»»å¡æ²¡ææ§è¡å®ï¼åç»§ç»­å¾ªç¯ç­å¾çº¿ç¨æ± æ§è¡å®ä»»å¡\n        while (!threadpool.isterminated()) {\n\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nè¾åºç»æ\n\n2023-03-21 23:01:16.198  info 40176 --- [pool-4-thread-1] .j.javacommonmistakes100applicationtests : æ§è¡ä»»å¡0\n2023-03-21 23:01:16.198  info 40176 --- [pool-4-thread-2] .j.javacommonmistakes100applicationtests : æ§è¡ä»»å¡1\n2023-03-21 23:01:16.225  info 40176 --- [pool-4-thread-3] .j.javacommonmistakes100applicationtests : æ§è¡ä»»å¡2\n\n\n1\n2\n3\n\n\n\n# executor æ¡æ¶ä»ç»\n\n\n# æ¦è¿°\n\nå¨ java 5 ä¹åï¼éè¿ executor æ¥å¯å¨çº¿ç¨æ¯ä½¿ç¨ thread ç start æ¹æ³æ´å¥½ï¼é¤äºæ´æç®¡çï¼æçæ´å¥½ï¼ç¨çº¿ç¨æ± å®ç°ï¼èçº¦å¼éï¼å¤ï¼è¿æå³é®çä¸ç¹ï¼æå©äºé¿å this éé¸é®é¢ã\n\nè¿æ¯å ä¸ºçº¿ç¨æ± çæ§è¡è¿ç¨ä¼ç­å¾æé å®æååè¿è¡ä»»å¡çæ§è¡ï¼ä»èé¿åäº this éé¸é®é¢çåçã\n\nä»ä¹æ¯ this éé¸é®é¢ï¼\n\nå¨ java ä¸­ï¼å¯¹è±¡çæé è¿ç¨å¯è½ä¼æ¶åå°å¤ä¸ªçº¿ç¨ï¼èå½ä¸ä¸ªå¯¹è±¡å°æªå®å¨æé å®æä½å·²ç»è¢«å¶ä»çº¿ç¨å¼ç¨æ¶ï¼å°±å¯è½äº§ç this éé¸é®é¢ã\n\nå·ä½æ¥è¯´ï¼å½ä¸ä¸ªå¯¹è±¡æ­£å¨æé è¿ç¨ä¸­ï¼å®çå¼ç¨å°±è¢«åå¸å°äºå¶ä»çº¿ç¨ï¼è¿æ¶å¶ä»çº¿ç¨å¯è½ä¼ä½¿ç¨è¿ä¸ªå°æªå®å¨æé çå¯¹è±¡ï¼ä»èå¯¼è´ææä¹å¤çè¡ä¸ºåéè¯¯ãè¿å¯è½ä¼å ä¸ºå¯¹è±¡çç¶æä¸ç¨³å®èå¼åçº¿ç¨å®å¨é®é¢ã\n\n\n# ç»æ\n\nexecutor æ¡æ¶ç»æä¸»è¦ç±ä¸å¤§é¨åç»æï¼\n\n 1. ä»»å¡ãåæ¬è¢«æ§è¡ä»»å¡éè¦å®ç°çæ¥å£ï¼runnable æ¥å£æ callable æ¥å£ã\n 2. ä»»å¡çæ§è¡ãåæ¬ä»»å¡æ§è¡æºå¶çæ ¸å¿æ¥å£ executorï¼ä»¥åç»§æ¿èª executor ç executorservice æ¥å£ãexecutor æ¡æ¶æä¸¤ä¸ªå³é®ç±»å®ç°äº executorservice æ¥å£ï¼threadpoolexecutor å schedulethreadpoolexecutorï¼ã\n 3. å¼æ­¥è®¡ç®çç»æãåæ¬æ¥å£ future åå®ç° future æ¥å£ç futuretask ç±»ã\n\n\n# ä½¿ç¨æµç¨\n\n 1. ä¸»çº¿ç¨é¦åè¦åå»ºå®ç° runnable æè callable æ¥å£çä»»å¡å¯¹è±¡ã\n 2. æåå»ºå®æçå®ç° runnable/callable æ¥å£çãå¯¹è±¡ãç´æ¥äº¤ç» executorservice æ§è¡: executorservice.executeï¼runnable commandï¼æèä¹å¯ä»¥æ runnable å¯¹è±¡æcallable å¯¹è±¡æäº¤ç» executorservice æ§è¡ï¼executorservice.submitï¼runnable taskï¼æ executorservice.submitï¼callable <t> taskï¼ï¼ã\n 3. å¦ææ§è¡ executorservice.submitï¼â¦ï¼ï¼executorservice å°è¿åä¸ä¸ªå®ç°futureæ¥å£çå¯¹è±¡ï¼æä»¬ååä¹æå°è¿äºæ§è¡ execute()æ¹æ³å submit()æ¹æ³çåºå«ï¼submit()ä¼è¿åä¸ä¸ª futuretask å¯¹è±¡ï¼ãç±äº futuretask å®ç°äº runnableï¼æä»¬ä¹å¯ä»¥åå»º futuretaskï¼ç¶åç´æ¥äº¤ç» executorservice æ§è¡ã\n 4. æåï¼ä¸»çº¿ç¨å¯ä»¥æ§è¡ futuretask.get()æ¹æ³æ¥ç­å¾ä»»å¡æ§è¡å®æãä¸»çº¿ç¨ä¹å¯ä»¥æ§è¡ futuretask.cancelï¼boolean mayinterruptifrunningï¼æ¥åæ¶æ­¤ä»»å¡çæ§è¡ã\n\nä»£ç ç¤ºä¾ï¼\n\nimport java.util.concurrent.*;\n\npublic class threadpoolexample {\n    public static void main(string[] args) {\n        // åå»ºä¸ä¸ªçº¿ç¨æ± \n        executorservice executorservice = executors.newfixedthreadpool(2);\n\n        // åå»ºå®ç°runnableæ¥å£çä»»å¡\n        runnable task1 = () -> {\n            system.out.println("task 1 is running on thread: " + thread.currentthread().getname());\n        };\n\n        // åå»ºå®ç°callableæ¥å£çä»»å¡\n        callable<string> task2 = () -> {\n            system.out.println("task 2 is running on thread: " + thread.currentthread().getname());\n            return "task 2 result";\n        };\n\n        try {\n            // æ§è¡runnableä»»å¡\n            executorservice.execute(task1);\n\n            // æäº¤callableä»»å¡ï¼å¹¶è·åfutureå¯¹è±¡\n            future<string> future = executorservice.submit(task2);\n\n            // ä¸»çº¿ç¨ç­å¾callableä»»å¡æ§è¡å®æï¼å¹¶è·åç»æ\n            string result = future.get();\n            system.out.println("task 2 result: " + result);\n\n        } catch (interruptedexception | executionexception e) {\n            e.printstacktrace();\n        } finally {\n            // å³é­çº¿ç¨æ± \n            executorservice.shutdown();\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\n\n# çº¿ç¨æ± åçè§£æ\n\n\n# çº¿ç¨æ± æåªäºåæ°ï¼\n\néè¿ executors æ¡æ¶åå»ºççº¿ç¨æ± ï¼ä»æºç å¯ä»¥çå°ï¼å®åºå±æ¯éè¿ threadpoolexecutor å®æçº¿ç¨æ± çåå»ºï¼å·ä½åæ°å¦ä¸ï¼\n\n public static executorservice newfixedthreadpool(int nthreads) {\n        return new threadpoolexecutor(nthreads, nthreads,\n                                      0l, timeunit.milliseconds,\n                                      new linkedblockingqueue<runnable>());\n    }\n\n\n1\n2\n3\n4\n5\n\n\n 1. corepoolsizeï¼çº¿ç¨æ± çæ ¸å¿çº¿ç¨æ°ï¼å³çº¿ç¨æ± ä¸­å§ç»ä¿æççº¿ç¨æ°ã\n\n 2. maximumpoolsizeï¼çº¿ç¨æ± ä¸­æå¤§ççº¿ç¨æ°ï¼åæ¬æ ¸å¿çº¿ç¨æ°åéæ ¸å¿çº¿ç¨æ°ã\n\n 3. keepalivetimeï¼éæ ¸å¿çº¿ç¨çé²ç½®æ¶é´ï¼è¶è¿è¯¥æ¶é´åå°è¢«åæ¶ã\n\n 4. unitï¼keepalivetime éæ ¸å¿çº¿ç¨çé²ç½®æ¶é´çåä½ã\n\n 5. workqueueï¼ä»»å¡éåï¼ç¨äºå­å¨è¿æªè¢«æ§è¡çä»»å¡ã\n\n 6. threadfactoryï¼çº¿ç¨å·¥åï¼ç¨äºåå»ºçº¿ç¨ã\n\n 7. handlerï¼é¥±åç­ç¥ï¼å³å½çº¿ç¨æ± ä¸­ççº¿ç¨é½å¨æ§è¡ä»»å¡æ¶ï¼æ°çä»»å¡ä¼å¦ä½å¤çãï¼ä¹ç§°ä¸ºæç»ç­ç¥ï¼\n\n\n# è®²è®²æ ¸å¿çº¿ç¨æ°åæå¤§çº¿ç¨æ°çåºå«ï¼\n\næ ¸å¿çº¿ç¨æ°åæå¤§çº¿ç¨æ°çåºå«å¨äºï¼\n\nå¨ä»»å¡æ°è¶è¿æ ¸å¿çº¿ç¨æ°æ¶ï¼çº¿ç¨æ± ä¼ä¼ååå»ºæ ¸å¿çº¿ç¨æ¥æ§è¡ä»»å¡ï¼åªæå½ä»»å¡éåå·²æ»¡ä¸æ ¸å¿çº¿ç¨é½å¨æ§è¡ä»»å¡æ¶ï¼æä¼åå»ºéæ ¸å¿çº¿ç¨æ¥æ§è¡ä»»å¡ï¼ç´å°è¾¾å°æå¤§çº¿ç¨æ°ä¸ºæ­¢ã\n\n\n# è®²è®²æåªäºæç»ç­ç¥ï¼\n\næåç§å¸¸è§çæç»ç­ç¥ï¼\n\n 1. abortpolicyï¼é»è®¤ï¼ï¼ç´æ¥æåºå¼å¸¸ï¼é»æ­¢ç³»ç»æ­£å¸¸è¿è¡ã\n 2. callerrunspolicyï¼åªç¨è°ç¨èæå¨çº¿ç¨æ¥æ§è¡ä»»å¡ã\n 3. discardoldestpolicyï¼ä¸¢å¼éåä¸­æèçä¸ä¸ªä»»å¡ï¼å°è¯åæ¬¡æäº¤å½åä»»å¡ã\n 4. discardpolicyï¼ç´æ¥ä¸¢å¼ä»»å¡ï¼ä¸åä»»ä½å¤çã\n\n\n# é»å¡éåæåªäºï¼\n\njava ä¸­å¸¸ç¨çé»å¡éåæä»¥ä¸ 4 ç§ï¼\n\n 1. arrayblockingqueueï¼ä¸ä¸ªç±æ°ç»ç»æç»æçæçé»å¡éåï¼æç§åè¿ååºçååå¯¹åç´ è¿è¡æåºã\n\n 2. linkedblockingqueueï¼ä¸ä¸ªç±é¾è¡¨ç»æç»æçå¯éæçé»å¡éåï¼æç§åè¿ååºçååå¯¹åç´ è¿è¡æåºã\n    \n    å¦æéåå®¹éæ²¡æéå¶ï¼åä¸ºæ çé»å¡éåã\n\n 3. priorityblockingqueueï¼ä¸ä¸ªæ¯æä¼åçº§æåºçæ çé»å¡éåã\n\n 4. synchronousqueueï¼ä¸ä¸ªä¸å­å¨åç´ çé»å¡éåï¼æ¯ä¸ªæå¥æä½å¿é¡»ç­å¾å¦ä¸ä¸ªçº¿ç¨çç§»é¤æä½ï¼å¦åæå¥æä½ä¸ç´å¤äºé»å¡ç¶æã\n\n\n# æ°çº¿ç¨æ·»å çæµç¨?\n\næ°çº¿ç¨çæ·»å æä»¥ä¸ 4 ä¸ªæµç¨ï¼\n\n 1. å¦æå½åçº¿ç¨æ± ä¸­ççº¿ç¨æ°å°äºæ ¸å¿çº¿ç¨æ°ï¼é£ä¹å°±åå»ºä¸ä¸ªæ°çæ ¸å¿çº¿ç¨æ¥æ§è¡è¿ä¸ªä»»å¡ï¼\n\n 2. å¦æå½åçº¿ç¨æ± ä¸­ççº¿ç¨æ°å·²ç»è¾¾å°äºæ ¸å¿çº¿ç¨æ°ï¼é£ä¹å°±å°ä»»å¡æ·»å å°ä»»å¡éåä¸­ç­å¾æ§è¡ï¼\n\n 3. å¦æä»»å¡éåå·²æ»¡ï¼ä½å½åçº¿ç¨æ± ä¸­ççº¿ç¨æ°è¿æ²¡æè¾¾å°æå¤§çº¿ç¨æ°ï¼é£ä¹å°±åå»ºä¸ä¸ªæ°çéæ ¸å¿çº¿ç¨æ¥æ§è¡è¿ä¸ªä»»å¡ï¼\n    \n    > éæ ¸å¿çº¿ç¨å¨æ§è¡å®ä»»å¡ä¹åä¼è¢«åæ¶ï¼ç´å°çº¿ç¨æ± ä¸­ççº¿ç¨æ°åéæ°éè³æ ¸å¿çº¿ç¨æ°ã\n\n 4. å¦æå½åçº¿ç¨æ± ä¸­ççº¿ç¨æ°å·²ç»è¾¾å°äºæå¤§çº¿ç¨æ°ï¼é£ä¹å°±æ ¹æ®é¥±åç­ç¥æ¥å¤çè¿ä¸ªä»»å¡ã\n\n\n# çº¿ç¨æ± çä¸¤ç§åå»ºæ¹å¼\n\n# threadpoolexecutor\n\næ¹å¼ä¸ï¼éè¿ threadpoolexecutor æé å½æ°æ¥åå»ºï¼æ¨èï¼ã\n\næä»¬å¯ä»¥åå»ºå¤ç§ç±»åç threadpoolexecutorï¼\n\n * fixedthreadpoolï¼è¯¥æ¹æ³è¿åä¸ä¸ªåºå®çº¿ç¨æ°éççº¿ç¨æ± ãè¯¥çº¿ç¨æ± ä¸­ççº¿ç¨æ°éå§ç»ä¸åãå½æä¸ä¸ªæ°çä»»å¡æäº¤æ¶ï¼çº¿ç¨æ± ä¸­è¥æç©ºé²çº¿ç¨ï¼åç«å³æ§è¡ãè¥æ²¡æï¼åæ°çä»»å¡ä¼è¢«æå­å¨ä¸ä¸ªä»»å¡éåä¸­ï¼å¾æçº¿ç¨ç©ºé²æ¶ï¼ä¾¿å¤çå¨ä»»å¡éåä¸­çä»»å¡ã\n * singlethreadexecutorï¼è¯¥æ¹æ³è¿åä¸ä¸ªåªæä¸ä¸ªçº¿ç¨ççº¿ç¨æ± ãè¥å¤ä½ä¸ä¸ªä»»å¡è¢«æäº¤å°è¯¥çº¿ç¨æ± ï¼ä»»å¡ä¼è¢«ä¿å­å¨ä¸ä¸ªä»»å¡éåä¸­ï¼å¾çº¿ç¨ç©ºé²ï¼æåå¥ååºçé¡ºåºæ§è¡éåä¸­çä»»å¡ã\n * cachedthreadpoolï¼ è¯¥æ¹æ³è¿åä¸ä¸ªå¯æ ¹æ®å®éæåµè°æ´çº¿ç¨æ°éççº¿ç¨æ± ãçº¿ç¨æ± ççº¿ç¨æ°éä¸ç¡®å®ï¼ä½è¥æç©ºé²çº¿ç¨å¯ä»¥å¤ç¨ï¼åä¼ä¼åä½¿ç¨å¯å¤ç¨ççº¿ç¨ãè¥ææçº¿ç¨åå¨å·¥ä½ï¼åææ°çä»»å¡æäº¤ï¼åä¼åå»ºæ°ççº¿ç¨å¤çä»»å¡ãææçº¿ç¨å¨å½åä»»å¡æ§è¡å®æ¯åï¼å°è¿åçº¿ç¨æ± è¿è¡å¤ç¨ã\n * scheduledthreadpoolï¼è¯¥è¿åä¸ä¸ªç¨æ¥å¨ç»å®çå»¶è¿åè¿è¡ä»»å¡æèå®ææ§è¡ä»»å¡ççº¿ç¨æ± ã\n\n# executors\n\næ¹å¼äºï¼éè¿ executor æ¡æ¶çå·¥å·ç±» executors æ¥åå»ºã\n\nexecutors è¿åçº¿ç¨æ± å¯¹è±¡çå¼ç«¯å¦ä¸ï¼\n\n * fixedthreadpool å singlethreadexecutorï¼ä½¿ç¨çæ¯æ çç linkedblockingqueueï¼ä»»å¡éåæå¤§é¿åº¦ä¸º integer.max_value,å¯è½å ç§¯å¤§éçè¯·æ±ï¼ä»èå¯¼è´ oomã\n\n * cachedthreadpoolï¼ä½¿ç¨çæ¯åæ­¥éå synchronousqueue, åè®¸åå»ºççº¿ç¨æ°éä¸º integer.max_value ï¼å¯è½ä¼åå»ºå¤§éçº¿ç¨ï¼ä»èå¯¼è´ oomã\n\n * scheduledthreadpool å singlethreadscheduledexecutor : ä½¿ç¨çæ ççå»¶è¿é»å¡éå delayedworkqueueï¼ä»»å¡éåæå¤§é¿åº¦ä¸º integer.max_value, å¯è½å ç§¯å¤§éçè¯·æ±ï¼ä»èå¯¼è´ oomã\n   \n   > oomï¼out of memoryï¼æ¯æåå­æº¢åºï¼å³ç¨åºå¨è¿è¡è¿ç¨ä¸­ç³è¯·çåå­è¶è¿äºjvmæè½æä¾çæå¤§åå­éå¶ï¼å¯¼è´æ æ³ç»§ç»­åéåå­ï¼ä»èæåºåå­æº¢åºå¼å¸¸ã\n\n\n# çº¿ç¨æ± æäº¤ execute å submit æä»ä¹åºå«ï¼\n\n 1. execute ç¨äºæäº¤ä¸éè¦è¿åå¼çä»»å¡\n\nthreadspool.execute(new runnable() { \n    @override public void run() { \n        // todo auto-generated method stub } \n    });\n\n\n1\n2\n3\n4\n\n\n 2. submit() æ¹æ³ç¨äºæäº¤éè¦è¿åå¼çä»»å¡\n    \n    çº¿ç¨æ± ä¼è¿åä¸ä¸ª future ç±»åçå¯¹è±¡ï¼éè¿è¿ä¸ª future å¯¹è±¡å¯ä»¥å¤æ­ä»»å¡æ¯å¦æ§è¡æåï¼å¹¶ä¸å¯ä»¥éè¿ future ç get() æ¹æ³æ¥è·åè¿åå¼ã\n\nfuture<object> future = executor.submit(harreturnvaluetask); \ntry { object s = future.get(); } catch (interruptedexception e) { \n    // å¤çä¸­æ­å¼å¸¸ \n} catch (executionexception e) { \n    // å¤çæ æ³æ§è¡ä»»å¡å¼å¸¸ \n} finally { \n    // å³é­çº¿ç¨æ±  executor.shutdown();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# çº¿ç¨æ± çå³é­æ¹å¼\n\nçº¿ç¨æ± çåæ­¢æ¹å¼æä¸¤ç§:\n\n 1. shutdown: ä½¿ç¨è¿ä¸ªæ¹æ³ä¹åï¼æä»¬æ æ³æäº¤æ°çä»»å¡è¿æ¥ï¼çº¿ç¨æ± ä¼ç»§ç»­å·¥ä½ï¼å°æå¤´çä»»å¡æ§è¡å®ååæ­¢ã\n 2. shutdownnow: è¿ç§åæ­¢æ¹å¼æ¯è¾ç²æ´ï¼çº¿ç¨æ± ä¼ç´æ¥å°æå¤´çä»»å¡é½å¼ºè¡åæ­¢ï¼ä¸ä¸æ¥åæ°ä»»å¡è¿æ¥ï¼çº¿ç¨åæ­¢ç«å³çæã\n\n\n# å­¦ä¹ åè\n\n * java çº¿ç¨æ± è¯¦è§£ | javaguide)\n * javaçº¿ç¨æ± è¯¦è§£ | shark chili\n * é¢æ¸£éè¢­-javaå¹¶åç¼ç¨\n * executoræ¡æ¶è¯¦è§£\n * å®ææ»ç»ï¼18ç§æ¥å£ä¼åæ¹æ¡çæ»ç»',charsets:{cjk:!0}},{title:"JVMå¸¸é®",frontmatter:{title:"JVMå¸¸é®",date:"2023-08-29T21:24:27.000Z",permalink:"/pages/ff3623/",author:{name:"éä¸æ¸é£",link:"https://msqfx.github.io"},categories:["java","JVM"],tags:[null],description:"ç­æ¡ï¼ Javaèææºï¼JVMï¼æ¯Javaç¼ç¨è¯­è¨çè¿è¡æ¶ç¯å¢ï¼å®è´è´£å°Javaæºä»£ç ç¼è¯ä¸ºå­èç å¹¶æ§è¡ãå®æä¾äºåå­ç®¡çãåå¾åæ¶ãç±»å è½½ãå³æ¶ç¼è¯ç­åè½ã",comment:!0,meta:[{name:"twitter:title",content:"JVMå¸¸é®"},{name:"twitter:description",content:"ç­æ¡ï¼ Javaèææºï¼JVMï¼æ¯Javaç¼ç¨è¯­è¨çè¿è¡æ¶ç¯å¢ï¼å®è´è´£å°Javaæºä»£ç ç¼è¯ä¸ºå­èç å¹¶æ§è¡ãå®æä¾äºåå­ç®¡çãåå¾åæ¶ãç±»å è½½ãå³æ¶ç¼è¯ç­åè½ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/01.java/04.JVM/02.JVM%E5%B8%B8%E9%97%AE.html"},{property:"og:type",content:"article"},{property:"og:title",content:"JVMå¸¸é®"},{property:"og:description",content:"ç­æ¡ï¼ Javaèææºï¼JVMï¼æ¯Javaç¼ç¨è¯­è¨çè¿è¡æ¶ç¯å¢ï¼å®è´è´£å°Javaæºä»£ç ç¼è¯ä¸ºå­èç å¹¶æ§è¡ãå®æä¾äºåå­ç®¡çãåå¾åæ¶ãç±»å è½½ãå³æ¶ç¼è¯ç­åè½ã"},{property:"og:url",content:"https://www.msqfx.cc/01.java/04.JVM/02.JVM%E5%B8%B8%E9%97%AE.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-08-29T21:24:27.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"JVMå¸¸é®"},{itemprop:"description",content:"ç­æ¡ï¼ Javaèææºï¼JVMï¼æ¯Javaç¼ç¨è¯­è¨çè¿è¡æ¶ç¯å¢ï¼å®è´è´£å°Javaæºä»£ç ç¼è¯ä¸ºå­èç å¹¶æ§è¡ãå®æä¾äºåå­ç®¡çãåå¾åæ¶ãç±»å è½½ãå³æ¶ç¼è¯ç­åè½ã"}],readingShow:"top"},regularPath:"/01.java/04.JVM/02.JVM%E5%B8%B8%E9%97%AE.html",relativePath:"01.java/04.JVM/02.JVMå¸¸é®.md",key:"v-4d95c10a",path:"/pages/ff3623/",headers:[{level:2,title:"é®é¢ 1ï¼ä»ä¹æ¯JVMï¼",slug:"é®é¢-1-ä»ä¹æ¯jvm",normalizedTitle:"é®é¢ 1ï¼ä»ä¹æ¯jvmï¼",charIndex:13},{level:2,title:"é®é¢ 2ï¼JVMçä¸»è¦ç»æé¨åæåªäºï¼",slug:"é®é¢-2-jvmçä¸»è¦ç»æé¨åæåªäº",normalizedTitle:"é®é¢ 2ï¼jvmçä¸»è¦ç»æé¨åæåªäºï¼",charIndex:111},{level:2,title:"é®é¢ 3ï¼JVMçåå­æ¨¡åæ¯ä»ä¹ï¼",slug:"é®é¢-3-jvmçåå­æ¨¡åæ¯ä»ä¹",normalizedTitle:"é®é¢ 3ï¼jvmçåå­æ¨¡åæ¯ä»ä¹ï¼",charIndex:224},{level:2,title:"é®é¢ 4ï¼ä»ä¹æ¯Javaå ï¼å®çä½ç¨æ¯ä»ä¹ï¼",slug:"é®é¢-4-ä»ä¹æ¯javaå -å®çä½ç¨æ¯ä»ä¹",normalizedTitle:"é®é¢ 4ï¼ä»ä¹æ¯javaå ï¼å®çä½ç¨æ¯ä»ä¹ï¼",charIndex:364},{level:2,title:"é®é¢ 5ï¼Javaå ä¸­çæ°¸ä¹ä»£ï¼PermGenï¼å·²è¢«åºå¼ï¼åèä»£ä¹çæ¯ä»ä¹ï¼",slug:"é®é¢-5-javaå ä¸­çæ°¸ä¹ä»£-permgen-å·²è¢«åºå¼-åèä»£ä¹çæ¯ä»ä¹",normalizedTitle:"é®é¢ 5ï¼javaå ä¸­çæ°¸ä¹ä»£ï¼permgenï¼å·²è¢«åºå¼ï¼åèä»£ä¹çæ¯ä»ä¹ï¼",charIndex:584},{level:2,title:"é®é¢ 6ï¼ä»ä¹æ¯åå¾åæ¶ï¼Garbage Collectionï¼ï¼å®çç®çæ¯ä»ä¹ï¼",slug:"é®é¢-6-ä»ä¹æ¯åå¾åæ¶-garbage-collection-å®çç®çæ¯ä»ä¹",normalizedTitle:"é®é¢ 6ï¼ä»ä¹æ¯åå¾åæ¶ï¼garbage collectionï¼ï¼å®çç®çæ¯ä»ä¹ï¼",charIndex:706},{level:2,title:"é®é¢ 7ï¼è°è°åå¾åæ¶ç®æ³çç±»åååçã",slug:"é®é¢-7-è°è°åå¾åæ¶ç®æ³çç±»åååçã",normalizedTitle:"é®é¢ 7ï¼è°è°åå¾åæ¶ç®æ³çç±»åååçã",charIndex:819},{level:2,title:"é®é¢ 8ï¼ä»ä¹æ¯Javaåå­æº¢åºï¼OutOfMemoryErrorï¼ï¼æä¹é¿åï¼",slug:"é®é¢-8-ä»ä¹æ¯javaåå­æº¢åº-outofmemoryerror-æä¹é¿å",normalizedTitle:"é®é¢ 8ï¼ä»ä¹æ¯javaåå­æº¢åºï¼outofmemoryerrorï¼ï¼æä¹é¿åï¼",charIndex:993},{level:2,title:"é®é¢ 9ï¼ä»ä¹æ¯Javaåå­æ³æ¼ï¼å¦ä½é¿åï¼",slug:"é®é¢-9-ä»ä¹æ¯javaåå­æ³æ¼-å¦ä½é¿å",normalizedTitle:"é®é¢ 9ï¼ä»ä¹æ¯javaåå­æ³æ¼ï¼å¦ä½é¿åï¼",charIndex:1119},{level:2,title:"é®é¢ 10ï¼ä»ä¹æ¯ç±»å è½½å¨ï¼Class Loaderï¼ï¼æåªäºç±»å è½½å¨ï¼",slug:"é®é¢-10-ä»ä¹æ¯ç±»å è½½å¨-class-loader-æåªäºç±»å è½½å¨",normalizedTitle:"é®é¢ 10ï¼ä»ä¹æ¯ç±»å è½½å¨ï¼class loaderï¼ï¼æåªäºç±»å è½½å¨ï¼",charIndex:1230},{level:2,title:"é®é¢ 11ï¼ä»ä¹æ¯åäº²å§æ´¾æ¨¡åï¼Parent Delegation Modelï¼ï¼å®çä½ç¨æ¯ä»ä¹ï¼",slug:"é®é¢-11-ä»ä¹æ¯åäº²å§æ´¾æ¨¡å-parent-delegation-model-å®çä½ç¨æ¯ä»ä¹",normalizedTitle:"é®é¢ 11ï¼ä»ä¹æ¯åäº²å§æ´¾æ¨¡åï¼parent delegation modelï¼ï¼å®çä½ç¨æ¯ä»ä¹ï¼",charIndex:1341},{level:2,title:"é®é¢ 12ï¼ä»ä¹æ¯ç±»åå§ååå®ä¾åå§åï¼å®ä»¬çæ§è¡é¡ºåºæ¯ææ ·çï¼",slug:"é®é¢-12-ä»ä¹æ¯ç±»åå§ååå®ä¾åå§å-å®ä»¬çæ§è¡é¡ºåºæ¯ææ ·ç",normalizedTitle:"é®é¢ 12ï¼ä»ä¹æ¯ç±»åå§ååå®ä¾åå§åï¼å®ä»¬çæ§è¡é¡ºåºæ¯ææ ·çï¼",charIndex:1475},{level:2,title:"é¢è¯é¢",slug:"é¢è¯é¢",normalizedTitle:"é¢è¯é¢",charIndex:1662},{level:3,title:"JVM åå­åºååå",slug:"jvm-åå­åºååå",normalizedTitle:"jvm åå­åºååå",charIndex:1670},{level:3,title:"ç±»å è½½æºå¶",slug:"ç±»å è½½æºå¶",normalizedTitle:"ç±»å è½½æºå¶",charIndex:1802},{level:3,title:"å¯¹è±¡åå»ºè¿ç¨",slug:"å¯¹è±¡åå»ºè¿ç¨",normalizedTitle:"å¯¹è±¡åå»ºè¿ç¨",charIndex:1903},{level:3,title:"åå¾åæ¶ç®æ³",slug:"åå¾åæ¶ç®æ³",normalizedTitle:"åå¾åæ¶ç®æ³",charIndex:826},{level:3,title:"å¸¸è§çåå¾æ¶éå¨",slug:"å¸¸è§çåå¾æ¶éå¨",normalizedTitle:"å¸¸è§çåå¾æ¶éå¨",charIndex:2102},{level:3,title:"JVM è°ä¼",slug:"jvm-è°ä¼",normalizedTitle:"jvm è°ä¼",charIndex:2192}],headersStr:"é®é¢ 1ï¼ä»ä¹æ¯JVMï¼ é®é¢ 2ï¼JVMçä¸»è¦ç»æé¨åæåªäºï¼ é®é¢ 3ï¼JVMçåå­æ¨¡åæ¯ä»ä¹ï¼ é®é¢ 4ï¼ä»ä¹æ¯Javaå ï¼å®çä½ç¨æ¯ä»ä¹ï¼ é®é¢ 5ï¼Javaå ä¸­çæ°¸ä¹ä»£ï¼PermGenï¼å·²è¢«åºå¼ï¼åèä»£ä¹çæ¯ä»ä¹ï¼ é®é¢ 6ï¼ä»ä¹æ¯åå¾åæ¶ï¼Garbage Collectionï¼ï¼å®çç®çæ¯ä»ä¹ï¼ é®é¢ 7ï¼è°è°åå¾åæ¶ç®æ³çç±»åååçã é®é¢ 8ï¼ä»ä¹æ¯Javaåå­æº¢åºï¼OutOfMemoryErrorï¼ï¼æä¹é¿åï¼ é®é¢ 9ï¼ä»ä¹æ¯Javaåå­æ³æ¼ï¼å¦ä½é¿åï¼ é®é¢ 10ï¼ä»ä¹æ¯ç±»å è½½å¨ï¼Class Loaderï¼ï¼æåªäºç±»å è½½å¨ï¼ é®é¢ 11ï¼ä»ä¹æ¯åäº²å§æ´¾æ¨¡åï¼Parent Delegation Modelï¼ï¼å®çä½ç¨æ¯ä»ä¹ï¼ é®é¢ 12ï¼ä»ä¹æ¯ç±»åå§ååå®ä¾åå§åï¼å®ä»¬çæ§è¡é¡ºåºæ¯ææ ·çï¼ é¢è¯é¢ JVM åå­åºååå ç±»å è½½æºå¶ å¯¹è±¡åå»ºè¿ç¨ åå¾åæ¶ç®æ³ å¸¸è§çåå¾æ¶éå¨ JVM è°ä¼",content:"# JVM å¸¸é®\n\n\n# é®é¢ 1ï¼ä»ä¹æ¯JVMï¼\n\nç­æ¡ï¼ Javaèææºï¼JVMï¼æ¯Javaç¼ç¨è¯­è¨çè¿è¡æ¶ç¯å¢ï¼å®è´è´£å°Javaæºä»£ç ç¼è¯ä¸ºå­èç å¹¶æ§è¡ãå®æä¾äºåå­ç®¡çãåå¾åæ¶ãç±»å è½½ãå³æ¶ç¼è¯ç­åè½ã\n\n\n# é®é¢ 2ï¼JVMçä¸»è¦ç»æé¨åæåªäºï¼\n\nç­æ¡ï¼ JVMç±ä¸ä¸ªä¸»è¦çå­ç³»ç»ç»æï¼ç±»å è½½å¨ï¼Class Loaderï¼ãè¿è¡æ¶æ°æ®åºï¼Runtime Data Areaï¼åæ§è¡å¼æï¼Execution Engineï¼ã\n\n\n# é®é¢ 3ï¼JVMçåå­æ¨¡åæ¯ä»ä¹ï¼\n\nç­æ¡ï¼ JVMçåå­æ¨¡ååä¸ºçº¿ç¨ç§æåºååçº¿ç¨å±äº«åºåã\n\n 1. çº¿ç¨ç§æåºååæ¬\n    * ç¨åºè®¡æ°å¨ã\n    * èææºæ åæ¬å°æ¹æ³æ ã\n 2. çº¿ç¨å±äº«åºååæ¬\n    * å ã\n    * æ¹æ³åºï¼åç©ºé´ï¼åç´æ¥åå­ã\n\n\n# é®é¢ 4ï¼ä»ä¹æ¯Javaå ï¼å®çä½ç¨æ¯ä»ä¹ï¼\n\nç­æ¡ï¼ Javaå æ¯å­å¨å¯¹è±¡å®ä¾çå°æ¹ï¼ä¹æ¯åå¾åæ¶çä¸»è¦åºåãææçº¿ç¨å±äº«å ï¼å®å¯ä»¥åä¸ºæ°çä»£åèå¹´ä»£ï¼æ°çä»£ååä¸ºEdenç©ºé´ãSurvivorç©ºé´ã\n\nèå¹´ä»£æ¯ç¨äºå­æ¾çå½å¨æè¾é¿çå¯¹è±¡ï¼ç»è¿å¤æ¬¡åå¾åæ¶ä»ç¶å­æ´»çå¯¹è±¡ä¼è¢«ç§»å°èå¹´ä»£ãèå¹´ä»£ç¸å¯¹äºæ°çä»£èè¨ï¼å¶åå¾åæ¶é¢çè¾ä½ã\n\nè¿ç§åä»£çè®¾è®¡å¯ä»¥ä¼ååå¾åæ¶çæçï¼å°å¯¹è±¡æç§çå½å¨æè¿è¡åç±»ï¼æå©äºæé«åå­å©ç¨çåæ§è½ã\n\n\n# é®é¢ 5ï¼Javaå ä¸­çæ°¸ä¹ä»£ï¼PermGenï¼å·²è¢«åºå¼ï¼åèä»£ä¹çæ¯ä»ä¹ï¼\n\nç­æ¡ï¼ Javaå ä¸­çæ°¸ä¹ä»£å·²è¢«åç©ºé´ï¼Metaspaceï¼åä»£ãåç©ºé´å­å¨ãç±»çåæ°æ®ä¿¡æ¯ãï¼å¦ç±»åãæ¹æ³ãå­æ®µç­ï¼é¿åäºæ°¸ä¹ä»£å¯è½å¼èµ·çåå­æº¢åºé®é¢ã\n\n\n# é®é¢ 6ï¼ä»ä¹æ¯åå¾åæ¶ï¼Garbage Collectionï¼ï¼å®çç®çæ¯ä»ä¹ï¼\n\nç­æ¡ï¼ åå¾åæ¶æ¯JVMèªå¨ç®¡çåå­çè¿ç¨ï¼ç¨äºéæ¾ä¸åè¢«å¼ç¨çå¯¹è±¡æå ç¨çåå­ãå¶ç®çæ¯é¿ååå­æ³æ¼ï¼ä½¿ç¨åºè½å¤ææå°ä½¿ç¨åå­ã\n\n\n# é®é¢ 7ï¼è°è°åå¾åæ¶ç®æ³çç±»åååçã\n\nç­æ¡ï¼ åå¾åæ¶ç®æ³æ æ è®°-æ¸é¤ãå¤å¶ãæ è®°-æ´ç ç­ã\n\nå¶ä¸­\n\n * æ è®°-æ¸é¤éè¿æ è®°ä¸åè¢«å¼ç¨çå¯¹è±¡ï¼ç¶åæ¸é¤å®ä»¬ï¼\n * å¤å¶ç®æ³å°å åä¸ºä¸¤ä¸ªåºåï¼æ¯æ¬¡åªä½¿ç¨å¶ä¸­ä¸ä¸ªï¼å°å­æ´»å¯¹è±¡å¤å¶å°å¦ä¸ä¸ªåºåï¼\n * æ è®°-æ´çéè¿æ è®°å­æ´»å¯¹è±¡å¹¶æ´çåå­ï¼å°å­æ´»å¯¹è±¡ç§»å¨å°ä¸ç«¯ï¼ç¶åæ¸é¤å¶ä½é¨åã\n\n\n# é®é¢ 8ï¼ä»ä¹æ¯Javaåå­æº¢åºï¼OutOfMemoryErrorï¼ï¼æä¹é¿åï¼\n\nç­æ¡ï¼ Javaåå­æº¢åºæ¯æJVMä¸­æ²¡æè¶³å¤åå­åéç»æ°çå¯¹è±¡ã\n\nå¯ä»¥éè¿å¢å å å¤§å°ãä¼åä»£ç ãéæ¾ä¸åä½¿ç¨çå¯¹è±¡ãä½¿ç¨åéçæ°æ®ç»æç­æ¹å¼æ¥é¿ååå­æº¢åºã\n\n\n# é®é¢ 9ï¼ä»ä¹æ¯Javaåå­æ³æ¼ï¼å¦ä½é¿åï¼\n\nç­æ¡ï¼ Javaåå­æ³æ¼æ¯æä¸åä½¿ç¨çå¯¹è±¡ä»ç¶è¢«ä¿çå¨åå­ä¸­ï¼å¯¼è´åå­å ç¨ä¸æ­å¢å ã\n\né¿ååå­æ³æ¼çæ¹æ³åæ¬æ­£ç¡®å°å³é­èµæºãä½¿ç¨å¼±å¼ç¨ãåæ¶æ¸é¤ä¸åä½¿ç¨çå¼ç¨ç­ã\n\n\n# é®é¢ 10ï¼ä»ä¹æ¯ç±»å è½½å¨ï¼Class Loaderï¼ï¼æåªäºç±»å è½½å¨ï¼\n\nç­æ¡ï¼ ç±»å è½½å¨è´è´£å°ç±»çå­èç å è½½å°JVMä¸­å¹¶çæå¯¹åºçClasså¯¹è±¡ãä¸»è¦çç±»å è½½å¨æå¼å¯¼ç±»å è½½å¨ãæ©å±ç±»å è½½å¨ååºç¨ç¨åºç±»å è½½å¨ã\n\n\n# é®é¢ 11ï¼ä»ä¹æ¯åäº²å§æ´¾æ¨¡åï¼Parent Delegation Modelï¼ï¼å®çä½ç¨æ¯ä»ä¹ï¼\n\nç­æ¡ï¼ åäº²å§æ´¾æ¨¡åæ¯æç±»å è½½å¨å¨å è½½ç±»æ¶é¦åå§æ´¾ç»ç¶ç±»å è½½å¨ï¼åªæå¨ç¶ç±»å è½½å¨æ¾ä¸å°å¯¹åºçç±»æ¶æå°è¯èªå·±å è½½ãè¿ç§æ¨¡åä¿è¯äºç±»çä¸è´æ§åé²æ­¢ç±»çéå¤å è½½ã\n\n\n# é®é¢ 12ï¼ä»ä¹æ¯ç±»åå§ååå®ä¾åå§åï¼å®ä»¬çæ§è¡é¡ºåºæ¯ææ ·çï¼\n\nç­æ¡ï¼\n\n * ç±»åå§åæ¯å¨ç±»å è½½è¿ç¨ä¸­æ§è¡çéæåå§åä»£ç åï¼\n * å®ä¾åå§åæ¯å¨åå»ºå¯¹è±¡æ¶æ§è¡çå®ä¾åå§åä»£ç åã\n\nç±»åå§åå¨ç±»å è½½è¿ç¨ä¸­åªæ§è¡ä¸æ¬¡ï¼å®ä¾åå§åå¨æ¯æ¬¡åå»ºå¯¹è±¡æ¶é½ä¼æ§è¡ã\n\næ§è¡é¡ºåºæ¯ï¼ç¶ç±»çç±»åå§å -> å­ç±»çç±»åå§å -> ç¶ç±»çå®ä¾åå§å -> å­ç±»çå®ä¾åå§åã\n\n\n# é¢è¯é¢\n\n\n# JVM åå­åºååå\n\n * ä»ç» JVM åå­åºåçååï¼åæ¬å ãæ¹æ³åºï¼åç©ºé´ï¼ãæ ãæ¬å°æ¹æ³æ åç¨åºè®¡æ°å¨ã\n * è¯¦ç»è§£éå åå­åæ¹æ³åºï¼åç©ºé´ï¼çä½ç¨ååºå«ã\n * ä»ä¹æ¯æ°¸ä¹ä»£ï¼PermGenï¼ï¼Java 8 åä»¥åçæ¬ç JVM æä½ä¸åï¼\n\n\n# ç±»å è½½æºå¶\n\n * ä»ä¹æ¯ç±»å è½½å¨ï¼Java ä¸­æåªäºåç½®çç±»å è½½å¨ï¼\n * è§£éç±»å è½½çåäº²å§æ´¾æ¨¡åã\n * ä»ä¹æ¯ç±»å è½½è¿ç¨ï¼åæ¬å è½½ãè¿æ¥ååå§åé¶æ®µã\n * ä»ä¹æ¯ç±»å è½½å¨çå§ææºå¶ï¼\n\n\n# å¯¹è±¡åå»ºè¿ç¨\n\n * æè¿°å¯¹è±¡çåå»ºè¿ç¨ï¼åæ¬å¯¹è±¡çåå­åéååå§åã\n * ä»ä¹æ¯å¯¹è±¡å¤´ï¼å®åå«åªäºä¿¡æ¯ï¼\n * å¦ä½ä¼åå¯¹è±¡çåå»ºï¼ä¾å¦ä½¿ç¨å¯¹è±¡æ± æå»¶è¿åå§åï¼\n\n\n# åå¾åæ¶ç®æ³\n\n * è§£éåå¾åæ¶çç®çååçã\n * ä»ç»å¸¸è§çåå¾åæ¶ç®æ³ï¼å¦æ è®°-æ¸é¤ãå¤å¶ãæ è®°-æ´çç­ã\n * ä»ä¹æ¯åä»£åå¾åæ¶ï¼ä¸ºä»ä¹è¦ä½¿ç¨å®ï¼\n * è§£éæ°çä»£åèå¹´ä»£ä¹é´çå¯¹è±¡æµå¨ååå¾åæ¶ç­ç¥ã\n\n\n# å¸¸è§çåå¾æ¶éå¨\n\n * æè¿°å¹¶åºåå¸¸è§çåå¾æ¶éå¨ï¼å¦Serial GCãParallel GCãCMSãG1 ç­ã\n * éå¯¹ä¸ååºç¨åºæ¯ï¼åªä¸ªåå¾æ¶éå¨æ´éåä½¿ç¨ï¼\n\n\n# JVM è°ä¼\n\n 1. å¦ä½çæ§ JVM çæ§è½ååå­ä½¿ç¨æåµï¼\n\n 2. ä»ä¹æ¯åå¾åæ¶æ¥å¿ï¼GC æ¥å¿ï¼ï¼å¦ä½åæå®æ¥ä¼ååºç¨ç¨åºæ§è½ï¼\n\n 3. ä»ç» JVM åæ°ï¼ä¾å¦-Xmxã-Xmsã-XXã-Xssï¼çä½ç¨åç¨æ³ã\n\n 4. ç°å¨ææä¸ä¸ªæå¡ï¼é¨ç½²ååéäº 4g çå åå­ï¼è¯·ä»ä½ çè§åº¦æ¥åæä¸æä¹ä¼å jvm\n    \n    ä¸ºäºä¼å JVM æ§è½ï¼æ¨å¯ä»¥èèä»¥ä¸å ä¸ªå³é®æ¹é¢ï¼åçéç½®å åå­å¤§å°ãéæ©éå½çåå¾åæ¶å¨åç­ç¥ãç²¾å¿ç®¡ççº¿ç¨åç±»å è½½ãä¼åä»£ç åèµæºä½¿ç¨ãå¹¶åæ§å¶ãå®æ¶çæ§ååææ§è½ï¼ä»¥åå®æåçº§ JVM çæ¬ã\n\n * åå­åéï¼\n   * å åå­å¤§å°ï¼æ ¹æ®åºç¨ç¨åºçéæ±åæå¡å¨çèµæºï¼åçè®¾ç½®å åå­å¤§å°ãéå¸¸ï¼ä¸è¦å°å åå­è®¾ç½®å¾è¿å¤§ï¼ä»¥é¿åè¿é¿çåå¾åæ¶åé¡¿æ¶é´ãå»ºè®®ä½¿ç¨XmxåXmsåæ°æ¥éç½®å åå­å¤§å°ã\n * åå¾åæ¶ï¼\n   * éæ©åéçåå¾åæ¶å¨ï¼æ ¹æ®åºç¨ç¨åºçæ§è´¨åéæ±ï¼éæ©åéçåå¾åæ¶å¨ãä¾å¦ï¼G1åå¾åæ¶å¨éç¨äºå·æå¤§å åå­çåºç¨ç¨åºï¼èCMSéç¨äºä½å»¶è¿è¦æ±çåºç¨ç¨åºã\n   * è°æ´åå¾åæ¶ç­ç¥ï¼æ ¹æ®åºç¨ç¨åºçåå­ä½¿ç¨æåµï¼å¯ä»¥è°æ´åå¾åæ¶ç­ç¥çåæ°ï¼å¦æ°çä»£åèå¹´ä»£çæ¯ä¾ãGCåé¡¿æ¶é´ç­ã\n   * çæ§åå¾åæ¶ï¼ä½¿ç¨JVMçåå¾åæ¶æ¥å¿åå·¥å·ï¼å¦VisualVMãGrafanaãPrometheusï¼æ¥çæ§åå¾åæ¶æ§è½ï¼åæ¶åç°é®é¢å¹¶è¿è¡è°æ´ã\n * çº¿ç¨ç®¡çï¼\n   * æ§å¶çº¿ç¨æ°éï¼åçæ§å¶åºç¨ç¨åºä¸­ççº¿ç¨æ°éï¼ä»¥é¿åçº¿ç¨è¿å¤å¯¼è´åå­åCPUèµæºçæµªè´¹ã\n   * ä½¿ç¨çº¿ç¨æ± ï¼ä½¿ç¨çº¿ç¨æ± æ¥ç®¡ççº¿ç¨ï¼ä»¥é¿åçº¿ç¨çé¢ç¹åå»ºåéæ¯ã\n * ç±»å è½½ä¼åï¼\n   * é¢ç­ç±»å è½½ï¼éè¿é¢ç­ï¼Warm-Upï¼æºå¶ï¼å¨åºç¨ç¨åºå¯å¨ä¹åå è½½ä¸äºå¸¸ç¨çç±»ï¼æé«åºç¨ç¨åºçå¯å¨æ§è½ã\n   * é¿åä¸å¿è¦çç±»å è½½ï¼é¿åä¸å¿è¦çå¨æç±»å è½½æä½ï¼åå°ç±»å è½½å¨çè´æã\n * ä»£ç ä¼åï¼\n   * é¿åè¿å¤çå¯¹è±¡åå»ºï¼åå°å¯¹è±¡çåå»ºåéæ¯ï¼å°¤å¶æ¯å¨å¾ªç¯ä¸­ã\n   * ä¼åç®æ³ï¼éæ©é«æçç®æ³åæ°æ®ç»æï¼é¿åæ§è½ä½ä¸çæä½ã\n * èµæºç®¡çï¼\n   * å³é­ä¸éè¦çèµæºï¼åæ¶å³é­æä»¶ãæ°æ®åºè¿æ¥ãç½ç»è¿æ¥ç­èµæºï¼ä»¥éæ¾ç³»ç»èµæºã\n   * ä½¿ç¨è¿æ¥æ± ï¼ä½¿ç¨æ°æ®åºè¿æ¥æ± ãè¿æ¥æ± ç­èµæºæ± ï¼ä»¥ä¾¿ææå°ç®¡çåå¤ç¨èµæºã\n * å¹¶åç®¡çï¼\n   * ä½¿ç¨å¹¶åå·¥å·ï¼ä½¿ç¨Javaçå¹¶åå·¥å·åºï¼å¦ConcurrentHashMapãçº¿ç¨æ± ï¼æ¥ç®¡çå¹¶åè®¿é®ã\n   * é¿åç«ææ¡ä»¶ï¼ä½¿ç¨éååæ­¥æºå¶æ¥é¿åå¤çº¿ç¨ç«ææ¡ä»¶å¯¼è´çé®é¢ã\n * çæ§ååæï¼\n   * å®æ¶çæ§ï¼ä½¿ç¨çæ§å·¥å·æ¥å®æ¶çæ§åºç¨ç¨åºçæ§è½ææ ï¼åæ¶åç°é®é¢ã\n   * åæå·¥å·ï¼ä½¿ç¨æ§è½åæå·¥å·æ¥è¯å«æ§è½ç¶é¢ååå­æ³æ¼é®é¢ã\n * çæ¬åçº§ï¼\n   * JVMçæ¬ï¼åçº§å°ææ°çJVMçæ¬ï¼ä»¥è·åæ§è½åå®å¨æ§çæ¹è¿ã\n * å®¹å¨åï¼\n   * å¦æåºç¨ç¨åºè¿è¡å¨å®¹å¨ä¸­ï¼åçéç½®å®¹å¨çèµæºéå¶ï¼ä»¥é¿åèµæºäºç¨ã",normalizedContent:"# jvm å¸¸é®\n\n\n# é®é¢ 1ï¼ä»ä¹æ¯jvmï¼\n\nç­æ¡ï¼ javaèææºï¼jvmï¼æ¯javaç¼ç¨è¯­è¨çè¿è¡æ¶ç¯å¢ï¼å®è´è´£å°javaæºä»£ç ç¼è¯ä¸ºå­èç å¹¶æ§è¡ãå®æä¾äºåå­ç®¡çãåå¾åæ¶ãç±»å è½½ãå³æ¶ç¼è¯ç­åè½ã\n\n\n# é®é¢ 2ï¼jvmçä¸»è¦ç»æé¨åæåªäºï¼\n\nç­æ¡ï¼ jvmç±ä¸ä¸ªä¸»è¦çå­ç³»ç»ç»æï¼ç±»å è½½å¨ï¼class loaderï¼ãè¿è¡æ¶æ°æ®åºï¼runtime data areaï¼åæ§è¡å¼æï¼execution engineï¼ã\n\n\n# é®é¢ 3ï¼jvmçåå­æ¨¡åæ¯ä»ä¹ï¼\n\nç­æ¡ï¼ jvmçåå­æ¨¡ååä¸ºçº¿ç¨ç§æåºååçº¿ç¨å±äº«åºåã\n\n 1. çº¿ç¨ç§æåºååæ¬\n    * ç¨åºè®¡æ°å¨ã\n    * èææºæ åæ¬å°æ¹æ³æ ã\n 2. çº¿ç¨å±äº«åºååæ¬\n    * å ã\n    * æ¹æ³åºï¼åç©ºé´ï¼åç´æ¥åå­ã\n\n\n# é®é¢ 4ï¼ä»ä¹æ¯javaå ï¼å®çä½ç¨æ¯ä»ä¹ï¼\n\nç­æ¡ï¼ javaå æ¯å­å¨å¯¹è±¡å®ä¾çå°æ¹ï¼ä¹æ¯åå¾åæ¶çä¸»è¦åºåãææçº¿ç¨å±äº«å ï¼å®å¯ä»¥åä¸ºæ°çä»£åèå¹´ä»£ï¼æ°çä»£ååä¸ºedenç©ºé´ãsurvivorç©ºé´ã\n\nèå¹´ä»£æ¯ç¨äºå­æ¾çå½å¨æè¾é¿çå¯¹è±¡ï¼ç»è¿å¤æ¬¡åå¾åæ¶ä»ç¶å­æ´»çå¯¹è±¡ä¼è¢«ç§»å°èå¹´ä»£ãèå¹´ä»£ç¸å¯¹äºæ°çä»£èè¨ï¼å¶åå¾åæ¶é¢çè¾ä½ã\n\nè¿ç§åä»£çè®¾è®¡å¯ä»¥ä¼ååå¾åæ¶çæçï¼å°å¯¹è±¡æç§çå½å¨æè¿è¡åç±»ï¼æå©äºæé«åå­å©ç¨çåæ§è½ã\n\n\n# é®é¢ 5ï¼javaå ä¸­çæ°¸ä¹ä»£ï¼permgenï¼å·²è¢«åºå¼ï¼åèä»£ä¹çæ¯ä»ä¹ï¼\n\nç­æ¡ï¼ javaå ä¸­çæ°¸ä¹ä»£å·²è¢«åç©ºé´ï¼metaspaceï¼åä»£ãåç©ºé´å­å¨ãç±»çåæ°æ®ä¿¡æ¯ãï¼å¦ç±»åãæ¹æ³ãå­æ®µç­ï¼é¿åäºæ°¸ä¹ä»£å¯è½å¼èµ·çåå­æº¢åºé®é¢ã\n\n\n# é®é¢ 6ï¼ä»ä¹æ¯åå¾åæ¶ï¼garbage collectionï¼ï¼å®çç®çæ¯ä»ä¹ï¼\n\nç­æ¡ï¼ åå¾åæ¶æ¯jvmèªå¨ç®¡çåå­çè¿ç¨ï¼ç¨äºéæ¾ä¸åè¢«å¼ç¨çå¯¹è±¡æå ç¨çåå­ãå¶ç®çæ¯é¿ååå­æ³æ¼ï¼ä½¿ç¨åºè½å¤ææå°ä½¿ç¨åå­ã\n\n\n# é®é¢ 7ï¼è°è°åå¾åæ¶ç®æ³çç±»åååçã\n\nç­æ¡ï¼ åå¾åæ¶ç®æ³æ æ è®°-æ¸é¤ãå¤å¶ãæ è®°-æ´ç ç­ã\n\nå¶ä¸­\n\n * æ è®°-æ¸é¤éè¿æ è®°ä¸åè¢«å¼ç¨çå¯¹è±¡ï¼ç¶åæ¸é¤å®ä»¬ï¼\n * å¤å¶ç®æ³å°å åä¸ºä¸¤ä¸ªåºåï¼æ¯æ¬¡åªä½¿ç¨å¶ä¸­ä¸ä¸ªï¼å°å­æ´»å¯¹è±¡å¤å¶å°å¦ä¸ä¸ªåºåï¼\n * æ è®°-æ´çéè¿æ è®°å­æ´»å¯¹è±¡å¹¶æ´çåå­ï¼å°å­æ´»å¯¹è±¡ç§»å¨å°ä¸ç«¯ï¼ç¶åæ¸é¤å¶ä½é¨åã\n\n\n# é®é¢ 8ï¼ä»ä¹æ¯javaåå­æº¢åºï¼outofmemoryerrorï¼ï¼æä¹é¿åï¼\n\nç­æ¡ï¼ javaåå­æº¢åºæ¯æjvmä¸­æ²¡æè¶³å¤åå­åéç»æ°çå¯¹è±¡ã\n\nå¯ä»¥éè¿å¢å å å¤§å°ãä¼åä»£ç ãéæ¾ä¸åä½¿ç¨çå¯¹è±¡ãä½¿ç¨åéçæ°æ®ç»æç­æ¹å¼æ¥é¿ååå­æº¢åºã\n\n\n# é®é¢ 9ï¼ä»ä¹æ¯javaåå­æ³æ¼ï¼å¦ä½é¿åï¼\n\nç­æ¡ï¼ javaåå­æ³æ¼æ¯æä¸åä½¿ç¨çå¯¹è±¡ä»ç¶è¢«ä¿çå¨åå­ä¸­ï¼å¯¼è´åå­å ç¨ä¸æ­å¢å ã\n\né¿ååå­æ³æ¼çæ¹æ³åæ¬æ­£ç¡®å°å³é­èµæºãä½¿ç¨å¼±å¼ç¨ãåæ¶æ¸é¤ä¸åä½¿ç¨çå¼ç¨ç­ã\n\n\n# é®é¢ 10ï¼ä»ä¹æ¯ç±»å è½½å¨ï¼class loaderï¼ï¼æåªäºç±»å è½½å¨ï¼\n\nç­æ¡ï¼ ç±»å è½½å¨è´è´£å°ç±»çå­èç å è½½å°jvmä¸­å¹¶çæå¯¹åºçclasså¯¹è±¡ãä¸»è¦çç±»å è½½å¨æå¼å¯¼ç±»å è½½å¨ãæ©å±ç±»å è½½å¨ååºç¨ç¨åºç±»å è½½å¨ã\n\n\n# é®é¢ 11ï¼ä»ä¹æ¯åäº²å§æ´¾æ¨¡åï¼parent delegation modelï¼ï¼å®çä½ç¨æ¯ä»ä¹ï¼\n\nç­æ¡ï¼ åäº²å§æ´¾æ¨¡åæ¯æç±»å è½½å¨å¨å è½½ç±»æ¶é¦åå§æ´¾ç»ç¶ç±»å è½½å¨ï¼åªæå¨ç¶ç±»å è½½å¨æ¾ä¸å°å¯¹åºçç±»æ¶æå°è¯èªå·±å è½½ãè¿ç§æ¨¡åä¿è¯äºç±»çä¸è´æ§åé²æ­¢ç±»çéå¤å è½½ã\n\n\n# é®é¢ 12ï¼ä»ä¹æ¯ç±»åå§ååå®ä¾åå§åï¼å®ä»¬çæ§è¡é¡ºåºæ¯ææ ·çï¼\n\nç­æ¡ï¼\n\n * ç±»åå§åæ¯å¨ç±»å è½½è¿ç¨ä¸­æ§è¡çéæåå§åä»£ç åï¼\n * å®ä¾åå§åæ¯å¨åå»ºå¯¹è±¡æ¶æ§è¡çå®ä¾åå§åä»£ç åã\n\nç±»åå§åå¨ç±»å è½½è¿ç¨ä¸­åªæ§è¡ä¸æ¬¡ï¼å®ä¾åå§åå¨æ¯æ¬¡åå»ºå¯¹è±¡æ¶é½ä¼æ§è¡ã\n\næ§è¡é¡ºåºæ¯ï¼ç¶ç±»çç±»åå§å -> å­ç±»çç±»åå§å -> ç¶ç±»çå®ä¾åå§å -> å­ç±»çå®ä¾åå§åã\n\n\n# é¢è¯é¢\n\n\n# jvm åå­åºååå\n\n * ä»ç» jvm åå­åºåçååï¼åæ¬å ãæ¹æ³åºï¼åç©ºé´ï¼ãæ ãæ¬å°æ¹æ³æ åç¨åºè®¡æ°å¨ã\n * è¯¦ç»è§£éå åå­åæ¹æ³åºï¼åç©ºé´ï¼çä½ç¨ååºå«ã\n * ä»ä¹æ¯æ°¸ä¹ä»£ï¼permgenï¼ï¼java 8 åä»¥åçæ¬ç jvm æä½ä¸åï¼\n\n\n# ç±»å è½½æºå¶\n\n * ä»ä¹æ¯ç±»å è½½å¨ï¼java ä¸­æåªäºåç½®çç±»å è½½å¨ï¼\n * è§£éç±»å è½½çåäº²å§æ´¾æ¨¡åã\n * ä»ä¹æ¯ç±»å è½½è¿ç¨ï¼åæ¬å è½½ãè¿æ¥ååå§åé¶æ®µã\n * ä»ä¹æ¯ç±»å è½½å¨çå§ææºå¶ï¼\n\n\n# å¯¹è±¡åå»ºè¿ç¨\n\n * æè¿°å¯¹è±¡çåå»ºè¿ç¨ï¼åæ¬å¯¹è±¡çåå­åéååå§åã\n * ä»ä¹æ¯å¯¹è±¡å¤´ï¼å®åå«åªäºä¿¡æ¯ï¼\n * å¦ä½ä¼åå¯¹è±¡çåå»ºï¼ä¾å¦ä½¿ç¨å¯¹è±¡æ± æå»¶è¿åå§åï¼\n\n\n# åå¾åæ¶ç®æ³\n\n * è§£éåå¾åæ¶çç®çååçã\n * ä»ç»å¸¸è§çåå¾åæ¶ç®æ³ï¼å¦æ è®°-æ¸é¤ãå¤å¶ãæ è®°-æ´çç­ã\n * ä»ä¹æ¯åä»£åå¾åæ¶ï¼ä¸ºä»ä¹è¦ä½¿ç¨å®ï¼\n * è§£éæ°çä»£åèå¹´ä»£ä¹é´çå¯¹è±¡æµå¨ååå¾åæ¶ç­ç¥ã\n\n\n# å¸¸è§çåå¾æ¶éå¨\n\n * æè¿°å¹¶åºåå¸¸è§çåå¾æ¶éå¨ï¼å¦serial gcãparallel gcãcmsãg1 ç­ã\n * éå¯¹ä¸ååºç¨åºæ¯ï¼åªä¸ªåå¾æ¶éå¨æ´éåä½¿ç¨ï¼\n\n\n# jvm è°ä¼\n\n 1. å¦ä½çæ§ jvm çæ§è½ååå­ä½¿ç¨æåµï¼\n\n 2. ä»ä¹æ¯åå¾åæ¶æ¥å¿ï¼gc æ¥å¿ï¼ï¼å¦ä½åæå®æ¥ä¼ååºç¨ç¨åºæ§è½ï¼\n\n 3. ä»ç» jvm åæ°ï¼ä¾å¦-xmxã-xmsã-xxã-xssï¼çä½ç¨åç¨æ³ã\n\n 4. ç°å¨ææä¸ä¸ªæå¡ï¼é¨ç½²ååéäº 4g çå åå­ï¼è¯·ä»ä½ çè§åº¦æ¥åæä¸æä¹ä¼å jvm\n    \n    ä¸ºäºä¼å jvm æ§è½ï¼æ¨å¯ä»¥èèä»¥ä¸å ä¸ªå³é®æ¹é¢ï¼åçéç½®å åå­å¤§å°ãéæ©éå½çåå¾åæ¶å¨åç­ç¥ãç²¾å¿ç®¡ççº¿ç¨åç±»å è½½ãä¼åä»£ç åèµæºä½¿ç¨ãå¹¶åæ§å¶ãå®æ¶çæ§ååææ§è½ï¼ä»¥åå®æåçº§ jvm çæ¬ã\n\n * åå­åéï¼\n   * å åå­å¤§å°ï¼æ ¹æ®åºç¨ç¨åºçéæ±åæå¡å¨çèµæºï¼åçè®¾ç½®å åå­å¤§å°ãéå¸¸ï¼ä¸è¦å°å åå­è®¾ç½®å¾è¿å¤§ï¼ä»¥é¿åè¿é¿çåå¾åæ¶åé¡¿æ¶é´ãå»ºè®®ä½¿ç¨xmxåxmsåæ°æ¥éç½®å åå­å¤§å°ã\n * åå¾åæ¶ï¼\n   * éæ©åéçåå¾åæ¶å¨ï¼æ ¹æ®åºç¨ç¨åºçæ§è´¨åéæ±ï¼éæ©åéçåå¾åæ¶å¨ãä¾å¦ï¼g1åå¾åæ¶å¨éç¨äºå·æå¤§å åå­çåºç¨ç¨åºï¼ècmséç¨äºä½å»¶è¿è¦æ±çåºç¨ç¨åºã\n   * è°æ´åå¾åæ¶ç­ç¥ï¼æ ¹æ®åºç¨ç¨åºçåå­ä½¿ç¨æåµï¼å¯ä»¥è°æ´åå¾åæ¶ç­ç¥çåæ°ï¼å¦æ°çä»£åèå¹´ä»£çæ¯ä¾ãgcåé¡¿æ¶é´ç­ã\n   * çæ§åå¾åæ¶ï¼ä½¿ç¨jvmçåå¾åæ¶æ¥å¿åå·¥å·ï¼å¦visualvmãgrafanaãprometheusï¼æ¥çæ§åå¾åæ¶æ§è½ï¼åæ¶åç°é®é¢å¹¶è¿è¡è°æ´ã\n * çº¿ç¨ç®¡çï¼\n   * æ§å¶çº¿ç¨æ°éï¼åçæ§å¶åºç¨ç¨åºä¸­ççº¿ç¨æ°éï¼ä»¥é¿åçº¿ç¨è¿å¤å¯¼è´åå­åcpuèµæºçæµªè´¹ã\n   * ä½¿ç¨çº¿ç¨æ± ï¼ä½¿ç¨çº¿ç¨æ± æ¥ç®¡ççº¿ç¨ï¼ä»¥é¿åçº¿ç¨çé¢ç¹åå»ºåéæ¯ã\n * ç±»å è½½ä¼åï¼\n   * é¢ç­ç±»å è½½ï¼éè¿é¢ç­ï¼warm-upï¼æºå¶ï¼å¨åºç¨ç¨åºå¯å¨ä¹åå è½½ä¸äºå¸¸ç¨çç±»ï¼æé«åºç¨ç¨åºçå¯å¨æ§è½ã\n   * é¿åä¸å¿è¦çç±»å è½½ï¼é¿åä¸å¿è¦çå¨æç±»å è½½æä½ï¼åå°ç±»å è½½å¨çè´æã\n * ä»£ç ä¼åï¼\n   * é¿åè¿å¤çå¯¹è±¡åå»ºï¼åå°å¯¹è±¡çåå»ºåéæ¯ï¼å°¤å¶æ¯å¨å¾ªç¯ä¸­ã\n   * ä¼åç®æ³ï¼éæ©é«æçç®æ³åæ°æ®ç»æï¼é¿åæ§è½ä½ä¸çæä½ã\n * èµæºç®¡çï¼\n   * å³é­ä¸éè¦çèµæºï¼åæ¶å³é­æä»¶ãæ°æ®åºè¿æ¥ãç½ç»è¿æ¥ç­èµæºï¼ä»¥éæ¾ç³»ç»èµæºã\n   * ä½¿ç¨è¿æ¥æ± ï¼ä½¿ç¨æ°æ®åºè¿æ¥æ± ãè¿æ¥æ± ç­èµæºæ± ï¼ä»¥ä¾¿ææå°ç®¡çåå¤ç¨èµæºã\n * å¹¶åç®¡çï¼\n   * ä½¿ç¨å¹¶åå·¥å·ï¼ä½¿ç¨javaçå¹¶åå·¥å·åºï¼å¦concurrenthashmapãçº¿ç¨æ± ï¼æ¥ç®¡çå¹¶åè®¿é®ã\n   * é¿åç«ææ¡ä»¶ï¼ä½¿ç¨éååæ­¥æºå¶æ¥é¿åå¤çº¿ç¨ç«ææ¡ä»¶å¯¼è´çé®é¢ã\n * çæ§ååæï¼\n   * å®æ¶çæ§ï¼ä½¿ç¨çæ§å·¥å·æ¥å®æ¶çæ§åºç¨ç¨åºçæ§è½ææ ï¼åæ¶åç°é®é¢ã\n   * åæå·¥å·ï¼ä½¿ç¨æ§è½åæå·¥å·æ¥è¯å«æ§è½ç¶é¢ååå­æ³æ¼é®é¢ã\n * çæ¬åçº§ï¼\n   * jvmçæ¬ï¼åçº§å°ææ°çjvmçæ¬ï¼ä»¥è·åæ§è½åå®å¨æ§çæ¹è¿ã\n * å®¹å¨åï¼\n   * å¦æåºç¨ç¨åºè¿è¡å¨å®¹å¨ä¸­ï¼åçéç½®å®¹å¨çèµæºéå¶ï¼ä»¥é¿åèµæºäºç¨ã",charsets:{cjk:!0}},{title:"JVMåºç¡å¥é¨",frontmatter:{title:"JVMåºç¡å¥é¨",date:"2023-08-11T22:29:07.000Z",permalink:"/pages/562a37/",author:{name:"éä¸æ¸é£",link:"https://msqfx.github.io"},categories:["java","JVM"],tags:[null],description:"åè®¾æä»¬æä¸ä¸ªæä»¶ x.Javaï¼ä½ æ§è¡ javacï¼å®å°±ä¼åæ x.classã",comment:!0,meta:[{name:"image",content:"https://cmty256.github.io/imgs-blog/Java/image-20230811223459658.ku0m0cn1b0g.png"},{name:"twitter:title",content:"JVMåºç¡å¥é¨"},{name:"twitter:description",content:"åè®¾æä»¬æä¸ä¸ªæä»¶ x.Javaï¼ä½ æ§è¡ javacï¼å®å°±ä¼åæ x.classã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://cmty256.github.io/imgs-blog/Java/image-20230811223459658.ku0m0cn1b0g.png"},{name:"twitter:url",content:"https://www.msqfx.cc/01.java/04.JVM/01.JVM%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html"},{property:"og:type",content:"article"},{property:"og:title",content:"JVMåºç¡å¥é¨"},{property:"og:description",content:"åè®¾æä»¬æä¸ä¸ªæä»¶ x.Javaï¼ä½ æ§è¡ javacï¼å®å°±ä¼åæ x.classã"},{property:"og:image",content:"https://cmty256.github.io/imgs-blog/Java/image-20230811223459658.ku0m0cn1b0g.png"},{property:"og:url",content:"https://www.msqfx.cc/01.java/04.JVM/01.JVM%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-08-11T22:29:07.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"JVMåºç¡å¥é¨"},{itemprop:"description",content:"åè®¾æä»¬æä¸ä¸ªæä»¶ x.Javaï¼ä½ æ§è¡ javacï¼å®å°±ä¼åæ x.classã"},{itemprop:"image",content:"https://cmty256.github.io/imgs-blog/Java/image-20230811223459658.ku0m0cn1b0g.png"}],readingShow:"top"},regularPath:"/01.java/04.JVM/01.JVM%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html",relativePath:"01.java/04.JVM/01.JVMåºç¡å¥é¨.md",key:"v-47b0b8a9",path:"/pages/562a37/",headers:[{level:2,title:"JVM åºç¡",slug:"jvm-åºç¡",normalizedTitle:"jvm åºç¡",charIndex:2},{level:3,title:"èä¸è Java ä»ç¼ç å°æ§è¡å°åºæ¯ä¸ä¸ªæä¹æ ·çè¿ç¨ï¼",slug:"èä¸è-java-ä»ç¼ç å°æ§è¡å°åºæ¯ä¸ä¸ªæä¹æ ·çè¿ç¨",normalizedTitle:"èä¸è java ä»ç¼ç å°æ§è¡å°åºæ¯ä¸ä¸ªæä¹æ ·çè¿ç¨ï¼",charIndex:26},{level:3,title:"ä»ä¹æ¯ JVM?",slug:"ä»ä¹æ¯-jvm",normalizedTitle:"ä»ä¹æ¯ jvm?",charIndex:733},{level:3,title:"å¸¸è§ç JVM å®ç°",slug:"å¸¸è§ç-jvm-å®ç°",normalizedTitle:"å¸¸è§ç jvm å®ç°",charIndex:1064},{level:3,title:"JDK JRE JVM çå³ç³»",slug:"jdk-jre-jvm-çå³ç³»",normalizedTitle:"jdk jre jvm çå³ç³»",charIndex:1475},{level:2,title:"Class æä»¶æ ¼å¼",slug:"class-æä»¶æ ¼å¼",normalizedTitle:"class æä»¶æ ¼å¼",charIndex:1614},{level:2,title:"ç±»å è½½ - åå§å",slug:"ç±»å è½½-åå§å",normalizedTitle:"ç±»å è½½ - åå§å",charIndex:3164},{level:3,title:"å è½½è¿ç¨",slug:"å è½½è¿ç¨",normalizedTitle:"å è½½è¿ç¨",charIndex:3178},{level:3,title:"ç±»å è½½å¨",slug:"ç±»å è½½å¨",normalizedTitle:"ç±»å è½½å¨",charIndex:4636},{level:3,title:"åäº²å§æ´¾",slug:"åäº²å§æ´¾",normalizedTitle:"åäº²å§æ´¾",charIndex:4971},{level:4,title:"ä¸ºä»ä¹ç±»å è½½å¨è¦ä½¿ç¨åäº²å§æ´¾ï¼ï¼éè¦ï¼",slug:"ä¸ºä»ä¹ç±»å è½½å¨è¦ä½¿ç¨åäº²å§æ´¾-éè¦",normalizedTitle:"ä¸ºä»ä¹ç±»å è½½å¨è¦ä½¿ç¨åäº²å§æ´¾ï¼ï¼éè¦ï¼",charIndex:6716},{level:3,title:"ç±»å è½½å¨èå´",slug:"ç±»å è½½å¨èå´",normalizedTitle:"ç±»å è½½å¨èå´",charIndex:6780},{level:3,title:"èªå®ä¹ç±»å è½½å¨",slug:"èªå®ä¹ç±»å è½½å¨",normalizedTitle:"èªå®ä¹ç±»å è½½å¨",charIndex:6538},{level:4,title:"loadClass æºç è§£æ",slug:"loadclass-æºç è§£æ",normalizedTitle:"loadclass æºç è§£æ",charIndex:10875},{level:4,title:"èªå®ä¹ä¸ä¸ªç±»å è½½å¨éè¦åä»ä¹ï¼",slug:"èªå®ä¹ä¸ä¸ªç±»å è½½å¨éè¦åä»ä¹",normalizedTitle:"èªå®ä¹ä¸ä¸ªç±»å è½½å¨éè¦åä»ä¹ï¼",charIndex:13144},{level:4,title:"å å¯",slug:"å å¯",normalizedTitle:"å å¯",charIndex:13291},{level:3,title:"ç¼è¯å¨",slug:"ç¼è¯å¨",normalizedTitle:"ç¼è¯å¨",charIndex:284},{level:3,title:"æå è½½",slug:"æå è½½",normalizedTitle:"æå è½½",charIndex:16691},{level:3,title:"æå±ç¥è¯",slug:"æå±ç¥è¯",normalizedTitle:"æå±ç¥è¯",charIndex:17044},{level:4,title:"åäº²å§æ´¾å¦ä½æç ´ï¼",slug:"åäº²å§æ´¾å¦ä½æç ´",normalizedTitle:"åäº²å§æ´¾å¦ä½æç ´ï¼",charIndex:17052},{level:4,title:"ç±»å è½½å¨æ¶åå°äºåªäºè®¾è®¡æ¨¡å¼ï¼",slug:"ç±»å è½½å¨æ¶åå°äºåªäºè®¾è®¡æ¨¡å¼",normalizedTitle:"ç±»å è½½å¨æ¶åå°äºåªäºè®¾è®¡æ¨¡å¼ï¼",charIndex:17385}],headersStr:"JVM åºç¡ èä¸è Java ä»ç¼ç å°æ§è¡å°åºæ¯ä¸ä¸ªæä¹æ ·çè¿ç¨ï¼ ä»ä¹æ¯ JVM? å¸¸è§ç JVM å®ç° JDK JRE JVM çå³ç³» Class æä»¶æ ¼å¼ ç±»å è½½ - åå§å å è½½è¿ç¨ ç±»å è½½å¨ åäº²å§æ´¾ ä¸ºä»ä¹ç±»å è½½å¨è¦ä½¿ç¨åäº²å§æ´¾ï¼ï¼éè¦ï¼ ç±»å è½½å¨èå´ èªå®ä¹ç±»å è½½å¨ loadClass æºç è§£æ èªå®ä¹ä¸ä¸ªç±»å è½½å¨éè¦åä»ä¹ï¼ å å¯ ç¼è¯å¨ æå è½½ æå±ç¥è¯ åäº²å§æ´¾å¦ä½æç ´ï¼ ç±»å è½½å¨æ¶åå°äºåªäºè®¾è®¡æ¨¡å¼ï¼",content:'# JVM åºç¡å¥é¨\n\n\n# JVM åºç¡\n\n\n# èä¸è Java ä»ç¼ç å°æ§è¡å°åºæ¯ä¸ä¸ªæä¹æ ·çè¿ç¨ï¼\n\n\n\nåè®¾æä»¬æä¸ä¸ªæä»¶ x.Javaï¼ä½ æ§è¡ javacï¼å®å°±ä¼åæ x.classã\n\nè¿ä¸ª class æä¹æ§è¡çï¼\n\nå½æä»¬è°ç¨ Java å½ä»¤çæ¶åï¼class ä¼è¢« load å°åå­ï¼è¿åå«ãClassloaderãï¼ä¼è¢« Classloader è£è½½å°åå­éã\n\nä¸è¬çæåµä¸ï¼æä»¬åèªå·±çç±»æä»¶çæ¶åä¹ä¼ç¨å° ãJava çç±»åºãï¼æä»¥ä»ä¼æ Java ç±»åºç¸å³çè¿äºä¸ªç±»ä¹è¦è£è½½å°åå­éï¼è£è½½å®æä¹åä¼è°ç¨ãå­èç è§£éå¨ãæèæ¯ãJIT å³æ¶ç¼è¯å¨ãæ¥è¿è¡è§£éæç¼è¯ï¼ç¼è¯å®ä¹åç±ãæ§è¡å¼æãå¼å§æ§è¡ï¼è¿ä»¥åä¸é¢é¢å¯¹çï¼é£å°±æ¯æä½ç³»ç»åç¡¬ä»¶äºã\n\nJava ç¼è¯å¥½äºä¹ååæ classï¼ class ä¼è¢« load å°åå­ï¼ä¸æ­¤åæ¶åä»ä¹ stringï¼ object è¿äºä¸ª class ä¹é½ä¼è¢« load å°åå­ã\n\nJava æ¯è¿ä¸ªè§£éæ§è¡çè¿æ¯ç¼è¯æ§è¡çï¼\n\nå¶å®è§£éåç¼è¯æ¯å¯ä»¥æ··åçï¼ç¹å«å¸¸ç¨çä¸äºä»£ç ï¼ä»£ç ç¨å°çæ¬¡æ°ç¹å«å¤ï¼è¿ä¸ªæ¶åä»ä¼æä»£ç åæä¸ä¸ªåæ¶çç¼è¯ï¼åæä¸ä¸ªæ¬å°çç¼è¯ã\n\nä½ å¯ä»¥çè§£ä¸ºå°±å c è¯­è¨å¨ Windows ä¸æ§è¡çæ¶åï¼æå®ç¼è¯æ exe ä¸æ ·ï¼é£ä¹ä¸æ¬¡åæ§è¡è¿æ®µä»£ç çæ¶åï¼å°±ä¸éè¦éè¿è§£éå¨æ¥ä¸å¥ä¸å¥è§£éæ¥æ§è¡äºï¼æ§è¡å¼æå¯ä»¥ç´æ¥äº¤ç»æä½ç³»ç»å»è®©å®è°ç¨ï¼è¿ä¸ªæçè¦é«å¾å¤ï¼ä¸æ¯ææçä»£ç é½è¦é½ä¼è¢« GIT è¿è¡åæ¶ç¼è¯çï¼å¦ææ¯è¿æ ·çè¯ï¼é£æ´ä¸ª Java å°±å®å¨åæäºä¸è½è·¨å¹³å°äºã\n\næä»¥æä¸äºç¹å®çï¼æ§è¡èµ·æ¥æ§è¡æ¬¡æ°å¥½å¤å¥½å¤ï¼ç¨çç¹å«å¤çæ¶åï¼è¿ä¸ªæ¶åä¼è¿è¡ä¸ä¸ªå³æ¶ç¼è¯å¨çç¼è¯ã\n\n\n# ä»ä¹æ¯ JVM?\n\næè°ç JVM èææºï¼å¶å®å®æ¬èº«æ¯ä¸ä¸ªè§èï¼æ¯èæåºæ¥çä¸å°è®¡ç®æºãæ¥æèªå·±çæä½ç³»ç»ï¼æ¯ä¸ä¸ªè·¨è¯­è¨å¹³å°ã\n\nä¸ºä»ä¹ JVM èææºè½å¤æ¯æå¤ç§è¯­è¨è¿è¡å¨ä¸é¢å¢ï¼\n\næå³é®çåå æ¯å°±æ¯å ä¸º class è¿ä¸ªä¸è¥¿ï¼æä»¬å¯ä»¥è¯´ä»»ä½çè¯­è¨ï¼åªè¦ä½ è½ç¼è¯æ classï¼ç¬¦å class æä»¶çè§èï¼ä½ å°±å¯ä»¥æå¨ Java èææºä¸å»æ§è¡ã\n\næ³¨æï¼JVM åªå class æä»¶æå³ï¼ä¸ java æ å³ã\n\nJDK å®ç½ï¼Java SE Specifications (oracle.com)\n\nç»´åºç¾ç§ï¼Javaèææº - ç»´åºç¾ç§ï¼èªç±çç¾ç§å¨ä¹¦ (wikipedia.org)\n\nç²éª¨æä¸­å½ï¼Java è½¯ä»¶ | Oracle ä¸­å½\n\n\n# å¸¸è§ç JVM å®ç°\n\n 1. Hotspotï¼æå¸¸ç¨ï¼\n    \n    * oracle å®æ¹ï¼æä»¬åå®éªç¨ç JVMï¼Java èææº\n    * java -version å½ä»¤å¯æ¥çä½¿ç¨çæ¯ä»ä¹ JVM\n    * Hotspot 8 ä¹åè¦æ¶è´¹ï¼ä½ Open JDK æ¯å¼æºççæ¬ï¼åè´¹\n\n 2. Jrockit\n    \n    * BEA æ¾ç»å·ç§°ä¸çä¸æå¿«ç JVM\n    * è¢« Oracle æ¶è´­ï¼åå¹¶äº hotspot\n\n 3. TaobaoVMï¼åè´¹ï¼\n    \n    * hotspot æ·±åº¦å®å¶ç\n\n 4. LiquidVM\n    \n    * ç´æ¥éå¯¹ç¡¬ä»¶\n\n 5. azul zingï¼ç¹å«è´µï¼\n    \n    * ææ°åå¾åæ¶çä¸çæ æï¼å·ç§° 1ms ä»¥åï¼\n    * www.azul.com\n\n 6. J9-IBM\n    \n    * Microsoft VM\n\n\n# JDK JRE JVM çå³ç³»\n\nåå«å³ç³»ã\n\nJVM -- è¿è¡ java å­èç çèææº\n\nJRE -- java è¿è¡ç¯å¢ == jvm + coreï¼æ ¸å¿ç±»åºï¼\n\nJDK -- java å¼åå·¥å·å == jre + development kitï¼å¼åå·¥å·ï¼\n\n\n# Class æä»¶æ ¼å¼\n\nClass æä»¶æ ¼å¼ï¼File Formatï¼\n\n * äºè¿å¶å­èæµï¼ç± java èææºè§£éï¼\n * æ°æ®ç±»å: u1 u2 u4 u8 å _info (è¡¨ç±»å)\n   * info çæ¥æºæ¯ hotspot æºç ä¸­çåæ³\n * æ¥ç 16 è¿å¶æ ¼å¼ç ClassFile\n   * è½¯ä»¶ - sublime / notepad /\n   * IDEA æä»¶ - BinEd\n * æå¾å¤å¯ä»¥æ´å¥½è§å¯ ByteCode çæ¹æ³\n   * ç»ç«¯å½ä»¤ï¼javap <classæä»¶è·¯å¾>ï¼-v åæ°è¯¦ç»æ¥ç\n   * JBE å¯ä»¥ç´æ¥ä¿®æ¹\n   * JClassLib - IDEA æä»¶ä¹ä¸\n * æä»¶ç»æ\n   * General Informationï¼éç¨ä¿¡æ¯ï¼ï¼ è¿ä¸ªé¨ååå«äºä¸äºéç¨çä¿¡æ¯ï¼æ¯å¦æä»¶çé­æ°ï¼magic numberï¼ï¼æä»¶çæ¬å·ç­ã\n   * Constant Poolï¼å¸¸éæ± ï¼ï¼ å¸¸éæ± æ¯ä¸ä¸ªéè¦çæ°æ®ç»æï¼å®å­å¨äºä¸ç³»åå¸¸éï¼åæ¬å­é¢å¼ãç¬¦å·å¼ç¨ãç±»åæ¥å£çåç§°ç­ãå¸¸éæ± å¨å­èç æä»¶ä¸­èµ·å°äºå­å¨åç®¡çå¸¸éæ°æ®çä½ç¨ã\n   * Interfacesï¼æ¥å£ï¼ï¼ è¿é¨åå®ä¹äºè¯¥ç±»å®ç°çæ¥å£ã\n   * Fieldsï¼å­æ®µï¼ï¼ è¿é¨åæè¿°äºç±»çå­æ®µï¼æååéï¼ï¼åæ¬å­æ®µçåç§°ãç±»åä»¥åä¿®é¥°ç¬¦ç­ä¿¡æ¯ã\n   * Methodsï¼æ¹æ³ï¼ï¼ è¿é¨åæè¿°äºç±»çæ¹æ³ï¼åæ¬æ¹æ³çåç§°ãåæ°åè¡¨ãè¿åç±»åãå­èç æä»¤ç­ã\n   * Attributesï¼å±æ§ï¼ï¼ å±æ§æä¾äºå³äºç±»ãå­æ®µææ¹æ³çå¶ä»ä¿¡æ¯ï¼ä¾å¦æºä»£ç è¡å·ãæ³¨è§£ç­ãè¿ä¸ªé¨åå¯ä»¥åå«å¤ä¸ªä¸åç±»åçå±æ§ï¼æ¯ä¸ªå±æ§é½æä¸ä¸ªåç§°åç¸åºçæ°æ®ã\n\nå¦ä¸å¾ç¤ºï¼\n\n\n\n * magicï¼é­æ°ï¼æ¯ä¸ä¸ªåºå®çå­èåºåï¼ç¨äºæ è¯ Java å­èç æä»¶ãå®çå¼ä¸º 0xCAFEBABEï¼ç¨äºç¡®å®æä»¶æ¯å¦æ¯ææç Java å­èç æä»¶ã\n * minor versionï¼æ¬¡çæ¬å·ï¼æç¤º Java ç¼è¯å¨çæ¬çæ¬¡è¦æ´æ°ãç¨äºæè¿°å­èç æä»¶ä¸Javaèææºçæ¬çå¼å®¹æ§ã\n * major versionï¼ä¸»çæ¬å·ï¼æç¤º Java ç¼è¯å¨çæ¬çä¸»è¦æ´æ°ãåæ ·ç¨äºæè¿°å­èç æä»¶ä¸ Java èææºçæ¬çå¼å®¹æ§ã\n * constant_pool_countï¼å¸¸éæ± è®¡æ°ï¼è¡¨ç¤ºå¸¸éæ± ä¸­å¸¸éçæ°éãåå­è¿å¶ 0010 è½¬åä¸ºåè¿å¶ä¸º 16ãå¸¸éæ± çæ­£å­å¨åå®¹çæ¶åå­äº 16 -1 é¡¹ãåé¢çåå®¹é½æ¯å¼ç¨å®ã\n * #1:ï¼å¸¸éæ± é¡¹ï¼éå¸¸ä»¥ # å¼å¤´ï¼è¡¨ç¤ºä¸ä¸ªå¸¸éæ± ä¸­çåä¸ªé¡¹ã\n * access flagsï¼è®¿é®æ å¿ï¼æè¿°ç±»ææ¥å£çè®¿é®çº§å«åç¹æ§ã\n * this_classï¼å½åç±»çç´¢å¼ï¼æç¤ºå½åç±»å¨å¸¸éæ± ä¸­çä½ç½®ã\n * super classï¼ç¶ç±»çç´¢å¼ï¼æç¤ºç¶ç±»å¨å¸¸éæ± ä¸­çä½ç½®ã\n * interface_countï¼æ¥å£æ°éï¼è¡¨ç¤ºè¯¥ç±»å®ç°çæ¥å£æ°éã\n * interfacesï¼æ¥å£åè¡¨ï¼æè¿°è¯¥ç±»å®ç°çæ¥å£å¨å¸¸éæ± ä¸­çä½ç½®ã\n * fields_countï¼å­æ®µæ°éï¼è¡¨ç¤ºè¯¥ç±»ä¸­å£°æçå­æ®µæ°éã\n * methods_countï¼æ¹æ³æ°éï¼è¡¨ç¤ºè¯¥ç±»ä¸­å£°æçæ¹æ³æ°éã\n * method_infoï¼æ¹æ³ä¿¡æ¯ï¼æè¿°æ¹æ³çè®¿é®æ å¿ãæ¹æ³åãåæ°åè¡¨ç­ã\n * attribute_countï¼å±æ§æ°éï¼è¡¨ç¤ºè¯¥ç±»çå±æ§æ°éã\n\næ¯ä¸ªé¨åæè¿°äº Java å­èç æä»¶çä¸åæ¹é¢ï¼ä»ç±»çå£°æå°æ¹æ³çå®ä¹ï¼ä»¥åä¸å¸¸éæ± ç­ç¸å³çä¿¡æ¯ãè¿äºä¿¡æ¯å¨ Java èææºä¸­è¢«è§£æåä½¿ç¨ï¼ä»¥æ­£ç¡®å°å è½½åæ§è¡ Java ç±»ã\n\n> Java çæ±ç¼æä»¤æ 200 å¤æ¡ã\n> \n> å¥½æåäº«ï¼classç±»æä»¶ç»æ\n\n\n# ç±»å è½½ - åå§å\n\n\n# å è½½è¿ç¨\n\nå è½½ãé¾æ¥ååå§åæ¯ Java ç¨åºè¿è¡æ¶çä¸ä¸ªä¸»è¦é¶æ®µã\n\n 1. Loading -- å è½½\n\n 2. Linking -- é¾æ¥\n    \n    * Verification -- éªè¯\n    * Preparation -- åå¤\n    * Resolution -- è§£æ\n\n 3. Initializing -- åå§å\n\nå·ä½æ¥è¯´ï¼\n\n 1. Loadingï¼å è½½ï¼ï¼ è¿æ¯ç±»å è½½è¿ç¨çç¬¬ä¸ä¸ªé¶æ®µãå¨è¿ä¸ªé¶æ®µï¼Java èææºï¼JVMï¼ä¼ä»ç±»çå¤é¨æºå è½½ç±»çäºè¿å¶æ°æ®ï¼éå¸¸æ¯ä»ç£çæä»¶ä¸­å è½½ï¼ä½ä¹å¯ä»¥æ¯ç½ç»ãåå­ç­ã\n    \n    å è½½å¨å°ç±»çäºè¿å¶æ°æ®ï¼classæä»¶ï¼ä»å¤é¨æºå è½½å°åå­ä¸­ï¼å¹¶å°å¶æ¾ç½®å¨è¿è¡æ¶æ°æ®åºçæ¹æ³åºåã\n\n 2. Linkingï¼é¾æ¥ï¼ï¼ è¿æ¯å è½½è¿ç¨çç¬¬äºä¸ªé¶æ®µï¼å®å°ç±»çäºè¿å¶æ°æ®é¾æ¥å° JVM çè¿è¡æ¶ç¶æã\n    \n    é¾æ¥è¿ç¨åä¸ºä»¥ä¸ä¸ä¸ªæ­¥éª¤ï¼\n    \n    * Verificationï¼éªè¯ï¼ï¼ç¡®ä¿ç±»çäºè¿å¶æ°æ®ç¬¦å JVM è§èï¼ä¸è¿åç±»å è½½çå®å¨æ§è¦æ±ãè¿ä¸ªæ­¥éª¤ç¡®ä¿ç±»çç»ææ­£ç¡®ï¼ä¸ä¼å¼åè¿è¡æ¶éè¯¯ã\n    * Preparationï¼åå¤ï¼ï¼ä¸ºç±»çéæåéåéåå­ç©ºé´ï¼å¹¶è®¾ç½®é»è®¤çåå§å¼ï¼éå¸¸ä¸ºé¶å¼ï¼ãè¿ä¸ªæ­¥éª¤ä¸ºç±»åéåéåå­å¹¶åå§åï¼ä½ä¸ä¼ä¸ºå®ä¾åéåéåå­ãï¼æ class æä»¶çéæåéèµé»è®¤å¼ï¼æ¯å¦ int ç±»åçé»è®¤å¼ä¸º 0ï¼\n    * Resolutionï¼è§£æï¼ï¼å°ï¼classæä»¶éé¢çå¸¸éæ± éé¢ç¨å°çï¼ç¬¦å·å¼ç¨è½¬æ¢ä¸ºç´æ¥å¼ç¨ï¼è§£æå¨ä½å¯ä»¥å¨è¿è¡æ¶åå®æï¼ä¹å¯ä»¥å¨ç¼è¯æ¶éæå®æãè¿ä¸ªæ­¥éª¤å¤çç±»ãæ¥å£ãæ¹æ³åå­æ®µçç¬¦å·å¼ç¨ï¼å°å¶è§£æä¸ºå®éçå¼ç¨ã\n\n 3. Initializingï¼åå§åï¼ï¼ è¿æ¯é¾æ¥è¿ç¨çæåä¸ä¸ªé¶æ®µï¼ä¹æ¯ç±»å è½½çæç»é¶æ®µãå¨è¿ä¸ªé¶æ®µï¼ç±»çéæåå§åå¨ä¼è¢«æ§è¡ï¼åå§åéæå­æ®µåæ§è¡éæåãè¿ä¸ªé¶æ®µæ¯å¨ç±»è¢«é¦æ¬¡ä½¿ç¨æ¶è§¦åçï¼ä¾å¦åå»ºç±»çå®ä¾ãè®¿é®ç±»çéæå­æ®µç­ãï¼è°ç¨ç±»åå§åä»£ç  <clinit>ï¼ç»éææååéèµåå§å¼ï¼\n\næ»ç»æ¥è¯´ï¼ç±»å è½½è¿ç¨æ¶åå°ä»å¤é¨æºå è½½ç±»çäºè¿å¶æ°æ®ï¼ç¶åå°å¶é¾æ¥å° JVM çè¿è¡æ¶ç¶æï¼æç»è¿è¡åå§åãé¾æ¥é¶æ®µåæ¬éªè¯ãåå¤åè§£æï¼èåå§åé¶æ®µåä¼æ§è¡ç±»çéæåå§åå¨ãè¿ä¸ªè¿ç¨ç¡®ä¿ç±»å¨ Java èææºä¸­æ­£ç¡®å è½½åä½¿ç¨ã\n\nå è½½ä¹åä¼åçä»ä¹ï¼\n\nä»»ä½ä¸ä¸ª class è¢«å è½½å°åå­ä¹åï¼ä¼çæäºä¸¤ååå®¹ã\n\n * ç¬¬ä¸ååå®¹æ¯è¿ä¸ªäºè¿å¶çï¼è¿åä¸è¥¿ç¡®å®è¢«è½å°åå­ï¼æ¾å°äºåå­çä¸ååºåï¼å¯ä»¥åå°ä¸å¨çæè¿å»ã\n * ç¬¬äºä¸ªï¼å®çæäºä¸ä¸ª class ç±»çå¯¹è±¡ï¼éè¿ä»¥åå¶ä»çé£äºæä»¬èªå·±åçå¯¹è±¡å»è®¿é®è¿ä¸ªå¯¹è±¡ï¼éè¿è¿ä¸ªå¯¹è±¡å»è®¿é® class ç±»çæä»¶ï¼æä»¥çæä¸ä¸ª class çå¯¹è±¡ï¼è¿ä¸ª class å¯¹è±¡æ¯æåäºè¿ååå®¹ã\n\nå¨ Java èææºä¸­ï¼ç±»çåæ°æ®ï¼åæ¬ç±»çç»æä¿¡æ¯ãå­æ®µãæ¹æ³ãç¶ç±»ãæ¥å£ç­ï¼é½ä¼è¢«å è½½å°æ¹æ³åºï¼åç©ºé´Metaspaceï¼æ¿ä»£äºæ°¸ä¹ä»£PermGenï¼ä¸­ãClass å¯¹è±¡æ¬èº«ä¹æ¯ç±»çåæ°æ®ä¹ä¸ï¼å æ­¤ Class å¯¹è±¡ä¹å­æ¾å¨æ¹æ³åºä¸­ã Class å¯¹è±¡å¨åå­ä¸­çä½ç½®å¯ä»¥çä½æ¯ç±»çæè¿°ç¬¦ï¼ç¨æ¥æä½è¯¥ç±»çå­èç ä»¥åå¶ä»ç¸å³çåæ°æ®ã\n\nå¯ä»¥ççä¸é¢è¿ä¸¤ç¯æç« ï¼\n\n * æ¹æ³åºä¸Metaspace\n * Java8åæ¶permgenï¼ä½¿ç¨mataspaceæä»ä¹å¥½å¤ï¼åå­ç»ææä»ä¹æ¬è´¨çååï¼\n\n\n# ç±»å è½½å¨\n\nJVM å®æ¬èº«æä¸ä¸ªç±»å è½½å¨çå±æ¬¡ï¼è¿ä¸ªç±»å è½½å¨å°±æ¯ä¸ä¸ªæ®éç classï¼JVM æä¸ä¸ªç±»å è½½å¨çå±æ¬¡ï¼åå«æ¥å è½½ä¸åç classãæèè¯´ï¼JVM éé¢ææç class é½æ¯è¢«ç±»å è½½å¨ç»å è½½å°åå­çï¼é£ä¹è¿ä¸ªç±»å è½½å¨ç®åè¯´æä»¬å¯ä»¥æå®å«å ClassLoaderã\n\n\n\næ³¨æï¼ä»ä¸å¾ä¸ï¼æ¯å§æç»ç¶å è½½å¨ï¼ä¸æ¯ç»§æ¿å³ç³»ï¼æ¯è¯­æ³ä¸çä¸ç§å³ç³»ã\n\nå¨ Java èææºä¸­ï¼ç±»å è½½å¨æç§å±æ¬¡ç»æè¿è¡ç»ç»ï¼åä¸ºä¸ä¸ªä¸»è¦å±æ¬¡ï¼å¯å¨ç±»å è½½å¨ï¼Bootstrap ClassLoaderï¼ãæ©å±ç±»å è½½å¨ï¼Extension ClassLoaderï¼ååºç¨ç¨åºç±»å è½½å¨ï¼Application ClassLoaderï¼ä¹ç§°ä¸ºç³»ç»ç±»å è½½å¨ï¼ãè¿äºç±»å è½½å¨å½¢æäºç±»å è½½å¨çåäº²å§æ´¾æ¨¡åã\n\n 1. å¯å¨ç±»å è½½å¨ï¼Bootstrap ClassLoaderï¼ï¼è¿æ¯ Java èææºçä¸é¨åï¼ç¨äºå è½½ Java æ ¸å¿åºï¼ä¾å¦ java.lang åä¸­çç±»ï¼ãå®æ¯ææå¶ä»ç±»å è½½å¨çç¶å è½½å¨ï¼ä½å®æ¬èº«ä¸æ¯ä¸ä¸ªæ®éç Java ç±»ï¼å æ­¤å¨æºç ä¸­å¹¶æ²¡æå¯¹åºçç±»ãå®ä½äºèææºåé¨ï¼éå¸¸ç¨æ¬å°ä»£ç å®ç°ãå®æ¯æé¡¶å±çç±»å è½½å¨ï¼è´è´£å è½½ Java æ ¸å¿ç±»åºã\n 2. æ©å±ç±»å è½½å¨ï¼Extension ClassLoaderï¼ï¼ æ©å±ç±»å è½½å¨ç¨äºå è½½ Java èææºçæ©å±ç±»åºï¼ä½äº jre/lib/ext ç®å½ä¸­çç±»ãå®çç¶å è½½å¨æ¯å¯å¨ç±»å è½½å¨ã\n 3. åºç¨ç¨åºç±»å è½½å¨ï¼Application ClassLoaderï¼ï¼è¿ä¸ªå è½½å¨ä¹ç§°ä¸ºç³»ç»ç±»å è½½å¨ï¼å®è´è´£å è½½åºç¨ç¨åºçç±»ï¼åæ¬ç¨æ·èªå®ä¹çç±»åç¬¬ä¸æ¹åºä¸­çç±»ãå®çç¶å è½½å¨æ¯æ©å±ç±»å è½½å¨ã\n\nå¯å¨ç±»å è½½å¨ãæ©å±ç±»å è½½å¨ååºç¨ç¨åºç±»å è½½å¨ææäºç±»å è½½å¨çå±æ¬¡ç»æï¼éè¿åäº²å§æ´¾æ¨¡åæ¥ä¿è¯ç±»çå è½½çä¸è´æ§åå®å¨æ§ãå¨å è½½ä¸ä¸ªç±»æ¶ï¼é¦åä¼å°è¯ç±ç¶å è½½å¨å è½½ï¼åªæå¨ç¶å è½½å¨æ æ³å è½½æ¶ï¼å­å è½½å¨æä¼å°è¯å è½½ãè¿ä¸ªæ¨¡åå¯ä»¥é²æ­¢ç±»çéå¤å è½½ï¼åæ¶ä¿è¯äºç±»çéç¦»æ§ã\n\nå¨å¯å¨ç±»å è½½å¨å è½½çç±»ä¸­ï¼æä¸é¨åæ¯èææºåé¨çç±»ï¼æ¯å¦ java.lang.Objectãjava.lang.String ç­ãè¿äºç±»å¹¶ä¸æ¯æ®éç Java ç±»ï¼å æ­¤æ²¡æå¯¹åºçæºç ãèå¨ Java èææºçæºç ä¸­ï¼éå¸¸ä¼å¯¹è¿äºç±»çå è½½è¿ç¨è¿è¡æè¿°ï¼ä½å®éä¸å®ä»¬æ¯ç±èææºçå®ç°æä¾çã\n\næé¡¶å±å è½½å¨ Bootstrap ä¼è¿åä¸ä¸ªç©ºå¼ã\n\npublic class T004_ParentAndChild {\n    public static void main(String[] args) {\n        System.out.println(T004_ParentAndChild.class.getClassLoader());\n        System.out.println(T004_ParentAndChild.class.getClassLoader().getClass().getClassLoader()); // App\n        System.out.println(T004_ParentAndChild.class.getClassLoader().getParent()); // Extension\n        System.out.println(T004_ParentAndChild.class.getClassLoader().getParent().getParent()); // Bootstrapï¼è¿å null\n        // System.out.println(T004_ParentAndChild.class.getClassLoader().getParent().getParent().getParent()); // è§£å¼æ³¨éå°±ä¼æ¥ç©ºæéå¼å¸¸\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nè¾åºç»æï¼\n\nsun.misc.Launcher$AppClassLoader@18b4aac2\nnull\nsun.misc.Launcher$ExtClassLoader@4554617c\nnull\n\n\n1\n2\n3\n4\n\n\n\n# åäº²å§æ´¾\n\n 1. ç¶å è½½å¨\n    * ç¶å è½½å¨ä¸æ¯ãç±»å è½½å¨çå è½½å¨ãï¼ï¼ï¼ä¹ä¸æ¯ãç±»å è½½å¨çç¶ç±»å è½½å¨ã\n 2. åäº²å§æ´¾æ¯ä¸ä¸ªå­©å­åç¶äº²æ¹åï¼ç¶åç¶äº²åå­©å­æ¹åçåäº²å§æ´¾è¿ç¨\n 3. æèï¼ä¸ºä»ä¹è¦æåäº²å§æ´¾ï¼\n    * java.lang.String ç±»ç±èªå®ä¹ç±»å è½½å¨å è½½è¡ä¸è¡ï¼ -- ä¸è¡ï¼å ä¸ºä¸å®å¨\n\nåæ¯èªåºåä¸æ£æ¥æ¯å¦å·²ç»å è½½ï¼ç¶åååè¿å¤´æ¥æ¾ class å¹¶å è½½ï¼æ¥çæ¯å¦å è½½æåï¼ä¸ç´å°åºé½æ²¡å è½½æåå°±ä¼æåºä¸ä¸ª class æ¾ä¸å°å¼å¸¸ã\n\n\n\nè¿ä¸ªç¼å­æ¯å¨åªç¼å­ï¼\n\nå¯ä»¥ç®åçè®¤ä¸ºæ¯å®èªå·±åé¨ç»´æ¤çä¸ä¸ªå®¹å¨ï¼ä¸ä¸ª list æèä¸ä¸ªæ°ç»å è½½çä¸è¥¿é½æå¨éé¢ãæ¯ä¸ªå è½½å¨é½æèªå·±çç¼å­ã\n\n# ä¸ºä»ä¹ç±»å è½½å¨è¦ä½¿ç¨åäº²å§æ´¾ï¼ï¼éè¦ï¼\n\nä¸»è¦æ¯ä¸ºäºå®å¨ãæ¬¡è¦åå æ¯èµæºæµªè´¹é®é¢ï¼é¿åéæ°å è½½é®é¢ï¼é²æ­¢ç±»éå¤å è½½ï¼ã\n\n\n# ç±»å è½½å¨èå´\n\næ¥èª Launcher æºç \n\n 1. å¯å¨ç±»å è½½å¨ Bootstrap ClassLoaderï¼\n    * å è½½è·¯å¾ï¼sun.boot.class.path\n    * èå´ï¼å®è´è´£å è½½ Java æ ¸å¿ç±»åºï¼è¿äºç±»åºåæ¬ Java API ä¸­çåºç¡ç±»ï¼å¦ java.lang åä¸çç±»ç­ã\n    * ä½ç¨ï¼å®æ¯ Java ç±»å è½½å¨ä¸­æé¡¶å±çç±»å è½½å¨ï¼è´è´£å è½½èææºèªèº«éè¦çç±»ï¼ä»¥åå¨è¿è¡æé´ä¼è¢«ç³»ç»ä½¿ç¨çç±»ãç±äº Bootstrap ClassLoader æ¯ç¨æ¬å°ä»£ç æ¥å®ç°çï¼æä»¥å¨ Java ä¸­æ æ³ç´æ¥è·åå°è¯¥ç±»å è½½å¨çå¼ç¨ã\n 2. æ©å±ç±»å è½½å¨ ExtensionClassLoaderï¼\n    * å è½½è·¯å¾ï¼java.ext.dirs\n    * èå´ï¼å®è´è´£å è½½ Java çæ©å±åºï¼è¿äºåºä½äº JRE ç lib/ext ç®å½æèç±ç³»ç»åé java.ext.dirs æå®çè·¯å¾ã\n    * ä½ç¨ï¼å®è´è´£å è½½ä¸äº Java æ åæ©å±åºä»¥åä¸äºèªå®ä¹çæ©å±åºï¼è¿äºåºéå¸¸æ¯ä¸äºå¯éçåè½ãæ©å±ç±»å è½½å¨æ¯ç± sun.misc.Launcher$ExtClassLoader å®ç°çã\n 3. ç³»ç»ç±»å è½½å¨ AppClassLoaderï¼\n    * å è½½è·¯å¾ï¼java.class.path\n    * èå´ï¼ä¹è¢«ç§°ä¸ºç³»ç»ç±»å è½½å¨ï¼å®è´è´£å è½½ç¨æ·ç±»è·¯å¾ï¼Classpathï¼ä¸æå®çç±»ã\n    * ä½ç¨ï¼å®è´è´£å è½½åºç¨ç¨åºä¸­çç±»ï¼åæ¬å¼åèèªå·±ç¼åçç±»ä»¥åå¼ç¨çç¬¬ä¸æ¹ç±»åºãåºç¨ç±»å è½½å¨æ¯ç± sun.misc.Launcher$AppClassLoader å®ç°çã\n\nä»£ç æ¥çï¼\n\npublic class T003_ClassLoaderScope {\n    public static void main(String[] args) {\n        System.out.println("æ ¹ç®å½ä¸å è½½");\n        String pathBoot = System.getProperty("sun.boot.class.path");\n        System.out.println(pathBoot.replaceAll(";", System.lineSeparator()));\n\n        System.out.println("--------------------");\n        System.out.println("ext ä¸å è½½");\n        String pathExt = System.getProperty("java.ext.dirs");\n        System.out.println(pathExt.replaceAll(";", System.lineSeparator()));\n\n        System.out.println("--------------------");\n        System.out.println("App ä¸å è½½");\n        String pathApp = System.getProperty("java.class.path");\n        System.out.println(pathApp.replaceAll(";", System.lineSeparator()));\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nè¾åºç»æï¼\n\næ ¹ç®å½ä¸å è½½\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\resources.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\rt.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\sunrsasign.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\jsse.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\jce.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\charsets.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\jfr.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\classes\n--------------------\next ä¸å è½½\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\ext\nC:\\WINDOWS\\Sun\\Java\\lib\\ext\n--------------------\nApp ä¸å è½½\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\charsets.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\deploy.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\ext\\access-bridge-64.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\ext\\cldrdata.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\ext\\dnsns.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\ext\\jaccess.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\ext\\jfxrt.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\ext\\localedata.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\ext\\nashorn.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\ext\\sunec.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\ext\\sunjce_provider.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\ext\\sunmscapi.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\ext\\sunpkcs11.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\ext\\zipfs.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\javaws.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\jce.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\jfr.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\jfxswt.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\jsse.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\management-agent.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\plugin.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\resources.jar\nC:\\Program Files\\Java\\jdk1.8.0_321\\jre\\lib\\rt.jar\nD:\\ç¬è®°\\å­¦ä¹ èµæ\\é©¬å£«åµ\\JVMè§é¢æºç \\out\\production\\JVM\t\t\t\t// é¡¹ç®è·¯å¾\nD:\\software\\idea2022\\IntelliJ IDEA 2022.1.3\\lib\\idea_rt.jar\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n\n\n\n# èªå®ä¹ç±»å è½½å¨\n\nå½ä½ æ³å è½½æä¸ªç±»çæ¶åï¼å¯ä»¥è°ç¨ loadClass æ¹æ³\n\npublic class T005_LoadClassByHand {\n    public static void main(String[] args) throws ClassNotFoundException {\n        Class clazz = T005_LoadClassByHand.class.getClassLoader().loadClass("com.mashibing.jvm.c2_classloader.T002_ClassLoaderLevel");\n        System.out.println(clazz.getName());\n\n        //å©ç¨ç±»å è½½å¨å è½½èµæºï¼åèå¦åå¾ççå è½½\n        //T005_LoadClassByHand.class.getClassLoader().getResourceAsStream("");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# loadClass æºç è§£æ\n\nloadClass æ¹æ³æ¯å¨åäº²å§æ´¾æ¨¡åä¸å®ç°çã\n\nfindInCache -> parent.loadClass -> findClass()\n\nprivate final ClassLoader parent; // final å³é®å­ä¿®é¥°\n\nprotected Class<?> loadClass(String name, boolean resolve) throws ClassNotFoundException\n    {\n        synchronized (getClassLoadingLock(name)) {\n            // é¦åï¼æ£æ¥ç±»æ¯å¦å·²ç»å è½½\n            Class<?> c = findLoadedClass(name);\n            if (c == null) {\n                long t0 = System.nanoTime();\n                try {\n                    // å¦æç±»ä¸å¨å·²å è½½ç±»ä¸­ï¼åå§æ´¾ç»ç¶ç±»å è½½å¨å è½½\n                    if (parent != null) {\n                        c = parent.loadClass(name, false);\n                    } else {\n                        // å¦ææ²¡æç¶å è½½å¨ï¼åä½¿ç¨ç³»ç»ç±»å è½½å¨å è½½\n                        c = findBootstrapClassOrNull(name);\n                    }\n                } catch (ClassNotFoundException e) {\n                    // å¦ææ¾ä¸å°ç±»ï¼æåºClassNotFoundException\n                    // ä»éç©ºç¶ç±»è£å¥å¨\n                }\n              \n\t\t\t\t\t\t\t // å¦æç¶å è½½å¨ä¹æ¾ä¸å°ï¼åå°è¯èªå·±å è½½\n                if (c == null) {\n                    // å¦æä»æªæ¾å°ï¼åæé¡ºåºè°ç¨ findClass\n                    // to find the class. è¦æ¾å°è¿ä¸ªç±»\n                    long t1 = System.nanoTime();\n                    c = findClass(name);\n\n                    // è¿æ¯å®ä¹ç±»è£å¥å¨ï¼è®°å½ç»è®¡æ°æ®\n                    sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);\n                    sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);\n                    sun.misc.PerfCounter.getFindClasses().increment();\n                }\n            }\n            if (resolve) {\n                resolveClass(c);\n            }\n            return c;\n        }\n    }\n\n    protected Class<?> findClass(String name) throws ClassNotFoundException { // findClassè¢«protectedä¿®é¥°ï¼ä¿æ¤èµ·æ¥\n        throw new ClassNotFoundException(name);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n\n\nä¸»è¦æ­¥éª¤å¦ä¸ï¼\n\n 1. é¦åï¼æ¹æ³ä¼å°è¯ä»å·²å è½½çç±»ä¸­æ¥æ¾ç®æ ç±»æ¯å¦å·²ç»å è½½ï¼å¦æå·²ç»å è½½ï¼åç´æ¥è¿åè¯¥ç±»ã\n 2. å¦æç®æ ç±»æªå è½½ï¼å®ä¼å°è¯å§æ´¾ç»ç¶ç±»å è½½å¨æ¥å è½½ãè¿æ¯åäº²å§æ´¾æ¨¡åçæ ¸å¿ææ³ä¹ä¸ãç¶ç±»å è½½å¨ä¼éå¤è¿ä¸ªè¿ç¨ï¼ç´å°å°è¾¾å¯å¨ç±»å è½½å¨ï¼Bootstrap ClassLoaderï¼ä¸ºæ­¢ã\n 3. å¦æç¶ç±»å è½½å¨ä¹æ æ³å è½½ç®æ ç±»ï¼å loadClass æ¹æ³ä¼è°ç¨ findClass æ¹æ³ï¼å°è¯èªå·±å è½½ç®æ ç±»ãè¿æ¯å­ç±»å è½½å¨å¨å è½½èªå·±ç±»çæåä¸æ­¥ã\n 4. æåï¼å¦æ resolve åæ°ä¸º trueï¼åä¼è°ç¨ resolveClass æ¹æ³ï¼ç¨äºè§£æå è½½çç±»ï¼ç¡®ä¿ç±»çå®æ´æ§åæ­£ç¡®æ§ã\n\nä»ä¹æ¶åéè¦èªå·±å»å è½½ï¼\n\nå è½½è¿å»å°±çæ class å¯¹è±¡åï¼\n\nä¸æ¯ï¼è¦ç»è¿ åå§å æçæ class å¯¹è±¡ã\n\n# èªå®ä¹ä¸ä¸ªç±»å è½½å¨éè¦åä»ä¹ï¼\n\nåªéè¦åä¸ä»¶äºï¼å°±æ¯å®ä¹èªå·±ç findClass å°±å¯ä»¥äºã\n\nå·ä½æ¥è¯´ï¼\n\n * ç»§æ¿ ClassLoader\n\n * éåæ¨¡æ¿æ¹æ³ findClass\n   \n   * è°ç¨ defineClass(byte[] -> Class clazz)\n\n * å å¯ï¼å¯èªå®ä¹ç±»å è½½å¨å è½½èªå å¯ç class\n   \n   * é²æ­¢åç¼è¯\n   * é²æ­¢ç¯¡æ¹\n\nä»£ç å¦ä¸ï¼\n\né¦åç»§æ¿ ClassLoader è¿ä¸ªç±»\n\n// èªå®ä¹ç±»å è½½å¨ç»§æ¿èªClassLoader\npublic class T006_MSBClassLoader extends ClassLoader {\n\n    // éåfindClassæ¹æ³ï¼ç¨äºå è½½ç±»å­èç \n    @Override\n    protected Class<?> findClass(String name) throws ClassNotFoundException {\n        // æ ¹æ®ç±»åæå»ºæä»¶è·¯å¾\n        File f = new File("c:/test/", name.replace(".", "/").concat(".class"));\n        try {\n            // è¯»åå­èç æä»¶\n            FileInputStream fis = new FileInputStream(f);\n            ByteArrayOutputStream baos = new ByteArrayOutputStream();\n            int b = 0;\n\n            // è¯»åæä»¶åå®¹å¹¶åå¥å­èæ°ç»è¾åºæµ\n            while ((b=fis.read()) !=0) {\n                baos.write(b);\n            }\n\n            // å°å­èæ°ç»è½¬æ¢ä¸ºå­èæ°ç»\n            byte[] bytes = baos.toByteArray();\n            baos.close();\n            fis.close(); // å³é­æµ\n\n            // ä½¿ç¨defineClassæ¹æ³å®ä¹å¹¶è¿åç±»\n            return defineClass(name, bytes, 0, bytes.length);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        // è¥å è½½å¤±è´¥ï¼åè°ç¨ç¶ç±»çfindClassæ¹æ³\n        return super.findClass(name); // throws ClassNotFoundException\n    }\n\n    // ä¸»å½æ°\n    public static void main(String[] args) throws Exception {\n        // åå»ºèªå®ä¹ç±»å è½½å¨å®ä¾\n        ClassLoader l = new T006_MSBClassLoader();\n        \n        // éè¿èªå®ä¹ç±»å è½½å¨å è½½ç±»\n        Class clazz = l.loadClass("com.mashibing.jvm.Hello");\n        Class clazz1 = l.loadClass("com.mashibing.jvm.Hello");\n\n        // è¾åºä¸¤æ¬¡å è½½çç±»æ¯å¦ç¸å\n        System.out.println(clazz == clazz1);\n\n        // åå»ºå è½½çç±»çå®ä¾å¹¶è°ç¨æ¹æ³\n        Hello h = (Hello) clazz.newInstance();\n        h.m();\n\n        // è¾åºç±»å è½½å¨ä¿¡æ¯\n        System.out.println(l.getClass().getClassLoader()); // è¾åºèªå®ä¹ç±»å è½½å¨çç±»å è½½å¨\n        System.out.println(l.getParent()); // è¾åºèªå®ä¹ç±»å è½½å¨çç¶ç±»å è½½å¨\n\n        System.out.println(getSystemClassLoader()); // è¾åºç³»ç»ç±»å è½½å¨\n    }\n}\n\npublic class Hello {\n    public void m() {\n        System.out.println("Hello JVM!");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n\n\nè¿æ®µä»£ç å®ç°äºä¸ä¸ªèªå®ä¹çç±»å è½½å¨ T006_MSBClassLoaderï¼è¯¥ç±»å è½½å¨ç»§æ¿èª ClassLoaderï¼éåäº findClass æ¹æ³æ¥å è½½ç±»çå­èç ãå¨ä¸»å½æ°ä¸­ï¼ä½¿ç¨è¿ä¸ªèªå®ä¹çç±»å è½½å¨å è½½ç±»ï¼å¹¶è¾åºå è½½çç±»æ¯å¦ç¸åï¼ç¶ååå»ºè¯¥ç±»çå®ä¾å¹¶è°ç¨æ¹æ³ãæåï¼è¾åºäºèªå®ä¹ç±»å è½½å¨çç±»å è½½å¨åç¶ç±»å è½½å¨ä¿¡æ¯ï¼ä»¥åç³»ç»ç±»å è½½å¨çä¿¡æ¯ãè¿ç§èªå®ä¹ç±»å è½½å¨çæ¹å¼åè®¸ä½ ä»éæ åçä½ç½®å è½½ç±»æä»¶ï¼å¹¶ä¸å¯ä»¥éè¿ä¸åçç±»å è½½å¨å®ç°ç±»çéç¦»ã\n\n----------------------------------------\n\ndefineClass æ¹æ³æ¯ ClassLoader ç±»ä¸­çä¸ä¸ªéè¦æ¹æ³ï¼ç¨äºå°å­èæ°ç»è½¬æ¢ä¸ºä¸ä¸ª Class å¯¹è±¡ãè¯¥æ¹æ³çä½ç¨æ¯å°ä¸ä¸ªãå­èæ°ç»ä¸­çç±»å­èç ãè½¬æ¢ä¸ºä¸ä¸ªãJava ç±»çå®ä¾ããå½ä¸ä¸ªç±»å è½½å¨è°ç¨ defineClass æ¹æ³æ¶ï¼å®ä¼å°å­èæ°ç»ä¸­çç±»å­èç è½¬æ¢ä¸ºä¸ä¸ª Class å¯¹è±¡ï¼å¹¶è¿åè¯¥å¯¹è±¡ã(ä¸ä¼éªè¯å­èç çæ­£ç¡®æ§)\n\n> è¾åºç»æ\n\ntrue\nHello JVM!\nsun.misc.Launcher$AppClassLoader@18b4aac2\nsun.misc.Launcher$AppClassLoader@18b4aac2\nsun.misc.Launcher$AppClassLoader@18b4aac2\n\n\n1\n2\n3\n4\n5\n\n\n# å å¯\n\nå¤§å®¶é½ç¥é java çä»£ç  class æä»¶å¾å®¹æå°±è¢«åç¼è¯äºã\n\nä½æ¯æè¦æ¯å®ä¹èªå·±çæ ¼å¼ï¼æä¸æ³è®©å«äººåç¼è¯ï¼è¿æ¶åæä¹åï¼\n\nä½ å¯ä»¥éè¿èªå®ä¹ç class loader æ¥è¿è¡ãç¶åå¨åé»è¾çæ¶åå ä¸ä¸ªå å¯æä½ã\n\n\n# ç¼è¯å¨\n\nä¸å¤§æ¨¡å¼ï¼\n\n * è§£éå¨ï¼bytecode intepreterï¼ -- è§£éæ¨¡å¼\n * JITï¼Just In-Time compilerï¼ -- ç¼è¯æ¨¡å¼\n * æ··åæ¨¡å¼\n   * æ··åä½¿ç¨è§£éå¨ + ç­ç¹ä»£ç ç¼è¯ï¼ç¼è¯ææ¬å°ä»£ç ï¼å°±ä¸ç¨å¨è§£éå¨éé¢è§£éæ¥æ§è¡äºï¼æçæåï¼\n   * èµ·å§é¶æ®µéç¨è§£éæ§è¡\n   * ç­ç¹ä»£ç æ£æµ\n     * å¤æ¬¡è¢«è°ç¨çæ¹æ³(æ¹æ³è®¡æ°å¨:çæµæ¹æ³æ§è¡é¢ç)\n     * å¤æ¬¡è¢«è°ç¨çå¾ªç¯(å¾ªç¯è®¡æ°å¨:æ£æµå¾ªç¯æ§è¡é¢ç)\n     * è¿è¡ç¼è¯\n\nä¸ºä»ä¹ä¸å¹²èç´æ¥ç¼è¯ææ¬å°ä»£ç ï¼é£æ§è¡æçä¸æ´é«åï¼\n\næä¸¤ä¸ªåå ã\n\n 1. ç¬¬ä¸ï¼Java çè§£éå¨ï¼ç°å¨å®çæçä¹å·²ç»éå¸¸é«äºï¼å¨ä¸äºç®åä»£ç çæ§è¡ä¸ï¼å®å¹¶ä¸è¾äºä½ ç¼è¯ææ¬å°ä»£ç ã\n 2. ç¬¬äºï¼å¦æä½ ä¸ä¸ªæ§è¡çæä»¶ç¹å«å¤ï¼åç§åæ ·çç±»åºçæ¶åï¼å¥½å åä¸ª classï¼ä½ ä¸æ¥äºè¯ä¸è¯´åå¨åå­éç¼è¯ä¸éï¼è¿ä¸ªå¯å¨è¿ç¨ä¼é¿å¾åäººãæä»¥å®ç°å¨é»è®¤çæ¨¡å¼æ¯æ··åæ¨¡å¼ã\n\nå¯ä»¥ç¨ææåæ°çæ¹å¼æå®ç¨ä»ä¹æ¨¡å¼\n\n 1. -Xmixed é»è®¤ä¸ºæ··åæ¨¡å¼\n    \n    å¼å§è§£éæ§è¡ï¼å¯å¨éåº¦è¾å¿«ï¼å¯¹ç­ç¹ä»£ç å®è¡æ£æµåç¼è¯\n\n 2. -Xint ä½¿ç¨è§£éæ¨¡å¼ï¼å¯å¨å¾å¿«ï¼æ§è¡ç¨æ¢\n\n 3. -Xcomp ä½¿ç¨çº¯ç¼è¯æ¨¡å¼ï¼æ§è¡å¾å¿«ï¼å¯å¨å¾æ¢ï¼è¦ç¼è¯çç±»å°çæ¶åï¼å¯å¨ä¹ä¼å¾å¿«ï¼\n\n\n# æå è½½\n\nlazyloading\n\n * ä¸¥æ ¼è®²åºè¯¥å« lazylnitializing\n * JVM è§èå¹¶æ²¡æè§å®ä½æ¶å è½½\n * ä½æ¯ä¸¥æ ¼è§å®äºä»ä¹æ¶åå¿é¡»åå§åï¼äºç§æåµ\n   1. ä½¿ç¨ newï¼getstaticï¼putstaticï¼invokestatic æä»¤æ¶ï¼è®¿é® final åéé¤å¤\n   2. java.lang.reflect å¯¹ç±»è¿è¡åå°è°ç¨æ¶\n   3. åå§åå­ç±»çæ¶åï¼ç¶ç±»å¿é¡»é¦ååå§å\n   4. èææºå¯å¨æ¶ï¼è¢«æ§è¡çä¸»ç±»å¿é¡»åå§å\n   5. å¨æè¯­è¨æ¯æ java.lang.invoke.MethodHandle è§£æçç»æä¸º REF_getstatic, REF_putstatic, REF_invokestatic çæ¹æ³å¥ææ¶ï¼è¯¥ç±»å¿é¡»åå§å\n\n\n# æå±ç¥è¯\n\n# åäº²å§æ´¾å¦ä½æç ´ï¼\n\nparent æ¯å¦ä½æå®çï¼æç ´åäº²å§æ´¾\n\n 1. ç¨ super(parent) æå®\n 2. åäº²å§æ´¾çæç ´\n    1. å¦ä½æç ´ï¼éå loadClass() æ¹æ³\n    2. ä½æ¶æç ´è¿ï¼\n       1. JDK1.2 ä¹åï¼èªå®ä¹ ClassLoader é½å¿é¡»éå loadClass()\n       2. ThreadContextClassLoader å¯ä»¥å®ç°åºç¡ç±»è°ç¨å®ç°ç±»ä»£ç ï¼éè¿ thread.setContextClassLoader æå®\n       3. ç­å¯å¨ï¼ç­é¨ç½²\n          * osgi tomcat é½æèªå·±çæ¨¡åæå® classloaderï¼å¯ä»¥å è½½åä¸ç±»åºçä¸åçæ¬ï¼\n\n# ç±»å è½½å¨æ¶åå°äºåªäºè®¾è®¡æ¨¡å¼ï¼\n\nå¨ Java èææº (JVM) ä¸­çç±»å è½½å¨ (ClassLoader) å®ç°ä¸­ï¼éå¸¸ä½¿ç¨äºä»¥ä¸ä¸¤ç§è®¾è®¡æ¨¡å¼ï¼\n\n 1. å§ææ¨¡å¼ (Delegation Pattern)ï¼ClassLoader çå®ç°éå¸¸ä½¿ç¨äºå§ææ¨¡å¼æ¥å¤çç±»å è½½è¯·æ±ãå§ææ¨¡å¼æçæ¯å½ä¸ä¸ªå¯¹è±¡æ¶å°è¯·æ±æ¶ï¼å®å°è¯·æ±å§æç»å¶ä»å¯¹è±¡æ¥å¤çãå¨ç±»å è½½å¨çæåµä¸ï¼å½ä¸ä¸ªç±»å è½½å¨æ¥æ¶å°å è½½ç±»çè¯·æ±æ¶ï¼å®é¦åä¼å°è¯·æ±å§æç»ç¶ç±»å è½½å¨è¿è¡å¤çãå¦æç¶ç±»å è½½å¨æ æ³å è½½è¯¥ç±»ï¼å­ç±»å è½½å¨æä¼å°è¯å è½½ç±»ãè¿ç§å§ææ¨¡å¼çè®¾è®¡æ¹å¼å¯ä»¥å®ç°ç±»å è½½å¨çå±æ¬¡ç»æï¼ä»èå®ç°ç±»å è½½å¨çéç¦»åç±»å è½½çå§æ´¾ã\n 2. åä¸èè´£æ¨¡å¼ (Single Responsibility Pattern)ï¼ClassLoader çä¸»è¦è´£ä»»æ¯å è½½ç±»æä»¶å¹¶å®ä¹å¯¹åºçç±»ãClassLoader çè®¾è®¡ç¬¦ååä¸èè´£æ¨¡å¼ï¼å³ä¸ä¸ªç±»åºè¯¥åªè´è´£ä¸é¡¹èè´£ãClassLoader å°ç±»å è½½çèè´£å°è£å¨ä¸ä¸ªç¬ç«çç±»ä¸­ï¼ä»èä½¿å¾ç±»å è½½çé»è¾ä¸å¶ä»åè½è§£è¦ï¼æé«äºä»£ç çå¯ç»´æ¤æ§åå¯æ©å±æ§ã\n\né¤äºå§ææ¨¡å¼ååä¸èè´£æ¨¡å¼ï¼ClassLoader çå®ç°å¯è½è¿æ¶åå¶ä»è®¾è®¡æ¨¡å¼ï¼å·ä½åå³äºå®éçå®ç°ç»èåéæ±ãä¾å¦ï¼ä¸äºç±»å è½½å¨çç¼å­æºå¶å¯è½ä½¿ç¨äºäº«åæ¨¡å¼ (Flyweight Pattern) æ¥æé«æ§è½åèµæºå©ç¨æçã',normalizedContent:'# jvm åºç¡å¥é¨\n\n\n# jvm åºç¡\n\n\n# èä¸è java ä»ç¼ç å°æ§è¡å°åºæ¯ä¸ä¸ªæä¹æ ·çè¿ç¨ï¼\n\n\n\nåè®¾æä»¬æä¸ä¸ªæä»¶ x.javaï¼ä½ æ§è¡ javacï¼å®å°±ä¼åæ x.classã\n\nè¿ä¸ª class æä¹æ§è¡çï¼\n\nå½æä»¬è°ç¨ java å½ä»¤çæ¶åï¼class ä¼è¢« load å°åå­ï¼è¿åå«ãclassloaderãï¼ä¼è¢« classloader è£è½½å°åå­éã\n\nä¸è¬çæåµä¸ï¼æä»¬åèªå·±çç±»æä»¶çæ¶åä¹ä¼ç¨å° ãjava çç±»åºãï¼æä»¥ä»ä¼æ java ç±»åºç¸å³çè¿äºä¸ªç±»ä¹è¦è£è½½å°åå­éï¼è£è½½å®æä¹åä¼è°ç¨ãå­èç è§£éå¨ãæèæ¯ãjit å³æ¶ç¼è¯å¨ãæ¥è¿è¡è§£éæç¼è¯ï¼ç¼è¯å®ä¹åç±ãæ§è¡å¼æãå¼å§æ§è¡ï¼è¿ä»¥åä¸é¢é¢å¯¹çï¼é£å°±æ¯æä½ç³»ç»åç¡¬ä»¶äºã\n\njava ç¼è¯å¥½äºä¹ååæ classï¼ class ä¼è¢« load å°åå­ï¼ä¸æ­¤åæ¶åä»ä¹ stringï¼ object è¿äºä¸ª class ä¹é½ä¼è¢« load å°åå­ã\n\njava æ¯è¿ä¸ªè§£éæ§è¡çè¿æ¯ç¼è¯æ§è¡çï¼\n\nå¶å®è§£éåç¼è¯æ¯å¯ä»¥æ··åçï¼ç¹å«å¸¸ç¨çä¸äºä»£ç ï¼ä»£ç ç¨å°çæ¬¡æ°ç¹å«å¤ï¼è¿ä¸ªæ¶åä»ä¼æä»£ç åæä¸ä¸ªåæ¶çç¼è¯ï¼åæä¸ä¸ªæ¬å°çç¼è¯ã\n\nä½ å¯ä»¥çè§£ä¸ºå°±å c è¯­è¨å¨ windows ä¸æ§è¡çæ¶åï¼æå®ç¼è¯æ exe ä¸æ ·ï¼é£ä¹ä¸æ¬¡åæ§è¡è¿æ®µä»£ç çæ¶åï¼å°±ä¸éè¦éè¿è§£éå¨æ¥ä¸å¥ä¸å¥è§£éæ¥æ§è¡äºï¼æ§è¡å¼æå¯ä»¥ç´æ¥äº¤ç»æä½ç³»ç»å»è®©å®è°ç¨ï¼è¿ä¸ªæçè¦é«å¾å¤ï¼ä¸æ¯ææçä»£ç é½è¦é½ä¼è¢« git è¿è¡åæ¶ç¼è¯çï¼å¦ææ¯è¿æ ·çè¯ï¼é£æ´ä¸ª java å°±å®å¨åæäºä¸è½è·¨å¹³å°äºã\n\næä»¥æä¸äºç¹å®çï¼æ§è¡èµ·æ¥æ§è¡æ¬¡æ°å¥½å¤å¥½å¤ï¼ç¨çç¹å«å¤çæ¶åï¼è¿ä¸ªæ¶åä¼è¿è¡ä¸ä¸ªå³æ¶ç¼è¯å¨çç¼è¯ã\n\n\n# ä»ä¹æ¯ jvm?\n\næè°ç jvm èææºï¼å¶å®å®æ¬èº«æ¯ä¸ä¸ªè§èï¼æ¯èæåºæ¥çä¸å°è®¡ç®æºãæ¥æèªå·±çæä½ç³»ç»ï¼æ¯ä¸ä¸ªè·¨è¯­è¨å¹³å°ã\n\nä¸ºä»ä¹ jvm èææºè½å¤æ¯æå¤ç§è¯­è¨è¿è¡å¨ä¸é¢å¢ï¼\n\næå³é®çåå æ¯å°±æ¯å ä¸º class è¿ä¸ªä¸è¥¿ï¼æä»¬å¯ä»¥è¯´ä»»ä½çè¯­è¨ï¼åªè¦ä½ è½ç¼è¯æ classï¼ç¬¦å class æä»¶çè§èï¼ä½ å°±å¯ä»¥æå¨ java èææºä¸å»æ§è¡ã\n\næ³¨æï¼jvm åªå class æä»¶æå³ï¼ä¸ java æ å³ã\n\njdk å®ç½ï¼java se specifications (oracle.com)\n\nç»´åºç¾ç§ï¼javaèææº - ç»´åºç¾ç§ï¼èªç±çç¾ç§å¨ä¹¦ (wikipedia.org)\n\nç²éª¨æä¸­å½ï¼java è½¯ä»¶ | oracle ä¸­å½\n\n\n# å¸¸è§ç jvm å®ç°\n\n 1. hotspotï¼æå¸¸ç¨ï¼\n    \n    * oracle å®æ¹ï¼æä»¬åå®éªç¨ç jvmï¼java èææº\n    * java -version å½ä»¤å¯æ¥çä½¿ç¨çæ¯ä»ä¹ jvm\n    * hotspot 8 ä¹åè¦æ¶è´¹ï¼ä½ open jdk æ¯å¼æºççæ¬ï¼åè´¹\n\n 2. jrockit\n    \n    * bea æ¾ç»å·ç§°ä¸çä¸æå¿«ç jvm\n    * è¢« oracle æ¶è´­ï¼åå¹¶äº hotspot\n\n 3. taobaovmï¼åè´¹ï¼\n    \n    * hotspot æ·±åº¦å®å¶ç\n\n 4. liquidvm\n    \n    * ç´æ¥éå¯¹ç¡¬ä»¶\n\n 5. azul zingï¼ç¹å«è´µï¼\n    \n    * ææ°åå¾åæ¶çä¸çæ æï¼å·ç§° 1ms ä»¥åï¼\n    * www.azul.com\n\n 6. j9-ibm\n    \n    * microsoft vm\n\n\n# jdk jre jvm çå³ç³»\n\nåå«å³ç³»ã\n\njvm -- è¿è¡ java å­èç çèææº\n\njre -- java è¿è¡ç¯å¢ == jvm + coreï¼æ ¸å¿ç±»åºï¼\n\njdk -- java å¼åå·¥å·å == jre + development kitï¼å¼åå·¥å·ï¼\n\n\n# class æä»¶æ ¼å¼\n\nclass æä»¶æ ¼å¼ï¼file formatï¼\n\n * äºè¿å¶å­èæµï¼ç± java èææºè§£éï¼\n * æ°æ®ç±»å: u1 u2 u4 u8 å _info (è¡¨ç±»å)\n   * info çæ¥æºæ¯ hotspot æºç ä¸­çåæ³\n * æ¥ç 16 è¿å¶æ ¼å¼ç classfile\n   * è½¯ä»¶ - sublime / notepad /\n   * idea æä»¶ - bined\n * æå¾å¤å¯ä»¥æ´å¥½è§å¯ bytecode çæ¹æ³\n   * ç»ç«¯å½ä»¤ï¼javap <classæä»¶è·¯å¾>ï¼-v åæ°è¯¦ç»æ¥ç\n   * jbe å¯ä»¥ç´æ¥ä¿®æ¹\n   * jclasslib - idea æä»¶ä¹ä¸\n * æä»¶ç»æ\n   * general informationï¼éç¨ä¿¡æ¯ï¼ï¼ è¿ä¸ªé¨ååå«äºä¸äºéç¨çä¿¡æ¯ï¼æ¯å¦æä»¶çé­æ°ï¼magic numberï¼ï¼æä»¶çæ¬å·ç­ã\n   * constant poolï¼å¸¸éæ± ï¼ï¼ å¸¸éæ± æ¯ä¸ä¸ªéè¦çæ°æ®ç»æï¼å®å­å¨äºä¸ç³»åå¸¸éï¼åæ¬å­é¢å¼ãç¬¦å·å¼ç¨ãç±»åæ¥å£çåç§°ç­ãå¸¸éæ± å¨å­èç æä»¶ä¸­èµ·å°äºå­å¨åç®¡çå¸¸éæ°æ®çä½ç¨ã\n   * interfacesï¼æ¥å£ï¼ï¼ è¿é¨åå®ä¹äºè¯¥ç±»å®ç°çæ¥å£ã\n   * fieldsï¼å­æ®µï¼ï¼ è¿é¨åæè¿°äºç±»çå­æ®µï¼æååéï¼ï¼åæ¬å­æ®µçåç§°ãç±»åä»¥åä¿®é¥°ç¬¦ç­ä¿¡æ¯ã\n   * methodsï¼æ¹æ³ï¼ï¼ è¿é¨åæè¿°äºç±»çæ¹æ³ï¼åæ¬æ¹æ³çåç§°ãåæ°åè¡¨ãè¿åç±»åãå­èç æä»¤ç­ã\n   * attributesï¼å±æ§ï¼ï¼ å±æ§æä¾äºå³äºç±»ãå­æ®µææ¹æ³çå¶ä»ä¿¡æ¯ï¼ä¾å¦æºä»£ç è¡å·ãæ³¨è§£ç­ãè¿ä¸ªé¨åå¯ä»¥åå«å¤ä¸ªä¸åç±»åçå±æ§ï¼æ¯ä¸ªå±æ§é½æä¸ä¸ªåç§°åç¸åºçæ°æ®ã\n\nå¦ä¸å¾ç¤ºï¼\n\n\n\n * magicï¼é­æ°ï¼æ¯ä¸ä¸ªåºå®çå­èåºåï¼ç¨äºæ è¯ java å­èç æä»¶ãå®çå¼ä¸º 0xcafebabeï¼ç¨äºç¡®å®æä»¶æ¯å¦æ¯ææç java å­èç æä»¶ã\n * minor versionï¼æ¬¡çæ¬å·ï¼æç¤º java ç¼è¯å¨çæ¬çæ¬¡è¦æ´æ°ãç¨äºæè¿°å­èç æä»¶ä¸javaèææºçæ¬çå¼å®¹æ§ã\n * major versionï¼ä¸»çæ¬å·ï¼æç¤º java ç¼è¯å¨çæ¬çä¸»è¦æ´æ°ãåæ ·ç¨äºæè¿°å­èç æä»¶ä¸ java èææºçæ¬çå¼å®¹æ§ã\n * constant_pool_countï¼å¸¸éæ± è®¡æ°ï¼è¡¨ç¤ºå¸¸éæ± ä¸­å¸¸éçæ°éãåå­è¿å¶ 0010 è½¬åä¸ºåè¿å¶ä¸º 16ãå¸¸éæ± çæ­£å­å¨åå®¹çæ¶åå­äº 16 -1 é¡¹ãåé¢çåå®¹é½æ¯å¼ç¨å®ã\n * #1:ï¼å¸¸éæ± é¡¹ï¼éå¸¸ä»¥ # å¼å¤´ï¼è¡¨ç¤ºä¸ä¸ªå¸¸éæ± ä¸­çåä¸ªé¡¹ã\n * access flagsï¼è®¿é®æ å¿ï¼æè¿°ç±»ææ¥å£çè®¿é®çº§å«åç¹æ§ã\n * this_classï¼å½åç±»çç´¢å¼ï¼æç¤ºå½åç±»å¨å¸¸éæ± ä¸­çä½ç½®ã\n * super classï¼ç¶ç±»çç´¢å¼ï¼æç¤ºç¶ç±»å¨å¸¸éæ± ä¸­çä½ç½®ã\n * interface_countï¼æ¥å£æ°éï¼è¡¨ç¤ºè¯¥ç±»å®ç°çæ¥å£æ°éã\n * interfacesï¼æ¥å£åè¡¨ï¼æè¿°è¯¥ç±»å®ç°çæ¥å£å¨å¸¸éæ± ä¸­çä½ç½®ã\n * fields_countï¼å­æ®µæ°éï¼è¡¨ç¤ºè¯¥ç±»ä¸­å£°æçå­æ®µæ°éã\n * methods_countï¼æ¹æ³æ°éï¼è¡¨ç¤ºè¯¥ç±»ä¸­å£°æçæ¹æ³æ°éã\n * method_infoï¼æ¹æ³ä¿¡æ¯ï¼æè¿°æ¹æ³çè®¿é®æ å¿ãæ¹æ³åãåæ°åè¡¨ç­ã\n * attribute_countï¼å±æ§æ°éï¼è¡¨ç¤ºè¯¥ç±»çå±æ§æ°éã\n\næ¯ä¸ªé¨åæè¿°äº java å­èç æä»¶çä¸åæ¹é¢ï¼ä»ç±»çå£°æå°æ¹æ³çå®ä¹ï¼ä»¥åä¸å¸¸éæ± ç­ç¸å³çä¿¡æ¯ãè¿äºä¿¡æ¯å¨ java èææºä¸­è¢«è§£æåä½¿ç¨ï¼ä»¥æ­£ç¡®å°å è½½åæ§è¡ java ç±»ã\n\n> java çæ±ç¼æä»¤æ 200 å¤æ¡ã\n> \n> å¥½æåäº«ï¼classç±»æä»¶ç»æ\n\n\n# ç±»å è½½ - åå§å\n\n\n# å è½½è¿ç¨\n\nå è½½ãé¾æ¥ååå§åæ¯ java ç¨åºè¿è¡æ¶çä¸ä¸ªä¸»è¦é¶æ®µã\n\n 1. loading -- å è½½\n\n 2. linking -- é¾æ¥\n    \n    * verification -- éªè¯\n    * preparation -- åå¤\n    * resolution -- è§£æ\n\n 3. initializing -- åå§å\n\nå·ä½æ¥è¯´ï¼\n\n 1. loadingï¼å è½½ï¼ï¼ è¿æ¯ç±»å è½½è¿ç¨çç¬¬ä¸ä¸ªé¶æ®µãå¨è¿ä¸ªé¶æ®µï¼java èææºï¼jvmï¼ä¼ä»ç±»çå¤é¨æºå è½½ç±»çäºè¿å¶æ°æ®ï¼éå¸¸æ¯ä»ç£çæä»¶ä¸­å è½½ï¼ä½ä¹å¯ä»¥æ¯ç½ç»ãåå­ç­ã\n    \n    å è½½å¨å°ç±»çäºè¿å¶æ°æ®ï¼classæä»¶ï¼ä»å¤é¨æºå è½½å°åå­ä¸­ï¼å¹¶å°å¶æ¾ç½®å¨è¿è¡æ¶æ°æ®åºçæ¹æ³åºåã\n\n 2. linkingï¼é¾æ¥ï¼ï¼ è¿æ¯å è½½è¿ç¨çç¬¬äºä¸ªé¶æ®µï¼å®å°ç±»çäºè¿å¶æ°æ®é¾æ¥å° jvm çè¿è¡æ¶ç¶æã\n    \n    é¾æ¥è¿ç¨åä¸ºä»¥ä¸ä¸ä¸ªæ­¥éª¤ï¼\n    \n    * verificationï¼éªè¯ï¼ï¼ç¡®ä¿ç±»çäºè¿å¶æ°æ®ç¬¦å jvm è§èï¼ä¸è¿åç±»å è½½çå®å¨æ§è¦æ±ãè¿ä¸ªæ­¥éª¤ç¡®ä¿ç±»çç»ææ­£ç¡®ï¼ä¸ä¼å¼åè¿è¡æ¶éè¯¯ã\n    * preparationï¼åå¤ï¼ï¼ä¸ºç±»çéæåéåéåå­ç©ºé´ï¼å¹¶è®¾ç½®é»è®¤çåå§å¼ï¼éå¸¸ä¸ºé¶å¼ï¼ãè¿ä¸ªæ­¥éª¤ä¸ºç±»åéåéåå­å¹¶åå§åï¼ä½ä¸ä¼ä¸ºå®ä¾åéåéåå­ãï¼æ class æä»¶çéæåéèµé»è®¤å¼ï¼æ¯å¦ int ç±»åçé»è®¤å¼ä¸º 0ï¼\n    * resolutionï¼è§£æï¼ï¼å°ï¼classæä»¶éé¢çå¸¸éæ± éé¢ç¨å°çï¼ç¬¦å·å¼ç¨è½¬æ¢ä¸ºç´æ¥å¼ç¨ï¼è§£æå¨ä½å¯ä»¥å¨è¿è¡æ¶åå®æï¼ä¹å¯ä»¥å¨ç¼è¯æ¶éæå®æãè¿ä¸ªæ­¥éª¤å¤çç±»ãæ¥å£ãæ¹æ³åå­æ®µçç¬¦å·å¼ç¨ï¼å°å¶è§£æä¸ºå®éçå¼ç¨ã\n\n 3. initializingï¼åå§åï¼ï¼ è¿æ¯é¾æ¥è¿ç¨çæåä¸ä¸ªé¶æ®µï¼ä¹æ¯ç±»å è½½çæç»é¶æ®µãå¨è¿ä¸ªé¶æ®µï¼ç±»çéæåå§åå¨ä¼è¢«æ§è¡ï¼åå§åéæå­æ®µåæ§è¡éæåãè¿ä¸ªé¶æ®µæ¯å¨ç±»è¢«é¦æ¬¡ä½¿ç¨æ¶è§¦åçï¼ä¾å¦åå»ºç±»çå®ä¾ãè®¿é®ç±»çéæå­æ®µç­ãï¼è°ç¨ç±»åå§åä»£ç  <clinit>ï¼ç»éææååéèµåå§å¼ï¼\n\næ»ç»æ¥è¯´ï¼ç±»å è½½è¿ç¨æ¶åå°ä»å¤é¨æºå è½½ç±»çäºè¿å¶æ°æ®ï¼ç¶åå°å¶é¾æ¥å° jvm çè¿è¡æ¶ç¶æï¼æç»è¿è¡åå§åãé¾æ¥é¶æ®µåæ¬éªè¯ãåå¤åè§£æï¼èåå§åé¶æ®µåä¼æ§è¡ç±»çéæåå§åå¨ãè¿ä¸ªè¿ç¨ç¡®ä¿ç±»å¨ java èææºä¸­æ­£ç¡®å è½½åä½¿ç¨ã\n\nå è½½ä¹åä¼åçä»ä¹ï¼\n\nä»»ä½ä¸ä¸ª class è¢«å è½½å°åå­ä¹åï¼ä¼çæäºä¸¤ååå®¹ã\n\n * ç¬¬ä¸ååå®¹æ¯è¿ä¸ªäºè¿å¶çï¼è¿åä¸è¥¿ç¡®å®è¢«è½å°åå­ï¼æ¾å°äºåå­çä¸ååºåï¼å¯ä»¥åå°ä¸å¨çæè¿å»ã\n * ç¬¬äºä¸ªï¼å®çæäºä¸ä¸ª class ç±»çå¯¹è±¡ï¼éè¿ä»¥åå¶ä»çé£äºæä»¬èªå·±åçå¯¹è±¡å»è®¿é®è¿ä¸ªå¯¹è±¡ï¼éè¿è¿ä¸ªå¯¹è±¡å»è®¿é® class ç±»çæä»¶ï¼æä»¥çæä¸ä¸ª class çå¯¹è±¡ï¼è¿ä¸ª class å¯¹è±¡æ¯æåäºè¿ååå®¹ã\n\nå¨ java èææºä¸­ï¼ç±»çåæ°æ®ï¼åæ¬ç±»çç»æä¿¡æ¯ãå­æ®µãæ¹æ³ãç¶ç±»ãæ¥å£ç­ï¼é½ä¼è¢«å è½½å°æ¹æ³åºï¼åç©ºé´metaspaceï¼æ¿ä»£äºæ°¸ä¹ä»£permgenï¼ä¸­ãclass å¯¹è±¡æ¬èº«ä¹æ¯ç±»çåæ°æ®ä¹ä¸ï¼å æ­¤ class å¯¹è±¡ä¹å­æ¾å¨æ¹æ³åºä¸­ã class å¯¹è±¡å¨åå­ä¸­çä½ç½®å¯ä»¥çä½æ¯ç±»çæè¿°ç¬¦ï¼ç¨æ¥æä½è¯¥ç±»çå­èç ä»¥åå¶ä»ç¸å³çåæ°æ®ã\n\nå¯ä»¥ççä¸é¢è¿ä¸¤ç¯æç« ï¼\n\n * æ¹æ³åºä¸metaspace\n * java8åæ¶permgenï¼ä½¿ç¨mataspaceæä»ä¹å¥½å¤ï¼åå­ç»ææä»ä¹æ¬è´¨çååï¼\n\n\n# ç±»å è½½å¨\n\njvm å®æ¬èº«æä¸ä¸ªç±»å è½½å¨çå±æ¬¡ï¼è¿ä¸ªç±»å è½½å¨å°±æ¯ä¸ä¸ªæ®éç classï¼jvm æä¸ä¸ªç±»å è½½å¨çå±æ¬¡ï¼åå«æ¥å è½½ä¸åç classãæèè¯´ï¼jvm éé¢ææç class é½æ¯è¢«ç±»å è½½å¨ç»å è½½å°åå­çï¼é£ä¹è¿ä¸ªç±»å è½½å¨ç®åè¯´æä»¬å¯ä»¥æå®å«å classloaderã\n\n\n\næ³¨æï¼ä»ä¸å¾ä¸ï¼æ¯å§æç»ç¶å è½½å¨ï¼ä¸æ¯ç»§æ¿å³ç³»ï¼æ¯è¯­æ³ä¸çä¸ç§å³ç³»ã\n\nå¨ java èææºä¸­ï¼ç±»å è½½å¨æç§å±æ¬¡ç»æè¿è¡ç»ç»ï¼åä¸ºä¸ä¸ªä¸»è¦å±æ¬¡ï¼å¯å¨ç±»å è½½å¨ï¼bootstrap classloaderï¼ãæ©å±ç±»å è½½å¨ï¼extension classloaderï¼ååºç¨ç¨åºç±»å è½½å¨ï¼application classloaderï¼ä¹ç§°ä¸ºç³»ç»ç±»å è½½å¨ï¼ãè¿äºç±»å è½½å¨å½¢æäºç±»å è½½å¨çåäº²å§æ´¾æ¨¡åã\n\n 1. å¯å¨ç±»å è½½å¨ï¼bootstrap classloaderï¼ï¼è¿æ¯ java èææºçä¸é¨åï¼ç¨äºå è½½ java æ ¸å¿åºï¼ä¾å¦ java.lang åä¸­çç±»ï¼ãå®æ¯ææå¶ä»ç±»å è½½å¨çç¶å è½½å¨ï¼ä½å®æ¬èº«ä¸æ¯ä¸ä¸ªæ®éç java ç±»ï¼å æ­¤å¨æºç ä¸­å¹¶æ²¡æå¯¹åºçç±»ãå®ä½äºèææºåé¨ï¼éå¸¸ç¨æ¬å°ä»£ç å®ç°ãå®æ¯æé¡¶å±çç±»å è½½å¨ï¼è´è´£å è½½ java æ ¸å¿ç±»åºã\n 2. æ©å±ç±»å è½½å¨ï¼extension classloaderï¼ï¼ æ©å±ç±»å è½½å¨ç¨äºå è½½ java èææºçæ©å±ç±»åºï¼ä½äº jre/lib/ext ç®å½ä¸­çç±»ãå®çç¶å è½½å¨æ¯å¯å¨ç±»å è½½å¨ã\n 3. åºç¨ç¨åºç±»å è½½å¨ï¼application classloaderï¼ï¼è¿ä¸ªå è½½å¨ä¹ç§°ä¸ºç³»ç»ç±»å è½½å¨ï¼å®è´è´£å è½½åºç¨ç¨åºçç±»ï¼åæ¬ç¨æ·èªå®ä¹çç±»åç¬¬ä¸æ¹åºä¸­çç±»ãå®çç¶å è½½å¨æ¯æ©å±ç±»å è½½å¨ã\n\nå¯å¨ç±»å è½½å¨ãæ©å±ç±»å è½½å¨ååºç¨ç¨åºç±»å è½½å¨ææäºç±»å è½½å¨çå±æ¬¡ç»æï¼éè¿åäº²å§æ´¾æ¨¡åæ¥ä¿è¯ç±»çå è½½çä¸è´æ§åå®å¨æ§ãå¨å è½½ä¸ä¸ªç±»æ¶ï¼é¦åä¼å°è¯ç±ç¶å è½½å¨å è½½ï¼åªæå¨ç¶å è½½å¨æ æ³å è½½æ¶ï¼å­å è½½å¨æä¼å°è¯å è½½ãè¿ä¸ªæ¨¡åå¯ä»¥é²æ­¢ç±»çéå¤å è½½ï¼åæ¶ä¿è¯äºç±»çéç¦»æ§ã\n\nå¨å¯å¨ç±»å è½½å¨å è½½çç±»ä¸­ï¼æä¸é¨åæ¯èææºåé¨çç±»ï¼æ¯å¦ java.lang.objectãjava.lang.string ç­ãè¿äºç±»å¹¶ä¸æ¯æ®éç java ç±»ï¼å æ­¤æ²¡æå¯¹åºçæºç ãèå¨ java èææºçæºç ä¸­ï¼éå¸¸ä¼å¯¹è¿äºç±»çå è½½è¿ç¨è¿è¡æè¿°ï¼ä½å®éä¸å®ä»¬æ¯ç±èææºçå®ç°æä¾çã\n\næé¡¶å±å è½½å¨ bootstrap ä¼è¿åä¸ä¸ªç©ºå¼ã\n\npublic class t004_parentandchild {\n    public static void main(string[] args) {\n        system.out.println(t004_parentandchild.class.getclassloader());\n        system.out.println(t004_parentandchild.class.getclassloader().getclass().getclassloader()); // app\n        system.out.println(t004_parentandchild.class.getclassloader().getparent()); // extension\n        system.out.println(t004_parentandchild.class.getclassloader().getparent().getparent()); // bootstrapï¼è¿å null\n        // system.out.println(t004_parentandchild.class.getclassloader().getparent().getparent().getparent()); // è§£å¼æ³¨éå°±ä¼æ¥ç©ºæéå¼å¸¸\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nè¾åºç»æï¼\n\nsun.misc.launcher$appclassloader@18b4aac2\nnull\nsun.misc.launcher$extclassloader@4554617c\nnull\n\n\n1\n2\n3\n4\n\n\n\n# åäº²å§æ´¾\n\n 1. ç¶å è½½å¨\n    * ç¶å è½½å¨ä¸æ¯ãç±»å è½½å¨çå è½½å¨ãï¼ï¼ï¼ä¹ä¸æ¯ãç±»å è½½å¨çç¶ç±»å è½½å¨ã\n 2. åäº²å§æ´¾æ¯ä¸ä¸ªå­©å­åç¶äº²æ¹åï¼ç¶åç¶äº²åå­©å­æ¹åçåäº²å§æ´¾è¿ç¨\n 3. æèï¼ä¸ºä»ä¹è¦æåäº²å§æ´¾ï¼\n    * java.lang.string ç±»ç±èªå®ä¹ç±»å è½½å¨å è½½è¡ä¸è¡ï¼ -- ä¸è¡ï¼å ä¸ºä¸å®å¨\n\nåæ¯èªåºåä¸æ£æ¥æ¯å¦å·²ç»å è½½ï¼ç¶åååè¿å¤´æ¥æ¾ class å¹¶å è½½ï¼æ¥çæ¯å¦å è½½æåï¼ä¸ç´å°åºé½æ²¡å è½½æåå°±ä¼æåºä¸ä¸ª class æ¾ä¸å°å¼å¸¸ã\n\n\n\nè¿ä¸ªç¼å­æ¯å¨åªç¼å­ï¼\n\nå¯ä»¥ç®åçè®¤ä¸ºæ¯å®èªå·±åé¨ç»´æ¤çä¸ä¸ªå®¹å¨ï¼ä¸ä¸ª list æèä¸ä¸ªæ°ç»å è½½çä¸è¥¿é½æå¨éé¢ãæ¯ä¸ªå è½½å¨é½æèªå·±çç¼å­ã\n\n# ä¸ºä»ä¹ç±»å è½½å¨è¦ä½¿ç¨åäº²å§æ´¾ï¼ï¼éè¦ï¼\n\nä¸»è¦æ¯ä¸ºäºå®å¨ãæ¬¡è¦åå æ¯èµæºæµªè´¹é®é¢ï¼é¿åéæ°å è½½é®é¢ï¼é²æ­¢ç±»éå¤å è½½ï¼ã\n\n\n# ç±»å è½½å¨èå´\n\næ¥èª launcher æºç \n\n 1. å¯å¨ç±»å è½½å¨ bootstrap classloaderï¼\n    * å è½½è·¯å¾ï¼sun.boot.class.path\n    * èå´ï¼å®è´è´£å è½½ java æ ¸å¿ç±»åºï¼è¿äºç±»åºåæ¬ java api ä¸­çåºç¡ç±»ï¼å¦ java.lang åä¸çç±»ç­ã\n    * ä½ç¨ï¼å®æ¯ java ç±»å è½½å¨ä¸­æé¡¶å±çç±»å è½½å¨ï¼è´è´£å è½½èææºèªèº«éè¦çç±»ï¼ä»¥åå¨è¿è¡æé´ä¼è¢«ç³»ç»ä½¿ç¨çç±»ãç±äº bootstrap classloader æ¯ç¨æ¬å°ä»£ç æ¥å®ç°çï¼æä»¥å¨ java ä¸­æ æ³ç´æ¥è·åå°è¯¥ç±»å è½½å¨çå¼ç¨ã\n 2. æ©å±ç±»å è½½å¨ extensionclassloaderï¼\n    * å è½½è·¯å¾ï¼java.ext.dirs\n    * èå´ï¼å®è´è´£å è½½ java çæ©å±åºï¼è¿äºåºä½äº jre ç lib/ext ç®å½æèç±ç³»ç»åé java.ext.dirs æå®çè·¯å¾ã\n    * ä½ç¨ï¼å®è´è´£å è½½ä¸äº java æ åæ©å±åºä»¥åä¸äºèªå®ä¹çæ©å±åºï¼è¿äºåºéå¸¸æ¯ä¸äºå¯éçåè½ãæ©å±ç±»å è½½å¨æ¯ç± sun.misc.launcher$extclassloader å®ç°çã\n 3. ç³»ç»ç±»å è½½å¨ appclassloaderï¼\n    * å è½½è·¯å¾ï¼java.class.path\n    * èå´ï¼ä¹è¢«ç§°ä¸ºç³»ç»ç±»å è½½å¨ï¼å®è´è´£å è½½ç¨æ·ç±»è·¯å¾ï¼classpathï¼ä¸æå®çç±»ã\n    * ä½ç¨ï¼å®è´è´£å è½½åºç¨ç¨åºä¸­çç±»ï¼åæ¬å¼åèèªå·±ç¼åçç±»ä»¥åå¼ç¨çç¬¬ä¸æ¹ç±»åºãåºç¨ç±»å è½½å¨æ¯ç± sun.misc.launcher$appclassloader å®ç°çã\n\nä»£ç æ¥çï¼\n\npublic class t003_classloaderscope {\n    public static void main(string[] args) {\n        system.out.println("æ ¹ç®å½ä¸å è½½");\n        string pathboot = system.getproperty("sun.boot.class.path");\n        system.out.println(pathboot.replaceall(";", system.lineseparator()));\n\n        system.out.println("--------------------");\n        system.out.println("ext ä¸å è½½");\n        string pathext = system.getproperty("java.ext.dirs");\n        system.out.println(pathext.replaceall(";", system.lineseparator()));\n\n        system.out.println("--------------------");\n        system.out.println("app ä¸å è½½");\n        string pathapp = system.getproperty("java.class.path");\n        system.out.println(pathapp.replaceall(";", system.lineseparator()));\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nè¾åºç»æï¼\n\næ ¹ç®å½ä¸å è½½\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\resources.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\rt.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\sunrsasign.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\jsse.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\jce.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\charsets.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\jfr.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\classes\n--------------------\next ä¸å è½½\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\ext\nc:\\windows\\sun\\java\\lib\\ext\n--------------------\napp ä¸å è½½\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\charsets.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\deploy.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\ext\\access-bridge-64.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\ext\\cldrdata.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\ext\\dnsns.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\ext\\jaccess.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\ext\\jfxrt.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\ext\\localedata.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\ext\\nashorn.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\ext\\sunec.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\ext\\sunjce_provider.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\ext\\sunmscapi.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\ext\\sunpkcs11.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\ext\\zipfs.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\javaws.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\jce.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\jfr.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\jfxswt.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\jsse.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\management-agent.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\plugin.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\resources.jar\nc:\\program files\\java\\jdk1.8.0_321\\jre\\lib\\rt.jar\nd:\\ç¬è®°\\å­¦ä¹ èµæ\\é©¬å£«åµ\\jvmè§é¢æºç \\out\\production\\jvm\t\t\t\t// é¡¹ç®è·¯å¾\nd:\\software\\idea2022\\intellij idea 2022.1.3\\lib\\idea_rt.jar\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n\n\n\n# èªå®ä¹ç±»å è½½å¨\n\nå½ä½ æ³å è½½æä¸ªç±»çæ¶åï¼å¯ä»¥è°ç¨ loadclass æ¹æ³\n\npublic class t005_loadclassbyhand {\n    public static void main(string[] args) throws classnotfoundexception {\n        class clazz = t005_loadclassbyhand.class.getclassloader().loadclass("com.mashibing.jvm.c2_classloader.t002_classloaderlevel");\n        system.out.println(clazz.getname());\n\n        //å©ç¨ç±»å è½½å¨å è½½èµæºï¼åèå¦åå¾ççå è½½\n        //t005_loadclassbyhand.class.getclassloader().getresourceasstream("");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# loadclass æºç è§£æ\n\nloadclass æ¹æ³æ¯å¨åäº²å§æ´¾æ¨¡åä¸å®ç°çã\n\nfindincache -> parent.loadclass -> findclass()\n\nprivate final classloader parent; // final å³é®å­ä¿®é¥°\n\nprotected class<?> loadclass(string name, boolean resolve) throws classnotfoundexception\n    {\n        synchronized (getclassloadinglock(name)) {\n            // é¦åï¼æ£æ¥ç±»æ¯å¦å·²ç»å è½½\n            class<?> c = findloadedclass(name);\n            if (c == null) {\n                long t0 = system.nanotime();\n                try {\n                    // å¦æç±»ä¸å¨å·²å è½½ç±»ä¸­ï¼åå§æ´¾ç»ç¶ç±»å è½½å¨å è½½\n                    if (parent != null) {\n                        c = parent.loadclass(name, false);\n                    } else {\n                        // å¦ææ²¡æç¶å è½½å¨ï¼åä½¿ç¨ç³»ç»ç±»å è½½å¨å è½½\n                        c = findbootstrapclassornull(name);\n                    }\n                } catch (classnotfoundexception e) {\n                    // å¦ææ¾ä¸å°ç±»ï¼æåºclassnotfoundexception\n                    // ä»éç©ºç¶ç±»è£å¥å¨\n                }\n              \n\t\t\t\t\t\t\t // å¦æç¶å è½½å¨ä¹æ¾ä¸å°ï¼åå°è¯èªå·±å è½½\n                if (c == null) {\n                    // å¦æä»æªæ¾å°ï¼åæé¡ºåºè°ç¨ findclass\n                    // to find the class. è¦æ¾å°è¿ä¸ªç±»\n                    long t1 = system.nanotime();\n                    c = findclass(name);\n\n                    // è¿æ¯å®ä¹ç±»è£å¥å¨ï¼è®°å½ç»è®¡æ°æ®\n                    sun.misc.perfcounter.getparentdelegationtime().addtime(t1 - t0);\n                    sun.misc.perfcounter.getfindclasstime().addelapsedtimefrom(t1);\n                    sun.misc.perfcounter.getfindclasses().increment();\n                }\n            }\n            if (resolve) {\n                resolveclass(c);\n            }\n            return c;\n        }\n    }\n\n    protected class<?> findclass(string name) throws classnotfoundexception { // findclassè¢«protectedä¿®é¥°ï¼ä¿æ¤èµ·æ¥\n        throw new classnotfoundexception(name);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n\n\nä¸»è¦æ­¥éª¤å¦ä¸ï¼\n\n 1. é¦åï¼æ¹æ³ä¼å°è¯ä»å·²å è½½çç±»ä¸­æ¥æ¾ç®æ ç±»æ¯å¦å·²ç»å è½½ï¼å¦æå·²ç»å è½½ï¼åç´æ¥è¿åè¯¥ç±»ã\n 2. å¦æç®æ ç±»æªå è½½ï¼å®ä¼å°è¯å§æ´¾ç»ç¶ç±»å è½½å¨æ¥å è½½ãè¿æ¯åäº²å§æ´¾æ¨¡åçæ ¸å¿ææ³ä¹ä¸ãç¶ç±»å è½½å¨ä¼éå¤è¿ä¸ªè¿ç¨ï¼ç´å°å°è¾¾å¯å¨ç±»å è½½å¨ï¼bootstrap classloaderï¼ä¸ºæ­¢ã\n 3. å¦æç¶ç±»å è½½å¨ä¹æ æ³å è½½ç®æ ç±»ï¼å loadclass æ¹æ³ä¼è°ç¨ findclass æ¹æ³ï¼å°è¯èªå·±å è½½ç®æ ç±»ãè¿æ¯å­ç±»å è½½å¨å¨å è½½èªå·±ç±»çæåä¸æ­¥ã\n 4. æåï¼å¦æ resolve åæ°ä¸º trueï¼åä¼è°ç¨ resolveclass æ¹æ³ï¼ç¨äºè§£æå è½½çç±»ï¼ç¡®ä¿ç±»çå®æ´æ§åæ­£ç¡®æ§ã\n\nä»ä¹æ¶åéè¦èªå·±å»å è½½ï¼\n\nå è½½è¿å»å°±çæ class å¯¹è±¡åï¼\n\nä¸æ¯ï¼è¦ç»è¿ åå§å æçæ class å¯¹è±¡ã\n\n# èªå®ä¹ä¸ä¸ªç±»å è½½å¨éè¦åä»ä¹ï¼\n\nåªéè¦åä¸ä»¶äºï¼å°±æ¯å®ä¹èªå·±ç findclass å°±å¯ä»¥äºã\n\nå·ä½æ¥è¯´ï¼\n\n * ç»§æ¿ classloader\n\n * éåæ¨¡æ¿æ¹æ³ findclass\n   \n   * è°ç¨ defineclass(byte[] -> class clazz)\n\n * å å¯ï¼å¯èªå®ä¹ç±»å è½½å¨å è½½èªå å¯ç class\n   \n   * é²æ­¢åç¼è¯\n   * é²æ­¢ç¯¡æ¹\n\nä»£ç å¦ä¸ï¼\n\né¦åç»§æ¿ classloader è¿ä¸ªç±»\n\n// èªå®ä¹ç±»å è½½å¨ç»§æ¿èªclassloader\npublic class t006_msbclassloader extends classloader {\n\n    // éåfindclassæ¹æ³ï¼ç¨äºå è½½ç±»å­èç \n    @override\n    protected class<?> findclass(string name) throws classnotfoundexception {\n        // æ ¹æ®ç±»åæå»ºæä»¶è·¯å¾\n        file f = new file("c:/test/", name.replace(".", "/").concat(".class"));\n        try {\n            // è¯»åå­èç æä»¶\n            fileinputstream fis = new fileinputstream(f);\n            bytearrayoutputstream baos = new bytearrayoutputstream();\n            int b = 0;\n\n            // è¯»åæä»¶åå®¹å¹¶åå¥å­èæ°ç»è¾åºæµ\n            while ((b=fis.read()) !=0) {\n                baos.write(b);\n            }\n\n            // å°å­èæ°ç»è½¬æ¢ä¸ºå­èæ°ç»\n            byte[] bytes = baos.tobytearray();\n            baos.close();\n            fis.close(); // å³é­æµ\n\n            // ä½¿ç¨defineclassæ¹æ³å®ä¹å¹¶è¿åç±»\n            return defineclass(name, bytes, 0, bytes.length);\n        } catch (exception e) {\n            e.printstacktrace();\n        }\n        // è¥å è½½å¤±è´¥ï¼åè°ç¨ç¶ç±»çfindclassæ¹æ³\n        return super.findclass(name); // throws classnotfoundexception\n    }\n\n    // ä¸»å½æ°\n    public static void main(string[] args) throws exception {\n        // åå»ºèªå®ä¹ç±»å è½½å¨å®ä¾\n        classloader l = new t006_msbclassloader();\n        \n        // éè¿èªå®ä¹ç±»å è½½å¨å è½½ç±»\n        class clazz = l.loadclass("com.mashibing.jvm.hello");\n        class clazz1 = l.loadclass("com.mashibing.jvm.hello");\n\n        // è¾åºä¸¤æ¬¡å è½½çç±»æ¯å¦ç¸å\n        system.out.println(clazz == clazz1);\n\n        // åå»ºå è½½çç±»çå®ä¾å¹¶è°ç¨æ¹æ³\n        hello h = (hello) clazz.newinstance();\n        h.m();\n\n        // è¾åºç±»å è½½å¨ä¿¡æ¯\n        system.out.println(l.getclass().getclassloader()); // è¾åºèªå®ä¹ç±»å è½½å¨çç±»å è½½å¨\n        system.out.println(l.getparent()); // è¾åºèªå®ä¹ç±»å è½½å¨çç¶ç±»å è½½å¨\n\n        system.out.println(getsystemclassloader()); // è¾åºç³»ç»ç±»å è½½å¨\n    }\n}\n\npublic class hello {\n    public void m() {\n        system.out.println("hello jvm!");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n\n\nè¿æ®µä»£ç å®ç°äºä¸ä¸ªèªå®ä¹çç±»å è½½å¨ t006_msbclassloaderï¼è¯¥ç±»å è½½å¨ç»§æ¿èª classloaderï¼éåäº findclass æ¹æ³æ¥å è½½ç±»çå­èç ãå¨ä¸»å½æ°ä¸­ï¼ä½¿ç¨è¿ä¸ªèªå®ä¹çç±»å è½½å¨å è½½ç±»ï¼å¹¶è¾åºå è½½çç±»æ¯å¦ç¸åï¼ç¶ååå»ºè¯¥ç±»çå®ä¾å¹¶è°ç¨æ¹æ³ãæåï¼è¾åºäºèªå®ä¹ç±»å è½½å¨çç±»å è½½å¨åç¶ç±»å è½½å¨ä¿¡æ¯ï¼ä»¥åç³»ç»ç±»å è½½å¨çä¿¡æ¯ãè¿ç§èªå®ä¹ç±»å è½½å¨çæ¹å¼åè®¸ä½ ä»éæ åçä½ç½®å è½½ç±»æä»¶ï¼å¹¶ä¸å¯ä»¥éè¿ä¸åçç±»å è½½å¨å®ç°ç±»çéç¦»ã\n\n----------------------------------------\n\ndefineclass æ¹æ³æ¯ classloader ç±»ä¸­çä¸ä¸ªéè¦æ¹æ³ï¼ç¨äºå°å­èæ°ç»è½¬æ¢ä¸ºä¸ä¸ª class å¯¹è±¡ãè¯¥æ¹æ³çä½ç¨æ¯å°ä¸ä¸ªãå­èæ°ç»ä¸­çç±»å­èç ãè½¬æ¢ä¸ºä¸ä¸ªãjava ç±»çå®ä¾ããå½ä¸ä¸ªç±»å è½½å¨è°ç¨ defineclass æ¹æ³æ¶ï¼å®ä¼å°å­èæ°ç»ä¸­çç±»å­èç è½¬æ¢ä¸ºä¸ä¸ª class å¯¹è±¡ï¼å¹¶è¿åè¯¥å¯¹è±¡ã(ä¸ä¼éªè¯å­èç çæ­£ç¡®æ§)\n\n> è¾åºç»æ\n\ntrue\nhello jvm!\nsun.misc.launcher$appclassloader@18b4aac2\nsun.misc.launcher$appclassloader@18b4aac2\nsun.misc.launcher$appclassloader@18b4aac2\n\n\n1\n2\n3\n4\n5\n\n\n# å å¯\n\nå¤§å®¶é½ç¥é java çä»£ç  class æä»¶å¾å®¹æå°±è¢«åç¼è¯äºã\n\nä½æ¯æè¦æ¯å®ä¹èªå·±çæ ¼å¼ï¼æä¸æ³è®©å«äººåç¼è¯ï¼è¿æ¶åæä¹åï¼\n\nä½ å¯ä»¥éè¿èªå®ä¹ç class loader æ¥è¿è¡ãç¶åå¨åé»è¾çæ¶åå ä¸ä¸ªå å¯æä½ã\n\n\n# ç¼è¯å¨\n\nä¸å¤§æ¨¡å¼ï¼\n\n * è§£éå¨ï¼bytecode intepreterï¼ -- è§£éæ¨¡å¼\n * jitï¼just in-time compilerï¼ -- ç¼è¯æ¨¡å¼\n * æ··åæ¨¡å¼\n   * æ··åä½¿ç¨è§£éå¨ + ç­ç¹ä»£ç ç¼è¯ï¼ç¼è¯ææ¬å°ä»£ç ï¼å°±ä¸ç¨å¨è§£éå¨éé¢è§£éæ¥æ§è¡äºï¼æçæåï¼\n   * èµ·å§é¶æ®µéç¨è§£éæ§è¡\n   * ç­ç¹ä»£ç æ£æµ\n     * å¤æ¬¡è¢«è°ç¨çæ¹æ³(æ¹æ³è®¡æ°å¨:çæµæ¹æ³æ§è¡é¢ç)\n     * å¤æ¬¡è¢«è°ç¨çå¾ªç¯(å¾ªç¯è®¡æ°å¨:æ£æµå¾ªç¯æ§è¡é¢ç)\n     * è¿è¡ç¼è¯\n\nä¸ºä»ä¹ä¸å¹²èç´æ¥ç¼è¯ææ¬å°ä»£ç ï¼é£æ§è¡æçä¸æ´é«åï¼\n\næä¸¤ä¸ªåå ã\n\n 1. ç¬¬ä¸ï¼java çè§£éå¨ï¼ç°å¨å®çæçä¹å·²ç»éå¸¸é«äºï¼å¨ä¸äºç®åä»£ç çæ§è¡ä¸ï¼å®å¹¶ä¸è¾äºä½ ç¼è¯ææ¬å°ä»£ç ã\n 2. ç¬¬äºï¼å¦æä½ ä¸ä¸ªæ§è¡çæä»¶ç¹å«å¤ï¼åç§åæ ·çç±»åºçæ¶åï¼å¥½å åä¸ª classï¼ä½ ä¸æ¥äºè¯ä¸è¯´åå¨åå­éç¼è¯ä¸éï¼è¿ä¸ªå¯å¨è¿ç¨ä¼é¿å¾åäººãæä»¥å®ç°å¨é»è®¤çæ¨¡å¼æ¯æ··åæ¨¡å¼ã\n\nå¯ä»¥ç¨ææåæ°çæ¹å¼æå®ç¨ä»ä¹æ¨¡å¼\n\n 1. -xmixed é»è®¤ä¸ºæ··åæ¨¡å¼\n    \n    å¼å§è§£éæ§è¡ï¼å¯å¨éåº¦è¾å¿«ï¼å¯¹ç­ç¹ä»£ç å®è¡æ£æµåç¼è¯\n\n 2. -xint ä½¿ç¨è§£éæ¨¡å¼ï¼å¯å¨å¾å¿«ï¼æ§è¡ç¨æ¢\n\n 3. -xcomp ä½¿ç¨çº¯ç¼è¯æ¨¡å¼ï¼æ§è¡å¾å¿«ï¼å¯å¨å¾æ¢ï¼è¦ç¼è¯çç±»å°çæ¶åï¼å¯å¨ä¹ä¼å¾å¿«ï¼\n\n\n# æå è½½\n\nlazyloading\n\n * ä¸¥æ ¼è®²åºè¯¥å« lazylnitializing\n * jvm è§èå¹¶æ²¡æè§å®ä½æ¶å è½½\n * ä½æ¯ä¸¥æ ¼è§å®äºä»ä¹æ¶åå¿é¡»åå§åï¼äºç§æåµ\n   1. ä½¿ç¨ newï¼getstaticï¼putstaticï¼invokestatic æä»¤æ¶ï¼è®¿é® final åéé¤å¤\n   2. java.lang.reflect å¯¹ç±»è¿è¡åå°è°ç¨æ¶\n   3. åå§åå­ç±»çæ¶åï¼ç¶ç±»å¿é¡»é¦ååå§å\n   4. èææºå¯å¨æ¶ï¼è¢«æ§è¡çä¸»ç±»å¿é¡»åå§å\n   5. å¨æè¯­è¨æ¯æ java.lang.invoke.methodhandle è§£æçç»æä¸º ref_getstatic, ref_putstatic, ref_invokestatic çæ¹æ³å¥ææ¶ï¼è¯¥ç±»å¿é¡»åå§å\n\n\n# æå±ç¥è¯\n\n# åäº²å§æ´¾å¦ä½æç ´ï¼\n\nparent æ¯å¦ä½æå®çï¼æç ´åäº²å§æ´¾\n\n 1. ç¨ super(parent) æå®\n 2. åäº²å§æ´¾çæç ´\n    1. å¦ä½æç ´ï¼éå loadclass() æ¹æ³\n    2. ä½æ¶æç ´è¿ï¼\n       1. jdk1.2 ä¹åï¼èªå®ä¹ classloader é½å¿é¡»éå loadclass()\n       2. threadcontextclassloader å¯ä»¥å®ç°åºç¡ç±»è°ç¨å®ç°ç±»ä»£ç ï¼éè¿ thread.setcontextclassloader æå®\n       3. ç­å¯å¨ï¼ç­é¨ç½²\n          * osgi tomcat é½æèªå·±çæ¨¡åæå® classloaderï¼å¯ä»¥å è½½åä¸ç±»åºçä¸åçæ¬ï¼\n\n# ç±»å è½½å¨æ¶åå°äºåªäºè®¾è®¡æ¨¡å¼ï¼\n\nå¨ java èææº (jvm) ä¸­çç±»å è½½å¨ (classloader) å®ç°ä¸­ï¼éå¸¸ä½¿ç¨äºä»¥ä¸ä¸¤ç§è®¾è®¡æ¨¡å¼ï¼\n\n 1. å§ææ¨¡å¼ (delegation pattern)ï¼classloader çå®ç°éå¸¸ä½¿ç¨äºå§ææ¨¡å¼æ¥å¤çç±»å è½½è¯·æ±ãå§ææ¨¡å¼æçæ¯å½ä¸ä¸ªå¯¹è±¡æ¶å°è¯·æ±æ¶ï¼å®å°è¯·æ±å§æç»å¶ä»å¯¹è±¡æ¥å¤çãå¨ç±»å è½½å¨çæåµä¸ï¼å½ä¸ä¸ªç±»å è½½å¨æ¥æ¶å°å è½½ç±»çè¯·æ±æ¶ï¼å®é¦åä¼å°è¯·æ±å§æç»ç¶ç±»å è½½å¨è¿è¡å¤çãå¦æç¶ç±»å è½½å¨æ æ³å è½½è¯¥ç±»ï¼å­ç±»å è½½å¨æä¼å°è¯å è½½ç±»ãè¿ç§å§ææ¨¡å¼çè®¾è®¡æ¹å¼å¯ä»¥å®ç°ç±»å è½½å¨çå±æ¬¡ç»æï¼ä»èå®ç°ç±»å è½½å¨çéç¦»åç±»å è½½çå§æ´¾ã\n 2. åä¸èè´£æ¨¡å¼ (single responsibility pattern)ï¼classloader çä¸»è¦è´£ä»»æ¯å è½½ç±»æä»¶å¹¶å®ä¹å¯¹åºçç±»ãclassloader çè®¾è®¡ç¬¦ååä¸èè´£æ¨¡å¼ï¼å³ä¸ä¸ªç±»åºè¯¥åªè´è´£ä¸é¡¹èè´£ãclassloader å°ç±»å è½½çèè´£å°è£å¨ä¸ä¸ªç¬ç«çç±»ä¸­ï¼ä»èä½¿å¾ç±»å è½½çé»è¾ä¸å¶ä»åè½è§£è¦ï¼æé«äºä»£ç çå¯ç»´æ¤æ§åå¯æ©å±æ§ã\n\né¤äºå§ææ¨¡å¼ååä¸èè´£æ¨¡å¼ï¼classloader çå®ç°å¯è½è¿æ¶åå¶ä»è®¾è®¡æ¨¡å¼ï¼å·ä½åå³äºå®éçå®ç°ç»èåéæ±ãä¾å¦ï¼ä¸äºç±»å è½½å¨çç¼å­æºå¶å¯è½ä½¿ç¨äºäº«åæ¨¡å¼ (flyweight pattern) æ¥æé«æ§è½åèµæºå©ç¨æçã',charsets:{cjk:!0}},{title:"å®¹å¨çæ¬è´¨",frontmatter:{title:"å®¹å¨çæ¬è´¨",date:"2022-08-10T00:11:48.000Z",permalink:"/pages/f3cf17/",tags:["docker","äºåç"],author:{name:"éä¸æ¸é£",link:"https://github.com/msqfx"},description:"å®¹å¨å®ç°çä¸»è¦ææ¯ï¼namespaceãcgroupãchroot, éè¿ä»£ç å®ç°ä¸ä¸ªå®¹å¨æ¥æ·±å¥çè§£å¶æ¬è´¨ã",feed:{enable:!0},categories:["äºåç","docker"],comment:!0,meta:[{name:"twitter:title",content:"å®¹å¨çæ¬è´¨"},{name:"twitter:description",content:"å®¹å¨å®ç°çä¸»è¦ææ¯ï¼namespaceãcgroupãchroot, éè¿ä»£ç å®ç°ä¸ä¸ªå®¹å¨æ¥æ·±å¥çè§£å¶æ¬è´¨ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/06.docker/01.%E5%AE%B9%E5%99%A8%E7%9A%84%E6%9C%AC%E8%B4%A8.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å®¹å¨çæ¬è´¨"},{property:"og:description",content:"å®¹å¨å®ç°çä¸»è¦ææ¯ï¼namespaceãcgroupãchroot, éè¿ä»£ç å®ç°ä¸ä¸ªå®¹å¨æ¥æ·±å¥çè§£å¶æ¬è´¨ã"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/06.docker/01.%E5%AE%B9%E5%99%A8%E7%9A%84%E6%9C%AC%E8%B4%A8.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:11:48.000Z"},{property:"article:tag",content:"docker"},{property:"article:tag",content:"äºåç"},{itemprop:"name",content:"å®¹å¨çæ¬è´¨"},{itemprop:"description",content:"å®¹å¨å®ç°çä¸»è¦ææ¯ï¼namespaceãcgroupãchroot, éè¿ä»£ç å®ç°ä¸ä¸ªå®¹å¨æ¥æ·±å¥çè§£å¶æ¬è´¨ã"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/06.docker/01.%E5%AE%B9%E5%99%A8%E7%9A%84%E6%9C%AC%E8%B4%A8.html",relativePath:"01.äºåç/06.docker/01.å®¹å¨çæ¬è´¨.md",key:"v-437ba2ee",path:"/pages/f3cf17/",headers:[{level:2,title:"åè¨",slug:"åè¨",normalizedTitle:"åè¨",charIndex:2},{level:2,title:"NameSpace",slug:"namespace",normalizedTitle:"namespace",charIndex:8},{level:2,title:"chroot",slug:"chroot",normalizedTitle:"chroot",charIndex:95},{level:2,title:"æå¨æé ä¸ä¸ªå®¹å¨",slug:"æå¨æé ä¸ä¸ªå®¹å¨",normalizedTitle:"æå¨æé ä¸ä¸ªå®¹å¨",charIndex:819},{level:2,title:"cgroup",slug:"cgroup",normalizedTitle:"cgroup",charIndex:3796}],headersStr:"åè¨ NameSpace chroot æå¨æé ä¸ä¸ªå®¹å¨ cgroup",content:'# åè¨\n\nä½¿ç¨NameSpaceææ¯æ¥ä¿®æ¹è¿ç¨è§å¾ï¼åå»ºåºç¬ç«çæä»¶ç³»ç»ãä¸»æºåãè¿ç¨å·ãç½ç»ç­èµæºç©ºé´ï¼åä½¿ç¨Cgroupsæ¥å®ç°å¯¹è¿ç¨ç CPUãåå­ç­èµæºçä¼åçº§åéé¢éå¶ï¼æåä½¿ç¨chrootæ´æ¹è¿ç¨çæ ¹ç®å½ï¼ä¹å°±æ¯éå¶è®¿é®æä»¶ç³»ç»\n\n\n# NameSpace\n\nå¯ä»¥åå»ºåºç¬ç«çæä»¶ç³»ç»ãä¸»æºåãè¿ç¨å·ãç½ç»ç­èµæºç©ºé´ï¼å®ç°ç³»ç»å¨å±èµæºåè¿ç¨å±é¨èµæºçéç¦»ã\n\nNameSpaceæå¤ç§éç¦»ç±»åï¼åå¸¸è§çæPID NameSpaceå¯ä»¥éç¦»è¿ç¨IDãNET Namespaceéç¦»ç½ç»è®¾å¤ç«¯å£å·ç­ã\n\nä¸¾ä¸ªä¾å­\n\nNameSpaceå¯ä»¥è®©å½åè¿ç¨åªè½çå°å½åNamespaceéçè¿ç¨ï¼çä¸å°å®¿ä¸»æºåå»ºçè¿ç¨ãå¹¶ä¸è¿è¡å®¹å¨çå½ä»¤ä¸º1å·è¿ç¨ã\n\n# docker run -it busybox /bin/sh\n\n/ # ps aux\nPID   USER     COMMAND\n    1 root     /bin/sh\n    8 root     ps aux\n\n/ # echo $$\n1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¨å®¿ä¸»æºä¸­å¯ä»¥çå°è¯¥å®¹å¨è¿ç¨IDå¹¶ä¸ä¸º1ãåæ¬¡è¯æå®¹å¨ä¹åªæ¯å®¿ä¸»æºä¸­çä¸ä¸ªè¿ç¨èå·²ã\n\n[root@k8s-master ~]# ps aux | grep /bin/sh | grep -v grep\nroot     1398061  0.1  0.3 1368728 54104 pts/1   Sl+  10:36   0:00 docker run -it mirrors.sangfor.com/busybox /bin/sh\nroot     1398102  0.8  0.0   3176   188 pts/0    Ss+  10:36   0:00 /bin/sh\n\n\n1\n2\n3\n\n\n\n# chroot\n\nå¯ä»¥æ´æ¹è¿ç¨çæ ¹ç®å½ï¼éå¶è®¿é®æä»¶ç³»ç»ã\n\n\n# æå¨æé ä¸ä¸ªå®¹å¨\n\næä»¬ä½¿ç¨cloneåå»ºä¸ä¸ªå­è¿ç¨ï¼ä¼ å¥çåæ°æ¯CLONE_NEWPIDä»£è¡¨çå¯ç¨äºPID NameSpaceï¼å½åè¿ç¨çå°çæ¯ä¸ä¸ªå¨æ°çè¿ç¨ç©ºé´ï¼å¨è¯¥å½åç©ºé´ä¸­ï¼èªå·±æ¯1å·è¿ç¨ã\n\n#define _GNU_SOURCE\n#include <sys/mount.h> \n#include <sys/types.h>\n#include <sys/wait.h>\n#include <stdio.h>\n#include <sched.h>\n#include <signal.h>\n#include <unistd.h>\n#define STACK_SIZE (1024 * 1024)\nstatic char container_stack[STACK_SIZE];\nchar* const container_args[] = {\n  "/bin/bash",\n  NULL\n};\n\nint container_main(void* arg)\n{  \n  printf("Container - inside the container!\\n");\n  execv(container_args[0], container_args);\n  printf("Something\'s wrong!\\n");\n  return 1;\n}\n\nint main()\n{\n  printf("Parent - start a container!\\n");\n  int container_pid = clone(container_main, container_stack+STACK_SIZE, CLONE_NEWPID | SIGCHLD , NULL);\n  waitpid(container_pid, NULL, 0);\n  printf("Parent - container stopped!\\n");\n  return 0;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\n[root@k8s-master k8s]# gcc a.c -o a\n\n[root@k8s-master k8s]# ./a \nParent - start a container!\nContainer - inside the container!\n\n[root@k8s-master k8s]# echo $$\n1\n\n[root@k8s-master k8s]# exit\nParent - container stopped!\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nä½æ¯æä»¬å¨ä½¿ç¨ps auxæ¶ï¼è¿æ¯çå°æ´ä¸ªå®¿ä¸»æºçè¿ç¨ï¼å¹¶ä¸è¿ç¨IDä¸º1çè¿æ¯Systemdï¼ä¸ºä»ä¹å¢ï¼\n\nè¿æ¯å ä¸ºpså½ä»¤æ¯è¯»/procæä»¶ç³»ç»çï¼æä»¥æä»¬è¿éè¦è¿è¡æä»¶ç³»ç»çéç¦»ã\n\næä»¬åä½¿ç¨Mount NameSpaceè¿è¡æä»¶ç³»ç»çéç¦»ï¼å¨cloneä¸­ä½¿ç¨CLONE_NEWNSåæ°ã\n\nint main()\n{\n  printf("Parent - start a container!\\n");\n  int container_pid = clone(container_main, container_stack+STACK_SIZE, CLONE_NEWPID | CLONE_NEWNS  | SIGCHLD , NULL);\n  waitpid(container_pid, NULL, 0);\n  printf("Parent - container stopped!\\n");\n  return 0;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nç¼è¯è¿è¡åï¼åç°å½åæä»¶ç³»ç»å¹¶æªåçååï¼è¿ä¸ªæ¯å ä¸ºï¼åå»ºå­è¿ç¨æ¶ï¼ä¼ç»§æ¿ç¶è¿ç¨çæè½½ç¹ã\n\næä»¥æä»¬éè¦å¨å­è¿ç¨ä¸­ä¿®æ¹å½åçæè½½ç¹ï¼å¹¶ä¸å­è¿ç¨å¨æ°çnamespaceçæè½½å¨ä½åªå½±åèªèº«çæè½½æä»¶ç³»ç»ã\n\nåæ·è´ä¸ä¸ªæä»¶ç³»ç»åºæ¥ä½ä¸ºæä»¬å®¹å¨çæ ¹æä»¶ç³»ç»\n\ndocker export 48ab2ddd04dc | tar -C ./testfs -xvf -\n\n\n1\n\n\nåæè½½procï¼å¹¶ä¸å°testfsä½ä¸ºè¯¥è¿ç¨çæ ¹ç®å½\n\nint container_main(void* arg)\n{  \n  printf("Container - inside the container!\\n");\n\n  if (mount("proc", "testfs/proc", "proc", 0, NULL)) {\n     perror("proc");\n  }\n\n  if ( chdir("./testfs")!=0 ||  chroot("./") != 0) {\n     perror("chroot");\n  }\n\n  execv(container_args[0], container_args);\n  printf("Something\'s wrong!\\n");\n  return 1;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nåæ¬¡è¿è¡è¿å¥å®¹å¨ä¸­ï¼å½åçæ ¹ç®å½æ¯ä¸é¢æä»¬æé çtestfsï¼å¹¶ä¸ps auxå½ä»¤åªè½çå°å½ånamespaceçè¿ç¨ï¼èçä¸å°å®¿ä¸»æºnamespaceçè¿ç¨äºã\n\n[root@k8s-worker1 k8s]# ./a\nParent - start a container!\nContainer - inside the container!\nroot@k8s-worker1:/# ls\nbin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\nroot@k8s-worker1:/# ps aux\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot           1  0.0  0.0  26680  5452 ?        S    07:42   0:00 /bin/bash\nroot          94  0.0  0.0   5352   692 ?        S    07:49   0:00 ./a\nroot          95  0.0  0.0   4620  3872 ?        S    07:49   0:00 /bin/bash\nroot          99  0.0  0.0   7056  1556 ?        R+   07:49   0:00 ps aux\nroot@k8s-worker1:/# echo $$\n1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# cgroup\n\nå¯ä»¥å®ç°å¯¹è¿ç¨çCPUãåå­ç­èµæºçéé¢éå¶\n\ncgroupå¨æä½ç³»ç»ä¸­æ´é²åºæ¥çæ¥å£æ¯æä»¶ç³»ç»ï¼ä¼ä»¥æä»¶åç®å½å¨/sys/fs/cgroup/ç®å½ä¸­å±ç¤ºï¼ä¸é¢çç®å½é½æ¯å­ç³»ç»ï¼å¯ä»¥éå¶åç§èµæºï¼\n\n[root@iZwz93q4afq8ck02cesqh4Z ~]# ls /sys/fs/cgroup/\nblkio  cpuacct      cpuset   freezer  memory   net_cls,net_prio  perf_event  systemd\ncpu    cpu,cpuacct  devices  hugetlb  net_cls  net_prio          pids\n\n\n1\n2\n3\n\n\nå¦ä½éå¶è¿ç¨CPU\n\næ§è¡ä»¥ä¸å½ä»¤å°CPUåå°100%\n\n$ while : ; do : ; done &\n\n\n1\n\n\nä½¿ç¨topå½ä»¤æ¥çæ¯å¦cpuæ¯å¦æ»¡è´è½½\n\n# top\n\nPID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                                                                              \n2503037 root      20   0   26672   5412   3520 R  99.0   0.0   0:46.09 -bash                                                                                  99.49%\n\n\n1\n2\n3\n4\n\n\nå¨ç®å½/sys/fs/cgroup/cpu,cpuacct/ä¸åå»ºç®å½containerï¼æä½ç³»ç»ä¼èªå¨åå»ºèµæºéå¶æä»¶\n\n[root@k8s-worker1 container]# mkdir container\n[root@k8s-worker1 container]# ls\ncgroup.clone_children  cpuacct.usage         cpuacct.usage_percpu_sys   cpuacct.usage_user  cpu.rt_period_us   cpu.stat\ncgroup.procs           cpuacct.usage_all     cpuacct.usage_percpu_user  cpu.cfs_period_us   cpu.rt_runtime_us  notify_on_release\ncpuacct.stat           cpuacct.usage_percpu  cpuacct.usage_sys          cpu.cfs_quota_us    cpu.shares         tasks\n\n\n1\n2\n3\n4\n5\n\n\nå¨æä»¶å¤¹ä¸é¢å¯ä»¥æ¥çå°cpu.cfs_quota_usçé»è®¤å¼æ¯-1ï¼ä»£è¡¨æ²¡æéå¶ï¼cpu.cfs_period_usé»è®¤å¼ä¸º100ms(100000us)\n\n# cat /sys/fs/cgroup/cpu/container/cpu.cfs_period_us\n100000\n# cat /sys/fs/cgroup/cpu/container/cpu.cfs_quota_us\n-1\n\n\n1\n2\n3\n4\n\n\n\nåcpu.cfs_quota_usåå¥20ms(20000us)ï¼ä¹å°±æ¯æ¯100msæ¶é´éï¼éå¶çè¿ç¨åªè½éç¨20msï¼ä¹å°±æ¯è¿ä¸ªè¿ç¨åªè½ä½¿ç¨å°20%çCPUå¸¦å®½\n\necho 20000 > /sys/fs/cgroup/cpu//cpu.cfs_quota_us\n\n\n1\n\n\nåå°éå¶çè¿ç¨IDåå¥å°tasksæä»¶ä¸­ï¼å¯ä»¥çå°è¯¥æä»¶ä¸­å·²ç»åå«äºè¯¥å®¹å¨è¿ç¨ID\n\n# echo 2503037 > tasks\n# cat tasks\n2503037\n\n\n1\n2\n3\n\n\nåä½¿ç¨topå¯ä»¥åç°è¯¥è¿ç¨çcpuè¢«éå¶å¨20%\n\n# top\n\nPID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                                                                              \n2503037 root      20   0   26672   5412   3520 R  20.4   0.0   6:43.71 -bash\n\n\n1\n2\n3\n4\n\n\nå®¹å¨è¢«cgroupçæåµ\n\nå½ç¶dockerå·²ç»å°è£å¥½äºï¼ç´æ¥è°ç¨ä»¥ä¸å½ä»¤å³å¯å®ç°ä¸é¢CPUçéå¶\n\ndocker run -it --cpu-period=100000 --cpu-quota=20000 ubuntu /bin/bash\n\n\n1\n\n\nå¯ä»¥çå°å¨/sys/fs/cgroup/cpu,cpuacct/dockerç®å½ä¸åå»ºäºè¯¥å®¹å¨çç®å½ï¼ç®å½ä¸é¢åå«äºèµæºéå¶æä»¶\n\n[root@k8s-worker1 docker]# pwd\n/sys/fs/cgroup/cpu,cpuacct/docker\n[root@k8s-worker1 docker]# ls\n87ee72386a6079ba6411ac8f3030c12407558652d28a1cd16c03f4434581500c  cpuacct.usage             cpuacct.usage_percpu_user  cpu.cfs_quota_us   cpu.stat\ncgroup.clone_children                                             cpuacct.usage_all         cpuacct.usage_sys          cpu.rt_period_us   notify_on_release\ncgroup.procs                                                      cpuacct.usage_percpu      cpuacct.usage_user         cpu.rt_runtime_us  tasks\ncpuacct.stat\n[root@k8s-worker1 docker]# cd 87ee72386a6079ba6411ac8f3030c12407558652d28a1cd16c03f4434581500c/\n[root@k8s-worker1 87ee72386a6079ba6411ac8f3030c12407558652d28a1cd16c03f4434581500c]# ls\ncgroup.clone_children  cpuacct.usage         cpuacct.usage_percpu_sys   cpuacct.usage_user  cpu.rt_period_us   cpu.stat\ncgroup.procs           cpuacct.usage_all     cpuacct.usage_percpu_user  cpu.cfs_period_us   cpu.rt_runtime_us  notify_on_release\ncpuacct.stat           cpuacct.usage_percpu  cpuacct.usage_sys          cpu.cfs_quota_us    cpu.shares         tasks\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nå¨è¯¥ç®å½ä¸å¯ä»¥çå°cpu.cfs_quota_usè®¾ç½®æäº20000ï¼å¹¶ä¸tasksä¸­åå«äºè¯¥å®¹å¨è¿ç¨çID\n\n[root@k8s-worker1 87ee72386a6079ba6411ac8f3030c12407558652d28a1cd16c03f4434581500c]# cat cpu.cfs_quota_us \n20000\n[root@k8s-worker1 87ee72386a6079ba6411ac8f3030c12407558652d28a1cd16c03f4434581500c]# cat tasks\n2560954\n\n\n1\n2\n3\n4\n',normalizedContent:'# åè¨\n\nä½¿ç¨namespaceææ¯æ¥ä¿®æ¹è¿ç¨è§å¾ï¼åå»ºåºç¬ç«çæä»¶ç³»ç»ãä¸»æºåãè¿ç¨å·ãç½ç»ç­èµæºç©ºé´ï¼åä½¿ç¨cgroupsæ¥å®ç°å¯¹è¿ç¨ç cpuãåå­ç­èµæºçä¼åçº§åéé¢éå¶ï¼æåä½¿ç¨chrootæ´æ¹è¿ç¨çæ ¹ç®å½ï¼ä¹å°±æ¯éå¶è®¿é®æä»¶ç³»ç»\n\n\n# namespace\n\nå¯ä»¥åå»ºåºç¬ç«çæä»¶ç³»ç»ãä¸»æºåãè¿ç¨å·ãç½ç»ç­èµæºç©ºé´ï¼å®ç°ç³»ç»å¨å±èµæºåè¿ç¨å±é¨èµæºçéç¦»ã\n\nnamespaceæå¤ç§éç¦»ç±»åï¼åå¸¸è§çæpid namespaceå¯ä»¥éç¦»è¿ç¨idãnet namespaceéç¦»ç½ç»è®¾å¤ç«¯å£å·ç­ã\n\nä¸¾ä¸ªä¾å­\n\nnamespaceå¯ä»¥è®©å½åè¿ç¨åªè½çå°å½ånamespaceéçè¿ç¨ï¼çä¸å°å®¿ä¸»æºåå»ºçè¿ç¨ãå¹¶ä¸è¿è¡å®¹å¨çå½ä»¤ä¸º1å·è¿ç¨ã\n\n# docker run -it busybox /bin/sh\n\n/ # ps aux\npid   user     command\n    1 root     /bin/sh\n    8 root     ps aux\n\n/ # echo $$\n1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¨å®¿ä¸»æºä¸­å¯ä»¥çå°è¯¥å®¹å¨è¿ç¨idå¹¶ä¸ä¸º1ãåæ¬¡è¯æå®¹å¨ä¹åªæ¯å®¿ä¸»æºä¸­çä¸ä¸ªè¿ç¨èå·²ã\n\n[root@k8s-master ~]# ps aux | grep /bin/sh | grep -v grep\nroot     1398061  0.1  0.3 1368728 54104 pts/1   sl+  10:36   0:00 docker run -it mirrors.sangfor.com/busybox /bin/sh\nroot     1398102  0.8  0.0   3176   188 pts/0    ss+  10:36   0:00 /bin/sh\n\n\n1\n2\n3\n\n\n\n# chroot\n\nå¯ä»¥æ´æ¹è¿ç¨çæ ¹ç®å½ï¼éå¶è®¿é®æä»¶ç³»ç»ã\n\n\n# æå¨æé ä¸ä¸ªå®¹å¨\n\næä»¬ä½¿ç¨cloneåå»ºä¸ä¸ªå­è¿ç¨ï¼ä¼ å¥çåæ°æ¯clone_newpidä»£è¡¨çå¯ç¨äºpid namespaceï¼å½åè¿ç¨çå°çæ¯ä¸ä¸ªå¨æ°çè¿ç¨ç©ºé´ï¼å¨è¯¥å½åç©ºé´ä¸­ï¼èªå·±æ¯1å·è¿ç¨ã\n\n#define _gnu_source\n#include <sys/mount.h> \n#include <sys/types.h>\n#include <sys/wait.h>\n#include <stdio.h>\n#include <sched.h>\n#include <signal.h>\n#include <unistd.h>\n#define stack_size (1024 * 1024)\nstatic char container_stack[stack_size];\nchar* const container_args[] = {\n  "/bin/bash",\n  null\n};\n\nint container_main(void* arg)\n{  \n  printf("container - inside the container!\\n");\n  execv(container_args[0], container_args);\n  printf("something\'s wrong!\\n");\n  return 1;\n}\n\nint main()\n{\n  printf("parent - start a container!\\n");\n  int container_pid = clone(container_main, container_stack+stack_size, clone_newpid | sigchld , null);\n  waitpid(container_pid, null, 0);\n  printf("parent - container stopped!\\n");\n  return 0;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\n[root@k8s-master k8s]# gcc a.c -o a\n\n[root@k8s-master k8s]# ./a \nparent - start a container!\ncontainer - inside the container!\n\n[root@k8s-master k8s]# echo $$\n1\n\n[root@k8s-master k8s]# exit\nparent - container stopped!\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nä½æ¯æä»¬å¨ä½¿ç¨ps auxæ¶ï¼è¿æ¯çå°æ´ä¸ªå®¿ä¸»æºçè¿ç¨ï¼å¹¶ä¸è¿ç¨idä¸º1çè¿æ¯systemdï¼ä¸ºä»ä¹å¢ï¼\n\nè¿æ¯å ä¸ºpså½ä»¤æ¯è¯»/procæä»¶ç³»ç»çï¼æä»¥æä»¬è¿éè¦è¿è¡æä»¶ç³»ç»çéç¦»ã\n\næä»¬åä½¿ç¨mount namespaceè¿è¡æä»¶ç³»ç»çéç¦»ï¼å¨cloneä¸­ä½¿ç¨clone_newnsåæ°ã\n\nint main()\n{\n  printf("parent - start a container!\\n");\n  int container_pid = clone(container_main, container_stack+stack_size, clone_newpid | clone_newns  | sigchld , null);\n  waitpid(container_pid, null, 0);\n  printf("parent - container stopped!\\n");\n  return 0;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nç¼è¯è¿è¡åï¼åç°å½åæä»¶ç³»ç»å¹¶æªåçååï¼è¿ä¸ªæ¯å ä¸ºï¼åå»ºå­è¿ç¨æ¶ï¼ä¼ç»§æ¿ç¶è¿ç¨çæè½½ç¹ã\n\næä»¥æä»¬éè¦å¨å­è¿ç¨ä¸­ä¿®æ¹å½åçæè½½ç¹ï¼å¹¶ä¸å­è¿ç¨å¨æ°çnamespaceçæè½½å¨ä½åªå½±åèªèº«çæè½½æä»¶ç³»ç»ã\n\nåæ·è´ä¸ä¸ªæä»¶ç³»ç»åºæ¥ä½ä¸ºæä»¬å®¹å¨çæ ¹æä»¶ç³»ç»\n\ndocker export 48ab2ddd04dc | tar -c ./testfs -xvf -\n\n\n1\n\n\nåæè½½procï¼å¹¶ä¸å°testfsä½ä¸ºè¯¥è¿ç¨çæ ¹ç®å½\n\nint container_main(void* arg)\n{  \n  printf("container - inside the container!\\n");\n\n  if (mount("proc", "testfs/proc", "proc", 0, null)) {\n     perror("proc");\n  }\n\n  if ( chdir("./testfs")!=0 ||  chroot("./") != 0) {\n     perror("chroot");\n  }\n\n  execv(container_args[0], container_args);\n  printf("something\'s wrong!\\n");\n  return 1;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nåæ¬¡è¿è¡è¿å¥å®¹å¨ä¸­ï¼å½åçæ ¹ç®å½æ¯ä¸é¢æä»¬æé çtestfsï¼å¹¶ä¸ps auxå½ä»¤åªè½çå°å½ånamespaceçè¿ç¨ï¼èçä¸å°å®¿ä¸»æºnamespaceçè¿ç¨äºã\n\n[root@k8s-worker1 k8s]# ./a\nparent - start a container!\ncontainer - inside the container!\nroot@k8s-worker1:/# ls\nbin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\nroot@k8s-worker1:/# ps aux\nuser         pid %cpu %mem    vsz   rss tty      stat start   time command\nroot           1  0.0  0.0  26680  5452 ?        s    07:42   0:00 /bin/bash\nroot          94  0.0  0.0   5352   692 ?        s    07:49   0:00 ./a\nroot          95  0.0  0.0   4620  3872 ?        s    07:49   0:00 /bin/bash\nroot          99  0.0  0.0   7056  1556 ?        r+   07:49   0:00 ps aux\nroot@k8s-worker1:/# echo $$\n1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# cgroup\n\nå¯ä»¥å®ç°å¯¹è¿ç¨çcpuãåå­ç­èµæºçéé¢éå¶\n\ncgroupå¨æä½ç³»ç»ä¸­æ´é²åºæ¥çæ¥å£æ¯æä»¶ç³»ç»ï¼ä¼ä»¥æä»¶åç®å½å¨/sys/fs/cgroup/ç®å½ä¸­å±ç¤ºï¼ä¸é¢çç®å½é½æ¯å­ç³»ç»ï¼å¯ä»¥éå¶åç§èµæºï¼\n\n[root@izwz93q4afq8ck02cesqh4z ~]# ls /sys/fs/cgroup/\nblkio  cpuacct      cpuset   freezer  memory   net_cls,net_prio  perf_event  systemd\ncpu    cpu,cpuacct  devices  hugetlb  net_cls  net_prio          pids\n\n\n1\n2\n3\n\n\nå¦ä½éå¶è¿ç¨cpu\n\næ§è¡ä»¥ä¸å½ä»¤å°cpuåå°100%\n\n$ while : ; do : ; done &\n\n\n1\n\n\nä½¿ç¨topå½ä»¤æ¥çæ¯å¦cpuæ¯å¦æ»¡è´è½½\n\n# top\n\npid user      pr  ni    virt    res    shr s  %cpu  %mem     time+ command                                                                              \n2503037 root      20   0   26672   5412   3520 r  99.0   0.0   0:46.09 -bash                                                                                  99.49%\n\n\n1\n2\n3\n4\n\n\nå¨ç®å½/sys/fs/cgroup/cpu,cpuacct/ä¸åå»ºç®å½containerï¼æä½ç³»ç»ä¼èªå¨åå»ºèµæºéå¶æä»¶\n\n[root@k8s-worker1 container]# mkdir container\n[root@k8s-worker1 container]# ls\ncgroup.clone_children  cpuacct.usage         cpuacct.usage_percpu_sys   cpuacct.usage_user  cpu.rt_period_us   cpu.stat\ncgroup.procs           cpuacct.usage_all     cpuacct.usage_percpu_user  cpu.cfs_period_us   cpu.rt_runtime_us  notify_on_release\ncpuacct.stat           cpuacct.usage_percpu  cpuacct.usage_sys          cpu.cfs_quota_us    cpu.shares         tasks\n\n\n1\n2\n3\n4\n5\n\n\nå¨æä»¶å¤¹ä¸é¢å¯ä»¥æ¥çå°cpu.cfs_quota_usçé»è®¤å¼æ¯-1ï¼ä»£è¡¨æ²¡æéå¶ï¼cpu.cfs_period_usé»è®¤å¼ä¸º100ms(100000us)\n\n# cat /sys/fs/cgroup/cpu/container/cpu.cfs_period_us\n100000\n# cat /sys/fs/cgroup/cpu/container/cpu.cfs_quota_us\n-1\n\n\n1\n2\n3\n4\n\n\n\nåcpu.cfs_quota_usåå¥20ms(20000us)ï¼ä¹å°±æ¯æ¯100msæ¶é´éï¼éå¶çè¿ç¨åªè½éç¨20msï¼ä¹å°±æ¯è¿ä¸ªè¿ç¨åªè½ä½¿ç¨å°20%çcpuå¸¦å®½\n\necho 20000 > /sys/fs/cgroup/cpu//cpu.cfs_quota_us\n\n\n1\n\n\nåå°éå¶çè¿ç¨idåå¥å°tasksæä»¶ä¸­ï¼å¯ä»¥çå°è¯¥æä»¶ä¸­å·²ç»åå«äºè¯¥å®¹å¨è¿ç¨id\n\n# echo 2503037 > tasks\n# cat tasks\n2503037\n\n\n1\n2\n3\n\n\nåä½¿ç¨topå¯ä»¥åç°è¯¥è¿ç¨çcpuè¢«éå¶å¨20%\n\n# top\n\npid user      pr  ni    virt    res    shr s  %cpu  %mem     time+ command                                                                              \n2503037 root      20   0   26672   5412   3520 r  20.4   0.0   6:43.71 -bash\n\n\n1\n2\n3\n4\n\n\nå®¹å¨è¢«cgroupçæåµ\n\nå½ç¶dockerå·²ç»å°è£å¥½äºï¼ç´æ¥è°ç¨ä»¥ä¸å½ä»¤å³å¯å®ç°ä¸é¢cpuçéå¶\n\ndocker run -it --cpu-period=100000 --cpu-quota=20000 ubuntu /bin/bash\n\n\n1\n\n\nå¯ä»¥çå°å¨/sys/fs/cgroup/cpu,cpuacct/dockerç®å½ä¸åå»ºäºè¯¥å®¹å¨çç®å½ï¼ç®å½ä¸é¢åå«äºèµæºéå¶æä»¶\n\n[root@k8s-worker1 docker]# pwd\n/sys/fs/cgroup/cpu,cpuacct/docker\n[root@k8s-worker1 docker]# ls\n87ee72386a6079ba6411ac8f3030c12407558652d28a1cd16c03f4434581500c  cpuacct.usage             cpuacct.usage_percpu_user  cpu.cfs_quota_us   cpu.stat\ncgroup.clone_children                                             cpuacct.usage_all         cpuacct.usage_sys          cpu.rt_period_us   notify_on_release\ncgroup.procs                                                      cpuacct.usage_percpu      cpuacct.usage_user         cpu.rt_runtime_us  tasks\ncpuacct.stat\n[root@k8s-worker1 docker]# cd 87ee72386a6079ba6411ac8f3030c12407558652d28a1cd16c03f4434581500c/\n[root@k8s-worker1 87ee72386a6079ba6411ac8f3030c12407558652d28a1cd16c03f4434581500c]# ls\ncgroup.clone_children  cpuacct.usage         cpuacct.usage_percpu_sys   cpuacct.usage_user  cpu.rt_period_us   cpu.stat\ncgroup.procs           cpuacct.usage_all     cpuacct.usage_percpu_user  cpu.cfs_period_us   cpu.rt_runtime_us  notify_on_release\ncpuacct.stat           cpuacct.usage_percpu  cpuacct.usage_sys          cpu.cfs_quota_us    cpu.shares         tasks\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nå¨è¯¥ç®å½ä¸å¯ä»¥çå°cpu.cfs_quota_usè®¾ç½®æäº20000ï¼å¹¶ä¸tasksä¸­åå«äºè¯¥å®¹å¨è¿ç¨çid\n\n[root@k8s-worker1 87ee72386a6079ba6411ac8f3030c12407558652d28a1cd16c03f4434581500c]# cat cpu.cfs_quota_us \n20000\n[root@k8s-worker1 87ee72386a6079ba6411ac8f3030c12407558652d28a1cd16c03f4434581500c]# cat tasks\n2560954\n\n\n1\n2\n3\n4\n',charsets:{cjk:!0},lastUpdated:"2023/01/15, 20:17:10",lastUpdatedTimestamp:167378503e4},{title:"dockerå®¹å¨åæºç½ç»",frontmatter:{title:"dockerå®¹å¨åæºç½ç»",date:"2023-01-08T10:52:41.000Z",permalink:"/pages/0ddeb7/",tags:["docker","äºåç","å®¹å¨"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä¸»è¦è®²è¿°dockerå®¹å¨çåç§ç½ç»æ¨¡å¼ï¼hostãbridgeãcontainerãnullï¼å¹¶ä»ç»å®ä»¬çä½¿ç¨æ¹æ³åå®ç°åçã",feed:{enable:!0},categories:["äºåç","docker"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/16731831018681673183100953.png"},{name:"twitter:title",content:"dockerå®¹å¨åæºç½ç»"},{name:"twitter:description",content:"æ¬æä¸»è¦è®²è¿°dockerå®¹å¨çåç§ç½ç»æ¨¡å¼ï¼hostãbridgeãcontainerãnullï¼å¹¶ä»ç»å®ä»¬çä½¿ç¨æ¹æ³åå®ç°åçã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/16731831018681673183100953.png"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/06.docker/04.docker%E5%AE%B9%E5%99%A8%E5%8D%95%E6%9C%BA%E7%BD%91%E7%BB%9C.html"},{property:"og:type",content:"article"},{property:"og:title",content:"dockerå®¹å¨åæºç½ç»"},{property:"og:description",content:"æ¬æä¸»è¦è®²è¿°dockerå®¹å¨çåç§ç½ç»æ¨¡å¼ï¼hostãbridgeãcontainerãnullï¼å¹¶ä»ç»å®ä»¬çä½¿ç¨æ¹æ³åå®ç°åçã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/16731831018681673183100953.png"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/06.docker/04.docker%E5%AE%B9%E5%99%A8%E5%8D%95%E6%9C%BA%E7%BD%91%E7%BB%9C.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-01-08T10:52:41.000Z"},{property:"article:tag",content:"docker"},{property:"article:tag",content:"äºåç"},{property:"article:tag",content:"å®¹å¨"},{itemprop:"name",content:"dockerå®¹å¨åæºç½ç»"},{itemprop:"description",content:"æ¬æä¸»è¦è®²è¿°dockerå®¹å¨çåç§ç½ç»æ¨¡å¼ï¼hostãbridgeãcontainerãnullï¼å¹¶ä»ç»å®ä»¬çä½¿ç¨æ¹æ³åå®ç°åçã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/16731831018681673183100953.png"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/06.docker/04.docker%E5%AE%B9%E5%99%A8%E5%8D%95%E6%9C%BA%E7%BD%91%E7%BB%9C.html",relativePath:"01.äºåç/06.docker/04.dockerå®¹å¨åæºç½ç».md",key:"v-7413a666",path:"/pages/0ddeb7/",headers:[{level:2,title:"åè¨",slug:"åè¨",normalizedTitle:"åè¨",charIndex:2},{level:2,title:"host",slug:"host",normalizedTitle:"host",charIndex:146},{level:2,title:"bridge",slug:"bridge",normalizedTitle:"bridge",charIndex:548},{level:3,title:"åç",slug:"åç",normalizedTitle:"åç",charIndex:138},{level:3,title:"éªè¯",slug:"éªè¯",normalizedTitle:"éªè¯",charIndex:856},{level:3,title:"å®¹å¨ç½ç»äºé",slug:"å®¹å¨ç½ç»äºé",normalizedTitle:"å®¹å¨ç½ç»äºé",charIndex:3442},{level:3,title:"å®¹å¨è¿æ¥å¶ä»ä¸»æº",slug:"å®¹å¨è¿æ¥å¶ä»ä¸»æº",normalizedTitle:"å®¹å¨è¿æ¥å¶ä»ä¸»æº",charIndex:5783},{level:2,title:"container",slug:"container",normalizedTitle:"container",charIndex:6181},{level:2,title:"none",slug:"none",normalizedTitle:"none",charIndex:7668}],headersStr:"åè¨ host bridge åç éªè¯ å®¹å¨ç½ç»äºé å®¹å¨è¿æ¥å¶ä»ä¸»æº container none",content:"# åè¨\n\néè¿æç«  å®¹å¨çæ¬è´¨å¯ç¥ï¼å®¹å¨åªæ¯ä¸ä¸ªè¿ç¨ï¼èå®¹å¨æè½çå°çç½ç»æ ï¼æ¯éç¦»å¨èªå·±ç Network Namespace ä¸­ãdocker å®¹å¨åæºç½ç»æ¯æåç§ç½ç»æ¨¡å¼ï¼ä¹é½æ¯åºäº Network Namespace å®ç°çãæ¬æä¸»è¦æ¯ä»ç»è¿åç§æ¨¡å¼çä½¿ç¨æ¹æ³åå®ç°åçã\n\n\n# host\n\nä½¿ç¨è¯¥æ¨¡å¼çå®¹å¨åå®¿ä¸»æºæ¯å¨åä¸ä¸ª Network Namespace ä¸­çï¼æä»¥åå®¿ä¸»æºç¨çæ¯åä¸ä¸ªç½ç»æ ï¼é£ä¹å®¹å¨æ´é²çç«¯å£ï¼ä¹å°±æ¯å®¿ä¸»æºä¸ç«¯å£ã\n\n> æ³¨æï¼ä½¿ç¨è¯¥æ¨¡å¼ï¼éè¦å³æ³¨ç«¯å£å²çª\n\néè¿æ·»å  --net=host åæ°å³å¯å¼å¯ host æ¨¡å¼\n\ndocker run -d --net=host nginx\n\n\n1\n\n\nå ä¸ºåå®¿ä¸»æºä½¿ç¨çæ¯åä¸ä¸ªç½ç»æ ï¼æä»¥å®¹å¨ä¸å®¿ä¸»æºæ¯å¯ä»¥äºç¸è¿éçï¼å¨å®¿ä¸»æºä¸ç´æ¥å¯ä»¥éè¿ 127.0.0.1 è®¿é®å°è¯¥å®¹å¨ççç«¯å£ã\n\ncurl 127.0.0.1\n\n\n1\n\n\nè¿è¡å¦ä¸ä¸ªå®¹å¨è¿å¥å¶ä¸­æ§è¡ curl 127.0.0.1 å¯ä»¥çå°ä¸æ ·å¯ä»¥è®¿é®å° nginx æ´é²ç 80 ç«¯å£ï¼å ä¸ºé½æ¯ä½¿ç¨å®¿ä¸»æºç½ç»æ ã\n\n docker run -it --net=host curlimages/curl curl 127.0.0.1\n\n\n1\n\n\n\n# bridge\n\n\n# åç\n\nè¯¥æ¨¡å¼ä¸ºæ¡¥æ¥æ¨¡å¼ï¼åå»ºå®¹å¨æ¶ä¼åå»ºå±äºèªå·±ç Network Namepsaceï¼è¯¥å®¹å¨åå®¿ä¸»æºä½¿ç¨çæ¯ä¸åç Network Namespaceï¼ä¹å°±æ¯è¯´å®ä»¬ä½¿ç¨çæ¯ä¸åçç½ç»æ ã\n\nbridge ç½ç»æ¨¡åçå®ç°åçå¯ä»¥åèæç«  æå¨å®ç°dockerå®¹å¨bridgeç½ç»æ¨¡å\n\nå®¿ä¸»æºåå»ºäº docker0 ä½ä¸ºèæç½æ¡¥ï¼å¶ä½ç¨ä¸»è¦æ¯ä½ä¸ºäº¤æ¢æºå¨äºå±ç½ç»ï¼åå°ä½¿ç¨ bridge æ¨¡å¼åå»ºçå®¹å¨éè¿ veth pair è¿æ¥å° dcoker0 ä¸ï¼è¿æ ·è¿æ¥å° docker0 ä¸çå®¹å¨é½å¯ä»¥äºç¸ç½ç»éä¿¡ã\n\n> veth pair ç±»ä¼¼ä¸ä¸ªç®¡éï¼æ°æ®åä¼ä»ä¸ç«¯å°å¦ä¸ç«¯ã\n\n\n\n\n# éªè¯\n\né»è®¤è¿è¡å®¹å¨æ¶ä½¿ç¨çå°±æ¯ bridge æ¨¡å¼ï¼docker ä¼èªå¨ä¸ºå®¹å¨æ·»å  veth pair å¹¶éç½®å¥½å¶ ip å°åï¼è¿éç eth0 å°±æ¯å¶ä¸­çä¸ç«¯ï¼å¯ä»¥çå°å¶ ip å°åä¸º 172.17.0.2\n\n[root@localhost ~]# docker run -d --name nginx1 nginx\n\n[root@localhost ~]# docker exec -it nginx1 ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n20: eth0@if21: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nveth pair çå¦ä¸ç«¯ä¼æ¥å¥å° docker0 ä¸ï¼å¨å®¹å¨ä¸­æ§è¡ä»¥ä¸å½ä»¤å¯ä»¥çå° veth pair å¦ä¸ç«¯çåºå·\n\n[root@localhost ~]# docker exec nginx1 cat /sys/class/net/eth0/iflink\n21\n\n\n1\n2\n\n\nå¨å®¿ä¸»æºä¸å¯ä»¥çå° 21 åºå·ä¸ç veth pair çåç§°æ¯ veth702ba20ï¼ä¹å°±æ¯ç®¡éçå¦ä¸ç«¯ã\n\n[root@localhost ~]# ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: ens18: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether fe:fc:fe:af:4b:ea brd ff:ff:ff:ff:ff:ff\n    inet 10.61.74.37/23 brd 10.61.75.255 scope global noprefixroute ens18\n       valid_lft forever preferred_lft forever\n    inet6 fe80::1bdd:fe7:4a90:1a67/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n3: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:84:c1:3b:ea brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:84ff:fec1:3bea/64 scope link \n       valid_lft forever preferred_lft forever\n21: veth702ba20@if20: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP group default \n    link/ether 0a:21:51:0c:7e:db brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet6 fe80::821:51ff:fe0c:7edb/64 scope link \n       valid_lft forever preferred_lft forever\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nåæ¥ç docker0 æå¥çè®¾å¤å¯ä»¥åç° veth702ba20 æ¯æå¥å¨ docker0 ä¸çã\n\n[root@localhost ~]# brctl show\nbridge name     bridge id               STP enabled     interfaces\ndocker0         8000.024284c13bea       no              veth702ba20\n\n\n1\n2\n3\n\n\n\n# å®¹å¨ç½ç»äºé\n\nååå»ºå¦ä¸ä¸ªå®¹å¨ nginx2ï¼æ¥çå¶ ip ä¸º 172.17.0.3ï¼å¯ä»¥åç° nginx1 æ¯å¯ä»¥ ping é nginx2 çè¯¥ ip çã\n\n[root@localhost ~]# docker run -d --name nginx2 nginx\n[root@localhost ~]# docker exec nginx2 ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n54: eth0@if55: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nä¸ºä»ä¹å¯ä»¥äºéå¢ï¼\n\næä»¬æ¥çä¸ nginx1 çè·¯ç±ï¼å½ ping nginx2 ç ip æ¶ï¼ä¼å¹éå°ç¬¬äºæ¡è·¯ç±ï¼ç¶åèµ° eth0 ç½å¡ï¼å ä¸ºå¶æ¯ veth pair çä¸ç«¯ï¼æ°æ®åä¼å¨å¦ä¸ç«¯åºç°ï¼å¦ä¸ç«¯æ¥å¥å°äº docker0 ä¸ï¼æç»æ°æ®åå°è¾¾ docker0\n\n[root@localhost ~]# docker exec nginx1 ip r\ndefault via 172.17.0.1 dev eth0 \n172.17.0.0/16 dev eth0  proto kernel  scope link  src 172.17.0.2 \n\n\n1\n2\n3\n\n\nå½éè¿ nginx1 ping nginx2 ç ip æ¶ï¼æè¿çå¬ docker0 ç½å¡çä¸ä¸æ°æ®åï¼\n\n[root@localhost ~]# docker exec -it nginx1 ping 172.17.0.3 -c 3\n\n[root@localhost ~]# tcpdump -i docker0\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on docker0, link-type EN10MB (Ethernet), capture size 262144 bytes\n04:32:57.596814 ARP, Request who-has 172.17.0.3 tell 172.17.0.2, length 28\n04:32:57.596848 ARP, Reply 172.17.0.3 is-at 02:42:ac:11:00:03 (oui Unknown), length 28\n04:32:57.596853 IP 172.17.0.2 > 172.17.0.3: ICMP echo request, id 17, seq 1, length 64\n04:32:57.596896 IP 172.17.0.3 > 172.17.0.2: ICMP echo reply, id 17, seq 1, length 64\n04:32:58.596437 IP 172.17.0.2 > 172.17.0.3: ICMP echo request, id 17, seq 2, length 64\n04:32:58.596492 IP 172.17.0.3 > 172.17.0.2: ICMP echo reply, id 17, seq 2, length 64\n04:32:59.596444 IP 172.17.0.2 > 172.17.0.3: ICMP echo request, id 17, seq 3, length 64\n04:32:59.596491 IP 172.17.0.3 > 172.17.0.2: ICMP echo reply, id 17, seq 3, length 64\n04:33:02.598361 ARP, Request who-has 172.17.0.2 tell 172.17.0.3, length 28\n04:33:02.598386 ARP, Reply 172.17.0.2 is-at 02:42:ac:11:00:02 (oui Unknown), length 28\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nç±ä¸å¯ç¥ï¼nginx1(10.17.0.2) ä¼åé ARP è·å nginx2(10.17.0.3) ç mac å°åï¼ç¶åä½¿ç¨è¯¥ mac å°åéè¿äºå±è®¾å¤ bridge å nginx2 è½¬åæ°æ®åï¼è¿å¥å°äº nginx2 ç Network Namespace ä¸­ï¼ç±å®çç½ç»æ å¤çè¯¥æ°æ®åï¼æåååã\n\n\n\n\n# å®¹å¨è¿æ¥å¶ä»ä¸»æº\n\nå®¹å¨åè¿æ¥å¶ä»ä¸»æºæ¶ï¼æ¯å¦ ping 10.65.132.187 æ¶ï¼ä¼åéè¿ docker0 è¾¾å°å®¿ä¸»æºä¸ï¼ç¶åéè¿å®¿ä¸»æºçç½ç»æ å¤çã\n\néè¿æ¥çå®¿ä¸»æºè·¯ç±è¡¨ï¼å°è¾¾å®¿ä¸»æºçæ°æ®è¡¨ä¼èµ°ç¬¬ä¸æ¡é»è®¤è·¯ç±ï¼éè¿ eth0 ç½å¡ä¸ä¸è·³å° 10.61.74.1ï¼ç¶åæç»è¾¾å°å¦ä¸å°ä¸»æºç eth0 ä¸­ã\n\n[root@localhost ~]# ip r\ndefault via 10.61.74.1 dev eth0 proto static metric 100 \n10.61.74.0/23 dev eth0 proto kernel scope link src 10.61.74.37 metric 100 \n172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1\n\n\n1\n2\n3\n4\n\n\n\n\n\n# container\n\nä½¿ç¨è¯¥æ¨¡å¼çå®¹å¨ä¼å å¥å°æå®å®¹å¨ç Network Namespace ä¸­ï¼ä¹å°±æ¯ä¸¤ä¸ªå®¹å¨å±ç¨åä¸ä¸ªç½ç»æ ã\n\né¦åä½¿ç¨ bridge æ¨¡å¼åå»ºå®¹å¨ nginx1ï¼è¯¥å®¹å¨ä¼æ¥æèªå·±ç Network Namespaceï¼ç¶ååä½¿ç¨ container æ¨¡å¼åå»º nginx2 å®¹å¨å¹¶å å¥ nginx1 ç Network Namespace ä¸­ã\n\néè¿æ¥çä¸¤ä¸ªå®¹å¨çç½å¡å¯ä»¥åç°ä¸¤ä¸ªæ¯ä¸æ ·çã\n\n[root@localhost ~]# docker run -d --name nginx1 nginx\n[root@localhost ~]# docker exec -it nginx1 ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n56: eth0@if57: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n\n[root@localhost ~]# docker run -it --name nginx2 --net=container:nginx1 nginx /bin/bash\n\n[ root@20069e4c2bde:/etc/nginx ]$ ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n56: eth0@if57: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n\n\n# none\n\nè¯¥æ¨¡å¼åå»ºå®¹å¨ä¹ä¼åå»ºæ°çå±äºèªå·±ç Network Namespaceï¼ä½æ¯å®¹å¨åä¸ä¼æä»»ä½çç½ç»éç½®ï¼æ²¡æç½å¡ãè·¯ç±ãè·¯ç±ç­ä¿¡æ¯ï¼éè¦ç±æä»¬èªå·±å»éç½®ã\n\n[root@localhost ~]# docker run -it --name nginx --net=none nginx /bin/bash\n\n[ root@52480b0a4725:/etc/nginx ]$ ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n[ root@52480b0a4725:/etc/nginx ]$ ip r\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n",normalizedContent:"# åè¨\n\néè¿æç«  å®¹å¨çæ¬è´¨å¯ç¥ï¼å®¹å¨åªæ¯ä¸ä¸ªè¿ç¨ï¼èå®¹å¨æè½çå°çç½ç»æ ï¼æ¯éç¦»å¨èªå·±ç network namespace ä¸­ãdocker å®¹å¨åæºç½ç»æ¯æåç§ç½ç»æ¨¡å¼ï¼ä¹é½æ¯åºäº network namespace å®ç°çãæ¬æä¸»è¦æ¯ä»ç»è¿åç§æ¨¡å¼çä½¿ç¨æ¹æ³åå®ç°åçã\n\n\n# host\n\nä½¿ç¨è¯¥æ¨¡å¼çå®¹å¨åå®¿ä¸»æºæ¯å¨åä¸ä¸ª network namespace ä¸­çï¼æä»¥åå®¿ä¸»æºç¨çæ¯åä¸ä¸ªç½ç»æ ï¼é£ä¹å®¹å¨æ´é²çç«¯å£ï¼ä¹å°±æ¯å®¿ä¸»æºä¸ç«¯å£ã\n\n> æ³¨æï¼ä½¿ç¨è¯¥æ¨¡å¼ï¼éè¦å³æ³¨ç«¯å£å²çª\n\néè¿æ·»å  --net=host åæ°å³å¯å¼å¯ host æ¨¡å¼\n\ndocker run -d --net=host nginx\n\n\n1\n\n\nå ä¸ºåå®¿ä¸»æºä½¿ç¨çæ¯åä¸ä¸ªç½ç»æ ï¼æä»¥å®¹å¨ä¸å®¿ä¸»æºæ¯å¯ä»¥äºç¸è¿éçï¼å¨å®¿ä¸»æºä¸ç´æ¥å¯ä»¥éè¿ 127.0.0.1 è®¿é®å°è¯¥å®¹å¨ççç«¯å£ã\n\ncurl 127.0.0.1\n\n\n1\n\n\nè¿è¡å¦ä¸ä¸ªå®¹å¨è¿å¥å¶ä¸­æ§è¡ curl 127.0.0.1 å¯ä»¥çå°ä¸æ ·å¯ä»¥è®¿é®å° nginx æ´é²ç 80 ç«¯å£ï¼å ä¸ºé½æ¯ä½¿ç¨å®¿ä¸»æºç½ç»æ ã\n\n docker run -it --net=host curlimages/curl curl 127.0.0.1\n\n\n1\n\n\n\n# bridge\n\n\n# åç\n\nè¯¥æ¨¡å¼ä¸ºæ¡¥æ¥æ¨¡å¼ï¼åå»ºå®¹å¨æ¶ä¼åå»ºå±äºèªå·±ç network namepsaceï¼è¯¥å®¹å¨åå®¿ä¸»æºä½¿ç¨çæ¯ä¸åç network namespaceï¼ä¹å°±æ¯è¯´å®ä»¬ä½¿ç¨çæ¯ä¸åçç½ç»æ ã\n\nbridge ç½ç»æ¨¡åçå®ç°åçå¯ä»¥åèæç«  æå¨å®ç°dockerå®¹å¨bridgeç½ç»æ¨¡å\n\nå®¿ä¸»æºåå»ºäº docker0 ä½ä¸ºèæç½æ¡¥ï¼å¶ä½ç¨ä¸»è¦æ¯ä½ä¸ºäº¤æ¢æºå¨äºå±ç½ç»ï¼åå°ä½¿ç¨ bridge æ¨¡å¼åå»ºçå®¹å¨éè¿ veth pair è¿æ¥å° dcoker0 ä¸ï¼è¿æ ·è¿æ¥å° docker0 ä¸çå®¹å¨é½å¯ä»¥äºç¸ç½ç»éä¿¡ã\n\n> veth pair ç±»ä¼¼ä¸ä¸ªç®¡éï¼æ°æ®åä¼ä»ä¸ç«¯å°å¦ä¸ç«¯ã\n\n\n\n\n# éªè¯\n\né»è®¤è¿è¡å®¹å¨æ¶ä½¿ç¨çå°±æ¯ bridge æ¨¡å¼ï¼docker ä¼èªå¨ä¸ºå®¹å¨æ·»å  veth pair å¹¶éç½®å¥½å¶ ip å°åï¼è¿éç eth0 å°±æ¯å¶ä¸­çä¸ç«¯ï¼å¯ä»¥çå°å¶ ip å°åä¸º 172.17.0.2\n\n[root@localhost ~]# docker run -d --name nginx1 nginx\n\n[root@localhost ~]# docker exec -it nginx1 ip a\n1: lo: <loopback,up,lower_up> mtu 65536 qdisc noqueue state unknown group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n20: eth0@if21: <broadcast,multicast,up,lower_up> mtu 1500 qdisc noqueue state up group default \n    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nveth pair çå¦ä¸ç«¯ä¼æ¥å¥å° docker0 ä¸ï¼å¨å®¹å¨ä¸­æ§è¡ä»¥ä¸å½ä»¤å¯ä»¥çå° veth pair å¦ä¸ç«¯çåºå·\n\n[root@localhost ~]# docker exec nginx1 cat /sys/class/net/eth0/iflink\n21\n\n\n1\n2\n\n\nå¨å®¿ä¸»æºä¸å¯ä»¥çå° 21 åºå·ä¸ç veth pair çåç§°æ¯ veth702ba20ï¼ä¹å°±æ¯ç®¡éçå¦ä¸ç«¯ã\n\n[root@localhost ~]# ip a\n1: lo: <loopback,up,lower_up> mtu 65536 qdisc noqueue state unknown group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: ens18: <broadcast,multicast,up,lower_up> mtu 1500 qdisc pfifo_fast state up group default qlen 1000\n    link/ether fe:fc:fe:af:4b:ea brd ff:ff:ff:ff:ff:ff\n    inet 10.61.74.37/23 brd 10.61.75.255 scope global noprefixroute ens18\n       valid_lft forever preferred_lft forever\n    inet6 fe80::1bdd:fe7:4a90:1a67/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n3: docker0: <broadcast,multicast,up,lower_up> mtu 1500 qdisc noqueue state up group default \n    link/ether 02:42:84:c1:3b:ea brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:84ff:fec1:3bea/64 scope link \n       valid_lft forever preferred_lft forever\n21: veth702ba20@if20: <broadcast,multicast,up,lower_up> mtu 1500 qdisc noqueue master docker0 state up group default \n    link/ether 0a:21:51:0c:7e:db brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet6 fe80::821:51ff:fe0c:7edb/64 scope link \n       valid_lft forever preferred_lft forever\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nåæ¥ç docker0 æå¥çè®¾å¤å¯ä»¥åç° veth702ba20 æ¯æå¥å¨ docker0 ä¸çã\n\n[root@localhost ~]# brctl show\nbridge name     bridge id               stp enabled     interfaces\ndocker0         8000.024284c13bea       no              veth702ba20\n\n\n1\n2\n3\n\n\n\n# å®¹å¨ç½ç»äºé\n\nååå»ºå¦ä¸ä¸ªå®¹å¨ nginx2ï¼æ¥çå¶ ip ä¸º 172.17.0.3ï¼å¯ä»¥åç° nginx1 æ¯å¯ä»¥ ping é nginx2 çè¯¥ ip çã\n\n[root@localhost ~]# docker run -d --name nginx2 nginx\n[root@localhost ~]# docker exec nginx2 ip a\n1: lo: <loopback,up,lower_up> mtu 65536 qdisc noqueue state unknown group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n54: eth0@if55: <broadcast,multicast,up,lower_up> mtu 1500 qdisc noqueue state up group default \n    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nä¸ºä»ä¹å¯ä»¥äºéå¢ï¼\n\næä»¬æ¥çä¸ nginx1 çè·¯ç±ï¼å½ ping nginx2 ç ip æ¶ï¼ä¼å¹éå°ç¬¬äºæ¡è·¯ç±ï¼ç¶åèµ° eth0 ç½å¡ï¼å ä¸ºå¶æ¯ veth pair çä¸ç«¯ï¼æ°æ®åä¼å¨å¦ä¸ç«¯åºç°ï¼å¦ä¸ç«¯æ¥å¥å°äº docker0 ä¸ï¼æç»æ°æ®åå°è¾¾ docker0\n\n[root@localhost ~]# docker exec nginx1 ip r\ndefault via 172.17.0.1 dev eth0 \n172.17.0.0/16 dev eth0  proto kernel  scope link  src 172.17.0.2 \n\n\n1\n2\n3\n\n\nå½éè¿ nginx1 ping nginx2 ç ip æ¶ï¼æè¿çå¬ docker0 ç½å¡çä¸ä¸æ°æ®åï¼\n\n[root@localhost ~]# docker exec -it nginx1 ping 172.17.0.3 -c 3\n\n[root@localhost ~]# tcpdump -i docker0\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on docker0, link-type en10mb (ethernet), capture size 262144 bytes\n04:32:57.596814 arp, request who-has 172.17.0.3 tell 172.17.0.2, length 28\n04:32:57.596848 arp, reply 172.17.0.3 is-at 02:42:ac:11:00:03 (oui unknown), length 28\n04:32:57.596853 ip 172.17.0.2 > 172.17.0.3: icmp echo request, id 17, seq 1, length 64\n04:32:57.596896 ip 172.17.0.3 > 172.17.0.2: icmp echo reply, id 17, seq 1, length 64\n04:32:58.596437 ip 172.17.0.2 > 172.17.0.3: icmp echo request, id 17, seq 2, length 64\n04:32:58.596492 ip 172.17.0.3 > 172.17.0.2: icmp echo reply, id 17, seq 2, length 64\n04:32:59.596444 ip 172.17.0.2 > 172.17.0.3: icmp echo request, id 17, seq 3, length 64\n04:32:59.596491 ip 172.17.0.3 > 172.17.0.2: icmp echo reply, id 17, seq 3, length 64\n04:33:02.598361 arp, request who-has 172.17.0.2 tell 172.17.0.3, length 28\n04:33:02.598386 arp, reply 172.17.0.2 is-at 02:42:ac:11:00:02 (oui unknown), length 28\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nç±ä¸å¯ç¥ï¼nginx1(10.17.0.2) ä¼åé arp è·å nginx2(10.17.0.3) ç mac å°åï¼ç¶åä½¿ç¨è¯¥ mac å°åéè¿äºå±è®¾å¤ bridge å nginx2 è½¬åæ°æ®åï¼è¿å¥å°äº nginx2 ç network namespace ä¸­ï¼ç±å®çç½ç»æ å¤çè¯¥æ°æ®åï¼æåååã\n\n\n\n\n# å®¹å¨è¿æ¥å¶ä»ä¸»æº\n\nå®¹å¨åè¿æ¥å¶ä»ä¸»æºæ¶ï¼æ¯å¦ ping 10.65.132.187 æ¶ï¼ä¼åéè¿ docker0 è¾¾å°å®¿ä¸»æºä¸ï¼ç¶åéè¿å®¿ä¸»æºçç½ç»æ å¤çã\n\néè¿æ¥çå®¿ä¸»æºè·¯ç±è¡¨ï¼å°è¾¾å®¿ä¸»æºçæ°æ®è¡¨ä¼èµ°ç¬¬ä¸æ¡é»è®¤è·¯ç±ï¼éè¿ eth0 ç½å¡ä¸ä¸è·³å° 10.61.74.1ï¼ç¶åæç»è¾¾å°å¦ä¸å°ä¸»æºç eth0 ä¸­ã\n\n[root@localhost ~]# ip r\ndefault via 10.61.74.1 dev eth0 proto static metric 100 \n10.61.74.0/23 dev eth0 proto kernel scope link src 10.61.74.37 metric 100 \n172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1\n\n\n1\n2\n3\n4\n\n\n\n\n\n# container\n\nä½¿ç¨è¯¥æ¨¡å¼çå®¹å¨ä¼å å¥å°æå®å®¹å¨ç network namespace ä¸­ï¼ä¹å°±æ¯ä¸¤ä¸ªå®¹å¨å±ç¨åä¸ä¸ªç½ç»æ ã\n\né¦åä½¿ç¨ bridge æ¨¡å¼åå»ºå®¹å¨ nginx1ï¼è¯¥å®¹å¨ä¼æ¥æèªå·±ç network namespaceï¼ç¶ååä½¿ç¨ container æ¨¡å¼åå»º nginx2 å®¹å¨å¹¶å å¥ nginx1 ç network namespace ä¸­ã\n\néè¿æ¥çä¸¤ä¸ªå®¹å¨çç½å¡å¯ä»¥åç°ä¸¤ä¸ªæ¯ä¸æ ·çã\n\n[root@localhost ~]# docker run -d --name nginx1 nginx\n[root@localhost ~]# docker exec -it nginx1 ip a\n1: lo: <loopback,up,lower_up> mtu 65536 qdisc noqueue state unknown group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n56: eth0@if57: <broadcast,multicast,up,lower_up> mtu 1500 qdisc noqueue state up group default \n    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n\n[root@localhost ~]# docker run -it --name nginx2 --net=container:nginx1 nginx /bin/bash\n\n[ root@20069e4c2bde:/etc/nginx ]$ ip a\n1: lo: <loopback,up,lower_up> mtu 65536 qdisc noqueue state unknown group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n56: eth0@if57: <broadcast,multicast,up,lower_up> mtu 1500 qdisc noqueue state up group default \n    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n\n\n# none\n\nè¯¥æ¨¡å¼åå»ºå®¹å¨ä¹ä¼åå»ºæ°çå±äºèªå·±ç network namespaceï¼ä½æ¯å®¹å¨åä¸ä¼æä»»ä½çç½ç»éç½®ï¼æ²¡æç½å¡ãè·¯ç±ãè·¯ç±ç­ä¿¡æ¯ï¼éè¦ç±æä»¬èªå·±å»éç½®ã\n\n[root@localhost ~]# docker run -it --name nginx --net=none nginx /bin/bash\n\n[ root@52480b0a4725:/etc/nginx ]$ ip a\n1: lo: <loopback,up,lower_up> mtu 65536 qdisc noqueue state unknown group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n[ root@52480b0a4725:/etc/nginx ]$ ip r\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n",charsets:{cjk:!0},lastUpdated:"2023/01/15, 20:17:10",lastUpdatedTimestamp:167378503e4},{title:"k8sä¹Pod",frontmatter:{tags:["k8s","å®¹å¨","äºåç"],author:{name:"msqfx",link:"https://github.com/msqfx"},title:"k8sä¹Pod",date:"2022-08-30T12:48:34.000Z",permalink:"/pages/2b547f/",description:"ä»ç»k8sä¸­çpodèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾",feed:{enable:!0},categories:["äºåç","k8s"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220331113937.png#crop=0&crop=0&crop=1&crop=1&id=mo242&originHeight=381&originWidth=481&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="},{name:"twitter:title",content:"k8sä¹Pod"},{name:"twitter:description",content:"ä»ç»k8sä¸­çpodèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220331113937.png#crop=0&crop=0&crop=1&crop=1&id=mo242&originHeight=381&originWidth=481&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/03.k8s%E4%B9%8Bpod.html"},{property:"og:type",content:"article"},{property:"og:title",content:"k8sä¹Pod"},{property:"og:description",content:"ä»ç»k8sä¸­çpodèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220331113937.png#crop=0&crop=0&crop=1&crop=1&id=mo242&originHeight=381&originWidth=481&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/03.k8s%E4%B9%8Bpod.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-30T12:48:34.000Z"},{property:"article:tag",content:"k8s"},{property:"article:tag",content:"å®¹å¨"},{property:"article:tag",content:"äºåç"},{itemprop:"name",content:"k8sä¹Pod"},{itemprop:"description",content:"ä»ç»k8sä¸­çpodèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220331113937.png#crop=0&crop=0&crop=1&crop=1&id=mo242&originHeight=381&originWidth=481&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/03.k8s%E4%B9%8Bpod.html",relativePath:"01.äºåç/07.k8s/03.k8sä¹pod.md",key:"v-fdfd34bc",path:"/pages/2b547f/",headers:[{level:2,title:"ä»ä¹æ¯pod?",slug:"ä»ä¹æ¯pod",normalizedTitle:"ä»ä¹æ¯pod?",charIndex:2},{level:2,title:"ä¸ºä»ä¹éè¦Pod?",slug:"ä¸ºä»ä¹éè¦pod",normalizedTitle:"ä¸ºä»ä¹éè¦pod?",charIndex:110},{level:2,title:"ä½¿ç¨Pod",slug:"ä½¿ç¨pod",normalizedTitle:"ä½¿ç¨pod",charIndex:615},{level:2,title:"å®¹å¨ç¶ææ¢é",slug:"å®¹å¨ç¶ææ¢é",normalizedTitle:"å®¹å¨ç¶ææ¢é",charIndex:1959},{level:2,title:"èµæºéç½®",slug:"èµæºéç½®",normalizedTitle:"èµæºéç½®",charIndex:2292}],headersStr:"ä»ä¹æ¯pod? ä¸ºä»ä¹éè¦Pod? ä½¿ç¨Pod å®¹å¨ç¶ææ¢é èµæºéç½®",content:'# ä»ä¹æ¯pod?\n\nPodæ¯ä¸ç»å±äº«äºæäºèµæºçå®¹å¨ã\n\nå®¹å¨çéç¦»æ¯éè¿åç§namespaceæ¥å®ç°çï¼Pod éçææå®¹å¨ï¼å¯ä»¥éè¿Namespaceæ¥å±äº«ç³»ç»èµæºï¼åNetwork Namepsaceã\n\n\n# ä¸ºä»ä¹éè¦Pod?\n\nä¼æå¨ç¥æå¨ç¥ï¼å®¹å¨æ¯ä¸ä¸ªç¹æ®çè¿ç¨ï¼ä½æäºåºæ¯æ¯ï¼ä¸ä¸ªåºç¨çè¿è¡ï¼æ¯éè¦å¤ä¸ªè¿ç¨ç»åä½¿ç¨ï¼å¹¶æä¸å®çä¾èµå³ç³»çãè½ç¶æä»¬ä¹å¯ä»¥ä½¿ç¨åç¬çå®¹å¨æ¥éç½®è¿è¡åºç¨ï¼ä½æ¯é½æ¯ç¬ç«çãèpodæ¯k8sçåå­è°åº¦ï¼podä¸­çå®¹å¨å¯ä»¥æå®åéå°åä¸ä¸ªèç¹ï¼ç»ä¸æç§èµæºè°åº¦ã\n\nä½¿ç¨dockerä¹å¯ä»¥å®ç°AãBå®¹å¨å±äº«ç½ç»åVolumeï¼ä½æ¯å®¹å¨Bå¿é¡»æ¯å®¹å¨Aåå¯å¨ï¼æ¯ä¸ä¸ªææç»æï¼èä¸æ¯å¹³ç­å³ç³»\n\n$ docker run --net=B --volumes-from=B --name=A image-A ...\n\n\n1\n\n\nå¨Podä¸­ï¼ååå»ºå¯å¨çæ¯Infraå®¹å¨ï¼è¯¥å®¹å¨ä¼å¤äºä¸ä¸ªç¦æ­¢ç¶æï¼èå¶ä»å®ä¹çå®¹å¨ï¼åéè¿Join Network Namespaceä¸Infraå®¹å¨è¿æ¥å¨ä¸èµ·ã\n\n\n\nå¨Podä¸­çå®¹å¨å¤äºåä¸ä¸ªNetwork Namespaceä¸­ï¼æä»¥å¯ä»¥éè¿localhostç´æ¥è¿è¡éä¿¡ï¼çå°çç½ç»è®¾å¤æ¯ä¸è´çãèPodççå½å¨æåInfraå®¹å¨ä¸è´ï¼åå®¹å¨AãBæ å³ã\n\nPodï¼å®éä¸æ¯å¨æ®æ¼ä¼ ç»åºç¡è®¾æ½éâèææºâçè§è²ï¼èå®¹å¨ï¼åæ¯è¿ä¸ªèææºéè¿è¡çç¨æ·ç¨åºã\n\n\n# ä½¿ç¨Pod\n\nä½¿ç¨yamlæ¥æè¿°ä¸ä¸ªPodã\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-pod\n\nspec:\n  containers:\n  - name: nginx\n    image: nginx:laster\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nåä½¿ç¨kubectl applyæ¥åå»ºpod\n\n[root@k8s-worker1 zwf]# kubectl apply -f pod.yaml -n zwf\npod/nginx-pod created\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf -o wide\nNAME        READY   STATUS    RESTARTS   AGE     IP              NODE          NOMINATED NODE   READINESS GATES\nnginx-pod   1/1     Running   0          2m51s   10.222.126.60   k8s-worker2   <none>           <none>\n\n\n1\n2\n3\n4\n5\n6\n\n\næä»¬å¯ä»¥ä½¿ç¨curlè®¿é®å°podä¸­çnginxçæå¡äº\n\n[root@k8s-worker1 zwf]# curl 10.222.126.60:80\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\nhtml { color-scheme: light dark; }\nbody { width: 35em; margin: 0 auto;\nfont-family: Tahoma, Verdana, Arial, sans-serif; }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href="http://nginx.org/">nginx.org</a>.<br/>\nCommercial support is available at\n<a href="http://nginx.com/">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nä¸è¬æä»¬ä¸ç´æ¥åå»ºPodï¼èæ¯éè¿åç§æ§å¶å¨æ¥ç®¡çåå»º\n\n\n# å®¹å¨ç¶ææ¢é\n\n * ReadinessProbe\n\nå°±ç»ªæ§æ¢éï¼å¤æ­å®¹å¨ä¸­çç¨åºæ¯å¦å¥åº·ï¼ä¸å¥åº·ï¼åä¼å°è¯¥podä»serviceå¯ç¨ç«¯ç¹åè¡¨ç§»é¤ã\n\n * livenessProbe\n\nå­æ´»æ§æ¢éï¼å¤æ­å®¹å¨æ¯å¦å¥åº·ï¼ä¸å¥åº·ï¼åä¼å°å®¹å¨éå¯ã æ³¨æï¼æ¯å°å®¹å¨éå¯èä¸æ¯pod\n\n * startupProbe\n\nå¨podå¯å¨åæç§éç½®æ§è¡ä¸æ¬¡ï¼å¦ææåï¼åä¸åæ§è¡ï¼å¦æå¤±è´¥ï¼åä¼éå¯pod. å¶ä»ä¸¤ä¸ªæ¢éæ¯å¨startupProbeè¿è¡æåä¹åé½æ¯æåçã\n\næ¢æµæ¹å¼\n\n * execï¼æ§è¡ä¸ä¸ªLinuxå½ä»¤ï¼çè¿åå¼\n\n * tcpSocketï¼ä½¿ç¨tcpå°è¯è¿æ¥æä¸ªç«¯å£ï¼çæ¯å¦è¿æ¥æå\n\n * httpGetï¼å°è¯ä½¿ç¨httpè¯·æ±ï¼çæ¯å¦è¯·æ±æå\n\n\n# èµæºéç½®\n\nå¨éç½®ä¸­ä½¿ç¨resourceså­æ®µæ¥è®¾ç½®éå¶å®¹å¨çèµæºã\n\n * requestsï¼ç³»ç»å¿é¡»é¢ççå¯ç¨èµæº\n\n * limitsï¼å®¹å¨å¯ç³è¯·ä½¿ç¨çæå¤§å¯ç¨èµæºï¼è¶è¿åä¼è¢«killçå¯è½æ§\n\nè¿éçcpuä½¿ç¨çæ¯m(milli)çåä½ï¼1000mä»£è¡¨1ä¸ªcpuï¼10mä»£è¡¨1%cpu\n\nèåå­ä½¿ç¨Miä»£è¡¨MBã\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: ngx-pod-resources\n\nspec:\n  containers:\n  - image: nginx:alpine\n    name: ngx\n\n    resources:\n      requests:\n        cpu: 10m\n        memory: 100Mi\n      limits:\n        cpu: 20m\n        memory: 200Mi\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\næä»¬åæ¥ççæ¯æä¹ä½¿ç¨cgroupæ¥éå¶podä¸­å®¹å¨çèµæº\n\nåæ¾å°podä¸­è¯¥å®¹å¨çID\n\n>>> kubectl describe pod -n zwf ngx-pod-resources\nName:         ngx-pod-resources\nNamespace:    zwf\nPriority:     0\nNode:         k8s-worker1/10.64.2.141\nStart Time:   Tue, 30 Aug 2022 16:11:45 +0800\nLabels:       <none>\nAnnotations:  cni.projectcalico.org/containerID: 4c8f23863e6589d44b96ded48a2abd857ca9e45637fb9dd6b106c3c217be0904\n              cni.projectcalico.org/podIP: 10.222.194.100/32\n              cni.projectcalico.org/podIPs: 10.222.194.100/32\nStatus:       Running\nIP:           10.222.194.100\nIPs:\n  IP:  10.222.194.100\nContainers:\n  ngx:\n    Container ID:   docker://c60e370dd413f240164aec3f98cb35a8d09f6a3833c414a6c7a767d51977b859\n    Image:          nginx:alpine\n    Image ID:       docker-pullable://nginx@sha256:082f8c10bd47b6acc8ef15ae61ae45dd8fde0e9f389a8b5cb23c37408642bf5d\n    Port:           <none>\n    Host Port:      <none>\n    State:          Running\n      Started:      Tue, 30 Aug 2022 16:11:54 +0800\n    Ready:          True\n    Restart Count:  0\n    Limits:\n      cpu:     20m\n      memory:  200Mi\n    Requests:\n      cpu:        10m\n      memory:     100Mi\n    Environment:  <none>\n    Mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-jcccn (ro)\n\n....\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n\nç¶ååéè¿docker inspectæ¾å°éå¶è¯¥å®¹å¨çcgroupçè·¯å¾\n\n>>> docker inspect c60e37 | grep Cgroup\n            "CgroupnsMode": "host",\n            "Cgroup": "",\n            "CgroupParent": "/kubepods/burstable/poda9ca2eed-ef7b-4564-b448-e35b06c7bdd0",\n            "DeviceCgroupRules": null\n\n\n1\n2\n3\n4\n5\n\n\næä»¬åè¿å¥å°/sys/fs/cgroup/cpu/kubepods/burstable/poda9ca2eed-ef7b-4564-b448-e35b06c7bdd0ï¼å¯ä»¥çå°æä¸¤ä¸ªå®¹å¨IDçç®å½ï¼å ä¸ºé¤äºæä»¬nginxå®¹å¨ä¹å¤ï¼è¿æä¸ä¸ªinfraå®¹å¨ã\n\n[root@k8s-worker1]# cd /sys/fs/cgroup/cpu/kubepods/burstable/poda9ca2eed-ef7b-4564-b448-e35b06c7bdd0\n\n[root@k8s-worker1]# ls\n4c8f23863e6589d44b96ded48a2abd857ca9e45637fb9dd6b106c3c217be0904  cpuacct.usage              cpuacct.usage_sys   cpu.rt_runtime_us\nc60e370dd413f240164aec3f98cb35a8d09f6a3833c414a6c7a767d51977b859  cpuacct.usage_all          cpuacct.usage_user  cpu.shares\ncgroup.clone_children                                             cpuacct.usage_percpu       cpu.cfs_period_us   cpu.stat\ncgroup.procs                                                      cpuacct.usage_percpu_sys   cpu.cfs_quota_us    notify_on_release\ncpuacct.stat                                                      cpuacct.usage_percpu_user  cpu.rt_period_us    tasks\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næä»¬è¿å¥å°nginxçå®¹å¨IDç®å½ä¸ï¼æ¥çtasksæä»¶ï¼åç°æå¾å¤è¿ç¨IDï¼ä¸ºä»ä¹å¢ï¼\n\n[root@k8s-worker1 c60e370dd413f240164aec3f98cb35a8d09f6a3833c414a6c7a767d51977b859]# cat tasks\n2733304\n2733402\n2733403\n2733404\n2733405\n2733406\n2733407\n2733408\n2733409\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå®¹å¨å°±æ¯ä¸ä¸ªéç¦»çè¿ç¨ï¼æä»¬çä¸è¯¥å®¹å¨çè¿ç¨IDï¼åéè¿è¯¥IDæ¾å°è¯¥è¿ç¨ï¼ç¡®å®æ¯nginxæ²¡éï¼ä¹å¨cgroupçtasksæä»¶ä¸­ï¼ä½æ¯å¶ä»çè¿ç¨IDæ¯ä»ä¹å¢ï¼\n\n[root@k8s-worker1 c60e370dd413f240164aec3f98cb35a8d09f6a3833c414a6c7a767d51977b859]# docker inspect c60e | grep Pid\n            "Pid": 2733304,\n            "PidMode": "",\n            "PidsLimit": null,\n            \n[root@k8s-worker1 c60e370dd413f240164aec3f98cb35a8d09f6a3833c414a6c7a767d51977b859]# ps aux | grep 2733304\nroot     2733304  0.0  0.0   6304  4544 ?        Ss   16:11   0:00 nginx: master process nginx -g daemon off;\nroot     2787238  0.0  0.0  12132  1156 pts/3    S+   16:45   0:00 grep --color=auto 2733304\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næéè¿ps auxæ¥æç´¢ä¸ä¸nginxï¼å®¹å¨IDä¸ºnginx masterï¼èå¶ä»çè¿ç¨IDé½æ¯nginxçworkerè¿ç¨ã\n\n[root@k8s-worker1 c60e370dd413f240164aec3f98cb35a8d09f6a3833c414a6c7a767d51977b859]# ps aux | grep nginx\nroot     2733304  0.0  0.0   6304  4544 ?        Ss   16:11   0:00 nginx: master process nginx -g daemon off;\n101      2733402  0.0  0.0   6760  1648 ?        S    16:11   0:00 nginx: worker process\n101      2733403  0.0  0.0   6760  1648 ?        S    16:11   0:00 nginx: worker process\n101      2733404  0.0  0.0   6760  1648 ?        S    16:11   0:00 nginx: worker process\n101      2733405  0.0  0.0   6760  1648 ?        S    16:11   0:00 nginx: worker process\n101      2733406  0.0  0.0   6760  1648 ?        S    16:11   0:00 nginx: worker process\n101      2733407  0.0  0.0   6760  1648 ?        S    16:11   0:00 nginx: worker process\n101      2733408  0.0  0.0   6760  1648 ?        S    16:11   0:00 nginx: worker process\n101      2733409  0.0  0.0   6760  1648 ?        S    16:11   0:00 nginx: worker process\nroot     2781594  0.0  0.0  12132  1164 pts/3    S+   16:41   0:00 grep --color=auto nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n',normalizedContent:'# ä»ä¹æ¯pod?\n\npodæ¯ä¸ç»å±äº«äºæäºèµæºçå®¹å¨ã\n\nå®¹å¨çéç¦»æ¯éè¿åç§namespaceæ¥å®ç°çï¼pod éçææå®¹å¨ï¼å¯ä»¥éè¿namespaceæ¥å±äº«ç³»ç»èµæºï¼ånetwork namepsaceã\n\n\n# ä¸ºä»ä¹éè¦pod?\n\nä¼æå¨ç¥æå¨ç¥ï¼å®¹å¨æ¯ä¸ä¸ªç¹æ®çè¿ç¨ï¼ä½æäºåºæ¯æ¯ï¼ä¸ä¸ªåºç¨çè¿è¡ï¼æ¯éè¦å¤ä¸ªè¿ç¨ç»åä½¿ç¨ï¼å¹¶æä¸å®çä¾èµå³ç³»çãè½ç¶æä»¬ä¹å¯ä»¥ä½¿ç¨åç¬çå®¹å¨æ¥éç½®è¿è¡åºç¨ï¼ä½æ¯é½æ¯ç¬ç«çãèpodæ¯k8sçåå­è°åº¦ï¼podä¸­çå®¹å¨å¯ä»¥æå®åéå°åä¸ä¸ªèç¹ï¼ç»ä¸æç§èµæºè°åº¦ã\n\nä½¿ç¨dockerä¹å¯ä»¥å®ç°aãbå®¹å¨å±äº«ç½ç»åvolumeï¼ä½æ¯å®¹å¨bå¿é¡»æ¯å®¹å¨aåå¯å¨ï¼æ¯ä¸ä¸ªææç»æï¼èä¸æ¯å¹³ç­å³ç³»\n\n$ docker run --net=b --volumes-from=b --name=a image-a ...\n\n\n1\n\n\nå¨podä¸­ï¼ååå»ºå¯å¨çæ¯infraå®¹å¨ï¼è¯¥å®¹å¨ä¼å¤äºä¸ä¸ªç¦æ­¢ç¶æï¼èå¶ä»å®ä¹çå®¹å¨ï¼åéè¿join network namespaceä¸infraå®¹å¨è¿æ¥å¨ä¸èµ·ã\n\n\n\nå¨podä¸­çå®¹å¨å¤äºåä¸ä¸ªnetwork namespaceä¸­ï¼æä»¥å¯ä»¥éè¿localhostç´æ¥è¿è¡éä¿¡ï¼çå°çç½ç»è®¾å¤æ¯ä¸è´çãèpodççå½å¨æåinfraå®¹å¨ä¸è´ï¼åå®¹å¨aãbæ å³ã\n\npodï¼å®éä¸æ¯å¨æ®æ¼ä¼ ç»åºç¡è®¾æ½éâèææºâçè§è²ï¼èå®¹å¨ï¼åæ¯è¿ä¸ªèææºéè¿è¡çç¨æ·ç¨åºã\n\n\n# ä½¿ç¨pod\n\nä½¿ç¨yamlæ¥æè¿°ä¸ä¸ªpodã\n\napiversion: v1\nkind: pod\nmetadata:\n  name: nginx-pod\n\nspec:\n  containers:\n  - name: nginx\n    image: nginx:laster\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nåä½¿ç¨kubectl applyæ¥åå»ºpod\n\n[root@k8s-worker1 zwf]# kubectl apply -f pod.yaml -n zwf\npod/nginx-pod created\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf -o wide\nname        ready   status    restarts   age     ip              node          nominated node   readiness gates\nnginx-pod   1/1     running   0          2m51s   10.222.126.60   k8s-worker2   <none>           <none>\n\n\n1\n2\n3\n4\n5\n6\n\n\næä»¬å¯ä»¥ä½¿ç¨curlè®¿é®å°podä¸­çnginxçæå¡äº\n\n[root@k8s-worker1 zwf]# curl 10.222.126.60:80\n<!doctype html>\n<html>\n<head>\n<title>welcome to nginx!</title>\n<style>\nhtml { color-scheme: light dark; }\nbody { width: 35em; margin: 0 auto;\nfont-family: tahoma, verdana, arial, sans-serif; }\n</style>\n</head>\n<body>\n<h1>welcome to nginx!</h1>\n<p>if you see this page, the nginx web server is successfully installed and\nworking. further configuration is required.</p>\n\n<p>for online documentation and support please refer to\n<a href="http://nginx.org/">nginx.org</a>.<br/>\ncommercial support is available at\n<a href="http://nginx.com/">nginx.com</a>.</p>\n\n<p><em>thank you for using nginx.</em></p>\n</body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nä¸è¬æä»¬ä¸ç´æ¥åå»ºpodï¼èæ¯éè¿åç§æ§å¶å¨æ¥ç®¡çåå»º\n\n\n# å®¹å¨ç¶ææ¢é\n\n * readinessprobe\n\nå°±ç»ªæ§æ¢éï¼å¤æ­å®¹å¨ä¸­çç¨åºæ¯å¦å¥åº·ï¼ä¸å¥åº·ï¼åä¼å°è¯¥podä»serviceå¯ç¨ç«¯ç¹åè¡¨ç§»é¤ã\n\n * livenessprobe\n\nå­æ´»æ§æ¢éï¼å¤æ­å®¹å¨æ¯å¦å¥åº·ï¼ä¸å¥åº·ï¼åä¼å°å®¹å¨éå¯ã æ³¨æï¼æ¯å°å®¹å¨éå¯èä¸æ¯pod\n\n * startupprobe\n\nå¨podå¯å¨åæç§éç½®æ§è¡ä¸æ¬¡ï¼å¦ææåï¼åä¸åæ§è¡ï¼å¦æå¤±è´¥ï¼åä¼éå¯pod. å¶ä»ä¸¤ä¸ªæ¢éæ¯å¨startupprobeè¿è¡æåä¹åé½æ¯æåçã\n\næ¢æµæ¹å¼\n\n * execï¼æ§è¡ä¸ä¸ªlinuxå½ä»¤ï¼çè¿åå¼\n\n * tcpsocketï¼ä½¿ç¨tcpå°è¯è¿æ¥æä¸ªç«¯å£ï¼çæ¯å¦è¿æ¥æå\n\n * httpgetï¼å°è¯ä½¿ç¨httpè¯·æ±ï¼çæ¯å¦è¯·æ±æå\n\n\n# èµæºéç½®\n\nå¨éç½®ä¸­ä½¿ç¨resourceså­æ®µæ¥è®¾ç½®éå¶å®¹å¨çèµæºã\n\n * requestsï¼ç³»ç»å¿é¡»é¢ççå¯ç¨èµæº\n\n * limitsï¼å®¹å¨å¯ç³è¯·ä½¿ç¨çæå¤§å¯ç¨èµæºï¼è¶è¿åä¼è¢«killçå¯è½æ§\n\nè¿éçcpuä½¿ç¨çæ¯m(milli)çåä½ï¼1000mä»£è¡¨1ä¸ªcpuï¼10mä»£è¡¨1%cpu\n\nèåå­ä½¿ç¨miä»£è¡¨mbã\n\napiversion: v1\nkind: pod\nmetadata:\n  name: ngx-pod-resources\n\nspec:\n  containers:\n  - image: nginx:alpine\n    name: ngx\n\n    resources:\n      requests:\n        cpu: 10m\n        memory: 100mi\n      limits:\n        cpu: 20m\n        memory: 200mi\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\næä»¬åæ¥ççæ¯æä¹ä½¿ç¨cgroupæ¥éå¶podä¸­å®¹å¨çèµæº\n\nåæ¾å°podä¸­è¯¥å®¹å¨çid\n\n>>> kubectl describe pod -n zwf ngx-pod-resources\nname:         ngx-pod-resources\nnamespace:    zwf\npriority:     0\nnode:         k8s-worker1/10.64.2.141\nstart time:   tue, 30 aug 2022 16:11:45 +0800\nlabels:       <none>\nannotations:  cni.projectcalico.org/containerid: 4c8f23863e6589d44b96ded48a2abd857ca9e45637fb9dd6b106c3c217be0904\n              cni.projectcalico.org/podip: 10.222.194.100/32\n              cni.projectcalico.org/podips: 10.222.194.100/32\nstatus:       running\nip:           10.222.194.100\nips:\n  ip:  10.222.194.100\ncontainers:\n  ngx:\n    container id:   docker://c60e370dd413f240164aec3f98cb35a8d09f6a3833c414a6c7a767d51977b859\n    image:          nginx:alpine\n    image id:       docker-pullable://nginx@sha256:082f8c10bd47b6acc8ef15ae61ae45dd8fde0e9f389a8b5cb23c37408642bf5d\n    port:           <none>\n    host port:      <none>\n    state:          running\n      started:      tue, 30 aug 2022 16:11:54 +0800\n    ready:          true\n    restart count:  0\n    limits:\n      cpu:     20m\n      memory:  200mi\n    requests:\n      cpu:        10m\n      memory:     100mi\n    environment:  <none>\n    mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-jcccn (ro)\n\n....\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n\nç¶ååéè¿docker inspectæ¾å°éå¶è¯¥å®¹å¨çcgroupçè·¯å¾\n\n>>> docker inspect c60e37 | grep cgroup\n            "cgroupnsmode": "host",\n            "cgroup": "",\n            "cgroupparent": "/kubepods/burstable/poda9ca2eed-ef7b-4564-b448-e35b06c7bdd0",\n            "devicecgrouprules": null\n\n\n1\n2\n3\n4\n5\n\n\næä»¬åè¿å¥å°/sys/fs/cgroup/cpu/kubepods/burstable/poda9ca2eed-ef7b-4564-b448-e35b06c7bdd0ï¼å¯ä»¥çå°æä¸¤ä¸ªå®¹å¨idçç®å½ï¼å ä¸ºé¤äºæä»¬nginxå®¹å¨ä¹å¤ï¼è¿æä¸ä¸ªinfraå®¹å¨ã\n\n[root@k8s-worker1]# cd /sys/fs/cgroup/cpu/kubepods/burstable/poda9ca2eed-ef7b-4564-b448-e35b06c7bdd0\n\n[root@k8s-worker1]# ls\n4c8f23863e6589d44b96ded48a2abd857ca9e45637fb9dd6b106c3c217be0904  cpuacct.usage              cpuacct.usage_sys   cpu.rt_runtime_us\nc60e370dd413f240164aec3f98cb35a8d09f6a3833c414a6c7a767d51977b859  cpuacct.usage_all          cpuacct.usage_user  cpu.shares\ncgroup.clone_children                                             cpuacct.usage_percpu       cpu.cfs_period_us   cpu.stat\ncgroup.procs                                                      cpuacct.usage_percpu_sys   cpu.cfs_quota_us    notify_on_release\ncpuacct.stat                                                      cpuacct.usage_percpu_user  cpu.rt_period_us    tasks\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næä»¬è¿å¥å°nginxçå®¹å¨idç®å½ä¸ï¼æ¥çtasksæä»¶ï¼åç°æå¾å¤è¿ç¨idï¼ä¸ºä»ä¹å¢ï¼\n\n[root@k8s-worker1 c60e370dd413f240164aec3f98cb35a8d09f6a3833c414a6c7a767d51977b859]# cat tasks\n2733304\n2733402\n2733403\n2733404\n2733405\n2733406\n2733407\n2733408\n2733409\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå®¹å¨å°±æ¯ä¸ä¸ªéç¦»çè¿ç¨ï¼æä»¬çä¸è¯¥å®¹å¨çè¿ç¨idï¼åéè¿è¯¥idæ¾å°è¯¥è¿ç¨ï¼ç¡®å®æ¯nginxæ²¡éï¼ä¹å¨cgroupçtasksæä»¶ä¸­ï¼ä½æ¯å¶ä»çè¿ç¨idæ¯ä»ä¹å¢ï¼\n\n[root@k8s-worker1 c60e370dd413f240164aec3f98cb35a8d09f6a3833c414a6c7a767d51977b859]# docker inspect c60e | grep pid\n            "pid": 2733304,\n            "pidmode": "",\n            "pidslimit": null,\n            \n[root@k8s-worker1 c60e370dd413f240164aec3f98cb35a8d09f6a3833c414a6c7a767d51977b859]# ps aux | grep 2733304\nroot     2733304  0.0  0.0   6304  4544 ?        ss   16:11   0:00 nginx: master process nginx -g daemon off;\nroot     2787238  0.0  0.0  12132  1156 pts/3    s+   16:45   0:00 grep --color=auto 2733304\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næéè¿ps auxæ¥æç´¢ä¸ä¸nginxï¼å®¹å¨idä¸ºnginx masterï¼èå¶ä»çè¿ç¨idé½æ¯nginxçworkerè¿ç¨ã\n\n[root@k8s-worker1 c60e370dd413f240164aec3f98cb35a8d09f6a3833c414a6c7a767d51977b859]# ps aux | grep nginx\nroot     2733304  0.0  0.0   6304  4544 ?        ss   16:11   0:00 nginx: master process nginx -g daemon off;\n101      2733402  0.0  0.0   6760  1648 ?        s    16:11   0:00 nginx: worker process\n101      2733403  0.0  0.0   6760  1648 ?        s    16:11   0:00 nginx: worker process\n101      2733404  0.0  0.0   6760  1648 ?        s    16:11   0:00 nginx: worker process\n101      2733405  0.0  0.0   6760  1648 ?        s    16:11   0:00 nginx: worker process\n101      2733406  0.0  0.0   6760  1648 ?        s    16:11   0:00 nginx: worker process\n101      2733407  0.0  0.0   6760  1648 ?        s    16:11   0:00 nginx: worker process\n101      2733408  0.0  0.0   6760  1648 ?        s    16:11   0:00 nginx: worker process\n101      2733409  0.0  0.0   6760  1648 ?        s    16:11   0:00 nginx: worker process\nroot     2781594  0.0  0.0  12132  1164 pts/3    s+   16:41   0:00 grep --color=auto nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n',charsets:{cjk:!0},lastUpdated:"2023/01/15, 20:17:10",lastUpdatedTimestamp:167378503e4},{title:"CompletableFutureå­¦ä¹ ",frontmatter:{title:"CompletableFutureå­¦ä¹ ",date:"2023-08-11T15:44:06.000Z",permalink:"/pages/f6a447/",author:{name:"éä¸æ¸é£",link:"https://msqfx.github.io"},categories:["java","å¹¶åç¯"],tags:[null],description:"æä»¬å¼æ­¥æ§è¡ä¸ä¸ªä»»å¡æ¶ï¼ä¸è¬æ¯ç¨çº¿ç¨æ±  Executor å»åå»ºã",comment:!0,meta:[{name:"image",content:"https://cmty256.github.io/imgs-blog/Java/image.6ntc9cicslc0.webp"},{name:"twitter:title",content:"CompletableFutureå­¦ä¹ "},{name:"twitter:description",content:"æä»¬å¼æ­¥æ§è¡ä¸ä¸ªä»»å¡æ¶ï¼ä¸è¬æ¯ç¨çº¿ç¨æ±  Executor å»åå»ºã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://cmty256.github.io/imgs-blog/Java/image.6ntc9cicslc0.webp"},{name:"twitter:url",content:"https://www.msqfx.cc/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/05.CompletableFuture%E5%AD%A6%E4%B9%A0.html"},{property:"og:type",content:"article"},{property:"og:title",content:"CompletableFutureå­¦ä¹ "},{property:"og:description",content:"æä»¬å¼æ­¥æ§è¡ä¸ä¸ªä»»å¡æ¶ï¼ä¸è¬æ¯ç¨çº¿ç¨æ±  Executor å»åå»ºã"},{property:"og:image",content:"https://cmty256.github.io/imgs-blog/Java/image.6ntc9cicslc0.webp"},{property:"og:url",content:"https://www.msqfx.cc/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/05.CompletableFuture%E5%AD%A6%E4%B9%A0.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-08-11T15:44:06.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"CompletableFutureå­¦ä¹ "},{itemprop:"description",content:"æä»¬å¼æ­¥æ§è¡ä¸ä¸ªä»»å¡æ¶ï¼ä¸è¬æ¯ç¨çº¿ç¨æ±  Executor å»åå»ºã"},{itemprop:"image",content:"https://cmty256.github.io/imgs-blog/Java/image.6ntc9cicslc0.webp"}],readingShow:"top"},regularPath:"/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/05.CompletableFuture%E5%AD%A6%E4%B9%A0.html",relativePath:"01.java/03.å¹¶åç¯/05.CompletableFutureå­¦ä¹ .md",key:"v-d51b20aa",path:"/pages/f6a447/",headers:[{level:2,title:"åè¨",slug:"åè¨",normalizedTitle:"åè¨",charIndex:29},{level:2,title:"æºç è§£æ",slug:"æºç è§£æ",normalizedTitle:"æºç è§£æ",charIndex:384},{level:2,title:"ä»ä¹æ¯ CompletableFutureï¼",slug:"ä»ä¹æ¯-completablefuture",normalizedTitle:"ä»ä¹æ¯ completablefutureï¼",charIndex:942},{level:2,title:"ä½¿ç¨æ­¥éª¤",slug:"ä½¿ç¨æ­¥éª¤",normalizedTitle:"ä½¿ç¨æ­¥éª¤",charIndex:1102},{level:3,title:"åå»º CompletableFuture",slug:"åå»º-completablefuture",normalizedTitle:"åå»º completablefuture",charIndex:1111},{level:4,title:"new å³é®å­",slug:"new-å³é®å­",normalizedTitle:"new å³é®å­",charIndex:1150},{level:4,title:"éæå·¥åæ¹æ³",slug:"éæå·¥åæ¹æ³",normalizedTitle:"éæå·¥åæ¹æ³",charIndex:1186},{level:5,title:"supplyAsync æ¹æ³",slug:"supplyasync-æ¹æ³",normalizedTitle:"supplyasync æ¹æ³",charIndex:2482},{level:5,title:"runAsync æ¹æ³",slug:"runasync-æ¹æ³",normalizedTitle:"runasync æ¹æ³",charIndex:3329},{level:5,title:"å®ä¾ä»£ç ",slug:"å®ä¾ä»£ç ",normalizedTitle:"å®ä¾ä»£ç ",charIndex:3737},{level:3,title:"ç®åä»»å¡å¼æ­¥åè°",slug:"ç®åä»»å¡å¼æ­¥åè°",normalizedTitle:"ç®åä»»å¡å¼æ­¥åè°",charIndex:4614},{level:4,title:"å¤çå¼æ­¥ç»ç®ç»æ",slug:"å¤çå¼æ­¥ç»ç®ç»æ",normalizedTitle:"å¤çå¼æ­¥ç»ç®ç»æ",charIndex:4628},{level:5,title:"thenRun/thenRunAsync",slug:"thenrun-thenrunasync",normalizedTitle:"thenrun/thenrunasync",charIndex:4748},{level:5,title:"thenAccept/thenAcceptAsync",slug:"thenaccept-thenacceptasync",normalizedTitle:"thenaccept/thenacceptasync",charIndex:6305},{level:5,title:"thenApply/thenApplyAsync",slug:"thenapply-thenapplyasync",normalizedTitle:"thenapply/thenapplyasync",charIndex:7147},{level:5,title:"whenComplete()",slug:"whencomplete",normalizedTitle:"whencomplete()",charIndex:4730},{level:4,title:"å¼å¸¸å¤ç",slug:"å¼å¸¸å¤ç",normalizedTitle:"å¼å¸¸å¤ç",charIndex:9955},{level:3,title:"å¤ä¸ªä»»å¡ç»åå¤ç",slug:"å¤ä¸ªä»»å¡ç»åå¤ç",normalizedTitle:"å¤ä¸ªä»»å¡ç»åå¤ç",charIndex:11621},{level:4,title:"AND ç»åå³ç³»",slug:"and-ç»åå³ç³»",normalizedTitle:"and ç»åå³ç³»",charIndex:11633},{level:4,title:"allOf å¨é¨æ§è¡å®",slug:"allof-å¨é¨æ§è¡å®",normalizedTitle:"allof å¨é¨æ§è¡å®",charIndex:12787},{level:4,title:"anyOf ä»»ä¸æ§è¡å®",slug:"anyof-ä»»ä¸æ§è¡å®",normalizedTitle:"anyof ä»»ä¸æ§è¡å®",charIndex:13506},{level:2,title:"åè",slug:"åè",normalizedTitle:"åè",charIndex:14616}],headersStr:"åè¨ æºç è§£æ ä»ä¹æ¯ CompletableFutureï¼ ä½¿ç¨æ­¥éª¤ åå»º CompletableFuture new å³é®å­ éæå·¥åæ¹æ³ supplyAsync æ¹æ³ runAsync æ¹æ³ å®ä¾ä»£ç  ç®åä»»å¡å¼æ­¥åè° å¤çå¼æ­¥ç»ç®ç»æ thenRun/thenRunAsync thenAccept/thenAcceptAsync thenApply/thenApplyAsync whenComplete() å¼å¸¸å¤ç å¤ä¸ªä»»å¡ç»åå¤ç AND ç»åå³ç³» allOf å¨é¨æ§è¡å® anyOf ä»»ä¸æ§è¡å® åè",content:'# CompletableFuture å¼æ­¥ç¼ç¨\n\n\n# åè¨\n\næä»¬å¼æ­¥æ§è¡ä¸ä¸ªä»»å¡æ¶ï¼ä¸è¬æ¯ç¨çº¿ç¨æ±  Executor å»åå»ºã\n\n * å¦æä¸éè¦æè¿åå¼ï¼ä»»å¡å®ç° Runnable æ¥å£ï¼\n * å¦æéè¦æè¿åå¼ï¼ä»»å¡å®ç° Callable æ¥å£ï¼è°ç¨ Executor ç submit æ¹æ³ï¼åä½¿ç¨ Future è·åå³å¯ã\n\nå¦æå¤ä¸ªçº¿ç¨å­å¨ä¾èµç»åçè¯ï¼æä»¬æä¹å¤çå¢ï¼\n\n * å¯ä½¿ç¨åæ­¥ç»ä»¶ CountDownLatchãCyclicBarrier ç­ï¼ä½æ¯æ¯è¾éº»ç¦ã\n * å¶å®æç®åçæ¹æ³ï¼å°±æ¯ç¨ CompeletableFutureã\n\nå¨ç°ä»£çè½¯ä»¶å¼åä¸­ï¼å¤çå¹¶ååå¼æ­¥ä»»å¡åå¾è¶æ¥è¶éè¦ãJava ä¸­ç CompletableFuture ç±»ä¸ºæä»¬æä¾äºä¸ç§å¼ºå¤§çæ¹å¼æ¥å¤çå¼æ­¥ç¼ç¨ï¼è®©æä»¬è½å¤æ´ææå°å©ç¨å¤æ ¸å¤çå¨åå¹¶è¡æ§è¡ã\n\n\n# æºç è§£æ\n\næºç ï¼\n\npublic class CompletableFuture<T> implements Future<T>, CompletionStage<T> {\n}\n\n\n1\n2\n\n\nä»æºç å¯ä»¥çåº CompletableFuture åæ¶å®ç°äº Future å CompletionStage æ¥å£ã\n\nCompletableFuture é¤äºæä¾äºæ´ä¸ºå¥½ç¨åå¼ºå¤§ç Future ç¹æ§ä¹å¤ï¼è¿æä¾äºå½æ°å¼ç¼ç¨çè½åã\n\nFuture æ¥å£æ 5 ä¸ªæ¹æ³ï¼\n\n 1. boolean cancel(boolean mayInterruptIfRunning)ï¼å°è¯åæ¶æ§è¡ä»»å¡ã\n 2. boolean isCancelled()ï¼å¤æ­ä»»å¡æ¯å¦è¢«åæ¶ã\n 3. boolean isDone()ï¼å¤æ­ä»»å¡æ¯å¦å·²ç»è¢«æ§è¡å®æã\n 4. get()ï¼ç­å¾ä»»å¡æ§è¡å®æå¹¶è·åè¿ç®ç»æã\n 5. get(long timeout, TimeUnit unit)ï¼å¤äºä¸ä¸ªè¶æ¶æ¶é´ã\n\nCompletionStage æ¥å£\n\nCompletionStage æ¥å£æè¿°äºä¸ä¸ªå¼æ­¥è®¡ç®çé¶æ®µãå¾å¤è®¡ç®å¯ä»¥åæå¤ä¸ªé¶æ®µææ­¥éª¤ï¼æ­¤æ¶å¯ä»¥éè¿å®å°æææ­¥éª¤ç»åèµ·æ¥ï¼å½¢æå¼æ­¥è®¡ç®çæµæ°´çº¿ãï¼å¤§éä½¿ç¨äºå½æ°å¼ç¼ç¨ï¼\n\n\n# ä»ä¹æ¯ CompletableFutureï¼\n\nCompletableFuture æ¯ Java 8 å¼å¥çä¸ä¸ªç±»ï¼ç¨äºæ¯æå¼æ­¥ç¼ç¨åæä½å¤ä¸ªå¼æ­¥ä»»å¡ãå®æ¯ Future çæ©å±ï¼æä¾äºæ´å¤çåè½åçµæ´»æ§ãéè¿ CompletableFutureï¼æä»¬å¯ä»¥å°å¤ä¸ªå¼æ­¥ä»»å¡ä¸²è¡æå¹¶è¡æ§è¡ï¼ç¶åç­å¾å®ä»¬çå®æç»æã\n\n\n# ä½¿ç¨æ­¥éª¤\n\n\n# åå»º CompletableFuture\n\nå¸¸è§çæä¸¤ç§æ¹æ³\n\n 1. éè¿ new å³é®å­\n 2. åºäº CompletableFuture èªå¸¦çéæå·¥åæ¹æ³ï¼runAsync()ãsupplyAsync()ã\n\n# new å³é®å­\n\néè¿ new å³é®å­åå»º CompletableFuture å¯¹è±¡è¿ç§ä½¿ç¨æ¹å¼å¯ä»¥çä½æ¯å° CompletableFuture å½å Future æ¥ä½¿ç¨ã\n\nä¸¾ä¾ï¼\n\n * åå»ºå¼æ­¥è¿ç®çè½½ä½\n\nCompletableFuture<RpcResponse<Object>> resultFuture = new CompletableFuture<>();\n\n\n1\n\n\nä¸é¢ä»£ç åå»ºäºä¸ä¸ªç»æå¼ç±»åä¸º RpcResponse<Object> ç CompletableFutureï¼ä½ å¯ä»¥æ resultFuture çä½æ¯å¼æ­¥è¿ç®ç»æçè½½ä½ã\n\n * ä¼ å¥è¿ç®ç»æ\n\n// complete() æ¹æ³åªè½è°ç¨ä¸æ¬¡ï¼åç»­è°ç¨å°è¢«å¿½ç¥ã\nresultFuture.complete(rpcResponse);\n\n\n1\n2\n\n\nåè®¾å¨æªæ¥çæä¸ªæ¶å»ï¼æä»¬å¾å°äºæç»çç»æãè¿æ¶ï¼æä»¬å¯ä»¥è°ç¨ complete() æ¹æ³ä¸ºå¶ä¼ å¥ç»æï¼è¿è¡¨ç¤º resultFuture å·²ç»è¢«å®æäºã\n\n * å¤æ­ä»»å¡æ¯å¦å·²ç»è¢«å®æ\n\npublic boolean isDone() {\n    return result != null;\n}\n\n\n1\n2\n3\n\n\nå¯ä»¥éè¿ isDone() æ¹æ³æ¥æ£æ¥æ¯å¦å·²ç»å®æãï¼Future æ¥å£çæ¹æ³ï¼\n\n * ç­å¾ä»»å¡æ§è¡å®æå¹¶è·åè¿ç®ç»æ\n\nrpcResponse = completableFuture.get();\n\n\n1\n\n\nå¯ä»¥éè¿è°ç¨ get() æ¹æ³æ¥è·åå¼æ­¥è®¡ç®ç»æãè°ç¨ get() æ¹æ³ççº¿ç¨ä¼é»å¡ç´å° CompletableFuture å®æè¿ç®ãï¼é»å¡ç­å¾ï¼\n\n * å¦æä½ å·²ç»ç¥éè®¡ç®çç»æçè¯ï¼å¯ä»¥ä½¿ç¨éææ¹æ³ completedFuture() æ¥åå»º CompletableFutureã\n\nCompletableFuture<String> future = CompletableFuture.completedFuture("hello!");\nassertEquals("hello!", future.get());\n\n\n1\n2\n\n\ncompletedFuture() æ¹æ³åºå±è°ç¨çæ¯å¸¦åæ°ç new æ¹æ³ï¼åªä¸è¿ï¼è¿ä¸ªæ¹æ³ä¸å¯¹å¤æ´é²ã\n\npublic static <U> CompletableFuture<U> completedFuture(U value) {\n    return new CompletableFuture<U>((value == null) ? NIL : value);\n}\n\n\n1\n2\n3\n\n\n# éæå·¥åæ¹æ³\n\n * supplyAsync æ§è¡ CompletableFuture ä»»å¡ï¼æ¯æè¿åå¼\n * runAsync æ§è¡ CompletableFuture ä»»å¡ï¼æ²¡æè¿åå¼ãå ä¸º runAsync() æ¹æ³æ¥åçåæ°æ¯ Runnable ï¼è¿æ¯ä¸ä¸ªå½æ°å¼æ¥å£ï¼ä¸åè®¸è¿åå¼ã\n\n# supplyAsync æ¹æ³\n\n// ä½¿ç¨é»è®¤åç½®çº¿ç¨æ± ForkJoinPool.commonPool()ï¼æ ¹æ®supplieræå»ºæ§è¡ä»»å¡\npublic static <U> CompletableFuture<U> supplyAsync(Supplier<U> supplier)\n// ä½¿ç¨èªå®ä¹çº¿ç¨æ± ï¼æ ¹æ®supplieræå»ºæ§è¡ä»»å¡ï¼æ¨èï¼\npublic static <U> CompletableFuture<U> supplyAsync(Supplier<U> supplier, Executor executor)\n\n\n1\n2\n3\n4\n\n\nsupplyAsync() æ¹æ³æ¥åçåæ°æ¯ Supplier<U> ï¼æ¯ä¸ä¸ªå½æ°å¼æ¥å£ï¼U æ¯è¿åç»æå¼çç±»åã\n\n@FunctionalInterface\npublic interface Supplier<T> {\n\n    /**\n     * Gets a result.\n     *\n     * @return a result\n     */\n    T get();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nä½¿ç¨åºæ¯ï¼å½ä½ éè¦å¼æ­¥æä½ä¸å³å¿è¿åç»æçæ¶å,å¯ä»¥ä½¿ç¨ supplyAsync() æ¹æ³ã\n\nCompletableFuture<Void> future = CompletableFuture.runAsync(() -> System.out.println("hello!"));\nfuture.get();// è¾åº "hello!"\nCompletableFuture<String> future2 = CompletableFuture.supplyAsync(() -> "hello!");\nassertEquals("hello!", future2.get()); // è¿è¡æ­è¨ï¼å¤æ­è¿åå¼æ¯å¦ä¸º "hello!"ï¼ä¸éè¿å°±ä¼æåºå¼å¸¸\n\n\n1\n2\n3\n4\n\n\n# runAsync æ¹æ³\n\n// ä½¿ç¨é»è®¤åç½®çº¿ç¨æ± ForkJoinPool.commonPool()ï¼æ ¹æ®runnableæå»ºæ§è¡ä»»å¡\npublic static CompletableFuture<Void> runAsync(Runnable runnable) \n// ä½¿ç¨èªå®ä¹çº¿ç¨æ± ï¼æ ¹æ®runnableæå»ºæ§è¡ä»»å¡ï¼æ¨èï¼\npublic static CompletableFuture<Void> runAsync(Runnable runnable,  Executor executor)\n\n\n1\n2\n3\n4\n\n\nä½¿ç¨åºæ¯ï¼å½ä½ éè¦å¼æ­¥æä½ä¸ä¸å³å¿è¿åç»æçæ¶åå¯ä»¥ä½¿ç¨ runAsync() æ¹æ³ã\n\n@FunctionalInterface\npublic interface Runnable {\n    public abstract void run();\n}\n\n\n1\n2\n3\n4\n\n\n# å®ä¾ä»£ç \n\npublic class FutureTest {\n\n    public static void main(String[] args) {\n        //å¯ä»¥èªå®ä¹çº¿ç¨æ± \n        ExecutorService executor = Executors.newCachedThreadPool();\n        //runAsyncçä½¿ç¨\n        CompletableFuture<Void> runFuture = CompletableFuture.runAsync(() -> System.out.println("run,å³æ³¨å¬ä¼å·:æ¡ç°èºçå°ç·å­©"), executor);\n        //supplyAsyncçä½¿ç¨\n        CompletableFuture<String> supplyFuture = CompletableFuture.supplyAsync(() -> {\n                    System.out.print("supply,å³æ³¨å¬ä¼å·:æ¡ç°èºçå°ç·å­©");\n                    return "æ¡ç°èºçå°ç·å­©"; }, executor);\n        //runAsyncçfutureæ²¡æè¿åå¼ï¼è¾åºnull\n        System.out.println(runFuture.join());\n        //supplyAsyncçfutureï¼æè¿åå¼\n        System.out.println(supplyFuture.join());\n        executor.shutdown(); // çº¿ç¨æ± éè¦å³é­\n    }\n}\n//è¾åº\nrun,å³æ³¨å¬ä¼å·:æ¡ç°èºçå°ç·å­©\nnull\nsupply,å³æ³¨å¬ä¼å·:æ¡ç°èºçå°ç·å­©æ¡ç°èºçå°ç·å­©\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# ç®åä»»å¡å¼æ­¥åè°\n\n\n\n# å¤çå¼æ­¥ç»ç®ç»æ\n\nå½æä»¬è·åå°å¼æ­¥è®¡ç®çç»æä¹åï¼è¿å¯ä»¥å¯¹å¶è¿è¡è¿ä¸æ­¥çå¤çï¼æ¯è¾å¸¸ç¨çæ¹æ³æä¸é¢å ä¸ªï¼\n\n * thenApply()\n * thenAccept()\n * thenRun()\n * whenComplete()\n\n# thenRun/thenRunAsync\n\npublic CompletableFuture<Void> thenRun(Runnable action);\npublic CompletableFuture<Void> thenRunAsync(Runnable action);\n\n\n1\n2\n\n\nCompletableFuture ç thenRun æ¹æ³ï¼éä¿ç¹è®²å°±æ¯ï¼åå®ç¬¬ä¸ä¸ªä»»å¡åï¼ååç¬¬äºä¸ªä»»å¡ã\n\næä¸ªä»»å¡æ§è¡å®æåï¼æ§è¡åè°æ¹æ³ï¼ä½æ¯ååä¸¤ä¸ªä»»å¡æ²¡æåæ°ä¼ éï¼ç¬¬äºä¸ªä»»å¡ä¹æ²¡æè¿åå¼ã\n\nä»£ç ç¤ºä¾ï¼\n\npublic class FutureThenRunTest {\n\n    public static void main(String[] args) throws ExecutionException, InterruptedException {\n\n        CompletableFuture<String> orgFuture = CompletableFuture.supplyAsync(\n                ()->{\n                    System.out.println("åæ§è¡ç¬¬ä¸ä¸ªCompletableFutureæ¹æ³ä»»å¡");\n                    return "æ¡ç°èºçå°ç·å­©";\n                }\n        );\n\n        CompletableFuture thenRunFuture = orgFuture.thenRun(() -> {\n            System.out.println("æ¥çæ§è¡ç¬¬äºä¸ªä»»å¡");\n        });\n\n        System.out.println(thenRunFuture.get());\n    }\n}\n//è¾åº\nåæ§è¡ç¬¬ä¸ä¸ªCompletableFutureæ¹æ³ä»»å¡\næ¥çæ§è¡ç¬¬äºä¸ªä»»å¡\nnull\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nthenRun å thenRunAsync æä»ä¹åºå«ï¼\n\næºç ï¼\n\n    private static final Executor asyncPool = useCommonPool ? ForkJoinPool.commonPool() : new ThreadPerTaskExecutor();\n  \n    public CompletableFuture<Void> thenRun(Runnable action) {\n        return uniRunStage(null, action);\n    }\n\n    public CompletableFuture<Void> thenRunAsync(Runnable action) {\n        return uniRunStage(asyncPool, action);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¦æä½ æ§è¡ç¬¬ä¸ä¸ªä»»å¡çæ¶åï¼ä¼ å¥äºä¸ä¸ªèªå®ä¹çº¿ç¨æ± ï¼\n\n * è°ç¨ thenRun æ¹æ³æ§è¡ç¬¬äºä¸ªä»»å¡æ¶ï¼åç¬¬äºä¸ªä»»å¡åç¬¬ä¸ä¸ªä»»å¡æ¯å±ç¨åä¸ä¸ªçº¿ç¨æ± ã\n * è°ç¨ thenRunAsync æ§è¡ç¬¬äºä¸ªä»»å¡æ¶ï¼åç¬¬ä¸ä¸ªä»»å¡ä½¿ç¨çæ¯ä½ èªå·±ä¼ å¥ççº¿ç¨æ± ï¼ç¬¬äºä¸ªä»»å¡ä½¿ç¨çæ¯ ForkJoin çº¿ç¨æ± \n\n> tips: thenAccept å thenAcceptAsyncï¼thenApply å thenApplyAsync ç­ï¼å®ä»¬ä¹é´çåºå«ä¹æ¯è¿ä¸ª\n\n# thenAccept/thenAcceptAsync\n\nCompletableFuture ç thenAccept æ¹æ³è¡¨ç¤ºï¼ç¬¬ä¸ä¸ªä»»å¡æ§è¡å®æåï¼æ§è¡ç¬¬äºä¸ªåè°æ¹æ³ä»»å¡ï¼ä¼å°è¯¥ä»»å¡çæ§è¡ç»æï¼ä½ä¸ºå¥åï¼ä¼ éå°åè°æ¹æ³ä¸­ï¼ä½æ¯åè°æ¹æ³æ¯æ²¡æè¿åå¼çã\n\npublic class FutureThenAcceptTest {\n\n    public static void main(String[] args) throws ExecutionException, InterruptedException {\n\n        CompletableFuture<String> orgFuture = CompletableFuture.supplyAsync(\n                ()->{\n                    System.out.println("åå§CompletableFutureæ¹æ³ä»»å¡");\n                    return "æ¡ç°èºçå°ç·å­©";\n                }\n        );\n\n        CompletableFuture thenAcceptFuture = orgFuture.thenAccept((a) -> {\n            if ("æ¡ç°èºçå°ç·å­©".equals(a)) {\n                System.out.println("å³æ³¨äº");\n            }\n\n            System.out.println("åèèèè");\n        });\n\n        System.out.println(thenAcceptFuture.get());\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n# thenApply/thenApplyAsync\n\nthenApply() æ¹æ³æ¥æ¶ä¸ä¸ª Function å®ä¾ï¼ç¨å®æ¥å¤çç»æã\n\n// æ²¿ç¨ä¸ä¸ä¸ªä»»å¡ççº¿ç¨æ± \npublic <U> CompletableFuture<U> thenApply(\n    Function<? super T,? extends U> fn) {\n    return uniApplyStage(null, fn);\n}\n\n//ä½¿ç¨é»è®¤ç ForkJoinPool çº¿ç¨æ± ï¼ä¸æ¨èï¼\npublic <U> CompletableFuture<U> thenApplyAsync(\n    Function<? super T,? extends U> fn) {\n    return uniApplyStage(defaultExecutor(), fn);\n}\n// ä½¿ç¨èªå®ä¹çº¿ç¨æ± (æ¨è)\npublic <U> CompletableFuture<U> thenApplyAsync(\n    Function<? super T,? extends U> fn, Executor executor) {\n    return uniApplyStage(screenExecutor(executor), fn);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nä½¿ç¨ç¤ºä¾ï¼\n\nCompletableFuture ç thenApply æ¹æ³è¡¨ç¤ºï¼ç¬¬ä¸ä¸ªä»»å¡æ§è¡å®æåï¼æ§è¡ç¬¬äºä¸ªåè°æ¹æ³ä»»å¡ï¼ä¼å°è¯¥ä»»å¡çæ§è¡ç»æï¼ä½ä¸ºå¥åï¼ä¼ éå°åè°æ¹æ³ä¸­ï¼å¹¶ä¸åè°æ¹æ³æ¯æè¿åå¼çã\n\npublic class FutureThenApplyTest {\n\n    public static void main(String[] args) throws ExecutionException, InterruptedException {\n\n        CompletableFuture<String> orgFuture = CompletableFuture.supplyAsync(\n                ()->{\n                    System.out.println("åå§CompletableFutureæ¹æ³ä»»å¡");\n                    return "æ¡ç°èºçå°ç·å­©";\n                }\n        );\n\n        CompletableFuture<String> thenApplyFuture = orgFuture.thenApply((a) -> {\n            if ("æ¡ç°èºçå°ç·å­©".equals(a)) {\n                return "å³æ³¨äº";\n            }\n\n            return "åèèèè";\n        });\n\n        System.out.println(thenApplyFuture.get());\n    }\n}\n//è¾åº\nåå§CompletableFutureæ¹æ³ä»»å¡\nå³æ³¨äº\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n# whenComplete()\n\nCompletableFuture ç whenComplete æ¹æ³è¡¨ç¤ºï¼æä¸ªä»»å¡æ§è¡å®æåï¼æ§è¡çåè°æ¹æ³ï¼æ è¿åå¼ï¼å¹¶ä¸ whenComplete æ¹æ³è¿åç CompletableFuture ç result æ¯ä¸ä¸ªä»»å¡çç»æã\n\npublic class FutureWhenTest {\n\n    public static void main(String[] args) throws ExecutionException, InterruptedException {\n\n        CompletableFuture<String> orgFuture = CompletableFuture.supplyAsync(\n                ()->{\n                    System.out.println("å½åçº¿ç¨åç§°ï¼" + Thread.currentThread().getName());\n                    try {\n                        Thread.sleep(2000L);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                    return "æ¡ç°èºçå°ç·å­©";\n                }\n        );\n\n        CompletableFuture<String> rstFuture = orgFuture.whenComplete((a, throwable) -> {\n            System.out.println("å½åçº¿ç¨åç§°ï¼" + Thread.currentThread().getName());\n            System.out.println("ä¸ä¸ªä»»å¡æ§è¡å®å¦ï¼è¿æ" + a + "ä¼ è¿æ¥");\n            if ("æ¡ç°èºçå°ç·å­©".equals(a)) {\n                System.out.println("666");\n            }\n            System.out.println("233333");\n        });\n\n        System.out.println(rstFuture.get());\n    }\n}\n//è¾åº\nå½åçº¿ç¨åç§°ï¼ForkJoinPool.commonPool-worker-1\nå½åçº¿ç¨åç§°ï¼ForkJoinPool.commonPool-worker-1\nä¸ä¸ªä»»å¡æ§è¡å®å¦ï¼è¿ææ¡ç°èºçå°ç·å­©ä¼ è¿æ¥\n666\n233333\næ¡ç°èºçå°ç·å­©\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n# å¼å¸¸å¤ç\n\nå¼æ­¥æä½å¯è½ä¼å¤±è´¥ï¼CompletableFuture åè®¸æä»¬ä½¿ç¨ exceptionally() æ handle() æ¹æ³æ¥å¤çå¼æ­¥æä½çå¼å¸¸ã\n\nhandle()\n\npublic <U> CompletableFuture<U> handle(\n    BiFunction<? super T, Throwable, ? extends U> fn) {\n    return uniHandleStage(null, fn);\n}\n\npublic <U> CompletableFuture<U> handleAsync(\n    BiFunction<? super T, Throwable, ? extends U> fn) {\n    return uniHandleStage(defaultExecutor(), fn);\n}\n\npublic <U> CompletableFuture<U> handleAsync(\n    BiFunction<? super T, Throwable, ? extends U> fn, Executor executor) {\n    return uniHandleStage(screenExecutor(executor), fn);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nç¤ºä¾ä»£ç ï¼\n\nCompletableFuture<String> future\n        = CompletableFuture.supplyAsync(() -> {\n    if (true) {\n        throw new RuntimeException("Computation error!");\n    }\n    return "hello!";\n}).handle((res, ex) -> {\n    // res ä»£è¡¨è¿åçç»æ\n    // ex çç±»åä¸º Throwable ï¼ä»£è¡¨æåºçå¼å¸¸\n    return res != null ? res : "world!";\n});\nassertEquals("world!", future.get());\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nexceptionally()\n\nCompletableFuture<String> future\n        = CompletableFuture.supplyAsync(() -> {\n    if (true) {\n        throw new RuntimeException("Computation error!");\n    }\n    return "hello!";\n}).exceptionally(ex -> {\n    System.out.println(ex.toString());// CompletionException\n    return "world!";\n});\nassertEquals("world!", future.get());\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nè®¾ç½® CompletableFuture çç»æå°±æ¯å¼å¸¸\n\nå¯ä»¥ä½¿ç¨ completeExceptionally() æ¹æ³ä¸ºå¶èµå¼ã\n\nCompletableFuture<String> completableFuture = new CompletableFuture<>();\n// ...\ncompletableFuture.completeExceptionally(\n  new RuntimeException("Calculation failed!"));\n// ...\ncompletableFuture.get(); // ExecutionException\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# å¤ä¸ªä»»å¡ç»åå¤ç\n\n# AND ç»åå³ç³»\n\nthenCombine / thenAcceptBoth / runAfterBoth é½è¡¨ç¤ºï¼å°ä¸¤ä¸ª CompletableFuture ç»åèµ·æ¥ï¼åªæè¿ä¸¤ä¸ªé½æ­£å¸¸æ§è¡å®äºï¼æä¼æ§è¡æä¸ªä»»å¡ã\n\nåºå«å¨äºï¼\n\n * thenCombineï¼ä¼å°ä¸¤ä¸ªä»»å¡çæ§è¡ç»æä½ä¸ºæ¹æ³å¥åï¼ä¼ éå°æå®æ¹æ³ä¸­ï¼ä¸æè¿åå¼\n * thenAcceptBoth: ä¼å°ä¸¤ä¸ªä»»å¡çæ§è¡ç»æä½ä¸ºæ¹æ³å¥åï¼ä¼ éå°æå®æ¹æ³ä¸­ï¼ä¸æ è¿åå¼\n * runAfterBoth ä¸ä¼ææ§è¡ç»æå½åæ¹æ³å¥åï¼ä¸æ²¡æè¿åå¼ã\n\nä»£ç ç¤ºä¾ï¼\n\npublic class ThenCombineTest {\n\n    public static void main(String[] args) throws InterruptedException, ExecutionException, TimeoutException {\n\n        CompletableFuture<String> first = CompletableFuture.completedFuture("ç¬¬ä¸ä¸ªå¼æ­¥ä»»å¡");\n        ExecutorService executor = Executors.newFixedThreadPool(10);\n        CompletableFuture<String> future = CompletableFuture\n                //ç¬¬äºä¸ªå¼æ­¥ä»»å¡\n                .supplyAsync(() -> "ç¬¬äºä¸ªå¼æ­¥ä»»å¡", executor)\n                // (w, s) -> System.out.println(s) æ¯ç¬¬ä¸ä¸ªä»»å¡\n                .thenCombineAsync(first, (s, w) -> {\n                    System.out.println(w);\n                    System.out.println(s);\n                    return "ä¸¤ä¸ªå¼æ­¥ä»»å¡çç»å";\n                }, executor);\n        System.out.println(future.join());\n        executor.shutdown();\n\n    }\n}\n//è¾åº\nç¬¬ä¸ä¸ªå¼æ­¥ä»»å¡\nç¬¬äºä¸ªå¼æ­¥ä»»å¡\nä¸¤ä¸ªå¼æ­¥ä»»å¡çç»å\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n# allOf å¨é¨æ§è¡å®\n\nææä»»å¡é½æ§è¡å®æåï¼ææ§è¡ allOf è¿åç CompletableFutureãå¦æä»»æä¸ä¸ªä»»å¡å¼å¸¸ï¼allOf ç CompletableFutureï¼æ§è¡ get æ¹æ³ï¼ä¼æåºå¼å¸¸ã\n\npublic class allOfFutureTest {\n    public static void main(String[] args) throws ExecutionException, InterruptedException {\n\n        CompletableFuture<Void> a = CompletableFuture.runAsync(()->{\n            System.out.println("ææ§è¡å®äº");\n        });\n        CompletableFuture<Void> b = CompletableFuture.runAsync(() -> {\n            System.out.println("æä¹æ§è¡å®äº");\n        });\n        CompletableFuture<Void> allOfFuture = CompletableFuture.allOf(a, b).whenComplete((m,k)->{\n            System.out.println("finish");\n        });\n    }\n}\n//è¾åº\nææ§è¡å®äº\næä¹æ§è¡å®äº\nfinish\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# anyOf ä»»ä¸æ§è¡å®\n\nä»»æä¸ä¸ªä»»å¡æ§è¡å®ï¼å°±æ§è¡ anyOf è¿åç CompletableFutureãå¦ææ§è¡çä»»å¡å¼å¸¸ï¼anyOf ç CompletableFutureï¼æ§è¡ get æ¹æ³ï¼ä¼æåºå¼å¸¸ã\n\npublic class AnyOfFutureTest {\n    public static void main(String[] args) throws ExecutionException, InterruptedException {\n\n        CompletableFuture<Void> a = CompletableFuture.runAsync(()->{\n            try {\n                Thread.sleep(3000L);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println("ææ§è¡å®äº");\n        });\n        CompletableFuture<Void> b = CompletableFuture.runAsync(() -> {\n            System.out.println("æä¹æ§è¡å®äº");\n        });\n        CompletableFuture<Object> anyOfFuture = CompletableFuture.anyOf(a, b).whenComplete((m,k)->{\n            System.out.println("finish");\n        });\n        anyOfFuture.join(); // ç­å¾ä»»æä¸ä¸ªç»å®ç CompletableFuture å®æ\n    }\n}\n// è¾åº\næä¹æ§è¡å®äº\nfinish\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\njoin() çå«ä¹æ¯ï¼ç­å¾ä¸ä¸ªå¼æ­¥æä½ï¼ä¹å°±æ¯ CompletableFutureï¼å®æå¹¶è·åå¶ç»æã\n\nå·ä½æ¥è¯´ï¼join æ¹æ³ä¼é»å¡å½åçº¿ç¨ï¼ç´å°ç¸åºç CompletableFuture å®æï¼å¹¶è¿åå¶è®¡ç®ç»æï¼æå¼å¸¸ï¼ãå¦æå¨è°ç¨ join æ¶å¼æ­¥æä½è¿æªå®æï¼é£ä¹å½åçº¿ç¨å°ä¸ç´é»å¡ç­å¾ï¼ç´å°æä½å®ææèæåºå¼å¸¸ã\n\n\n# åè\n\n * å¼æ­¥ç¼ç¨å©å¨ï¼CompletableFutureè¯¦è§£ ï½Java å¼åå®æ - æé (juejin.cn)\n * CompletableFuture è¯¦è§£ | JavaGuide(Javaé¢è¯ + å­¦ä¹ æå)',normalizedContent:'# completablefuture å¼æ­¥ç¼ç¨\n\n\n# åè¨\n\næä»¬å¼æ­¥æ§è¡ä¸ä¸ªä»»å¡æ¶ï¼ä¸è¬æ¯ç¨çº¿ç¨æ±  executor å»åå»ºã\n\n * å¦æä¸éè¦æè¿åå¼ï¼ä»»å¡å®ç° runnable æ¥å£ï¼\n * å¦æéè¦æè¿åå¼ï¼ä»»å¡å®ç° callable æ¥å£ï¼è°ç¨ executor ç submit æ¹æ³ï¼åä½¿ç¨ future è·åå³å¯ã\n\nå¦æå¤ä¸ªçº¿ç¨å­å¨ä¾èµç»åçè¯ï¼æä»¬æä¹å¤çå¢ï¼\n\n * å¯ä½¿ç¨åæ­¥ç»ä»¶ countdownlatchãcyclicbarrier ç­ï¼ä½æ¯æ¯è¾éº»ç¦ã\n * å¶å®æç®åçæ¹æ³ï¼å°±æ¯ç¨ compeletablefutureã\n\nå¨ç°ä»£çè½¯ä»¶å¼åä¸­ï¼å¤çå¹¶ååå¼æ­¥ä»»å¡åå¾è¶æ¥è¶éè¦ãjava ä¸­ç completablefuture ç±»ä¸ºæä»¬æä¾äºä¸ç§å¼ºå¤§çæ¹å¼æ¥å¤çå¼æ­¥ç¼ç¨ï¼è®©æä»¬è½å¤æ´ææå°å©ç¨å¤æ ¸å¤çå¨åå¹¶è¡æ§è¡ã\n\n\n# æºç è§£æ\n\næºç ï¼\n\npublic class completablefuture<t> implements future<t>, completionstage<t> {\n}\n\n\n1\n2\n\n\nä»æºç å¯ä»¥çåº completablefuture åæ¶å®ç°äº future å completionstage æ¥å£ã\n\ncompletablefuture é¤äºæä¾äºæ´ä¸ºå¥½ç¨åå¼ºå¤§ç future ç¹æ§ä¹å¤ï¼è¿æä¾äºå½æ°å¼ç¼ç¨çè½åã\n\nfuture æ¥å£æ 5 ä¸ªæ¹æ³ï¼\n\n 1. boolean cancel(boolean mayinterruptifrunning)ï¼å°è¯åæ¶æ§è¡ä»»å¡ã\n 2. boolean iscancelled()ï¼å¤æ­ä»»å¡æ¯å¦è¢«åæ¶ã\n 3. boolean isdone()ï¼å¤æ­ä»»å¡æ¯å¦å·²ç»è¢«æ§è¡å®æã\n 4. get()ï¼ç­å¾ä»»å¡æ§è¡å®æå¹¶è·åè¿ç®ç»æã\n 5. get(long timeout, timeunit unit)ï¼å¤äºä¸ä¸ªè¶æ¶æ¶é´ã\n\ncompletionstage æ¥å£\n\ncompletionstage æ¥å£æè¿°äºä¸ä¸ªå¼æ­¥è®¡ç®çé¶æ®µãå¾å¤è®¡ç®å¯ä»¥åæå¤ä¸ªé¶æ®µææ­¥éª¤ï¼æ­¤æ¶å¯ä»¥éè¿å®å°æææ­¥éª¤ç»åèµ·æ¥ï¼å½¢æå¼æ­¥è®¡ç®çæµæ°´çº¿ãï¼å¤§éä½¿ç¨äºå½æ°å¼ç¼ç¨ï¼\n\n\n# ä»ä¹æ¯ completablefutureï¼\n\ncompletablefuture æ¯ java 8 å¼å¥çä¸ä¸ªç±»ï¼ç¨äºæ¯æå¼æ­¥ç¼ç¨åæä½å¤ä¸ªå¼æ­¥ä»»å¡ãå®æ¯ future çæ©å±ï¼æä¾äºæ´å¤çåè½åçµæ´»æ§ãéè¿ completablefutureï¼æä»¬å¯ä»¥å°å¤ä¸ªå¼æ­¥ä»»å¡ä¸²è¡æå¹¶è¡æ§è¡ï¼ç¶åç­å¾å®ä»¬çå®æç»æã\n\n\n# ä½¿ç¨æ­¥éª¤\n\n\n# åå»º completablefuture\n\nå¸¸è§çæä¸¤ç§æ¹æ³\n\n 1. éè¿ new å³é®å­\n 2. åºäº completablefuture èªå¸¦çéæå·¥åæ¹æ³ï¼runasync()ãsupplyasync()ã\n\n# new å³é®å­\n\néè¿ new å³é®å­åå»º completablefuture å¯¹è±¡è¿ç§ä½¿ç¨æ¹å¼å¯ä»¥çä½æ¯å° completablefuture å½å future æ¥ä½¿ç¨ã\n\nä¸¾ä¾ï¼\n\n * åå»ºå¼æ­¥è¿ç®çè½½ä½\n\ncompletablefuture<rpcresponse<object>> resultfuture = new completablefuture<>();\n\n\n1\n\n\nä¸é¢ä»£ç åå»ºäºä¸ä¸ªç»æå¼ç±»åä¸º rpcresponse<object> ç completablefutureï¼ä½ å¯ä»¥æ resultfuture çä½æ¯å¼æ­¥è¿ç®ç»æçè½½ä½ã\n\n * ä¼ å¥è¿ç®ç»æ\n\n// complete() æ¹æ³åªè½è°ç¨ä¸æ¬¡ï¼åç»­è°ç¨å°è¢«å¿½ç¥ã\nresultfuture.complete(rpcresponse);\n\n\n1\n2\n\n\nåè®¾å¨æªæ¥çæä¸ªæ¶å»ï¼æä»¬å¾å°äºæç»çç»æãè¿æ¶ï¼æä»¬å¯ä»¥è°ç¨ complete() æ¹æ³ä¸ºå¶ä¼ å¥ç»æï¼è¿è¡¨ç¤º resultfuture å·²ç»è¢«å®æäºã\n\n * å¤æ­ä»»å¡æ¯å¦å·²ç»è¢«å®æ\n\npublic boolean isdone() {\n    return result != null;\n}\n\n\n1\n2\n3\n\n\nå¯ä»¥éè¿ isdone() æ¹æ³æ¥æ£æ¥æ¯å¦å·²ç»å®æãï¼future æ¥å£çæ¹æ³ï¼\n\n * ç­å¾ä»»å¡æ§è¡å®æå¹¶è·åè¿ç®ç»æ\n\nrpcresponse = completablefuture.get();\n\n\n1\n\n\nå¯ä»¥éè¿è°ç¨ get() æ¹æ³æ¥è·åå¼æ­¥è®¡ç®ç»æãè°ç¨ get() æ¹æ³ççº¿ç¨ä¼é»å¡ç´å° completablefuture å®æè¿ç®ãï¼é»å¡ç­å¾ï¼\n\n * å¦æä½ å·²ç»ç¥éè®¡ç®çç»æçè¯ï¼å¯ä»¥ä½¿ç¨éææ¹æ³ completedfuture() æ¥åå»º completablefutureã\n\ncompletablefuture<string> future = completablefuture.completedfuture("hello!");\nassertequals("hello!", future.get());\n\n\n1\n2\n\n\ncompletedfuture() æ¹æ³åºå±è°ç¨çæ¯å¸¦åæ°ç new æ¹æ³ï¼åªä¸è¿ï¼è¿ä¸ªæ¹æ³ä¸å¯¹å¤æ´é²ã\n\npublic static <u> completablefuture<u> completedfuture(u value) {\n    return new completablefuture<u>((value == null) ? nil : value);\n}\n\n\n1\n2\n3\n\n\n# éæå·¥åæ¹æ³\n\n * supplyasync æ§è¡ completablefuture ä»»å¡ï¼æ¯æè¿åå¼\n * runasync æ§è¡ completablefuture ä»»å¡ï¼æ²¡æè¿åå¼ãå ä¸º runasync() æ¹æ³æ¥åçåæ°æ¯ runnable ï¼è¿æ¯ä¸ä¸ªå½æ°å¼æ¥å£ï¼ä¸åè®¸è¿åå¼ã\n\n# supplyasync æ¹æ³\n\n// ä½¿ç¨é»è®¤åç½®çº¿ç¨æ± forkjoinpool.commonpool()ï¼æ ¹æ®supplieræå»ºæ§è¡ä»»å¡\npublic static <u> completablefuture<u> supplyasync(supplier<u> supplier)\n// ä½¿ç¨èªå®ä¹çº¿ç¨æ± ï¼æ ¹æ®supplieræå»ºæ§è¡ä»»å¡ï¼æ¨èï¼\npublic static <u> completablefuture<u> supplyasync(supplier<u> supplier, executor executor)\n\n\n1\n2\n3\n4\n\n\nsupplyasync() æ¹æ³æ¥åçåæ°æ¯ supplier<u> ï¼æ¯ä¸ä¸ªå½æ°å¼æ¥å£ï¼u æ¯è¿åç»æå¼çç±»åã\n\n@functionalinterface\npublic interface supplier<t> {\n\n    /**\n     * gets a result.\n     *\n     * @return a result\n     */\n    t get();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nä½¿ç¨åºæ¯ï¼å½ä½ éè¦å¼æ­¥æä½ä¸å³å¿è¿åç»æçæ¶å,å¯ä»¥ä½¿ç¨ supplyasync() æ¹æ³ã\n\ncompletablefuture<void> future = completablefuture.runasync(() -> system.out.println("hello!"));\nfuture.get();// è¾åº "hello!"\ncompletablefuture<string> future2 = completablefuture.supplyasync(() -> "hello!");\nassertequals("hello!", future2.get()); // è¿è¡æ­è¨ï¼å¤æ­è¿åå¼æ¯å¦ä¸º "hello!"ï¼ä¸éè¿å°±ä¼æåºå¼å¸¸\n\n\n1\n2\n3\n4\n\n\n# runasync æ¹æ³\n\n// ä½¿ç¨é»è®¤åç½®çº¿ç¨æ± forkjoinpool.commonpool()ï¼æ ¹æ®runnableæå»ºæ§è¡ä»»å¡\npublic static completablefuture<void> runasync(runnable runnable) \n// ä½¿ç¨èªå®ä¹çº¿ç¨æ± ï¼æ ¹æ®runnableæå»ºæ§è¡ä»»å¡ï¼æ¨èï¼\npublic static completablefuture<void> runasync(runnable runnable,  executor executor)\n\n\n1\n2\n3\n4\n\n\nä½¿ç¨åºæ¯ï¼å½ä½ éè¦å¼æ­¥æä½ä¸ä¸å³å¿è¿åç»æçæ¶åå¯ä»¥ä½¿ç¨ runasync() æ¹æ³ã\n\n@functionalinterface\npublic interface runnable {\n    public abstract void run();\n}\n\n\n1\n2\n3\n4\n\n\n# å®ä¾ä»£ç \n\npublic class futuretest {\n\n    public static void main(string[] args) {\n        //å¯ä»¥èªå®ä¹çº¿ç¨æ± \n        executorservice executor = executors.newcachedthreadpool();\n        //runasyncçä½¿ç¨\n        completablefuture<void> runfuture = completablefuture.runasync(() -> system.out.println("run,å³æ³¨å¬ä¼å·:æ¡ç°èºçå°ç·å­©"), executor);\n        //supplyasyncçä½¿ç¨\n        completablefuture<string> supplyfuture = completablefuture.supplyasync(() -> {\n                    system.out.print("supply,å³æ³¨å¬ä¼å·:æ¡ç°èºçå°ç·å­©");\n                    return "æ¡ç°èºçå°ç·å­©"; }, executor);\n        //runasyncçfutureæ²¡æè¿åå¼ï¼è¾åºnull\n        system.out.println(runfuture.join());\n        //supplyasyncçfutureï¼æè¿åå¼\n        system.out.println(supplyfuture.join());\n        executor.shutdown(); // çº¿ç¨æ± éè¦å³é­\n    }\n}\n//è¾åº\nrun,å³æ³¨å¬ä¼å·:æ¡ç°èºçå°ç·å­©\nnull\nsupply,å³æ³¨å¬ä¼å·:æ¡ç°èºçå°ç·å­©æ¡ç°èºçå°ç·å­©\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# ç®åä»»å¡å¼æ­¥åè°\n\n\n\n# å¤çå¼æ­¥ç»ç®ç»æ\n\nå½æä»¬è·åå°å¼æ­¥è®¡ç®çç»æä¹åï¼è¿å¯ä»¥å¯¹å¶è¿è¡è¿ä¸æ­¥çå¤çï¼æ¯è¾å¸¸ç¨çæ¹æ³æä¸é¢å ä¸ªï¼\n\n * thenapply()\n * thenaccept()\n * thenrun()\n * whencomplete()\n\n# thenrun/thenrunasync\n\npublic completablefuture<void> thenrun(runnable action);\npublic completablefuture<void> thenrunasync(runnable action);\n\n\n1\n2\n\n\ncompletablefuture ç thenrun æ¹æ³ï¼éä¿ç¹è®²å°±æ¯ï¼åå®ç¬¬ä¸ä¸ªä»»å¡åï¼ååç¬¬äºä¸ªä»»å¡ã\n\næä¸ªä»»å¡æ§è¡å®æåï¼æ§è¡åè°æ¹æ³ï¼ä½æ¯ååä¸¤ä¸ªä»»å¡æ²¡æåæ°ä¼ éï¼ç¬¬äºä¸ªä»»å¡ä¹æ²¡æè¿åå¼ã\n\nä»£ç ç¤ºä¾ï¼\n\npublic class futurethenruntest {\n\n    public static void main(string[] args) throws executionexception, interruptedexception {\n\n        completablefuture<string> orgfuture = completablefuture.supplyasync(\n                ()->{\n                    system.out.println("åæ§è¡ç¬¬ä¸ä¸ªcompletablefutureæ¹æ³ä»»å¡");\n                    return "æ¡ç°èºçå°ç·å­©";\n                }\n        );\n\n        completablefuture thenrunfuture = orgfuture.thenrun(() -> {\n            system.out.println("æ¥çæ§è¡ç¬¬äºä¸ªä»»å¡");\n        });\n\n        system.out.println(thenrunfuture.get());\n    }\n}\n//è¾åº\nåæ§è¡ç¬¬ä¸ä¸ªcompletablefutureæ¹æ³ä»»å¡\næ¥çæ§è¡ç¬¬äºä¸ªä»»å¡\nnull\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nthenrun å thenrunasync æä»ä¹åºå«ï¼\n\næºç ï¼\n\n    private static final executor asyncpool = usecommonpool ? forkjoinpool.commonpool() : new threadpertaskexecutor();\n  \n    public completablefuture<void> thenrun(runnable action) {\n        return unirunstage(null, action);\n    }\n\n    public completablefuture<void> thenrunasync(runnable action) {\n        return unirunstage(asyncpool, action);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¦æä½ æ§è¡ç¬¬ä¸ä¸ªä»»å¡çæ¶åï¼ä¼ å¥äºä¸ä¸ªèªå®ä¹çº¿ç¨æ± ï¼\n\n * è°ç¨ thenrun æ¹æ³æ§è¡ç¬¬äºä¸ªä»»å¡æ¶ï¼åç¬¬äºä¸ªä»»å¡åç¬¬ä¸ä¸ªä»»å¡æ¯å±ç¨åä¸ä¸ªçº¿ç¨æ± ã\n * è°ç¨ thenrunasync æ§è¡ç¬¬äºä¸ªä»»å¡æ¶ï¼åç¬¬ä¸ä¸ªä»»å¡ä½¿ç¨çæ¯ä½ èªå·±ä¼ å¥ççº¿ç¨æ± ï¼ç¬¬äºä¸ªä»»å¡ä½¿ç¨çæ¯ forkjoin çº¿ç¨æ± \n\n> tips: thenaccept å thenacceptasyncï¼thenapply å thenapplyasync ç­ï¼å®ä»¬ä¹é´çåºå«ä¹æ¯è¿ä¸ª\n\n# thenaccept/thenacceptasync\n\ncompletablefuture ç thenaccept æ¹æ³è¡¨ç¤ºï¼ç¬¬ä¸ä¸ªä»»å¡æ§è¡å®æåï¼æ§è¡ç¬¬äºä¸ªåè°æ¹æ³ä»»å¡ï¼ä¼å°è¯¥ä»»å¡çæ§è¡ç»æï¼ä½ä¸ºå¥åï¼ä¼ éå°åè°æ¹æ³ä¸­ï¼ä½æ¯åè°æ¹æ³æ¯æ²¡æè¿åå¼çã\n\npublic class futurethenaccepttest {\n\n    public static void main(string[] args) throws executionexception, interruptedexception {\n\n        completablefuture<string> orgfuture = completablefuture.supplyasync(\n                ()->{\n                    system.out.println("åå§completablefutureæ¹æ³ä»»å¡");\n                    return "æ¡ç°èºçå°ç·å­©";\n                }\n        );\n\n        completablefuture thenacceptfuture = orgfuture.thenaccept((a) -> {\n            if ("æ¡ç°èºçå°ç·å­©".equals(a)) {\n                system.out.println("å³æ³¨äº");\n            }\n\n            system.out.println("åèèèè");\n        });\n\n        system.out.println(thenacceptfuture.get());\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n# thenapply/thenapplyasync\n\nthenapply() æ¹æ³æ¥æ¶ä¸ä¸ª function å®ä¾ï¼ç¨å®æ¥å¤çç»æã\n\n// æ²¿ç¨ä¸ä¸ä¸ªä»»å¡ççº¿ç¨æ± \npublic <u> completablefuture<u> thenapply(\n    function<? super t,? extends u> fn) {\n    return uniapplystage(null, fn);\n}\n\n//ä½¿ç¨é»è®¤ç forkjoinpool çº¿ç¨æ± ï¼ä¸æ¨èï¼\npublic <u> completablefuture<u> thenapplyasync(\n    function<? super t,? extends u> fn) {\n    return uniapplystage(defaultexecutor(), fn);\n}\n// ä½¿ç¨èªå®ä¹çº¿ç¨æ± (æ¨è)\npublic <u> completablefuture<u> thenapplyasync(\n    function<? super t,? extends u> fn, executor executor) {\n    return uniapplystage(screenexecutor(executor), fn);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nä½¿ç¨ç¤ºä¾ï¼\n\ncompletablefuture ç thenapply æ¹æ³è¡¨ç¤ºï¼ç¬¬ä¸ä¸ªä»»å¡æ§è¡å®æåï¼æ§è¡ç¬¬äºä¸ªåè°æ¹æ³ä»»å¡ï¼ä¼å°è¯¥ä»»å¡çæ§è¡ç»æï¼ä½ä¸ºå¥åï¼ä¼ éå°åè°æ¹æ³ä¸­ï¼å¹¶ä¸åè°æ¹æ³æ¯æè¿åå¼çã\n\npublic class futurethenapplytest {\n\n    public static void main(string[] args) throws executionexception, interruptedexception {\n\n        completablefuture<string> orgfuture = completablefuture.supplyasync(\n                ()->{\n                    system.out.println("åå§completablefutureæ¹æ³ä»»å¡");\n                    return "æ¡ç°èºçå°ç·å­©";\n                }\n        );\n\n        completablefuture<string> thenapplyfuture = orgfuture.thenapply((a) -> {\n            if ("æ¡ç°èºçå°ç·å­©".equals(a)) {\n                return "å³æ³¨äº";\n            }\n\n            return "åèèèè";\n        });\n\n        system.out.println(thenapplyfuture.get());\n    }\n}\n//è¾åº\nåå§completablefutureæ¹æ³ä»»å¡\nå³æ³¨äº\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n# whencomplete()\n\ncompletablefuture ç whencomplete æ¹æ³è¡¨ç¤ºï¼æä¸ªä»»å¡æ§è¡å®æåï¼æ§è¡çåè°æ¹æ³ï¼æ è¿åå¼ï¼å¹¶ä¸ whencomplete æ¹æ³è¿åç completablefuture ç result æ¯ä¸ä¸ªä»»å¡çç»æã\n\npublic class futurewhentest {\n\n    public static void main(string[] args) throws executionexception, interruptedexception {\n\n        completablefuture<string> orgfuture = completablefuture.supplyasync(\n                ()->{\n                    system.out.println("å½åçº¿ç¨åç§°ï¼" + thread.currentthread().getname());\n                    try {\n                        thread.sleep(2000l);\n                    } catch (interruptedexception e) {\n                        e.printstacktrace();\n                    }\n                    return "æ¡ç°èºçå°ç·å­©";\n                }\n        );\n\n        completablefuture<string> rstfuture = orgfuture.whencomplete((a, throwable) -> {\n            system.out.println("å½åçº¿ç¨åç§°ï¼" + thread.currentthread().getname());\n            system.out.println("ä¸ä¸ªä»»å¡æ§è¡å®å¦ï¼è¿æ" + a + "ä¼ è¿æ¥");\n            if ("æ¡ç°èºçå°ç·å­©".equals(a)) {\n                system.out.println("666");\n            }\n            system.out.println("233333");\n        });\n\n        system.out.println(rstfuture.get());\n    }\n}\n//è¾åº\nå½åçº¿ç¨åç§°ï¼forkjoinpool.commonpool-worker-1\nå½åçº¿ç¨åç§°ï¼forkjoinpool.commonpool-worker-1\nä¸ä¸ªä»»å¡æ§è¡å®å¦ï¼è¿ææ¡ç°èºçå°ç·å­©ä¼ è¿æ¥\n666\n233333\næ¡ç°èºçå°ç·å­©\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n# å¼å¸¸å¤ç\n\nå¼æ­¥æä½å¯è½ä¼å¤±è´¥ï¼completablefuture åè®¸æä»¬ä½¿ç¨ exceptionally() æ handle() æ¹æ³æ¥å¤çå¼æ­¥æä½çå¼å¸¸ã\n\nhandle()\n\npublic <u> completablefuture<u> handle(\n    bifunction<? super t, throwable, ? extends u> fn) {\n    return unihandlestage(null, fn);\n}\n\npublic <u> completablefuture<u> handleasync(\n    bifunction<? super t, throwable, ? extends u> fn) {\n    return unihandlestage(defaultexecutor(), fn);\n}\n\npublic <u> completablefuture<u> handleasync(\n    bifunction<? super t, throwable, ? extends u> fn, executor executor) {\n    return unihandlestage(screenexecutor(executor), fn);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nç¤ºä¾ä»£ç ï¼\n\ncompletablefuture<string> future\n        = completablefuture.supplyasync(() -> {\n    if (true) {\n        throw new runtimeexception("computation error!");\n    }\n    return "hello!";\n}).handle((res, ex) -> {\n    // res ä»£è¡¨è¿åçç»æ\n    // ex çç±»åä¸º throwable ï¼ä»£è¡¨æåºçå¼å¸¸\n    return res != null ? res : "world!";\n});\nassertequals("world!", future.get());\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nexceptionally()\n\ncompletablefuture<string> future\n        = completablefuture.supplyasync(() -> {\n    if (true) {\n        throw new runtimeexception("computation error!");\n    }\n    return "hello!";\n}).exceptionally(ex -> {\n    system.out.println(ex.tostring());// completionexception\n    return "world!";\n});\nassertequals("world!", future.get());\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nè®¾ç½® completablefuture çç»æå°±æ¯å¼å¸¸\n\nå¯ä»¥ä½¿ç¨ completeexceptionally() æ¹æ³ä¸ºå¶èµå¼ã\n\ncompletablefuture<string> completablefuture = new completablefuture<>();\n// ...\ncompletablefuture.completeexceptionally(\n  new runtimeexception("calculation failed!"));\n// ...\ncompletablefuture.get(); // executionexception\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# å¤ä¸ªä»»å¡ç»åå¤ç\n\n# and ç»åå³ç³»\n\nthencombine / thenacceptboth / runafterboth é½è¡¨ç¤ºï¼å°ä¸¤ä¸ª completablefuture ç»åèµ·æ¥ï¼åªæè¿ä¸¤ä¸ªé½æ­£å¸¸æ§è¡å®äºï¼æä¼æ§è¡æä¸ªä»»å¡ã\n\nåºå«å¨äºï¼\n\n * thencombineï¼ä¼å°ä¸¤ä¸ªä»»å¡çæ§è¡ç»æä½ä¸ºæ¹æ³å¥åï¼ä¼ éå°æå®æ¹æ³ä¸­ï¼ä¸æè¿åå¼\n * thenacceptboth: ä¼å°ä¸¤ä¸ªä»»å¡çæ§è¡ç»æä½ä¸ºæ¹æ³å¥åï¼ä¼ éå°æå®æ¹æ³ä¸­ï¼ä¸æ è¿åå¼\n * runafterboth ä¸ä¼ææ§è¡ç»æå½åæ¹æ³å¥åï¼ä¸æ²¡æè¿åå¼ã\n\nä»£ç ç¤ºä¾ï¼\n\npublic class thencombinetest {\n\n    public static void main(string[] args) throws interruptedexception, executionexception, timeoutexception {\n\n        completablefuture<string> first = completablefuture.completedfuture("ç¬¬ä¸ä¸ªå¼æ­¥ä»»å¡");\n        executorservice executor = executors.newfixedthreadpool(10);\n        completablefuture<string> future = completablefuture\n                //ç¬¬äºä¸ªå¼æ­¥ä»»å¡\n                .supplyasync(() -> "ç¬¬äºä¸ªå¼æ­¥ä»»å¡", executor)\n                // (w, s) -> system.out.println(s) æ¯ç¬¬ä¸ä¸ªä»»å¡\n                .thencombineasync(first, (s, w) -> {\n                    system.out.println(w);\n                    system.out.println(s);\n                    return "ä¸¤ä¸ªå¼æ­¥ä»»å¡çç»å";\n                }, executor);\n        system.out.println(future.join());\n        executor.shutdown();\n\n    }\n}\n//è¾åº\nç¬¬ä¸ä¸ªå¼æ­¥ä»»å¡\nç¬¬äºä¸ªå¼æ­¥ä»»å¡\nä¸¤ä¸ªå¼æ­¥ä»»å¡çç»å\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n# allof å¨é¨æ§è¡å®\n\nææä»»å¡é½æ§è¡å®æåï¼ææ§è¡ allof è¿åç completablefutureãå¦æä»»æä¸ä¸ªä»»å¡å¼å¸¸ï¼allof ç completablefutureï¼æ§è¡ get æ¹æ³ï¼ä¼æåºå¼å¸¸ã\n\npublic class alloffuturetest {\n    public static void main(string[] args) throws executionexception, interruptedexception {\n\n        completablefuture<void> a = completablefuture.runasync(()->{\n            system.out.println("ææ§è¡å®äº");\n        });\n        completablefuture<void> b = completablefuture.runasync(() -> {\n            system.out.println("æä¹æ§è¡å®äº");\n        });\n        completablefuture<void> alloffuture = completablefuture.allof(a, b).whencomplete((m,k)->{\n            system.out.println("finish");\n        });\n    }\n}\n//è¾åº\nææ§è¡å®äº\næä¹æ§è¡å®äº\nfinish\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# anyof ä»»ä¸æ§è¡å®\n\nä»»æä¸ä¸ªä»»å¡æ§è¡å®ï¼å°±æ§è¡ anyof è¿åç completablefutureãå¦ææ§è¡çä»»å¡å¼å¸¸ï¼anyof ç completablefutureï¼æ§è¡ get æ¹æ³ï¼ä¼æåºå¼å¸¸ã\n\npublic class anyoffuturetest {\n    public static void main(string[] args) throws executionexception, interruptedexception {\n\n        completablefuture<void> a = completablefuture.runasync(()->{\n            try {\n                thread.sleep(3000l);\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n            system.out.println("ææ§è¡å®äº");\n        });\n        completablefuture<void> b = completablefuture.runasync(() -> {\n            system.out.println("æä¹æ§è¡å®äº");\n        });\n        completablefuture<object> anyoffuture = completablefuture.anyof(a, b).whencomplete((m,k)->{\n            system.out.println("finish");\n        });\n        anyoffuture.join(); // ç­å¾ä»»æä¸ä¸ªç»å®ç completablefuture å®æ\n    }\n}\n// è¾åº\næä¹æ§è¡å®äº\nfinish\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\njoin() çå«ä¹æ¯ï¼ç­å¾ä¸ä¸ªå¼æ­¥æä½ï¼ä¹å°±æ¯ completablefutureï¼å®æå¹¶è·åå¶ç»æã\n\nå·ä½æ¥è¯´ï¼join æ¹æ³ä¼é»å¡å½åçº¿ç¨ï¼ç´å°ç¸åºç completablefuture å®æï¼å¹¶è¿åå¶è®¡ç®ç»æï¼æå¼å¸¸ï¼ãå¦æå¨è°ç¨ join æ¶å¼æ­¥æä½è¿æªå®æï¼é£ä¹å½åçº¿ç¨å°ä¸ç´é»å¡ç­å¾ï¼ç´å°æä½å®ææèæåºå¼å¸¸ã\n\n\n# åè\n\n * å¼æ­¥ç¼ç¨å©å¨ï¼completablefutureè¯¦è§£ ï½java å¼åå®æ - æé (juejin.cn)\n * completablefuture è¯¦è§£ | javaguide(javaé¢è¯ + å­¦ä¹ æå)',charsets:{cjk:!0}},{title:"k8sä¹Deployment",frontmatter:{tags:["k8s","å®¹å¨","äºåç"],author:{name:"msqfx",link:"https://github.com/msqfx"},title:"k8sä¹Deployment",date:"2022-08-29T16:27:11.000Z",permalink:"/pages/d73c88/",description:"ä»ç»k8sä¸­çdeploymentèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾",feed:{enable:!0},categories:["äºåç","k8s"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220820143105.png"},{name:"twitter:title",content:"k8sä¹Deployment"},{name:"twitter:description",content:"ä»ç»k8sä¸­çdeploymentèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220820143105.png"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/04.k8s%E4%B9%8Bdeployment.html"},{property:"og:type",content:"article"},{property:"og:title",content:"k8sä¹Deployment"},{property:"og:description",content:"ä»ç»k8sä¸­çdeploymentèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220820143105.png"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/04.k8s%E4%B9%8Bdeployment.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-29T16:27:11.000Z"},{property:"article:tag",content:"k8s"},{property:"article:tag",content:"å®¹å¨"},{property:"article:tag",content:"äºåç"},{itemprop:"name",content:"k8sä¹Deployment"},{itemprop:"description",content:"ä»ç»k8sä¸­çdeploymentèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220820143105.png"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/04.k8s%E4%B9%8Bdeployment.html",relativePath:"01.äºåç/07.k8s/04.k8sä¹deployment.md",key:"v-74234f32",path:"/pages/d73c88/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"ä½¿ç¨yamlæè¿°Deployment",slug:"ä½¿ç¨yamlæè¿°deployment",normalizedTitle:"ä½¿ç¨yamlæè¿°deployment",charIndex:86},{level:2,title:"æ¥çDeployment",slug:"æ¥çdeployment",normalizedTitle:"æ¥çdeployment",charIndex:730},{level:2,title:"ReplicaSet",slug:"replicaset",normalizedTitle:"replicaset",charIndex:1679},{level:2,title:"æ°´å¹³æ©ç¼©å®¹",slug:"æ°´å¹³æ©ç¼©å®¹",normalizedTitle:"æ°´å¹³æ©ç¼©å®¹",charIndex:3501},{level:2,title:"æ»å¨æ´æ°",slug:"æ»å¨æ´æ°",normalizedTitle:"æ»å¨æ´æ°",charIndex:4473}],headersStr:"ç®ä» ä½¿ç¨yamlæè¿°Deployment æ¥çDeployment ReplicaSet æ°´å¹³æ©ç¼©å®¹ æ»å¨æ´æ°",content:'# ç®ä»\n\nDeploymentæ¯k8sç¨æ¥ç®¡çé¨ç½²æ ç¶æPodçæ§å¶å¨ã\n\néç¨åºæ¯\n\næ ç¶æåºç¨ï¼ææçpodæ ä¾èµå³ç³»ï¼æ æå®èç¹è¿è¡ãæ ç¹æ®å¤ççæ¹å¼é¨ç½²\n\n\n# ä½¿ç¨yamlæè¿°Deployment\n\nä½¿ç¨ä¸é¢çyamlæä»¶ç¨æ¥åå»ºnginxçDeploymentå¯¹è±¡\n\nreplicasæ¯ç¨æ¥å®ä¹åå»ºpodçæ°éãtemplateä¸­çæ¯æç®¡ççPodæ¨¡æ¿ï¼Deploymentå°±æ¯æ ¹æ®è¯¥å­æ®µæ¥åå»ºpodèµæºå¯¹è±¡ãselectoræ¯ç¨æ¥ç­ééè¦ç®¡ççpodå¯¹è±¡ï¼templateä¸çlabelsçå¼éè¦ä¸selectorçå¼éè¦ä¿æä¸è´ï¼è¿æ ·Deploymentæè½æ¾å°éè¦æ§å¶çPodã\n\næ´å¤çå­æ®µè¯´æå¯ä»¥çå®ç½\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: ngx-dep\n  name: ngx-dep\n  \nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: ngx-dep\n      \n  template:\n    metadata:\n      labels:\n        app: ngx-dep\n    spec:\n      containers:\n      - image: nginx:alpine\n        name: nginx\n        ports:\n        - containerPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n\n# æ¥çDeployment\n\næä»¬æäºyamlæ¥æè¿°deploymentä¹åï¼å°±å¯ä»¥ä½¿ç¨kubectl applyæ¥åå»ºDeploymentå¯¹è±¡ã\n\n[root@k8s-worker1 zwf]# kubectl apply -f deployments.yaml  -n zwf\ndeployment.apps/ngx-dep created\n\n\n1\n2\n\n\næä¹ä¹å¯ä»¥ä½¿ç¨kubectl getæ¥æ¥çæä»¬åå»ºçdeplotmentå¯¹è±¡çä¿¡æ¯\n\n[root@k8s-worker1 zwf]# kubectl get deployment -n zwf\nNAME      READY   UP-TO-DATE   AVAILABLE   AGE\nngx-dep   2/2     2            2           19m\n\n\n1\n2\n3\n\n\nä¿¡æ¯ï¼\n\n * READYï¼å°±ç»ªä¸ªæ°/ææä¸ªæ°\n * UP-TO-DATEï¼å½åå¤äºææ°çæ¬çpodæ°\n * AVAILABLEï¼å½åå¯ç¨çPodæ°ï¼ä¹å°±æ¯å·²ç»ç»è¿readyä¹åçPod\n * ageï¼å­æ´»æ¶é´\n\næä»¬å°å¶ä¸­ä¸ä¸ªpodå é¤äºï¼ä¼åç°ä¸å°±åpodè¿ä¼èªå¨åå»ºï¼å ä¸ºk8sä¼æ ¹æ®yamlä¸­replicasçå¼ï¼è®©deploymentçå®éç¶æä¸æ­çåææç¶æé¼è¿ï¼æç»è¾¾å°ä¸ä¸ªåºç¨"æ°¸ä¸å®æº"\n\n[root@k8s-worker1 zwf]# kubectl delete pods ngx-dep-69b9455bcf-cfwgd -n zwf\npod "ngx-dep-69b9455bcf-cfwgd" deleted\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf\nNAME                       READY   STATUS    RESTARTS   AGE\nngx-dep-69b9455bcf-ddjml   1/1     Running   0          13m\nngx-dep-69b9455bcf-fn6gw   1/1     Running   0          5s\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# ReplicaSet\n\nDeploymentå¹¶ä¸æ¯ç´æ¥ç®¡çPodï¼èæ¯éè¿ReplicaSetå¯¹è±¡é´æ¥ç®¡ççï¼ä¹å°±æ¯è¯´çæ­£ç®¡çpodçå¶å®æ¯replicaSetå¯¹è±¡.\n\næä»¬ä½¿ç¨kubectl get rså¯ä»¥æ¥çå°ReplicaSetå¯¹è±¡ï¼è¯¥å¯¹è±¡æ¯å¨åå»ºDeploymentæ¶åå»ºçï¼æ¥çä¸ä¸ReplicaSetå¯¹è±¡çä¿¡æ¯ï¼å¶ä¸­çDESIREDåCURRENTå¯¹åºå¨åDeploymentçREADYï¼READYåDeploymentä¸­çæ¯ä¸æ ·çã\n\n[root@k8s-worker1 zwf]# kubectl get rs -n zwf\nNAME                 DESIRED   CURRENT   READY   AGE\nngx-dep-69b9455bcf   2         2         2       43s\n\n\n1\n2\n3\n\n\néè¿kubectl describeæ¥çdeplomentçè¯¦æï¼å¯ä»¥çå°NewReplicaSetçå¼æåçæ¯ReplicaSetå¯¹è±¡ï¼å¹¶é´æ¥ç®¡çPodã\n\n[root@k8s-worker1 zwf]# kubectl describe deploy ngx-dep -n zwf \nName:                   ngx-dep\nNamespace:              zwf\nCreationTimestamp:      Tue, 30 Aug 2022 11:27:14 +0800\nLabels:                 app=ngx-dep\nAnnotations:            deployment.kubernetes.io/revision: 1\nSelector:               app=ngx-dep\nReplicas:               2 desired | 2 updated | 2 total | 2 available | 0 unavailable\nStrategyType:           RollingUpdate\nMinReadySeconds:        0\nRollingUpdateStrategy:  25% max unavailable, 25% max surge\nPod Template:\n  Labels:  app=ngx-dep\n  Containers:\n   nginx:\n    Image:        mirrors.sangfor.com/nginx:alpine\n    Port:         80/TCP\n    Host Port:    0/TCP\n    Environment:  <none>\n    Mounts:       <none>\n  Volumes:        <none>\nConditions:\n  Type           Status  Reason\n  ----           ------  ------\n  Progressing    True    NewReplicaSetAvailable\n  Available      True    MinimumReplicasAvailable\nOldReplicaSets:  <none>\nNewReplicaSet:   ngx-dep-69b9455bcf (2/2 replicas created)\nEvents:\n  Type    Reason             Age   From                   Message\n  ----    ------             ----  ----                   -------\n  Normal  ScalingReplicaSet  13m   deployment-controller  Scaled up replica set ngx-dep-69b9455bcf to 2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# æ°´å¹³æ©ç¼©å®¹\n\næ°´å¹³æ©ç¼©å®¹æ¯å¯ä»¥å¨æçæ¹åPodçæ°éï¼å¨é«å³°æå¯ä»¥æ©å¤§åºç¨çæ°éæé«å¹¶åï¼å¨ä½å³°æç¼©åPodåå°èµæºçä½¿ç¨ã\n\næä»¬ä½¿ç¨kubectl scaleå¨ææ¹åDeploymentçå¯æ¬æ°ï¼æ¥çDeploymentå¯¹è±¡å¯ä»¥çå°READYä»2/4å°4/4ï¼å¹¶ä¸AVALIABLEçå¼ä¹æ¯éæ¸çä»2å°4\n\n[root@k8s-worker1 zwf]# kubectl scale deploy ngx-dep -n zwf --replicas=4\n\n[root@k8s-worker1 zwf]# kubectl get deployment -n zwf\nNAME      READY   UP-TO-DATE   AVAILABLE   AGE\nngx-dep   2/4     4            2           18m\n\n[root@k8s-worker1 zwf]# kubectl get deployment -n zwf\nNAME      READY   UP-TO-DATE   AVAILABLE   AGE\nngx-dep   3/4     4            3           18m\n\n[root@k8s-worker1 zwf]# kubectl get deployment -n zwf\nNAME      READY   UP-TO-DATE   AVAILABLE   AGE\nngx-dep   4/4     4            4           18m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\næä»¬åççReplicaSetå¯¹è±¡ï¼å¯ä»¥çå°å½åæ­£å¨è¿è¡Podæ°éä¹åçäºæ¹åãå ä¸ºæ°´å¹³æ©ç¼©å®¹çå®è´¨æ¯deplotmentå»ä¿®æ¹ReplicaSetçPodå¯æ¬çæ°éã\n\n[root@k8s-worker1 zwf]# kubectl get replicaset  -n zwf\nNAME                 DESIRED   CURRENT   READY   AGE\nngx-dep-69b9455bcf   4         4         4       50m\n\n\n1\n2\n3\n\n\n\n\n\n# æ»å¨æ´æ°\n\nå¨æ´æ°çè¿ç¨ï¼æ¯éæ¸å°æ§çReplicaSetæç®¡ççPodå é¤ï¼æ°çReplicaSetç®¡ççPodæ°å¢è¿ä¹ä¸ä¸ªè¿ç¨ã\n\næä»¬ä¿®æ¹Deploymentçyamlæä»¶ï¼å°containersçnameä¿®æ¹ä¸ºnginx2\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: ngx-dep\n  name: ngx-dep\n  \nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: ngx-dep\n      \n  template:\n    metadata:\n      labels:\n        app: ngx-dep\n    spec:\n      containers:\n      - image: nginx:alpine\n        name: nginx2   # ä¿®æ¹\n        ports:\n        - containerPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nåä½¿ç¨kubectl applyæ§è¡ï¼æ´æ°Deploymentï¼å¯ä»¥çå°ï¼UP-TO-DATEæ¯éæ¸çä»1å°2ï¼æ§çpodä¼éæ¸çæ´æ°æææ°çpod.\n\n[root@k8s-worker1 zwf]# kubectl apply -f deployments.yaml -n zwf\ndeployment.apps/ngx-dep configured\n\n[root@k8s-worker1 zwf]# kubectl get deploy -n zwf\nNAME      READY   UP-TO-DATE   AVAILABLE   AGE\nngx-dep   2/2     1            2           55m\n\n[root@k8s-worker1 zwf]# kubectl get deploy -n zwf\nNAME      READY   UP-TO-DATE   AVAILABLE   AGE\nngx-dep   2/2     2            2           55m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næä»¬åçä¸ReplicaSetå¯¹è±¡ï¼å¯ä»¥çå°æä¸¤ä¸ªå¯¹è±¡ãè¿æ¯å ä¸ºæä»¬æ´æ°äºDeploymentä¸­çpod templateæ¨¡æ¿ï¼ä¹å°±æ¯ä¼æ´æ°podï¼æä»¬ç¥éDeploymentæ¯éè¿ReplicaSetæ¥ç®¡çå¯¹è±¡çï¼æä»¥ä¼åå»ºä¸ä¸ªæ°çæ¬çReplicaSetå¯¹è±¡ç¨æ¥åå»ºæ°çæ¬çPodå¹¶éæ¸å¢å ï¼ç¶åéæ¸å°æ§çæ¬çReplicaSetå¯¹è±¡ç®¡ççpodå é¤ç´è³ä¸º0ã\n\n[root@k8s-worker1 zwf]# kubectl get rs -n zwf\nNAME                 DESIRED   CURRENT   READY   AGE\nngx-dep-54d65f4d8c   2         2         2       2m54s\nngx-dep-69b9455bcf   0         0         0       58m\n\n\n1\n2\n3\n4\n\n\næä»¬åçDeploymentçè¯¦æï¼Eventså­æ®µæ¯ä»£è¡¨çDeploymentä¸­åççäºä»¶ï¼å¯ä»¥çå°ngx-dep-69b9455bcfæç®¡ççpodéæ¸åå°ï¼èngx-dep-69b9455bcfå¨éæ¸å¢å podçæ°éãè¿ä¹å°±è§£éäºä¸é¢ä¸ºä»ä¹æä¸¤ä¸ªReplicaSetå¯¹è±¡ï¼å ä¸ºä¸ä¸ªæ¯æ°å¯¹è±¡ï¼ä¸ä¸ªæ¯æ§å¯¹è±¡ï¼å¨æ´æ°Deploymentæ¶ï¼é½ä¼ä¿çä¸æ¥ã\n\n[root@k8s-worker1 zwf]# kubectl describe deploy ngx-dep -n zwf\nName:                   ngx-dep\nNamespace:              zwf\nCreationTimestamp:      Tue, 30 Aug 2022 11:27:14 +0800\nLabels:                 app=ngx-dep\nAnnotations:            deployment.kubernetes.io/revision: 2\nSelector:               app=ngx-dep\nReplicas:               2 desired | 2 updated | 2 total | 2 available | 0 unavailable\nStrategyType:           RollingUpdate\nMinReadySeconds:        0\nRollingUpdateStrategy:  25% max unavailable, 25% max surge\nPod Template:\n  Labels:  app=ngx-dep\n  Containers:\n   nginx2:\n    Image:        mirrors.sangfor.com/nginx:alpine\n    Port:         80/TCP\n    Host Port:    0/TCP\n    Environment:  <none>\n    Mounts:       <none>\n  Volumes:        <none>\nConditions:\n  Type           Status  Reason\n  ----           ------  ------\n  Available      True    MinimumReplicasAvailable\n  Progressing    True    NewReplicaSetAvailable\nOldReplicaSets:  <none>\nNewReplicaSet:   ngx-dep-54d65f4d8c (2/2 replicas created)\nEvents:\n  Type    Reason             Age                  From                   Message\n  ----    ------             ----                 ----                   -------\n  Normal  ScalingReplicaSet  5m                   deployment-controller  Scaled up replica set ngx-dep-54d65f4d8c to 1\n  Normal  ScalingReplicaSet  4m58s                deployment-controller  Scaled down replica set ngx-dep-69b9455bcf to 1\n  Normal  ScalingReplicaSet  4m58s                deployment-controller  Scaled up replica set ngx-dep-54d65f4d8c to 2\n  Normal  ScalingReplicaSet  4m54s                deployment-controller  Scaled down replica set ngx-dep-69b9455bcf to 0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n',normalizedContent:'# ç®ä»\n\ndeploymentæ¯k8sç¨æ¥ç®¡çé¨ç½²æ ç¶æpodçæ§å¶å¨ã\n\néç¨åºæ¯\n\næ ç¶æåºç¨ï¼ææçpodæ ä¾èµå³ç³»ï¼æ æå®èç¹è¿è¡ãæ ç¹æ®å¤ççæ¹å¼é¨ç½²\n\n\n# ä½¿ç¨yamlæè¿°deployment\n\nä½¿ç¨ä¸é¢çyamlæä»¶ç¨æ¥åå»ºnginxçdeploymentå¯¹è±¡\n\nreplicasæ¯ç¨æ¥å®ä¹åå»ºpodçæ°éãtemplateä¸­çæ¯æç®¡ççpodæ¨¡æ¿ï¼deploymentå°±æ¯æ ¹æ®è¯¥å­æ®µæ¥åå»ºpodèµæºå¯¹è±¡ãselectoræ¯ç¨æ¥ç­ééè¦ç®¡ççpodå¯¹è±¡ï¼templateä¸çlabelsçå¼éè¦ä¸selectorçå¼éè¦ä¿æä¸è´ï¼è¿æ ·deploymentæè½æ¾å°éè¦æ§å¶çpodã\n\næ´å¤çå­æ®µè¯´æå¯ä»¥çå®ç½\n\napiversion: apps/v1\nkind: deployment\nmetadata:\n  labels:\n    app: ngx-dep\n  name: ngx-dep\n  \nspec:\n  replicas: 2\n  selector:\n    matchlabels:\n      app: ngx-dep\n      \n  template:\n    metadata:\n      labels:\n        app: ngx-dep\n    spec:\n      containers:\n      - image: nginx:alpine\n        name: nginx\n        ports:\n        - containerport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n\n# æ¥çdeployment\n\næä»¬æäºyamlæ¥æè¿°deploymentä¹åï¼å°±å¯ä»¥ä½¿ç¨kubectl applyæ¥åå»ºdeploymentå¯¹è±¡ã\n\n[root@k8s-worker1 zwf]# kubectl apply -f deployments.yaml  -n zwf\ndeployment.apps/ngx-dep created\n\n\n1\n2\n\n\næä¹ä¹å¯ä»¥ä½¿ç¨kubectl getæ¥æ¥çæä»¬åå»ºçdeplotmentå¯¹è±¡çä¿¡æ¯\n\n[root@k8s-worker1 zwf]# kubectl get deployment -n zwf\nname      ready   up-to-date   available   age\nngx-dep   2/2     2            2           19m\n\n\n1\n2\n3\n\n\nä¿¡æ¯ï¼\n\n * readyï¼å°±ç»ªä¸ªæ°/ææä¸ªæ°\n * up-to-dateï¼å½åå¤äºææ°çæ¬çpodæ°\n * availableï¼å½åå¯ç¨çpodæ°ï¼ä¹å°±æ¯å·²ç»ç»è¿readyä¹åçpod\n * ageï¼å­æ´»æ¶é´\n\næä»¬å°å¶ä¸­ä¸ä¸ªpodå é¤äºï¼ä¼åç°ä¸å°±åpodè¿ä¼èªå¨åå»ºï¼å ä¸ºk8sä¼æ ¹æ®yamlä¸­replicasçå¼ï¼è®©deploymentçå®éç¶æä¸æ­çåææç¶æé¼è¿ï¼æç»è¾¾å°ä¸ä¸ªåºç¨"æ°¸ä¸å®æº"\n\n[root@k8s-worker1 zwf]# kubectl delete pods ngx-dep-69b9455bcf-cfwgd -n zwf\npod "ngx-dep-69b9455bcf-cfwgd" deleted\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf\nname                       ready   status    restarts   age\nngx-dep-69b9455bcf-ddjml   1/1     running   0          13m\nngx-dep-69b9455bcf-fn6gw   1/1     running   0          5s\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# replicaset\n\ndeploymentå¹¶ä¸æ¯ç´æ¥ç®¡çpodï¼èæ¯éè¿replicasetå¯¹è±¡é´æ¥ç®¡ççï¼ä¹å°±æ¯è¯´çæ­£ç®¡çpodçå¶å®æ¯replicasetå¯¹è±¡.\n\næä»¬ä½¿ç¨kubectl get rså¯ä»¥æ¥çå°replicasetå¯¹è±¡ï¼è¯¥å¯¹è±¡æ¯å¨åå»ºdeploymentæ¶åå»ºçï¼æ¥çä¸ä¸replicasetå¯¹è±¡çä¿¡æ¯ï¼å¶ä¸­çdesiredåcurrentå¯¹åºå¨ådeploymentçreadyï¼readyådeploymentä¸­çæ¯ä¸æ ·çã\n\n[root@k8s-worker1 zwf]# kubectl get rs -n zwf\nname                 desired   current   ready   age\nngx-dep-69b9455bcf   2         2         2       43s\n\n\n1\n2\n3\n\n\néè¿kubectl describeæ¥çdeplomentçè¯¦æï¼å¯ä»¥çå°newreplicasetçå¼æåçæ¯replicasetå¯¹è±¡ï¼å¹¶é´æ¥ç®¡çpodã\n\n[root@k8s-worker1 zwf]# kubectl describe deploy ngx-dep -n zwf \nname:                   ngx-dep\nnamespace:              zwf\ncreationtimestamp:      tue, 30 aug 2022 11:27:14 +0800\nlabels:                 app=ngx-dep\nannotations:            deployment.kubernetes.io/revision: 1\nselector:               app=ngx-dep\nreplicas:               2 desired | 2 updated | 2 total | 2 available | 0 unavailable\nstrategytype:           rollingupdate\nminreadyseconds:        0\nrollingupdatestrategy:  25% max unavailable, 25% max surge\npod template:\n  labels:  app=ngx-dep\n  containers:\n   nginx:\n    image:        mirrors.sangfor.com/nginx:alpine\n    port:         80/tcp\n    host port:    0/tcp\n    environment:  <none>\n    mounts:       <none>\n  volumes:        <none>\nconditions:\n  type           status  reason\n  ----           ------  ------\n  progressing    true    newreplicasetavailable\n  available      true    minimumreplicasavailable\noldreplicasets:  <none>\nnewreplicaset:   ngx-dep-69b9455bcf (2/2 replicas created)\nevents:\n  type    reason             age   from                   message\n  ----    ------             ----  ----                   -------\n  normal  scalingreplicaset  13m   deployment-controller  scaled up replica set ngx-dep-69b9455bcf to 2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# æ°´å¹³æ©ç¼©å®¹\n\næ°´å¹³æ©ç¼©å®¹æ¯å¯ä»¥å¨æçæ¹åpodçæ°éï¼å¨é«å³°æå¯ä»¥æ©å¤§åºç¨çæ°éæé«å¹¶åï¼å¨ä½å³°æç¼©åpodåå°èµæºçä½¿ç¨ã\n\næä»¬ä½¿ç¨kubectl scaleå¨ææ¹ådeploymentçå¯æ¬æ°ï¼æ¥çdeploymentå¯¹è±¡å¯ä»¥çå°readyä»2/4å°4/4ï¼å¹¶ä¸avaliableçå¼ä¹æ¯éæ¸çä»2å°4\n\n[root@k8s-worker1 zwf]# kubectl scale deploy ngx-dep -n zwf --replicas=4\n\n[root@k8s-worker1 zwf]# kubectl get deployment -n zwf\nname      ready   up-to-date   available   age\nngx-dep   2/4     4            2           18m\n\n[root@k8s-worker1 zwf]# kubectl get deployment -n zwf\nname      ready   up-to-date   available   age\nngx-dep   3/4     4            3           18m\n\n[root@k8s-worker1 zwf]# kubectl get deployment -n zwf\nname      ready   up-to-date   available   age\nngx-dep   4/4     4            4           18m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\næä»¬åççreplicasetå¯¹è±¡ï¼å¯ä»¥çå°å½åæ­£å¨è¿è¡podæ°éä¹åçäºæ¹åãå ä¸ºæ°´å¹³æ©ç¼©å®¹çå®è´¨æ¯deplotmentå»ä¿®æ¹replicasetçpodå¯æ¬çæ°éã\n\n[root@k8s-worker1 zwf]# kubectl get replicaset  -n zwf\nname                 desired   current   ready   age\nngx-dep-69b9455bcf   4         4         4       50m\n\n\n1\n2\n3\n\n\n\n\n\n# æ»å¨æ´æ°\n\nå¨æ´æ°çè¿ç¨ï¼æ¯éæ¸å°æ§çreplicasetæç®¡ççpodå é¤ï¼æ°çreplicasetç®¡ççpodæ°å¢è¿ä¹ä¸ä¸ªè¿ç¨ã\n\næä»¬ä¿®æ¹deploymentçyamlæä»¶ï¼å°containersçnameä¿®æ¹ä¸ºnginx2\n\napiversion: apps/v1\nkind: deployment\nmetadata:\n  labels:\n    app: ngx-dep\n  name: ngx-dep\n  \nspec:\n  replicas: 2\n  selector:\n    matchlabels:\n      app: ngx-dep\n      \n  template:\n    metadata:\n      labels:\n        app: ngx-dep\n    spec:\n      containers:\n      - image: nginx:alpine\n        name: nginx2   # ä¿®æ¹\n        ports:\n        - containerport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nåä½¿ç¨kubectl applyæ§è¡ï¼æ´æ°deploymentï¼å¯ä»¥çå°ï¼up-to-dateæ¯éæ¸çä»1å°2ï¼æ§çpodä¼éæ¸çæ´æ°æææ°çpod.\n\n[root@k8s-worker1 zwf]# kubectl apply -f deployments.yaml -n zwf\ndeployment.apps/ngx-dep configured\n\n[root@k8s-worker1 zwf]# kubectl get deploy -n zwf\nname      ready   up-to-date   available   age\nngx-dep   2/2     1            2           55m\n\n[root@k8s-worker1 zwf]# kubectl get deploy -n zwf\nname      ready   up-to-date   available   age\nngx-dep   2/2     2            2           55m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næä»¬åçä¸replicasetå¯¹è±¡ï¼å¯ä»¥çå°æä¸¤ä¸ªå¯¹è±¡ãè¿æ¯å ä¸ºæä»¬æ´æ°äºdeploymentä¸­çpod templateæ¨¡æ¿ï¼ä¹å°±æ¯ä¼æ´æ°podï¼æä»¬ç¥édeploymentæ¯éè¿replicasetæ¥ç®¡çå¯¹è±¡çï¼æä»¥ä¼åå»ºä¸ä¸ªæ°çæ¬çreplicasetå¯¹è±¡ç¨æ¥åå»ºæ°çæ¬çpodå¹¶éæ¸å¢å ï¼ç¶åéæ¸å°æ§çæ¬çreplicasetå¯¹è±¡ç®¡ççpodå é¤ç´è³ä¸º0ã\n\n[root@k8s-worker1 zwf]# kubectl get rs -n zwf\nname                 desired   current   ready   age\nngx-dep-54d65f4d8c   2         2         2       2m54s\nngx-dep-69b9455bcf   0         0         0       58m\n\n\n1\n2\n3\n4\n\n\næä»¬åçdeploymentçè¯¦æï¼eventså­æ®µæ¯ä»£è¡¨çdeploymentä¸­åççäºä»¶ï¼å¯ä»¥çå°ngx-dep-69b9455bcfæç®¡ççpodéæ¸åå°ï¼èngx-dep-69b9455bcfå¨éæ¸å¢å podçæ°éãè¿ä¹å°±è§£éäºä¸é¢ä¸ºä»ä¹æä¸¤ä¸ªreplicasetå¯¹è±¡ï¼å ä¸ºä¸ä¸ªæ¯æ°å¯¹è±¡ï¼ä¸ä¸ªæ¯æ§å¯¹è±¡ï¼å¨æ´æ°deploymentæ¶ï¼é½ä¼ä¿çä¸æ¥ã\n\n[root@k8s-worker1 zwf]# kubectl describe deploy ngx-dep -n zwf\nname:                   ngx-dep\nnamespace:              zwf\ncreationtimestamp:      tue, 30 aug 2022 11:27:14 +0800\nlabels:                 app=ngx-dep\nannotations:            deployment.kubernetes.io/revision: 2\nselector:               app=ngx-dep\nreplicas:               2 desired | 2 updated | 2 total | 2 available | 0 unavailable\nstrategytype:           rollingupdate\nminreadyseconds:        0\nrollingupdatestrategy:  25% max unavailable, 25% max surge\npod template:\n  labels:  app=ngx-dep\n  containers:\n   nginx2:\n    image:        mirrors.sangfor.com/nginx:alpine\n    port:         80/tcp\n    host port:    0/tcp\n    environment:  <none>\n    mounts:       <none>\n  volumes:        <none>\nconditions:\n  type           status  reason\n  ----           ------  ------\n  available      true    minimumreplicasavailable\n  progressing    true    newreplicasetavailable\noldreplicasets:  <none>\nnewreplicaset:   ngx-dep-54d65f4d8c (2/2 replicas created)\nevents:\n  type    reason             age                  from                   message\n  ----    ------             ----                 ----                   -------\n  normal  scalingreplicaset  5m                   deployment-controller  scaled up replica set ngx-dep-54d65f4d8c to 1\n  normal  scalingreplicaset  4m58s                deployment-controller  scaled down replica set ngx-dep-69b9455bcf to 1\n  normal  scalingreplicaset  4m58s                deployment-controller  scaled up replica set ngx-dep-54d65f4d8c to 2\n  normal  scalingreplicaset  4m54s                deployment-controller  scaled down replica set ngx-dep-69b9455bcf to 0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n',charsets:{cjk:!0},lastUpdated:"2023/01/15, 20:17:10",lastUpdatedTimestamp:167378503e4},{title:"k8sä¹Service",frontmatter:{tags:["k8s","å®¹å¨","äºåç"],author:{name:"msqfx",link:"https://github.com/msqfx"},title:"k8sä¹Service",date:"2022-08-30T16:59:37.000Z",permalink:"/pages/1f860b/",description:"ä»ç»k8sä¸­çserviceèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾",feed:{enable:!0},categories:["äºåç","k8s"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220808185926.png"},{name:"twitter:title",content:"k8sä¹Service"},{name:"twitter:description",content:"ä»ç»k8sä¸­çserviceèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220808185926.png"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/05.k8s%E4%B9%8Bservice.html"},{property:"og:type",content:"article"},{property:"og:title",content:"k8sä¹Service"},{property:"og:description",content:"ä»ç»k8sä¸­çserviceèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220808185926.png"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/05.k8s%E4%B9%8Bservice.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-30T16:59:37.000Z"},{property:"article:tag",content:"k8s"},{property:"article:tag",content:"å®¹å¨"},{property:"article:tag",content:"äºåç"},{itemprop:"name",content:"k8sä¹Service"},{itemprop:"description",content:"ä»ç»k8sä¸­çserviceèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220808185926.png"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/05.k8s%E4%B9%8Bservice.html",relativePath:"01.äºåç/07.k8s/05.k8sä¹service.md",key:"v-0fd7c93e",path:"/pages/1f860b/",headers:[{level:2,title:"ä»ä¹æ¯serviceï¼",slug:"ä»ä¹æ¯service",normalizedTitle:"ä»ä¹æ¯serviceï¼",charIndex:2},{level:2,title:"ä½¿ç¨ClusterIP Service",slug:"ä½¿ç¨clusterip-service",normalizedTitle:"ä½¿ç¨clusterip service",charIndex:372},{level:2,title:"ä½¿ç¨NodePort Service",slug:"ä½¿ç¨nodeport-service",normalizedTitle:"ä½¿ç¨nodeport service",charIndex:5163},{level:2,title:"å¦ä½å®ç°çä»£çï¼",slug:"å¦ä½å®ç°çä»£ç",normalizedTitle:"å¦ä½å®ç°çä»£çï¼",charIndex:6453}],headersStr:"ä»ä¹æ¯serviceï¼ ä½¿ç¨ClusterIP Service ä½¿ç¨NodePort Service å¦ä½å®ç°çä»£çï¼",content:"# ä»ä¹æ¯serviceï¼\n\nå°è¿è¡å¨ä¸ç» Pods ä¸çåºç¨ç¨åºå¬å¼ä¸ºç½ç»æå¡çæ½è±¡æ¹æ³ã\n\nä¸ºä»ä¹éè¦service?\n\n 1. podçæ°éãIPé½æ¯å¨æååçï¼serviceå¯ä»¥ç»è¯¥éåçPodä¸ä¸ªåºå®çIPï¼æ è®ºpodçéåå¦ä½æ¹åï¼é½å¯ä»¥éè¿serviceçåºå®IPæ¥è®¿é®å°åºç¨ã\n\n 2. å¯ä»¥ç»podéåæä¾è´è½½åè¡¡çåè½ã\n\nServiceç±»å\n\n * LoadBalanceï¼ä½¿ç¨äºæä¾åçè´è½½åè¡¡å¨åå¤é¨æ´é²æå¡ã\n * ExternalNameï¼å°æå¡æ å°å°æå®çååï¼è¿ä¸ªååå¯ä»¥éç¾¤åé¨ä¹å¯ä»¥æ¯å¤é¨çã\n * NodePortï¼æä¾çæå¡æ¢å¯å¯¹å¤é¨æå¡éè¿NodeIp:NodePortè®¿é®ï¼ä¹å¯ä»¥å¯¹éç¾¤åé¨éè¿ClusterIpè®¿é®\n * ClusterIPï¼serviceæä¾çè®¿é®IPä»å¨éç¾¤åé¨å¯è¾¾\n\n\n# ä½¿ç¨ClusterIP Service\n\næä»¬å®ä¹serviceå¦ä¸ï¼å¶ä¸­selectoræ¯ç¨æ¥ç­ééè¦ä»£ççpodï¼targetPortæ¯ç®æ podçç«¯å£ï¼portæ¯æè¯¥serviceçç«¯å£ã\n\nkind: Service \napiVersion: v1 \nmetadata: \n  name: demoapp-svc \nspec: \n  selector: \n    app: demoapp \n  ports: \n  - name: http \n    protocol: TCP    \n    port: 80\n    targetPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nä½¿ç¨ä¸é¢å®ä¹çyamlåå»ºserviceå¯¹è±¡ï¼å¹¶å¯ä»¥çå°SELECTORçå¼æ¯app=demoappï¼æä»¬éè¦åå»ºå¸¦æè¯¥æ ç­¾çpodï¼æè½å¤è¿è¡ä»£çã\n\n[root@k8s-worker1 zwf]# kubectl apply -f service.yaml -n zwf\nservice/demoapp-svc created\n\n[root@k8s-worker1 zwf]# kubectl get svc -n zwf -o wide\nNAME          TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE   SELECTOR\ndemoapp-svc   ClusterIP   10.0.0.74    <none>        80/TCP    18s   app=demoapp\n\n\n1\n2\n3\n4\n5\n6\n\n\nå®ä¹deploymentï¼ä¼åå»ºå¸¦æapp=demoappçPod\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: demoapp\n  name: demo-deploy\n\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: demoapp\n\n  template:\n    metadata:\n      labels:\n        app: demoapp\n    spec:\n      containers:\n      - image: mirrors.sangfor.com/ikubernetes/demoapp:v1.0\n        name: demoapp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nåå»ºDeploymentå¯¹è±¡ï¼å¹¶ä¸å¯ä»¥çå°åå»ºäº2ä¸ªPod\n\n[root@k8s-worker1 zwf]# kubectl apply -f deployments_service.yaml -n zwf\ndeployment.apps/demo-deploy created\n\n[root@k8s-worker1 zwf]# kubectl get deploy -o wide -n zwf\nNAME          READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS   IMAGES                                         SELECTOR\ndemo-deploy   2/2     2            2           2m37s   demoapp      mirrors.sangfor.com/ikubernetes/demoapp:v1.0   app=demoapp\n\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næ¥çpodçè¯¦æï¼å¯ä»¥çå°Labelsæä¸ä¸ªapp=demoappçæ ç­¾\n\n[root@k8s-worker1 zwf]# kubectl get pods -o wide -n zwf\nNAME                           READY   STATUS    RESTARTS   AGE   IP               NODE          NOMINATED NODE   READINESS GATES\ndemo-deploy-6c6d588789-h9gmd   1/1     Running   0          32s   10.222.126.1     k8s-worker2   <none>           <none>\ndemo-deploy-6c6d588789-nhzhl   1/1     Running   0          32s   10.222.194.104   k8s-worker1   <none>           <none>\n\n[root@k8s-worker1 zwf]# kubectl describe demo-deploy-6c6d588789-h9gmd -n zwf\nName:         demo-deploy-6c6d588789-h9gmd\nNamespace:    zwf\nPriority:     0\nNode:         k8s-worker2/10.64.2.153\nStart Time:   Tue, 30 Aug 2022 19:23:22 +0800\nLabels:       app=demoapp\n              pod-template-hash=6c6d588789\n\n....\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\néè¿æ¥çserviceçè¯¦æï¼æä»¬å¯ä»¥çå°Endpointsçå¼æ¯ä¸é¢åå»ºçä¸¤ä¸ªPodçIPã\n\n[root@k8s-worker1 zwf]# kubectl describe svc -n zwf\nName:              demoapp-svc\nNamespace:         zwf\nLabels:            <none>\nAnnotations:       <none>\nSelector:          app=demoapp\nType:              ClusterIP\nIP Family Policy:  SingleStack\nIP Families:       IPv4\nIP:                10.0.0.74\nIPs:               10.0.0.74\nPort:              http  80/TCP\nTargetPort:        80/TCP\nEndpoints:         10.222.126.1:80,10.222.194.104:80\nSession Affinity:  None\nEvents:            <none>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nEndpointsä¹æ¯ä¸ä¸ªèµæºå¯¹è±¡ï¼Serviceéè¿ç­éæ ç­¾å°çPodä¼æ·»å å°Endpintsä¸­ä¿å­\n\n[root@k8s-worker1 zwf]# kubectl get endpoints -n zwf\nNAME          ENDPOINTS                           AGE\ndemoapp-svc   10.222.126.1:80,10.222.194.104:80   15m\n\n\n1\n2\n3\n\n\nè¿ä¸ªæ¶åï¼æä»¬è®¿é®serviceç80ç«¯å£ï¼ä¼è®¿é®å°è½®è¯¢è®¿é®å°è¿ä¸¤ä¸ªpodä¸­ï¼æä»¬å°±å¯ä»¥éè¿è®¿é®serviceæ¥è®¿é®podéåã\n\n[root@k8s-worker1 zwf]# curl 10.0.0.74\niKubernetes demoapp v1.0 !! ClientIP: 10.64.2.141, ServerName: demo-deploy-6c6d588789-nhzhl, ServerIP: 10.222.194.104!\n\n[root@k8s-worker1 zwf]# curl 10.0.0.74\niKubernetes demoapp v1.0 !! ClientIP: 10.64.2.141, ServerName: demo-deploy-6c6d588789-h9gmd, ServerIP: 10.222.126.1!\n\n[root@k8s-worker1 zwf]# curl 10.0.0.74\niKubernetes demoapp v1.0 !! ClientIP: 10.64.2.141, ServerName: demo-deploy-6c6d588789-nhzhl, ServerIP: 10.222.194.104!\n\n[root@k8s-worker1 zwf]# curl 10.0.0.74\niKubernetes demoapp v1.0 !! ClientIP: 10.64.2.141, ServerName: demo-deploy-6c6d588789-h9gmd, ServerIP: 10.222.126.1!\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\né¤äºéè¿ClusterIPè®¿é®ï¼å¨éç¾¤ä¸­ä¹è½éè¿ååè¿è¡è®¿é®ï¼è®¿é®æ¹å¼ï¼<serviceName>.<namespace>.svc.cluster.local\n\n[root@k8s-worker1 zwf]# kubectl exec -it demo-deploy-6c6d588789-h9gmd -n zwf  -- nslookup demoapp-svc.zwf.svc.cluster.local\nServer:         10.0.0.2\nAddress:        10.0.0.2#53\n\nName:   demoapp-svc.zwf.svc.cluster.local\nAddress: 10.0.0.74\n\n[root@k8s-worker1 zwf]# kubectl exec -it demo-deploy-6c6d588789-h9gmd -n zwf  -- curl demoapp-svc.zwf.svc.cluster.local\niKubernetes demoapp v1.0 !! ClientIP: 10.64.2.153, ServerName: demo-deploy-6c6d588789-h9gmd, ServerIP: 10.222.126.1!\n\n[root@k8s-worker1 zwf]# kubectl exec -it demo-deploy-6c6d588789-h9gmd -n zwf  -- curl demoapp-svc.zwf.svc.cluster.local\niKubernetes demoapp v1.0 !! ClientIP: 10.222.126.1, ServerName: demo-deploy-6c6d588789-nhzhl, ServerIP: 10.222.194.104!\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# ä½¿ç¨NodePort Service\n\nå®ä¹NodePort Serviceå¦ä¸ï¼åClusterIP Serviceæ¯è¾ï¼æ°å¢type: NodePortä»£è¡¨è¯¥Serviceçç±»åæ¯NodePortï¼ç¶ånodePortæ¯èç¹çç«¯å£ï¼å¨æ¯ä¸å°Nodeä¸é½ä¼åå»ºè¿ä¹ä¸ä¸ªç«¯å£ç»éç¾¤å¤è°ç¨ã\n\nkind: Service\napiVersion: v1\nmetadata:\n  name: demoapp-nodeport-svc\nspec:\n  selector:\n    app: demoapp\n  ports:\n  - name: http\n    protocol: TCP\n    port: 80\n    targetPort: 80\n    nodePort: 31999\n  type: NodePort\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nåå»ºè¯¥Serviceï¼å¯ä»¥çå°TYPEæ¯NodePortï¼PORTæ¯80:31999ä»£è¡¨çå°80ç«¯å£æ å°å°èç¹ç31999ç«¯å£\n\n[root@k8s-worker1 zwf]# kubectl apply -f service_nodeport.yaml -n zwf\nservice/demoapp-nodeport-svc created\n\n[root@k8s-worker1 zwf]# kubectl get svc -n zwf -o wide\nNAME                   TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE   SELECTOR\ndemoapp-nodeport-svc   NodePort    10.0.0.144   <none>        80:31999/TCP   10s   app=demoapp\ndemoapp-svc            ClusterIP   10.0.0.74    <none>        80/TCP         47m   app=demoapp\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næä»¬å¯ä»¥å¨éç¾¤å¤éè¿èç¹çIP:31999ç«¯å£ä¸æ ·å¯ä»¥è®¿é®Podæå¡ã\n\nC:\\Users\\User>curl 10.64.2.141:31999\niKubernetes demoapp v1.0 !! ClientIP: 10.64.2.141, ServerName: demo-deploy-6c6d588789-nhzhl, ServerIP: 10.222.194.104!\n\nC:\\Users\\User>curl 10.64.2.141:31999\niKubernetes demoapp v1.0 !! ClientIP: 10.64.2.141, ServerName: demo-deploy-6c6d588789-h9gmd, ServerIP: 10.222.126.1!\n\n\n1\n2\n3\n4\n5\n\n\n\n# å¦ä½å®ç°çä»£çï¼\n\næ¯ä¸ªNodeé½ä¼æä¸ä¸ªkube-proxyè¿ç¨ï¼è¯¥è¿ç¨ä¼çæ§Serviceçåå»ºä¸EndPointsåè¡¨çæ·»å ä¸å é¤ï¼éç½®iptablesè§åï¼å½å®¢æ·ç«¯è¯·æ±ServiceçClusterIPåç«¯å£æ¶ï¼ä¼æ ¹æ®è§åè½®è¯¢è½¬åå°åç«¯çPodä¸­ã\n\n",normalizedContent:"# ä»ä¹æ¯serviceï¼\n\nå°è¿è¡å¨ä¸ç» pods ä¸çåºç¨ç¨åºå¬å¼ä¸ºç½ç»æå¡çæ½è±¡æ¹æ³ã\n\nä¸ºä»ä¹éè¦service?\n\n 1. podçæ°éãipé½æ¯å¨æååçï¼serviceå¯ä»¥ç»è¯¥éåçpodä¸ä¸ªåºå®çipï¼æ è®ºpodçéåå¦ä½æ¹åï¼é½å¯ä»¥éè¿serviceçåºå®ipæ¥è®¿é®å°åºç¨ã\n\n 2. å¯ä»¥ç»podéåæä¾è´è½½åè¡¡çåè½ã\n\nserviceç±»å\n\n * loadbalanceï¼ä½¿ç¨äºæä¾åçè´è½½åè¡¡å¨åå¤é¨æ´é²æå¡ã\n * externalnameï¼å°æå¡æ å°å°æå®çååï¼è¿ä¸ªååå¯ä»¥éç¾¤åé¨ä¹å¯ä»¥æ¯å¤é¨çã\n * nodeportï¼æä¾çæå¡æ¢å¯å¯¹å¤é¨æå¡éè¿nodeip:nodeportè®¿é®ï¼ä¹å¯ä»¥å¯¹éç¾¤åé¨éè¿clusteripè®¿é®\n * clusteripï¼serviceæä¾çè®¿é®ipä»å¨éç¾¤åé¨å¯è¾¾\n\n\n# ä½¿ç¨clusterip service\n\næä»¬å®ä¹serviceå¦ä¸ï¼å¶ä¸­selectoræ¯ç¨æ¥ç­ééè¦ä»£ççpodï¼targetportæ¯ç®æ podçç«¯å£ï¼portæ¯æè¯¥serviceçç«¯å£ã\n\nkind: service \napiversion: v1 \nmetadata: \n  name: demoapp-svc \nspec: \n  selector: \n    app: demoapp \n  ports: \n  - name: http \n    protocol: tcp    \n    port: 80\n    targetport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nä½¿ç¨ä¸é¢å®ä¹çyamlåå»ºserviceå¯¹è±¡ï¼å¹¶å¯ä»¥çå°selectorçå¼æ¯app=demoappï¼æä»¬éè¦åå»ºå¸¦æè¯¥æ ç­¾çpodï¼æè½å¤è¿è¡ä»£çã\n\n[root@k8s-worker1 zwf]# kubectl apply -f service.yaml -n zwf\nservice/demoapp-svc created\n\n[root@k8s-worker1 zwf]# kubectl get svc -n zwf -o wide\nname          type        cluster-ip   external-ip   port(s)   age   selector\ndemoapp-svc   clusterip   10.0.0.74    <none>        80/tcp    18s   app=demoapp\n\n\n1\n2\n3\n4\n5\n6\n\n\nå®ä¹deploymentï¼ä¼åå»ºå¸¦æapp=demoappçpod\n\napiversion: apps/v1\nkind: deployment\nmetadata:\n  labels:\n    app: demoapp\n  name: demo-deploy\n\nspec:\n  replicas: 2\n  selector:\n    matchlabels:\n      app: demoapp\n\n  template:\n    metadata:\n      labels:\n        app: demoapp\n    spec:\n      containers:\n      - image: mirrors.sangfor.com/ikubernetes/demoapp:v1.0\n        name: demoapp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nåå»ºdeploymentå¯¹è±¡ï¼å¹¶ä¸å¯ä»¥çå°åå»ºäº2ä¸ªpod\n\n[root@k8s-worker1 zwf]# kubectl apply -f deployments_service.yaml -n zwf\ndeployment.apps/demo-deploy created\n\n[root@k8s-worker1 zwf]# kubectl get deploy -o wide -n zwf\nname          ready   up-to-date   available   age     containers   images                                         selector\ndemo-deploy   2/2     2            2           2m37s   demoapp      mirrors.sangfor.com/ikubernetes/demoapp:v1.0   app=demoapp\n\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næ¥çpodçè¯¦æï¼å¯ä»¥çå°labelsæä¸ä¸ªapp=demoappçæ ç­¾\n\n[root@k8s-worker1 zwf]# kubectl get pods -o wide -n zwf\nname                           ready   status    restarts   age   ip               node          nominated node   readiness gates\ndemo-deploy-6c6d588789-h9gmd   1/1     running   0          32s   10.222.126.1     k8s-worker2   <none>           <none>\ndemo-deploy-6c6d588789-nhzhl   1/1     running   0          32s   10.222.194.104   k8s-worker1   <none>           <none>\n\n[root@k8s-worker1 zwf]# kubectl describe demo-deploy-6c6d588789-h9gmd -n zwf\nname:         demo-deploy-6c6d588789-h9gmd\nnamespace:    zwf\npriority:     0\nnode:         k8s-worker2/10.64.2.153\nstart time:   tue, 30 aug 2022 19:23:22 +0800\nlabels:       app=demoapp\n              pod-template-hash=6c6d588789\n\n....\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\néè¿æ¥çserviceçè¯¦æï¼æä»¬å¯ä»¥çå°endpointsçå¼æ¯ä¸é¢åå»ºçä¸¤ä¸ªpodçipã\n\n[root@k8s-worker1 zwf]# kubectl describe svc -n zwf\nname:              demoapp-svc\nnamespace:         zwf\nlabels:            <none>\nannotations:       <none>\nselector:          app=demoapp\ntype:              clusterip\nip family policy:  singlestack\nip families:       ipv4\nip:                10.0.0.74\nips:               10.0.0.74\nport:              http  80/tcp\ntargetport:        80/tcp\nendpoints:         10.222.126.1:80,10.222.194.104:80\nsession affinity:  none\nevents:            <none>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nendpointsä¹æ¯ä¸ä¸ªèµæºå¯¹è±¡ï¼serviceéè¿ç­éæ ç­¾å°çpodä¼æ·»å å°endpintsä¸­ä¿å­\n\n[root@k8s-worker1 zwf]# kubectl get endpoints -n zwf\nname          endpoints                           age\ndemoapp-svc   10.222.126.1:80,10.222.194.104:80   15m\n\n\n1\n2\n3\n\n\nè¿ä¸ªæ¶åï¼æä»¬è®¿é®serviceç80ç«¯å£ï¼ä¼è®¿é®å°è½®è¯¢è®¿é®å°è¿ä¸¤ä¸ªpodä¸­ï¼æä»¬å°±å¯ä»¥éè¿è®¿é®serviceæ¥è®¿é®podéåã\n\n[root@k8s-worker1 zwf]# curl 10.0.0.74\nikubernetes demoapp v1.0 !! clientip: 10.64.2.141, servername: demo-deploy-6c6d588789-nhzhl, serverip: 10.222.194.104!\n\n[root@k8s-worker1 zwf]# curl 10.0.0.74\nikubernetes demoapp v1.0 !! clientip: 10.64.2.141, servername: demo-deploy-6c6d588789-h9gmd, serverip: 10.222.126.1!\n\n[root@k8s-worker1 zwf]# curl 10.0.0.74\nikubernetes demoapp v1.0 !! clientip: 10.64.2.141, servername: demo-deploy-6c6d588789-nhzhl, serverip: 10.222.194.104!\n\n[root@k8s-worker1 zwf]# curl 10.0.0.74\nikubernetes demoapp v1.0 !! clientip: 10.64.2.141, servername: demo-deploy-6c6d588789-h9gmd, serverip: 10.222.126.1!\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\né¤äºéè¿clusteripè®¿é®ï¼å¨éç¾¤ä¸­ä¹è½éè¿ååè¿è¡è®¿é®ï¼è®¿é®æ¹å¼ï¼<servicename>.<namespace>.svc.cluster.local\n\n[root@k8s-worker1 zwf]# kubectl exec -it demo-deploy-6c6d588789-h9gmd -n zwf  -- nslookup demoapp-svc.zwf.svc.cluster.local\nserver:         10.0.0.2\naddress:        10.0.0.2#53\n\nname:   demoapp-svc.zwf.svc.cluster.local\naddress: 10.0.0.74\n\n[root@k8s-worker1 zwf]# kubectl exec -it demo-deploy-6c6d588789-h9gmd -n zwf  -- curl demoapp-svc.zwf.svc.cluster.local\nikubernetes demoapp v1.0 !! clientip: 10.64.2.153, servername: demo-deploy-6c6d588789-h9gmd, serverip: 10.222.126.1!\n\n[root@k8s-worker1 zwf]# kubectl exec -it demo-deploy-6c6d588789-h9gmd -n zwf  -- curl demoapp-svc.zwf.svc.cluster.local\nikubernetes demoapp v1.0 !! clientip: 10.222.126.1, servername: demo-deploy-6c6d588789-nhzhl, serverip: 10.222.194.104!\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# ä½¿ç¨nodeport service\n\nå®ä¹nodeport serviceå¦ä¸ï¼åclusterip serviceæ¯è¾ï¼æ°å¢type: nodeportä»£è¡¨è¯¥serviceçç±»åæ¯nodeportï¼ç¶ånodeportæ¯èç¹çç«¯å£ï¼å¨æ¯ä¸å°nodeä¸é½ä¼åå»ºè¿ä¹ä¸ä¸ªç«¯å£ç»éç¾¤å¤è°ç¨ã\n\nkind: service\napiversion: v1\nmetadata:\n  name: demoapp-nodeport-svc\nspec:\n  selector:\n    app: demoapp\n  ports:\n  - name: http\n    protocol: tcp\n    port: 80\n    targetport: 80\n    nodeport: 31999\n  type: nodeport\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nåå»ºè¯¥serviceï¼å¯ä»¥çå°typeæ¯nodeportï¼portæ¯80:31999ä»£è¡¨çå°80ç«¯å£æ å°å°èç¹ç31999ç«¯å£\n\n[root@k8s-worker1 zwf]# kubectl apply -f service_nodeport.yaml -n zwf\nservice/demoapp-nodeport-svc created\n\n[root@k8s-worker1 zwf]# kubectl get svc -n zwf -o wide\nname                   type        cluster-ip   external-ip   port(s)        age   selector\ndemoapp-nodeport-svc   nodeport    10.0.0.144   <none>        80:31999/tcp   10s   app=demoapp\ndemoapp-svc            clusterip   10.0.0.74    <none>        80/tcp         47m   app=demoapp\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næä»¬å¯ä»¥å¨éç¾¤å¤éè¿èç¹çip:31999ç«¯å£ä¸æ ·å¯ä»¥è®¿é®podæå¡ã\n\nc:\\users\\user>curl 10.64.2.141:31999\nikubernetes demoapp v1.0 !! clientip: 10.64.2.141, servername: demo-deploy-6c6d588789-nhzhl, serverip: 10.222.194.104!\n\nc:\\users\\user>curl 10.64.2.141:31999\nikubernetes demoapp v1.0 !! clientip: 10.64.2.141, servername: demo-deploy-6c6d588789-h9gmd, serverip: 10.222.126.1!\n\n\n1\n2\n3\n4\n5\n\n\n\n# å¦ä½å®ç°çä»£çï¼\n\næ¯ä¸ªnodeé½ä¼æä¸ä¸ªkube-proxyè¿ç¨ï¼è¯¥è¿ç¨ä¼çæ§serviceçåå»ºä¸endpointsåè¡¨çæ·»å ä¸å é¤ï¼éç½®iptablesè§åï¼å½å®¢æ·ç«¯è¯·æ±serviceçclusteripåç«¯å£æ¶ï¼ä¼æ ¹æ®è§åè½®è¯¢è½¬åå°åç«¯çpodä¸­ã\n\n",charsets:{cjk:!0},lastUpdated:"2023/01/15, 20:17:10",lastUpdatedTimestamp:167378503e4},{title:"k8sä¹ConfigMapåSecret",frontmatter:{tags:["k8s","å®¹å¨","äºåç"],title:"k8sä¹ConfigMapåSecret",date:"2022-08-30T21:16:09.000Z",permalink:"/pages/ff8188/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä»ç»k8sä¸­çconfigmapåsecretèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾",feed:{enable:!0},categories:["äºåç","k8s"],comment:!0,meta:[{name:"twitter:title",content:"k8sä¹ConfigMapåSecret"},{name:"twitter:description",content:"ä»ç»k8sä¸­çconfigmapåsecretèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/06.k8s%E4%B9%8BConfigMap%E5%92%8CSecret.html"},{property:"og:type",content:"article"},{property:"og:title",content:"k8sä¹ConfigMapåSecret"},{property:"og:description",content:"ä»ç»k8sä¸­çconfigmapåsecretèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/06.k8s%E4%B9%8BConfigMap%E5%92%8CSecret.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-30T21:16:09.000Z"},{property:"article:tag",content:"k8s"},{property:"article:tag",content:"å®¹å¨"},{property:"article:tag",content:"äºåç"},{itemprop:"name",content:"k8sä¹ConfigMapåSecret"},{itemprop:"description",content:"ä»ç»k8sä¸­çconfigmapåsecretèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/06.k8s%E4%B9%8BConfigMap%E5%92%8CSecret.html",relativePath:"01.äºåç/07.k8s/06.k8sä¹ConfigMapåSecret.md",key:"v-064e6b52",path:"/pages/ff8188/",headers:[{level:2,title:"ConfigMap",slug:"configmap",normalizedTitle:"configmap",charIndex:2},{level:3,title:"ä»ä¹æ¯ConfigMap?",slug:"ä»ä¹æ¯configmap",normalizedTitle:"ä»ä¹æ¯configmap?",charIndex:16},{level:3,title:"åå»ºConifgMap",slug:"åå»ºconifgmap",normalizedTitle:"åå»ºconifgmap",charIndex:54},{level:2,title:"Secret",slug:"secret",normalizedTitle:"secret",charIndex:526},{level:3,title:"ä»ä¹æ¯Secret?",slug:"ä»ä¹æ¯secret",normalizedTitle:"ä»ä¹æ¯secret?",charIndex:537},{level:3,title:"åå»ºSecret",slug:"åå»ºsecret",normalizedTitle:"åå»ºsecret",charIndex:650},{level:2,title:"å¦ä½ä½¿ç¨ConfigMap/Secret",slug:"å¦ä½ä½¿ç¨configmap-secret",normalizedTitle:"å¦ä½ä½¿ç¨configmap/secret",charIndex:2439},{level:3,title:"æ³¨å¥ç¯å¢åé",slug:"æ³¨å¥ç¯å¢åé",normalizedTitle:"æ³¨å¥ç¯å¢åé",charIndex:2544},{level:3,title:"æ³¨å¥éç½®æä»¶",slug:"æ³¨å¥éç½®æä»¶",normalizedTitle:"æ³¨å¥éç½®æä»¶",charIndex:4200}],headersStr:"ConfigMap ä»ä¹æ¯ConfigMap? åå»ºConifgMap Secret ä»ä¹æ¯Secret? åå»ºSecret å¦ä½ä½¿ç¨ConfigMap/Secret æ³¨å¥ç¯å¢åé æ³¨å¥éç½®æä»¶",content:'# ConfigMap\n\n\n# ä»ä¹æ¯ConfigMap?\n\nç¨æ¥å­å¨åºç¨æéè¦çææéç½®æ°æ®çã\n\n\n# åå»ºConifgMap\n\nä½¿ç¨yamlå®ä¹ConfigMapå¯¹è±¡ï¼å¨dataå­æ®µä¸­å®ä¹éç½®æ°æ®ã\n\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: info\n\ndata:\n  count: \'10\'\n  debug: \'on\'\n  path: \'/etc/systemd\'\n  greeting: |\n    say hello to kubernetes.\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nä½¿ç¨å®ä¹çyamlæä»¶åå»ºConfigMapå¯¹è±¡\n\n[root@k8s-worker1 zwf]# kubectl apply -f config.yaml  -n zwf\nconfigmap/info created\n\n[root@k8s-worker1 zwf]# kubectl get cm -n zwf\nNAME               DATA   AGE\ninfo               4      9s\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# Secret\n\n\n# ä»ä¹æ¯Secret?\n\nåConfigMapåºæ¬ç¸åï¼å·®å¼å¨äºå­å¨çæ¯å¯æçéç½®æ°æ®ã\n\nå·ä½çä½ç°å¨äºï¼ä½¿ç¨kubectl describeæ¶ï¼ConfigMapå¯ä»¥çå°éç½®ä¿¡æ¯ï¼èSecretæ¯çä¸å°å·ä½åå®¹çã\n\n\n# åå»ºSecret\n\nä½¿ç¨yamlæè¿°æä»¶åå»ºSecretå¯¹è±¡ï¼å¶ä¸­çæ°æ®å¿é¡»å¾æ¯base64ç¼ç çå¯æï¼å¦åä¼åå»ºå¤±è´¥ã\n\napiVersion: v1\nkind: Secret\nmetadata:\n  name: user\n\ndata:\n  name: cm9vdA==  # root\n  pwd: MTIzNDU2   # 123456\n  db: bXlzcWw=    # mysql\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nä½¿ç¨ä¸é¢çyamlæä»¶åå»ºSecretå¯¹è±¡\n\n[root@k8s-worker1 zwf]# kubectl apply -f secret.yaml -n zwf\nsecret/user created\n\n[root@k8s-worker1 zwf]# kubectl get secret -n zwf\nNAME                                 TYPE                                  DATA   AGE\nuser                                 Opaque                                3      9s\n\n\n1\n2\n3\n4\n5\n6\n\n\néè¿æ¥çSecretè¯¦æï¼ä¼åç°é½æ¯å¯æçï¼æ æ³æ¥ç\n\n[root@k8s-worker1 zwf]# kubectl describe secret user -n zwf\nName:         user\nNamespace:    zwf\nLabels:       <none>\nAnnotations:  <none>\n\nType:  Opaque\n\nData\n====\ndb:    5 bytes\nname:  4 bytes\npwd:   6 bytes\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nä½æ¯è¿æ¯å¯ä»¥éè¿èªå·±éè¿base64è§£ç æ¥è·å\n\n[root@k8s-worker1 zwf]# kubectl get secret user -n zwf -o json\n{\n    "apiVersion": "v1",\n    "data": {\n        "db": "bXlzcWw=",\n        "name": "cm9vdA==",\n        "pwd": "MTIzNDU2"\n    },\n    "kind": "Secret",\n    "metadata": {\n        "annotations": {\n            "kubectl.kubernetes.io/last-applied-configuration": "{\\"apiVersion\\":\\"v1\\",\\"data\\":{\\"db\\":\\"bXlzcWw=\\",\\"name\\":\\"cm9vdA==\\",\\"pwd\\":\\"MTIzNDU2\\"},\\"kind\\":\\"Secret\\",\\"metadata\\":{\\"annotations\\":{},\\"name\\":\\"user\\",\\"namespace\\":\\"zwf\\"}}\\n"\n        },\n        "creationTimestamp": "2022-08-31T01:43:30Z",\n        "name": "user",\n        "namespace": "zwf",\n        "resourceVersion": "17208325",\n        "uid": "c5082495-1b85-42ef-a202-596d65e2449c"\n    },\n    "type": "Opaque"\n}\n\n[root@k8s-worker1 zwf]#  kubectl get secret user -n zwf -o jsonpath="{.data.name}" | base64 --decode\nroot\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# å¦ä½ä½¿ç¨ConfigMap/Secret\n\nä½¿ç¨çæ¹å¼\n\n * å°éç½®ä»¥ç¯å¢åéçæ¹å¼æ³¨å¥å°å®¹å¨ä¸­ï¼åºç¨ç¨åºä»ç¯å¢åéä¸­è·åéç½®\n\n * å°éç½®ä»¥æä»¶çæ¹å¼æ¾å¨å®¹å¨çç®å½ä¸­ï¼åºç¨ç¨åºä»æä»¶ä¸­è·åéç½®ã\n\n\n# æ³¨å¥ç¯å¢åé\n\nå®ä¹Deploymentçyamlæä»¶ï¼å¨containersä¸çenvä¸­ä½¿ç¨configMapKeyRefæ¥ä½¿ç¨ConfigMapä¸­çå¼ä½ä¸ºç¯å¢åéã\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: ngx-dep\n  name: ngx-dep\n\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: ngx-dep\n\n  template:\n    metadata:\n      labels:\n        app: ngx-dep\n    spec:\n      containers:\n      - image: mirrors.sangfor.com/nginx:alpine\n        name: nginx2\n        ports:\n        - containerPort: 80\n        env:\n        - name: count\n          valueFrom:\n            configMapKeyRef:\n              name: info\n              key: count\n        - name: debug\n          valueFrom:\n            configMapKeyRef:\n              name: info\n              key: debug\n        - name: pwd\n          valueFrom:\n            secretKeyRef:\n              name: user\n              key: pwd\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\nä½¿ç¨ä¸é¢å®ä¹çyamlåå»ºDeploymentå¯¹è±¡\n\n[root@k8s-worker1 zwf]# kubectl apply -f deployments_cm.yaml -n zwf\ndeployment.apps/ngx-dep created\n\n[root@k8s-worker1 zwf]# kubectl get deploy -n zwf\nNAME      READY   UP-TO-DATE   AVAILABLE   AGE\nngx-dep   2/2     2            2           1h\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf\nNAME                       READY   STATUS    RESTARTS   AGE\nngx-dep-6c659bcc45-nnkgz   1/1     Running   0          8s\nngx-dep-6c659bcc45-rgfxx   1/1     Running   0          6s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nè¿å¥å°å®¹å¨ä¸­ï¼å¯ä»¥æ¥çå°æä»¬è®¾ç½®debugãcountãpwdçå¼\n\n[root@k8s-worker1 zwf]# kubectl exec -it ngx-dep-6c659bcc45-nnkgz -n zwf -- /bin/sh\n/ # echo $debug\non\n/ # echo $count\n10\n/ # echo $pwd\n123456\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# æ³¨å¥éç½®æä»¶\n\nç¼åæè¿°Deploymentæä»¶ï¼å¨sepcä¸å®ä¹ä¸¤ä¸ªvolumeï¼ç¶åå¨containersä¸è¿è¡ä½¿ç¨volumeMountså­æ®µè¿è¡æè½½ã\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: ngx-dep\n  name: ngx-dep\n\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: ngx-dep\n\n  template:\n    metadata:\n      labels:\n        app: ngx-dep\n    spec:\n      containers:\n      - image: mirrors.sangfor.com/nginx:alpine\n        name: nginx2\n        ports:\n        - containerPort: 80\n      - volumeMountsï¼\n        - mountPath: /tmp/cm-items\n          name: cm-vol\n        - mountPath: /tmp/sec-items\n          name: sec-vol\n\n      volumes:\n      - name: cm-vol\n        configMap:\n          name: info\n\t  - name: sec-vol \n\t    secret: \n\t    secretName: user\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n\nåå»ºè¯¥Deploymentå¯¹è±¡\n\n[root@k8s-worker1 zwf]# kubectl apply -f deployments_cm_file.yaml -n zwf\ndeployment.apps/ngx-dep configured\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf\nNAME                       READY   STATUS    RESTARTS   AGE\nngx-dep-798f6f6c4f-cg6lv   1/1     Running   0          9s\nngx-dep-798f6f6c4f-s8wws   1/1     Running   0          6s\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næä»¬å¯ä»¥çå°å¨å®¹å¨åé¨å¨tmpç®å½ä¸åå»ºäºcm-itemsåsec-itemsç®å½\n\n[root@k8s-worker1 zwf]# kubectl exec -it ngx-dep-798f6f6c4f-cg6lv -n zwf -- ls /tmp/\ncm-items   sec-items\n\n\n1\n2\n\n\nåçå°è¿ä¸¤ä¸ªç®å½ä¸çæä»¶ï¼é½æ¯ä»¥ConfigMapåSecretä¸­å®ä¹çkeyä¸ºæä»¶åï¼valueä¸ºæä»¶ä¸­çåå®¹\n\n[root@k8s-worker1 zwf]# kubectl exec -it ngx-dep-798f6f6c4f-cg6lv -n zwf -- ls /tmp/cm-items\ncount     debug     greeting  path\n[root@k8s-worker1 zwf]# kubectl exec -it ngx-dep-798f6f6c4f-cg6lv -n zwf -- cat /tmp/cm-items/debug\non\n\n[root@k8s-worker1 zwf]# kubectl exec -it ngx-dep-798f6f6c4f-cg6lv -n zwf -- ls /tmp/sec-items\ndb    name  pwd\n[root@k8s-worker1 zwf]# kubectl exec -it ngx-dep-798f6f6c4f-cg6lv -n zwf -- cat /tmp/sec-items/pwd\n123456\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n',normalizedContent:'# configmap\n\n\n# ä»ä¹æ¯configmap?\n\nç¨æ¥å­å¨åºç¨æéè¦çææéç½®æ°æ®çã\n\n\n# åå»ºconifgmap\n\nä½¿ç¨yamlå®ä¹configmapå¯¹è±¡ï¼å¨dataå­æ®µä¸­å®ä¹éç½®æ°æ®ã\n\napiversion: v1\nkind: configmap\nmetadata:\n  name: info\n\ndata:\n  count: \'10\'\n  debug: \'on\'\n  path: \'/etc/systemd\'\n  greeting: |\n    say hello to kubernetes.\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nä½¿ç¨å®ä¹çyamlæä»¶åå»ºconfigmapå¯¹è±¡\n\n[root@k8s-worker1 zwf]# kubectl apply -f config.yaml  -n zwf\nconfigmap/info created\n\n[root@k8s-worker1 zwf]# kubectl get cm -n zwf\nname               data   age\ninfo               4      9s\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# secret\n\n\n# ä»ä¹æ¯secret?\n\nåconfigmapåºæ¬ç¸åï¼å·®å¼å¨äºå­å¨çæ¯å¯æçéç½®æ°æ®ã\n\nå·ä½çä½ç°å¨äºï¼ä½¿ç¨kubectl describeæ¶ï¼configmapå¯ä»¥çå°éç½®ä¿¡æ¯ï¼èsecretæ¯çä¸å°å·ä½åå®¹çã\n\n\n# åå»ºsecret\n\nä½¿ç¨yamlæè¿°æä»¶åå»ºsecretå¯¹è±¡ï¼å¶ä¸­çæ°æ®å¿é¡»å¾æ¯base64ç¼ç çå¯æï¼å¦åä¼åå»ºå¤±è´¥ã\n\napiversion: v1\nkind: secret\nmetadata:\n  name: user\n\ndata:\n  name: cm9vda==  # root\n  pwd: mtizndu2   # 123456\n  db: bxlzcww=    # mysql\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nä½¿ç¨ä¸é¢çyamlæä»¶åå»ºsecretå¯¹è±¡\n\n[root@k8s-worker1 zwf]# kubectl apply -f secret.yaml -n zwf\nsecret/user created\n\n[root@k8s-worker1 zwf]# kubectl get secret -n zwf\nname                                 type                                  data   age\nuser                                 opaque                                3      9s\n\n\n1\n2\n3\n4\n5\n6\n\n\néè¿æ¥çsecretè¯¦æï¼ä¼åç°é½æ¯å¯æçï¼æ æ³æ¥ç\n\n[root@k8s-worker1 zwf]# kubectl describe secret user -n zwf\nname:         user\nnamespace:    zwf\nlabels:       <none>\nannotations:  <none>\n\ntype:  opaque\n\ndata\n====\ndb:    5 bytes\nname:  4 bytes\npwd:   6 bytes\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nä½æ¯è¿æ¯å¯ä»¥éè¿èªå·±éè¿base64è§£ç æ¥è·å\n\n[root@k8s-worker1 zwf]# kubectl get secret user -n zwf -o json\n{\n    "apiversion": "v1",\n    "data": {\n        "db": "bxlzcww=",\n        "name": "cm9vda==",\n        "pwd": "mtizndu2"\n    },\n    "kind": "secret",\n    "metadata": {\n        "annotations": {\n            "kubectl.kubernetes.io/last-applied-configuration": "{\\"apiversion\\":\\"v1\\",\\"data\\":{\\"db\\":\\"bxlzcww=\\",\\"name\\":\\"cm9vda==\\",\\"pwd\\":\\"mtizndu2\\"},\\"kind\\":\\"secret\\",\\"metadata\\":{\\"annotations\\":{},\\"name\\":\\"user\\",\\"namespace\\":\\"zwf\\"}}\\n"\n        },\n        "creationtimestamp": "2022-08-31t01:43:30z",\n        "name": "user",\n        "namespace": "zwf",\n        "resourceversion": "17208325",\n        "uid": "c5082495-1b85-42ef-a202-596d65e2449c"\n    },\n    "type": "opaque"\n}\n\n[root@k8s-worker1 zwf]#  kubectl get secret user -n zwf -o jsonpath="{.data.name}" | base64 --decode\nroot\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# å¦ä½ä½¿ç¨configmap/secret\n\nä½¿ç¨çæ¹å¼\n\n * å°éç½®ä»¥ç¯å¢åéçæ¹å¼æ³¨å¥å°å®¹å¨ä¸­ï¼åºç¨ç¨åºä»ç¯å¢åéä¸­è·åéç½®\n\n * å°éç½®ä»¥æä»¶çæ¹å¼æ¾å¨å®¹å¨çç®å½ä¸­ï¼åºç¨ç¨åºä»æä»¶ä¸­è·åéç½®ã\n\n\n# æ³¨å¥ç¯å¢åé\n\nå®ä¹deploymentçyamlæä»¶ï¼å¨containersä¸çenvä¸­ä½¿ç¨configmapkeyrefæ¥ä½¿ç¨configmapä¸­çå¼ä½ä¸ºç¯å¢åéã\n\napiversion: apps/v1\nkind: deployment\nmetadata:\n  labels:\n    app: ngx-dep\n  name: ngx-dep\n\nspec:\n  replicas: 2\n  selector:\n    matchlabels:\n      app: ngx-dep\n\n  template:\n    metadata:\n      labels:\n        app: ngx-dep\n    spec:\n      containers:\n      - image: mirrors.sangfor.com/nginx:alpine\n        name: nginx2\n        ports:\n        - containerport: 80\n        env:\n        - name: count\n          valuefrom:\n            configmapkeyref:\n              name: info\n              key: count\n        - name: debug\n          valuefrom:\n            configmapkeyref:\n              name: info\n              key: debug\n        - name: pwd\n          valuefrom:\n            secretkeyref:\n              name: user\n              key: pwd\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\nä½¿ç¨ä¸é¢å®ä¹çyamlåå»ºdeploymentå¯¹è±¡\n\n[root@k8s-worker1 zwf]# kubectl apply -f deployments_cm.yaml -n zwf\ndeployment.apps/ngx-dep created\n\n[root@k8s-worker1 zwf]# kubectl get deploy -n zwf\nname      ready   up-to-date   available   age\nngx-dep   2/2     2            2           1h\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf\nname                       ready   status    restarts   age\nngx-dep-6c659bcc45-nnkgz   1/1     running   0          8s\nngx-dep-6c659bcc45-rgfxx   1/1     running   0          6s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nè¿å¥å°å®¹å¨ä¸­ï¼å¯ä»¥æ¥çå°æä»¬è®¾ç½®debugãcountãpwdçå¼\n\n[root@k8s-worker1 zwf]# kubectl exec -it ngx-dep-6c659bcc45-nnkgz -n zwf -- /bin/sh\n/ # echo $debug\non\n/ # echo $count\n10\n/ # echo $pwd\n123456\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# æ³¨å¥éç½®æä»¶\n\nç¼åæè¿°deploymentæä»¶ï¼å¨sepcä¸å®ä¹ä¸¤ä¸ªvolumeï¼ç¶åå¨containersä¸è¿è¡ä½¿ç¨volumemountså­æ®µè¿è¡æè½½ã\n\napiversion: apps/v1\nkind: deployment\nmetadata:\n  labels:\n    app: ngx-dep\n  name: ngx-dep\n\nspec:\n  replicas: 2\n  selector:\n    matchlabels:\n      app: ngx-dep\n\n  template:\n    metadata:\n      labels:\n        app: ngx-dep\n    spec:\n      containers:\n      - image: mirrors.sangfor.com/nginx:alpine\n        name: nginx2\n        ports:\n        - containerport: 80\n      - volumemountsï¼\n        - mountpath: /tmp/cm-items\n          name: cm-vol\n        - mountpath: /tmp/sec-items\n          name: sec-vol\n\n      volumes:\n      - name: cm-vol\n        configmap:\n          name: info\n\t  - name: sec-vol \n\t    secret: \n\t    secretname: user\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n\nåå»ºè¯¥deploymentå¯¹è±¡\n\n[root@k8s-worker1 zwf]# kubectl apply -f deployments_cm_file.yaml -n zwf\ndeployment.apps/ngx-dep configured\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf\nname                       ready   status    restarts   age\nngx-dep-798f6f6c4f-cg6lv   1/1     running   0          9s\nngx-dep-798f6f6c4f-s8wws   1/1     running   0          6s\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næä»¬å¯ä»¥çå°å¨å®¹å¨åé¨å¨tmpç®å½ä¸åå»ºäºcm-itemsåsec-itemsç®å½\n\n[root@k8s-worker1 zwf]# kubectl exec -it ngx-dep-798f6f6c4f-cg6lv -n zwf -- ls /tmp/\ncm-items   sec-items\n\n\n1\n2\n\n\nåçå°è¿ä¸¤ä¸ªç®å½ä¸çæä»¶ï¼é½æ¯ä»¥configmapåsecretä¸­å®ä¹çkeyä¸ºæä»¶åï¼valueä¸ºæä»¶ä¸­çåå®¹\n\n[root@k8s-worker1 zwf]# kubectl exec -it ngx-dep-798f6f6c4f-cg6lv -n zwf -- ls /tmp/cm-items\ncount     debug     greeting  path\n[root@k8s-worker1 zwf]# kubectl exec -it ngx-dep-798f6f6c4f-cg6lv -n zwf -- cat /tmp/cm-items/debug\non\n\n[root@k8s-worker1 zwf]# kubectl exec -it ngx-dep-798f6f6c4f-cg6lv -n zwf -- ls /tmp/sec-items\ndb    name  pwd\n[root@k8s-worker1 zwf]# kubectl exec -it ngx-dep-798f6f6c4f-cg6lv -n zwf -- cat /tmp/sec-items/pwd\n123456\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n',charsets:{cjk:!0},lastUpdated:"2023/01/15, 20:17:10",lastUpdatedTimestamp:167378503e4},{title:"k8sä¹JobåCronJob",frontmatter:{tags:["k8s","å®¹å¨","äºåç"],title:"k8sä¹JobåCronJob",date:"2022-08-31T10:34:54.000Z",permalink:"/pages/c96905/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä»ç»k8sä¸­çjobèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾",feed:{enable:!0},categories:["äºåç","k8s"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220721102314.png"},{name:"twitter:title",content:"k8sä¹JobåCronJob"},{name:"twitter:description",content:"ä»ç»k8sä¸­çjobèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220721102314.png"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/07.k8s%E4%B9%8BJob%E5%92%8CCronJob.html"},{property:"og:type",content:"article"},{property:"og:title",content:"k8sä¹JobåCronJob"},{property:"og:description",content:"ä»ç»k8sä¸­çjobèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220721102314.png"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/07.k8s%E4%B9%8BJob%E5%92%8CCronJob.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-31T10:34:54.000Z"},{property:"article:tag",content:"k8s"},{property:"article:tag",content:"å®¹å¨"},{property:"article:tag",content:"äºåç"},{itemprop:"name",content:"k8sä¹JobåCronJob"},{itemprop:"description",content:"ä»ç»k8sä¸­çjobèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220721102314.png"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/07.k8s%E4%B9%8BJob%E5%92%8CCronJob.html",relativePath:"01.äºåç/07.k8s/07.k8sä¹JobåCronJob.md",key:"v-86796282",path:"/pages/c96905/",headers:[{level:2,title:"Job",slug:"job",normalizedTitle:"job",charIndex:2},{level:3,title:"ä»ä¹æ¯Job?",slug:"ä»ä¹æ¯job",normalizedTitle:"ä»ä¹æ¯job?",charIndex:10},{level:3,title:"ä½¿ç¨Job",slug:"ä½¿ç¨job",normalizedTitle:"ä½¿ç¨job",charIndex:46},{level:2,title:"CronJob",slug:"cronjob",normalizedTitle:"cronjob",charIndex:1082},{level:3,title:"ä»ä¹æ¯ConJobï¼",slug:"ä»ä¹æ¯conjob",normalizedTitle:"ä»ä¹æ¯conjobï¼",charIndex:1094},{level:3,title:"ä½¿ç¨CronJob",slug:"ä½¿ç¨cronjob",normalizedTitle:"ä½¿ç¨cronjob",charIndex:1121}],headersStr:"Job ä»ä¹æ¯Job? ä½¿ç¨Job CronJob ä»ä¹æ¯ConJobï¼ ä½¿ç¨CronJob",content:'# Job\n\n\n# ä»ä¹æ¯Job?\n\nè¯¥å¯¹è±¡æ¯ç¨æ¥æ§è¡è¿è¡ä¸æ®µæ¶é´åä¼éåºçä»»å¡ã\n\n\n# ä½¿ç¨Job\n\nä½¿ç¨yamlæè¿°Jobå¯¹è±¡ï¼å¶ä¸­restartPolicyæ¯éå¯ç­ç¥ï¼éè¦è®¾å®ä¸ºOnFailureï¼ä»£è¡¨çå¦æå¤±è´¥åéå¯ï¼å¦ææ¯æ­£å¸¸æ§è¡å®æéåºï¼åä¸éè¦åæ¬¡å¯å¨ãé»è®¤çå¼æ¯Alwaysï¼ä¼ä¿æçè¯¥Podæ»æ¯è¿è¡çã\n\ntemplateä¸çPodæ¨¡æ¿ï¼Jobéè¿è¯¥æ¨¡æ¿æ¥åå»ºPodã\n\napiVersion: batch/v1\nkind: Job\nmetadata:\n  name: echo-job\n\nspec:\n  template:\n    spec:\n      restartPolicy: OnFailure\n      containers:\n      - image: busybox\n        name: echo-job\n        command: ["/bin/echo"]\n        args: ["hello", "world"]\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n\nä½¿ç¨yamlæä»¶åå»ºJobï¼ç¶åæ¥çjobçpodå¯¹è±¡ï¼ä¼åç°å®çSTATUSç¶æä¸ºCompletedï¼å ä¸ºè¯¥jobæ­£å¸¸å®æç»æéåºäºã\n\n[root@k8s-worker1 zwf]# kubectl apply -f job.yaml -n zwf\njob.batch/echo-job created\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf\nNAME                       READY   STATUS      RESTARTS   AGE\necho-job-45pmc             0/1     Completed   0          5s\n\n\n1\n2\n3\n4\n5\n6\n\n\nåæ¥çä¸è¯¥Completedçlogï¼ä¼åç°å·²ç»è¾åºäºhello world\n\n[root@k8s-worker1 zwf]# kubectl logs echo-job-45pmc  -n zwf\nhello world\n\n\n1\n2\n\n\nJobçåæ°\n\n * activeDeadlineSecondsï¼è®¾ç½® Pod è¿è¡çè¶æ¶æ¶é´ã\n\n * backoffLimitï¼è®¾ç½® Pod çå¤±è´¥éè¯æ¬¡æ°ã\n\nä¸ºä»ä¹ä¸ç´æ¥å¨Podä¸å®ç°ï¼èè¦æ°åå»ºå¯¹è±¡Job?\n\nä¿æåä¸ååï¼å°ä¸å¡ç¹æ§ä¸å®¹å¨ç®¡çåå¼ã\n\n\n# CronJob\n\n\n# ä»ä¹æ¯ConJobï¼\n\nè¯¥å¯¹è±¡ç¨äºå®æ¶ä»»å¡ã\n\n\n# ä½¿ç¨CronJob\n\nä½¿ç¨Yamlæè¿°CronJobå¯¹è±¡ï¼ä¼åç°è¯¥å¯¹è±¡å¤äºä¸ä¸ªscheduleå­æ®µï¼è¿ä¸ªæ¯ç¨æ¥æè¿°å®æ¶ä»»å¡å¨æçè§åï¼jobTemplateæ¯Jobå¯¹è±¡çæ¨¡æ¿ï¼ä¹å°±æ¯å¨å®æ¶å¨æåä¸æ­åå»ºJobå¯¹è±¡æ¥è¾¾å°å®æ¶ä»»å¡çç®çï¼ä¹æ¯ä¸ç§ç»åçæ¹å¼ã\n\n\napiVersion: batch/v1\nkind: CronJob\nmetadata:\n  name: echo-cj\n\nspec:\n  schedule: \'*/1 * * * *\'\n  jobTemplate:\n    spec:\n      template:\n        spec:\n          restartPolicy: OnFailure\n          containers:\n          - image: busybox\n            name: echo-cj\n            imagePullPolicy: IfNotPresent\n            command: ["/bin/echo"]\n            args: ["hello", "world"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n\n\nä½¿ç¨å®ä¹çYamlåå»ºCronJob\n\n[root@k8s-worker1 zwf]# kubectl apply -f cronjob.yaml -n zwf\ncronjob.batch/echo-cj created\n\n[root@k8s-worker1 zwf]# kubectl get cronjob -n zwf\nNAME      SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE\necho-cj   */1 * * * *   False     1        1s              2m24s\n\n\n1\n2\n3\n4\n5\n6\n\n\nç­å¾3åéåï¼åå»ºäº3ä¸ªCronJobçPodï¼å¹¶ä¸éè¿AGEå¯ä»¥åç°æ¯æ¯åéåå»ºä¸ä¸ªã\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf\nNAME                       READY   STATUS      RESTARTS   AGE\necho-cj-27698578-jtfxm     0/1     Completed   0          2m23s\necho-cj-27698579-cdzxg     0/1     Completed   0          83s\necho-cj-27698580-rfp72     0/1     Completed   0          23s\n\n\n1\n2\n3\n4\n5\n',normalizedContent:'# job\n\n\n# ä»ä¹æ¯job?\n\nè¯¥å¯¹è±¡æ¯ç¨æ¥æ§è¡è¿è¡ä¸æ®µæ¶é´åä¼éåºçä»»å¡ã\n\n\n# ä½¿ç¨job\n\nä½¿ç¨yamlæè¿°jobå¯¹è±¡ï¼å¶ä¸­restartpolicyæ¯éå¯ç­ç¥ï¼éè¦è®¾å®ä¸ºonfailureï¼ä»£è¡¨çå¦æå¤±è´¥åéå¯ï¼å¦ææ¯æ­£å¸¸æ§è¡å®æéåºï¼åä¸éè¦åæ¬¡å¯å¨ãé»è®¤çå¼æ¯alwaysï¼ä¼ä¿æçè¯¥podæ»æ¯è¿è¡çã\n\ntemplateä¸çpodæ¨¡æ¿ï¼jobéè¿è¯¥æ¨¡æ¿æ¥åå»ºpodã\n\napiversion: batch/v1\nkind: job\nmetadata:\n  name: echo-job\n\nspec:\n  template:\n    spec:\n      restartpolicy: onfailure\n      containers:\n      - image: busybox\n        name: echo-job\n        command: ["/bin/echo"]\n        args: ["hello", "world"]\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n\nä½¿ç¨yamlæä»¶åå»ºjobï¼ç¶åæ¥çjobçpodå¯¹è±¡ï¼ä¼åç°å®çstatusç¶æä¸ºcompletedï¼å ä¸ºè¯¥jobæ­£å¸¸å®æç»æéåºäºã\n\n[root@k8s-worker1 zwf]# kubectl apply -f job.yaml -n zwf\njob.batch/echo-job created\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf\nname                       ready   status      restarts   age\necho-job-45pmc             0/1     completed   0          5s\n\n\n1\n2\n3\n4\n5\n6\n\n\nåæ¥çä¸è¯¥completedçlogï¼ä¼åç°å·²ç»è¾åºäºhello world\n\n[root@k8s-worker1 zwf]# kubectl logs echo-job-45pmc  -n zwf\nhello world\n\n\n1\n2\n\n\njobçåæ°\n\n * activedeadlinesecondsï¼è®¾ç½® pod è¿è¡çè¶æ¶æ¶é´ã\n\n * backofflimitï¼è®¾ç½® pod çå¤±è´¥éè¯æ¬¡æ°ã\n\nä¸ºä»ä¹ä¸ç´æ¥å¨podä¸å®ç°ï¼èè¦æ°åå»ºå¯¹è±¡job?\n\nä¿æåä¸ååï¼å°ä¸å¡ç¹æ§ä¸å®¹å¨ç®¡çåå¼ã\n\n\n# cronjob\n\n\n# ä»ä¹æ¯conjobï¼\n\nè¯¥å¯¹è±¡ç¨äºå®æ¶ä»»å¡ã\n\n\n# ä½¿ç¨cronjob\n\nä½¿ç¨yamlæè¿°cronjobå¯¹è±¡ï¼ä¼åç°è¯¥å¯¹è±¡å¤äºä¸ä¸ªscheduleå­æ®µï¼è¿ä¸ªæ¯ç¨æ¥æè¿°å®æ¶ä»»å¡å¨æçè§åï¼jobtemplateæ¯jobå¯¹è±¡çæ¨¡æ¿ï¼ä¹å°±æ¯å¨å®æ¶å¨æåä¸æ­åå»ºjobå¯¹è±¡æ¥è¾¾å°å®æ¶ä»»å¡çç®çï¼ä¹æ¯ä¸ç§ç»åçæ¹å¼ã\n\n\napiversion: batch/v1\nkind: cronjob\nmetadata:\n  name: echo-cj\n\nspec:\n  schedule: \'*/1 * * * *\'\n  jobtemplate:\n    spec:\n      template:\n        spec:\n          restartpolicy: onfailure\n          containers:\n          - image: busybox\n            name: echo-cj\n            imagepullpolicy: ifnotpresent\n            command: ["/bin/echo"]\n            args: ["hello", "world"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n\n\nä½¿ç¨å®ä¹çyamlåå»ºcronjob\n\n[root@k8s-worker1 zwf]# kubectl apply -f cronjob.yaml -n zwf\ncronjob.batch/echo-cj created\n\n[root@k8s-worker1 zwf]# kubectl get cronjob -n zwf\nname      schedule      suspend   active   last schedule   age\necho-cj   */1 * * * *   false     1        1s              2m24s\n\n\n1\n2\n3\n4\n5\n6\n\n\nç­å¾3åéåï¼åå»ºäº3ä¸ªcronjobçpodï¼å¹¶ä¸éè¿ageå¯ä»¥åç°æ¯æ¯åéåå»ºä¸ä¸ªã\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf\nname                       ready   status      restarts   age\necho-cj-27698578-jtfxm     0/1     completed   0          2m23s\necho-cj-27698579-cdzxg     0/1     completed   0          83s\necho-cj-27698580-rfp72     0/1     completed   0          23s\n\n\n1\n2\n3\n4\n5\n',charsets:{cjk:!0},lastUpdated:"2023/01/15, 20:17:10",lastUpdatedTimestamp:167378503e4},{title:"æå¨å®ç°dockerå®¹å¨bridgeç½ç»æ¨¡å",frontmatter:{title:"æå¨å®ç°dockerå®¹å¨bridgeç½ç»æ¨¡å",date:"2023-01-08T10:52:18.000Z",permalink:"/pages/d3768c/",tags:["docker","äºåç","å®¹å¨"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä¸»è¦æ¯éè¿ä½¿ç¨Network Namespaceæ¥æ¨¡å¼dockerçbridgeæ¨¡å¼æ¥æ·±å¥ççè§£å¶åçã",feed:{enable:!0},categories:["äºåç","docker"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/16731830378711673183036984.png"},{name:"twitter:title",content:"æå¨å®ç°dockerå®¹å¨bridgeç½ç»æ¨¡å"},{name:"twitter:description",content:"æ¬æä¸»è¦æ¯éè¿ä½¿ç¨Network Namespaceæ¥æ¨¡å¼dockerçbridgeæ¨¡å¼æ¥æ·±å¥ççè§£å¶åçã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/16731830378711673183036984.png"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/06.docker/03.%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0docker%E5%AE%B9%E5%99%A8bridge%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B.html"},{property:"og:type",content:"article"},{property:"og:title",content:"æå¨å®ç°dockerå®¹å¨bridgeç½ç»æ¨¡å"},{property:"og:description",content:"æ¬æä¸»è¦æ¯éè¿ä½¿ç¨Network Namespaceæ¥æ¨¡å¼dockerçbridgeæ¨¡å¼æ¥æ·±å¥ççè§£å¶åçã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/16731830378711673183036984.png"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/06.docker/03.%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0docker%E5%AE%B9%E5%99%A8bridge%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-01-08T10:52:18.000Z"},{property:"article:tag",content:"docker"},{property:"article:tag",content:"äºåç"},{property:"article:tag",content:"å®¹å¨"},{itemprop:"name",content:"æå¨å®ç°dockerå®¹å¨bridgeç½ç»æ¨¡å"},{itemprop:"description",content:"æ¬æä¸»è¦æ¯éè¿ä½¿ç¨Network Namespaceæ¥æ¨¡å¼dockerçbridgeæ¨¡å¼æ¥æ·±å¥ççè§£å¶åçã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/16731830378711673183036984.png"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/06.docker/03.%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0docker%E5%AE%B9%E5%99%A8bridge%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B.html",relativePath:"01.äºåç/06.docker/03.æå¨å®ç°dockerå®¹å¨bridgeç½ç»æ¨¡å.md",key:"v-1a0f65c8",path:"/pages/d3768c/",headers:[{level:2,title:"Network Namespace",slug:"network-namespace",normalizedTitle:"network namespace",charIndex:2},{level:2,title:"å®¹å¨é´ç½ç»äºé",slug:"å®¹å¨é´ç½ç»äºé",normalizedTitle:"å®¹å¨é´ç½ç»äºé",charIndex:202},{level:3,title:"veth pair",slug:"veth-pair",normalizedTitle:"veth pair",charIndex:491},{level:3,title:"å®è·µ",slug:"å®è·µ",normalizedTitle:"å®è·µ",charIndex:635},{level:3,title:"æµè¯",slug:"æµè¯",normalizedTitle:"æµè¯",charIndex:3971},{level:2,title:"å®¿ä¸»æºè®¿é®å®¹å¨",slug:"å®¿ä¸»æºè®¿é®å®¹å¨",normalizedTitle:"å®¿ä¸»æºè®¿é®å®¹å¨",charIndex:6151},{level:2,title:"å®¹å¨åè®¿é®å¤é¨",slug:"å®¹å¨åè®¿é®å¤é¨",normalizedTitle:"å®¹å¨åè®¿é®å¤é¨",charIndex:7551},{level:2,title:"å¤é¨è®¿é®å®¹å¨æ´é²çæå¡",slug:"å¤é¨è®¿é®å®¹å¨æ´é²çæå¡",normalizedTitle:"å¤é¨è®¿é®å®¹å¨æ´é²çæå¡",charIndex:10201}],headersStr:"Network Namespace å®¹å¨é´ç½ç»äºé veth pair å®è·µ æµè¯ å®¿ä¸»æºè®¿é®å®¹å¨ å®¹å¨åè®¿é®å¤é¨ å¤é¨è®¿é®å®¹å¨æ´é²çæå¡",content:"# Network Namespace\n\nNamespace ææ¯æ¯å®¹å¨èæåçéè¦ææ¯ï¼å¯ä»¥å°è¿ç¨éç¦»å¨èªå·±ç Namespace ä¸­ãè Network Namespace ææ¯æ¯å°è¿ç¨éç¦»å¨èªå·±çç½ç»ç©ºé´ä¸­ï¼æ¥æç¬ç«çç½ç»æ ï¼ä»¿ä½èªå·±å¤äºç¬ç«çç½ç»ä¸­ã\n\n> ç½ç»æ æ¯æç½å¡ãåç¯è®¾å¤ãè·¯ç±è¡¨å iptables è§åç­ç­ãç½ç»æ æ¯æç½å¡ãåç¯è®¾å¤ãè·¯ç±è¡¨å iptables è§åç­ç­ã\n\n\n# å®¹å¨é´ç½ç»äºé\n\nå®¹å¨ç bridge ç½ç»æ¨¡å¼ä¼åå»ºå±äºèªå·±ç Network Namespace æ¥éç¦»èªå·±ä¸å®¿ä¸»æºï¼æ¥æå±äºèªå·±çç½ç»æ ãå¯ä»¥çè§£ä¸ºä¸åç Network Namespace æ¯ä¸åçä¸»æºï¼é£ä¹å®ä»¬æ³è¦ç½ç»éä¿¡ï¼è¯¥å¦ä½å®ç°ï¼\n\né¦åæ³å°çå½ç¶æ¯äº¤æ¢æºåè·¯ç±å¨äºï¼å ä¸ºå®ä»¬æ¯å¤äºåä¸ä¸ªç½ç»ä¸­ï¼æä»¥ä½¿ç¨äº¤æ¢æºå³å¯ï¼è Linux æä¾äº bridge æ¥åå½èæäº¤æ¢æºçè§è²ï¼å°å¤ä¸ª Network Namespace æ¥å¥å° bridge ä¸­ï¼å®ä»¬å°±è½ç½ç»äºéäºã\n\né£ä¹å¦ä½å°å®¹å¨ç Network Namespace æ¥å¥å° bridge å¢ï¼\n\n\n# veth pair\n\nveth pair æ¯æå¯¹åºç°çèæç½å¡ï¼å¯ä»¥æå®çåæä¸ä¸ªç®¡éï¼æèä¸æ ¹ç½çº¿ï¼ä»ä¸æ®µè¾å¥çæ°æ®åä¼ä»å¦ä¸ç«¯è¾åºï¼å¯ä»¥éè¿å®æ¥è¿æ¥å®¹å¨ç Network Namespace å bridgeã\n\nä½¿ç¨ veth pair + bridge çç½ç»æ¨¡åå¦ä¸ï¼\n\n\n# å®è·µ\n\næä»¬ä¸ç¨å®è£ dockerï¼ç´æ¥ç¨ Network Namespace æ¥æ¨¡æå®¹å¨çç½ç»ç¯å¢ã\n\n 1. åå»º bridge è®¾å¤\n\nè¿éä½¿ç¨ ip å½ä»¤æ¥å¯¹ bridge è¿è¡æä½ï¼ä¹å¯ä»¥ä½¿ç¨ brctl å½ä»¤ï¼è¯¥å½ä»¤æ¯å¨ bridge-utils åä¸­ã\n\n[root@localhost ~]# ip link add br0 type bridge\n[root@localhost ~]# ip link set dev br0 up\n[root@localhost ~]# ip addr add 10.0.0.3/24 dev br0\n\n[root@localhost ~]# ip link\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n2: ens18: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000\n    link/ether fe:fc:fe:af:4b:ea brd ff:ff:ff:ff:ff:ff\n60: br0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 7e:b5:12:2d:fd:d4 brd ff:ff:ff:ff:ff:ff\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n 2. åå»º 3 ä¸ª Network Namespace\n\nä½¿ç¨ ip netns å½ä»¤å¯ä»¥å¯¹ Network Namesapce è¿è¡æä½ï¼æä»¥ä½¿ç¨è¯¥å½ä»¤åå»º net0ãnet1 ä¸¤ä¸ª Network Namespace\n\n[root@localhost ~]# ip netns add net0\n[root@localhost ~]# ip netns add net1\n\n\n1\n2\n\n 3. åå»ºä¸¤å¯¹ veth pair\n\né¦ååå»ºä¸¤å¯¹ veth pair èæç½å¡ï¼å®ä»¬æ¯ä¸ä¸å¯¹åºçï¼veth0 å veth1ï¼veth2 å veth3\n\n[root@localhost ~]# ip link add veth0 type veth peer name veth1\n[root@localhost ~]# ip link add veth2 type veth peer name veth3\n\n\n1\n2\n\n\næ¥çåå»ºåºæ¥ç 4 ä¸ªèæç½å¡ï¼@åé¢çæ¯è¯¥ç½å¡çåç§°ï¼åé¢çæ¯è¯¥ç½å¡çå¦ä¸ç«¯ã\n\n[root@localhost ~]# ip a\n...\n67: veth1@veth0: <BROADCAST,MULTICAST,M-DOWN> mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether 7e:b5:12:2d:fd:d4 brd ff:ff:ff:ff:ff:ff\n68: veth0@veth1: <BROADCAST,MULTICAST,M-DOWN> mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether 26:22:ef:1a:b3:33 brd ff:ff:ff:ff:ff:ff\n69: veth3@veth2: <BROADCAST,MULTICAST,M-DOWN> mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether c6:f2:d1:2d:c7:95 brd ff:ff:ff:ff:ff:ff\n70: veth2@veth3: <BROADCAST,MULTICAST,M-DOWN> mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether ee:4b:0d:17:60:b1 brd ff:ff:ff:ff:ff:ff\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n 4. å° veth pair çä¸ç«¯æ¥å¥å° Network Namespace ä¸­ï¼å¹¶è®¾ç½®å¥½å¶ IP å°å\n\n[root@localhost ~]# ip link set dev veth0 netns net0\n[root@localhost ~]# ip netns exec net0 ip addr add 10.0.0.1/24 dev veth0\n[root@localhost ~]# ip netns exec net0 ip link set dev veth0 up\n\n\n[root@localhost ~]# ip link set dev veth2 netns net1\n[root@localhost ~]# ip netns exec net1 ip addr add 10.0.0.2/24 dev veth2\n[root@localhost ~]# ip netns exec net1 ip link set dev veth2 up\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n> ip netns exec å½ä»¤å¯ä»¥è¿å¥å°æå®ç Network Namespace ä¸­æ§è¡å½ä»¤\n\n 5. å° veth pair çå¦ä¸ç«¯è®¾ç½®å° bridge ä¸­\n\n[root@localhost ~]# ip link set dev veth1 master br0\n[root@localhost ~]# ip link set dev veth3 master br0\n\n[root@localhost ~]# ip link set dev veth1 up\n[root@localhost ~]# ip link set dev veth3 up\n\n\n1\n2\n3\n4\n5\n\n\nå¯ä»¥éè¿å½ä»¤ bridge link æ¥çå° veth1ãveth3é½æå¥å° br0 ä¸­äºã\n\n[root@localhost ~]# bridge link\n67: veth1 state UP @(null): <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 master br0 state forwarding priority 32 cost 2 \n69: veth3 state UP @(null): <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 master br0 state forwarding priority 32 cost 2\n\n\n1\n2\n3\n\n\nä¹å¯ä»¥éè¿ brctl å½ä»¤æ¥ç\n\n[root@localhost ~]# brctl show\n[root@localhost ~]# brctl show\nbridge name     bridge id               STP enabled     interfaces\nbr0             8000.7eb5122dfdd4       no              veth1\n                                                        veth3\n\n\n1\n2\n3\n4\n5\n\n\n\n# æµè¯\n\n 1. é¦åçå¬ br0 ç½å¡\n\n[root@localhost ~]# tcpdump -i br0\n\n\n1\n\n 2. å¨ net0 ä¸­ ping net1 ç ip\n\nip netns exec net0 ping -c 3 10.0.0.2\n\n\n1\n\n 3. ä¼åç°çå¬ br0 ç½å¡æ¯ææµéçï¼\n\n[root@localhost ~]# tcpdump -i br0\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on br0, link-type EN10MB (Ethernet), capture size 262144 bytes\n02:39:41.251428 ARP, Request who-has 10.0.0.2 tell 10.0.0.1, length 28\n02:39:41.251495 ARP, Reply 10.0.0.2 is-at ee:4b:0d:17:60:b1 (oui Unknown), length 28\n02:39:41.251502 IP 10.0.0.1 > 10.0.0.2: ICMP echo request, id 15665, seq 1, length 64\n02:39:41.251702 IP 10.0.0.2 > 10.0.0.1: ICMP echo reply, id 15665, seq 1, length 64\n02:39:42.251435 IP 10.0.0.1 > 10.0.0.2: ICMP echo request, id 15665, seq 2, length 64\n02:39:42.251554 IP 10.0.0.2 > 10.0.0.1: ICMP echo reply, id 15665, seq 2, length 64\n02:39:43.251414 IP 10.0.0.1 > 10.0.0.2: ICMP echo request, id 15665, seq 3, length 64\n02:39:43.251512 IP 10.0.0.2 > 10.0.0.1: ICMP echo reply, id 15665, seq 3, length 64\n02:39:46.261377 ARP, Request who-has 10.0.0.1 tell 10.0.0.2, length 28\n02:39:46.261400 ARP, Reply 10.0.0.1 is-at 26:22:ef:1a:b3:33 (oui Unknown), length 28\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nå¯ä»¥çå°åæ¯ 10.0.0.1 åéç ARP è·å 10.0.0.2 ç MAC å°åï¼ç¶åååé ICMP çè¯·æ±åååºï¼æå 10.0.0.2 ä¹åé ARP è·å 10.0.0.1 ç MAC å°åã\n\nå ä¸º bridge æ¯äºå±ç½ç»è®¾å¤ï¼æä»¥å®æ¯éè¦éè¿è¯å« MAC å°åæ¥è¿è¡éä¿¡çå±åç½ã\n\nåé¢æåéè¿ net0 ping net1 ç ipï¼åç°å®æ²¡æåé ARP äºï¼è¿ä¸ªæ¯å ä¸ºç¬¬ä¸æ¬¡ bridge å·²ç»å° MAC å°ååç«¯å£çæ å°å³ç³»å·²ç»è®°å½äºä¸æ¥ï¼åé¢å¯ä»¥ç´æ¥éè¿æ¥è¡¨ï¼èä¸ç¨ååé ARP äºã\n\n[root@localhost ~]# tcpdump -i br0 -n \ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on br0, link-type EN10MB (Ethernet), capture size 262144 bytes\n02:40:01.267689 IP 10.0.0.1 > 10.0.0.2: ICMP echo request, id 15991, seq 1, length 64\n02:40:01.267948 IP 10.0.0.2 > 10.0.0.1: ICMP echo reply, id 15991, seq 1, length 64\n02:40:02.267509 IP 10.0.0.1 > 10.0.0.2: ICMP echo request, id 15991, seq 2, length 64\n02:40:02.267641 IP 10.0.0.2 > 10.0.0.1: ICMP echo reply, id 15991, seq 2, length 64\n02:40:03.267458 IP 10.0.0.1 > 10.0.0.2: ICMP echo request, id 15991, seq 3, length 64\n02:40:03.267582 IP 10.0.0.2 > 10.0.0.1: ICMP echo reply, id 15991, seq 3, length 64\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# å®¿ä¸»æºè®¿é®å®¹å¨\n\n 1. åæ¬¡çå¬ br0 ç½å¡\n\ntcpdump -i br0\n\n\n1\n\n 2. å¨å®¿ä¸»æºä¸ ping å®¹å¨åé¨ ipï¼æ¯å¯ä»¥ ping éç\n\nping 10.0.0.1 -n 3\n\n\n1\n\n 3. æ¥ççå¬ç br0 ç½å¡æµéï¼\n\n[root@localhost ~]# tcpdump -i br0 -n \ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on br0, link-type EN10MB (Ethernet), capture size 262144 bytes\n02:56:03.232293 ARP, Request who-has 10.0.0.1 tell 10.0.0.3, length 28\n02:56:03.232342 ARP, Reply 10.0.0.1 is-at 26:22:ef:1a:b3:33, length 28\n02:56:03.232379 IP 10.0.0.3 > 10.0.0.1: ICMP echo request, id 3964, seq 1, length 64\n02:56:03.232402 IP 10.0.0.1 > 10.0.0.3: ICMP echo reply, id 3964, seq 1, length 64\n02:56:04.232494 IP 10.0.0.3 > 10.0.0.1: ICMP echo request, id 3964, seq 2, length 64\n02:56:04.232554 IP 10.0.0.1 > 10.0.0.3: ICMP echo reply, id 3964, seq 2, length 64\n02:56:05.232517 IP 10.0.0.3 > 10.0.0.1: ICMP echo request, id 3964, seq 3, length 64\n02:56:05.232607 IP 10.0.0.1 > 10.0.0.3: ICMP echo reply, id 3964, seq 3, length 64\n02:56:08.245354 ARP, Request who-has 10.0.0.3 tell 10.0.0.1, length 28\n02:56:08.245412 ARP, Reply 10.0.0.3 is-at 7e:b5:12:2d:fd:d4, length 28\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nå¯ä»¥çå°æ¯ 10.0.0.3 è®¿é®éäº 10.0.0.1 ï¼æä»¬æ¯éè¿å®¿ä¸»æºè®¿é®çå®¹å¨åé¨ï¼ä¸ºä»ä¹æº ip åæ 10.0.0.3ï¼\n\n 4. éè¿æ¥çå®¿ä¸»æºçè·¯ç±è¡¨ï¼å¯ä»¥çå°å½æä»¬ ping 10.0.0.1 æ¶ï¼æ¯å¹éä¸äºè¯¥æ¡è·¯ç±ï¼ç¶åèµ° br0 ç½å¡ï¼ä½¿ç¨çæº ip æ¯ br0 ç ip 10.0.0.3\n\n[root@localhost ~]# ip r\n...\n10.0.0.0/24 dev br0 proto kernel scope link src 10.0.0.3 \n...\n\n\n1\n2\n3\n4\n\n\n\n# å®¹å¨åè®¿é®å¤é¨\n\n 1. éç½® Network Namespace ä¸­å° bridge ä½ä¸ºé»è®¤ç½å³\n\nå½æä»¬å¨ net0 åé¨è®¿é®å¤é¨ ip æ¶ï¼ä¼åç°ç½ç»ä¸å¯è¾¾ã\n\n[root@localhost ~]# ip netns exec net0 ping 10.65.132.187\nconnect: Network is unreachable\n\n\n1\n2\n\n\nè¿ä¸ªæ¯å ä¸ºæ²¡æå¹éä¸è·¯ç±è¡¨ä¸çåå \n\n[root@localhost ~]# ip netns exec net0 ip r\n10.0.0.0/24 dev veth0 proto kernel scope link src 10.0.0.1\n\n\n1\n2\n\n\næä»¬å ä¸é»è®¤ç½å³ï¼ä¹å°±æ¯å¨æ²¡æå¹éä¸å¶ä»è·¯ç±æ¶ï¼èµ°è¯¥ç½å³\n\n[root@localhost ~]# ip netns exec net0 ip r add default via 10.0.0.3 dev veth0\n\n[root@localhost ~]# ip netns exec net0 ip r \ndefault via 10.0.0.3 dev veth0 \n10.0.0.0/24 dev veth0 proto kernel scope link src 10.0.0.1 \n\n\n1\n2\n3\n4\n5\n\n 2. éç½®å®¿ä¸»æº iptables ç SNAT è§å\n\næä»¬åæ¬¡å¨å®¹å¨ä¸­è®¿é®å¤é¨ ip æ¶ï¼åç°ç½ç»è¿ä¸å¯è¾¾ï¼ä½æ¯æä»¬çå¬ br0 ç½å¡åç°æ¯ææ°æ®åçï¼ä¹å°±æ¯è·¯ç±éçæ²¡é®é¢\n\n[root@localhost ~]# tcpdump -i br0\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on br0, link-type EN10MB (Ethernet), capture size 262144 bytes\n03:23:23.738010 IP 10.0.0.1 > 10.65.132.187: ICMP echo request, id 11228, seq 1, length 64\n03:23:24.737415 IP 10.0.0.1 > 10.65.132.187: ICMP echo request, id 11228, seq 2, length 64\n\n\n1\n2\n3\n4\n5\n\n\næä»¬åçå®¿ä¸»æºä¸çè·¯ç±ï¼æ¯æéç½®é»è®¤è·¯ç±çã\n\n[root@localhost ~]# ip r\ndefault via 10.61.74.1 dev ens18 proto static metric 100\n\n\n1\n2\n\n\næä»¥æåçå¬ä¸ä¸å®¿ä¸»æºçç½å¡ ens18 ççï¼\n\n[root@localhost ~]# tcpdump -i ens18 dst host 10.65.132.187\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on ens18, link-type EN10MB (Ethernet), capture size 262144 bytes\n03:24:47.162152 IP 10.0.0.1 > 10.65.132.187: ICMP echo request, id 13281, seq 1, length 64\n03:24:48.161585 IP 10.0.0.1 > 10.65.132.187: ICMP echo request, id 13281, seq 2, length 64\n\n\n1\n2\n3\n4\n5\n\n\nåç°ä¹æ¯ææ°æ®åçï¼ä½æ¯åå°åæ¯ net0 ç ip å°å 10.0.0.1ï¼å¤é¨æ¯ä¸è®¤è¯çï¼æä»¥éè¦éç½® iptablesï¼å°æº IP æ¹ä¸ºå®¿ä¸»æºç IPã\n\n# åå»ºè§å\n[root@localhost ~]# iptables -t nat -A POSTROUTING -s 10.0.0.0/24 ! -o br0 -j MASQUERADE\n\n# æ¥çè§å\n[root@localhost ~]# iptables -L POSTROUTING -t nat\n...\nMASQUERADE  all  --  10.0.0.0/24          anywhere\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä¸é¢è®¾ç½® ipatbels çå½ä»¤çå«ä¹æ¯ï¼å¨ POSTROUTING é¾ç nat è¡¨ä¸­æ·»å ä¸æ¡è§åï¼å½æ°æ®åçæº IP ç½æ®µä¸º 10.0.0.0/24 æ¶ï¼å¹¶ä¸ä¸æ¯ç½å¡ br0 åéçï¼å°±æ§è¡ MASQUERADE å¨ä½ï¼è¯¥å¨ä½å°±æ¯æºå°åæ¹ä¸ºå®¿ä¸»æºå°åçè½¬æ¢å¨ä½ã\n\nç°å¨å°±å¯ä»¥ ping éå¤é¨ IP äºï¼æ¥ç ens18 ç½å¡çæ°æ®åï¼æºå°åå·²ç»ä¿®æ¹æå®¿ä¸»æºç½å¡ ens18 çå°åäºã\n\n[root@localhost ~]# tcpdump -i ens18 dst host 10.65.132.187 -n \ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on ens18, link-type EN10MB (Ethernet), capture size 262144 bytes\n03:41:51.157483 IP 10.61.74.37 > 10.65.132.187: ICMP echo request, id 3972, seq 1, length 64\n03:41:52.158483 IP 10.61.74.37 > 10.65.132.187: ICMP echo request, id 3972, seq 2, length 64\n\n\n1\n2\n3\n4\n5\n\n\né£å¤é¨ IP ååæ¶ï¼åªæå®¿ä¸»æºç IPï¼å¹¶æ²¡æå®¹å¨ç IPï¼é£å®¿ä¸»æºæä¹ç¥éåéå®¹å¨ä¸­å¢ï¼\n\nè¿ä¸ªæ¯å ä¸ºåæ ¸ netfilter ä¼è¿½è¸ªè®°å½è¿æ¥ï¼æä»¬å¨å¢å äº SNAT è§åæ¶ï¼ç³»ç»ä¼èªå¨å¢å ä¸ä¸ªéå¼çååè§åï¼è¿æ ·è¿åçåä¼èªå¨å°å®¿ä¸»æºç IP æ¿æ¢ä¸ºå®¹å¨ IPã\n\n\n# å¤é¨è®¿é®å®¹å¨æ´é²çæå¡\n\ndocker å®¹å¨å¯ä»¥éè¿-p çæ¹å¼å°å®¹å¨åé¨çç«¯å£æ´é²å°å®¿ä¸»æºä¸­ï¼ç»å¤é¨è®¿é®ï¼è¿ä¸ªæ¯æä¹å®ç°çå¢ï¼\n\n 1. è¿ä¸ªæ¯éè¿ iptables ç DNAT è§åå®ç°ç\n\n# åå»ºè§å\n[root@localhost ~]# iptables -t nat -A PREROUTING  ! -i br0 -p tcp -m tcp --dport 80 -j DNAT --to-destination 10.0.0.1:80\n\n# æ¥çè§å\n[root@localhost ~]# iptables -L PREROUTING -t nat\nDNAT       tcp  --  anywhere             anywhere             tcp dpt:http to:10.0.0.1:80\n\n\n1\n2\n3\n4\n5\n6\n\n\nåå»ºè§åçå½ä»¤çæææ¯ï¼å¨ PREROUTING é¾ç nat è¡¨ä¸­æ·»å ä¸æ¡è§åï¼æ°æ®åçæ¥æºç½å¡ä¸æ¯ br0ï¼æ°æ®ååè®®æ¯ tcpï¼ç®çç«¯å£æ¯ 80ï¼åè¿è¡ DNATï¼å°ç®ç IP ä»å®¿ä¸»æº IP æ¹ä¸ºå®¹å¨ IPã\n\n 2. å¨ net0 ä¸­å¼å¯ 80 ç«¯å£\n\n[root@localhost ~]# nc -lp 80\n\n\n1\n\n 3. å¨å¤é¨ä¸»æºä¸è®¿é®å®¿ä¸»æºç 80 ç«¯å£ï¼æ¯å¯ä»¥è®¿é®æåç\n\n[root@k8s-master-07rf9 ~]# telnet 10.61.74.37 80\n\n\n1\n",normalizedContent:"# network namespace\n\nnamespace ææ¯æ¯å®¹å¨èæåçéè¦ææ¯ï¼å¯ä»¥å°è¿ç¨éç¦»å¨èªå·±ç namespace ä¸­ãè network namespace ææ¯æ¯å°è¿ç¨éç¦»å¨èªå·±çç½ç»ç©ºé´ä¸­ï¼æ¥æç¬ç«çç½ç»æ ï¼ä»¿ä½èªå·±å¤äºç¬ç«çç½ç»ä¸­ã\n\n> ç½ç»æ æ¯æç½å¡ãåç¯è®¾å¤ãè·¯ç±è¡¨å iptables è§åç­ç­ãç½ç»æ æ¯æç½å¡ãåç¯è®¾å¤ãè·¯ç±è¡¨å iptables è§åç­ç­ã\n\n\n# å®¹å¨é´ç½ç»äºé\n\nå®¹å¨ç bridge ç½ç»æ¨¡å¼ä¼åå»ºå±äºèªå·±ç network namespace æ¥éç¦»èªå·±ä¸å®¿ä¸»æºï¼æ¥æå±äºèªå·±çç½ç»æ ãå¯ä»¥çè§£ä¸ºä¸åç network namespace æ¯ä¸åçä¸»æºï¼é£ä¹å®ä»¬æ³è¦ç½ç»éä¿¡ï¼è¯¥å¦ä½å®ç°ï¼\n\né¦åæ³å°çå½ç¶æ¯äº¤æ¢æºåè·¯ç±å¨äºï¼å ä¸ºå®ä»¬æ¯å¤äºåä¸ä¸ªç½ç»ä¸­ï¼æä»¥ä½¿ç¨äº¤æ¢æºå³å¯ï¼è linux æä¾äº bridge æ¥åå½èæäº¤æ¢æºçè§è²ï¼å°å¤ä¸ª network namespace æ¥å¥å° bridge ä¸­ï¼å®ä»¬å°±è½ç½ç»äºéäºã\n\né£ä¹å¦ä½å°å®¹å¨ç network namespace æ¥å¥å° bridge å¢ï¼\n\n\n# veth pair\n\nveth pair æ¯æå¯¹åºç°çèæç½å¡ï¼å¯ä»¥æå®çåæä¸ä¸ªç®¡éï¼æèä¸æ ¹ç½çº¿ï¼ä»ä¸æ®µè¾å¥çæ°æ®åä¼ä»å¦ä¸ç«¯è¾åºï¼å¯ä»¥éè¿å®æ¥è¿æ¥å®¹å¨ç network namespace å bridgeã\n\nä½¿ç¨ veth pair + bridge çç½ç»æ¨¡åå¦ä¸ï¼\n\n\n# å®è·µ\n\næä»¬ä¸ç¨å®è£ dockerï¼ç´æ¥ç¨ network namespace æ¥æ¨¡æå®¹å¨çç½ç»ç¯å¢ã\n\n 1. åå»º bridge è®¾å¤\n\nè¿éä½¿ç¨ ip å½ä»¤æ¥å¯¹ bridge è¿è¡æä½ï¼ä¹å¯ä»¥ä½¿ç¨ brctl å½ä»¤ï¼è¯¥å½ä»¤æ¯å¨ bridge-utils åä¸­ã\n\n[root@localhost ~]# ip link add br0 type bridge\n[root@localhost ~]# ip link set dev br0 up\n[root@localhost ~]# ip addr add 10.0.0.3/24 dev br0\n\n[root@localhost ~]# ip link\n1: lo: <loopback,up,lower_up> mtu 65536 qdisc noqueue state unknown mode default group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n2: ens18: <broadcast,multicast,up,lower_up> mtu 1500 qdisc pfifo_fast state up mode default group default qlen 1000\n    link/ether fe:fc:fe:af:4b:ea brd ff:ff:ff:ff:ff:ff\n60: br0: <broadcast,multicast,up,lower_up> mtu 1500 qdisc noqueue state up mode default group default qlen 1000\n    link/ether 7e:b5:12:2d:fd:d4 brd ff:ff:ff:ff:ff:ff\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n 2. åå»º 3 ä¸ª network namespace\n\nä½¿ç¨ ip netns å½ä»¤å¯ä»¥å¯¹ network namesapce è¿è¡æä½ï¼æä»¥ä½¿ç¨è¯¥å½ä»¤åå»º net0ãnet1 ä¸¤ä¸ª network namespace\n\n[root@localhost ~]# ip netns add net0\n[root@localhost ~]# ip netns add net1\n\n\n1\n2\n\n 3. åå»ºä¸¤å¯¹ veth pair\n\né¦ååå»ºä¸¤å¯¹ veth pair èæç½å¡ï¼å®ä»¬æ¯ä¸ä¸å¯¹åºçï¼veth0 å veth1ï¼veth2 å veth3\n\n[root@localhost ~]# ip link add veth0 type veth peer name veth1\n[root@localhost ~]# ip link add veth2 type veth peer name veth3\n\n\n1\n2\n\n\næ¥çåå»ºåºæ¥ç 4 ä¸ªèæç½å¡ï¼@åé¢çæ¯è¯¥ç½å¡çåç§°ï¼åé¢çæ¯è¯¥ç½å¡çå¦ä¸ç«¯ã\n\n[root@localhost ~]# ip a\n...\n67: veth1@veth0: <broadcast,multicast,m-down> mtu 1500 qdisc noop state down group default qlen 1000\n    link/ether 7e:b5:12:2d:fd:d4 brd ff:ff:ff:ff:ff:ff\n68: veth0@veth1: <broadcast,multicast,m-down> mtu 1500 qdisc noop state down group default qlen 1000\n    link/ether 26:22:ef:1a:b3:33 brd ff:ff:ff:ff:ff:ff\n69: veth3@veth2: <broadcast,multicast,m-down> mtu 1500 qdisc noop state down group default qlen 1000\n    link/ether c6:f2:d1:2d:c7:95 brd ff:ff:ff:ff:ff:ff\n70: veth2@veth3: <broadcast,multicast,m-down> mtu 1500 qdisc noop state down group default qlen 1000\n    link/ether ee:4b:0d:17:60:b1 brd ff:ff:ff:ff:ff:ff\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n 4. å° veth pair çä¸ç«¯æ¥å¥å° network namespace ä¸­ï¼å¹¶è®¾ç½®å¥½å¶ ip å°å\n\n[root@localhost ~]# ip link set dev veth0 netns net0\n[root@localhost ~]# ip netns exec net0 ip addr add 10.0.0.1/24 dev veth0\n[root@localhost ~]# ip netns exec net0 ip link set dev veth0 up\n\n\n[root@localhost ~]# ip link set dev veth2 netns net1\n[root@localhost ~]# ip netns exec net1 ip addr add 10.0.0.2/24 dev veth2\n[root@localhost ~]# ip netns exec net1 ip link set dev veth2 up\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n> ip netns exec å½ä»¤å¯ä»¥è¿å¥å°æå®ç network namespace ä¸­æ§è¡å½ä»¤\n\n 5. å° veth pair çå¦ä¸ç«¯è®¾ç½®å° bridge ä¸­\n\n[root@localhost ~]# ip link set dev veth1 master br0\n[root@localhost ~]# ip link set dev veth3 master br0\n\n[root@localhost ~]# ip link set dev veth1 up\n[root@localhost ~]# ip link set dev veth3 up\n\n\n1\n2\n3\n4\n5\n\n\nå¯ä»¥éè¿å½ä»¤ bridge link æ¥çå° veth1ãveth3é½æå¥å° br0 ä¸­äºã\n\n[root@localhost ~]# bridge link\n67: veth1 state up @(null): <broadcast,multicast,up,lower_up> mtu 1500 master br0 state forwarding priority 32 cost 2 \n69: veth3 state up @(null): <broadcast,multicast,up,lower_up> mtu 1500 master br0 state forwarding priority 32 cost 2\n\n\n1\n2\n3\n\n\nä¹å¯ä»¥éè¿ brctl å½ä»¤æ¥ç\n\n[root@localhost ~]# brctl show\n[root@localhost ~]# brctl show\nbridge name     bridge id               stp enabled     interfaces\nbr0             8000.7eb5122dfdd4       no              veth1\n                                                        veth3\n\n\n1\n2\n3\n4\n5\n\n\n\n# æµè¯\n\n 1. é¦åçå¬ br0 ç½å¡\n\n[root@localhost ~]# tcpdump -i br0\n\n\n1\n\n 2. å¨ net0 ä¸­ ping net1 ç ip\n\nip netns exec net0 ping -c 3 10.0.0.2\n\n\n1\n\n 3. ä¼åç°çå¬ br0 ç½å¡æ¯ææµéçï¼\n\n[root@localhost ~]# tcpdump -i br0\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on br0, link-type en10mb (ethernet), capture size 262144 bytes\n02:39:41.251428 arp, request who-has 10.0.0.2 tell 10.0.0.1, length 28\n02:39:41.251495 arp, reply 10.0.0.2 is-at ee:4b:0d:17:60:b1 (oui unknown), length 28\n02:39:41.251502 ip 10.0.0.1 > 10.0.0.2: icmp echo request, id 15665, seq 1, length 64\n02:39:41.251702 ip 10.0.0.2 > 10.0.0.1: icmp echo reply, id 15665, seq 1, length 64\n02:39:42.251435 ip 10.0.0.1 > 10.0.0.2: icmp echo request, id 15665, seq 2, length 64\n02:39:42.251554 ip 10.0.0.2 > 10.0.0.1: icmp echo reply, id 15665, seq 2, length 64\n02:39:43.251414 ip 10.0.0.1 > 10.0.0.2: icmp echo request, id 15665, seq 3, length 64\n02:39:43.251512 ip 10.0.0.2 > 10.0.0.1: icmp echo reply, id 15665, seq 3, length 64\n02:39:46.261377 arp, request who-has 10.0.0.1 tell 10.0.0.2, length 28\n02:39:46.261400 arp, reply 10.0.0.1 is-at 26:22:ef:1a:b3:33 (oui unknown), length 28\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nå¯ä»¥çå°åæ¯ 10.0.0.1 åéç arp è·å 10.0.0.2 ç mac å°åï¼ç¶åååé icmp çè¯·æ±åååºï¼æå 10.0.0.2 ä¹åé arp è·å 10.0.0.1 ç mac å°åã\n\nå ä¸º bridge æ¯äºå±ç½ç»è®¾å¤ï¼æä»¥å®æ¯éè¦éè¿è¯å« mac å°åæ¥è¿è¡éä¿¡çå±åç½ã\n\nåé¢æåéè¿ net0 ping net1 ç ipï¼åç°å®æ²¡æåé arp äºï¼è¿ä¸ªæ¯å ä¸ºç¬¬ä¸æ¬¡ bridge å·²ç»å° mac å°ååç«¯å£çæ å°å³ç³»å·²ç»è®°å½äºä¸æ¥ï¼åé¢å¯ä»¥ç´æ¥éè¿æ¥è¡¨ï¼èä¸ç¨ååé arp äºã\n\n[root@localhost ~]# tcpdump -i br0 -n \ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on br0, link-type en10mb (ethernet), capture size 262144 bytes\n02:40:01.267689 ip 10.0.0.1 > 10.0.0.2: icmp echo request, id 15991, seq 1, length 64\n02:40:01.267948 ip 10.0.0.2 > 10.0.0.1: icmp echo reply, id 15991, seq 1, length 64\n02:40:02.267509 ip 10.0.0.1 > 10.0.0.2: icmp echo request, id 15991, seq 2, length 64\n02:40:02.267641 ip 10.0.0.2 > 10.0.0.1: icmp echo reply, id 15991, seq 2, length 64\n02:40:03.267458 ip 10.0.0.1 > 10.0.0.2: icmp echo request, id 15991, seq 3, length 64\n02:40:03.267582 ip 10.0.0.2 > 10.0.0.1: icmp echo reply, id 15991, seq 3, length 64\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# å®¿ä¸»æºè®¿é®å®¹å¨\n\n 1. åæ¬¡çå¬ br0 ç½å¡\n\ntcpdump -i br0\n\n\n1\n\n 2. å¨å®¿ä¸»æºä¸ ping å®¹å¨åé¨ ipï¼æ¯å¯ä»¥ ping éç\n\nping 10.0.0.1 -n 3\n\n\n1\n\n 3. æ¥ççå¬ç br0 ç½å¡æµéï¼\n\n[root@localhost ~]# tcpdump -i br0 -n \ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on br0, link-type en10mb (ethernet), capture size 262144 bytes\n02:56:03.232293 arp, request who-has 10.0.0.1 tell 10.0.0.3, length 28\n02:56:03.232342 arp, reply 10.0.0.1 is-at 26:22:ef:1a:b3:33, length 28\n02:56:03.232379 ip 10.0.0.3 > 10.0.0.1: icmp echo request, id 3964, seq 1, length 64\n02:56:03.232402 ip 10.0.0.1 > 10.0.0.3: icmp echo reply, id 3964, seq 1, length 64\n02:56:04.232494 ip 10.0.0.3 > 10.0.0.1: icmp echo request, id 3964, seq 2, length 64\n02:56:04.232554 ip 10.0.0.1 > 10.0.0.3: icmp echo reply, id 3964, seq 2, length 64\n02:56:05.232517 ip 10.0.0.3 > 10.0.0.1: icmp echo request, id 3964, seq 3, length 64\n02:56:05.232607 ip 10.0.0.1 > 10.0.0.3: icmp echo reply, id 3964, seq 3, length 64\n02:56:08.245354 arp, request who-has 10.0.0.3 tell 10.0.0.1, length 28\n02:56:08.245412 arp, reply 10.0.0.3 is-at 7e:b5:12:2d:fd:d4, length 28\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nå¯ä»¥çå°æ¯ 10.0.0.3 è®¿é®éäº 10.0.0.1 ï¼æä»¬æ¯éè¿å®¿ä¸»æºè®¿é®çå®¹å¨åé¨ï¼ä¸ºä»ä¹æº ip åæ 10.0.0.3ï¼\n\n 4. éè¿æ¥çå®¿ä¸»æºçè·¯ç±è¡¨ï¼å¯ä»¥çå°å½æä»¬ ping 10.0.0.1 æ¶ï¼æ¯å¹éä¸äºè¯¥æ¡è·¯ç±ï¼ç¶åèµ° br0 ç½å¡ï¼ä½¿ç¨çæº ip æ¯ br0 ç ip 10.0.0.3\n\n[root@localhost ~]# ip r\n...\n10.0.0.0/24 dev br0 proto kernel scope link src 10.0.0.3 \n...\n\n\n1\n2\n3\n4\n\n\n\n# å®¹å¨åè®¿é®å¤é¨\n\n 1. éç½® network namespace ä¸­å° bridge ä½ä¸ºé»è®¤ç½å³\n\nå½æä»¬å¨ net0 åé¨è®¿é®å¤é¨ ip æ¶ï¼ä¼åç°ç½ç»ä¸å¯è¾¾ã\n\n[root@localhost ~]# ip netns exec net0 ping 10.65.132.187\nconnect: network is unreachable\n\n\n1\n2\n\n\nè¿ä¸ªæ¯å ä¸ºæ²¡æå¹éä¸è·¯ç±è¡¨ä¸çåå \n\n[root@localhost ~]# ip netns exec net0 ip r\n10.0.0.0/24 dev veth0 proto kernel scope link src 10.0.0.1\n\n\n1\n2\n\n\næä»¬å ä¸é»è®¤ç½å³ï¼ä¹å°±æ¯å¨æ²¡æå¹éä¸å¶ä»è·¯ç±æ¶ï¼èµ°è¯¥ç½å³\n\n[root@localhost ~]# ip netns exec net0 ip r add default via 10.0.0.3 dev veth0\n\n[root@localhost ~]# ip netns exec net0 ip r \ndefault via 10.0.0.3 dev veth0 \n10.0.0.0/24 dev veth0 proto kernel scope link src 10.0.0.1 \n\n\n1\n2\n3\n4\n5\n\n 2. éç½®å®¿ä¸»æº iptables ç snat è§å\n\næä»¬åæ¬¡å¨å®¹å¨ä¸­è®¿é®å¤é¨ ip æ¶ï¼åç°ç½ç»è¿ä¸å¯è¾¾ï¼ä½æ¯æä»¬çå¬ br0 ç½å¡åç°æ¯ææ°æ®åçï¼ä¹å°±æ¯è·¯ç±éçæ²¡é®é¢\n\n[root@localhost ~]# tcpdump -i br0\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on br0, link-type en10mb (ethernet), capture size 262144 bytes\n03:23:23.738010 ip 10.0.0.1 > 10.65.132.187: icmp echo request, id 11228, seq 1, length 64\n03:23:24.737415 ip 10.0.0.1 > 10.65.132.187: icmp echo request, id 11228, seq 2, length 64\n\n\n1\n2\n3\n4\n5\n\n\næä»¬åçå®¿ä¸»æºä¸çè·¯ç±ï¼æ¯æéç½®é»è®¤è·¯ç±çã\n\n[root@localhost ~]# ip r\ndefault via 10.61.74.1 dev ens18 proto static metric 100\n\n\n1\n2\n\n\næä»¥æåçå¬ä¸ä¸å®¿ä¸»æºçç½å¡ ens18 ççï¼\n\n[root@localhost ~]# tcpdump -i ens18 dst host 10.65.132.187\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on ens18, link-type en10mb (ethernet), capture size 262144 bytes\n03:24:47.162152 ip 10.0.0.1 > 10.65.132.187: icmp echo request, id 13281, seq 1, length 64\n03:24:48.161585 ip 10.0.0.1 > 10.65.132.187: icmp echo request, id 13281, seq 2, length 64\n\n\n1\n2\n3\n4\n5\n\n\nåç°ä¹æ¯ææ°æ®åçï¼ä½æ¯åå°åæ¯ net0 ç ip å°å 10.0.0.1ï¼å¤é¨æ¯ä¸è®¤è¯çï¼æä»¥éè¦éç½® iptablesï¼å°æº ip æ¹ä¸ºå®¿ä¸»æºç ipã\n\n# åå»ºè§å\n[root@localhost ~]# iptables -t nat -a postrouting -s 10.0.0.0/24 ! -o br0 -j masquerade\n\n# æ¥çè§å\n[root@localhost ~]# iptables -l postrouting -t nat\n...\nmasquerade  all  --  10.0.0.0/24          anywhere\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä¸é¢è®¾ç½® ipatbels çå½ä»¤çå«ä¹æ¯ï¼å¨ postrouting é¾ç nat è¡¨ä¸­æ·»å ä¸æ¡è§åï¼å½æ°æ®åçæº ip ç½æ®µä¸º 10.0.0.0/24 æ¶ï¼å¹¶ä¸ä¸æ¯ç½å¡ br0 åéçï¼å°±æ§è¡ masquerade å¨ä½ï¼è¯¥å¨ä½å°±æ¯æºå°åæ¹ä¸ºå®¿ä¸»æºå°åçè½¬æ¢å¨ä½ã\n\nç°å¨å°±å¯ä»¥ ping éå¤é¨ ip äºï¼æ¥ç ens18 ç½å¡çæ°æ®åï¼æºå°åå·²ç»ä¿®æ¹æå®¿ä¸»æºç½å¡ ens18 çå°åäºã\n\n[root@localhost ~]# tcpdump -i ens18 dst host 10.65.132.187 -n \ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on ens18, link-type en10mb (ethernet), capture size 262144 bytes\n03:41:51.157483 ip 10.61.74.37 > 10.65.132.187: icmp echo request, id 3972, seq 1, length 64\n03:41:52.158483 ip 10.61.74.37 > 10.65.132.187: icmp echo request, id 3972, seq 2, length 64\n\n\n1\n2\n3\n4\n5\n\n\né£å¤é¨ ip ååæ¶ï¼åªæå®¿ä¸»æºç ipï¼å¹¶æ²¡æå®¹å¨ç ipï¼é£å®¿ä¸»æºæä¹ç¥éåéå®¹å¨ä¸­å¢ï¼\n\nè¿ä¸ªæ¯å ä¸ºåæ ¸ netfilter ä¼è¿½è¸ªè®°å½è¿æ¥ï¼æä»¬å¨å¢å äº snat è§åæ¶ï¼ç³»ç»ä¼èªå¨å¢å ä¸ä¸ªéå¼çååè§åï¼è¿æ ·è¿åçåä¼èªå¨å°å®¿ä¸»æºç ip æ¿æ¢ä¸ºå®¹å¨ ipã\n\n\n# å¤é¨è®¿é®å®¹å¨æ´é²çæå¡\n\ndocker å®¹å¨å¯ä»¥éè¿-p çæ¹å¼å°å®¹å¨åé¨çç«¯å£æ´é²å°å®¿ä¸»æºä¸­ï¼ç»å¤é¨è®¿é®ï¼è¿ä¸ªæ¯æä¹å®ç°çå¢ï¼\n\n 1. è¿ä¸ªæ¯éè¿ iptables ç dnat è§åå®ç°ç\n\n# åå»ºè§å\n[root@localhost ~]# iptables -t nat -a prerouting  ! -i br0 -p tcp -m tcp --dport 80 -j dnat --to-destination 10.0.0.1:80\n\n# æ¥çè§å\n[root@localhost ~]# iptables -l prerouting -t nat\ndnat       tcp  --  anywhere             anywhere             tcp dpt:http to:10.0.0.1:80\n\n\n1\n2\n3\n4\n5\n6\n\n\nåå»ºè§åçå½ä»¤çæææ¯ï¼å¨ prerouting é¾ç nat è¡¨ä¸­æ·»å ä¸æ¡è§åï¼æ°æ®åçæ¥æºç½å¡ä¸æ¯ br0ï¼æ°æ®ååè®®æ¯ tcpï¼ç®çç«¯å£æ¯ 80ï¼åè¿è¡ dnatï¼å°ç®ç ip ä»å®¿ä¸»æº ip æ¹ä¸ºå®¹å¨ ipã\n\n 2. å¨ net0 ä¸­å¼å¯ 80 ç«¯å£\n\n[root@localhost ~]# nc -lp 80\n\n\n1\n\n 3. å¨å¤é¨ä¸»æºä¸è®¿é®å®¿ä¸»æºç 80 ç«¯å£ï¼æ¯å¯ä»¥è®¿é®æåç\n\n[root@k8s-master-07rf9 ~]# telnet 10.61.74.37 80\n\n\n1\n",charsets:{cjk:!0},lastUpdated:"2023/01/15, 20:17:10",lastUpdatedTimestamp:167378503e4},{title:"k8sä¹DaemonSet",frontmatter:{tags:["k8s","å®¹å¨","äºåç"],title:"k8sä¹DaemonSet",date:"2022-08-31T11:06:48.000Z",permalink:"/pages/92bee4/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä»ç»k8sä¸­çdaemonsetèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾",feed:{enable:!0},categories:["äºåç","k8s"],comment:!0,meta:[{name:"twitter:title",content:"k8sä¹DaemonSet"},{name:"twitter:description",content:"ä»ç»k8sä¸­çdaemonsetèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/08.k8s%E4%B9%8BDaemonSet.html"},{property:"og:type",content:"article"},{property:"og:title",content:"k8sä¹DaemonSet"},{property:"og:description",content:"ä»ç»k8sä¸­çdaemonsetèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/08.k8s%E4%B9%8BDaemonSet.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-31T11:06:48.000Z"},{property:"article:tag",content:"k8s"},{property:"article:tag",content:"å®¹å¨"},{property:"article:tag",content:"äºåç"},{itemprop:"name",content:"k8sä¹DaemonSet"},{itemprop:"description",content:"ä»ç»k8sä¸­çdaemonsetèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/08.k8s%E4%B9%8BDaemonSet.html",relativePath:"01.äºåç/07.k8s/08.k8sä¹DaemonSet.md",key:"v-642acf34",path:"/pages/92bee4/",headers:[{level:2,title:"ä»ä¹æ¯DaemonSetï¼",slug:"ä»ä¹æ¯daemonset",normalizedTitle:"ä»ä¹æ¯daemonsetï¼",charIndex:2},{level:2,title:"ä½¿ç¨DaemonSet",slug:"ä½¿ç¨daemonset",normalizedTitle:"ä½¿ç¨daemonset",charIndex:153}],headersStr:"ä»ä¹æ¯DaemonSetï¼ ä½¿ç¨DaemonSet",content:"# ä»ä¹æ¯DaemonSetï¼\n\nå¨K8séç¾¤ä¸­çæ¯ä¸ä¸ªNodeä¸­é½ä¼è¿è¡ä¸ä¸ªPodçæ§å¶å¨ã\n\nä½¿ç¨åºæ¯æ¯ï¼\n\n * æ¥å¿æ¶éï¼æ¯ä¸ªèç¹è¿è¡ä¸ä¸ªPodç¨äºæ¶éå®¹å¨äº§ççæ¥å¿\n * çæ§ç®¡çï¼æ¯ä¸ªèç¹è¿è¡ä¸ä¸ªpodç¨äºçæ§èç¹çç¶æ\n * ç½ç»åºç¨ï¼æ¯ä¸ªèç¹è¿è¡ä¸ä¸ªPodç¨äºå°èç¹å å¥k8sç½ç»\n\n\n# ä½¿ç¨DaemonSet\n\nä½¿ç¨yamlæè¿°DaemonSetå¯¹è±¡\n\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: nginx-ds\n  labels:\n    k8s-app: nginx-ds\nspec:\n  selector:\n    matchLabels:\n      name: nginx-ds\n  template:\n    metadata:\n      labels:\n        name: nginx-ds\n    spec:\n      containers:\n      - name: nginx-ds\n        image: nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nåå»ºDaemonSetå¯¹è±¡ï¼ä¼çå°èªå¨çæ¯ä¸ä¸ªèç¹ä¸­é½åå»ºäºä¸ä¸ªpodã\n\n[root@k8s-worker1 zwf]# kubectl apply -f daemonset.yaml -n zwf\ndaemonset.apps/nginx-ds configured\n\n[root@k8s-worker1 zwf]# kubectl get nodes\nNAME          STATUS   ROLES    AGE    VERSION\nk8s-master    Ready    <none>   32d    v1.23.4\nk8s-worker1   Ready    <none>   152d   v1.23.4\nk8s-worker2   Ready    <none>   152d   v1.23.4\n\n[root@k8s-worker1 zwf]# kubectl get ds -n zwf\nNAME       DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE\nnginx-ds   3         3         3       3            3           <none>          4m2s\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf -o wide\nNAME             READY   STATUS    RESTARTS   AGE   IP               NODE          NOMINATED NODE   READINESS GATES\nnginx-ds-7w2kx   1/1     Running   0          81s   10.222.194.73    k8s-worker1   <none>           <none>\nnginx-ds-l5lmx   1/1     Running   0          46s   10.222.126.38    k8s-worker2   <none>           <none>\nnginx-ds-zdfgl   1/1     Running   0          82s   10.222.235.217   k8s-master    <none>           <none>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n",normalizedContent:"# ä»ä¹æ¯daemonsetï¼\n\nå¨k8séç¾¤ä¸­çæ¯ä¸ä¸ªnodeä¸­é½ä¼è¿è¡ä¸ä¸ªpodçæ§å¶å¨ã\n\nä½¿ç¨åºæ¯æ¯ï¼\n\n * æ¥å¿æ¶éï¼æ¯ä¸ªèç¹è¿è¡ä¸ä¸ªpodç¨äºæ¶éå®¹å¨äº§ççæ¥å¿\n * çæ§ç®¡çï¼æ¯ä¸ªèç¹è¿è¡ä¸ä¸ªpodç¨äºçæ§èç¹çç¶æ\n * ç½ç»åºç¨ï¼æ¯ä¸ªèç¹è¿è¡ä¸ä¸ªpodç¨äºå°èç¹å å¥k8sç½ç»\n\n\n# ä½¿ç¨daemonset\n\nä½¿ç¨yamlæè¿°daemonsetå¯¹è±¡\n\napiversion: apps/v1\nkind: daemonset\nmetadata:\n  name: nginx-ds\n  labels:\n    k8s-app: nginx-ds\nspec:\n  selector:\n    matchlabels:\n      name: nginx-ds\n  template:\n    metadata:\n      labels:\n        name: nginx-ds\n    spec:\n      containers:\n      - name: nginx-ds\n        image: nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nåå»ºdaemonsetå¯¹è±¡ï¼ä¼çå°èªå¨çæ¯ä¸ä¸ªèç¹ä¸­é½åå»ºäºä¸ä¸ªpodã\n\n[root@k8s-worker1 zwf]# kubectl apply -f daemonset.yaml -n zwf\ndaemonset.apps/nginx-ds configured\n\n[root@k8s-worker1 zwf]# kubectl get nodes\nname          status   roles    age    version\nk8s-master    ready    <none>   32d    v1.23.4\nk8s-worker1   ready    <none>   152d   v1.23.4\nk8s-worker2   ready    <none>   152d   v1.23.4\n\n[root@k8s-worker1 zwf]# kubectl get ds -n zwf\nname       desired   current   ready   up-to-date   available   node selector   age\nnginx-ds   3         3         3       3            3           <none>          4m2s\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf -o wide\nname             ready   status    restarts   age   ip               node          nominated node   readiness gates\nnginx-ds-7w2kx   1/1     running   0          81s   10.222.194.73    k8s-worker1   <none>           <none>\nnginx-ds-l5lmx   1/1     running   0          46s   10.222.126.38    k8s-worker2   <none>           <none>\nnginx-ds-zdfgl   1/1     running   0          82s   10.222.235.217   k8s-master    <none>           <none>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n",charsets:{cjk:!0},lastUpdated:"2023/01/15, 20:17:10",lastUpdatedTimestamp:167378503e4},{title:"k8sä¹PVãPVCåStorageClass",frontmatter:{tags:["k8s","å®¹å¨","äºåç"],title:"k8sä¹PVãPVCåStorageClass",date:"2022-08-31T15:03:37.000Z",permalink:"/pages/095c75/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä»ç»k8sä¸­çpvãpvcåstorageclassèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾",feed:{enable:!0},categories:["äºåç","k8s"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220831163136.png"},{name:"twitter:title",content:"k8sä¹PVãPVCåStorageClass"},{name:"twitter:description",content:"ä»ç»k8sä¸­çpvãpvcåstorageclassèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220831163136.png"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/09.k8s%E4%B9%8BPV%E3%80%81PVC%E5%92%8CStorageClass.html"},{property:"og:type",content:"article"},{property:"og:title",content:"k8sä¹PVãPVCåStorageClass"},{property:"og:description",content:"ä»ç»k8sä¸­çpvãpvcåstorageclassèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220831163136.png"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/09.k8s%E4%B9%8BPV%E3%80%81PVC%E5%92%8CStorageClass.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-31T15:03:37.000Z"},{property:"article:tag",content:"k8s"},{property:"article:tag",content:"å®¹å¨"},{property:"article:tag",content:"äºåç"},{itemprop:"name",content:"k8sä¹PVãPVCåStorageClass"},{itemprop:"description",content:"ä»ç»k8sä¸­çpvãpvcåstorageclassèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220831163136.png"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/09.k8s%E4%B9%8BPV%E3%80%81PVC%E5%92%8CStorageClass.html",relativePath:"01.äºåç/07.k8s/09.k8sä¹PVãPVCåStorageClass.md",key:"v-86799138",path:"/pages/095c75/",headers:[{level:2,title:"PV",slug:"pv",normalizedTitle:"pv",charIndex:2},{level:3,title:"ä»ä¹æ¯PVï¼",slug:"ä»ä¹æ¯pv",normalizedTitle:"ä»ä¹æ¯pvï¼",charIndex:9},{level:3,title:"åå»ºPV",slug:"åå»ºpv",normalizedTitle:"åå»ºpv",charIndex:78},{level:2,title:"PVC",slug:"pvc",normalizedTitle:"pvc",charIndex:918},{level:3,title:"ä»ä¹æ¯PVCï¼",slug:"ä»ä¹æ¯pvc",normalizedTitle:"ä»ä¹æ¯pvcï¼",charIndex:926},{level:3,title:"åå»ºPVC",slug:"åå»ºpvc",normalizedTitle:"åå»ºpvc",charIndex:1095},{level:2,title:"å¨Podä¸­ç³è¯·PVC",slug:"å¨podä¸­ç³è¯·pvc",normalizedTitle:"å¨podä¸­ç³è¯·pvc",charIndex:1861},{level:2,title:"StorageClass",slug:"storageclass",normalizedTitle:"storageclass",charIndex:2832},{level:3,title:"éè¿StorageClasséç½®NFS Provisioner",slug:"éè¿storageclasséç½®nfs-provisioner",normalizedTitle:"éè¿storageclasséç½®nfs provisioner",charIndex:3020},{level:3,title:"ä½¿ç¨NFSå¨æå­å¨å·",slug:"ä½¿ç¨nfså¨æå­å¨å·",normalizedTitle:"ä½¿ç¨nfså¨æå­å¨å·",charIndex:4499}],headersStr:"PV ä»ä¹æ¯PVï¼ åå»ºPV PVC ä»ä¹æ¯PVCï¼ åå»ºPVC å¨Podä¸­ç³è¯·PVC StorageClass éè¿StorageClasséç½®NFS Provisioner ä½¿ç¨NFSå¨æå­å¨å·",content:'# PV\n\n\n# ä»ä¹æ¯PVï¼\n\nPV æè¿°çï¼åæ¯ä¸ä¸ªå·ä½ç Volume çå±æ§ï¼æ¯å¦ Volume çç±»åãæè½½ç®å½ãè¿ç¨å­å¨æå¡å¨å°åç­ã\n\n\n# åå»ºPV\n\nä½¿ç¨yamlæ¥å®ä¹PV\n\n\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: nfs-1g-pv\n\nspec:\n  storageClassName: nfs\n  accessModes:\n    - ReadWriteMany\n  capacity:\n    storage: 1Gi\n\n  nfs:\n    path: /root/zwf/share\n    server: 10.64.2.153\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nåæ°è¯´æï¼\n\n * storageClassNameçå¼ä¸ºnfsï¼ä½¿ç¨äºNFSç½ç»æä»¶ç³»ç»ä½ä¸ºå­å¨å·ï¼\n * accessModesçå¼ä¸ºReadWriteManyï¼æ¯æå¤ä¸ªèç¹åæ¶è¯»åè¯¥å±äº«ç®å½\n * storageçå¼ä¸º1Giï¼åéäº1Gçå­å¨ç©ºé´\n\nä½¿ç¨yamlå®ä¹çæè¿°æä»¶æ¥åå»ºPVå¯¹è±¡\n\n[root@k8s-worker1 zwf]# kubectl apply -f pv.yaml -n zwf\npersistentvolume/nfs-1g-pv created\n[root@k8s-worker1 zwf]# kubectl get pv -n zwf\nNAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM                           STORAGECLASS   REASON   AGE\nnfs-1g-pv   1Gi        RWX            Retain           Available                                   nfs                     12s\n\n\n1\n2\n3\n4\n5\n\n\n\n# PVC\n\n\n# ä»ä¹æ¯PVCï¼\n\næä¾ç»åºç¨å¼åè·åå­å¨èµæºçå¯¹è±¡ï¼å¼åå°podä¸PVCè¿è¡ç»å®å¯ä»¥è¾¾å°æä¹åçå­å¨ç¶æï¼èPVCä¼ä¸ç¸å¯¹åºçPVç¸ç»å®ï¼æä¾å·ä½çå­å¨ç©ºé´ã\n\nPVåPVCæä»ä¹åºå«ï¼\n\nå®éä¸ç±»ä¼¼äºâæ¥å£âåâå®ç°âçææ³ãå¼åèåªè¦ç¥éå¹¶ä¼ä½¿ç¨âæ¥å£âï¼å³ï¼PVCï¼èè¿ç»´äººååè´è´£ç»âæ¥å£âç»å®å·ä½çå®ç°ï¼å³ï¼PVã\n\n\n\n\n# åå»ºPVC\n\næäºpvä¹åï¼åå»ºç³è¯·å­å¨çPVCå¯¹è±¡ï¼yamlå®ä¹å¦ä¸ï¼å®ä¹çåå®¹åPVåºæ¬ç¸åï¼ä½æ¯ä¸åå«NFSçå­å¨ç»èã\n\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: nfs-static-pvc\n\nspec:\n  storageClassName: nfs\n  accessModes:\n    - ReadWriteMany\n\n  resources:\n    requests:\n      storage: 1Gi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nåå»ºpvcå¯¹è±¡ï¼å¹¶ä¸å¯ä»¥çå°VOLUMEçå¼æ¯ä¸é¢åå»ºçpvå¯¹è±¡ï¼è¿æ ·ä¸¤èå°±è¿è¡ç»å®äºã\n\n[root@k8s-worker1 zwf]# kubectl apply -f pvc.yaml -n zwf\npersistentvolumeclaim/nfs-static-pvc created\n[root@k8s-worker1 zwf]# \n[root@k8s-worker1 zwf]# kubectl get pvc -n zwf\nNAME             STATUS   VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nnfs-static-pvc   Bound    nfs-1g-pv   1Gi        RWX            nfs            9s\n\n\n1\n2\n3\n4\n5\n6\n\n\næä»¬åpvcæä»¶ä¸­å¹¶æ²¡æå¡«åpvçä»»ä½ä¿¡æ¯ï¼å®æ¯å¦ä½ç¥éè¯¥ç»å®é£ä¸ªpvå¯¹è±¡çå¢ï¼è¿æ¯å ä¸ºpvcä¼æ ¹æ®èªèº«éè¦çå®¹éå»æ¾å°å¯¹åºçpvè¿è¡å¹éç»å®ã\n\n\n# å¨Podä¸­ç³è¯·PVC\n\nPodçyamlå®ä¹å¦ä¸ï¼ä½¿ç¨volumeså®ä¹äºå­å¨å·ä½¿ç¨ä¸é¢åå»ºçpvcå¯¹è±¡nfs-static-pvcï¼å¨containersä¸­ä½¿ç¨vlumeMountså¨podä¸­æè½½äº/tmpç®å½å¨è¯¥å­å¨å·ä¸­ã\n\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nfs-static-pod\n\nspec:\n  volumes:\n  - name: nfs-pvc-vol\n    persistentVolumeClaim:\n      claimName: nfs-static-pvc\n\n  containers:\n    - name: nfs-pvc-test\n      image: nginx:alpine\n      ports:\n      - containerPort: 80\n\n      volumeMounts:\n        - name: nfs-pvc-vol\n          mountPath: /tmp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nåå»ºpodåï¼æä»¬è¿å¥podä¸­å¨/tmpåå¥æ°æ®\n\n[root@k8s-worker1 zwf]# kubectl apply -f pod_pvc.yaml -n zwf\npod/nfs-static-pod created\n\n[root@k8s-worker1 zwf]# kubectl exec -it nfs-static-pod -n zwf -- /bin/sh\n/ # cd /tmp\n/tmp # echo 222 > 2.txt\n\n\n1\n2\n3\n4\n5\n6\n\n\nå¨nfsæå¡å¨ä¸­ç/root/zwf/shareä¸­ï¼æä»¬ä¹å¯ä»¥çå°ä¸é¢åçæ°æ®\n\n[root@k8s-worker2 share]# pwd\n/root/zwf/share\n[root@k8s-worker2 share]# ls\n2.txt\n[root@k8s-worker2 share]# cat 2.txt\n222\n\n\n1\n2\n3\n4\n5\n6\n\n\nPodãPVCãPV å NFS å­å¨çå³ç³»å¯ä»¥ç¨ä¸å¾æ¥å½¢è±¡å°è¡¨ç¤ºï¼\n\n\n\n\n# StorageClass\n\nä¸é¢çPVæ¯éè¦ç®¡çåæå¨åå»ºçï¼æ¯ä¸æ¬¡çå¼åé½éè¦æ ¹æ®éæ±éä¸ªåå»ºPVï¼å¹¶ä¸è¿éè¦ç²¾ç¡®åå»ºç©ºé´å¤§å°ï¼å¯¼è´å·¥ä½éå·¨å¤§ãæä»¥æä»¬éè¦å¨å¼åä¸­å¯ä»¥å¨æçåå»ºPVã\n\nStoreageClasså¯ä»¥ç¨æ¥ç»å®Provisionerå¯¹è±¡ï¼èè¿ä¸ªProvisionerå°±æ¯ä¸ä¸ªè½å¤èªå¨ç®¡çå­å¨ãåå»º PV çåºç¨ï¼ä»£æ¿äºåæ¥ç³»ç»ç®¡çåçæå·¥å³å¨ã\n\n\n\n\n# éè¿StorageClasséç½®NFS Provisioner\n\nk8sä¸­æ¯ä¸ç±»çå­å¨è®¾å¤é½æç¸åºçProvisionerï¼è¿éæä»¬ä½¿ç¨çæ¯NFS Provisioner(https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner)\n\nå¨ GitHub ç deploy ç®å½éæ¯é¨ç½²å®æéç YAML æä»¶ï¼ä¸å±æä¸ä¸ªï¼åå«æ¯ rbac.yamlãclass.yamlå deployment.yamlã\n\n 1. é¦åå°rbac.yamlçnamespaceæ¹ækube-system\n 2. å¨ä¿®æ¹deployment.yamlçnamespaceä¹æ¹ä¸ºkube-systemï¼åä¿®æ¹å¶ä¸­çvolumes å env éç IP å°ååå±äº«ç®å½åï¼ä¸NFSæå¡å¨ä¿æä¸è´.\n\n\nspec:\n  template:\n    spec:\n      serviceAccountName: nfs-client-provisioner\n      containers:\n      ...\n          env:\n            - name: PROVISIONER_NAME\n              value: k8s-sigs.io/nfs-subdir-external-provisioner\n            - name: NFS_SERVER\n              value: 192.168.10.208        #æ¹IPå°å\n            - name: NFS_PATH\n              value: /tmp/nfs              #æ¹å±äº«ç®å½å\n      volumes:\n        - name: nfs-client-root\n          nfs:\n            server: 192.168.10.208         #æ¹IPå°å\n            Path: /tmp/nfs                 #æ¹å±äº«ç®å½å\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nåå°k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2æ¹æchronolaw/nfs-subdir-external-provisioner:v4.0.2\n\n 3. æååå»ºNFS Provisioner\n\nkubectl apply -f rbac.yaml\nkubectl apply -f class.yaml\nkubectl apply -f deployment.yaml\n\n\n1\n2\n3\n\n\næ¥çkube-systemçpodå¯ä»¥çå°nfsçprovisionerã\n\n[root@k8s-worker1 zwf]# kubectl get pods -n kube-system\nNAME                                      READY   STATUS    RESTARTS      AGE\nnfs-client-provisioner-57789d96b7-42q67   1/1     Running   0             22h\n\n\n1\n2\n3\n\n\n\n# ä½¿ç¨NFSå¨æå­å¨å·\n\nåå»ºStrogeClasså¯¹è±¡ï¼onDelete: "remain"ä»£è¡¨çå³ä½¿Podè¢«å é¤ï¼ä¹ä¼ä¿çåéçå­å¨ï¼ä¹ååæå¨å é¤ã\n\n\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: nfs-client\n\nprovisioner: k8s-sigs.io/nfs-subdir-external-provisioner \nparameters:\n  onDelete: "remain"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nåå»ºStrageClasså¯¹è±¡ï¼å¹¶å¯ä»¥çå°PROVISIONERå·²ç»ç»å®äºæä»¬ä¸é¢åå»ºçnfs-provisioneräºã\n\n[root@k8s-worker1 zwf]# kubectl apply -f pvc_dyn.yaml -n zwf\nstorageclass.storage.k8s.io/nfs-client-retained created\n\n[root@k8s-worker1 zwf]# kubectl get sc -n zwf\nNAME                  PROVISIONER                                   RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE\nnfs-client   k8s-sigs.io/nfs-subdir-external-provisioner   Delete          Immediate           false                  21h\n\n\n1\n2\n3\n4\n5\n6\n\n\nå®ä¹PVCï¼éç½®storageClassName:nfs-clientä¸ä¸é¢çStrageClasså¯¹è±¡ç¸ç»å®ã\n\n\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: nfs-dyn-10m-pvc\n\nspec:\n  storageClassName: nfs-client\n  accessModes:\n    - ReadWriteMany\n\n  resources:\n    requests:\n      storage: 10Mi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nåå»ºPVCï¼ç¶åä½ ä¼åç°STATUSçç¶æä¸ºBoundï¼å·²ç»èªå¨çåå»ºäºPVï¼å¹¶ä¸å·²ç»ç¸äºç»å®ã\n\n[root@k8s-worker1 zwf]# kubectl get pvc -n zwf\nNAME              STATUS    VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nnfs-dyn-10m-pvc   Pending                                         nfs-client     25s\n\n[root@k8s-worker1 zwf]# kubectl get pvc -n zwf\nNAME              STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nnfs-dyn-10m-pvc   Bound    pvc-292cfed3-bec8-4425-aeac-697e3740c76c   10Mi       RWX            nfs-client     9s\n\n[root@k8s-worker1 zwf]# kubectl get pv -n zwf\nNAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                           STORAGECLASS   REASON   AGE\npvc-292cfed3-bec8-4425-aeac-697e3740c76c   10Mi       RWX            Delete           Bound    zwf/nfs-dyn-10m-pvc             nfs-client              47s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå»NFSæä»¶æå¡å¨çå±äº«ç®å½ä¸­æ¥çï¼å¯ä»¥çå°å¤åºæ¥äºä¸ä¸ªç®å½ï¼ç®å½åç§°ä¸ºå½åç©ºé´-pvcåç§°-pvcåç§°\n\n[root@k8s-worker2 share]# pwd\n/root/zwf/share\n[root@k8s-worker2 share]# ls\nzwf-nfs-dyn-10m-pvc-pvc-292cfed3-bec8-4425-aeac-697e3740c76c\n\n\n1\n2\n3\n4\n\n\nå®ä¹Podï¼æè½½ä¸é¢åå»ºçPVCå°å®¹å¨ç/tmpç®å½ä¸­\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nfs-dyn-pod\n\nspec:\n  volumes:\n  - name: nfs-dyn-10m-vol\n    persistentVolumeClaim:\n      claimName: nfs-dyn-10m-pvc\n\n  containers:\n    - name: nfs-dyn-test\n      image: nginx:alpine\n\n      volumeMounts:\n        - name: nfs-dyn-10m-vol\n          mountPath: /tmp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nåå»ºPodæå\n\n[root@k8s-worker1 zwf]# kubectl apply -f pod_strageclass.yaml -n zwf\npod/nfs-dyn-pod created\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf\nNAME          READY   STATUS    RESTARTS   AGE\nnfs-dyn-pod   1/1     Running   0          10s\n\n\n1\n2\n3\n4\n5\n\n\nè¿å¥å°æè½½äºpvcçpodï¼ç¶åå¨/tmpç®å½ä¸åä¸ä¸ªæä»¶\n\nkubectl exec -it nfs-dyn-pod -n zwf -- /bin/sh\n/ # cd /tmp\n/tmp # echo 111 > 3.txt\n\n\n1\n2\n3\n\n\nåå°NFSæå¡å¨ä¸çå±äº«ç®å½å¯¹åºçpvç®å½ä¸ï¼è½çå°ä¹ååçæä»¶ã\n\n[root@k8s-worker2 zwf-nfs-dyn-10m-pvc-pvc-292cfed3-bec8-4425-aeac-697e3740c76c]# pwd\n/root/zwf/share/zwf-nfs-dyn-10m-pvc-pvc-292cfed3-bec8-4425-aeac-697e3740c76c\n\n[root@k8s-worker2 zwf-nfs-dyn-10m-pvc-pvc-292cfed3-bec8-4425-aeac-697e3740c76c]# cat 3.txt \n111\n\n\n1\n2\n3\n4\n5\n\n\nå³ç³»å¾å¦ä¸ï¼\n\n',normalizedContent:'# pv\n\n\n# ä»ä¹æ¯pvï¼\n\npv æè¿°çï¼åæ¯ä¸ä¸ªå·ä½ç volume çå±æ§ï¼æ¯å¦ volume çç±»åãæè½½ç®å½ãè¿ç¨å­å¨æå¡å¨å°åç­ã\n\n\n# åå»ºpv\n\nä½¿ç¨yamlæ¥å®ä¹pv\n\n\napiversion: v1\nkind: persistentvolume\nmetadata:\n  name: nfs-1g-pv\n\nspec:\n  storageclassname: nfs\n  accessmodes:\n    - readwritemany\n  capacity:\n    storage: 1gi\n\n  nfs:\n    path: /root/zwf/share\n    server: 10.64.2.153\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nåæ°è¯´æï¼\n\n * storageclassnameçå¼ä¸ºnfsï¼ä½¿ç¨äºnfsç½ç»æä»¶ç³»ç»ä½ä¸ºå­å¨å·ï¼\n * accessmodesçå¼ä¸ºreadwritemanyï¼æ¯æå¤ä¸ªèç¹åæ¶è¯»åè¯¥å±äº«ç®å½\n * storageçå¼ä¸º1giï¼åéäº1gçå­å¨ç©ºé´\n\nä½¿ç¨yamlå®ä¹çæè¿°æä»¶æ¥åå»ºpvå¯¹è±¡\n\n[root@k8s-worker1 zwf]# kubectl apply -f pv.yaml -n zwf\npersistentvolume/nfs-1g-pv created\n[root@k8s-worker1 zwf]# kubectl get pv -n zwf\nname        capacity   access modes   reclaim policy   status      claim                           storageclass   reason   age\nnfs-1g-pv   1gi        rwx            retain           available                                   nfs                     12s\n\n\n1\n2\n3\n4\n5\n\n\n\n# pvc\n\n\n# ä»ä¹æ¯pvcï¼\n\næä¾ç»åºç¨å¼åè·åå­å¨èµæºçå¯¹è±¡ï¼å¼åå°podä¸pvcè¿è¡ç»å®å¯ä»¥è¾¾å°æä¹åçå­å¨ç¶æï¼èpvcä¼ä¸ç¸å¯¹åºçpvç¸ç»å®ï¼æä¾å·ä½çå­å¨ç©ºé´ã\n\npvåpvcæä»ä¹åºå«ï¼\n\nå®éä¸ç±»ä¼¼äºâæ¥å£âåâå®ç°âçææ³ãå¼åèåªè¦ç¥éå¹¶ä¼ä½¿ç¨âæ¥å£âï¼å³ï¼pvcï¼èè¿ç»´äººååè´è´£ç»âæ¥å£âç»å®å·ä½çå®ç°ï¼å³ï¼pvã\n\n\n\n\n# åå»ºpvc\n\næäºpvä¹åï¼åå»ºç³è¯·å­å¨çpvcå¯¹è±¡ï¼yamlå®ä¹å¦ä¸ï¼å®ä¹çåå®¹åpvåºæ¬ç¸åï¼ä½æ¯ä¸åå«nfsçå­å¨ç»èã\n\napiversion: v1\nkind: persistentvolumeclaim\nmetadata:\n  name: nfs-static-pvc\n\nspec:\n  storageclassname: nfs\n  accessmodes:\n    - readwritemany\n\n  resources:\n    requests:\n      storage: 1gi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nåå»ºpvcå¯¹è±¡ï¼å¹¶ä¸å¯ä»¥çå°volumeçå¼æ¯ä¸é¢åå»ºçpvå¯¹è±¡ï¼è¿æ ·ä¸¤èå°±è¿è¡ç»å®äºã\n\n[root@k8s-worker1 zwf]# kubectl apply -f pvc.yaml -n zwf\npersistentvolumeclaim/nfs-static-pvc created\n[root@k8s-worker1 zwf]# \n[root@k8s-worker1 zwf]# kubectl get pvc -n zwf\nname             status   volume      capacity   access modes   storageclass   age\nnfs-static-pvc   bound    nfs-1g-pv   1gi        rwx            nfs            9s\n\n\n1\n2\n3\n4\n5\n6\n\n\næä»¬åpvcæä»¶ä¸­å¹¶æ²¡æå¡«åpvçä»»ä½ä¿¡æ¯ï¼å®æ¯å¦ä½ç¥éè¯¥ç»å®é£ä¸ªpvå¯¹è±¡çå¢ï¼è¿æ¯å ä¸ºpvcä¼æ ¹æ®èªèº«éè¦çå®¹éå»æ¾å°å¯¹åºçpvè¿è¡å¹éç»å®ã\n\n\n# å¨podä¸­ç³è¯·pvc\n\npodçyamlå®ä¹å¦ä¸ï¼ä½¿ç¨volumeså®ä¹äºå­å¨å·ä½¿ç¨ä¸é¢åå»ºçpvcå¯¹è±¡nfs-static-pvcï¼å¨containersä¸­ä½¿ç¨vlumemountså¨podä¸­æè½½äº/tmpç®å½å¨è¯¥å­å¨å·ä¸­ã\n\n\napiversion: v1\nkind: pod\nmetadata:\n  name: nfs-static-pod\n\nspec:\n  volumes:\n  - name: nfs-pvc-vol\n    persistentvolumeclaim:\n      claimname: nfs-static-pvc\n\n  containers:\n    - name: nfs-pvc-test\n      image: nginx:alpine\n      ports:\n      - containerport: 80\n\n      volumemounts:\n        - name: nfs-pvc-vol\n          mountpath: /tmp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nåå»ºpodåï¼æä»¬è¿å¥podä¸­å¨/tmpåå¥æ°æ®\n\n[root@k8s-worker1 zwf]# kubectl apply -f pod_pvc.yaml -n zwf\npod/nfs-static-pod created\n\n[root@k8s-worker1 zwf]# kubectl exec -it nfs-static-pod -n zwf -- /bin/sh\n/ # cd /tmp\n/tmp # echo 222 > 2.txt\n\n\n1\n2\n3\n4\n5\n6\n\n\nå¨nfsæå¡å¨ä¸­ç/root/zwf/shareä¸­ï¼æä»¬ä¹å¯ä»¥çå°ä¸é¢åçæ°æ®\n\n[root@k8s-worker2 share]# pwd\n/root/zwf/share\n[root@k8s-worker2 share]# ls\n2.txt\n[root@k8s-worker2 share]# cat 2.txt\n222\n\n\n1\n2\n3\n4\n5\n6\n\n\npodãpvcãpv å nfs å­å¨çå³ç³»å¯ä»¥ç¨ä¸å¾æ¥å½¢è±¡å°è¡¨ç¤ºï¼\n\n\n\n\n# storageclass\n\nä¸é¢çpvæ¯éè¦ç®¡çåæå¨åå»ºçï¼æ¯ä¸æ¬¡çå¼åé½éè¦æ ¹æ®éæ±éä¸ªåå»ºpvï¼å¹¶ä¸è¿éè¦ç²¾ç¡®åå»ºç©ºé´å¤§å°ï¼å¯¼è´å·¥ä½éå·¨å¤§ãæä»¥æä»¬éè¦å¨å¼åä¸­å¯ä»¥å¨æçåå»ºpvã\n\nstoreageclasså¯ä»¥ç¨æ¥ç»å®provisionerå¯¹è±¡ï¼èè¿ä¸ªprovisionerå°±æ¯ä¸ä¸ªè½å¤èªå¨ç®¡çå­å¨ãåå»º pv çåºç¨ï¼ä»£æ¿äºåæ¥ç³»ç»ç®¡çåçæå·¥å³å¨ã\n\n\n\n\n# éè¿storageclasséç½®nfs provisioner\n\nk8sä¸­æ¯ä¸ç±»çå­å¨è®¾å¤é½æç¸åºçprovisionerï¼è¿éæä»¬ä½¿ç¨çæ¯nfs provisioner(https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner)\n\nå¨ github ç deploy ç®å½éæ¯é¨ç½²å®æéç yaml æä»¶ï¼ä¸å±æä¸ä¸ªï¼åå«æ¯ rbac.yamlãclass.yamlå deployment.yamlã\n\n 1. é¦åå°rbac.yamlçnamespaceæ¹ækube-system\n 2. å¨ä¿®æ¹deployment.yamlçnamespaceä¹æ¹ä¸ºkube-systemï¼åä¿®æ¹å¶ä¸­çvolumes å env éç ip å°ååå±äº«ç®å½åï¼ä¸nfsæå¡å¨ä¿æä¸è´.\n\n\nspec:\n  template:\n    spec:\n      serviceaccountname: nfs-client-provisioner\n      containers:\n      ...\n          env:\n            - name: provisioner_name\n              value: k8s-sigs.io/nfs-subdir-external-provisioner\n            - name: nfs_server\n              value: 192.168.10.208        #æ¹ipå°å\n            - name: nfs_path\n              value: /tmp/nfs              #æ¹å±äº«ç®å½å\n      volumes:\n        - name: nfs-client-root\n          nfs:\n            server: 192.168.10.208         #æ¹ipå°å\n            path: /tmp/nfs                 #æ¹å±äº«ç®å½å\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nåå°k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2æ¹æchronolaw/nfs-subdir-external-provisioner:v4.0.2\n\n 3. æååå»ºnfs provisioner\n\nkubectl apply -f rbac.yaml\nkubectl apply -f class.yaml\nkubectl apply -f deployment.yaml\n\n\n1\n2\n3\n\n\næ¥çkube-systemçpodå¯ä»¥çå°nfsçprovisionerã\n\n[root@k8s-worker1 zwf]# kubectl get pods -n kube-system\nname                                      ready   status    restarts      age\nnfs-client-provisioner-57789d96b7-42q67   1/1     running   0             22h\n\n\n1\n2\n3\n\n\n\n# ä½¿ç¨nfså¨æå­å¨å·\n\nåå»ºstrogeclasså¯¹è±¡ï¼ondelete: "remain"ä»£è¡¨çå³ä½¿podè¢«å é¤ï¼ä¹ä¼ä¿çåéçå­å¨ï¼ä¹ååæå¨å é¤ã\n\n\napiversion: storage.k8s.io/v1\nkind: storageclass\nmetadata:\n  name: nfs-client\n\nprovisioner: k8s-sigs.io/nfs-subdir-external-provisioner \nparameters:\n  ondelete: "remain"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nåå»ºstrageclasså¯¹è±¡ï¼å¹¶å¯ä»¥çå°provisionerå·²ç»ç»å®äºæä»¬ä¸é¢åå»ºçnfs-provisioneräºã\n\n[root@k8s-worker1 zwf]# kubectl apply -f pvc_dyn.yaml -n zwf\nstorageclass.storage.k8s.io/nfs-client-retained created\n\n[root@k8s-worker1 zwf]# kubectl get sc -n zwf\nname                  provisioner                                   reclaimpolicy   volumebindingmode   allowvolumeexpansion   age\nnfs-client   k8s-sigs.io/nfs-subdir-external-provisioner   delete          immediate           false                  21h\n\n\n1\n2\n3\n4\n5\n6\n\n\nå®ä¹pvcï¼éç½®storageclassname:nfs-clientä¸ä¸é¢çstrageclasså¯¹è±¡ç¸ç»å®ã\n\n\napiversion: v1\nkind: persistentvolumeclaim\nmetadata:\n  name: nfs-dyn-10m-pvc\n\nspec:\n  storageclassname: nfs-client\n  accessmodes:\n    - readwritemany\n\n  resources:\n    requests:\n      storage: 10mi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nåå»ºpvcï¼ç¶åä½ ä¼åç°statusçç¶æä¸ºboundï¼å·²ç»èªå¨çåå»ºäºpvï¼å¹¶ä¸å·²ç»ç¸äºç»å®ã\n\n[root@k8s-worker1 zwf]# kubectl get pvc -n zwf\nname              status    volume      capacity   access modes   storageclass   age\nnfs-dyn-10m-pvc   pending                                         nfs-client     25s\n\n[root@k8s-worker1 zwf]# kubectl get pvc -n zwf\nname              status   volume                                     capacity   access modes   storageclass   age\nnfs-dyn-10m-pvc   bound    pvc-292cfed3-bec8-4425-aeac-697e3740c76c   10mi       rwx            nfs-client     9s\n\n[root@k8s-worker1 zwf]# kubectl get pv -n zwf\nname                                       capacity   access modes   reclaim policy   status   claim                           storageclass   reason   age\npvc-292cfed3-bec8-4425-aeac-697e3740c76c   10mi       rwx            delete           bound    zwf/nfs-dyn-10m-pvc             nfs-client              47s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå»nfsæä»¶æå¡å¨çå±äº«ç®å½ä¸­æ¥çï¼å¯ä»¥çå°å¤åºæ¥äºä¸ä¸ªç®å½ï¼ç®å½åç§°ä¸ºå½åç©ºé´-pvcåç§°-pvcåç§°\n\n[root@k8s-worker2 share]# pwd\n/root/zwf/share\n[root@k8s-worker2 share]# ls\nzwf-nfs-dyn-10m-pvc-pvc-292cfed3-bec8-4425-aeac-697e3740c76c\n\n\n1\n2\n3\n4\n\n\nå®ä¹podï¼æè½½ä¸é¢åå»ºçpvcå°å®¹å¨ç/tmpç®å½ä¸­\n\napiversion: v1\nkind: pod\nmetadata:\n  name: nfs-dyn-pod\n\nspec:\n  volumes:\n  - name: nfs-dyn-10m-vol\n    persistentvolumeclaim:\n      claimname: nfs-dyn-10m-pvc\n\n  containers:\n    - name: nfs-dyn-test\n      image: nginx:alpine\n\n      volumemounts:\n        - name: nfs-dyn-10m-vol\n          mountpath: /tmp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nåå»ºpodæå\n\n[root@k8s-worker1 zwf]# kubectl apply -f pod_strageclass.yaml -n zwf\npod/nfs-dyn-pod created\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf\nname          ready   status    restarts   age\nnfs-dyn-pod   1/1     running   0          10s\n\n\n1\n2\n3\n4\n5\n\n\nè¿å¥å°æè½½äºpvcçpodï¼ç¶åå¨/tmpç®å½ä¸åä¸ä¸ªæä»¶\n\nkubectl exec -it nfs-dyn-pod -n zwf -- /bin/sh\n/ # cd /tmp\n/tmp # echo 111 > 3.txt\n\n\n1\n2\n3\n\n\nåå°nfsæå¡å¨ä¸çå±äº«ç®å½å¯¹åºçpvç®å½ä¸ï¼è½çå°ä¹ååçæä»¶ã\n\n[root@k8s-worker2 zwf-nfs-dyn-10m-pvc-pvc-292cfed3-bec8-4425-aeac-697e3740c76c]# pwd\n/root/zwf/share/zwf-nfs-dyn-10m-pvc-pvc-292cfed3-bec8-4425-aeac-697e3740c76c\n\n[root@k8s-worker2 zwf-nfs-dyn-10m-pvc-pvc-292cfed3-bec8-4425-aeac-697e3740c76c]# cat 3.txt \n111\n\n\n1\n2\n3\n4\n5\n\n\nå³ç³»å¾å¦ä¸ï¼\n\n',charsets:{cjk:!0},lastUpdated:"2023/01/15, 20:17:10",lastUpdatedTimestamp:167378503e4},{title:"k8sä¹StatefulSet",frontmatter:{tags:["k8s","å®¹å¨","äºåç"],author:{name:"msqfx",link:"https://github.com/msqfx"},title:"k8sä¹StatefulSet",date:"2022-08-31T14:55:02.000Z",permalink:"/pages/d178a2/",description:"ä»ç»k8sä¸­çstatefulsetèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾",feed:{enable:!0},categories:["äºåç","k8s"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220831173844.png"},{name:"twitter:title",content:"k8sä¹StatefulSet"},{name:"twitter:description",content:"ä»ç»k8sä¸­çstatefulsetèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220831173844.png"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/10.k8s%E4%B9%8BStatefulSet.html"},{property:"og:type",content:"article"},{property:"og:title",content:"k8sä¹StatefulSet"},{property:"og:description",content:"ä»ç»k8sä¸­çstatefulsetèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220831173844.png"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/10.k8s%E4%B9%8BStatefulSet.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-31T14:55:02.000Z"},{property:"article:tag",content:"k8s"},{property:"article:tag",content:"å®¹å¨"},{property:"article:tag",content:"äºåç"},{itemprop:"name",content:"k8sä¹StatefulSet"},{itemprop:"description",content:"ä»ç»k8sä¸­çstatefulsetèµæºå¯¹è±¡ï¼åå¶ä½¿ç¨æ¹æ³åæ¡ä¾"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220831173844.png"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/10.k8s%E4%B9%8BStatefulSet.html",relativePath:"01.äºåç/07.k8s/10.k8sä¹StatefulSet.md",key:"v-1eacf608",path:"/pages/d178a2/",headers:[{level:2,title:"ä»ä¹æ¯StatefulSet?",slug:"ä»ä¹æ¯statefulset",normalizedTitle:"ä»ä¹æ¯statefulset?",charIndex:2},{level:2,title:"ä½¿ç¨StatefulSet",slug:"ä½¿ç¨statefulset",normalizedTitle:"ä½¿ç¨statefulset",charIndex:227},{level:3,title:"åå»ºStatefulSet",slug:"åå»ºstatefulset",normalizedTitle:"åå»ºstatefulset",charIndex:245},{level:3,title:"Serviceéç½®",slug:"serviceéç½®",normalizedTitle:"serviceéç½®",charIndex:1436},{level:3,title:"æä¹åéç½®",slug:"æä¹åéç½®",normalizedTitle:"æä¹åéç½®",charIndex:4150}],headersStr:"ä»ä¹æ¯StatefulSet? ä½¿ç¨StatefulSet åå»ºStatefulSet Serviceéç½® æä¹åéç½®",content:'# ä»ä¹æ¯StatefulSet?\n\næ¯ç¨æ¥åå»ºæç¶æåºç¨ï¼å¯ä»¥éè¿è¿æç§æ¹å¼è®°å½è¿äºç¶æï¼ç¶åå¨ Pod è¢«éæ°åå»ºæ¶ï¼è½å¤ä¸ºæ° Pod æ¢å¤è¿äºç¶æã\n\nä»ä¹æ¯æç¶æåºç¨ï¼\n\né¦åæ¯éè¦ææ°æ®çæä¹åï¼å³ä½¿Podè¢«éå¯åï¼ä¹è½æ¢å¤ï¼ä¸éå¯åä¿æä¸è´ãç¶åæ¯åºç¨åå»ºçææpodæä¾èµå³ç³»ï¼é¡ºåºçåå»ºãéè¦è¿è¡å¨æå®çå®¿ä¸»æºä¸ï¼å¹¶ä¸é½æå¯¹åºçç½ç»æ å¿ã\n\nåºç¨åºæ¯ï¼\n\nåå¸å¼åºç¨ï¼å®çå¤ä¸ªå®ä¾ä¹é´ï¼å¾å¾æä¾èµå³ç³»ï¼æ¯å¦ï¼ä¸»ä»å³ç³»ãä¸»å¤å³ç³»ã\n\n\n# ä½¿ç¨StatefulSet\n\n\n# åå»ºStatefulSet\n\nåå»ºyamlæä»¶å®ä¹StatefulSetå¯¹è±¡å¦ä¸ï¼ä¸Deploymentæ¯è¾ï¼å¤äºä¸ä¸ªserviceNameå­æ®µï¼è¿ä¸ªæ¯ç¨æ¥æå®StatefulSetæç®¡ççpodæ¯ç¨ååè®¿é®æ¯éè¿è¯¥serviceæè®¾å®çã\n\n\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: redis-sts\n\nspec:\n  serviceName: redis-svc\n  replicas: 2\n  selector:\n    matchLabels:\n      app: redis-sts\n\n  template:\n    metadata:\n      labels:\n        app: redis-sts\n    spec:\n      containers:\n      - image: redis\n        name: redis\n        ports:\n        - containerPort: 6379\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nåå»ºStatefulSetå¯¹è±¡\n\n[root@k8s-worker1 zwf]# kubectl apply -f statefulset.yaml  -n zwf\nstatefulset.apps/redis-sts created\n\n[root@k8s-worker1 zwf]# kubectl get sts -n zwf\nNAME        READY   AGE\nredis-sts   2/2     54s\n\n\n1\n2\n3\n4\n5\n6\n\n\næ¥çåå»ºçPodä¼åç°ï¼å½åä¸åæ¯éæºåå»ºçåå­ï¼èæ¯æäºé¡ºåºå·ï¼ä»0å¼å§ï¼èk8sä¹ä¼æç§è¿ä¸ªé¡ºåºä¸æ¬¡åå»ºã\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf\nNAME          READY   STATUS    RESTARTS   AGE\nredis-sts-0   1/1     Running   0          61s\nredis-sts-1   1/1     Running   0          54s\n\n\n1\n2\n3\n4\n\n\nè¾åºpodä¸­çhostnameåç°ä¸podçåç§°ä¹ä¿æä¸è´ï¼ä¹å°±æ¯åºç¨å¯ä»¥èªè¡å³å®ä¾èµå³ç³»ï¼æ¯å¦è¯¥ä¾å­ä¸­å¯ä»¥ä½¿ç¨0å·podä½ä¸ºä¸»å®ä¾ï¼è1å·podä½ä¸ºä»å®ä¾ã\n\n[root@k8s-worker1 zwf]# kubectl exec -it redis-sts-0 -n zwf -- hostname\nredis-sts-0\n\n\n1\n2\n\n\n\n# Serviceéç½®\n\nå®ä¹å¹éä¸é¢çåå»ºStatefulSetå¯¹è±¡ææç®¡ççServiceï¼ä¹å°±æ¯æ ç­¾ç­ééè¦åpodçæ ç­¾ä¿æä¸è´ï¼å¹¶ä¸è¿éçmetadata.nameä¹è¦ä¸StatefulSetä¸­çserviceNameä¸æ ·ã\n\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: redis-svc\n\nspec:\n  selector:\n    app: redis-sts\n\n  ports:\n  - port: 6379\n    protocol: TCP\n    targetPort: 6379\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nåå»ºServiceå¯¹è±¡ï¼æä»¬å¯ä»¥çå°å·²ç»å°StatefulSetæåå»ºçpodå å¥å°ç«¯ç¹åè¡¨äºï¼ä¹å°±æ¯å¯ä»¥ç¨³å®çéè¿Serviceæ¥è®¿é®å°Pod\n\n[root@k8s-worker1 zwf]# kubectl apply -f service_statefulset.yaml -n zwf\nkservice/redis-svc created\n\n[root@k8s-worker1 zwf]# kubectl get svc -n zwf\nNAME                   TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE\nredis-svc              ClusterIP   10.0.0.246   <none>        6379/TCP       5s\n\n[root@k8s-worker1 zwf]# kubectl describe svc redis-svc -n zwf\nName:              redis-svc\nNamespace:         zwf\nLabels:            <none>\nAnnotations:       <none>\nSelector:          app=redis-sts\nType:              ClusterIP\nIP Family Policy:  SingleStack\nIP Families:       IPv4\nIP:                10.0.0.246\nIPs:               10.0.0.246\nPort:              <unset>  6379/TCP\nTargetPort:        6379/TCP\nEndpoints:         10.222.126.51:6379,10.222.194.84:6379\nSession Affinity:  None\nEvents:            <none>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nä½æ¯æä»¬çPodä¸æ¯ä¸è¬ççåºç¨ï¼æ¯æç¶æçåºç¨ï¼éè¦æç¨³å®çç½ç»æ è¯ï¼æä»¥ä¼ä¸ºæ¯ä¸ä¸ªPodä¹åå»ºä¸ä¸ªååï¼æ ¼å¼æ¯ï¼<podName>.<serviceName>.<namesapce>.svc.cluster.localã\n\næä»¬è¿å¥podä¸­éªè¯ä¸ä¸ï¼éè¿ping redis-sts-1.redis-svc.zwf.svc.cluster.localåç°æ¯å¯ä»¥pingéçï¼è½ç¶PodçIPä¼ååï¼ä½æ¯éè¿åºå®çååå°±è½è®¿é®å°æå®Podäºã\n\n[root@k8s-worker1 zwf]# kubectl exec -it redis-sts-0 -n zwf -- ping redis-sts-1.redis-svc.zwf.svc.cluster.local\nPING redis-sts-1.redis-svc.zwf.svc.cluster.local (10.222.126.51) 56(84) bytes of data.\n64 bytes from redis-sts-1.redis-svc.zwf.svc.cluster.local (10.222.126.51): icmp_seq=1 ttl=62 time=0.964 ms\n64 bytes from redis-sts-1.redis-svc.zwf.svc.cluster.local (10.222.126.51): icmp_seq=2 ttl=62 time=0.932 ms\n\n\n1\n2\n3\n4\n\n\næ¢ç¶æä»¬çpodæäºç¨³å®çç½ç»æ è¯ï¼Serviceä¹å°±ä¸éè¦ååéClusterIPäºï¼è¿ä¸ªæ¶åï¼åªéè¦æ·»å å­æ®µclusterIP: Noneï¼è¿æ ·å°±ä¸ä¼ååéIPäºï¼è¿æ ·çServiceç§°ä¸ºHeadless Service\n\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: redis-svc\n\nspec:\n  clusterIP: None\n  selector:\n    app: redis-sts\n\n  ports:\n  - port: 6379\n    protocol: TCP\n    targetPort: 6379\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nåå»ºHeadless Serviceï¼å¯ä»¥çå°CLUSTER-IPä¸ºNone\n\n[root@k8s-worker1 zwf]# kubectl get svc -n zwf\nNAME                   TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE\ndemoapp-nodeport-svc   NodePort    10.0.0.144   <none>        80:31999/TCP   21h\ndemoapp-svc            ClusterIP   10.0.0.74    <none>        80/TCP         22h\nredis-svc              ClusterIP   None         <none>        6379/TCP       4s\n\n\n1\n2\n3\n4\n5\n\n\nServiceåStatefulSetéç½®å¾å¦ä¸ï¼\n\n\n\n\n# æä¹åéç½®\n\næ¥ä¸æ¥æ¯ç»StatefulSetå¯¹è±¡æ·»å æä¹åéç½®ã\n\nå®ä¹StatefulSetæè¿°å¦ä¸ï¼\n\n\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: redis-pv-sts\n\nspec:\n  serviceName: redis-pv-svc\n\n  volumeClaimTemplates:\n  - metadata:\n      name: redis-100m-pvc\n    spec:\n      storageClassName: nfs-client\n      accessModes:\n        - ReadWriteMany\n      resources:\n        requests:\n          storage: 100Mi\n\n  replicas: 2\n  selector:\n    matchLabels:\n      app: redis-pv-sts\n\n  template:\n    metadata:\n      labels:\n        app: redis-pv-sts\n    spec:\n      containers:\n      - image: redis:5-alpine\n        name: redis\n\n        volumeMounts:\n        - name: redis-100m-pvc\n          mountPath: /data\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\nåæ°ï¼\n\n * volumeClaimTemplatesï¼ç¨æ¥å°PVCçå®ä¹åµå¥å°StatefulSetä¸­çå­æ®µï¼æ¯åå»ºPVCçæ¨¡æ¿ï¼å¯ä»¥è®©æ¯ä¸ä¸ªPodé½è½èªå¨åå»ºPVC\n * voulumeMountsï¼æ¯ç¨æ¥éæ©ä¸é¢çPVCæè½½å¨å®¹å¨ç/dataç®å½ä¸­\n\nåå»ºStatefulSetå¯¹è±¡ï¼å¯ä»¥çå°podå·²ç»åå»ºèµ·æ¥äºã\n\n[root@k8s-worker1 zwf]# kubectl apply -f statefulset_pvc.yaml -n zwf\nstatefulset.apps/redis-pv-sts created\n\n[root@k8s-worker1 zwf]# kubectl get sts -n zwf\nNAME           READY   AGE\nredis-pv-sts   2/2     25\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf\nNAME             READY   STATUS    RESTARTS   AGE\nredis-pv-sts-0   1/1     Running   0          63s\nredis-pv-sts-1   1/1     Running   0          54s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\næä»¬æ¥çpvcï¼ä¼åç°åå»ºäº2ä¸ªå¯¹è±¡ ï¼ä»¥PVCåç§°-podåç§°å½åã\n\n[root@k8s-worker1 zwf]# kubectl get pvc -n zwf\nNAME                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nredis-100m-pvc-redis-pv-sts-0   Bound    pvc-2712daa4-36b4-4a63-ac2f-7d3b31e2a887   100Mi      RWX            nfs-client     109s\nredis-100m-pvc-redis-pv-sts-1   Bound    pvc-a3781354-e182-42f7-b6f6-983999603653   100Mi      RWX            nfs-client     100s\n\n\n1\n2\n3\n4\n\n\nè¿å¥å°podä¸­ï¼ä½¿ç¨redis-cliè¿è¡rediså®¢æ·ç«¯ï¼æ·»å ä¸äºæ°æ®\n\n[root@k8s-worker1 zwf]# kubectl exec -it redis-pv-sts-0 -n zwf /bin/bash\n[ root@redis-pv-sts-0:/data ]$ redis-cli  \n127.0.0.1:6379> set name zhangsan\nOK\n127.0.0.1:6379> set age 18\nOK\n127.0.0.1:6379> keys *\n1) "name"\n2) "age"\n127.0.0.1:6379> quit\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå°podå é¤ï¼ç¶ååéæ°è¿å¥Podä¸­ï¼æ¥è¯¢ä¹ååå»ºçredisçkeyï¼è¿æ¯è½å¤æ¥è¯¢å°ã\n\n[root@k8s-worker1 zwf]# kubectl exec -it redis-pv-sts-0  -n zwf -- /bin/bash\n[ root@redis-pv-sts-0:/data ]$ redis-cli  \n127.0.0.1:6379> keys *\n1) "name"\n2) "age"\n127.0.0.1:6379> get name\n"zhangsan"\n127.0.0.1:6379> get age\n"18"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\néç½®çå³ç³»å¾å¦ä¸ï¼\n\n',normalizedContent:'# ä»ä¹æ¯statefulset?\n\næ¯ç¨æ¥åå»ºæç¶æåºç¨ï¼å¯ä»¥éè¿è¿æç§æ¹å¼è®°å½è¿äºç¶æï¼ç¶åå¨ pod è¢«éæ°åå»ºæ¶ï¼è½å¤ä¸ºæ° pod æ¢å¤è¿äºç¶æã\n\nä»ä¹æ¯æç¶æåºç¨ï¼\n\né¦åæ¯éè¦ææ°æ®çæä¹åï¼å³ä½¿podè¢«éå¯åï¼ä¹è½æ¢å¤ï¼ä¸éå¯åä¿æä¸è´ãç¶åæ¯åºç¨åå»ºçææpodæä¾èµå³ç³»ï¼é¡ºåºçåå»ºãéè¦è¿è¡å¨æå®çå®¿ä¸»æºä¸ï¼å¹¶ä¸é½æå¯¹åºçç½ç»æ å¿ã\n\nåºç¨åºæ¯ï¼\n\nåå¸å¼åºç¨ï¼å®çå¤ä¸ªå®ä¾ä¹é´ï¼å¾å¾æä¾èµå³ç³»ï¼æ¯å¦ï¼ä¸»ä»å³ç³»ãä¸»å¤å³ç³»ã\n\n\n# ä½¿ç¨statefulset\n\n\n# åå»ºstatefulset\n\nåå»ºyamlæä»¶å®ä¹statefulsetå¯¹è±¡å¦ä¸ï¼ä¸deploymentæ¯è¾ï¼å¤äºä¸ä¸ªservicenameå­æ®µï¼è¿ä¸ªæ¯ç¨æ¥æå®statefulsetæç®¡ççpodæ¯ç¨ååè®¿é®æ¯éè¿è¯¥serviceæè®¾å®çã\n\n\napiversion: apps/v1\nkind: statefulset\nmetadata:\n  name: redis-sts\n\nspec:\n  servicename: redis-svc\n  replicas: 2\n  selector:\n    matchlabels:\n      app: redis-sts\n\n  template:\n    metadata:\n      labels:\n        app: redis-sts\n    spec:\n      containers:\n      - image: redis\n        name: redis\n        ports:\n        - containerport: 6379\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nåå»ºstatefulsetå¯¹è±¡\n\n[root@k8s-worker1 zwf]# kubectl apply -f statefulset.yaml  -n zwf\nstatefulset.apps/redis-sts created\n\n[root@k8s-worker1 zwf]# kubectl get sts -n zwf\nname        ready   age\nredis-sts   2/2     54s\n\n\n1\n2\n3\n4\n5\n6\n\n\næ¥çåå»ºçpodä¼åç°ï¼å½åä¸åæ¯éæºåå»ºçåå­ï¼èæ¯æäºé¡ºåºå·ï¼ä»0å¼å§ï¼èk8sä¹ä¼æç§è¿ä¸ªé¡ºåºä¸æ¬¡åå»ºã\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf\nname          ready   status    restarts   age\nredis-sts-0   1/1     running   0          61s\nredis-sts-1   1/1     running   0          54s\n\n\n1\n2\n3\n4\n\n\nè¾åºpodä¸­çhostnameåç°ä¸podçåç§°ä¹ä¿æä¸è´ï¼ä¹å°±æ¯åºç¨å¯ä»¥èªè¡å³å®ä¾èµå³ç³»ï¼æ¯å¦è¯¥ä¾å­ä¸­å¯ä»¥ä½¿ç¨0å·podä½ä¸ºä¸»å®ä¾ï¼è1å·podä½ä¸ºä»å®ä¾ã\n\n[root@k8s-worker1 zwf]# kubectl exec -it redis-sts-0 -n zwf -- hostname\nredis-sts-0\n\n\n1\n2\n\n\n\n# serviceéç½®\n\nå®ä¹å¹éä¸é¢çåå»ºstatefulsetå¯¹è±¡ææç®¡ççserviceï¼ä¹å°±æ¯æ ç­¾ç­ééè¦åpodçæ ç­¾ä¿æä¸è´ï¼å¹¶ä¸è¿éçmetadata.nameä¹è¦ä¸statefulsetä¸­çservicenameä¸æ ·ã\n\n\napiversion: v1\nkind: service\nmetadata:\n  name: redis-svc\n\nspec:\n  selector:\n    app: redis-sts\n\n  ports:\n  - port: 6379\n    protocol: tcp\n    targetport: 6379\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nåå»ºserviceå¯¹è±¡ï¼æä»¬å¯ä»¥çå°å·²ç»å°statefulsetæåå»ºçpodå å¥å°ç«¯ç¹åè¡¨äºï¼ä¹å°±æ¯å¯ä»¥ç¨³å®çéè¿serviceæ¥è®¿é®å°pod\n\n[root@k8s-worker1 zwf]# kubectl apply -f service_statefulset.yaml -n zwf\nkservice/redis-svc created\n\n[root@k8s-worker1 zwf]# kubectl get svc -n zwf\nname                   type        cluster-ip   external-ip   port(s)        age\nredis-svc              clusterip   10.0.0.246   <none>        6379/tcp       5s\n\n[root@k8s-worker1 zwf]# kubectl describe svc redis-svc -n zwf\nname:              redis-svc\nnamespace:         zwf\nlabels:            <none>\nannotations:       <none>\nselector:          app=redis-sts\ntype:              clusterip\nip family policy:  singlestack\nip families:       ipv4\nip:                10.0.0.246\nips:               10.0.0.246\nport:              <unset>  6379/tcp\ntargetport:        6379/tcp\nendpoints:         10.222.126.51:6379,10.222.194.84:6379\nsession affinity:  none\nevents:            <none>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nä½æ¯æä»¬çpodä¸æ¯ä¸è¬ççåºç¨ï¼æ¯æç¶æçåºç¨ï¼éè¦æç¨³å®çç½ç»æ è¯ï¼æä»¥ä¼ä¸ºæ¯ä¸ä¸ªpodä¹åå»ºä¸ä¸ªååï¼æ ¼å¼æ¯ï¼<podname>.<servicename>.<namesapce>.svc.cluster.localã\n\næä»¬è¿å¥podä¸­éªè¯ä¸ä¸ï¼éè¿ping redis-sts-1.redis-svc.zwf.svc.cluster.localåç°æ¯å¯ä»¥pingéçï¼è½ç¶podçipä¼ååï¼ä½æ¯éè¿åºå®çååå°±è½è®¿é®å°æå®podäºã\n\n[root@k8s-worker1 zwf]# kubectl exec -it redis-sts-0 -n zwf -- ping redis-sts-1.redis-svc.zwf.svc.cluster.local\nping redis-sts-1.redis-svc.zwf.svc.cluster.local (10.222.126.51) 56(84) bytes of data.\n64 bytes from redis-sts-1.redis-svc.zwf.svc.cluster.local (10.222.126.51): icmp_seq=1 ttl=62 time=0.964 ms\n64 bytes from redis-sts-1.redis-svc.zwf.svc.cluster.local (10.222.126.51): icmp_seq=2 ttl=62 time=0.932 ms\n\n\n1\n2\n3\n4\n\n\næ¢ç¶æä»¬çpodæäºç¨³å®çç½ç»æ è¯ï¼serviceä¹å°±ä¸éè¦ååéclusteripäºï¼è¿ä¸ªæ¶åï¼åªéè¦æ·»å å­æ®µclusterip: noneï¼è¿æ ·å°±ä¸ä¼ååéipäºï¼è¿æ ·çserviceç§°ä¸ºheadless service\n\n\napiversion: v1\nkind: service\nmetadata:\n  name: redis-svc\n\nspec:\n  clusterip: none\n  selector:\n    app: redis-sts\n\n  ports:\n  - port: 6379\n    protocol: tcp\n    targetport: 6379\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nåå»ºheadless serviceï¼å¯ä»¥çå°cluster-ipä¸ºnone\n\n[root@k8s-worker1 zwf]# kubectl get svc -n zwf\nname                   type        cluster-ip   external-ip   port(s)        age\ndemoapp-nodeport-svc   nodeport    10.0.0.144   <none>        80:31999/tcp   21h\ndemoapp-svc            clusterip   10.0.0.74    <none>        80/tcp         22h\nredis-svc              clusterip   none         <none>        6379/tcp       4s\n\n\n1\n2\n3\n4\n5\n\n\nserviceåstatefulsetéç½®å¾å¦ä¸ï¼\n\n\n\n\n# æä¹åéç½®\n\næ¥ä¸æ¥æ¯ç»statefulsetå¯¹è±¡æ·»å æä¹åéç½®ã\n\nå®ä¹statefulsetæè¿°å¦ä¸ï¼\n\n\napiversion: apps/v1\nkind: statefulset\nmetadata:\n  name: redis-pv-sts\n\nspec:\n  servicename: redis-pv-svc\n\n  volumeclaimtemplates:\n  - metadata:\n      name: redis-100m-pvc\n    spec:\n      storageclassname: nfs-client\n      accessmodes:\n        - readwritemany\n      resources:\n        requests:\n          storage: 100mi\n\n  replicas: 2\n  selector:\n    matchlabels:\n      app: redis-pv-sts\n\n  template:\n    metadata:\n      labels:\n        app: redis-pv-sts\n    spec:\n      containers:\n      - image: redis:5-alpine\n        name: redis\n\n        volumemounts:\n        - name: redis-100m-pvc\n          mountpath: /data\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\nåæ°ï¼\n\n * volumeclaimtemplatesï¼ç¨æ¥å°pvcçå®ä¹åµå¥å°statefulsetä¸­çå­æ®µï¼æ¯åå»ºpvcçæ¨¡æ¿ï¼å¯ä»¥è®©æ¯ä¸ä¸ªpodé½è½èªå¨åå»ºpvc\n * voulumemountsï¼æ¯ç¨æ¥éæ©ä¸é¢çpvcæè½½å¨å®¹å¨ç/dataç®å½ä¸­\n\nåå»ºstatefulsetå¯¹è±¡ï¼å¯ä»¥çå°podå·²ç»åå»ºèµ·æ¥äºã\n\n[root@k8s-worker1 zwf]# kubectl apply -f statefulset_pvc.yaml -n zwf\nstatefulset.apps/redis-pv-sts created\n\n[root@k8s-worker1 zwf]# kubectl get sts -n zwf\nname           ready   age\nredis-pv-sts   2/2     25\n\n[root@k8s-worker1 zwf]# kubectl get pods -n zwf\nname             ready   status    restarts   age\nredis-pv-sts-0   1/1     running   0          63s\nredis-pv-sts-1   1/1     running   0          54s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\næä»¬æ¥çpvcï¼ä¼åç°åå»ºäº2ä¸ªå¯¹è±¡ ï¼ä»¥pvcåç§°-podåç§°å½åã\n\n[root@k8s-worker1 zwf]# kubectl get pvc -n zwf\nname                            status   volume                                     capacity   access modes   storageclass   age\nredis-100m-pvc-redis-pv-sts-0   bound    pvc-2712daa4-36b4-4a63-ac2f-7d3b31e2a887   100mi      rwx            nfs-client     109s\nredis-100m-pvc-redis-pv-sts-1   bound    pvc-a3781354-e182-42f7-b6f6-983999603653   100mi      rwx            nfs-client     100s\n\n\n1\n2\n3\n4\n\n\nè¿å¥å°podä¸­ï¼ä½¿ç¨redis-cliè¿è¡rediså®¢æ·ç«¯ï¼æ·»å ä¸äºæ°æ®\n\n[root@k8s-worker1 zwf]# kubectl exec -it redis-pv-sts-0 -n zwf /bin/bash\n[ root@redis-pv-sts-0:/data ]$ redis-cli  \n127.0.0.1:6379> set name zhangsan\nok\n127.0.0.1:6379> set age 18\nok\n127.0.0.1:6379> keys *\n1) "name"\n2) "age"\n127.0.0.1:6379> quit\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå°podå é¤ï¼ç¶ååéæ°è¿å¥podä¸­ï¼æ¥è¯¢ä¹ååå»ºçredisçkeyï¼è¿æ¯è½å¤æ¥è¯¢å°ã\n\n[root@k8s-worker1 zwf]# kubectl exec -it redis-pv-sts-0  -n zwf -- /bin/bash\n[ root@redis-pv-sts-0:/data ]$ redis-cli  \n127.0.0.1:6379> keys *\n1) "name"\n2) "age"\n127.0.0.1:6379> get name\n"zhangsan"\n127.0.0.1:6379> get age\n"18"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\néç½®çå³ç³»å¾å¦ä¸ï¼\n\n',charsets:{cjk:!0},lastUpdated:"2023/01/15, 20:17:10",lastUpdatedTimestamp:167378503e4},{title:"dockerå®¹å¨",frontmatter:{title:"dockerå®¹å¨",date:"2022-08-10T00:11:29.000Z",permalink:"/pages/39f36e/",tags:["docker","äºåç","å®¹å¨"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ç®ä»dockeråå¶ä½¿ç¨æ¹æ³",feed:{enable:!0},categories:["äºåç","docker"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220705193057.png"},{name:"twitter:title",content:"dockerå®¹å¨"},{name:"twitter:description",content:"ç®ä»dockeråå¶ä½¿ç¨æ¹æ³"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220705193057.png"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/06.docker/02.docker%E5%AE%B9%E5%99%A8.html"},{property:"og:type",content:"article"},{property:"og:title",content:"dockerå®¹å¨"},{property:"og:description",content:"ç®ä»dockeråå¶ä½¿ç¨æ¹æ³"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220705193057.png"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/06.docker/02.docker%E5%AE%B9%E5%99%A8.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:11:29.000Z"},{property:"article:tag",content:"docker"},{property:"article:tag",content:"äºåç"},{property:"article:tag",content:"å®¹å¨"},{itemprop:"name",content:"dockerå®¹å¨"},{itemprop:"description",content:"ç®ä»dockeråå¶ä½¿ç¨æ¹æ³"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220705193057.png"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/06.docker/02.docker%E5%AE%B9%E5%99%A8.html",relativePath:"01.äºåç/06.docker/02.dockerå®¹å¨.md",key:"v-77369d13",path:"/pages/39f36e/",headers:[{level:2,title:"å®¹å¨æ¯ä»ä¹ï¼",slug:"å®¹å¨æ¯ä»ä¹",normalizedTitle:"å®¹å¨æ¯ä»ä¹ï¼",charIndex:15},{level:2,title:"ä¸ºä»ä¹è¦éç¦»?",slug:"ä¸ºä»ä¹è¦éç¦»",normalizedTitle:"ä¸ºä»ä¹è¦éç¦»?",charIndex:42},{level:2,title:"åèææºçåºå«æ¯ä»ä¹?",slug:"åèææºçåºå«æ¯ä»ä¹",normalizedTitle:"åèææºçåºå«æ¯ä»ä¹?",charIndex:100},{level:2,title:"ä»ä¹æ¯å®¹å¨ååºç¨ï¼",slug:"ä»ä¹æ¯å®¹å¨ååºç¨",normalizedTitle:"ä»ä¹æ¯å®¹å¨ååºç¨ï¼",charIndex:606},{level:2,title:"dockeræ¶æ",slug:"dockeræ¶æ",normalizedTitle:"dockeræ¶æ",charIndex:840},{level:2,title:"å¸¸ç¨éåæä½",slug:"å¸¸ç¨éåæä½",normalizedTitle:"å¸¸ç¨éåæä½",charIndex:1054},{level:2,title:"å¸¸ç¨å®¹å¨æä½",slug:"å¸¸ç¨å®¹å¨æä½",normalizedTitle:"å¸¸ç¨å®¹å¨æä½",charIndex:1164},{level:2,title:"å®¹å¨éå",slug:"å®¹å¨éå",normalizedTitle:"å®¹å¨éå",charIndex:2093},{level:3,title:"éååé¨æºå¶",slug:"éååé¨æºå¶",normalizedTitle:"éååé¨æºå¶",charIndex:2102},{level:2,title:"Dockerfile",slug:"dockerfile",normalizedTitle:"dockerfile",charIndex:5229},{level:2,title:"å®¹å¨ä¸å¤é¨çäº¤äº",slug:"å®¹å¨ä¸å¤é¨çäº¤äº",normalizedTitle:"å®¹å¨ä¸å¤é¨çäº¤äº",charIndex:5781},{level:2,title:"å³äºk8sä¸dockerçå³ç³»",slug:"å³äºk8sä¸dockerçå³ç³»",normalizedTitle:"å³äºk8sä¸dockerçå³ç³»",charIndex:6584}],headersStr:"å®¹å¨æ¯ä»ä¹ï¼ ä¸ºä»ä¹è¦éç¦»? åèææºçåºå«æ¯ä»ä¹? ä»ä¹æ¯å®¹å¨ååºç¨ï¼ dockeræ¶æ å¸¸ç¨éåæä½ å¸¸ç¨å®¹å¨æä½ å®¹å¨éå éååé¨æºå¶ Dockerfile å®¹å¨ä¸å¤é¨çäº¤äº å³äºk8sä¸dockerçå³ç³»",content:'# dockerå®¹å¨\n\n\n# å®¹å¨æ¯ä»ä¹ï¼\n\nå®¹å¨ï¼å°±æ¯ä¸ä¸ªè¢«éç¦»çè¿ç¨ã\n\n\n# ä¸ºä»ä¹è¦éç¦»?\n\n 1. å°åºç¨ç¨åºä¸å¤çç³»ç»éç¦»ï¼ä¿è¯å®¹å¨å¤ç³»ç»å®å¨\n 2. èµæºéç¦»ï¼åªè½ä½¿ç¨æå®éé¢\n\n\n# åèææºçåºå«æ¯ä»ä¹?\n\nèææºï¼èæçæ¯ç¡¬ä»¶ï¼éè¦å¨ä¸é¢å®è£æä½ç³»ç»æè½è¿è¡åºç¨ç¨åºã\n\nå®¹å¨ï¼å±äº«ä¸å±çç¡¬ä»¶åæä½ç³»ç»ã\n\nä¸å¾æ¯å®æ¹çå¾\n\n\n\nå¶å®ä¸å¾å³äºå®¹å¨çé¨åå¹¶ä¸åç¡®ï¼APPä¹å°±æ¯å®¹å¨å¹¶ä¸æ¯è¿è¡å¨Dockerä¸çï¼Dockeråªæ¯å¨å¸®å©ç¨æ·åå»ºè¿ç¨æ¶æ·»å äºåç§Namespaceåæ°ï¼å®¹å¨æ¯ç¹æ®çè¿ç¨ï¼è¿æ¯è¿è¡å¨æä½ç³»ç»ä¸çã\n\n      å®ç°æ¹å¼             ä¼å¿             å£å¿\nèææº   èæåç¡¬ä»¶            éç¦»ç¨åº¦éå¸¸é«        èµæºæ¶èå¤§ï¼å¯å¨æ¢\nå®¹å¨    ç´æ¥å©ç¨ä¸å±çç¡¬ä»¶åæä½ç³»ç»   èµæºå©ç¨çé«ï¼è¿è¡éåº¦å¿«   éç¦»ç¨åº¦ä½, å®å¨æ§ä½\n\n 1. èææºæ¯ç¡¬ä»¶çº§å«çéç¦»ï¼èå®¹å¨åæ¯è¿ç¨é´çéç¦»ã\n\n 2. èæåéè¦æ¨¡æç¡¬ä»¶å ç¨é¨ååå­ï¼å¹¶ä¸å¯¹å®¿ä¸»æºæä½çç³»ç»è°ç¨éè¦ç»è¿èæåè½¯ä»¶çæ¦æªä¸è½¬æ¢ï¼é æèµæºçå¼éãèå®¹å¨å°±æ¯ä¸ä¸ªæ®éçè¿ç¨ï¼åºæ¬æ é¢å¤çè®¡ç®èµæºçå¼éã\n\n 3. å¨Linuxåæ ¸ä¸­æé¨åçèµæºåå¯¹è±¡æ æ³namespaceåï¼å¦æ¶é´ã\n\n 4. å ä¸ºå®¹å¨æ¯å±äº«å®¿ä¸»æºåæ ¸ï¼æä»¥å¯¹å¤æ´é²çä¾ç»é¢éå¸¸çå¤§ã\n\n\n# ä»ä¹æ¯å®¹å¨ååºç¨ï¼\n\néåï¼å°±æ¯å°å®¹å¨çåå§åç¯å¢åºåä¸æ¥ï¼å°è¿è¡è¿ç¨æéè¦çæä»¶ç³»ç»ãä¾èµåºãç¯å¢åéãå¯å¨åæ°ç­æåæ´åå°ä¸èµ·ï¼ä¿å­æä¸ä¸ªéæçæä»¶ã\n\nå®¹å¨åç¯å¢å¯ä»¥éè¿éåå¿«ééå»ºå®¹å¨ï¼åºç¨ç¨åºçå°çå°±æ¯ä¸è´çè¿è¡ç¯å¢ã\n\nå®¹å¨ååºç¨ï¼ä¹å°±æ¯åºç¨ç¨åºä¸ç´æ¥ä¸æä½ç³»ç»å»æäº¤éï¼èæ¯å°åºç¨ç¨åºæåæéåï¼åäº¤ç»å®¹å¨ç¯å¢å»è¿è¡\n\néåä¸å®¹å¨çå³ç³»è¿å¯ä»¥ç¨"åºåå"å"ååºåå"æ¥çè§£ï¼éåå°±æ¯åºååå°ç£ççæ°æ®ï¼èå®¹å¨æ¯ååºååååå­ä¸­çå¯¹è±¡ã\n\n\n\n\n\n\n# dockeræ¶æ\n\nåå»ºå®¹å¨æ¶ï¼æä»¬éè¿dockerå½ä»¤è¯·æ±Docker Daemonæå¡ï¼ç¶åè¯¥æå¡åéè¿RPCè¯·æ±Containerdè¿ç¨ï¼è¯¥è¿ç¨ä¼åå»ºContainerd-shimè¿ç¨ï¼è¯¥è¿ç¨ä¼ååå»ºRunCè¿ç¨ï¼è¯¥è¿ç¨æ¯çæ­£åå»ºå®¹å¨çæ¯è¿ç¨ï¼ç­å®¹å¨åå»ºå¥½åï¼RunCä¼éåºï¼å®¹å¨çç¶è¿ç¨ä¼åæContainerd-shimï¼å½å®¹å¨ç»ææ¶ï¼Conatinerd-shimä¼åæ¶å®¹å¨è¿ç¨çèµæºï¼ä»¥é²æ­¢åµå°¸è¿ç¨ã\n\n\n\n\n# å¸¸ç¨éåæä½\n\nå½ä»¤              ä½ç¨\ndocker pull     ä»è¿ç«¯ä»åºæåéå\ndocker images   ååºå½åæ¬å°å·²æéå\ndocker rmi      å é¤ä¸åä½¿ç¨çéå\n\n\n# å¸¸ç¨å®¹å¨æä½\n\nå½ä»¤              ä½ç¨            ä¾å­\ndocker run      ä½¿ç¨éåå¯å¨å®¹å¨      \ndocker ps       ååºæ­£å¨è¿è¡çå®¹å¨     \ndocker exec     å¨å®¹å¨åæ§è¡å¦ä¸ä¸ªç¨åº   \ndocker stop     åæ­¢å®¹å¨          \ndocker start    å°åæ­¢çå®¹å¨åæ¬¡å¯å¨    \ndocker rm       å é¤å®¹å¨          \ndocker export   å°å®¹å¨åçæä»¶ç³»ç»å¯¼åº   docker export -o rootfs.tar å®¹å¨ID\n\nå®¹å¨è¢«åæ­¢åï¼docker pså½ä»¤å°±çä¸å°è¯¥å®¹å¨äºï¼éè¦ä½¿ç¨docker ps -aæ¥æ¥çææå®¹å¨ï¼åæ¬å·²ç»åæ­¢çå®¹å¨ã\n\nå¯è½ä¼å¯¼è´éå¸¸å¤å·²ç»åæ­¢çå®¹å¨å ç¨ç³»ç»èµæºï¼æä»¥å»ºè®®docker runæ¶æ·»å --rmåæ°ï¼å¨å®¹å¨è¿è¡å®æ¯æ¶èªå¨æ¸é¤\n\ndocker execæ¯å¦ä½è¿å¥å°å®¹å¨ä¸­ç?\n\nè¯¥å½ä»¤ä¼åå»ºä¸ä¸ªæ°çè¿ç¨å å¥å°å®¹å¨çnamepsaceä¸­ã\n\n/proc/{è¿ç¨ID}/ns/ä¸çèææä»¶ä¼é¾æ¥å°çå®çNamespaceæä»¶ä¸ãéè¿æ¥çexecåå»ºçè¿ç¨nsæä»¶å¯ä»¥çåºåå®¹å¨çNamespaceæä»¶ä¸è´\n\n[root@k8s-master proc]# ll /proc/288948/ns/pid\nlrwxrwxrwx 1 root root 0 Jul  8 11:27 /proc/288948/ns/pid -> \'pid:[4026532247]\'\n\n[root@k8s-master proc]# ll /proc/289220/ns/pid\nlrwxrwxrwx 1 root root 0 Jul  8 11:27 /proc/289220/ns/pid -> \'pid:[4026532247]\'\n\n\n1\n2\n3\n4\n5\n\n\ndocker runådocker execçåºå«æ¯ä»ä¹?\n\nrunæ¯å°éåè¿è¡æå®¹å¨å¹¶æ§è¡å½ä»¤ï¼è¯¥å½ä»¤ä¸º1å·è¿ç¨ã\n\nexecæ¯å¨å®¹å¨ä¸­æ§è¡ä¸ä¸ªå½ä»¤ï¼è¯¥å½ä»¤æ¯å¦ä¸ä¸ªè¿ç¨ï¼å å¥å°äºå®¹å¨çnamespaceä¸­ã\n\n\n# å®¹å¨éå\n\n\n# éååé¨æºå¶\n\nå®¹å¨éååé¨æ¯ç±è®¸å¤çéåå±(Layer)ç»æçï¼æ¯å±é½æ¯åªè¯»ä¸å¯ä¿®æ¹çä¸ç»æä»¶ï¼ç¸åçå±å¯ä»¥å¨éåä¸­å±äº«ï¼ç¶åå¤ä¸ªå±åæ­ç§¯æ¨å å èµ·æ¥ï¼ä½¿ç¨**èåæä»¶ç³»ç»ï¼UnionFS)**å°å®ä»¬åå¹¶èµ·æ¥ï¼æç»å½¢æå®¹å¨çå°çæä»¶ç³»ç»ã\n\néåä¸­çå±çº§æ¯åªè¯»å±ï¼èå®¹å¨æå¨çå±çº§æ¯å¯è¯»åå±ã\n\n\n\néåçåå±ä¿¡æ¯å¯ä»¥éè¿å½ä»¤docker inspect éååç§°è·åï¼å¶ä¸­RootFsæ¯å¯¹åºçä¿¡æ¯\n\n>>> docker inspect b3log/siyuan\n\n.....\n"RootFS": {\n            "Type": "layers",\n            "Layers": [\n                "sha256:24302eb7d9085da80f016e7e4ae55417e412fb7e0a8021e95e3b60c67cde557d",\n                "sha256:e7356c89d8c31fc628769b331f73d6e036e1d5900d2d2a3990c89ef91bce707a",\n                "sha256:90358380b9ea63cfb8832ae627455faf85596e822ff8abe9e1d7c8bbd93804ad",\n                "sha256:c6d8ffacc07d179562cd70114402e549d9fce92b12a019d3f4003eb94944d089"\n            ]\n        }\n....\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nå¥½å¤æ¯ï¼å¦æå¤ä¸ªéåä½¿ç¨äºç¸åçå±ï¼å¯ä»¥ç´æ¥å±äº«ï¼åå°ç£çç©ºé´çå ç¨ãæ¯å¦nginxéååTomcatéåé½æ¯ç¨äºåºç¡éåcentosï¼é£ä¹è¯¥åºç¡éåå¯ä»¥å±äº«ã\n\n\n\nOverlayFS\n\néåå±åå®¹å¨æ¯å¦ä½åå¹¶çå¢ï¼\n\n\n\nlowerdiræ¯éåå±ï¼upperdiræ¯å®¹å¨å±ï¼å¦æåæ¹æç¸åæä»¶åå±ç¤ºå®¹å¨å±çæä»¶ã\n\nå¨å®¹å¨åæä»¶æ¶ï¼ä¼åä»éåå±æ·è´ä¸ä»½æä»¶å°å®¹å¨å±ï¼ç¶åååå¥ï¼ä½¿ç¨çæ¯**åæ¶å¤å¶(copy on write)**ç­ç¥\n\nä¾å­\n\noverlay2\nâââ lowerdirA\nâ   âââ a     åå®¹ï¼AA\nâ   âââ b     åå®¹ï¼AA\nâââ lowerdirB\nâ   âââ a     åå®¹: BB\nâââ merge\nâââ upper\nâââ work\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ§è¡ä»¥ä¸å½ä»¤ä½¿ç¨overlayè¿è¡åå¹¶å±\n\nmount -t overlay overlay -o lowerdir=lowerdirA:lowerdirB,upperdir=upper,workdir=work merge\n\n\n1\n\n\nlowerdirä¸ºéåå±ï¼upperdirä¸ºå®¹å¨å±ï¼mergeç®å½ä¸ºæç»å±ç¤ºå±ã\n\nå¯ä»¥çå°mergeç®å½ä¸­çaæä»¶åå®¹lowerdirAéåå±çåå®¹\n\n[root@iZwz93q4afq8ck02cesqh4Z k8s_learn]# cat merge/a \nAA\n\n\n1\n2\n\n\nå½æä»¬ä¿®æ¹megreç®å½ä¸­çaæä»¶æ¶ï¼å¯ä»¥çå°upperdirç®å½çä¼çæaæä»¶å¹¶ä¸åå®¹ä¿®æ¹åçåå®¹\n\n[root@iZwz93q4afq8ck02cesqh4Z k8s_learn]# ls upper/\n[root@iZwz93q4afq8ck02cesqh4Z k8s_learn]# echo upper > merge/a\n[root@iZwz93q4afq8ck02cesqh4Z k8s_learn]# ls upper/\na\n[root@iZwz93q4afq8ck02cesqh4Z k8s_learn]# cat upper/a\nupper\n[root@iZwz93q4afq8ck02cesqh4Z k8s_learn]# cat merge/a\nupper\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå½å é¤æä»¶merge/aæ¶ï¼ä¼åºç°ä»ä¹æåµå¢?\n\n[root@iZwz93q4afq8ck02cesqh4Z k8s_learn]# rm merge/a\nrm: remove regular file âmerge/aâ? y\n[root@iZwz93q4afq8ck02cesqh4Z k8s_learn]# ll lowerdirA/\ntotal 8\n-rw-r--r-- 1 root root 3 Jul 12 19:11 a\n-rw-r--r-- 1 root root 3 Jul 12 19:10 b\n[root@iZwz93q4afq8ck02cesqh4Z k8s_learn]# ll upper/\ntotal 0\nc--------- 1 root root 0, 0 Jul 12 19:31 a\n[root@iZwz93q4afq8ck02cesqh4Z k8s_learn]#\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå¯ä»¥çåºéåå±lowerdirAçæä»¶aæ¯ä¸åçï¼èå¨å®¹å¨å±upperä¸­çaæä»¶ç±»ååæäºcï¼è¯¥æä»¶ç±»åï¼æç»å¨å±ç¤ºå±çä¸å°è¯¥æä»¶äºã\n\nå¯ä»¥ä½¿ç¨å½ä»¤docker inspectæ¥æ¥çlayerçè·¯å¾\n\n>>> docker inspect xxx\n\n....\n"GraphDriver": {\n            "Data": {\n                "LowerDir": "/var/lib/docker/overlay2/641e486c54d15d2a8d807fd8964f4a4b8687cbcf95c176cd9a46553b1e80341d/diff:/var/lib/docker/overlay2/ed9ad4fb9d0f9bf3aea553c634e54fef89448cf43c5b662468d79f01cf41d0c3/diff:/var/lib/docker/overlay2/9db169e1ad2165f688e652ef06dfe9a3e465c31299f3c357a37a6919747efbc8/diff",\n                "MergedDir": "/var/lib/docker/overlay2/fa3166e545a2d1811dbeecb6f1fdda96b9f97b3cd629f32a8ea378aa79b1c780/merged",\n                "UpperDir": "/var/lib/docker/overlay2/fa3166e545a2d1811dbeecb6f1fdda96b9f97b3cd629f32a8ea378aa79b1c780/diff",\n                "WorkDir": "/var/lib/docker/overlay2/fa3166e545a2d1811dbeecb6f1fdda96b9f97b3cd629f32a8ea378aa79b1c780/work"\n            },\n            "Name": "overlay2"\n        },\n....\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# Dockerfile\n\nDockerfileæ¯ä¸ä¸ªç¨æ¥åå»ºéåçææ¬æä»¶ï¼è¯¥æä»¶ä¸­çæ¯ä¸æ¡å½ä»¤é½ä¼æçæä¸ä¸ªlayerã\n\nä¾å­ï¼\n\næç®åçDockerfileçä¾å­\n\nFROM busybox                  # éæ©åºç¡éå\nCMD echo "hello world"        # å¯å¨å®¹å¨æ¶é»è®¤è¿è¡çå½ä»¤\n\n\n1\n2\n\n\nFROMæä»¤æ¯æå»ºä½¿ç¨çåºç¡éå\n\nCMDæä»¤æ¯ç¨äºå¯å¨å®¹å¨æ¶é»è®¤è¿è¡çå½ä»¤\n\nä½¿ç¨docker build å³å¯æ§è¡åå»ºéå\n\ndocker build -f Dockerfile .\n\nSending build context to Docker daemon   7.68kB\nStep 1/2 : FROM busybox\n ---\x3e d38589532d97\nStep 2/2 : CMD echo "hello world"\n ---\x3e Running in c5a762edd1c8\nRemoving intermediate container c5a762edd1c8\n ---\x3e b61882f42db7\nSuccessfully built b61882f42db7\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# å®¹å¨ä¸å¤é¨çäº¤äº\n\nå¦ä½æ·è´å®¿ä¸»æºçæä»¶å°å®¹å¨å\n\nå¯ä»¥ä½¿ç¨docker cpå½ä»¤å°å®¿ä¸»æºçæä»¶æ·è´å°å®¹å¨ä¸­ã\n\ndocker cp a.txt 062:/tmp\n\n\n1\n\n\nå¶ä¸­ç062ä¸ºå®¹å¨IDï¼å¦ææ³å°å®¹å¨ä¸­çæä»¶æ·è´å°å®¿ä¸»æºä¸­ï¼åè¿æ¥å³å¯ã\n\ndocker cp 062:/tmp/a.txt /tmp\n\n\n1\n\n\næ³¨æï¼è¿éçæ·è´æ¯ä¸´æ¶çï¼æ·è´è¿å®¹å¨ä¸­çæä»¶åªå­å¨äºå®¹å¨ä¸­ï¼ä¸å­å¨ä¸éåä¸­ï¼å¦ææ³è¦å°æä»¶æ·è´å°éåä¸­ï¼å¨åDockerfileæ¶ä½¿ç¨copyå½ä»¤æ·è´å³å¯ã\n\nå®¿ä¸»æºä¸å®¹å¨å±äº«æä»¶å¤¹\n\nå¨ä½¿ç¨éåè¿è¡å®¹å¨æ¶ï¼ä½¿ç¨åæ°-vå¯ä»¥å°å®¿ä¸»æºä¸­çæä»¶å¤¹æ å°å°å®¹å¨ä¸­ï¼åæ¹ä¿®æ¹è¯¥æä»¶å¤¹ä¸­çåå®¹ï¼é½å¯ä»¥åæ¶çå°ã\n\ndocker run -d --rm -v /tmp:/tmp redis\n\n\n1\n\n\nå¦ä½å®ç°ç½ç»äºéï¼\n\ndockeræä¾ä¸ç§ç½ç»æ¨¡å¼ï¼\n\n * nullï¼æ ç½ç»\n * hostï¼ç´æ¥ä½¿ç¨å®¿ä¸»æºç½ç»ï¼å¨åå»ºå®¹å¨æ¶ï¼ä½¿ç¨--net=hoståæ°ã\n\nå¶å®å°±æ¯åå»ºæ°çnamespaceï¼èæ¯ç´æ¥å å¥å°å®¿ä¸»æºçnamesapce\n\ndocker run -d --rm --net=host nginx:alpine\n\n\n1\n\n * bridgeï¼æ¡¥æ¥æ¨¡å¼ï¼ç±è½¯ä»¶èæç½å¡ä¸ç½æ¡¥ï¼å®¹å¨åå®¿ä¸»æºé½æ¥å¥è¯¥ç½æ¡¥ï¼å³å¯æ­£å¸¸åéæ°æ®åãå¯ä»¥ä½¿ç¨åæ°--net=bridgeåå»ºå®¹å¨ï¼ä½è¿ä¸ªæ¯é»è®¤åæ°ã\n\ndocker run -d --rm nginx:alpine\n\n\n1\n\n\n\n\nç½ç»æ¨¡å¼     ä¼ç¹                        ç¼ºç¹\nhost     å ä¸ºæ¯ç´æ¥ä½¿ç¨å®¿ä¸»æºçç½ç»ï¼æçæ´é«        è¿è¡å¤ªå¤çå®¹å¨ï¼ä¼å¯¼è´ç«¯å£åçå²çª\nbridge   å ä¸ºæäºç½æ¡¥å¯ä»¥è®¾ç½®æ´å¤çç­ç¥ï¼æ¯å¦æµéæ§å¶ç­   éè¦è½¯ä»¶æ¨¡æèæç½å¡ä¸ç½æ¡¥ï¼æçæ´ä½\n\n\n\n\n\n\n# å³äºk8sä¸dockerçå³ç³»\n\nå¨2014å¹´çæ¶å,Dockerå¦æ¥ä¸­å¤©ï¼é£ä¹k8sèªç¶éæ©åºäºdockerä¸è¿è¡ã\n\nå¨2016å¹´k8så å¥äºCNCFï¼ä¸ä¸ªå¼æºçäºåçè®¡ç®åºéä¼ã\n\nå¹¶ä¸å¼å¥äºä¸ä¸ªæ¥å£æ åï¼CRIï¼Container Runtime Interfaceãä¹å°±æ¯è§å®kubeletè¯¥å¦ä½è°ç¨Container Runtimeå»ç®¡çå®¹å¨åéåï¼ä½è¿æ¯ä¸å¥å¨æ°çæ¥å£ï¼åä¹åçDockerå®å¨ä¸å¼å®¹ãç®çå¾ææ¾ï¼ä¸æ³ç»å®Dockerï¼å¯ä»¥éæ¶å°Dockerè¸¢æã\n\nå ä¸ºdockerå·²ç»éå¸¸æçï¼åå¤§ååä¸å¯è½å°Dockerå¨é¨æ¿æ¢ãæä»¥k8så¨kubeletåDockerä¸­é´å ä¸ä¸ª"ééå¨"ï¼æDockerçæ¥å£è½¬æ¢æç¬¦åCRIæ åçæ¥å£ã\n\n\n\nä»ä¹æ¯containerdï¼\n\nä¸è¿ Docker ä¹æ²¡æâåä»¥å¾æ¯âï¼èæ¯éåäºâæ­èæ±çâçç­ç¥ï¼æ¨å¨èªèº«çéæï¼æåæ¬åä½æ¶æç Docker Engine æåæäºå¤ä¸ªæ¨¡åï¼å¶ä¸­ç Docker daemon é¨åå°±æç®ç»äº CNCFï¼å½¢æäº containerdã\n\ncontainerd ä½ä¸º CNCF çæç®¡é¡¹ç®ï¼èªç¶æ¯è¦ç¬¦å CRI æ åçãä½ Docker åºäºèªå·±è¯¸å¤åå çèèï¼å®åªæ¯å¨ Docker Engine éè°ç¨äº containerdï¼å¤é¨çæ¥å£ä»ç¶ä¿æä¸åï¼ä¹å°±æ¯è¯´è¿ä¸ä¸ CRI å¼å®¹ã\n\nç±äº Docker çâåºæ§å·±è§âï¼è¿æ¶ Kubernetes éå°±åºç°äºä¸¤ç§è°ç¨é¾ï¼ç¬¬ä¸ç§æ¯ç¨ CRI æ¥å£è°ç¨ dockershimï¼ç¶å dockershim è°ç¨ Dockerï¼Docker åèµ° containerd å»æä½å®¹å¨ãç¬¬äºç§æ¯ç¨ CRI æ¥å£ç´æ¥è°ç¨ containerd å»æä½å®¹å¨ã\n\n\n\næ¾èæè§ï¼ä½¿ç¨ç¬¬äºç§çå»äºdockershimåDocker Engineä¸¤ä¸ªç¯èï¼æèæ´å°ï¼æ§è½ä¹æåäºã\n\næ­£å¼"å¼ç¨Docker"\n\nå¨2020å¹´K8så¼ç¨Dockeræ¯æï¼ä½è¯¥å¼ç¨æ¯æå¼ç¨äº"dockershim"çè¿ä¸ªç»ä»¶ï¼ä¹å°±æ¯ædockershimç§»åºkubeleteï¼åªæ¯ç»è¿Dockerï¼ç´æ¥è°ç¨äºDockeråé¨çcontainerdèå·²ã\n\nå¹¶ä¸å¯¹dockerä¹æ å½±åï¼å ä¸ºdockeråé¨ä¹æ¯ä½¿ç¨å¼æºçcontainerdã\n\n\n\nå¯ä¸å½±åçæ¯ï¼k8sæ¯ç´æ¥æä½containerdæä½å®¹å¨ï¼é£ä¹å®ådockeræ¯ç¬ç«çå·¥ä½ç¯å¢ï¼å½¼æ­¤é½ä¸è½è®¿é®å¯¹æ¹çå®¹å¨åéåï¼ä¹å°±æ¯docker psçä¸å°k8sè¿è¡çå®¹å¨ãæ¹ç¨crictlå½ä»¤ã\n\nDocker éæèªèº«ï¼åç¦»åº containerdï¼è¿æ¯å¦ç®æ¯ä¸ç§âèªæåå¢âçè¡ä¸ºå¢ï¼å¦ææ²¡æ containerdï¼é£ç°å¨çæå½¢ä¼æ¯æä¹æ ·çå¢ï¼\n\nDocker æ¯ä¸ä¸ªå®æ´çè½¯ä»¶äº§åçº¿ï¼ä¸æ­¢æ¯ containerdï¼å®è¿åæ¬äºéåæå»ºãååãæµè¯ç­è®¸å¤æå¡ï¼çè³å¨ Docker Desktop éè¿åç½®äº Kubernetesã\n\n> dockeråç¦»containerdæ¯ä¸ä¸ªå¾èªæçä¸¾å¨ï¼ä¸å¶å°æ¥è¢«äººåç¦»æèæå¼ä¸ç¨ï¼ä¸å¦æä¸»å¨é©æ°ï¼æKubernatesç»å¨æçæè½¦ä¸ï¼è¿æ ·criçç¬¬ä¸éæ©ä»ç¶æ¯dockerçèªå·±äººã\n> ä¸æ¶çéè®©æ¯ä¸ºäºæ´å¥½çå°æ¥ã',normalizedContent:'# dockerå®¹å¨\n\n\n# å®¹å¨æ¯ä»ä¹ï¼\n\nå®¹å¨ï¼å°±æ¯ä¸ä¸ªè¢«éç¦»çè¿ç¨ã\n\n\n# ä¸ºä»ä¹è¦éç¦»?\n\n 1. å°åºç¨ç¨åºä¸å¤çç³»ç»éç¦»ï¼ä¿è¯å®¹å¨å¤ç³»ç»å®å¨\n 2. èµæºéç¦»ï¼åªè½ä½¿ç¨æå®éé¢\n\n\n# åèææºçåºå«æ¯ä»ä¹?\n\nèææºï¼èæçæ¯ç¡¬ä»¶ï¼éè¦å¨ä¸é¢å®è£æä½ç³»ç»æè½è¿è¡åºç¨ç¨åºã\n\nå®¹å¨ï¼å±äº«ä¸å±çç¡¬ä»¶åæä½ç³»ç»ã\n\nä¸å¾æ¯å®æ¹çå¾\n\n\n\nå¶å®ä¸å¾å³äºå®¹å¨çé¨åå¹¶ä¸åç¡®ï¼appä¹å°±æ¯å®¹å¨å¹¶ä¸æ¯è¿è¡å¨dockerä¸çï¼dockeråªæ¯å¨å¸®å©ç¨æ·åå»ºè¿ç¨æ¶æ·»å äºåç§namespaceåæ°ï¼å®¹å¨æ¯ç¹æ®çè¿ç¨ï¼è¿æ¯è¿è¡å¨æä½ç³»ç»ä¸çã\n\n      å®ç°æ¹å¼             ä¼å¿             å£å¿\nèææº   èæåç¡¬ä»¶            éç¦»ç¨åº¦éå¸¸é«        èµæºæ¶èå¤§ï¼å¯å¨æ¢\nå®¹å¨    ç´æ¥å©ç¨ä¸å±çç¡¬ä»¶åæä½ç³»ç»   èµæºå©ç¨çé«ï¼è¿è¡éåº¦å¿«   éç¦»ç¨åº¦ä½, å®å¨æ§ä½\n\n 1. èææºæ¯ç¡¬ä»¶çº§å«çéç¦»ï¼èå®¹å¨åæ¯è¿ç¨é´çéç¦»ã\n\n 2. èæåéè¦æ¨¡æç¡¬ä»¶å ç¨é¨ååå­ï¼å¹¶ä¸å¯¹å®¿ä¸»æºæä½çç³»ç»è°ç¨éè¦ç»è¿èæåè½¯ä»¶çæ¦æªä¸è½¬æ¢ï¼é æèµæºçå¼éãèå®¹å¨å°±æ¯ä¸ä¸ªæ®éçè¿ç¨ï¼åºæ¬æ é¢å¤çè®¡ç®èµæºçå¼éã\n\n 3. å¨linuxåæ ¸ä¸­æé¨åçèµæºåå¯¹è±¡æ æ³namespaceåï¼å¦æ¶é´ã\n\n 4. å ä¸ºå®¹å¨æ¯å±äº«å®¿ä¸»æºåæ ¸ï¼æä»¥å¯¹å¤æ´é²çä¾ç»é¢éå¸¸çå¤§ã\n\n\n# ä»ä¹æ¯å®¹å¨ååºç¨ï¼\n\néåï¼å°±æ¯å°å®¹å¨çåå§åç¯å¢åºåä¸æ¥ï¼å°è¿è¡è¿ç¨æéè¦çæä»¶ç³»ç»ãä¾èµåºãç¯å¢åéãå¯å¨åæ°ç­æåæ´åå°ä¸èµ·ï¼ä¿å­æä¸ä¸ªéæçæä»¶ã\n\nå®¹å¨åç¯å¢å¯ä»¥éè¿éåå¿«ééå»ºå®¹å¨ï¼åºç¨ç¨åºçå°çå°±æ¯ä¸è´çè¿è¡ç¯å¢ã\n\nå®¹å¨ååºç¨ï¼ä¹å°±æ¯åºç¨ç¨åºä¸ç´æ¥ä¸æä½ç³»ç»å»æäº¤éï¼èæ¯å°åºç¨ç¨åºæåæéåï¼åäº¤ç»å®¹å¨ç¯å¢å»è¿è¡\n\néåä¸å®¹å¨çå³ç³»è¿å¯ä»¥ç¨"åºåå"å"ååºåå"æ¥çè§£ï¼éåå°±æ¯åºååå°ç£ççæ°æ®ï¼èå®¹å¨æ¯ååºååååå­ä¸­çå¯¹è±¡ã\n\n\n\n\n\n\n# dockeræ¶æ\n\nåå»ºå®¹å¨æ¶ï¼æä»¬éè¿dockerå½ä»¤è¯·æ±docker daemonæå¡ï¼ç¶åè¯¥æå¡åéè¿rpcè¯·æ±containerdè¿ç¨ï¼è¯¥è¿ç¨ä¼åå»ºcontainerd-shimè¿ç¨ï¼è¯¥è¿ç¨ä¼ååå»ºruncè¿ç¨ï¼è¯¥è¿ç¨æ¯çæ­£åå»ºå®¹å¨çæ¯è¿ç¨ï¼ç­å®¹å¨åå»ºå¥½åï¼runcä¼éåºï¼å®¹å¨çç¶è¿ç¨ä¼åæcontainerd-shimï¼å½å®¹å¨ç»ææ¶ï¼conatinerd-shimä¼åæ¶å®¹å¨è¿ç¨çèµæºï¼ä»¥é²æ­¢åµå°¸è¿ç¨ã\n\n\n\n\n# å¸¸ç¨éåæä½\n\nå½ä»¤              ä½ç¨\ndocker pull     ä»è¿ç«¯ä»åºæåéå\ndocker images   ååºå½åæ¬å°å·²æéå\ndocker rmi      å é¤ä¸åä½¿ç¨çéå\n\n\n# å¸¸ç¨å®¹å¨æä½\n\nå½ä»¤              ä½ç¨            ä¾å­\ndocker run      ä½¿ç¨éåå¯å¨å®¹å¨      \ndocker ps       ååºæ­£å¨è¿è¡çå®¹å¨     \ndocker exec     å¨å®¹å¨åæ§è¡å¦ä¸ä¸ªç¨åº   \ndocker stop     åæ­¢å®¹å¨          \ndocker start    å°åæ­¢çå®¹å¨åæ¬¡å¯å¨    \ndocker rm       å é¤å®¹å¨          \ndocker export   å°å®¹å¨åçæä»¶ç³»ç»å¯¼åº   docker export -o rootfs.tar å®¹å¨id\n\nå®¹å¨è¢«åæ­¢åï¼docker pså½ä»¤å°±çä¸å°è¯¥å®¹å¨äºï¼éè¦ä½¿ç¨docker ps -aæ¥æ¥çææå®¹å¨ï¼åæ¬å·²ç»åæ­¢çå®¹å¨ã\n\nå¯è½ä¼å¯¼è´éå¸¸å¤å·²ç»åæ­¢çå®¹å¨å ç¨ç³»ç»èµæºï¼æä»¥å»ºè®®docker runæ¶æ·»å --rmåæ°ï¼å¨å®¹å¨è¿è¡å®æ¯æ¶èªå¨æ¸é¤\n\ndocker execæ¯å¦ä½è¿å¥å°å®¹å¨ä¸­ç?\n\nè¯¥å½ä»¤ä¼åå»ºä¸ä¸ªæ°çè¿ç¨å å¥å°å®¹å¨çnamepsaceä¸­ã\n\n/proc/{è¿ç¨id}/ns/ä¸çèææä»¶ä¼é¾æ¥å°çå®çnamespaceæä»¶ä¸ãéè¿æ¥çexecåå»ºçè¿ç¨nsæä»¶å¯ä»¥çåºåå®¹å¨çnamespaceæä»¶ä¸è´\n\n[root@k8s-master proc]# ll /proc/288948/ns/pid\nlrwxrwxrwx 1 root root 0 jul  8 11:27 /proc/288948/ns/pid -> \'pid:[4026532247]\'\n\n[root@k8s-master proc]# ll /proc/289220/ns/pid\nlrwxrwxrwx 1 root root 0 jul  8 11:27 /proc/289220/ns/pid -> \'pid:[4026532247]\'\n\n\n1\n2\n3\n4\n5\n\n\ndocker runådocker execçåºå«æ¯ä»ä¹?\n\nrunæ¯å°éåè¿è¡æå®¹å¨å¹¶æ§è¡å½ä»¤ï¼è¯¥å½ä»¤ä¸º1å·è¿ç¨ã\n\nexecæ¯å¨å®¹å¨ä¸­æ§è¡ä¸ä¸ªå½ä»¤ï¼è¯¥å½ä»¤æ¯å¦ä¸ä¸ªè¿ç¨ï¼å å¥å°äºå®¹å¨çnamespaceä¸­ã\n\n\n# å®¹å¨éå\n\n\n# éååé¨æºå¶\n\nå®¹å¨éååé¨æ¯ç±è®¸å¤çéåå±(layer)ç»æçï¼æ¯å±é½æ¯åªè¯»ä¸å¯ä¿®æ¹çä¸ç»æä»¶ï¼ç¸åçå±å¯ä»¥å¨éåä¸­å±äº«ï¼ç¶åå¤ä¸ªå±åæ­ç§¯æ¨å å èµ·æ¥ï¼ä½¿ç¨**èåæä»¶ç³»ç»ï¼unionfs)**å°å®ä»¬åå¹¶èµ·æ¥ï¼æç»å½¢æå®¹å¨çå°çæä»¶ç³»ç»ã\n\néåä¸­çå±çº§æ¯åªè¯»å±ï¼èå®¹å¨æå¨çå±çº§æ¯å¯è¯»åå±ã\n\n\n\néåçåå±ä¿¡æ¯å¯ä»¥éè¿å½ä»¤docker inspect éååç§°è·åï¼å¶ä¸­rootfsæ¯å¯¹åºçä¿¡æ¯\n\n>>> docker inspect b3log/siyuan\n\n.....\n"rootfs": {\n            "type": "layers",\n            "layers": [\n                "sha256:24302eb7d9085da80f016e7e4ae55417e412fb7e0a8021e95e3b60c67cde557d",\n                "sha256:e7356c89d8c31fc628769b331f73d6e036e1d5900d2d2a3990c89ef91bce707a",\n                "sha256:90358380b9ea63cfb8832ae627455faf85596e822ff8abe9e1d7c8bbd93804ad",\n                "sha256:c6d8ffacc07d179562cd70114402e549d9fce92b12a019d3f4003eb94944d089"\n            ]\n        }\n....\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nå¥½å¤æ¯ï¼å¦æå¤ä¸ªéåä½¿ç¨äºç¸åçå±ï¼å¯ä»¥ç´æ¥å±äº«ï¼åå°ç£çç©ºé´çå ç¨ãæ¯å¦nginxéååtomcatéåé½æ¯ç¨äºåºç¡éåcentosï¼é£ä¹è¯¥åºç¡éåå¯ä»¥å±äº«ã\n\n\n\noverlayfs\n\néåå±åå®¹å¨æ¯å¦ä½åå¹¶çå¢ï¼\n\n\n\nlowerdiræ¯éåå±ï¼upperdiræ¯å®¹å¨å±ï¼å¦æåæ¹æç¸åæä»¶åå±ç¤ºå®¹å¨å±çæä»¶ã\n\nå¨å®¹å¨åæä»¶æ¶ï¼ä¼åä»éåå±æ·è´ä¸ä»½æä»¶å°å®¹å¨å±ï¼ç¶åååå¥ï¼ä½¿ç¨çæ¯**åæ¶å¤å¶(copy on write)**ç­ç¥\n\nä¾å­\n\noverlay2\nâââ lowerdira\nâ   âââ a     åå®¹ï¼aa\nâ   âââ b     åå®¹ï¼aa\nâââ lowerdirb\nâ   âââ a     åå®¹: bb\nâââ merge\nâââ upper\nâââ work\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ§è¡ä»¥ä¸å½ä»¤ä½¿ç¨overlayè¿è¡åå¹¶å±\n\nmount -t overlay overlay -o lowerdir=lowerdira:lowerdirb,upperdir=upper,workdir=work merge\n\n\n1\n\n\nlowerdirä¸ºéåå±ï¼upperdirä¸ºå®¹å¨å±ï¼mergeç®å½ä¸ºæç»å±ç¤ºå±ã\n\nå¯ä»¥çå°mergeç®å½ä¸­çaæä»¶åå®¹lowerdiraéåå±çåå®¹\n\n[root@izwz93q4afq8ck02cesqh4z k8s_learn]# cat merge/a \naa\n\n\n1\n2\n\n\nå½æä»¬ä¿®æ¹megreç®å½ä¸­çaæä»¶æ¶ï¼å¯ä»¥çå°upperdirç®å½çä¼çæaæä»¶å¹¶ä¸åå®¹ä¿®æ¹åçåå®¹\n\n[root@izwz93q4afq8ck02cesqh4z k8s_learn]# ls upper/\n[root@izwz93q4afq8ck02cesqh4z k8s_learn]# echo upper > merge/a\n[root@izwz93q4afq8ck02cesqh4z k8s_learn]# ls upper/\na\n[root@izwz93q4afq8ck02cesqh4z k8s_learn]# cat upper/a\nupper\n[root@izwz93q4afq8ck02cesqh4z k8s_learn]# cat merge/a\nupper\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå½å é¤æä»¶merge/aæ¶ï¼ä¼åºç°ä»ä¹æåµå¢?\n\n[root@izwz93q4afq8ck02cesqh4z k8s_learn]# rm merge/a\nrm: remove regular file âmerge/aâ? y\n[root@izwz93q4afq8ck02cesqh4z k8s_learn]# ll lowerdira/\ntotal 8\n-rw-r--r-- 1 root root 3 jul 12 19:11 a\n-rw-r--r-- 1 root root 3 jul 12 19:10 b\n[root@izwz93q4afq8ck02cesqh4z k8s_learn]# ll upper/\ntotal 0\nc--------- 1 root root 0, 0 jul 12 19:31 a\n[root@izwz93q4afq8ck02cesqh4z k8s_learn]#\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå¯ä»¥çåºéåå±lowerdiraçæä»¶aæ¯ä¸åçï¼èå¨å®¹å¨å±upperä¸­çaæä»¶ç±»ååæäºcï¼è¯¥æä»¶ç±»åï¼æç»å¨å±ç¤ºå±çä¸å°è¯¥æä»¶äºã\n\nå¯ä»¥ä½¿ç¨å½ä»¤docker inspectæ¥æ¥çlayerçè·¯å¾\n\n>>> docker inspect xxx\n\n....\n"graphdriver": {\n            "data": {\n                "lowerdir": "/var/lib/docker/overlay2/641e486c54d15d2a8d807fd8964f4a4b8687cbcf95c176cd9a46553b1e80341d/diff:/var/lib/docker/overlay2/ed9ad4fb9d0f9bf3aea553c634e54fef89448cf43c5b662468d79f01cf41d0c3/diff:/var/lib/docker/overlay2/9db169e1ad2165f688e652ef06dfe9a3e465c31299f3c357a37a6919747efbc8/diff",\n                "mergeddir": "/var/lib/docker/overlay2/fa3166e545a2d1811dbeecb6f1fdda96b9f97b3cd629f32a8ea378aa79b1c780/merged",\n                "upperdir": "/var/lib/docker/overlay2/fa3166e545a2d1811dbeecb6f1fdda96b9f97b3cd629f32a8ea378aa79b1c780/diff",\n                "workdir": "/var/lib/docker/overlay2/fa3166e545a2d1811dbeecb6f1fdda96b9f97b3cd629f32a8ea378aa79b1c780/work"\n            },\n            "name": "overlay2"\n        },\n....\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# dockerfile\n\ndockerfileæ¯ä¸ä¸ªç¨æ¥åå»ºéåçææ¬æä»¶ï¼è¯¥æä»¶ä¸­çæ¯ä¸æ¡å½ä»¤é½ä¼æçæä¸ä¸ªlayerã\n\nä¾å­ï¼\n\næç®åçdockerfileçä¾å­\n\nfrom busybox                  # éæ©åºç¡éå\ncmd echo "hello world"        # å¯å¨å®¹å¨æ¶é»è®¤è¿è¡çå½ä»¤\n\n\n1\n2\n\n\nfromæä»¤æ¯æå»ºä½¿ç¨çåºç¡éå\n\ncmdæä»¤æ¯ç¨äºå¯å¨å®¹å¨æ¶é»è®¤è¿è¡çå½ä»¤\n\nä½¿ç¨docker build å³å¯æ§è¡åå»ºéå\n\ndocker build -f dockerfile .\n\nsending build context to docker daemon   7.68kb\nstep 1/2 : from busybox\n ---\x3e d38589532d97\nstep 2/2 : cmd echo "hello world"\n ---\x3e running in c5a762edd1c8\nremoving intermediate container c5a762edd1c8\n ---\x3e b61882f42db7\nsuccessfully built b61882f42db7\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# å®¹å¨ä¸å¤é¨çäº¤äº\n\nå¦ä½æ·è´å®¿ä¸»æºçæä»¶å°å®¹å¨å\n\nå¯ä»¥ä½¿ç¨docker cpå½ä»¤å°å®¿ä¸»æºçæä»¶æ·è´å°å®¹å¨ä¸­ã\n\ndocker cp a.txt 062:/tmp\n\n\n1\n\n\nå¶ä¸­ç062ä¸ºå®¹å¨idï¼å¦ææ³å°å®¹å¨ä¸­çæä»¶æ·è´å°å®¿ä¸»æºä¸­ï¼åè¿æ¥å³å¯ã\n\ndocker cp 062:/tmp/a.txt /tmp\n\n\n1\n\n\næ³¨æï¼è¿éçæ·è´æ¯ä¸´æ¶çï¼æ·è´è¿å®¹å¨ä¸­çæä»¶åªå­å¨äºå®¹å¨ä¸­ï¼ä¸å­å¨ä¸éåä¸­ï¼å¦ææ³è¦å°æä»¶æ·è´å°éåä¸­ï¼å¨ådockerfileæ¶ä½¿ç¨copyå½ä»¤æ·è´å³å¯ã\n\nå®¿ä¸»æºä¸å®¹å¨å±äº«æä»¶å¤¹\n\nå¨ä½¿ç¨éåè¿è¡å®¹å¨æ¶ï¼ä½¿ç¨åæ°-vå¯ä»¥å°å®¿ä¸»æºä¸­çæä»¶å¤¹æ å°å°å®¹å¨ä¸­ï¼åæ¹ä¿®æ¹è¯¥æä»¶å¤¹ä¸­çåå®¹ï¼é½å¯ä»¥åæ¶çå°ã\n\ndocker run -d --rm -v /tmp:/tmp redis\n\n\n1\n\n\nå¦ä½å®ç°ç½ç»äºéï¼\n\ndockeræä¾ä¸ç§ç½ç»æ¨¡å¼ï¼\n\n * nullï¼æ ç½ç»\n * hostï¼ç´æ¥ä½¿ç¨å®¿ä¸»æºç½ç»ï¼å¨åå»ºå®¹å¨æ¶ï¼ä½¿ç¨--net=hoståæ°ã\n\nå¶å®å°±æ¯åå»ºæ°çnamespaceï¼èæ¯ç´æ¥å å¥å°å®¿ä¸»æºçnamesapce\n\ndocker run -d --rm --net=host nginx:alpine\n\n\n1\n\n * bridgeï¼æ¡¥æ¥æ¨¡å¼ï¼ç±è½¯ä»¶èæç½å¡ä¸ç½æ¡¥ï¼å®¹å¨åå®¿ä¸»æºé½æ¥å¥è¯¥ç½æ¡¥ï¼å³å¯æ­£å¸¸åéæ°æ®åãå¯ä»¥ä½¿ç¨åæ°--net=bridgeåå»ºå®¹å¨ï¼ä½è¿ä¸ªæ¯é»è®¤åæ°ã\n\ndocker run -d --rm nginx:alpine\n\n\n1\n\n\n\n\nç½ç»æ¨¡å¼     ä¼ç¹                        ç¼ºç¹\nhost     å ä¸ºæ¯ç´æ¥ä½¿ç¨å®¿ä¸»æºçç½ç»ï¼æçæ´é«        è¿è¡å¤ªå¤çå®¹å¨ï¼ä¼å¯¼è´ç«¯å£åçå²çª\nbridge   å ä¸ºæäºç½æ¡¥å¯ä»¥è®¾ç½®æ´å¤çç­ç¥ï¼æ¯å¦æµéæ§å¶ç­   éè¦è½¯ä»¶æ¨¡æèæç½å¡ä¸ç½æ¡¥ï¼æçæ´ä½\n\n\n\n\n\n\n# å³äºk8sä¸dockerçå³ç³»\n\nå¨2014å¹´çæ¶å,dockerå¦æ¥ä¸­å¤©ï¼é£ä¹k8sèªç¶éæ©åºäºdockerä¸è¿è¡ã\n\nå¨2016å¹´k8så å¥äºcncfï¼ä¸ä¸ªå¼æºçäºåçè®¡ç®åºéä¼ã\n\nå¹¶ä¸å¼å¥äºä¸ä¸ªæ¥å£æ åï¼criï¼container runtime interfaceãä¹å°±æ¯è§å®kubeletè¯¥å¦ä½è°ç¨container runtimeå»ç®¡çå®¹å¨åéåï¼ä½è¿æ¯ä¸å¥å¨æ°çæ¥å£ï¼åä¹åçdockerå®å¨ä¸å¼å®¹ãç®çå¾ææ¾ï¼ä¸æ³ç»å®dockerï¼å¯ä»¥éæ¶å°dockerè¸¢æã\n\nå ä¸ºdockerå·²ç»éå¸¸æçï¼åå¤§ååä¸å¯è½å°dockerå¨é¨æ¿æ¢ãæä»¥k8så¨kubeletådockerä¸­é´å ä¸ä¸ª"ééå¨"ï¼ædockerçæ¥å£è½¬æ¢æç¬¦åcriæ åçæ¥å£ã\n\n\n\nä»ä¹æ¯containerdï¼\n\nä¸è¿ docker ä¹æ²¡æâåä»¥å¾æ¯âï¼èæ¯éåäºâæ­èæ±çâçç­ç¥ï¼æ¨å¨èªèº«çéæï¼æåæ¬åä½æ¶æç docker engine æåæäºå¤ä¸ªæ¨¡åï¼å¶ä¸­ç docker daemon é¨åå°±æç®ç»äº cncfï¼å½¢æäº containerdã\n\ncontainerd ä½ä¸º cncf çæç®¡é¡¹ç®ï¼èªç¶æ¯è¦ç¬¦å cri æ åçãä½ docker åºäºèªå·±è¯¸å¤åå çèèï¼å®åªæ¯å¨ docker engine éè°ç¨äº containerdï¼å¤é¨çæ¥å£ä»ç¶ä¿æä¸åï¼ä¹å°±æ¯è¯´è¿ä¸ä¸ cri å¼å®¹ã\n\nç±äº docker çâåºæ§å·±è§âï¼è¿æ¶ kubernetes éå°±åºç°äºä¸¤ç§è°ç¨é¾ï¼ç¬¬ä¸ç§æ¯ç¨ cri æ¥å£è°ç¨ dockershimï¼ç¶å dockershim è°ç¨ dockerï¼docker åèµ° containerd å»æä½å®¹å¨ãç¬¬äºç§æ¯ç¨ cri æ¥å£ç´æ¥è°ç¨ containerd å»æä½å®¹å¨ã\n\n\n\næ¾èæè§ï¼ä½¿ç¨ç¬¬äºç§çå»äºdockershimådocker engineä¸¤ä¸ªç¯èï¼æèæ´å°ï¼æ§è½ä¹æåäºã\n\næ­£å¼"å¼ç¨docker"\n\nå¨2020å¹´k8så¼ç¨dockeræ¯æï¼ä½è¯¥å¼ç¨æ¯æå¼ç¨äº"dockershim"çè¿ä¸ªç»ä»¶ï¼ä¹å°±æ¯ædockershimç§»åºkubeleteï¼åªæ¯ç»è¿dockerï¼ç´æ¥è°ç¨äºdockeråé¨çcontainerdèå·²ã\n\nå¹¶ä¸å¯¹dockerä¹æ å½±åï¼å ä¸ºdockeråé¨ä¹æ¯ä½¿ç¨å¼æºçcontainerdã\n\n\n\nå¯ä¸å½±åçæ¯ï¼k8sæ¯ç´æ¥æä½containerdæä½å®¹å¨ï¼é£ä¹å®ådockeræ¯ç¬ç«çå·¥ä½ç¯å¢ï¼å½¼æ­¤é½ä¸è½è®¿é®å¯¹æ¹çå®¹å¨åéåï¼ä¹å°±æ¯docker psçä¸å°k8sè¿è¡çå®¹å¨ãæ¹ç¨crictlå½ä»¤ã\n\ndocker éæèªèº«ï¼åç¦»åº containerdï¼è¿æ¯å¦ç®æ¯ä¸ç§âèªæåå¢âçè¡ä¸ºå¢ï¼å¦ææ²¡æ containerdï¼é£ç°å¨çæå½¢ä¼æ¯æä¹æ ·çå¢ï¼\n\ndocker æ¯ä¸ä¸ªå®æ´çè½¯ä»¶äº§åçº¿ï¼ä¸æ­¢æ¯ containerdï¼å®è¿åæ¬äºéåæå»ºãååãæµè¯ç­è®¸å¤æå¡ï¼çè³å¨ docker desktop éè¿åç½®äº kubernetesã\n\n> dockeråç¦»containerdæ¯ä¸ä¸ªå¾èªæçä¸¾å¨ï¼ä¸å¶å°æ¥è¢«äººåç¦»æèæå¼ä¸ç¨ï¼ä¸å¦æä¸»å¨é©æ°ï¼ækubernatesç»å¨æçæè½¦ä¸ï¼è¿æ ·criçç¬¬ä¸éæ©ä»ç¶æ¯dockerçèªå·±äººã\n> ä¸æ¶çéè®©æ¯ä¸ºäºæ´å¥½çå°æ¥ã',charsets:{cjk:!0},lastUpdated:"2023/01/15, 20:17:10",lastUpdatedTimestamp:167378503e4},{title:"ä½¿ç¨kubeadmå®è£k8s",frontmatter:{tags:["k8s","å®¹å¨","äºåç"],title:"ä½¿ç¨kubeadmå®è£k8s",date:"2022-09-13T20:14:37.000Z",permalink:"/pages/9e17c8/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä»ç»å¦ä½ä½¿ç¨kubeadmæ¥æ­å»ºä¸ä¸ªå°åçk8séç¾¤",feed:{enable:!0},categories:["äºåç","k8s"],comment:!0,meta:[{name:"twitter:title",content:"ä½¿ç¨kubeadmå®è£k8s"},{name:"twitter:description",content:"ä»ç»å¦ä½ä½¿ç¨kubeadmæ¥æ­å»ºä¸ä¸ªå°åçk8séç¾¤"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/11.%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85k8s.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ä½¿ç¨kubeadmå®è£k8s"},{property:"og:description",content:"ä»ç»å¦ä½ä½¿ç¨kubeadmæ¥æ­å»ºä¸ä¸ªå°åçk8séç¾¤"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/11.%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85k8s.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-09-13T20:14:37.000Z"},{property:"article:tag",content:"k8s"},{property:"article:tag",content:"å®¹å¨"},{property:"article:tag",content:"äºåç"},{itemprop:"name",content:"ä½¿ç¨kubeadmå®è£k8s"},{itemprop:"description",content:"ä»ç»å¦ä½ä½¿ç¨kubeadmæ¥æ­å»ºä¸ä¸ªå°åçk8séç¾¤"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/11.%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85k8s.html",relativePath:"01.äºåç/07.k8s/11.ä½¿ç¨kubeadmå®è£k8s.md",key:"v-8f1b0f62",path:"/pages/9e17c8/",headers:[{level:2,title:"ç¸å³é¾æ¥",slug:"ç¸å³é¾æ¥",normalizedTitle:"ç¸å³é¾æ¥",charIndex:2},{level:2,title:"å®è£éç½®",slug:"å®è£éç½®",normalizedTitle:"å®è£éç½®",charIndex:44},{level:2,title:"ä¸»èç¹æ§è¡",slug:"ä¸»èç¹æ§è¡",normalizedTitle:"ä¸»èç¹æ§è¡",charIndex:1557},{level:2,title:"å­èç¹å å¥éç¾¤",slug:"å­èç¹å å¥éç¾¤",normalizedTitle:"å­èç¹å å¥éç¾¤",charIndex:2189},{level:2,title:"æµè¯",slug:"æµè¯",normalizedTitle:"æµè¯",charIndex:2648},{level:2,title:"å¸¸è§éè¯¯",slug:"å¸¸è§éè¯¯",normalizedTitle:"å¸¸è§éè¯¯",charIndex:4155}],headersStr:"ç¸å³é¾æ¥ å®è£éç½® ä¸»èç¹æ§è¡ å­èç¹å å¥éç¾¤ æµè¯ å¸¸è§éè¯¯",content:'# ç¸å³é¾æ¥\n\nkubeadmå®è£å®ç½\n\nkubeadmå®è£k8så®æ´æç¨ â\n\n\n# å®è£éç½®\n\nä»¥ä¸æä½æ¯æ¯ä¸ªèç¹é½è¦æ§è¡çæ­¥éª¤\n\n 1. éç½®hosts\n\nå°ä¸»èç¹ä¸å­èç¹åå«éç½®hostnameå¦ä¸ï¼\n\nhostnamectl set-hostname master  # ä¸»èç¹\nhostnamectl set-hostname node1   # å­èç¹\nhostnamectl set-hostname node2   # å­èç¹\n\n\n1\n2\n3\n\n\nå¨/etc/hostsä¸­æ·»å æ¬æºhostnameä¸ipçæ å°å³ç³»\n\n1.1.1.1 master\n1.1.1.2 node1\n1.1.1.3 node2\n\n\n1\n2\n3\n\n 2. å³é­é²ç«å¢\n\néè¦å°ä¸»èç¹ä¸å­èç¹é½å³é­é²ç«å¢\n\nsystemctl stop firewalld\n\n\n1\n\n 3. éç½®yumæº\n\nå¨å®è£kubeadmä¹åï¼é½éè¦éç½®yumæºï¼åå»ºæä»¶/etc/yum.repos.d/kubernetes.repo\n\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=0\n\n\n1\n2\n3\n4\n5\n\n 4. å° SELinux è®¾ç½®ä¸º permissive æ¨¡å¼ï¼ç¸å½äºå°å¶ç¦ç¨ï¼\n\nsudo setenforce 0\nsudo sed -i \'s/^SELINUX=enforcing$/SELINUX=permissive/\' /etc/selinux/config\n\n\n1\n2\n\n 5. å®è£kubeadmãkubeletãkubectl\n\nsudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes\n\n\n1\n\n 6. å®è£dockerå¹¶å¼å¯\n\ncurl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun\nsystemctl enable --now docker\n\n\n1\n2\n\n 7. å¼å¯kubelet\n\nsudo systemctl enable --now kubelet\n\n\n1\n\n 8. æå¨éç½®containerdçéç½®\n\nèªå¨çæçæä»¶ä¼ä½¿ç¨k8s.gcr.io/pause:3.6éåï¼å½åæ æ³ä¸è½½ï¼å¯¼è´kubeadmåå§åå¤±è´¥ã\n\nçæ containerd çéç½®æä»¶\n\nmkdir -p /etc/containerd\ncontainerd config default > /etc/containerd/config.toml\n\n\n1\n2\n\n\nä¿®æ¹ SystemdCgroup ä¸º true\n\n# ç¼è¾æä»¶\nvi /etc/containerd/config.toml\n\n#æ´æ¹SystemdCgroupå¼ä¸ºtrue\nSystemdCgroup = true\n\n\n1\n2\n3\n4\n5\n\n\nä¿®æ¹ sandbox_image å¼\n\n# æ´æ¹k8s.gcr.io/pause:3.6ä¸ºregistry.aliyuncs.com/google_containers/pause:3.7\nsandbox_image = "registry.aliyuncs.com/google_containers/pause:3.7"\n\n\n1\n2\n\n\néå¯containerd\n\nsystemctl restart containerd\n\n\n1\n\n\n\n# ä¸»èç¹æ§è¡\n\n 1. ä½¿ç¨kubedam initåå§å\n\nkubeadm init --image-repository registry.aliyuncs.com/google_containers --v=5 --pod-network-cidr 10.244.0.0/16\n\n\n1\n\n 2. kubectlè¯»åk8sææè®¤è¯æä»¶\n\nå°å®å¨éç½®æä»¶æ¾å¨æå®ç®å½ä¸­ï¼è¯¥æä»¶æ¶kubectléè¦è¯»åçæææä»¶ï¼æ¾å¨æå®ç®å½ä¸ï¼kubectlæè½è¯»åå°å¹¶è®¿é®å°k8s\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\n\n1\n2\n3\n\n\næèæ¾å¨ç¯å¢åéä¸­ï¼kubectlä¼è¯»åè¯¥ç¯å¢åéä¸­çæä»¶\n\nvim /etc/profile\nexport KUBECONFIG=/etc/kubernetes/admin.conf\nsource /etc/profile\n\n\n1\n2\n3\n\n 3. åå»ºç½ç»flannel\n\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n\n\n1\n\n\nâ\n\n\n# å­èç¹å å¥éç¾¤\n\n 1. ä½¿ç¨kubeadm joinå å¥éç¾¤\n\nåå¨ä¸»èç¹ä½¿ç¨kubeadm token create --print-join-commandæ¥è·åå°å­èç¹å å¥ä¸»èç¹çå½ä»¤\n\n[root@master ~]# kubeadm token create --print-join-command\nkubeadm join 172.16.16.16:6443 --token vnu6yz.4zk8f7hdorb8fpl0 --discovery-token-ca-cert-hash sha256:ca4e1e3e2afe16f592c3623f17a6b0dc9cfebd4ec459755e02f4b8db779e21d4\n\n\n1\n2\n\n\nåå¨å­èç¹ä¸æ§è¡è¯¥å½ä»¤ï¼å³å¯å å¥éç¾¤\n\n 2. å°ä¸»èç¹çconfigç§»å¨å°å­èç¹\n\nå­èç¹ä¹éè¦ä¸»èç¹çconfigæä»¶ï¼æè½éè¿kubectlè®¿é®éç¾¤\n\nscp ~/.kube/config node1:~/.kube/config\n\n\n1\n\n\n\n# æµè¯\n\nå¨ä¸»èç¹åå»ºdeployment.yamlæä»¶å¦ä¸\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: demoapp\n  name: demo-deploy\n\nspec:\n  replicas: 10\n  selector:\n    matchLabels:\n      app: demoapp\n\n  template:\n    metadata:\n      labels:\n        app: demoapp\n    spec:\n      containers:\n      - image: ikubernetes/demoapp:v1.0\n        name: demoapp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nåå»ºæ§å¶å¨\n\n[root@master ~]# kubectl apply -f deployment.yaml \ndeployment.apps/demo-deploy created\n\n\n1\n2\n\n\nå¯ä»¥çå°åå»ºæåï¼å¹¶ä¸ææçpodå·²ç»READY\n\n[root@master ~]# kubectl get deploy -n zwf\nNAME          READY   UP-TO-DATE   AVAILABLE   AGE\ndemo-deploy   10/10   10           10          3m15s\n\n\n1\n2\n3\n\n\nå¯ä»¥çå°podé½å·²ç»åå»ºæåã\n\n[root@master ~]# kubectl get pods -n zwf \nNAME                           READY   STATUS    RESTARTS   AGE\ndemo-deploy-55c5f88dcb-2nzbf   1/1     Running   0          4m38s\ndemo-deploy-55c5f88dcb-5kwc9   1/1     Running   0          4m38s\ndemo-deploy-55c5f88dcb-8jd9k   1/1     Running   0          4m38s\ndemo-deploy-55c5f88dcb-b7zjp   1/1     Running   0          4m38s\ndemo-deploy-55c5f88dcb-bs7tm   1/1     Running   0          4m38s\ndemo-deploy-55c5f88dcb-jrbzw   1/1     Running   0          4m38s\ndemo-deploy-55c5f88dcb-lsfff   1/1     Running   0          4m38s\ndemo-deploy-55c5f88dcb-mgqpq   1/1     Running   0          4m38s\ndemo-deploy-55c5f88dcb-wfzzb   1/1     Running   0          4m38s\ndemo-deploy-55c5f88dcb-wkbv2   1/1     Running   0          4m38s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# å¸¸è§éè¯¯\n\n * kubeadm init æ¥é âunknown service runtime.v1alpha2.RuntimeServiceâ\n\nè§£å³ï¼\n\nrm /etc/containerd/config.toml -f\nsystemctl restart containerd\n\n\n1\n2\n\n\n * å¦æå¨kubeadm initä¸­åºç°äºå¤±è´¥ï¼å¨è§£å³é®é¢åï¼éè¦æ§è¡kubeadm resetï¼å¦åä¼æ¥é\n\n * Failed to create pod sandbox: rpc error: code = Unknown desc = failed to get sandbox image "k8s.gcr.io/pause:3.6": failed to pull image "k8s.gcr.io/pause:3.6": failed to pull and unpack image "k8s.gcr.io/pause:3.6": failed to resolve reference "k8s.gcr.io/pause:3.6": failed to do request: Head "https://k8s.gcr.io/v2/pause/manifests/3.6": dial tcp 74.125.23.82:443: connect: connection refused\n\næ¯å ä¸ºæä¸å°k8så®æ¹çk8s.gcr.io/pause:3.6éåï¼ä½¿ç¨ä¸»èç¹containeréç½®å¯ä»¥è§£å³ã\n\n * kube-flannelæ¥éï¼\n   \n   running-error-CrashLoopBackOffãnodeâk8s-master-1âpodcidr not assigned\n\nhttps://blog.csdn.net/shm19990131/article/details/107115750/\n\nhttps://blog.csdn.net/anqixiang/article/details/107715591\n\n * plugin type="flannel" failed (add): failed to delegate add: failed to set bridge addr: "cni0" already has an IP address different from\n\nè§£å³åæ³:\n\nsudo ifconfig cni0 down  \nsudo ip link delete cni0\n\n\n1\n2\n\n\nç¸å³èµæï¼\n\nhttps://blog.csdn.net/ibless/article/details/107899009',normalizedContent:'# ç¸å³é¾æ¥\n\nkubeadmå®è£å®ç½\n\nkubeadmå®è£k8så®æ´æç¨ â\n\n\n# å®è£éç½®\n\nä»¥ä¸æä½æ¯æ¯ä¸ªèç¹é½è¦æ§è¡çæ­¥éª¤\n\n 1. éç½®hosts\n\nå°ä¸»èç¹ä¸å­èç¹åå«éç½®hostnameå¦ä¸ï¼\n\nhostnamectl set-hostname master  # ä¸»èç¹\nhostnamectl set-hostname node1   # å­èç¹\nhostnamectl set-hostname node2   # å­èç¹\n\n\n1\n2\n3\n\n\nå¨/etc/hostsä¸­æ·»å æ¬æºhostnameä¸ipçæ å°å³ç³»\n\n1.1.1.1 master\n1.1.1.2 node1\n1.1.1.3 node2\n\n\n1\n2\n3\n\n 2. å³é­é²ç«å¢\n\néè¦å°ä¸»èç¹ä¸å­èç¹é½å³é­é²ç«å¢\n\nsystemctl stop firewalld\n\n\n1\n\n 3. éç½®yumæº\n\nå¨å®è£kubeadmä¹åï¼é½éè¦éç½®yumæºï¼åå»ºæä»¶/etc/yum.repos.d/kubernetes.repo\n\n[kubernetes]\nname=kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=0\n\n\n1\n2\n3\n4\n5\n\n 4. å° selinux è®¾ç½®ä¸º permissive æ¨¡å¼ï¼ç¸å½äºå°å¶ç¦ç¨ï¼\n\nsudo setenforce 0\nsudo sed -i \'s/^selinux=enforcing$/selinux=permissive/\' /etc/selinux/config\n\n\n1\n2\n\n 5. å®è£kubeadmãkubeletãkubectl\n\nsudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes\n\n\n1\n\n 6. å®è£dockerå¹¶å¼å¯\n\ncurl -fssl https://get.docker.com | bash -s docker --mirror aliyun\nsystemctl enable --now docker\n\n\n1\n2\n\n 7. å¼å¯kubelet\n\nsudo systemctl enable --now kubelet\n\n\n1\n\n 8. æå¨éç½®containerdçéç½®\n\nèªå¨çæçæä»¶ä¼ä½¿ç¨k8s.gcr.io/pause:3.6éåï¼å½åæ æ³ä¸è½½ï¼å¯¼è´kubeadmåå§åå¤±è´¥ã\n\nçæ containerd çéç½®æä»¶\n\nmkdir -p /etc/containerd\ncontainerd config default > /etc/containerd/config.toml\n\n\n1\n2\n\n\nä¿®æ¹ systemdcgroup ä¸º true\n\n# ç¼è¾æä»¶\nvi /etc/containerd/config.toml\n\n#æ´æ¹systemdcgroupå¼ä¸ºtrue\nsystemdcgroup = true\n\n\n1\n2\n3\n4\n5\n\n\nä¿®æ¹ sandbox_image å¼\n\n# æ´æ¹k8s.gcr.io/pause:3.6ä¸ºregistry.aliyuncs.com/google_containers/pause:3.7\nsandbox_image = "registry.aliyuncs.com/google_containers/pause:3.7"\n\n\n1\n2\n\n\néå¯containerd\n\nsystemctl restart containerd\n\n\n1\n\n\n\n# ä¸»èç¹æ§è¡\n\n 1. ä½¿ç¨kubedam initåå§å\n\nkubeadm init --image-repository registry.aliyuncs.com/google_containers --v=5 --pod-network-cidr 10.244.0.0/16\n\n\n1\n\n 2. kubectlè¯»åk8sææè®¤è¯æä»¶\n\nå°å®å¨éç½®æä»¶æ¾å¨æå®ç®å½ä¸­ï¼è¯¥æä»¶æ¶kubectléè¦è¯»åçæææä»¶ï¼æ¾å¨æå®ç®å½ä¸ï¼kubectlæè½è¯»åå°å¹¶è®¿é®å°k8s\n\n  mkdir -p $home/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $home/.kube/config\n  sudo chown $(id -u):$(id -g) $home/.kube/config\n\n\n1\n2\n3\n\n\næèæ¾å¨ç¯å¢åéä¸­ï¼kubectlä¼è¯»åè¯¥ç¯å¢åéä¸­çæä»¶\n\nvim /etc/profile\nexport kubeconfig=/etc/kubernetes/admin.conf\nsource /etc/profile\n\n\n1\n2\n3\n\n 3. åå»ºç½ç»flannel\n\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/documentation/kube-flannel.yml\n\n\n1\n\n\nâ\n\n\n# å­èç¹å å¥éç¾¤\n\n 1. ä½¿ç¨kubeadm joinå å¥éç¾¤\n\nåå¨ä¸»èç¹ä½¿ç¨kubeadm token create --print-join-commandæ¥è·åå°å­èç¹å å¥ä¸»èç¹çå½ä»¤\n\n[root@master ~]# kubeadm token create --print-join-command\nkubeadm join 172.16.16.16:6443 --token vnu6yz.4zk8f7hdorb8fpl0 --discovery-token-ca-cert-hash sha256:ca4e1e3e2afe16f592c3623f17a6b0dc9cfebd4ec459755e02f4b8db779e21d4\n\n\n1\n2\n\n\nåå¨å­èç¹ä¸æ§è¡è¯¥å½ä»¤ï¼å³å¯å å¥éç¾¤\n\n 2. å°ä¸»èç¹çconfigç§»å¨å°å­èç¹\n\nå­èç¹ä¹éè¦ä¸»èç¹çconfigæä»¶ï¼æè½éè¿kubectlè®¿é®éç¾¤\n\nscp ~/.kube/config node1:~/.kube/config\n\n\n1\n\n\n\n# æµè¯\n\nå¨ä¸»èç¹åå»ºdeployment.yamlæä»¶å¦ä¸\n\napiversion: apps/v1\nkind: deployment\nmetadata:\n  labels:\n    app: demoapp\n  name: demo-deploy\n\nspec:\n  replicas: 10\n  selector:\n    matchlabels:\n      app: demoapp\n\n  template:\n    metadata:\n      labels:\n        app: demoapp\n    spec:\n      containers:\n      - image: ikubernetes/demoapp:v1.0\n        name: demoapp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nåå»ºæ§å¶å¨\n\n[root@master ~]# kubectl apply -f deployment.yaml \ndeployment.apps/demo-deploy created\n\n\n1\n2\n\n\nå¯ä»¥çå°åå»ºæåï¼å¹¶ä¸ææçpodå·²ç»ready\n\n[root@master ~]# kubectl get deploy -n zwf\nname          ready   up-to-date   available   age\ndemo-deploy   10/10   10           10          3m15s\n\n\n1\n2\n3\n\n\nå¯ä»¥çå°podé½å·²ç»åå»ºæåã\n\n[root@master ~]# kubectl get pods -n zwf \nname                           ready   status    restarts   age\ndemo-deploy-55c5f88dcb-2nzbf   1/1     running   0          4m38s\ndemo-deploy-55c5f88dcb-5kwc9   1/1     running   0          4m38s\ndemo-deploy-55c5f88dcb-8jd9k   1/1     running   0          4m38s\ndemo-deploy-55c5f88dcb-b7zjp   1/1     running   0          4m38s\ndemo-deploy-55c5f88dcb-bs7tm   1/1     running   0          4m38s\ndemo-deploy-55c5f88dcb-jrbzw   1/1     running   0          4m38s\ndemo-deploy-55c5f88dcb-lsfff   1/1     running   0          4m38s\ndemo-deploy-55c5f88dcb-mgqpq   1/1     running   0          4m38s\ndemo-deploy-55c5f88dcb-wfzzb   1/1     running   0          4m38s\ndemo-deploy-55c5f88dcb-wkbv2   1/1     running   0          4m38s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# å¸¸è§éè¯¯\n\n * kubeadm init æ¥é âunknown service runtime.v1alpha2.runtimeserviceâ\n\nè§£å³ï¼\n\nrm /etc/containerd/config.toml -f\nsystemctl restart containerd\n\n\n1\n2\n\n\n * å¦æå¨kubeadm initä¸­åºç°äºå¤±è´¥ï¼å¨è§£å³é®é¢åï¼éè¦æ§è¡kubeadm resetï¼å¦åä¼æ¥é\n\n * failed to create pod sandbox: rpc error: code = unknown desc = failed to get sandbox image "k8s.gcr.io/pause:3.6": failed to pull image "k8s.gcr.io/pause:3.6": failed to pull and unpack image "k8s.gcr.io/pause:3.6": failed to resolve reference "k8s.gcr.io/pause:3.6": failed to do request: head "https://k8s.gcr.io/v2/pause/manifests/3.6": dial tcp 74.125.23.82:443: connect: connection refused\n\næ¯å ä¸ºæä¸å°k8så®æ¹çk8s.gcr.io/pause:3.6éåï¼ä½¿ç¨ä¸»èç¹containeréç½®å¯ä»¥è§£å³ã\n\n * kube-flannelæ¥éï¼\n   \n   running-error-crashloopbackoffãnodeâk8s-master-1âpodcidr not assigned\n\nhttps://blog.csdn.net/shm19990131/article/details/107115750/\n\nhttps://blog.csdn.net/anqixiang/article/details/107715591\n\n * plugin type="flannel" failed (add): failed to delegate add: failed to set bridge addr: "cni0" already has an ip address different from\n\nè§£å³åæ³:\n\nsudo ifconfig cni0 down  \nsudo ip link delete cni0\n\n\n1\n2\n\n\nç¸å³èµæï¼\n\nhttps://blog.csdn.net/ibless/article/details/107899009',charsets:{cjk:!0},lastUpdated:"2023/01/15, 20:17:10",lastUpdatedTimestamp:167378503e4},{title:"podä¸­å°ä»£ç ä¸è¿è¡ç¯å¢åç¦»",frontmatter:{title:"podä¸­å°ä»£ç ä¸è¿è¡ç¯å¢åç¦»",date:"2022-11-14T09:56:31.000Z",permalink:"/pages/27987d/",tags:["k8s","å®¹å¨","äºåç"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æä»¬å¨åå»ºä¸ä¸ª python ç web æå¡çéåæ¶ï¼ä¸è¬çåæ³æ¯ï¼å° python ç¯å¢ä¸ä»£ç æåæä¸ä¸ªéåï¼ç¶åå°è¿ä¸ªéåè¿è¡åå¸ã",categories:["äºåç","k8s"],comment:!0,feed:{enable:!0},meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20221114095752.png"},{name:"twitter:title",content:"podä¸­å°ä»£ç ä¸è¿è¡ç¯å¢åç¦»"},{name:"twitter:description",content:"æä»¬å¨åå»ºä¸ä¸ª python ç web æå¡çéåæ¶ï¼ä¸è¬çåæ³æ¯ï¼å° python ç¯å¢ä¸ä»£ç æåæä¸ä¸ªéåï¼ç¶åå°è¿ä¸ªéåè¿è¡åå¸ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20221114095752.png"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/12.pod%E4%B8%AD%E5%B0%86%E4%BB%A3%E7%A0%81%E4%B8%8E%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E5%88%86%E7%A6%BB.html"},{property:"og:type",content:"article"},{property:"og:title",content:"podä¸­å°ä»£ç ä¸è¿è¡ç¯å¢åç¦»"},{property:"og:description",content:"æä»¬å¨åå»ºä¸ä¸ª python ç web æå¡çéåæ¶ï¼ä¸è¬çåæ³æ¯ï¼å° python ç¯å¢ä¸ä»£ç æåæä¸ä¸ªéåï¼ç¶åå°è¿ä¸ªéåè¿è¡åå¸ã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20221114095752.png"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/12.pod%E4%B8%AD%E5%B0%86%E4%BB%A3%E7%A0%81%E4%B8%8E%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E5%88%86%E7%A6%BB.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-11-14T09:56:31.000Z"},{property:"article:tag",content:"k8s"},{property:"article:tag",content:"å®¹å¨"},{property:"article:tag",content:"äºåç"},{itemprop:"name",content:"podä¸­å°ä»£ç ä¸è¿è¡ç¯å¢åç¦»"},{itemprop:"description",content:"æä»¬å¨åå»ºä¸ä¸ª python ç web æå¡çéåæ¶ï¼ä¸è¬çåæ³æ¯ï¼å° python ç¯å¢ä¸ä»£ç æåæä¸ä¸ªéåï¼ç¶åå°è¿ä¸ªéåè¿è¡åå¸ã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20221114095752.png"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/12.pod%E4%B8%AD%E5%B0%86%E4%BB%A3%E7%A0%81%E4%B8%8E%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E5%88%86%E7%A6%BB.html",relativePath:"01.äºåç/07.k8s/12.podä¸­å°ä»£ç ä¸è¿è¡ç¯å¢åç¦».md",key:"v-f08b0a92",path:"/pages/27987d/",headers:[{level:2,title:"0. åè¨",slug:"_0-åè¨",normalizedTitle:"0. åè¨",charIndex:2},{level:2,title:"1. æè·¯",slug:"_1-æè·¯",normalizedTitle:"1. æè·¯",charIndex:171},{level:2,title:"2. æ¡ä¾",slug:"_2-æ¡ä¾",normalizedTitle:"2. æ¡ä¾",charIndex:337},{level:3,title:"2.1 åå»ºä»£ç éå",slug:"_2-1-åå»ºä»£ç éå",normalizedTitle:"2.1 åå»ºä»£ç éå",charIndex:347},{level:3,title:"2.2 åå»º python è¿è¡ç¯å¢",slug:"_2-2-åå»º-python-è¿è¡ç¯å¢",normalizedTitle:"2.2 åå»º python è¿è¡ç¯å¢",charIndex:802},{level:3,title:"2.3 å®¹å¨ç¼æ",slug:"_2-3-å®¹å¨ç¼æ",normalizedTitle:"2.3 å®¹å¨ç¼æ",charIndex:1078},{level:2,title:"3. æ»ç»",slug:"_3-æ»ç»",normalizedTitle:"3. æ»ç»",charIndex:2797}],headersStr:"0. åè¨ 1. æè·¯ 2. æ¡ä¾ 2.1 åå»ºä»£ç éå 2.2 åå»º python è¿è¡ç¯å¢ 2.3 å®¹å¨ç¼æ 3. æ»ç»",content:'# 0. åè¨\n\næä»¬å¨åå»ºä¸ä¸ª python ç web æå¡çéåæ¶ï¼ä¸è¬çåæ³æ¯ï¼å° python ç¯å¢ä¸ä»£ç æåæä¸ä¸ªéåï¼ç¶åå°è¿ä¸ªéåè¿è¡åå¸ã\n\nç°å¨æä¸ªéæ±å°±æ¯å° python ç¯å¢åä»£ç åå«æé æä¸¤ä¸ªéåï¼è®©ä»ä»¬è¿è¡è§£è¦ï¼å¹¶ä¸å°ä»ä»¬ç¼æå¨ä¸ä¸ª pod ä¸­ã\n\næ¬æä»ç»å¦ä½å° pod ä¸­çä»£ç ä¸è¿è¡çç¯å¢è¿è¡æåã\n\n\n# 1. æè·¯\n\né¦åæä»¬å°ä»£ç æåæéå Aï¼åå° python è¿è¡ç¯å¢æåæéå Bï¼éè¿ç¼æå¨ Pod ä¸­ç InitContainer è®¾ç½®ä¸ºéå Aï¼å¹¶å°å¶åçä»£ç æ·è´å°æè½½ç emptyDir å­å¨å·ä¸­ï¼ç¶åå¨éå B ä¸­æè½½ç¸åçå­å¨å·ï¼å¨ä½¿ç¨è¿è¡ç¯å¢ä¸­ç python å»æ§è¡å­å¨å·ä¸­æ·è´è¿æ¥çä»£ç å³å¯ã\n\n\n\n\n# 2. æ¡ä¾\n\n\n# 2.1 åå»ºä»£ç éå\n\nååå»ºä¸ä¸ªç®åç python web ç¨åº main.py\n\nfrom flask import Flask\n\napp = Flask(__name__)\n\n\n@app.route("/")\ndef hello_world():\n    return "Hello, World!"\n\napp.run(host="0.0.0.0")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næä»¬ååå»ºåå«ä»£ç éåç Dockerfileï¼åçäºææ¯å° main.py æä»¶æ·è´å°éåçæ ¹ç®å½ä¸ï¼æä»¶å½åä¸ºDockerfile_code\n\nFROM busybox:latest\nCOPY main.py /\n\n\n1\n2\n\n\næä»¬éè¿ docker build å¼å§åå»ºéåï¼éååç§°ä¸º demo_codeï¼é»è®¤ tagä¸º latest\n\ndocker build . -t "demo_code" -f Dockerfile_code\n\n\n1\n\n\nè¿ä¸ªæ¶åæä»¬çä»£ç éååå»ºå¥½äºã\n\n\n# 2.2 åå»º python è¿è¡ç¯å¢\n\næä»¬å¼å§åå»º python è¿è¡ç¯å¢éåç Dockerfileï¼ä»¥ python3 çéåä¸ºåºç¡ï¼å¹¶å®è£ flask åºï¼æä»¶åä¸º Dockerfile_runtime\n\nFROM python:3\nRUN pip install flask\n\n\n1\n2\n\n\nåæå»ºä¸ä¸è¿ä¸ªéåï¼éååä¸º demo_runtimeï¼é»è®¤ tag æ¯ latest\n\ndocker build . -t "demo_runtime" -f Dockerfile_runtime\n\n\n1\n\n\nè¿ä¸ªæ¶åï¼ä¸¤ä¸ªéåé½å·²åå¤å¥½\n\n\n# 2.3 å®¹å¨ç¼æ\n\nåå»º deployments.yaml æä»¶ï¼å¨ Pod ä¸­ç initContainers ä¸­éç½®ä»£ç éå, ç¶åæè½½ä¸´æ¶å­å¨å·ï¼å°ä»£ç å¤å¶å°å­å¨å·ä¸­ã\n\nç¶ååéç½®åºç¨å®¹å¨ python è¿è¡ç¯å¢ï¼æè½½ä¸é¢ç¸åçä¸´æ¶å­å¨å·ï¼ç¶ååä½¿ç¨ python å°ä»£ç è¿è¡ã\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: demo\n  labels:\n    app: demo\nspec:\n  selector:\n    matchLabels:\n      app: demo\n  template:\n    metadata:\n      labels:\n        app: demo\n    spec:\n      initContainers:\n        - image: demo_code:latest\n          name: code\n          imagePullPolicy: IfNotPresent\n          volumeMounts:\n          - mountPath: /opt/demo\n            name: app-volume\n          command: ["cp", "/main.py", "/opt/demo/"]\n      containers:\n        - name: runtime\n          image: demo_runtime:latest\n          imagePullPolicy: IfNotPresent\n          ports:\n            - containerPort: 5000\n              hostPort: 5000\n              protocol: TCP\n              name: http\n          volumeMounts:\n            - mountPath: /opt/demo\n              name: app-volume\n          command: ["python", "/opt/demo/main.py"]\n      volumes:\n      - name: app-volume\n        emptyDir: { }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\næä»¬éè¿ kubectl apply åå»º deployments\n\nkubectl apply -f deployments.yaml\n\n\n1\n\n\næä»¬éè¿ kubectl get pods å¯ä»¥çå° pod å·²ç»åå»ºæåï¼ç¶åæ¾å° pod æå¨çèç¹ãéè¿èç¹ ip+ç«¯å£å³å¯è®¿é®å°å®¹å¨çä¸­æ¥å£ã\n\n[root@k8s-master-07rf9 test]# kubectl get pods -o wide\nNAME                    READY   STATUS    RESTARTS   AGE     IP               NODE               NOMINATED NODE   READINESS GATES\ndemo-6f49db5d6c-25vss   1/1     Running   0          4m58s   10.244.132.130   k8s-master-07rf9   <none>           <none>\n\n\n[root@k8s-master-07rf9 test]# curl 10.65.132.187:5000\nHello, World!\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# 3. æ»ç»\n\næ¬æçç¼ææ¹å¼åªæ¯ pod çè®¾è®¡æ¨¡å¼çä¸ç§ãæå´è¶£çå¯ä»¥äºè§£æ´å¤ã\n\néè¿è¿ç§æ¹å¼å¯ä»¥è®©ä»£ç ä¸è¿è¡ç¯å¢è§£è¦ï¼å½æä»¬æ´æ°ä»£ç æ¶ï¼å¹¶ä¸ä¼å½±åå°è¿è¡ç¯å¢ã',normalizedContent:'# 0. åè¨\n\næä»¬å¨åå»ºä¸ä¸ª python ç web æå¡çéåæ¶ï¼ä¸è¬çåæ³æ¯ï¼å° python ç¯å¢ä¸ä»£ç æåæä¸ä¸ªéåï¼ç¶åå°è¿ä¸ªéåè¿è¡åå¸ã\n\nç°å¨æä¸ªéæ±å°±æ¯å° python ç¯å¢åä»£ç åå«æé æä¸¤ä¸ªéåï¼è®©ä»ä»¬è¿è¡è§£è¦ï¼å¹¶ä¸å°ä»ä»¬ç¼æå¨ä¸ä¸ª pod ä¸­ã\n\næ¬æä»ç»å¦ä½å° pod ä¸­çä»£ç ä¸è¿è¡çç¯å¢è¿è¡æåã\n\n\n# 1. æè·¯\n\né¦åæä»¬å°ä»£ç æåæéå aï¼åå° python è¿è¡ç¯å¢æåæéå bï¼éè¿ç¼æå¨ pod ä¸­ç initcontainer è®¾ç½®ä¸ºéå aï¼å¹¶å°å¶åçä»£ç æ·è´å°æè½½ç emptydir å­å¨å·ä¸­ï¼ç¶åå¨éå b ä¸­æè½½ç¸åçå­å¨å·ï¼å¨ä½¿ç¨è¿è¡ç¯å¢ä¸­ç python å»æ§è¡å­å¨å·ä¸­æ·è´è¿æ¥çä»£ç å³å¯ã\n\n\n\n\n# 2. æ¡ä¾\n\n\n# 2.1 åå»ºä»£ç éå\n\nååå»ºä¸ä¸ªç®åç python web ç¨åº main.py\n\nfrom flask import flask\n\napp = flask(__name__)\n\n\n@app.route("/")\ndef hello_world():\n    return "hello, world!"\n\napp.run(host="0.0.0.0")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næä»¬ååå»ºåå«ä»£ç éåç dockerfileï¼åçäºææ¯å° main.py æä»¶æ·è´å°éåçæ ¹ç®å½ä¸ï¼æä»¶å½åä¸ºdockerfile_code\n\nfrom busybox:latest\ncopy main.py /\n\n\n1\n2\n\n\næä»¬éè¿ docker build å¼å§åå»ºéåï¼éååç§°ä¸º demo_codeï¼é»è®¤ tagä¸º latest\n\ndocker build . -t "demo_code" -f dockerfile_code\n\n\n1\n\n\nè¿ä¸ªæ¶åæä»¬çä»£ç éååå»ºå¥½äºã\n\n\n# 2.2 åå»º python è¿è¡ç¯å¢\n\næä»¬å¼å§åå»º python è¿è¡ç¯å¢éåç dockerfileï¼ä»¥ python3 çéåä¸ºåºç¡ï¼å¹¶å®è£ flask åºï¼æä»¶åä¸º dockerfile_runtime\n\nfrom python:3\nrun pip install flask\n\n\n1\n2\n\n\nåæå»ºä¸ä¸è¿ä¸ªéåï¼éååä¸º demo_runtimeï¼é»è®¤ tag æ¯ latest\n\ndocker build . -t "demo_runtime" -f dockerfile_runtime\n\n\n1\n\n\nè¿ä¸ªæ¶åï¼ä¸¤ä¸ªéåé½å·²åå¤å¥½\n\n\n# 2.3 å®¹å¨ç¼æ\n\nåå»º deployments.yaml æä»¶ï¼å¨ pod ä¸­ç initcontainers ä¸­éç½®ä»£ç éå, ç¶åæè½½ä¸´æ¶å­å¨å·ï¼å°ä»£ç å¤å¶å°å­å¨å·ä¸­ã\n\nç¶ååéç½®åºç¨å®¹å¨ python è¿è¡ç¯å¢ï¼æè½½ä¸é¢ç¸åçä¸´æ¶å­å¨å·ï¼ç¶ååä½¿ç¨ python å°ä»£ç è¿è¡ã\n\napiversion: apps/v1\nkind: deployment\nmetadata:\n  name: demo\n  labels:\n    app: demo\nspec:\n  selector:\n    matchlabels:\n      app: demo\n  template:\n    metadata:\n      labels:\n        app: demo\n    spec:\n      initcontainers:\n        - image: demo_code:latest\n          name: code\n          imagepullpolicy: ifnotpresent\n          volumemounts:\n          - mountpath: /opt/demo\n            name: app-volume\n          command: ["cp", "/main.py", "/opt/demo/"]\n      containers:\n        - name: runtime\n          image: demo_runtime:latest\n          imagepullpolicy: ifnotpresent\n          ports:\n            - containerport: 5000\n              hostport: 5000\n              protocol: tcp\n              name: http\n          volumemounts:\n            - mountpath: /opt/demo\n              name: app-volume\n          command: ["python", "/opt/demo/main.py"]\n      volumes:\n      - name: app-volume\n        emptydir: { }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\næä»¬éè¿ kubectl apply åå»º deployments\n\nkubectl apply -f deployments.yaml\n\n\n1\n\n\næä»¬éè¿ kubectl get pods å¯ä»¥çå° pod å·²ç»åå»ºæåï¼ç¶åæ¾å° pod æå¨çèç¹ãéè¿èç¹ ip+ç«¯å£å³å¯è®¿é®å°å®¹å¨çä¸­æ¥å£ã\n\n[root@k8s-master-07rf9 test]# kubectl get pods -o wide\nname                    ready   status    restarts   age     ip               node               nominated node   readiness gates\ndemo-6f49db5d6c-25vss   1/1     running   0          4m58s   10.244.132.130   k8s-master-07rf9   <none>           <none>\n\n\n[root@k8s-master-07rf9 test]# curl 10.65.132.187:5000\nhello, world!\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# 3. æ»ç»\n\næ¬æçç¼ææ¹å¼åªæ¯ pod çè®¾è®¡æ¨¡å¼çä¸ç§ãæå´è¶£çå¯ä»¥äºè§£æ´å¤ã\n\néè¿è¿ç§æ¹å¼å¯ä»¥è®©ä»£ç ä¸è¿è¡ç¯å¢è§£è¦ï¼å½æä»¬æ´æ°ä»£ç æ¶ï¼å¹¶ä¸ä¼å½±åå°è¿è¡ç¯å¢ã',charsets:{cjk:!0},lastUpdated:"2023/02/07, 09:44:40",lastUpdatedTimestamp:167573428e4},{title:"djangoåç«¯æå¡ãlogstashåflinkæ¥å¥VictoriaMetricsææ çæ§",frontmatter:{title:"djangoåç«¯æå¡ãlogstashåflinkæ¥å¥VictoriaMetricsææ çæ§",date:"2023-02-21T11:05:03.000Z",permalink:"/pages/b1b4a3/",categories:["äºåç","k8s"],tags:[null],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"éè¿ææ çæ§å¯ä»¥è®¾ç½®å¯¹åºçåè­¦ï¼å¿«éåç°é®é¢ï¼å¹¶éè¿ç¸åºçææ å®ä½é®é¢ã",comment:!0,feed:{enable:!0},meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20230221110733.png"},{name:"twitter:title",content:"djangoåç«¯æå¡ãlogstashåflinkæ¥å¥VictoriaMetricsææ çæ§"},{name:"twitter:description",content:"éè¿ææ çæ§å¯ä»¥è®¾ç½®å¯¹åºçåè­¦ï¼å¿«éåç°é®é¢ï¼å¹¶éè¿ç¸åºçææ å®ä½é®é¢ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20230221110733.png"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/13.django%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E3%80%81logstash%E5%92%8Cflink%E6%8E%A5%E5%85%A5VictoriaMetrics%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7.html"},{property:"og:type",content:"article"},{property:"og:title",content:"djangoåç«¯æå¡ãlogstashåflinkæ¥å¥VictoriaMetricsææ çæ§"},{property:"og:description",content:"éè¿ææ çæ§å¯ä»¥è®¾ç½®å¯¹åºçåè­¦ï¼å¿«éåç°é®é¢ï¼å¹¶éè¿ç¸åºçææ å®ä½é®é¢ã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20230221110733.png"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/13.django%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E3%80%81logstash%E5%92%8Cflink%E6%8E%A5%E5%85%A5VictoriaMetrics%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-02-21T11:05:03.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"djangoåç«¯æå¡ãlogstashåflinkæ¥å¥VictoriaMetricsææ çæ§"},{itemprop:"description",content:"éè¿ææ çæ§å¯ä»¥è®¾ç½®å¯¹åºçåè­¦ï¼å¿«éåç°é®é¢ï¼å¹¶éè¿ç¸åºçææ å®ä½é®é¢ã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20230221110733.png"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/13.django%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E3%80%81logstash%E5%92%8Cflink%E6%8E%A5%E5%85%A5VictoriaMetrics%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7.html",relativePath:"01.äºåç/07.k8s/13.djangoåç«¯æå¡ãlogstashåflinkæ¥å¥VictoriaMetricsææ çæ§.md",key:"v-0fd01db7",path:"/pages/b1b4a3/",headers:[{level:2,title:"0.ç®ä»",slug:"_0-ç®ä»",normalizedTitle:"0.ç®ä»",charIndex:2},{level:2,title:"1.VictoriaMetrics",slug:"_1-victoriametrics",normalizedTitle:"1.victoriametrics",charIndex:172},{level:2,title:"2.django æå¡æ¥å¥",slug:"_2-django-æå¡æ¥å¥",normalizedTitle:"2.django æå¡æ¥å¥",charIndex:376},{level:2,title:"3.logstash æ¥å¥",slug:"_3-logstash-æ¥å¥",normalizedTitle:"3.logstash æ¥å¥",charIndex:799},{level:2,title:"4.flink æ¥å¥çæ§",slug:"_4-flink-æ¥å¥çæ§",normalizedTitle:"4.flink æ¥å¥çæ§",charIndex:1515},{level:2,title:"5.VMPodScrape",slug:"_5-vmpodscrape",normalizedTitle:"5.vmpodscrape",charIndex:1844}],headersStr:"0.ç®ä» 1.VictoriaMetrics 2.django æå¡æ¥å¥ 3.logstash æ¥å¥ 4.flink æ¥å¥çæ§ 5.VMPodScrape",content:'# 0.ç®ä»\n\néè¿ææ çæ§å¯ä»¥è®¾ç½®å¯¹åºçåè­¦ï¼å¿«éåç°é®é¢ï¼å¹¶éè¿ç¸åºçææ å®ä½é®é¢ã\n\nèæ¯ï¼ä½¿ç¨ç VictoriaMetrics(ç®ç§° VM) ä½ä¸ºçæ§çè§£å³æ¹æ¡ï¼éè¦å° django æå¡ãlogstash å flink å¼ææ¥å¥è¿æ¥ï¼VM å¯ä»¥å®æ¶çè·åå®ä»¬çææ å­å¨å¹¶è¿è¡çæ§åè­¦ï¼ä»¥ä¸çæå¡é½æ¯é¨ç½²å¨ k8s ä¸­çã\n\n\n# 1.VictoriaMetrics\n\nVictoriaMetricsï¼æ¯ä¸ä¸ªå¿«éé«æãç»æµå¹¶ä¸å¯æ©å±ççæ§è§£å³æ¹æ¡åæ¶åºæ°æ®åºãæ¯è¾åºåççæ§æ¹æ¡æ Promethuesï¼è VM æ¯å¼å®¹ Promethues çåç§è§èãéç½®ç­ï¼å¯ä»¥å¿«éçèå¥ Promethues çæçè³æ¯åä»£å®ã\n\nVM è·åæå¡ææ çæ¹å¼ä¹æ¯éè¿ä¸»å¨æåçæ¹å¼ï¼æ¯ä¸ªæå¡é½ä¼æ´é²ä¸ä¸ªç«¯å£ä¾ VM æ¥æåæå¡çææ ä¿¡æ¯\n\n\n\n\n# 2.django æå¡æ¥å¥\n\nå¯ä»¥éè¿ä½¿ç¨ç¬¬ä¸æ¹åº prometheus-client æ¥æ¶éæå¡çææ ä¿¡æ¯ï¼å¹¶æ´é²ç«¯å£ç» VM æåã\n\n * å®è£\n\npip install prometheus-client\n\n\n1\n\n * ä½¿ç¨\n\nå ä¸ºè¯¥æå¡ä½¿ç¨çæ¯ wsgi åè®®çï¼æä»¥å¨ wsgi.py æä»¶ä¸­æ·»å ä»¥ä¸ä»£ç ï¼ä¼å¼å¯ä¸ä¸ªæ°ççº¿ç¨çå¬ 9300 ç«¯å£ï¼è¯·æ±è¯¥ç«¯å£å¯ä»¥è·åå½åæå¡çåæ°ææ ã\n\nfrom prometheus_client import start_wsgi_server\nstart_wsgi_server(9300)\n\n\n1\n2\n\n\nå¦ææ³è¦ä¸æ¥ä¸å¡ææ ï¼å¯ä»¥éè¿è¯¥åºå¨ä¸å¡ä¸­è¿è¡åç¹åæ¶éã\n\nè¿éè¦å¨ pod ä¸­æ·»å  ports å±æ§æä¾ç» VM ä½¿ç¨ï¼è¿ä¸ªå¨åé¢è®²è§£ã\n\n- containerPort: 9300\n  name: exportport\n  protocol: TCP\n\n\n1\n2\n3\n\n\n\n# 3.logstash æ¥å¥\n\nlogstash æ¯æèªå·±çææ çæ§æå¡ï¼éè¦å¨éç½®æä»¶ logstash.yaml ä¸­å°å¶ç«¯å£æ´é²ã\n\nhttp.port: 9600\n\n\n1\n\n\nä½æ¯å¶ææ æ ¼å¼å prometheus çææ æ ¼å¼æ¯ä¸åçï¼æä»¥éè¦éè¿å¦ä¸ä¸ªç¨åº exporter æ¥å° logstash ææ è½¬æ¢æ prometheus ææ æ ¼å¼ã\n\nè¯¥ logstash æ¯é¨ç½²å¨ k8s ä¸­çï¼ä½¿ç¨å°å®¹å¨è®¾è®¡æ¨¡å¼ sidecarï¼å°±æ¯å¨ pod ä¸­æ°å¢ä¸ä¸ªå®¹å¨æ¥è¾å©ä¸»å®¹å¨ logstash æ¥åçæ§ææ çè½¬æ¢å¹¶æä¾ç» VM è°ç¨ã\n\n\n\nlogstash ç exporter å¯ä»¥ä½¿ç¨ prometheus-logstash-exporter æ¥å®æï¼å¯ä»¥å» docker hub ä¸­æ¾å°å¯¹åºçéåï¼å¹¶å°å¶ä¸è½½ä¸æ¥ä½¿ç¨ã\n\nå¨ logstash ç pod ä¸­æ·»å ä»¥ä¸éç½®æ¥è®¾ç½® exporterï¼å°æ´é² 9300 ç«¯å£ä½ä¸º logstash çææ çæ§ç«¯å£ç» VM æåãè¿ééè¦éç½® portsï¼å¨ VM ä¸­éè¦ä½¿ç¨è¯¥åæ°ã\n\n- name: logstash-exporter\nimage: alxrem/prometheus-logstash-exporter:0.7.0\nargs:\n- -logstash.host\n- 127.0.0.1\n- -logstash.port\n- 9600\n- -web.listen-address\n- 9300\nports:\n- name: exportport\n  containerPort: 9300\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# 4.flink æ¥å¥çæ§\n\nflink æ¬èº«æ¯æ¯æ prometheus çææ çæ§ï¼åªéè¦éè¿æ·»å éç½® flink çåæ°å³å¯å¼å¯ã\n\n  metrics.reporters: prom\n  metrics.reporter.prom.class: org.apache.flink.metrics.prometheus.PrometheusReporter\n  metrics.reporter.prom.port: "9300"\n\n\n1\n2\n3\n\n\né¤äºä¸é¢çéç½®å¤ï¼è¿éè¦å¨ Pod ä¸­è®¾ç½® ports æ¥ä¾ VM ä½¿ç¨ã\n\nports:\n  - name: exportport\n\tcontainerPort: 9300\n\n\n1\n2\n3\n\n\n\n# 5.VMPodScrape\n\nè½ç¶ä¸é¢çæå¡é½æ´é²äºææ ç«¯å£ï¼VM å¦ä½æ¾å°å®ä»¬å¢ï¼éè¦éè¿åå»º VMPodScrape çèµæºå¯¹è±¡æ¥å¸®å© VM æ¥æ¾å°å®ä»¬ã\n\néç½®å¦ä¸ï¼\n\napiVersion: operator.victoriametrics.com/v1beta1\nkind: VMPodScrape\nmetadata:\n  labels:\n    prometheus: k8s\n  name: demo-pod-monitor          \n  namespace: monitor\nspec:\n  namespaceSelector:\n    any: true                   \n  podMetricsEndpoints:\n    - path: /metrics            \n      port: exportport          \n  selector:\n    matchLabels:\n      app: django\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n * spec.podMetricsEndpoints.portï¼è¿ä¸ªå°±æ¯å¨æ¯ä¸ª pod ä¸­æ·»å ç ports ä¸­å¯¹åºç nameï¼VM ä¼å»æ¾å°å¯¹åº name çç«¯å£è·åææ \n * spec.selector.matchLabelsï¼éè¿æ ç­¾è¿æ»¤æ¾å°æå®ç pod\n\néè¿ kubectl apply -f åå»ºè¯¥èµæºå¯¹è±¡ï¼VM å°±è½æ¾å°ææ æä¾çæå¡ã',normalizedContent:'# 0.ç®ä»\n\néè¿ææ çæ§å¯ä»¥è®¾ç½®å¯¹åºçåè­¦ï¼å¿«éåç°é®é¢ï¼å¹¶éè¿ç¸åºçææ å®ä½é®é¢ã\n\nèæ¯ï¼ä½¿ç¨ç victoriametrics(ç®ç§° vm) ä½ä¸ºçæ§çè§£å³æ¹æ¡ï¼éè¦å° django æå¡ãlogstash å flink å¼ææ¥å¥è¿æ¥ï¼vm å¯ä»¥å®æ¶çè·åå®ä»¬çææ å­å¨å¹¶è¿è¡çæ§åè­¦ï¼ä»¥ä¸çæå¡é½æ¯é¨ç½²å¨ k8s ä¸­çã\n\n\n# 1.victoriametrics\n\nvictoriametricsï¼æ¯ä¸ä¸ªå¿«éé«æãç»æµå¹¶ä¸å¯æ©å±ççæ§è§£å³æ¹æ¡åæ¶åºæ°æ®åºãæ¯è¾åºåççæ§æ¹æ¡æ promethuesï¼è vm æ¯å¼å®¹ promethues çåç§è§èãéç½®ç­ï¼å¯ä»¥å¿«éçèå¥ promethues çæçè³æ¯åä»£å®ã\n\nvm è·åæå¡ææ çæ¹å¼ä¹æ¯éè¿ä¸»å¨æåçæ¹å¼ï¼æ¯ä¸ªæå¡é½ä¼æ´é²ä¸ä¸ªç«¯å£ä¾ vm æ¥æåæå¡çææ ä¿¡æ¯\n\n\n\n\n# 2.django æå¡æ¥å¥\n\nå¯ä»¥éè¿ä½¿ç¨ç¬¬ä¸æ¹åº prometheus-client æ¥æ¶éæå¡çææ ä¿¡æ¯ï¼å¹¶æ´é²ç«¯å£ç» vm æåã\n\n * å®è£\n\npip install prometheus-client\n\n\n1\n\n * ä½¿ç¨\n\nå ä¸ºè¯¥æå¡ä½¿ç¨çæ¯ wsgi åè®®çï¼æä»¥å¨ wsgi.py æä»¶ä¸­æ·»å ä»¥ä¸ä»£ç ï¼ä¼å¼å¯ä¸ä¸ªæ°ççº¿ç¨çå¬ 9300 ç«¯å£ï¼è¯·æ±è¯¥ç«¯å£å¯ä»¥è·åå½åæå¡çåæ°ææ ã\n\nfrom prometheus_client import start_wsgi_server\nstart_wsgi_server(9300)\n\n\n1\n2\n\n\nå¦ææ³è¦ä¸æ¥ä¸å¡ææ ï¼å¯ä»¥éè¿è¯¥åºå¨ä¸å¡ä¸­è¿è¡åç¹åæ¶éã\n\nè¿éè¦å¨ pod ä¸­æ·»å  ports å±æ§æä¾ç» vm ä½¿ç¨ï¼è¿ä¸ªå¨åé¢è®²è§£ã\n\n- containerport: 9300\n  name: exportport\n  protocol: tcp\n\n\n1\n2\n3\n\n\n\n# 3.logstash æ¥å¥\n\nlogstash æ¯æèªå·±çææ çæ§æå¡ï¼éè¦å¨éç½®æä»¶ logstash.yaml ä¸­å°å¶ç«¯å£æ´é²ã\n\nhttp.port: 9600\n\n\n1\n\n\nä½æ¯å¶ææ æ ¼å¼å prometheus çææ æ ¼å¼æ¯ä¸åçï¼æä»¥éè¦éè¿å¦ä¸ä¸ªç¨åº exporter æ¥å° logstash ææ è½¬æ¢æ prometheus ææ æ ¼å¼ã\n\nè¯¥ logstash æ¯é¨ç½²å¨ k8s ä¸­çï¼ä½¿ç¨å°å®¹å¨è®¾è®¡æ¨¡å¼ sidecarï¼å°±æ¯å¨ pod ä¸­æ°å¢ä¸ä¸ªå®¹å¨æ¥è¾å©ä¸»å®¹å¨ logstash æ¥åçæ§ææ çè½¬æ¢å¹¶æä¾ç» vm è°ç¨ã\n\n\n\nlogstash ç exporter å¯ä»¥ä½¿ç¨ prometheus-logstash-exporter æ¥å®æï¼å¯ä»¥å» docker hub ä¸­æ¾å°å¯¹åºçéåï¼å¹¶å°å¶ä¸è½½ä¸æ¥ä½¿ç¨ã\n\nå¨ logstash ç pod ä¸­æ·»å ä»¥ä¸éç½®æ¥è®¾ç½® exporterï¼å°æ´é² 9300 ç«¯å£ä½ä¸º logstash çææ çæ§ç«¯å£ç» vm æåãè¿ééè¦éç½® portsï¼å¨ vm ä¸­éè¦ä½¿ç¨è¯¥åæ°ã\n\n- name: logstash-exporter\nimage: alxrem/prometheus-logstash-exporter:0.7.0\nargs:\n- -logstash.host\n- 127.0.0.1\n- -logstash.port\n- 9600\n- -web.listen-address\n- 9300\nports:\n- name: exportport\n  containerport: 9300\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# 4.flink æ¥å¥çæ§\n\nflink æ¬èº«æ¯æ¯æ prometheus çææ çæ§ï¼åªéè¦éè¿æ·»å éç½® flink çåæ°å³å¯å¼å¯ã\n\n  metrics.reporters: prom\n  metrics.reporter.prom.class: org.apache.flink.metrics.prometheus.prometheusreporter\n  metrics.reporter.prom.port: "9300"\n\n\n1\n2\n3\n\n\né¤äºä¸é¢çéç½®å¤ï¼è¿éè¦å¨ pod ä¸­è®¾ç½® ports æ¥ä¾ vm ä½¿ç¨ã\n\nports:\n  - name: exportport\n\tcontainerport: 9300\n\n\n1\n2\n3\n\n\n\n# 5.vmpodscrape\n\nè½ç¶ä¸é¢çæå¡é½æ´é²äºææ ç«¯å£ï¼vm å¦ä½æ¾å°å®ä»¬å¢ï¼éè¦éè¿åå»º vmpodscrape çèµæºå¯¹è±¡æ¥å¸®å© vm æ¥æ¾å°å®ä»¬ã\n\néç½®å¦ä¸ï¼\n\napiversion: operator.victoriametrics.com/v1beta1\nkind: vmpodscrape\nmetadata:\n  labels:\n    prometheus: k8s\n  name: demo-pod-monitor          \n  namespace: monitor\nspec:\n  namespaceselector:\n    any: true                   \n  podmetricsendpoints:\n    - path: /metrics            \n      port: exportport          \n  selector:\n    matchlabels:\n      app: django\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n * spec.podmetricsendpoints.portï¼è¿ä¸ªå°±æ¯å¨æ¯ä¸ª pod ä¸­æ·»å ç ports ä¸­å¯¹åºç nameï¼vm ä¼å»æ¾å°å¯¹åº name çç«¯å£è·åææ \n * spec.selector.matchlabelsï¼éè¿æ ç­¾è¿æ»¤æ¾å°æå®ç pod\n\néè¿ kubectl apply -f åå»ºè¯¥èµæºå¯¹è±¡ï¼vm å°±è½æ¾å°ææ æä¾çæå¡ã',charsets:{cjk:!0},lastUpdated:"2023/02/21, 11:15:06",lastUpdatedTimestamp:1676949306e3},{title:"çè§£calicoå®¹å¨ç½ç»éä¿¡æ¹æ¡åç",frontmatter:{title:"çè§£calicoå®¹å¨ç½ç»éä¿¡æ¹æ¡åç",date:"2023-06-03T11:04:25.000Z",permalink:"/pages/f0f725/",categories:["äºåç","k8s"],tags:["k8s","å®¹å¨","äºåç","è®¡ç®æºç½ç»","Linuxç½ç»èæå"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"Calicoæ¯k8sä¸­å¸¸ç¨çå®¹å¨è§£å³æ¹æ¡çæä»¶ï¼æ¬æä¸»è¦ä»ç»BGPæ¨¡å¼åIPIPæ¨¡å¼æ¯å¦ä½è§£å³çï¼å¹¶è¯¦ç»äºè§£å¶åçï¼å¹¶éè¿å®éªå æ·±çè§£ã",comment:!0,feed:{enable:!0},meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/c__Users_User_OneDrive_workspace_excalidraw_calico.png"},{name:"twitter:title",content:"çè§£calicoå®¹å¨ç½ç»éä¿¡æ¹æ¡åç"},{name:"twitter:description",content:"Calicoæ¯k8sä¸­å¸¸ç¨çå®¹å¨è§£å³æ¹æ¡çæä»¶ï¼æ¬æä¸»è¦ä»ç»BGPæ¨¡å¼åIPIPæ¨¡å¼æ¯å¦ä½è§£å³çï¼å¹¶è¯¦ç»äºè§£å¶åçï¼å¹¶éè¿å®éªå æ·±çè§£ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/c__Users_User_OneDrive_workspace_excalidraw_calico.png"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/15.%E7%90%86%E8%A7%A3calico%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E6%96%B9%E6%A1%88%E5%8E%9F%E7%90%86.html"},{property:"og:type",content:"article"},{property:"og:title",content:"çè§£calicoå®¹å¨ç½ç»éä¿¡æ¹æ¡åç"},{property:"og:description",content:"Calicoæ¯k8sä¸­å¸¸ç¨çå®¹å¨è§£å³æ¹æ¡çæä»¶ï¼æ¬æä¸»è¦ä»ç»BGPæ¨¡å¼åIPIPæ¨¡å¼æ¯å¦ä½è§£å³çï¼å¹¶è¯¦ç»äºè§£å¶åçï¼å¹¶éè¿å®éªå æ·±çè§£ã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/c__Users_User_OneDrive_workspace_excalidraw_calico.png"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/15.%E7%90%86%E8%A7%A3calico%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E6%96%B9%E6%A1%88%E5%8E%9F%E7%90%86.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-06-03T11:04:25.000Z"},{property:"article:tag",content:"k8s"},{property:"article:tag",content:"å®¹å¨"},{property:"article:tag",content:"äºåç"},{property:"article:tag",content:"è®¡ç®æºç½ç»"},{property:"article:tag",content:"Linuxç½ç»èæå"},{itemprop:"name",content:"çè§£calicoå®¹å¨ç½ç»éä¿¡æ¹æ¡åç"},{itemprop:"description",content:"Calicoæ¯k8sä¸­å¸¸ç¨çå®¹å¨è§£å³æ¹æ¡çæä»¶ï¼æ¬æä¸»è¦ä»ç»BGPæ¨¡å¼åIPIPæ¨¡å¼æ¯å¦ä½è§£å³çï¼å¹¶è¯¦ç»äºè§£å¶åçï¼å¹¶éè¿å®éªå æ·±çè§£ã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/c__Users_User_OneDrive_workspace_excalidraw_calico.png"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/15.%E7%90%86%E8%A7%A3calico%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E6%96%B9%E6%A1%88%E5%8E%9F%E7%90%86.html",relativePath:"01.äºåç/07.k8s/15.çè§£calicoå®¹å¨ç½ç»éä¿¡æ¹æ¡åç.md",key:"v-11e81284",path:"/pages/f0f725/",headers:[{level:2,title:"0. åè¨",slug:"_0-åè¨",normalizedTitle:"0. åè¨",charIndex:2},{level:2,title:"1. ä»ç»Calico",slug:"_1-ä»ç»calico",normalizedTitle:"1. ä»ç»calico",charIndex:82},{level:2,title:"2. Calioæ¶æ",slug:"_2-calioæ¶æ",normalizedTitle:"2. calioæ¶æ",charIndex:585},{level:2,title:"3. BGPæ¨¡å¼",slug:"_3-bgpæ¨¡å¼",normalizedTitle:"3. bgpæ¨¡å¼",charIndex:1154},{level:2,title:"4. æå¨æ¨¡æBGPæ¨¡å¼å®éª",slug:"_4-æå¨æ¨¡æbgpæ¨¡å¼å®éª",normalizedTitle:"4. æå¨æ¨¡æbgpæ¨¡å¼å®éª",charIndex:1397},{level:3,title:"4.1 æä½",slug:"_4-1-æä½",normalizedTitle:"4.1 æä½",charIndex:1418},{level:3,title:"4.2 åæ",slug:"_4-2-åæ",normalizedTitle:"4.2 åæ",charIndex:3211},{level:2,title:"5. IPIPé§éæ¨¡å¼",slug:"_5-ipipé§éæ¨¡å¼",normalizedTitle:"5. ipipé§éæ¨¡å¼",charIndex:5636}],headersStr:"0. åè¨ 1. ä»ç»Calico 2. Calioæ¶æ 3. BGPæ¨¡å¼ 4. æå¨æ¨¡æBGPæ¨¡å¼å®éª 4.1 æä½ 4.2 åæ 5. IPIPé§éæ¨¡å¼",content:"# 0. åè¨\n\nCalicoæ¯k8sä¸­å¸¸ç¨çå®¹å¨è§£å³æ¹æ¡çæä»¶ï¼æ¬æä¸»è¦ä»ç»BGPæ¨¡å¼åIPIPæ¨¡å¼æ¯å¦ä½è§£å³çï¼å¹¶è¯¦ç»äºè§£å¶åçï¼å¹¶éè¿å®éªå æ·±çè§£ã\n\n\n# 1. ä»ç»Calico\n\nCalicoæ¯å±äºçº¯3å±çç½ç»æ¨¡åï¼æ¯ä¸ªå®¹å¨é½éè¿IPç´æ¥éä¿¡ï¼ä¸­é´éè¿è·¯ç±è½¬åæ¾å°å¯¹æ¹ãå®¹å¨æå¨çèç¹ç±»ä¼¼äºä¼ ç»çè·¯ç±å¨ï¼æä¾äºè·¯ç±æ¥æ¾çåè½ãæ¯ä¸ªå®¹å¨æå¨çä¸»æºèç¹æ®æ¼äºèæè·¯ç±å¨ ï¼vRouterï¼çåè½ï¼vRouterå¿é¡»ææç§æ¹æ³ï¼è½å¤ç¥éæ´ä¸ªéç¾¤çè·¯ç±ä¿¡æ¯ã\n\nä¹åæå°çFlannelHost Gatewayæ¨¡å¼æ¹æ¡æ¯ä¸è½è·¨äºå±ç½ç»ï¼æ¯å ä¸ºå®åªè½ä¿®æ¹ä¸»æºè·¯ç±ï¼Calicoææ¹è·¯ç±è¡¨çåæ³æ¢æäºæ åçBGPè·¯ç±åè®®ãç¸å½äºå¨æ¯ä¸ªèç¹ä¸æ¨¡æåºä¸ä¸ªé¢å¤çè·¯ç±å¨ï¼ç±äºéç¨çæ¯æ ååè®®ï¼Calicoæ¨¡æè·¯ç±å¨çè·¯ç±è¡¨ä¿¡æ¯å¯ä»¥è¢«ä¼ æ­å°ç½ç»çå¶ä»è·¯ç±è®¾å¤ä¸­ï¼è¿æ ·å°±å®ç°äºå¨ä¸å±ç½ç»ä¸çé«éè·¨èç¹ç½ç»ã\n\n> BGPï¼Border Gateway Protocolï¼æ¯ä¸ç§ç¨äºå¨äºèç½ä¸­äº¤æ¢è·¯ç±ä¿¡æ¯çåè®®ãå®æ¯ä¸ç§èªæ²»ç³»ç»ï¼ASï¼ä¹é´çè·¯ç±åè®®ï¼ç¨äºå¨ä¸åçèªæ²»ç³»ç»ä¹é´äº¤æ¢è·¯ç±ä¿¡æ¯ãBGPåè®®çä¸»è¦ä½ç¨æ¯å°è·¯ç±ä¿¡æ¯ä»ä¸ä¸ªèªæ²»ç³»ç»ä¼ éå°å¦ä¸ä¸ªèªæ²»ç³»ç»ï¼ä»¥ä¾¿å®ç°äºèç½çå¨çè·¯ç±ã\n\nä½ç°å®ä¸­çç½ç»å¹¶ä¸ä¸å®æ¯æBGPè·¯ç±ï¼å¨è¿ç§æåµä¸å¯ä»¥ä½¿ç¨IPIPé§éæ¨¡å¼æ¥ä¼ è¾æ°æ®ã\n\n\n# 2. Calioæ¶æ\n\n\n\nFelix\n\nFelixæ¯ä¸ä¸ªå®æ¤ç¨åºï¼ä½ä¸ºagentè¿è¡å¨æç®¡å®¹å¨æèææºçCalicoèç¹ä¸ãFelixè´è´£å·æ°ä¸»æºè·¯ç±åACLè§åç­ï¼ä»¥ä¾¿ä¸ºè¯¥ä¸»æºä¸çEndpointæ­£å¸¸è¿è¡æä¾æéçç½ç»è¿æ¥åç®¡çãè¿åºå®¹å¨ãèææºåç©çä¸»æºçæææµéé½ä¼éåCalicoï¼å©ç¨Linuxåæ ¸åççè·¯ç±åiptablesçæçè§åã\n\nBGP Client\n\nCalicoå¨æ¯ä¸ªè¿è¡Felixæå¡çèç¹ä¸é½é¨ç½²ä¸ä¸ªBGP Clientï¼BGPå®¢æ·ç«¯ï¼ãBGPå®¢æ·ç«¯çä½ç¨æ¯è¯»åFelixç¼åå°åæ ¸ä¸­çè·¯ç±ä¿¡æ¯ï¼ç±BGPå®¢æ·ç«¯å¯¹è¿äºè·¯ç±ä¿¡æ¯è¿è¡ååãå½Felixå°è·¯ç±æå¥Linuxåæ ¸æ¶ï¼BGPå®¢æ·ç«¯å°æ¥æ¶å®ä»¬ï¼å¹¶å°å®ä»¬ååå°éç¾¤ä¸­çå¶ä»å·¥ä½èç¹ã\n\nNode-to-Node Mesh\n\nè¯¥æ¨¡å¼ä¸ºé»è®¤æ¨¡å¼ï¼å¨BGPä¸ï¼éç¾¤ä¸­çæ¯ä¸ä¸ªèç¹çBGP Clienté½éè¦åå¶ä»ææèç¹çBGP Clientè¿è¡éä¿¡æ¥äº¤æ¢è·¯ç±ã\nä½éçèç¹æ°éå¢å ï¼è¿æ¥æ°ä¼ä»¥N^2è§æ¨¡å¢å ï¼ç»éç¾¤ç½ç»å¸¦æ¥å·¨å¤§çååã\n\nBGP Route Reflector\n\nCalicoä¼æå®å ä¸ªèç¹è´è´£ä¸é¨è·å¶ä»ææèç¹è¿è¡è¿æ¥å¹¶äº¤æ¢è·¯ç±ä¿¡æ¯ï¼ä»èå­¦ä¹ å°å¨å±çè·¯ç±ä¿¡æ¯ãèå¶ä»èç¹ä¹åªéè¦è·è¿å ä¸ªèç¹è¿è¡éä¿¡æ¥è·åå°æ´ä¸ªéç¾¤çè§åä¿¡æ¯ã\n\n\n\n\n# 3. BGPæ¨¡å¼\n\n\n\næ¯ä¸ªå®¹å¨é½ä¼åå»ºä¸å¯¹veth pairç½å¡ï¼ä¸ç«¯æ¾å¨å®¹å¨åé¨ï¼å¦ä¸ç«¯æ¾å¨å®¿ä¸»æºä¸­ï¼å®¹å¨ä¸­åéçIPåéè¿veth pairç½å¡å¯ä»¥è¾¾å°å®¿ä¸»æºçç½ç»åè®®æ ä¸­ã\n\nFelixä¼éè¿çå¬etcdæ¥è·åå¶ä»èç¹çç¸å³ä¿¡æ¯ï¼ç¶åæ·»å æ¬å°è·¯ç±ï¼\n\n 1. éå¾å¶ä»èç¹å®¹å¨çIPåä¸ä¸æ¡å°å¶èç¹ç©çç½å¡ä¸­ã\n 2. éè¿æ¬æºèç¹å®¹å¨çIPåå°calixxxç½å¡ä¸­ï¼ç¶åè¿å¥å°å®¹å¨ä¸­ã\n\nBGP Clientä¼è¯»åFelixåå¥å°æ¬å°çè·¯ç±ï¼åéè¿è¿è¡ååå°ç½ç»ä¸­ã\n\n\n# 4. æå¨æ¨¡æBGPæ¨¡å¼å®éª\n\n\n\n\n# 4.1 æä½\n\né¦åå¨Node1ä¸­åå»ºNetwork Namespaceå½åä¸ºnet1\n\nip netns add net1\n\n\n1\n\n\nç¶ååå»ºä¸å¯¹veth pairè®¾å¤veth0åveth1ï¼å°veth0æ¾å°net1ä¸­ï¼æèµ·å¹¶è®¾ç½®å¥½ipå°å172.19.1.2/24ï¼veth1ä¹æåä½ä¸ç¨è®¾ç½®IPå°åï¼ä½éè¦è®¾ç½®é»è®¤çMACå°åä¸ºee:ee:ee:ee:ee:ee\n\nip link add veth0 type veth peer name veth1\nip link set dev veth0 netns net1\nip netns exec net1 ip link set veth0 up\nip netns exec net1 ip addr add 172.19.1.2/24 dev veth0\n\nip link set dev veth1 up\nip link set dev veth1 address ee:ee:ee:ee:ee:ee\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nnet1éç½®çè·¯ç±æç¹ææï¼åä¸è¬éç½®çè·¯ç±ä¸åï¼ææçæ¥æé½éè¦éè¿veth0è®¾å¤åéå°ä¸ä¸è·³çå°åä¸º169.254.1.1ï¼èè¿ä¸ªå°åå¨æ´ä¸ªå¹³å°æ¾æ¯ä¸å­å¨çï¼è¿æ¯ä¸ä¸ªé»è®¤çç½å³ï¼é£å¦ä½è¾¾å°è¯¥å°åå¢ï¼\n\nip netns exec net1 ip r a 169.254.1.1 dev veth0 \nip netns exec net1 ip r a default via 169.254.1.1 dev veth0 \n\n\n1\n2\n\n\néè¿è®¾ç½®veth1è®¾å¤proxy_arpï¼å¯ä»¥å¯¹äºä»»ä½ARPè¯·æ±å°è¾¾veth1æ¶ï¼é½ååºèªå·±çMacå°åï¼ä¹å°±æ¯ee:ee:ee:ee:ee:ee\n\nå½è®¿é®ç½å³çæ¶åï¼é¦åæ¯éè¦è¿è¡ARPè¯·æ±ï¼è¯·æ±éè¿veth0è®¾å¤è¾¾å°äºveth1ä¸­ï¼å ä¸ºè®¾ç½®proxy_arpï¼ä¼å°èªèº«çmacå°åee:ee:ee:ee:ee:eeä½ä¸ºarpåå¤ã\n\nèå®¹å¨çåç»­æ¥æç®çIPå°åæ¯ç®çå®¹å¨çIPå°åï¼èmacå°ååæäºç½å³MACå°åee:ee:ee:ee:ee:eeï¼èç½å³çIPå°åå¹¶ä¸ä¼åºç°å¨ä»»ä½çæ°æ®åä¸­ï¼ä¹æ²¡äººå³å¿è¿ä¸ªå·ä½çå°åæ¯ä»ä¹ï¼åªè¦è½æ¾å°arpå°±è¡ã\n\necho 1 > /proc/sys/net/ipv4/conf/veth1/proxy_arp\n\n\n1\n\n\næ°æ®åå·²ç»ä»net1ä¸­éè¿veth1ä½ä¸ºç½å³è¾¾å°å®¿ä¸»æºçç½ç»åè®®æ ä¸­ï¼åéè¿è®¾ç½®å®¿ä¸»æºè·¯ç±è¡¨ï¼å°ç®çå°åä¸ºNode2å®¹å¨ç½æ®µçæ°æ®åéè¿Node2 ens18ç½å¡å°åä½ä¸ºä¸ä¸è·³å°åã\n\nip r add 172.19.2.0/24 via 10.65.132.188 dev ens18\n\n\n1\n\n\nç®çå°åä¸ºNode1çnet1æ¶ï¼éè¦éç½®éè¿è·¯ç±è¡¨å°è¾¾veth1ç½å¡ï¼ç¶ååè¿å¥å°net1ä¸­ã\n\nip r add 172.19.1.2 dev veth1\n\n\n1\n\n\nåå¨Node2ä¸­éå¤Node1çæä½åå»ºNetwork Namespace net2ï¼å¹¶åå§åç½ç»éç½®ã\n\nip netns add net2\nip link add veth0 type veth peer name veth1\nip link set dev veth0 netns net2\nip netns exec net2 ip addr add 172.19.2.2/24 dev veth0 \nip netns exec net2 ip link set veth0 up\n\nip link set dev veth1 up\nip link set dev veth1 address ee:ee:ee:ee:ee:ee\n\nip netns exec net2 ip r a 169.254.1.1 dev veth0 \nip netns exec net2 ip r a default via 169.254.1.1 dev veth0 \nip r add 172.19.1.0/24 via 10.65.132.187 dev ens18\nip r add 172.19.2.2/32 dev veth1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# 4.2 åæ\n\nå¨Node1 net1ä¸­ping Node2 net2ï¼ç¶åä½¿ç¨tcpdumpçå¬Node1çveth1ï¼ç»æå¦ä¸ï¼\n\n# tcpdump -i veth1 -ne\ndropped privs to tcpdump\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on veth1, link-type EN10MB (Ethernet), capture size 262144 bytes\n10:38:29.713322 02:1c:9c:83:87:f2 > Broadcast, ethertype ARP (0x0806), length 42: Request who-has 169.254.1.1 tell 172.19.1.2, length 28\n10:38:30.205862 ee:ee:ee:ee:ee:ee > 02:1c:9c:83:87:f2, ethertype ARP (0x0806), length 42: Reply 169.254.1.1 is-at ee:ee:ee:ee:ee:ee, length 28\n10:38:30.205922 02:1c:9c:83:87:f2 > ee:ee:ee:ee:ee:ee, ethertype IPv4 (0x0800), length 98: 172.19.1.2 > 172.19.2.2: ICMP echo request, id 37475, seq 1, length 64\n10:38:30.206393 ee:ee:ee:ee:ee:ee > 02:1c:9c:83:87:f2, ethertype IPv4 (0x0800), length 98: 172.19.2.2 > 172.19.1.2: ICMP echo reply, id 37475, seq 1, length 64\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¯ä»¥çå°ï¼åæ¯åéarpè¯·æ±è·å172.19.1.2çmacå°åï¼å ä¸ºè®¾ç½®äºproxy_arpï¼æä»¥ä¼å°èªèº«çMacå°åè¿è¡åå¤ï¼å¨åé¢çICMPåä¸­ï¼ç®çIPå°åä¸ºç®çå®¹å¨IPå°å172.19.2.2ï¼èç®çMacå°åä¸ºveth1çMacå°åee:ee:ee:ee:ee:ee\n\nåä½¿ç¨tcpdumpçå¬Node2çens18ç½å¡ï¼ç»æå¦ä¸ï¼\n\n# tcpdump -i ens18 host 172.19.2.2 -en\ndropped privs to tcpdump\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on ens18, link-type EN10MB (Ethernet), capture size 262144 bytes\n10:52:43.993140 fa:16:3e:d3:f6:3a > fa:16:3e:b1:9a:65, ethertype IPv4 (0x0800), length 98: 172.19.1.2 > 172.19.2.2: ICMP echo request, id 4349, seq 1, length 64\n10:52:43.993291 fa:16:3e:b1:9a:65 > fa:16:3e:d3:f6:3a, ethertype IPv4 (0x0800), length 98: 172.19.2.2 > 172.19.1.2: ICMP echo reply, id 4349, seq 1, length 64\n\n\n1\n2\n3\n4\n5\n6\n\n\næ°æ®åä»Node1ä¸­å°è¾¾äºNode2 ens18ç½å¡ï¼æºIPåç®çIPåå«ä¸ºnet1ånet2çIPå°åï¼èmacå°åæ¯Node1åNode2çç©çç½å¡ens18 Macå°å.\n\nä½¿ç¨tcpdumpçå¬veth1ç½å¡ï¼ç»æå¦ä¸ï¼\n\n# tcpdump -i veth1 -en\ndropped privs to tcpdump\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on veth1, link-type EN10MB (Ethernet), capture size 262144 bytes\n10:58:13.780247 ee:ee:ee:ee:ee:ee > fa:63:d4:dc:25:01, ethertype IPv4 (0x0800), length 98: 172.19.1.2 > 172.19.2.2: ICMP echo request, id 41971, seq 1, length 64\n10:58:13.780288 fa:63:d4:dc:25:01 > ee:ee:ee:ee:ee:ee, ethertype IPv4 (0x0800), length 98: 172.19.2.2 > 172.19.1.2: ICMP echo reply, id 41971, seq 1, length 64\n\n\n1\n2\n3\n4\n5\n6\n\n\næ¥çNode2çè·¯ç±\n\n# ip r\n...\n172.19.2.2 dev veth1 scope link \n...\n\n\n1\n2\n3\n4\n\n\næ°æ®åè¾¾å°Node2 ens18ç½å¡åï¼è§£å¼macå¤´ï¼å°è¾¾ç½ç»åè®®æ ä¸­ï¼éè¿è·¯ç±ï¼å°ç®çå°åä¸º172.19.2.2çæ°æ®åé½è¿å¥å°veth1ç½å¡ä¸­ï¼æç»è¿å¥å°net2ä¸­\n\n\n# 5. IPIPé§éæ¨¡å¼\n\nè¯¥æ¨¡å¼çè§£å³æ¹å¼æ¯å¨ç©çæºAåç©çæºBä¹é´æä¸ä¸ªé§éï¼è¿ä¸ªé§éæä¸¤ä¸ªç«¯ç¹ï¼å¨ç«¯ç¹ä¸è¿è¡å°è£ï¼å°å®¹å¨çIPä½ä¸ºä¹å®¢åè®®æ¾å¨é§ééé¢ï¼èç©çä¸»æºçIPæ¾å¨å¤é¢ä½ä¸ºæ¿è½½åè®®ãè¿æ ·ä¸ç®¡å¤å±çIPéè¿ä¼ ç»çç©çç½ç»ï¼èµ°å¤å°è·³å°è¾¾ç®æ ç©çæºï¼ä»é§éä¸¤ç«¯çèµ·æ¥ï¼ç©çæºAçä¸ä¸è·³å°±æ¯ç©çæºBã",normalizedContent:"# 0. åè¨\n\ncalicoæ¯k8sä¸­å¸¸ç¨çå®¹å¨è§£å³æ¹æ¡çæä»¶ï¼æ¬æä¸»è¦ä»ç»bgpæ¨¡å¼åipipæ¨¡å¼æ¯å¦ä½è§£å³çï¼å¹¶è¯¦ç»äºè§£å¶åçï¼å¹¶éè¿å®éªå æ·±çè§£ã\n\n\n# 1. ä»ç»calico\n\ncalicoæ¯å±äºçº¯3å±çç½ç»æ¨¡åï¼æ¯ä¸ªå®¹å¨é½éè¿ipç´æ¥éä¿¡ï¼ä¸­é´éè¿è·¯ç±è½¬åæ¾å°å¯¹æ¹ãå®¹å¨æå¨çèç¹ç±»ä¼¼äºä¼ ç»çè·¯ç±å¨ï¼æä¾äºè·¯ç±æ¥æ¾çåè½ãæ¯ä¸ªå®¹å¨æå¨çä¸»æºèç¹æ®æ¼äºèæè·¯ç±å¨ ï¼vrouterï¼çåè½ï¼vrouterå¿é¡»ææç§æ¹æ³ï¼è½å¤ç¥éæ´ä¸ªéç¾¤çè·¯ç±ä¿¡æ¯ã\n\nä¹åæå°çflannelhost gatewayæ¨¡å¼æ¹æ¡æ¯ä¸è½è·¨äºå±ç½ç»ï¼æ¯å ä¸ºå®åªè½ä¿®æ¹ä¸»æºè·¯ç±ï¼calicoææ¹è·¯ç±è¡¨çåæ³æ¢æäºæ åçbgpè·¯ç±åè®®ãç¸å½äºå¨æ¯ä¸ªèç¹ä¸æ¨¡æåºä¸ä¸ªé¢å¤çè·¯ç±å¨ï¼ç±äºéç¨çæ¯æ ååè®®ï¼calicoæ¨¡æè·¯ç±å¨çè·¯ç±è¡¨ä¿¡æ¯å¯ä»¥è¢«ä¼ æ­å°ç½ç»çå¶ä»è·¯ç±è®¾å¤ä¸­ï¼è¿æ ·å°±å®ç°äºå¨ä¸å±ç½ç»ä¸çé«éè·¨èç¹ç½ç»ã\n\n> bgpï¼border gateway protocolï¼æ¯ä¸ç§ç¨äºå¨äºèç½ä¸­äº¤æ¢è·¯ç±ä¿¡æ¯çåè®®ãå®æ¯ä¸ç§èªæ²»ç³»ç»ï¼asï¼ä¹é´çè·¯ç±åè®®ï¼ç¨äºå¨ä¸åçèªæ²»ç³»ç»ä¹é´äº¤æ¢è·¯ç±ä¿¡æ¯ãbgpåè®®çä¸»è¦ä½ç¨æ¯å°è·¯ç±ä¿¡æ¯ä»ä¸ä¸ªèªæ²»ç³»ç»ä¼ éå°å¦ä¸ä¸ªèªæ²»ç³»ç»ï¼ä»¥ä¾¿å®ç°äºèç½çå¨çè·¯ç±ã\n\nä½ç°å®ä¸­çç½ç»å¹¶ä¸ä¸å®æ¯æbgpè·¯ç±ï¼å¨è¿ç§æåµä¸å¯ä»¥ä½¿ç¨ipipé§éæ¨¡å¼æ¥ä¼ è¾æ°æ®ã\n\n\n# 2. calioæ¶æ\n\n\n\nfelix\n\nfelixæ¯ä¸ä¸ªå®æ¤ç¨åºï¼ä½ä¸ºagentè¿è¡å¨æç®¡å®¹å¨æèææºçcalicoèç¹ä¸ãfelixè´è´£å·æ°ä¸»æºè·¯ç±åaclè§åç­ï¼ä»¥ä¾¿ä¸ºè¯¥ä¸»æºä¸çendpointæ­£å¸¸è¿è¡æä¾æéçç½ç»è¿æ¥åç®¡çãè¿åºå®¹å¨ãèææºåç©çä¸»æºçæææµéé½ä¼éåcalicoï¼å©ç¨linuxåæ ¸åççè·¯ç±åiptablesçæçè§åã\n\nbgp client\n\ncalicoå¨æ¯ä¸ªè¿è¡felixæå¡çèç¹ä¸é½é¨ç½²ä¸ä¸ªbgp clientï¼bgpå®¢æ·ç«¯ï¼ãbgpå®¢æ·ç«¯çä½ç¨æ¯è¯»åfelixç¼åå°åæ ¸ä¸­çè·¯ç±ä¿¡æ¯ï¼ç±bgpå®¢æ·ç«¯å¯¹è¿äºè·¯ç±ä¿¡æ¯è¿è¡ååãå½felixå°è·¯ç±æå¥linuxåæ ¸æ¶ï¼bgpå®¢æ·ç«¯å°æ¥æ¶å®ä»¬ï¼å¹¶å°å®ä»¬ååå°éç¾¤ä¸­çå¶ä»å·¥ä½èç¹ã\n\nnode-to-node mesh\n\nè¯¥æ¨¡å¼ä¸ºé»è®¤æ¨¡å¼ï¼å¨bgpä¸ï¼éç¾¤ä¸­çæ¯ä¸ä¸ªèç¹çbgp clienté½éè¦åå¶ä»ææèç¹çbgp clientè¿è¡éä¿¡æ¥äº¤æ¢è·¯ç±ã\nä½éçèç¹æ°éå¢å ï¼è¿æ¥æ°ä¼ä»¥n^2è§æ¨¡å¢å ï¼ç»éç¾¤ç½ç»å¸¦æ¥å·¨å¤§çååã\n\nbgp route reflector\n\ncalicoä¼æå®å ä¸ªèç¹è´è´£ä¸é¨è·å¶ä»ææèç¹è¿è¡è¿æ¥å¹¶äº¤æ¢è·¯ç±ä¿¡æ¯ï¼ä»èå­¦ä¹ å°å¨å±çè·¯ç±ä¿¡æ¯ãèå¶ä»èç¹ä¹åªéè¦è·è¿å ä¸ªèç¹è¿è¡éä¿¡æ¥è·åå°æ´ä¸ªéç¾¤çè§åä¿¡æ¯ã\n\n\n\n\n# 3. bgpæ¨¡å¼\n\n\n\næ¯ä¸ªå®¹å¨é½ä¼åå»ºä¸å¯¹veth pairç½å¡ï¼ä¸ç«¯æ¾å¨å®¹å¨åé¨ï¼å¦ä¸ç«¯æ¾å¨å®¿ä¸»æºä¸­ï¼å®¹å¨ä¸­åéçipåéè¿veth pairç½å¡å¯ä»¥è¾¾å°å®¿ä¸»æºçç½ç»åè®®æ ä¸­ã\n\nfelixä¼éè¿çå¬etcdæ¥è·åå¶ä»èç¹çç¸å³ä¿¡æ¯ï¼ç¶åæ·»å æ¬å°è·¯ç±ï¼\n\n 1. éå¾å¶ä»èç¹å®¹å¨çipåä¸ä¸æ¡å°å¶èç¹ç©çç½å¡ä¸­ã\n 2. éè¿æ¬æºèç¹å®¹å¨çipåå°calixxxç½å¡ä¸­ï¼ç¶åè¿å¥å°å®¹å¨ä¸­ã\n\nbgp clientä¼è¯»åfelixåå¥å°æ¬å°çè·¯ç±ï¼åéè¿è¿è¡ååå°ç½ç»ä¸­ã\n\n\n# 4. æå¨æ¨¡æbgpæ¨¡å¼å®éª\n\n\n\n\n# 4.1 æä½\n\né¦åå¨node1ä¸­åå»ºnetwork namespaceå½åä¸ºnet1\n\nip netns add net1\n\n\n1\n\n\nç¶ååå»ºä¸å¯¹veth pairè®¾å¤veth0åveth1ï¼å°veth0æ¾å°net1ä¸­ï¼æèµ·å¹¶è®¾ç½®å¥½ipå°å172.19.1.2/24ï¼veth1ä¹æåä½ä¸ç¨è®¾ç½®ipå°åï¼ä½éè¦è®¾ç½®é»è®¤çmacå°åä¸ºee:ee:ee:ee:ee:ee\n\nip link add veth0 type veth peer name veth1\nip link set dev veth0 netns net1\nip netns exec net1 ip link set veth0 up\nip netns exec net1 ip addr add 172.19.1.2/24 dev veth0\n\nip link set dev veth1 up\nip link set dev veth1 address ee:ee:ee:ee:ee:ee\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nnet1éç½®çè·¯ç±æç¹ææï¼åä¸è¬éç½®çè·¯ç±ä¸åï¼ææçæ¥æé½éè¦éè¿veth0è®¾å¤åéå°ä¸ä¸è·³çå°åä¸º169.254.1.1ï¼èè¿ä¸ªå°åå¨æ´ä¸ªå¹³å°æ¾æ¯ä¸å­å¨çï¼è¿æ¯ä¸ä¸ªé»è®¤çç½å³ï¼é£å¦ä½è¾¾å°è¯¥å°åå¢ï¼\n\nip netns exec net1 ip r a 169.254.1.1 dev veth0 \nip netns exec net1 ip r a default via 169.254.1.1 dev veth0 \n\n\n1\n2\n\n\néè¿è®¾ç½®veth1è®¾å¤proxy_arpï¼å¯ä»¥å¯¹äºä»»ä½arpè¯·æ±å°è¾¾veth1æ¶ï¼é½ååºèªå·±çmacå°åï¼ä¹å°±æ¯ee:ee:ee:ee:ee:ee\n\nå½è®¿é®ç½å³çæ¶åï¼é¦åæ¯éè¦è¿è¡arpè¯·æ±ï¼è¯·æ±éè¿veth0è®¾å¤è¾¾å°äºveth1ä¸­ï¼å ä¸ºè®¾ç½®proxy_arpï¼ä¼å°èªèº«çmacå°åee:ee:ee:ee:ee:eeä½ä¸ºarpåå¤ã\n\nèå®¹å¨çåç»­æ¥æç®çipå°åæ¯ç®çå®¹å¨çipå°åï¼èmacå°ååæäºç½å³macå°åee:ee:ee:ee:ee:eeï¼èç½å³çipå°åå¹¶ä¸ä¼åºç°å¨ä»»ä½çæ°æ®åä¸­ï¼ä¹æ²¡äººå³å¿è¿ä¸ªå·ä½çå°åæ¯ä»ä¹ï¼åªè¦è½æ¾å°arpå°±è¡ã\n\necho 1 > /proc/sys/net/ipv4/conf/veth1/proxy_arp\n\n\n1\n\n\næ°æ®åå·²ç»ä»net1ä¸­éè¿veth1ä½ä¸ºç½å³è¾¾å°å®¿ä¸»æºçç½ç»åè®®æ ä¸­ï¼åéè¿è®¾ç½®å®¿ä¸»æºè·¯ç±è¡¨ï¼å°ç®çå°åä¸ºnode2å®¹å¨ç½æ®µçæ°æ®åéè¿node2 ens18ç½å¡å°åä½ä¸ºä¸ä¸è·³å°åã\n\nip r add 172.19.2.0/24 via 10.65.132.188 dev ens18\n\n\n1\n\n\nç®çå°åä¸ºnode1çnet1æ¶ï¼éè¦éç½®éè¿è·¯ç±è¡¨å°è¾¾veth1ç½å¡ï¼ç¶ååè¿å¥å°net1ä¸­ã\n\nip r add 172.19.1.2 dev veth1\n\n\n1\n\n\nåå¨node2ä¸­éå¤node1çæä½åå»ºnetwork namespace net2ï¼å¹¶åå§åç½ç»éç½®ã\n\nip netns add net2\nip link add veth0 type veth peer name veth1\nip link set dev veth0 netns net2\nip netns exec net2 ip addr add 172.19.2.2/24 dev veth0 \nip netns exec net2 ip link set veth0 up\n\nip link set dev veth1 up\nip link set dev veth1 address ee:ee:ee:ee:ee:ee\n\nip netns exec net2 ip r a 169.254.1.1 dev veth0 \nip netns exec net2 ip r a default via 169.254.1.1 dev veth0 \nip r add 172.19.1.0/24 via 10.65.132.187 dev ens18\nip r add 172.19.2.2/32 dev veth1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# 4.2 åæ\n\nå¨node1 net1ä¸­ping node2 net2ï¼ç¶åä½¿ç¨tcpdumpçå¬node1çveth1ï¼ç»æå¦ä¸ï¼\n\n# tcpdump -i veth1 -ne\ndropped privs to tcpdump\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on veth1, link-type en10mb (ethernet), capture size 262144 bytes\n10:38:29.713322 02:1c:9c:83:87:f2 > broadcast, ethertype arp (0x0806), length 42: request who-has 169.254.1.1 tell 172.19.1.2, length 28\n10:38:30.205862 ee:ee:ee:ee:ee:ee > 02:1c:9c:83:87:f2, ethertype arp (0x0806), length 42: reply 169.254.1.1 is-at ee:ee:ee:ee:ee:ee, length 28\n10:38:30.205922 02:1c:9c:83:87:f2 > ee:ee:ee:ee:ee:ee, ethertype ipv4 (0x0800), length 98: 172.19.1.2 > 172.19.2.2: icmp echo request, id 37475, seq 1, length 64\n10:38:30.206393 ee:ee:ee:ee:ee:ee > 02:1c:9c:83:87:f2, ethertype ipv4 (0x0800), length 98: 172.19.2.2 > 172.19.1.2: icmp echo reply, id 37475, seq 1, length 64\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¯ä»¥çå°ï¼åæ¯åéarpè¯·æ±è·å172.19.1.2çmacå°åï¼å ä¸ºè®¾ç½®äºproxy_arpï¼æä»¥ä¼å°èªèº«çmacå°åè¿è¡åå¤ï¼å¨åé¢çicmpåä¸­ï¼ç®çipå°åä¸ºç®çå®¹å¨ipå°å172.19.2.2ï¼èç®çmacå°åä¸ºveth1çmacå°åee:ee:ee:ee:ee:ee\n\nåä½¿ç¨tcpdumpçå¬node2çens18ç½å¡ï¼ç»æå¦ä¸ï¼\n\n# tcpdump -i ens18 host 172.19.2.2 -en\ndropped privs to tcpdump\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on ens18, link-type en10mb (ethernet), capture size 262144 bytes\n10:52:43.993140 fa:16:3e:d3:f6:3a > fa:16:3e:b1:9a:65, ethertype ipv4 (0x0800), length 98: 172.19.1.2 > 172.19.2.2: icmp echo request, id 4349, seq 1, length 64\n10:52:43.993291 fa:16:3e:b1:9a:65 > fa:16:3e:d3:f6:3a, ethertype ipv4 (0x0800), length 98: 172.19.2.2 > 172.19.1.2: icmp echo reply, id 4349, seq 1, length 64\n\n\n1\n2\n3\n4\n5\n6\n\n\næ°æ®åä»node1ä¸­å°è¾¾äºnode2 ens18ç½å¡ï¼æºipåç®çipåå«ä¸ºnet1ånet2çipå°åï¼èmacå°åæ¯node1ånode2çç©çç½å¡ens18 macå°å.\n\nä½¿ç¨tcpdumpçå¬veth1ç½å¡ï¼ç»æå¦ä¸ï¼\n\n# tcpdump -i veth1 -en\ndropped privs to tcpdump\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on veth1, link-type en10mb (ethernet), capture size 262144 bytes\n10:58:13.780247 ee:ee:ee:ee:ee:ee > fa:63:d4:dc:25:01, ethertype ipv4 (0x0800), length 98: 172.19.1.2 > 172.19.2.2: icmp echo request, id 41971, seq 1, length 64\n10:58:13.780288 fa:63:d4:dc:25:01 > ee:ee:ee:ee:ee:ee, ethertype ipv4 (0x0800), length 98: 172.19.2.2 > 172.19.1.2: icmp echo reply, id 41971, seq 1, length 64\n\n\n1\n2\n3\n4\n5\n6\n\n\næ¥çnode2çè·¯ç±\n\n# ip r\n...\n172.19.2.2 dev veth1 scope link \n...\n\n\n1\n2\n3\n4\n\n\næ°æ®åè¾¾å°node2 ens18ç½å¡åï¼è§£å¼macå¤´ï¼å°è¾¾ç½ç»åè®®æ ä¸­ï¼éè¿è·¯ç±ï¼å°ç®çå°åä¸º172.19.2.2çæ°æ®åé½è¿å¥å°veth1ç½å¡ä¸­ï¼æç»è¿å¥å°net2ä¸­\n\n\n# 5. ipipé§éæ¨¡å¼\n\nè¯¥æ¨¡å¼çè§£å³æ¹å¼æ¯å¨ç©çæºaåç©çæºbä¹é´æä¸ä¸ªé§éï¼è¿ä¸ªé§éæä¸¤ä¸ªç«¯ç¹ï¼å¨ç«¯ç¹ä¸è¿è¡å°è£ï¼å°å®¹å¨çipä½ä¸ºä¹å®¢åè®®æ¾å¨é§ééé¢ï¼èç©çä¸»æºçipæ¾å¨å¤é¢ä½ä¸ºæ¿è½½åè®®ãè¿æ ·ä¸ç®¡å¤å±çipéè¿ä¼ ç»çç©çç½ç»ï¼èµ°å¤å°è·³å°è¾¾ç®æ ç©çæºï¼ä»é§éä¸¤ç«¯çèµ·æ¥ï¼ç©çæºaçä¸ä¸è·³å°±æ¯ç©çæºbã",charsets:{cjk:!0},lastUpdated:"2023/07/07, 08:56:29",lastUpdatedTimestamp:1688691389e3},{title:"çè§£flannelçä¸ç§å®¹å¨ç½ç»æ¹æ¡åç",frontmatter:{title:"çè§£flannelçä¸ç§å®¹å¨ç½ç»æ¹æ¡åç",date:"2023-06-01T12:56:36.000Z",permalink:"/pages/d9d0ce/",categories:["äºåç","k8s"],tags:["k8s","å®¹å¨","äºåç","è®¡ç®æºç½ç»","Linuxç½ç»èæå"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä¸»è¦ä»ç»flannelå¨k8sç½ç»ä¸­ä½ä¸ºç½ç»æä»¶éè¿UDPãVXLANãHOST-GATEWAYä¸ç§æ¨¡å¼æ¥è§£å³å®¹å¨è·¨ä¸»æºç½ç»éä¿¡çï¼å¹¶éè¿æå¨å®ç°è¿ä¸ç§æ¨¡å¼æ·±å¥çè§£å¶åçã",comment:!0,feed:{enable:!0},meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20230603100424.png"},{name:"twitter:title",content:"çè§£flannelçä¸ç§å®¹å¨ç½ç»æ¹æ¡åç"},{name:"twitter:description",content:"æ¬æä¸»è¦ä»ç»flannelå¨k8sç½ç»ä¸­ä½ä¸ºç½ç»æä»¶éè¿UDPãVXLANãHOST-GATEWAYä¸ç§æ¨¡å¼æ¥è§£å³å®¹å¨è·¨ä¸»æºç½ç»éä¿¡çï¼å¹¶éè¿æå¨å®ç°è¿ä¸ç§æ¨¡å¼æ·±å¥çè§£å¶åçã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20230603100424.png"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/14.%E7%90%86%E8%A7%A3flannel%E7%9A%84%E4%B8%89%E7%A7%8D%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E6%96%B9%E6%A1%88%E5%8E%9F%E7%90%86.html"},{property:"og:type",content:"article"},{property:"og:title",content:"çè§£flannelçä¸ç§å®¹å¨ç½ç»æ¹æ¡åç"},{property:"og:description",content:"æ¬æä¸»è¦ä»ç»flannelå¨k8sç½ç»ä¸­ä½ä¸ºç½ç»æä»¶éè¿UDPãVXLANãHOST-GATEWAYä¸ç§æ¨¡å¼æ¥è§£å³å®¹å¨è·¨ä¸»æºç½ç»éä¿¡çï¼å¹¶éè¿æå¨å®ç°è¿ä¸ç§æ¨¡å¼æ·±å¥çè§£å¶åçã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20230603100424.png"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/14.%E7%90%86%E8%A7%A3flannel%E7%9A%84%E4%B8%89%E7%A7%8D%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E6%96%B9%E6%A1%88%E5%8E%9F%E7%90%86.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-06-01T12:56:36.000Z"},{property:"article:tag",content:"k8s"},{property:"article:tag",content:"å®¹å¨"},{property:"article:tag",content:"äºåç"},{property:"article:tag",content:"è®¡ç®æºç½ç»"},{property:"article:tag",content:"Linuxç½ç»èæå"},{itemprop:"name",content:"çè§£flannelçä¸ç§å®¹å¨ç½ç»æ¹æ¡åç"},{itemprop:"description",content:"æ¬æä¸»è¦ä»ç»flannelå¨k8sç½ç»ä¸­ä½ä¸ºç½ç»æä»¶éè¿UDPãVXLANãHOST-GATEWAYä¸ç§æ¨¡å¼æ¥è§£å³å®¹å¨è·¨ä¸»æºç½ç»éä¿¡çï¼å¹¶éè¿æå¨å®ç°è¿ä¸ç§æ¨¡å¼æ·±å¥çè§£å¶åçã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20230603100424.png"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/14.%E7%90%86%E8%A7%A3flannel%E7%9A%84%E4%B8%89%E7%A7%8D%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E6%96%B9%E6%A1%88%E5%8E%9F%E7%90%86.html",relativePath:"01.äºåç/07.k8s/14.çè§£flannelçä¸ç§å®¹å¨ç½ç»æ¹æ¡åç.md",key:"v-be038f46",path:"/pages/d9d0ce/",headers:[{level:2,title:"0. åè¨",slug:"_0-åè¨",normalizedTitle:"0. åè¨",charIndex:2},{level:2,title:"1. flannelå¨å±ç½ç»å°ååéæºå¶",slug:"_1-flannelå¨å±ç½ç»å°ååéæºå¶",normalizedTitle:"1. flannelå¨å±ç½ç»å°ååéæºå¶",charIndex:102},{level:2,title:"2. UDPæ¨¡å¼",slug:"_2-udpæ¨¡å¼",normalizedTitle:"2. udpæ¨¡å¼",charIndex:353},{level:3,title:"2.1 ç®ä»",slug:"_2-1-ç®ä»",normalizedTitle:"2.1 ç®ä»",charIndex:366},{level:3,title:"2.2 flannelå®ç°UDPæµç¨",slug:"_2-2-flannelå®ç°udpæµç¨",normalizedTitle:"2.2 flannelå®ç°udpæµç¨",charIndex:542},{level:3,title:"2.3 æå¨æ¨¡æflannelå®ç°udpå®éª",slug:"_2-3-æå¨æ¨¡æflannelå®ç°udpå®éª",normalizedTitle:"2.3 æå¨æ¨¡æflannelå®ç°udpå®éª",charIndex:975},{level:3,title:"2.4 åæ",slug:"_2-4-åæ",normalizedTitle:"2.4 åæ",charIndex:4474},{level:2,title:"3. VXLANæ¨¡å¼",slug:"_3-vxlanæ¨¡å¼",normalizedTitle:"3. vxlanæ¨¡å¼",charIndex:5076},{level:3,title:"3.1 ç®ä»",slug:"_3-1-ç®ä»",normalizedTitle:"3.1 ç®ä»",charIndex:5091},{level:3,title:"3.3 flannelå®ç°vxlanæ¨¡å¼æµç¨",slug:"_3-3-flannelå®ç°vxlanæ¨¡å¼æµç¨",normalizedTitle:"3.3 flannelå®ç°vxlanæ¨¡å¼æµç¨",charIndex:5396},{level:3,title:"3.4 æå¨æ¨¡æflanneldç»´æ¤VTEPç»å®è·µ",slug:"_3-4-æå¨æ¨¡æflanneldç»´æ¤vtepç»å®è·µ",normalizedTitle:"3.4 æå¨æ¨¡æflanneldç»´æ¤vtepç»å®è·µ",charIndex:5837},{level:2,title:"4. Host Gatewayæ¨¡å¼",slug:"_4-host-gatewayæ¨¡å¼",normalizedTitle:"4. host gatewayæ¨¡å¼",charIndex:8588},{level:3,title:"4.1 ç®ä»",slug:"_4-1-ç®ä»",normalizedTitle:"4.1 ç®ä»",charIndex:8610},{level:3,title:"4.3 flannelå®ç°Host Gatewayæ¨¡å¼æµç¨",slug:"_4-3-flannelå®ç°host-gatewayæ¨¡å¼æµç¨",normalizedTitle:"4.3 flannelå®ç°host gatewayæ¨¡å¼æµç¨",charIndex:8879},{level:3,title:"4.4 æå¨æ¨¡æflannelå®ç°Host Gatewayæ¨¡å¼å®éª",slug:"_4-4-æå¨æ¨¡æflannelå®ç°host-gatewayæ¨¡å¼å®éª",normalizedTitle:"4.4 æå¨æ¨¡æflannelå®ç°host gatewayæ¨¡å¼å®éª",charIndex:9078},{level:2,title:"5. å·¨äººçè©è",slug:"_5-å·¨äººçè©è",normalizedTitle:"5. å·¨äººçè©è",charIndex:10926}],headersStr:"0. åè¨ 1. flannelå¨å±ç½ç»å°ååéæºå¶ 2. UDPæ¨¡å¼ 2.1 ç®ä» 2.2 flannelå®ç°UDPæµç¨ 2.3 æå¨æ¨¡æflannelå®ç°udpå®éª 2.4 åæ 3. VXLANæ¨¡å¼ 3.1 ç®ä» 3.3 flannelå®ç°vxlanæ¨¡å¼æµç¨ 3.4 æå¨æ¨¡æflanneldç»´æ¤VTEPç»å®è·µ 4. Host Gatewayæ¨¡å¼ 4.1 ç®ä» 4.3 flannelå®ç°Host Gatewayæ¨¡å¼æµç¨ 4.4 æå¨æ¨¡æflannelå®ç°Host Gatewayæ¨¡å¼å®éª 5. å·¨äººçè©è",content:'# 0. åè¨\n\næ¬æä¸»è¦ä»ç»flannelå¨k8sç½ç»ä¸­ä½ä¸ºç½ç»æä»¶éè¿UDPãVXLANãHOST-GATEWAYä¸ç§æ¨¡å¼æ¥è§£å³å®¹å¨è·¨ä¸»æºç½ç»éä¿¡çï¼å¹¶éè¿æå¨å®ç°è¿ä¸ç§æ¨¡å¼æ·±å¥çè§£å¶åçã\n\n\n# 1. flannelå¨å±ç½ç»å°ååéæºå¶\n\næ¯å°èç¹ä¸å®¹å¨çIPå°åæ¯ç±æå±èç¹èªå¨åéçï¼é£ä¹ä¼å­å¨ä¸ä¸ªé®é¢æ¯ï¼ä¸åèç¹ä¸çå®¹å¨æåéçIPå°ååå¯è½ä¼æéå¤çæåµã\n\nflannelè®¾è®¡äºä¸ç§å¨å±çç½ç»å°ååéæºå¶ï¼flannelä¼ä¸ºæ¯å°èç¹ç³è¯·ä¸ä¸ªç¬ä¸æ äºçç½æ®µï¼å¹¶å­å¨å¨etcdä¸­ï¼flannelä¼å°è¯¥ç½æ®µéç½®å°åä¸ªèç¹ä¸çDocker(æèå¶ä»å®¹å¨å·¥å·)ï¼å½åèç¹ä¸çå®¹å¨ åªä»åéçç½æ®µéä¸­è·åIPå°åã\n\n> ä¿®æ¹dockerå¯å¨åæ°--bipæ¥éå¶èç¹å®¹å¨è·å¾çIPèå´ã\n\n\n\n\n# 2. UDPæ¨¡å¼\n\n\n# 2.1 ç®ä»\n\nå¨FlannelçUDPæ¨¡å¼ä¸­ï¼æ¯ä¸ªèç¹é½ä¼å¯å¨ä¸ä¸ªUDPæå¡å¨ï¼ç¨äºçå¬æ¥èªå¶ä»èç¹çæ°æ®åãå½ä¸ä¸ªå®¹å¨åå¦ä¸ä¸ªå®¹å¨åéæ°æ®åæ¶ï¼å®ä¼å°æ°æ®ååéå°ç®æ å®¹å¨çIPå°ååç«¯å£å·ãFlannelä¼å°è¯¥æ°æ®åå°è£å¨ä¸ä¸ªUDPæ°æ®åä¸­ï¼å¹¶å°å¶åéå°ç®æ èç¹çUDPæå¡å¨ãç®æ èç¹çUDPæå¡å¨ä¼è§£æè¯¥æ°æ®åï¼å¹¶å°å¶ä¼ éç»ç®æ å®¹å¨ã\n\n\n# 2.2 flannelå®ç°UDPæµç¨\n\n\n\nflanneldå¯å¨åä¼éè¿æå¼/dev/net/tunçæ¹å¼åå»ºtunè®¾å¤ï¼åç§°ä¸ºflannel0ï¼è¯¥è®¾å¤æ¯ç¨æ·ç©ºé´ä¸åæ ¸ç©ºé´çæ°æ®åäº¤äºçééãç¶ååå°ä»tunè®¾å¤è·åçIPæ°æ®åå°è£å°UDPæ°æ®åä¸­éè¿ç©çç½å¡åéå°å¶ä»èç¹ä¸­ï¼åæ ¸éè¿UDPç«¯å£è½¬åç»flanneldç¶åè§£åï¼å¾å°å¶ä¸­çIPæ°æ®åï¼ç¶ååéè¿tunè®¾å¤è¿å¥åæ ¸ç©ºé´ä¸­ï¼éè¿è·¯ç±å°è¾¾ç½æ¡¥ï¼ç¶ååå°ç®çå®¹å¨ä¸­ã\n\nflanneldå¨å¶ä¸­ä¸»è¦åäºï¼\n\n 1. å¼å¯äºudpæå¡ï¼å¹¶å¯¹udpæ°æ®åå°ååè§£å\n 2. èç¹ä¸è·¯ç±è¡¨çå¨ææ´æ°ï¼ä¹å°±æ¯ä»ç½æ¡¥åºæ¥çæ°æ®åç®çIPä¸ºå¶ä»èç¹å®¹å¨IPæ¶ï¼éè¦è·¯ç±å°flanneldä¸­è¿è¡å°åï¼å¹¶ä¸å¨flanneldæ¥æ¶UDPååè§£å°åºæ¥çIPåéè¦éè¿è·¯ç±å°ç½æ¡¥docker0ä¸­\n\nç¼ºç¹å¾ææ¾ï¼ä»ä¸æ¬¡ç½ç»ä¼ è¾çæ°æ®åç»åäº2æ¬¡ç¨æ·æä¸åæ ¸æçåæ¢ï¼èåæ¢çæçæ¯ä¸é«çï¼æ¯ä¸æ¬¡çåæ¢é½æ¯ä¸æ¬¡æ°æ®çå¤å¶ã\n\n\n\n\n# 2.3 æå¨æ¨¡æflannelå®ç°udpå®éª\n\né¦ååå»ºNetwork Namesapce net1ç¨æ¥æ¨¡æå®¹å¨\n\nip netns add net1\n\n\n1\n\n\nç¶ååå»ºä¸å¯¹veth pairç½å¡veth0åveth1ï¼å¹¶å°veth0æ¾å°net1ä¸­ï¼æèµ·å¹¶è®¾ç½®veth0çipå°åä¸º172.19.1.2/24\n\nip link add veth0 type veth peer name veth1\n\nip link set dev veth0 netns net1\nip netns exec net1 ip addr add 172.19.1.2/24 dev veth0\nip netns exec net1 ip link set veth0 up\n\n\n1\n2\n3\n4\n5\n\n\nåå»ºç½æ¡¥è®¾å¤ï¼æèµ·å¹¶è®¾ç½®ipå°åä¸º172.19.1.1/24ï¼å°veth1æèµ·å¹¶ç»å®å°ç½æ¡¥bridge0ä¸­\n\n# æ·»å ç½æ¡¥\nip link add bridge0 type bridge\nip link set bridge0 up\nip a add 172.19.1.1/24 dev bridge0\n\n# å°å¦ä¸ç«¯ç»å®å¨ç½æ¡¥ä¸\nip link set dev veth1 up\nip link set dev veth1 master bridge0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¨net1ä¸­æ·»å é»è®¤è·¯ç±ï¼è®¾ç½®ä¸ä¸æ¡å°åä¸ºç½æ¡¥bridge0çIPå°åï¼ä»ç½æ¡¥è¿å¥å°å®¿ä¸»æºçç½ç»åè®®æ ä¸­ã\n\nip netns exec net1 ip r add default via 172.19.1.1 dev veth0\n\n\n1\n\n\nåè¿è¡ä»¥ä¸ä»£ç ï¼è¯¥ä»£ç æ¯ç¨æ¥æ¨¡æflanneldç¨åºï¼ä¸»è¦ä½ç¨æ¯åå»ºäºtunè®¾å¤flannel0ï¼å¼å¯äºUDPæå¡æ¶åUDPåï¼ç¶åå°±æ¯å¯¹å®¹å¨IPåçå°è£ä¸è§£å°ã\n\nimport os\nimport socket\nimport struct\nimport threading\nfrom fcntl import ioctl\nimport click\n\nBIND_ADDRESS = (\'0.0.0.0\', 8285)\nBUFFER_SIZE = 4096\n\nTUNSETIFF = 0x400454ca\nIFF_TUN = 0x0001\nIFF_TAP = 0x0002\n\n\ndef create_tunnel(tun_name=\'flannel%d\', tun_mode=IFF_TUN):\n    tun_fd = os.open("/dev/net/tun", os.O_RDWR)\n    ifn = ioctl(tun_fd, TUNSETIFF, struct.pack(b"16sH", tun_name.encode(), tun_mode))\n    tun_name = ifn[:16].decode().strip("\\x00")\n    return tun_fd, tun_name\n\n\ndef start_tunnel(tun_name):\n    os.popen(f"ip link set {tun_name} up")\n\n\ndef udp_server(udp_socket, tun_fd):\n    while True:\n        data, addr = udp_socket.recvfrom(2048)\n        print("get data from udp.")\n        if not data:\n            break\n\n        os.write(tun_fd, data)\n\n\n@click.command()\n@click.option("--peer_node_ip", "-p", required=True, help="å¯¹ç«¯èç¹IP")\ndef main(peer_node_ip):\n    peer_node_addr = (peer_node_ip, 7000)\n\n    tun_fd, tun_name = create_tunnel()\n    start_tunnel(tun_name)\n\n    udp_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n    udp_socket.bind(BIND_ADDRESS)\n\n    t = threading.Thread(target=udp_server, args=(udp_socket, tun_fd))\n    t.daemon = True\n    t.start()\n\n    while True:\n        data = os.read(tun_fd, BUFFER_SIZE)\n        print(f"get data from tun. data size = {len(data)}")\n        udp_socket.sendto(data, peer_node_addr)\n\n\nif __name__ == \'__main__\':\n    main()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n\n\nå¨Node1ä¸­è¿è¡è¯¥ç¨åºï¼è®¾ç½®Node2 IP\n\npython3 tun_app.py -p 10.65.132.188\n\n\n1\n\n\nå¯ä»¥çå°å·²ç»åå»ºäºtunè®¾å¤\n\n# ip link show flannel0\n...\n109: tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 500\n    link/none \n    inet6 fe80::8e98:91a4:6537:d77a/64 scope link flags 800 \n       valid_lft forever preferred_lft forever\n...\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå¨è®¾ç½®å®¿ä¸»æºçè·¯ç±ï¼å°ææå°Node2å®¹å¨çIPåï¼é½è½¬åå°flannel0è®¾å¤ä¸­ã\n\nip r add 172.19.2.0/24 dev flannel0\n\n\n1\n\n\næåéå¤Node1çæä½éç½®Node2\n\n# åå»ºnet3\nip netns add net3\n\n# åå»ºveth pair\nip link add veth0 type veth peer name veth1\n\n# è®¾ç½®net1ç½ç»\nip link set dev veth0 netns net3\nip netns exec net3 ip addr add 172.19.2.2/24 dev veth0\nip netns exec net3 ip link set veth0 up\n\n# æ·»å ç½æ¡¥\nip link add bridge0 type bridge\nip link set bridge0 up\nip a add 172.19.2.1/24 dev bridge0\n\n# å°å¦ä¸ç«¯ç»å®å¨ç½æ¡¥ä¸\nip link set dev veth1 up\nip link set dev veth1 master bridge0\n\n# éç½®net3è·¯ç±\nip netns exec net3 ip r add default via 172.19.2.1 dev veth0\n\n# åå»ºflannel0\npython3 flanneld.py -p 10.65.132.187\n\n# éç½®å°flannel0çè·¯ç±\nip r add 172.19.1.0/24 dev flannel0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n\n# 2.4 åæ\n\nå¨Node1çnet1ä¸­ping Node2çnet2çip 172.19.2.2ï¼å¯ä»¥çå°æ¯å¯ä»¥pingéç\n\n# ping 172.19.2.2 -c 1\nPING 172.19.2.2 (172.19.2.2) 56(84) bytes of data.\n64 bytes from 172.19.2.2: icmp_seq=1 ttl=63 time=0.641 ms\n\n--- 172.19.2.2 ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.641/0.641/0.641/0.000 ms\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå¨Node1çflanneld.pyä¸­çå°æ¥å¿ï¼ä»tunä¸­æ¶å°äºæ¥èªå®¹å¨çIPæ°æ®å\n\n# python3 flanneld.py -p 10.65.132.188\nget data from tun. data size = 88\n\n\n1\n2\n\n\nå¨Node2çflanneld.pyä¸­çå°æ¥å¿ï¼æ¥æ¶å°äºNode1åéè¿æ¥çudpæ°æ®åã\n\n# python3 flanneld.py -p 10.65.132.187\nget data from udp.\n\n\n1\n2\n\n\n\n# 3. VXLANæ¨¡å¼\n\n\n# 3.1 ç®ä»\n\nå¨FlannelçVXLANæ¨¡å¼ä¸­ï¼æ¯ä¸ªèç¹é½ä¼å¯å¨ä¸ä¸ªVXLANé§éï¼ç¨äºå°å®¹å¨ä¹é´çæ°æ®åå°è£å¨VXLANåè®®ä¸­è¿è¡ä¼ è¾ãå½ä¸ä¸ªå®¹å¨åå¦ä¸ä¸ªå®¹å¨åéæ°æ®åæ¶ï¼å®ä¼å°æ°æ®ååéå°ç®æ å®¹å¨çIPå°ååèæç½ç»IDãFlannelä¼å°è¯¥æ°æ®åå°è£å¨ä¸ä¸ªVXLANæ°æ®åä¸­ï¼å¹¶å°å¶åéå°ç®æ èç¹çVXLANé§éãç®æ èç¹çVXLANé§éä¼è§£æè¯¥æ°æ®åï¼å¹¶å°å¶ä¼ éç»ç®æ å®¹å¨ã\n\nvxlanæ¨¡å¼ä¹æ¯éè¿å°åä¸è§£åçå½¢å¼æ¥å®ç°é§éè¾¾å°å®¹å¨çè·¨ä¸»æºè®¿é®ï¼é£åUDPæ¨¡å¼æä»ä¹åºå«å¢ï¼ åºå«å¨äºï¼VXLANçå°åä¸è§£åé½æ¯å¨åæ ¸æå®æçï¼å¯¹æ¯UDPæ¨¡å¼ç¨æ·æä¸åæ ¸æçåæ¢æ¥è¯´ï¼æçå¤§å¤§çæåäºã\n\n\n# 3.3 flannelå®ç°vxlanæ¨¡å¼æµç¨\n\n\n\nå¨Node1çnet1ä¸­ping Node2çnet3ï¼æ°æ®æµå¦ä¸ï¼\n\n 1. bridgeä½ä¸ºnet1çä¸ä¸è·³ç½å³ï¼æä»¥ä¼ååéARPè·åbridgeçmacå°å\n 2. è·åå°åï¼ç¶ååéICMPæ°æ®åéè¿bridgeè¿å¥å°å®¿ä¸»æºçç½ç»åè®®æ ä¸­ï¼éè¿è·¯ç±è¡¨ï¼ä¼è¿å¥å°flannel.1ä¸­ï¼ä¸ä¸è·³å°åä¸ºNode2çflannel.1çå°å\n 3. æ¬æ¥æ¯è¦åéARPæ¥è·åNode2çflannel.1çå°åï¼å ä¸ºå·²ç»æå¨éç½®äºARPè¡¨ï¼å¯ä»¥ç´æ¥è·åå°å°MACå°åï¼ç¶åå°å¶å¡«ååå±äºå±å¤´ä¸­ã\n 4. åéè¿æ¥è¯¢FDBè¡¨ï¼æ¾å°å¤å±UDPåä¸­ç®çIPå°åï¼ä¹å°±æ¯Node2çIPå°åï¼å¡«åå°å¤é¨IPå¤´ä¸­ãæç»éè¿ç©çç½å¡ens18èµ°å¤é¨ç½ç»è¾¾å°Node2ä¸­ã\n 5. è¾¾å°Node2åï¼éè¿ç«¯å£8472ï¼å°åè½¬åç»VTEPè®¾å¤flannel.1è¿è¡è§£åï¼è§£å°åçIPåç»è¿è·¯ç±è¡¨è¾¾å°bridgeä¸­ï¼æç»è½¬åå°net3ä¸­ã\n\n\n# 3.4 æå¨æ¨¡æflanneldç»´æ¤VTEPç»å®è·µ\n\nåå»ºVTEPè®¾å¤å½åä¸ºflannel.1ï¼ç¶åflannel.1éç½®ipå°åä¸º172.19.1.0/32\n\n# æ·»å VTEPè®¾å¤\nip link add flannel.1 type vxlan id 42 dstport 8472 local 10.65.132.187 dev ens18 nolearning proxy\n\n# éç½®flannel.1\nip link set flannel.1 up\nip a add 172.19.1.0/32 dev flannel.1\n\n\n1\n2\n3\n4\n5\n6\n\n * åªéè¦å¡«ålocalå°å\n * nolearningï¼VTEPä¸è¦éè¿æ¶å°çæ¥æå­¦ä¹ FDBè¡¨é¡¹çåå®¹ï¼åå°å¹¿æ­é£æ´ï¼æé«æçã\n * proxyï¼VTEPæ¿æARPä»£çåè½ï¼æ¶å°ARPè¯·æ±æ¶ï¼å¦ææç¼å­åç´æ¥åºç­ï¼åå°å¹¿æ­é£æ´ï¼æé«æçã\n\næ·»å network namespace net1ï¼åå»ºveth pairï¼å°å¶ä¸­ä¸ç«¯æ¾è¿net1ä¸­ï¼å¹¶éç½®å¥½ipå°åï¼åæ·»å é»è®¤è·¯ç±é½èµ°veth0\n\nip netns add net1\nip link add veth0 type veth peer name veth1\nip link set dev veth0 up\n\n# è®¾ç½®net1ä¸­ç½ç»éç½®\nip link set dev veth0 netns net1\nip netns exec net1 ip addr add 172.19.1.2/24 dev veth0\nip netns exec net1 ip link set veth0 up\n\n# é»è®¤è·¯ç±\nip netns exec net1 ip r add default via 172.19.1.1 dev veth0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nåå»ºç½æ¡¥è®¾å¤å½åä¸ºbridge0ï¼å¹¶å°veth1æå°å¶ä¸\n\n# æ·»å ç½æ¡¥\nip link add bridge0 type bridge\nip link set bridge0 up\nip a add 172.19.1.1/24 dev bridge0\n\n# å°å¦ä¸ç«¯ç»å®å¨ç½æ¡¥ä¸\nip link set dev veth1 up\nip link set dev veth1 master bridge0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå°è¾¾net3çæ°æ®åä¸ä¸è·³ä¸ºNode2çVTEPè®¾å¤IPéè¿flannel.1è®¾å¤ï¼éè¦æ·»å onlinkï¼å ä¸ºä¸ä¸è·³ç½å³ä¸åæ¬å°å°åå¨åä¸ç½æ®µï¼è·¯ç±æ·»å æ¶è¾åºè·¯ç±ä¸å¯è¾¾çéè¯¯ï¼onlinkçæä¹å¨äºåè®®æ è½ç¶æ¾ä¸å°é¾è·¯å±ç´è¿è·¯ç±ï¼ä½æ¯è¿æ¯ä¼åå¸éå¯¹viaç½å³çarpè¯·æ±ç.\n\nip r add 172.19.2.0/24 via 172.19.2.0 dev flannel.1 onlink\n\n\n1\n\n\nå¨Node2èç¹ä¸­éå¤ä¸é¢æä½åå»ºVETPè®¾å¤åç¸å³ç½ç»éç½®\n\n# æ·»å VTEPè®¾å¤\nip link add flannel.1 type vxlan id 42 dstport 8472 local 10.65.132.188 dev ens18\nip link set flannel.1 up\nip a add 172.19.2.0/32 dev flannel.1\nip r add 172.19.1.0/24 via 172.19.1.0 dev flannel.1 onlink\n\n\n# æ·»å net3æ¨¡æå®¹å¨\nip netns add net3\nip link add veth0 type veth peer name veth1\n\n# è®¾ç½®net3ä¸­ç½ç»éç½®\nip link set dev veth0 netns net3\nip netns exec net3 ip addr add 172.19.2.2/24 dev veth0\nip netns exec net3 ip link set veth0 up\nip netns exec net3 ip r add default dev veth0\nip netns exec net3 ip r add default via 172.19.2.1 dev veth0\n\n# æ·»å ç½æ¡¥\nip link add bridge0 type bridge\nip a add 172.19.2.1/24 dev bridge0\nip link set bridge0 up\n\n# å°å¦ä¸ç«¯ç»å®å¨ç½æ¡¥ä¸\nip link set dev veth1 up\nip link set dev veth1 master bridge0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\nå¨Node1èç¹ä¸­éè¦åæ°å¢ARPç¼å­ï¼Node1ä¸­æ·»å è·¯ç±çä¸ä¸è·³å°åæ¯Node2çVTEPè®¾å¤ï¼æä»¥éè¦å¨arpæ·»å VTEP IPåMACå°åçç¼å­ã\n\narp -s 172.19.2.0 8a:8b:4d:10:82:56 dev flannel.1\n\n\n1\n\n\nåå¨èç¹FDBè¡¨ä¸­æ·»å å¯¹ç«¯VETP MACå°ååå¯¹å¤IPï¼ç©çç½å¡IPï¼çæ å°å³ç³»è¡¨é¡¹\n\nbridge fdb add 8a:8b:4d:10:82:56 dev flannel.1 dst 10.65.132.188\n\n\n1\n\n\néå¤Node1æä½ï¼éç½®Node2çARPç¼å­åFDBè¡¨ã\n\narp -s 172.19.1.0 1e:b7:5e:19:ab:90 dev flannel.1\nbridge fdb add 1e:b7:5e:19:ab:90 dev flannel.1 dst 10.65.132.187\n\n\n1\n2\n\n\néè¿ä»¥ä¸æä½å®æäºç¯å¢çæ­å»ºï¼æ¥ä¸æ¥ï¼æä»¬å¨Node1çnet1ä¸­è¿è¡ping Node2çnet3ï¼å¯ä»¥åç°æ¯å¯ä»¥pingéç\n\n# ip netns exec net1 ping 172.19.2.2 -c 2\nPING 172.19.2.2 (172.19.2.2) 56(84) bytes of data.\n64 bytes from 172.19.2.2: icmp_seq=1 ttl=62 time=0.547 ms\n64 bytes from 172.19.2.2: icmp_seq=2 ttl=62 time=0.560 ms\n\n\n1\n2\n3\n4\n\n\n\n# 4. Host Gatewayæ¨¡å¼\n\n\n# 4.1 ç®ä»\n\néè¿æä¸»æºå½ä½ç½å³å®ç°è·¨èç¹ç½ç»éä¿¡çãå æ­¤éä¿¡åæ¹çå®¿ä¸»æºè¦æ±è½å¤ç´æ¥è·¯ç±ï¼å¿é¡»å¨åä¸ä¸ªç½ç»ï¼è¿ä¸ªéå¶ä½¿å¾host-gwæ¨¡å¼æ æ³éç¨äºéç¾¤è§æ¨¡è¾å¤§ä¸éè¦å¯¹èç¹è¿è¡ç½æ®µååçåºæ¯ãhost-gwçå¦å¤ä¸ä¸ªéå¶åæ¯éçéç¾¤ä¸­èç¹è§æ¨¡çå¢å¤§ï¼flanneldç»´æ¤ä¸»æºä¸æåä¸ä¸æ¡è·¯ç±è¡¨çå¨ææ´æ°ä¹æ¯ä¸ä¸ªä¸å°çååã\n\nflanneldçå¯ä¸ä½ç¨å°±æ¯è´è´£ä¸»æºä¸è·¯ç±è¡¨çå¨æï¼ä½å ä¸ºåªè½ä¿®æ¹ä¸»æºçè·¯ç±ï¼æä»¥åä¸ªä¸»æºå¿é¡»äºå±ç½ç»äºéã\n\nè·VXLANæ¨¡å¼åUDPæ¨¡å¼æ¯è¾ï¼ä¼ç¹ä¸»è¦æ¯æ²¡æå°åä¸è§£åçæä½ï¼å¤§å¤§çæé«äºæ§è½ã\n\n\n# 4.3 flannelå®ç°Host Gatewayæ¨¡å¼æµç¨\n\n\n\nå¨Node1çnet1ä¸­ping Node2çnet3ï¼æ°æ®æµå¦ä¸ï¼\n\n 1. æ°æ®åä»å®¹å¨è¿å¥å°å®¿ä¸»æºç½ç»åè®®æ é»è¾ä¸VXLANæ¨¡å¼ä¸è´\n 2. éè¿è·¯ç±è¡¨å¯ç¥ï¼è¯¥æ°æ®åéè¿ens18ç½å¡å°è¾¾ä¸ä¸è·³ç½å³Node2çens18\n 3. éè¿ç©çç½ç»ï¼è¾¾å°Node2å¹¶è¿å¥ç½ç»åè®®æ ï¼éè¿è·¯ç±è¾¾å°bridgeè¿å¥å°net3ä¸­\n\n\n# 4.4 æå¨æ¨¡æflannelå®ç°Host Gatewayæ¨¡å¼å®éª\n\nå¨Node1ä¸­åå»ºNetwork Namesapce net1ãvethpairåç½æ¡¥ï¼å¹¶éç½®å¥½å¶ç½ç»ã\n\nip netns add net1\nip link add veth0 type veth peer name veth1\nip link set dev veth0 up\n\n# è®¾ç½®net1ä¸­ç½ç»éç½®\nip link set dev veth0 netns net1\nip netns exec net1 ip addr add 172.19.1.2/24 dev veth0\nip netns exec net1 ip link set veth0 up\n\n# é»è®¤è·¯ç±\nip netns exec net1 ip r add default via 172.19.1.1 dev veth0\n\n# æ·»å ç½æ¡¥\nip link add bridge0 type bridge\nip link set bridge0 up\nip a add 172.19.1.1/24 dev bridge0\n\n# å°å¦ä¸ç«¯ç»å®å¨ç½æ¡¥ä¸\nip link set dev veth1 up\nip link set dev veth1 master bridge0\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nåæ·»å è·¯ç±ï¼å°Node2æåéå°çå®¹å¨ç½æ®µä¸ºç®çæ°æ®åé½å°Node2ä½ä¸ºä¸ä¸è·³ç½å³ã\n\nip r add 172.19.2.0/24 via 10.65.132.188 dev ens18\n\n\n1\n\n\néå¤Node1çéç½®ï¼å¹¶æ·»å å°Node1æåéå°çå®¹å¨ç½æ®µä¸ºç®çæ°æ®åé½å°Node1ä½ä¸ºä¸ä¸è·³ç½å³ã\n\n# æ·»å net3æ¨¡æå®¹å¨\nip netns add net3\nip link add veth0 type veth peer name veth1\n\n# è®¾ç½®net3ä¸­ç½ç»éç½®\nip link set dev veth0 netns net3\nip netns exec net3 ip addr add 172.19.2.2/24 dev veth0\nip netns exec net3 ip link set veth0 up\nip netns exec net3 ip r add default via 172.19.2.1 dev veth0\n\n# æ·»å ç½æ¡¥\nip link add bridge0 type bridge\nip a add 172.19.2.1/24 dev bridge0\nip link set bridge0 up\n\n# å°å¦ä¸ç«¯ç»å®å¨ç½æ¡¥ä¸\nip link set dev veth1 up\nip link set dev veth1 master bridge0\n\n# è·¯ç±\nip r add 172.19.1.0/24 via 10.65.132.187 dev ens18\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nå¨Node1çnet1ä¸­ping Node2çnet2ï¼æ¯å¯ä»¥pingéçï¼è¯´æç½ç»äºéäºã\n\nå¨éè¿tcpdumpæåNode2 ens18ç½å¡çåï¼å¯ä»¥çå°ICMPæ°æ®åå°äºNode2èç¹ã\n\n# tcpdump -i ens18 host 172.19.2.2\ndropped privs to tcpdump\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on ens18, link-type EN10MB (Ethernet), capture size 262144 bytes\n15:07:00.072677 IP 172.19.1.2 > 172.19.2.2: ICMP echo request, id 52240, seq 8, length 64\n15:07:00.072782 IP 172.19.2.2 > 172.19.1.2: ICMP echo reply, id 52240, seq 8, length 64\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 5. å·¨äººçè©è\n\n * Flannel Vxlanå°ååçåæ\n * ãkubernetesç½ç»æå¨æåã\n * ãæå®¢æ¶é´-æ·±å¥åæKubernetesã',normalizedContent:'# 0. åè¨\n\næ¬æä¸»è¦ä»ç»flannelå¨k8sç½ç»ä¸­ä½ä¸ºç½ç»æä»¶éè¿udpãvxlanãhost-gatewayä¸ç§æ¨¡å¼æ¥è§£å³å®¹å¨è·¨ä¸»æºç½ç»éä¿¡çï¼å¹¶éè¿æå¨å®ç°è¿ä¸ç§æ¨¡å¼æ·±å¥çè§£å¶åçã\n\n\n# 1. flannelå¨å±ç½ç»å°ååéæºå¶\n\næ¯å°èç¹ä¸å®¹å¨çipå°åæ¯ç±æå±èç¹èªå¨åéçï¼é£ä¹ä¼å­å¨ä¸ä¸ªé®é¢æ¯ï¼ä¸åèç¹ä¸çå®¹å¨æåéçipå°ååå¯è½ä¼æéå¤çæåµã\n\nflannelè®¾è®¡äºä¸ç§å¨å±çç½ç»å°ååéæºå¶ï¼flannelä¼ä¸ºæ¯å°èç¹ç³è¯·ä¸ä¸ªç¬ä¸æ äºçç½æ®µï¼å¹¶å­å¨å¨etcdä¸­ï¼flannelä¼å°è¯¥ç½æ®µéç½®å°åä¸ªèç¹ä¸çdocker(æèå¶ä»å®¹å¨å·¥å·)ï¼å½åèç¹ä¸çå®¹å¨ åªä»åéçç½æ®µéä¸­è·åipå°åã\n\n> ä¿®æ¹dockerå¯å¨åæ°--bipæ¥éå¶èç¹å®¹å¨è·å¾çipèå´ã\n\n\n\n\n# 2. udpæ¨¡å¼\n\n\n# 2.1 ç®ä»\n\nå¨flannelçudpæ¨¡å¼ä¸­ï¼æ¯ä¸ªèç¹é½ä¼å¯å¨ä¸ä¸ªudpæå¡å¨ï¼ç¨äºçå¬æ¥èªå¶ä»èç¹çæ°æ®åãå½ä¸ä¸ªå®¹å¨åå¦ä¸ä¸ªå®¹å¨åéæ°æ®åæ¶ï¼å®ä¼å°æ°æ®ååéå°ç®æ å®¹å¨çipå°ååç«¯å£å·ãflannelä¼å°è¯¥æ°æ®åå°è£å¨ä¸ä¸ªudpæ°æ®åä¸­ï¼å¹¶å°å¶åéå°ç®æ èç¹çudpæå¡å¨ãç®æ èç¹çudpæå¡å¨ä¼è§£æè¯¥æ°æ®åï¼å¹¶å°å¶ä¼ éç»ç®æ å®¹å¨ã\n\n\n# 2.2 flannelå®ç°udpæµç¨\n\n\n\nflanneldå¯å¨åä¼éè¿æå¼/dev/net/tunçæ¹å¼åå»ºtunè®¾å¤ï¼åç§°ä¸ºflannel0ï¼è¯¥è®¾å¤æ¯ç¨æ·ç©ºé´ä¸åæ ¸ç©ºé´çæ°æ®åäº¤äºçééãç¶ååå°ä»tunè®¾å¤è·åçipæ°æ®åå°è£å°udpæ°æ®åä¸­éè¿ç©çç½å¡åéå°å¶ä»èç¹ä¸­ï¼åæ ¸éè¿udpç«¯å£è½¬åç»flanneldç¶åè§£åï¼å¾å°å¶ä¸­çipæ°æ®åï¼ç¶ååéè¿tunè®¾å¤è¿å¥åæ ¸ç©ºé´ä¸­ï¼éè¿è·¯ç±å°è¾¾ç½æ¡¥ï¼ç¶ååå°ç®çå®¹å¨ä¸­ã\n\nflanneldå¨å¶ä¸­ä¸»è¦åäºï¼\n\n 1. å¼å¯äºudpæå¡ï¼å¹¶å¯¹udpæ°æ®åå°ååè§£å\n 2. èç¹ä¸è·¯ç±è¡¨çå¨ææ´æ°ï¼ä¹å°±æ¯ä»ç½æ¡¥åºæ¥çæ°æ®åç®çipä¸ºå¶ä»èç¹å®¹å¨ipæ¶ï¼éè¦è·¯ç±å°flanneldä¸­è¿è¡å°åï¼å¹¶ä¸å¨flanneldæ¥æ¶udpååè§£å°åºæ¥çipåéè¦éè¿è·¯ç±å°ç½æ¡¥docker0ä¸­\n\nç¼ºç¹å¾ææ¾ï¼ä»ä¸æ¬¡ç½ç»ä¼ è¾çæ°æ®åç»åäº2æ¬¡ç¨æ·æä¸åæ ¸æçåæ¢ï¼èåæ¢çæçæ¯ä¸é«çï¼æ¯ä¸æ¬¡çåæ¢é½æ¯ä¸æ¬¡æ°æ®çå¤å¶ã\n\n\n\n\n# 2.3 æå¨æ¨¡æflannelå®ç°udpå®éª\n\né¦ååå»ºnetwork namesapce net1ç¨æ¥æ¨¡æå®¹å¨\n\nip netns add net1\n\n\n1\n\n\nç¶ååå»ºä¸å¯¹veth pairç½å¡veth0åveth1ï¼å¹¶å°veth0æ¾å°net1ä¸­ï¼æèµ·å¹¶è®¾ç½®veth0çipå°åä¸º172.19.1.2/24\n\nip link add veth0 type veth peer name veth1\n\nip link set dev veth0 netns net1\nip netns exec net1 ip addr add 172.19.1.2/24 dev veth0\nip netns exec net1 ip link set veth0 up\n\n\n1\n2\n3\n4\n5\n\n\nåå»ºç½æ¡¥è®¾å¤ï¼æèµ·å¹¶è®¾ç½®ipå°åä¸º172.19.1.1/24ï¼å°veth1æèµ·å¹¶ç»å®å°ç½æ¡¥bridge0ä¸­\n\n# æ·»å ç½æ¡¥\nip link add bridge0 type bridge\nip link set bridge0 up\nip a add 172.19.1.1/24 dev bridge0\n\n# å°å¦ä¸ç«¯ç»å®å¨ç½æ¡¥ä¸\nip link set dev veth1 up\nip link set dev veth1 master bridge0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¨net1ä¸­æ·»å é»è®¤è·¯ç±ï¼è®¾ç½®ä¸ä¸æ¡å°åä¸ºç½æ¡¥bridge0çipå°åï¼ä»ç½æ¡¥è¿å¥å°å®¿ä¸»æºçç½ç»åè®®æ ä¸­ã\n\nip netns exec net1 ip r add default via 172.19.1.1 dev veth0\n\n\n1\n\n\nåè¿è¡ä»¥ä¸ä»£ç ï¼è¯¥ä»£ç æ¯ç¨æ¥æ¨¡æflanneldç¨åºï¼ä¸»è¦ä½ç¨æ¯åå»ºäºtunè®¾å¤flannel0ï¼å¼å¯äºudpæå¡æ¶åudpåï¼ç¶åå°±æ¯å¯¹å®¹å¨ipåçå°è£ä¸è§£å°ã\n\nimport os\nimport socket\nimport struct\nimport threading\nfrom fcntl import ioctl\nimport click\n\nbind_address = (\'0.0.0.0\', 8285)\nbuffer_size = 4096\n\ntunsetiff = 0x400454ca\niff_tun = 0x0001\niff_tap = 0x0002\n\n\ndef create_tunnel(tun_name=\'flannel%d\', tun_mode=iff_tun):\n    tun_fd = os.open("/dev/net/tun", os.o_rdwr)\n    ifn = ioctl(tun_fd, tunsetiff, struct.pack(b"16sh", tun_name.encode(), tun_mode))\n    tun_name = ifn[:16].decode().strip("\\x00")\n    return tun_fd, tun_name\n\n\ndef start_tunnel(tun_name):\n    os.popen(f"ip link set {tun_name} up")\n\n\ndef udp_server(udp_socket, tun_fd):\n    while true:\n        data, addr = udp_socket.recvfrom(2048)\n        print("get data from udp.")\n        if not data:\n            break\n\n        os.write(tun_fd, data)\n\n\n@click.command()\n@click.option("--peer_node_ip", "-p", required=true, help="å¯¹ç«¯èç¹ip")\ndef main(peer_node_ip):\n    peer_node_addr = (peer_node_ip, 7000)\n\n    tun_fd, tun_name = create_tunnel()\n    start_tunnel(tun_name)\n\n    udp_socket = socket.socket(socket.af_inet, socket.sock_dgram)\n    udp_socket.bind(bind_address)\n\n    t = threading.thread(target=udp_server, args=(udp_socket, tun_fd))\n    t.daemon = true\n    t.start()\n\n    while true:\n        data = os.read(tun_fd, buffer_size)\n        print(f"get data from tun. data size = {len(data)}")\n        udp_socket.sendto(data, peer_node_addr)\n\n\nif __name__ == \'__main__\':\n    main()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n\n\nå¨node1ä¸­è¿è¡è¯¥ç¨åºï¼è®¾ç½®node2 ip\n\npython3 tun_app.py -p 10.65.132.188\n\n\n1\n\n\nå¯ä»¥çå°å·²ç»åå»ºäºtunè®¾å¤\n\n# ip link show flannel0\n...\n109: tun0: <pointopoint,multicast,noarp,up,lower_up> mtu 1500 qdisc pfifo_fast state unknown group default qlen 500\n    link/none \n    inet6 fe80::8e98:91a4:6537:d77a/64 scope link flags 800 \n       valid_lft forever preferred_lft forever\n...\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå¨è®¾ç½®å®¿ä¸»æºçè·¯ç±ï¼å°ææå°node2å®¹å¨çipåï¼é½è½¬åå°flannel0è®¾å¤ä¸­ã\n\nip r add 172.19.2.0/24 dev flannel0\n\n\n1\n\n\næåéå¤node1çæä½éç½®node2\n\n# åå»ºnet3\nip netns add net3\n\n# åå»ºveth pair\nip link add veth0 type veth peer name veth1\n\n# è®¾ç½®net1ç½ç»\nip link set dev veth0 netns net3\nip netns exec net3 ip addr add 172.19.2.2/24 dev veth0\nip netns exec net3 ip link set veth0 up\n\n# æ·»å ç½æ¡¥\nip link add bridge0 type bridge\nip link set bridge0 up\nip a add 172.19.2.1/24 dev bridge0\n\n# å°å¦ä¸ç«¯ç»å®å¨ç½æ¡¥ä¸\nip link set dev veth1 up\nip link set dev veth1 master bridge0\n\n# éç½®net3è·¯ç±\nip netns exec net3 ip r add default via 172.19.2.1 dev veth0\n\n# åå»ºflannel0\npython3 flanneld.py -p 10.65.132.187\n\n# éç½®å°flannel0çè·¯ç±\nip r add 172.19.1.0/24 dev flannel0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n\n# 2.4 åæ\n\nå¨node1çnet1ä¸­ping node2çnet2çip 172.19.2.2ï¼å¯ä»¥çå°æ¯å¯ä»¥pingéç\n\n# ping 172.19.2.2 -c 1\nping 172.19.2.2 (172.19.2.2) 56(84) bytes of data.\n64 bytes from 172.19.2.2: icmp_seq=1 ttl=63 time=0.641 ms\n\n--- 172.19.2.2 ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.641/0.641/0.641/0.000 ms\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå¨node1çflanneld.pyä¸­çå°æ¥å¿ï¼ä»tunä¸­æ¶å°äºæ¥èªå®¹å¨çipæ°æ®å\n\n# python3 flanneld.py -p 10.65.132.188\nget data from tun. data size = 88\n\n\n1\n2\n\n\nå¨node2çflanneld.pyä¸­çå°æ¥å¿ï¼æ¥æ¶å°äºnode1åéè¿æ¥çudpæ°æ®åã\n\n# python3 flanneld.py -p 10.65.132.187\nget data from udp.\n\n\n1\n2\n\n\n\n# 3. vxlanæ¨¡å¼\n\n\n# 3.1 ç®ä»\n\nå¨flannelçvxlanæ¨¡å¼ä¸­ï¼æ¯ä¸ªèç¹é½ä¼å¯å¨ä¸ä¸ªvxlané§éï¼ç¨äºå°å®¹å¨ä¹é´çæ°æ®åå°è£å¨vxlanåè®®ä¸­è¿è¡ä¼ è¾ãå½ä¸ä¸ªå®¹å¨åå¦ä¸ä¸ªå®¹å¨åéæ°æ®åæ¶ï¼å®ä¼å°æ°æ®ååéå°ç®æ å®¹å¨çipå°ååèæç½ç»idãflannelä¼å°è¯¥æ°æ®åå°è£å¨ä¸ä¸ªvxlanæ°æ®åä¸­ï¼å¹¶å°å¶åéå°ç®æ èç¹çvxlané§éãç®æ èç¹çvxlané§éä¼è§£æè¯¥æ°æ®åï¼å¹¶å°å¶ä¼ éç»ç®æ å®¹å¨ã\n\nvxlanæ¨¡å¼ä¹æ¯éè¿å°åä¸è§£åçå½¢å¼æ¥å®ç°é§éè¾¾å°å®¹å¨çè·¨ä¸»æºè®¿é®ï¼é£åudpæ¨¡å¼æä»ä¹åºå«å¢ï¼ åºå«å¨äºï¼vxlançå°åä¸è§£åé½æ¯å¨åæ ¸æå®æçï¼å¯¹æ¯udpæ¨¡å¼ç¨æ·æä¸åæ ¸æçåæ¢æ¥è¯´ï¼æçå¤§å¤§çæåäºã\n\n\n# 3.3 flannelå®ç°vxlanæ¨¡å¼æµç¨\n\n\n\nå¨node1çnet1ä¸­ping node2çnet3ï¼æ°æ®æµå¦ä¸ï¼\n\n 1. bridgeä½ä¸ºnet1çä¸ä¸è·³ç½å³ï¼æä»¥ä¼ååéarpè·åbridgeçmacå°å\n 2. è·åå°åï¼ç¶ååéicmpæ°æ®åéè¿bridgeè¿å¥å°å®¿ä¸»æºçç½ç»åè®®æ ä¸­ï¼éè¿è·¯ç±è¡¨ï¼ä¼è¿å¥å°flannel.1ä¸­ï¼ä¸ä¸è·³å°åä¸ºnode2çflannel.1çå°å\n 3. æ¬æ¥æ¯è¦åéarpæ¥è·ånode2çflannel.1çå°åï¼å ä¸ºå·²ç»æå¨éç½®äºarpè¡¨ï¼å¯ä»¥ç´æ¥è·åå°å°macå°åï¼ç¶åå°å¶å¡«ååå±äºå±å¤´ä¸­ã\n 4. åéè¿æ¥è¯¢fdbè¡¨ï¼æ¾å°å¤å±udpåä¸­ç®çipå°åï¼ä¹å°±æ¯node2çipå°åï¼å¡«åå°å¤é¨ipå¤´ä¸­ãæç»éè¿ç©çç½å¡ens18èµ°å¤é¨ç½ç»è¾¾å°node2ä¸­ã\n 5. è¾¾å°node2åï¼éè¿ç«¯å£8472ï¼å°åè½¬åç»vtepè®¾å¤flannel.1è¿è¡è§£åï¼è§£å°åçipåç»è¿è·¯ç±è¡¨è¾¾å°bridgeä¸­ï¼æç»è½¬åå°net3ä¸­ã\n\n\n# 3.4 æå¨æ¨¡æflanneldç»´æ¤vtepç»å®è·µ\n\nåå»ºvtepè®¾å¤å½åä¸ºflannel.1ï¼ç¶åflannel.1éç½®ipå°åä¸º172.19.1.0/32\n\n# æ·»å vtepè®¾å¤\nip link add flannel.1 type vxlan id 42 dstport 8472 local 10.65.132.187 dev ens18 nolearning proxy\n\n# éç½®flannel.1\nip link set flannel.1 up\nip a add 172.19.1.0/32 dev flannel.1\n\n\n1\n2\n3\n4\n5\n6\n\n * åªéè¦å¡«ålocalå°å\n * nolearningï¼vtepä¸è¦éè¿æ¶å°çæ¥æå­¦ä¹ fdbè¡¨é¡¹çåå®¹ï¼åå°å¹¿æ­é£æ´ï¼æé«æçã\n * proxyï¼vtepæ¿æarpä»£çåè½ï¼æ¶å°arpè¯·æ±æ¶ï¼å¦ææç¼å­åç´æ¥åºç­ï¼åå°å¹¿æ­é£æ´ï¼æé«æçã\n\næ·»å network namespace net1ï¼åå»ºveth pairï¼å°å¶ä¸­ä¸ç«¯æ¾è¿net1ä¸­ï¼å¹¶éç½®å¥½ipå°åï¼åæ·»å é»è®¤è·¯ç±é½èµ°veth0\n\nip netns add net1\nip link add veth0 type veth peer name veth1\nip link set dev veth0 up\n\n# è®¾ç½®net1ä¸­ç½ç»éç½®\nip link set dev veth0 netns net1\nip netns exec net1 ip addr add 172.19.1.2/24 dev veth0\nip netns exec net1 ip link set veth0 up\n\n# é»è®¤è·¯ç±\nip netns exec net1 ip r add default via 172.19.1.1 dev veth0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nåå»ºç½æ¡¥è®¾å¤å½åä¸ºbridge0ï¼å¹¶å°veth1æå°å¶ä¸\n\n# æ·»å ç½æ¡¥\nip link add bridge0 type bridge\nip link set bridge0 up\nip a add 172.19.1.1/24 dev bridge0\n\n# å°å¦ä¸ç«¯ç»å®å¨ç½æ¡¥ä¸\nip link set dev veth1 up\nip link set dev veth1 master bridge0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå°è¾¾net3çæ°æ®åä¸ä¸è·³ä¸ºnode2çvtepè®¾å¤ipéè¿flannel.1è®¾å¤ï¼éè¦æ·»å onlinkï¼å ä¸ºä¸ä¸è·³ç½å³ä¸åæ¬å°å°åå¨åä¸ç½æ®µï¼è·¯ç±æ·»å æ¶è¾åºè·¯ç±ä¸å¯è¾¾çéè¯¯ï¼onlinkçæä¹å¨äºåè®®æ è½ç¶æ¾ä¸å°é¾è·¯å±ç´è¿è·¯ç±ï¼ä½æ¯è¿æ¯ä¼åå¸éå¯¹viaç½å³çarpè¯·æ±ç.\n\nip r add 172.19.2.0/24 via 172.19.2.0 dev flannel.1 onlink\n\n\n1\n\n\nå¨node2èç¹ä¸­éå¤ä¸é¢æä½åå»ºvetpè®¾å¤åç¸å³ç½ç»éç½®\n\n# æ·»å vtepè®¾å¤\nip link add flannel.1 type vxlan id 42 dstport 8472 local 10.65.132.188 dev ens18\nip link set flannel.1 up\nip a add 172.19.2.0/32 dev flannel.1\nip r add 172.19.1.0/24 via 172.19.1.0 dev flannel.1 onlink\n\n\n# æ·»å net3æ¨¡æå®¹å¨\nip netns add net3\nip link add veth0 type veth peer name veth1\n\n# è®¾ç½®net3ä¸­ç½ç»éç½®\nip link set dev veth0 netns net3\nip netns exec net3 ip addr add 172.19.2.2/24 dev veth0\nip netns exec net3 ip link set veth0 up\nip netns exec net3 ip r add default dev veth0\nip netns exec net3 ip r add default via 172.19.2.1 dev veth0\n\n# æ·»å ç½æ¡¥\nip link add bridge0 type bridge\nip a add 172.19.2.1/24 dev bridge0\nip link set bridge0 up\n\n# å°å¦ä¸ç«¯ç»å®å¨ç½æ¡¥ä¸\nip link set dev veth1 up\nip link set dev veth1 master bridge0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\nå¨node1èç¹ä¸­éè¦åæ°å¢arpç¼å­ï¼node1ä¸­æ·»å è·¯ç±çä¸ä¸è·³å°åæ¯node2çvtepè®¾å¤ï¼æä»¥éè¦å¨arpæ·»å vtep ipåmacå°åçç¼å­ã\n\narp -s 172.19.2.0 8a:8b:4d:10:82:56 dev flannel.1\n\n\n1\n\n\nåå¨èç¹fdbè¡¨ä¸­æ·»å å¯¹ç«¯vetp macå°ååå¯¹å¤ipï¼ç©çç½å¡ipï¼çæ å°å³ç³»è¡¨é¡¹\n\nbridge fdb add 8a:8b:4d:10:82:56 dev flannel.1 dst 10.65.132.188\n\n\n1\n\n\néå¤node1æä½ï¼éç½®node2çarpç¼å­åfdbè¡¨ã\n\narp -s 172.19.1.0 1e:b7:5e:19:ab:90 dev flannel.1\nbridge fdb add 1e:b7:5e:19:ab:90 dev flannel.1 dst 10.65.132.187\n\n\n1\n2\n\n\néè¿ä»¥ä¸æä½å®æäºç¯å¢çæ­å»ºï¼æ¥ä¸æ¥ï¼æä»¬å¨node1çnet1ä¸­è¿è¡ping node2çnet3ï¼å¯ä»¥åç°æ¯å¯ä»¥pingéç\n\n# ip netns exec net1 ping 172.19.2.2 -c 2\nping 172.19.2.2 (172.19.2.2) 56(84) bytes of data.\n64 bytes from 172.19.2.2: icmp_seq=1 ttl=62 time=0.547 ms\n64 bytes from 172.19.2.2: icmp_seq=2 ttl=62 time=0.560 ms\n\n\n1\n2\n3\n4\n\n\n\n# 4. host gatewayæ¨¡å¼\n\n\n# 4.1 ç®ä»\n\néè¿æä¸»æºå½ä½ç½å³å®ç°è·¨èç¹ç½ç»éä¿¡çãå æ­¤éä¿¡åæ¹çå®¿ä¸»æºè¦æ±è½å¤ç´æ¥è·¯ç±ï¼å¿é¡»å¨åä¸ä¸ªç½ç»ï¼è¿ä¸ªéå¶ä½¿å¾host-gwæ¨¡å¼æ æ³éç¨äºéç¾¤è§æ¨¡è¾å¤§ä¸éè¦å¯¹èç¹è¿è¡ç½æ®µååçåºæ¯ãhost-gwçå¦å¤ä¸ä¸ªéå¶åæ¯éçéç¾¤ä¸­èç¹è§æ¨¡çå¢å¤§ï¼flanneldç»´æ¤ä¸»æºä¸æåä¸ä¸æ¡è·¯ç±è¡¨çå¨ææ´æ°ä¹æ¯ä¸ä¸ªä¸å°çååã\n\nflanneldçå¯ä¸ä½ç¨å°±æ¯è´è´£ä¸»æºä¸è·¯ç±è¡¨çå¨æï¼ä½å ä¸ºåªè½ä¿®æ¹ä¸»æºçè·¯ç±ï¼æä»¥åä¸ªä¸»æºå¿é¡»äºå±ç½ç»äºéã\n\nè·vxlanæ¨¡å¼åudpæ¨¡å¼æ¯è¾ï¼ä¼ç¹ä¸»è¦æ¯æ²¡æå°åä¸è§£åçæä½ï¼å¤§å¤§çæé«äºæ§è½ã\n\n\n# 4.3 flannelå®ç°host gatewayæ¨¡å¼æµç¨\n\n\n\nå¨node1çnet1ä¸­ping node2çnet3ï¼æ°æ®æµå¦ä¸ï¼\n\n 1. æ°æ®åä»å®¹å¨è¿å¥å°å®¿ä¸»æºç½ç»åè®®æ é»è¾ä¸vxlanæ¨¡å¼ä¸è´\n 2. éè¿è·¯ç±è¡¨å¯ç¥ï¼è¯¥æ°æ®åéè¿ens18ç½å¡å°è¾¾ä¸ä¸è·³ç½å³node2çens18\n 3. éè¿ç©çç½ç»ï¼è¾¾å°node2å¹¶è¿å¥ç½ç»åè®®æ ï¼éè¿è·¯ç±è¾¾å°bridgeè¿å¥å°net3ä¸­\n\n\n# 4.4 æå¨æ¨¡æflannelå®ç°host gatewayæ¨¡å¼å®éª\n\nå¨node1ä¸­åå»ºnetwork namesapce net1ãvethpairåç½æ¡¥ï¼å¹¶éç½®å¥½å¶ç½ç»ã\n\nip netns add net1\nip link add veth0 type veth peer name veth1\nip link set dev veth0 up\n\n# è®¾ç½®net1ä¸­ç½ç»éç½®\nip link set dev veth0 netns net1\nip netns exec net1 ip addr add 172.19.1.2/24 dev veth0\nip netns exec net1 ip link set veth0 up\n\n# é»è®¤è·¯ç±\nip netns exec net1 ip r add default via 172.19.1.1 dev veth0\n\n# æ·»å ç½æ¡¥\nip link add bridge0 type bridge\nip link set bridge0 up\nip a add 172.19.1.1/24 dev bridge0\n\n# å°å¦ä¸ç«¯ç»å®å¨ç½æ¡¥ä¸\nip link set dev veth1 up\nip link set dev veth1 master bridge0\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nåæ·»å è·¯ç±ï¼å°node2æåéå°çå®¹å¨ç½æ®µä¸ºç®çæ°æ®åé½å°node2ä½ä¸ºä¸ä¸è·³ç½å³ã\n\nip r add 172.19.2.0/24 via 10.65.132.188 dev ens18\n\n\n1\n\n\néå¤node1çéç½®ï¼å¹¶æ·»å å°node1æåéå°çå®¹å¨ç½æ®µä¸ºç®çæ°æ®åé½å°node1ä½ä¸ºä¸ä¸è·³ç½å³ã\n\n# æ·»å net3æ¨¡æå®¹å¨\nip netns add net3\nip link add veth0 type veth peer name veth1\n\n# è®¾ç½®net3ä¸­ç½ç»éç½®\nip link set dev veth0 netns net3\nip netns exec net3 ip addr add 172.19.2.2/24 dev veth0\nip netns exec net3 ip link set veth0 up\nip netns exec net3 ip r add default via 172.19.2.1 dev veth0\n\n# æ·»å ç½æ¡¥\nip link add bridge0 type bridge\nip a add 172.19.2.1/24 dev bridge0\nip link set bridge0 up\n\n# å°å¦ä¸ç«¯ç»å®å¨ç½æ¡¥ä¸\nip link set dev veth1 up\nip link set dev veth1 master bridge0\n\n# è·¯ç±\nip r add 172.19.1.0/24 via 10.65.132.187 dev ens18\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nå¨node1çnet1ä¸­ping node2çnet2ï¼æ¯å¯ä»¥pingéçï¼è¯´æç½ç»äºéäºã\n\nå¨éè¿tcpdumpæånode2 ens18ç½å¡çåï¼å¯ä»¥çå°icmpæ°æ®åå°äºnode2èç¹ã\n\n# tcpdump -i ens18 host 172.19.2.2\ndropped privs to tcpdump\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on ens18, link-type en10mb (ethernet), capture size 262144 bytes\n15:07:00.072677 ip 172.19.1.2 > 172.19.2.2: icmp echo request, id 52240, seq 8, length 64\n15:07:00.072782 ip 172.19.2.2 > 172.19.1.2: icmp echo reply, id 52240, seq 8, length 64\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 5. å·¨äººçè©è\n\n * flannel vxlanå°ååçåæ\n * ãkubernetesç½ç»æå¨æåã\n * ãæå®¢æ¶é´-æ·±å¥åækubernetesã',charsets:{cjk:!0},lastUpdated:"2023/06/06, 18:33:56",lastUpdatedTimestamp:1686047636e3},{title:"kubernetes serviceå¦ä½éè¿iptablesè½¬å",frontmatter:{title:"kubernetes serviceå¦ä½éè¿iptablesè½¬å",date:"2024-01-18T16:40:30.000Z",permalink:"/pages/b3955c/",categories:["äºåç","k8s"],tags:["k8s","è®¡ç®æºç½ç»"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä¸»è¦æ¯ä»ç»kubernetesçserviceæ¯å¦ä½å©ç¨iptablesæ¥è¿è¡æµéçè½¬åè¾¾å°æµéçè´è½½åè¡¡çï¼å¹¶ä¼éè¿å®è·µæä½æ¥æ´å¥½ççè§£ä¸éªè¯å¶åçã",comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/image-20240110142336-wl40wxw.png"},{name:"twitter:title",content:"kubernetes serviceå¦ä½éè¿iptablesè½¬å"},{name:"twitter:description",content:"æ¬æä¸»è¦æ¯ä»ç»kubernetesçserviceæ¯å¦ä½å©ç¨iptablesæ¥è¿è¡æµéçè½¬åè¾¾å°æµéçè´è½½åè¡¡çï¼å¹¶ä¼éè¿å®è·µæä½æ¥æ´å¥½ççè§£ä¸éªè¯å¶åçã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/image-20240110142336-wl40wxw.png"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/16.kubernetes%20service%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87iptables%E8%BD%AC%E5%8F%91.html"},{property:"og:type",content:"article"},{property:"og:title",content:"kubernetes serviceå¦ä½éè¿iptablesè½¬å"},{property:"og:description",content:"æ¬æä¸»è¦æ¯ä»ç»kubernetesçserviceæ¯å¦ä½å©ç¨iptablesæ¥è¿è¡æµéçè½¬åè¾¾å°æµéçè´è½½åè¡¡çï¼å¹¶ä¼éè¿å®è·µæä½æ¥æ´å¥½ççè§£ä¸éªè¯å¶åçã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/image-20240110142336-wl40wxw.png"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/16.kubernetes%20service%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87iptables%E8%BD%AC%E5%8F%91.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2024-01-18T16:40:30.000Z"},{property:"article:tag",content:"k8s"},{property:"article:tag",content:"è®¡ç®æºç½ç»"},{itemprop:"name",content:"kubernetes serviceå¦ä½éè¿iptablesè½¬å"},{itemprop:"description",content:"æ¬æä¸»è¦æ¯ä»ç»kubernetesçserviceæ¯å¦ä½å©ç¨iptablesæ¥è¿è¡æµéçè½¬åè¾¾å°æµéçè´è½½åè¡¡çï¼å¹¶ä¼éè¿å®è·µæä½æ¥æ´å¥½ççè§£ä¸éªè¯å¶åçã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/image-20240110142336-wl40wxw.png"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/16.kubernetes%20service%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87iptables%E8%BD%AC%E5%8F%91.html",relativePath:"01.äºåç/07.k8s/16.kubernetes serviceå¦ä½éè¿iptablesè½¬å.md",key:"v-6cbb1851",path:"/pages/b3955c/",headers:[{level:2,title:"åè¨",slug:"åè¨",normalizedTitle:"åè¨",charIndex:39},{level:2,title:"ç¯å¢æ­å»º",slug:"ç¯å¢æ­å»º",normalizedTitle:"ç¯å¢æ­å»º",charIndex:126},{level:2,title:"KUBE-SERVICES",slug:"kube-services",normalizedTitle:"kube-services",charIndex:2150},{level:2,title:"POSTROUTING",slug:"postrouting",normalizedTitle:"postrouting",charIndex:5322},{level:2,title:"SNAT",slug:"snat",normalizedTitle:"snat",charIndex:5941},{level:3,title:"ä¸ºä»ä¹éç¾¤å¤é¨è®¿é®è¯¥serviceéè¦è¢«SNATï¼",slug:"ä¸ºä»ä¹éç¾¤å¤é¨è®¿é®è¯¥serviceéè¦è¢«snat",normalizedTitle:"ä¸ºä»ä¹éç¾¤å¤é¨è®¿é®è¯¥serviceéè¦è¢«snatï¼",charIndex:6449},{level:3,title:"conntrack",slug:"conntrack",normalizedTitle:"conntrack",charIndex:6624},{level:2,title:"æºåç®çIPç¸å",slug:"æºåç®çipç¸å",normalizedTitle:"æºåç®çipç¸å",charIndex:7440},{level:2,title:"NodePort",slug:"nodeport",normalizedTitle:"nodeport",charIndex:7954},{level:3,title:"æ­å»ºç¯å¢",slug:"æ­å»ºç¯å¢",normalizedTitle:"æ­å»ºç¯å¢",charIndex:132},{level:3,title:"è¯·æ±clusterip",slug:"è¯·æ±clusterip",normalizedTitle:"è¯·æ±clusterip",charIndex:8672},{level:3,title:"è¯·æ±èç¹IP",slug:"è¯·æ±èç¹ip",normalizedTitle:"è¯·æ±èç¹ip",charIndex:10190},{level:2,title:"åèé¾æ¥",slug:"åèé¾æ¥",normalizedTitle:"åèé¾æ¥",charIndex:10887}],headersStr:"åè¨ ç¯å¢æ­å»º KUBE-SERVICES POSTROUTING SNAT ä¸ºä»ä¹éç¾¤å¤é¨è®¿é®è¯¥serviceéè¦è¢«SNATï¼ conntrack æºåç®çIPç¸å NodePort æ­å»ºç¯å¢ è¯·æ±clusterip è¯·æ±èç¹IP åèé¾æ¥",content:"# kubernetes serviceå¦ä½éè¿iptablesè½¬å\n\n\n# åè¨\n\næ¬æä¸»è¦æ¯ä»ç»kubernetesçserviceæ¯å¦ä½å©ç¨iptablesæ¥è¿è¡æµéçè½¬åè¾¾å°æµéçè´è½½åè¡¡çï¼å¹¶ä¼éè¿å®è·µæä½æ¥æ´å¥½ççè§£ä¸éªè¯å¶åçã\n\n\n# ç¯å¢æ­å»º\n\næ­å»ºç¯å¢å¦ä¸å¾æç¤ºï¼\n\n\n\n 1. åå»ºä¸ä¸ªdeployï¼è®¾ç½®å¶å¯æ¬æ°ä¸º3\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: demoapp-deployment\n  labels:\n    app: demoapp\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: demoapp\n  template:\n    metadata:\n      labels:\n        app: demoapp\n    spec:\n      containers:\n        - name: ubuntu\n          image: ikubernetes/demoapp:v1.0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n 2. åå»ºserviceï¼ä¸ºä¸é¢deploymentç3ä¸ªpodè¿è¡è´è½½åè¡¡è®¿é®\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: demoapp-service\nspec:\n  selector:\n    app: demoapp\n  clusterIP: 192.44.140.73\n  ports:\n    - name: http\n      protocol: TCP\n      port: 80\n      targetPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n 3. éªè¯\n\nåå»ºå®åï¼ç¯å¢å¦ä¸ï¼\n\n# kubectl get pods -n zwf -o wide\nNAME                                  READY   STATUS    RESTARTS   AGE     IP\ndemoapp-deployment-64bdcb8666-4prbk   1/1     Running   0          7d17h   192.33.229.12   dmoc-fa163eee1e30\ndemoapp-deployment-64bdcb8666-cxmmz   1/1     Running   0          7d17h   192.33.73.139   dmoc-fa163e7188d6\ndemoapp-deployment-64bdcb8666-kkzsg   1/1     Running   0          7d17h   192.33.206.93   dmoc-fa163ee6bbe1\ndemoapp-pod                           1/1     Running   0          4d17h   192.33.73.172   dmoc-fa163e7188d6\n\n# kubectl get svc -n zwf\nNAME                       TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE\ndemoapp-service            ClusterIP   192.44.140.73    <none>        80/TCP         7s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå¯ä»¥ç´æ¥å¨ç¯å¢ä¸­è¯·æ±serviceçclusteripå°åï¼ä¼éæºè®¿é®å°ä¸ä¸ªpodï¼è¾åºçä¿¡æ¯åå«äºè¯·æ±IPåç®çIPã\n\n# curl 192.44.140.73\niKubernetes demoapp v1.0 !! ClientIP: 10.10.10.16, ServerName: demoapp-deployment-64bdcb8666-kkzsg, ServerIP: 192.33.206.93!\n\n# curl 192.44.140.73\niKubernetes demoapp v1.0 !! ClientIP: 10.65.196.41, ServerName: demoapp-deployment-64bdcb8666-cxmmz, ServerIP: 192.33.73.139!\n\n# curl 192.44.140.73\niKubernetes demoapp v1.0 !! ClientIP: 10.10.10.16, ServerName: demoapp-deployment-64bdcb8666-4prbk, ServerIP: 192.33.229.12!\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# KUBE-SERVICES\n\nå¨PREROUTING åOUTPUT é¾çnatè¡¨ä¸­ï¼é½åå«äºKUBE-SERVICES å­é¾ï¼è¯¥å­é¾ä¸­å°±åå«äºserivceçiptablesè§åçéç½®ã\n\n# iptables -L PREROUTING -t nat\nChain PREROUTING (policy ACCEPT)\ntarget     prot opt source               destination       \nKUBE-SERVICES  all  --  anywhere             anywhere             /* kubernetes service portals */\ncali-PREROUTING  all  --  anywhere             anywhere             /* cali:6gwbT8clXdHdC1b1 */\n\n# iptables -L OUTPUT -t nat\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination       \nKUBE-SERVICES  all  --  anywhere             anywhere             /* kubernetes service portals */\ncali-OUTPUT  all  --  anywhere             anywhere             /* cali:tVnHkvAo15HuiPy0 */\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nä¸ºä»ä¹å¨PREROUTINGåOUTPUTé¾ä¸­æ·»å serviceè§åï¼\n\nserviceçä½ç¨æ¯è´è½½åè¡¡ï¼ä¹å°±æ¯éè¦å°IPåè¿è¡DNATæä½ï¼èè¿ä¸ªæä½éè¦å¨æé è¿åéçä½ç½®ãç½å¡æ¶å°çåè¿å¥å°ç½ç»åè®®æ æ¶ï¼æåè¿å¥çå°±æ¯PREROUTINGé¾ï¼ä¹å°±æ¯èç¹å¤é¨çæµéè¿å¥çå¥å£ãOUTPUTæ¯æ¬å°è¿ç¨ååºçåæåè¿å¥çé¾ãæä»¥éè¦å¨è¿ä¸¤æ¡é¾ä¸­æ·»å KUBE-SERVICESï¼è¯¦æå¯åèå¿«éäºè§£iptables\n\nä¸ºä»ä¹natè¡¨ï¼\n\nå ä¸ºè¦åDNATæä½ï¼æä»¥å¨natè¡¨ã\n\nKUBE-SERVICESä¸é¢æè®¸å¤KUBE-SVC-XXXçå­é¾ï¼æ¯ä¸æ¡å­é¾é½æ¯ä¸ä¸ªéç¾¤ä¸­ä¸ä¸ªserviceçéç½®ï¼ç­éä¸ä¸\n\néè¿ç­édemoapp-service å¾å°ä¸é¢çå­é¾ï¼åªæè®¿é®ç®çå°åä¸º192.44.140.73æè½è¿å¥å°è¯¥å­é¾ä¸­ã\n\n# iptables -L KUBE-SERVICES -t nat | grep demoapp-service\nKUBE-SVC-FIHIHDNRZEG5VQEQ  tcp  --  anywhere             192.44.140.73        /* zwf/demoapp-service:http cluster IP */ tcp dpt:http\n\n\n1\n2\n\n\næ¥çUBE-SVC-FIHIHDNRZEG5VQEQ é¾ä¸­åå®¹ï¼å¶ä¸­åå«äºåæ¡å­é¾ã\n\n# iptables -L KUBE-SVC-FIHIHDNRZEG5VQEQ -t nat -n\nChain KUBE-SVC-FIHIHDNRZEG5VQEQ (1 references)\ntarget     prot opt source               destination       \nKUBE-MARK-MASQ  tcp  -- !192.33.0.0/16        192.44.140.73        /* zwf/demoapp-service:http cluster IP */ tcp dpt:80\nKUBE-SEP-FO7YK2K5DAKTCVSE  all  --  0.0.0.0/0            0.0.0.0/0            /* zwf/demoapp-service:http */ statistic mode random probability 0.33333333349\nKUBE-SEP-IPKL7NSNTVGKI4T5  all  --  0.0.0.0/0            0.0.0.0/0            /* zwf/demoapp-service:http */ statistic mode random probability 0.50000000000\nKUBE-SEP-BPER562ISF3UFYOQ  all  --  0.0.0.0/0            0.0.0.0/0            /* zwf/demoapp-service:http */\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nç¬¬ä¸æ¡é¾æ¯ï¼æºIPä¸å¨192.33.0.0/16æ®µãç®çIPä¸º192.44.140.73å¹¶ä¸ç®çç«¯å£æ¯80çæ°æ®åä¼å¹éå°è¯¥æ¡å­é¾è¿è¡è·³è½¬ãå¶ä¸­192.33.0.0/16æ¯podçç½æ®µï¼å¦æä¸æ¯éç¾¤åçæµéï¼åä¼å¹éä¸è¯¥æ¡å­é¾ï¼ä¼æä¸0x4000çæ è®°ã\n\n# iptables -L KUBE-MARK-MASQ -t nat -n\nChain KUBE-MARK-MASQ (548 references)\ntarget     prot opt source               destination       \nMARK       all  --  0.0.0.0/0            0.0.0.0/0            MARK or 0x4000\n\n\n1\n2\n3\n4\n\n\nåé¢çä¸æ¡é¾æ¯ä¸ºäºå°æµééæºçåéå°ä»»æä¸ä¸ªpodä¸­ãç¬¬äºæ¡é¾ä»£è¡¨çæ1/3çæ¦çä¼å¹éå°è¯¥é¾ï¼èç¬¬ä¸æ¡é¾ä»£è¡¨ç1/2ï¼æåä¸æ¡é¾ä»£è¡¨çç¾åç¾ã\n\nçç¬¬äºæ¡é¾ä¸­çè§åï¼ç¬¬ä¸æ¡è§åæ¯è·³è½¬å°å­é¾KUBE-MARK-MASQ ï¼æºIPä¸º192.33.206.93çæ°æ®åæä¸äº0x4000æ è®°ï¼åå°ç®çIP DNATæ192.33.206.93ï¼è¯´æå¦æèªå·±è®¿é®èªå·±ï¼ä¹ä¼è¢«æä¸æ è®°ã\n\nè¿éç192.33.206.93æ¯æ¬èº«serviceæå¹éä¸çpod IPå°åï¼å¦æè°ç¨èªå·±çserviceåä¼å¹éä¸è¯¥é¾ï¼æä¸0x4000æ è®°ã\n\nèç¬¬äºæ¡è§åæ¯ä¸ä¸ªDNATæä½ï¼ä¼å°ç®æ å°åæ¹ä¸º192.33.206.93:80ï¼ä¹å°±æ¯podçå°åã\n\n # iptables -L KUBE-SEP-FO7YK2K5DAKTCVSE -t nat\nChain KUBE-SEP-FO7YK2K5DAKTCVSE (1 references)\ntarget     prot opt source               destination   \nKUBE-MARK-MASQ  all  --  192.33.206.93        anywhere             /* zwf/demoapp-service:http */\nDNAT       tcp  --  anywhere             anywhere             /* zwf/demoapp-service:http */ tcp to:192.33.206.93:80\n\n\n1\n2\n3\n4\n5\n\n\nå©ä¸çç¬¬3ã4æ¡è§åä¹æ¯ä¸æ ·çæä½ï¼ä¼å°æµéDNATå°å¯¹åºçpodä¸­ã\n\n\n# POSTROUTING\n\nPOSTROUTINGä¸­åå«äºä¸æ¡KUBE-POSTROUTINGå­é¾ï¼å­é¾ä¹æ¯ç±kube-porxyæ¥åå¥çã\n\n# iptables -L POSTROUTING -t nat\nChain POSTROUTING (policy ACCEPT)\ntarget     prot opt source               destination       \nKUBE-POSTROUTING  all  --  anywhere             anywhere             /* kubernetes postrouting rules */\ncali-POSTROUTING  all  --  anywhere             anywhere             /* cali:O3lYWMrLQYEMJtB5 */\n\n\n1\n2\n3\n4\n5\n\n\næ¥çå­é¾KUBE-POSTROUTING åå®¹ï¼\n\n 1. ç¬¬ä¸æ¡è§åæ¯æ²¡ææ è®°ä¸º0x400çæ°æ®åä¼returnï¼ä¸æ§è¡ä¸é¢çå­é¾ãè¿è®°å¾å¨KUBE-PREROUTING ä¸­æä¸¤æ¬¡æä¸0x4000æ è®°ï¼ä»£è¡¨çè®¿é®æ¯éç¾¤å¤é¨è®¿é®è¯¥serviceæèæ¯æºåç®çä¸æ ·ï¼é½ä¼å¾ä¸èµ°ã\n 2. ç¬¬äºæ¡è§åæ¯å¯¹æ°æ®åçæ è®°å¼è¿è¡å¼æï¼èè¿éæ¯0x4000ä¸0x4000è¿è¡å¼æï¼ä¹å°±æ¯0\n 3. ç¬¬ä¸æ¡è§åæ¶å¯¹è¯¥æ°æ®åè¿è¡SNATï¼random-fullyæ¯å¯¹æºç«¯å£è¿è¡éæºè·åã\n\n# iptables -L KUBE-POSTROUTING -t nat\nChain KUBE-POSTROUTING (1 references)\ntarget     prot opt source               destination       \nRETURN     all  --  anywhere             anywhere             mark match ! 0x4000/0x4000\nMARK       all  --  anywhere             anywhere             MARK xor 0x4000\nMASQUERADE  all  --  anywhere             anywhere             /* kubernetes service traffic requiring SNAT */ random-fully\n\n\n1\n2\n3\n4\n5\n6\n\n\nè¿éæä¸¤ç§æåµä¼è¢«SNATï¼è¯´è¯´ä¸ºä»ä¹ã\n\n\n# SNAT\n\n\n# ä¸ºä»ä¹éç¾¤å¤é¨è®¿é®è¯¥serviceéè¦è¢«SNATï¼\n\næ°æ®åéè¦ååï¼å¦ææ²¡æSNATï¼é£ä¹ååçç®çIPæ¯å®¢æ·ç«¯çIPï¼èæºIPæ¯PodçIPï¼èå®¢æ·ç«¯å¹¶ä¸è®¤è¯¥æ°æ®åï¼åä¼è¢«ä¸¢å¼ã\n\nâ\n\nå¦ææåçSNATï¼é£ä¹ååçæ¶åå¯ä»¥åå°Node1çèç¹ï¼ååå°clientã\n\nâ\n\nä½é®é¢åæ¥äºï¼æ¯æä¹ä»Node1åååå°clientçå¢ï¼\n\n\n# conntrack\n\nconntrackæ¯ä¸ä¸ªè¿½è¸ªè¡¨ï¼å¨æ¯ä¸ä¸ªæ°æ®åè¿å¥å°netfilterçæ¶åï¼é½ä¼è®°å½ä¸æ¡è®°å½ï¼å½æä»¬è¿è¡SNATåDNATçæ¶åä¹é½ä¼æ´æ°è¯¥è¡¨ä¸­çè®°å½ã\n\næä»¥å¨Node1ååç»clientæ¶åï¼å¯ä»¥éè¿æ¥è¯¢è¿ä¸ªè¡¨ä¸­çè®°å½ï¼ç¶ååæ¬¡SNATåDNATæ¢å¤åå»å°±å¯ä»¥è¿è¡æ­£å¸¸çååäºã\n\n\n\nå¯ä»¥çä¸conntrackéé¢çè®°å½é¿ä»ä¹æ ·å­ã\n\nåå¨æä¸å°èç¹ä¸curl serviceçipï¼ä¸å¾çclientå¶å®ä¹æ¯å¨Node1ä¸çï¼å ä¸ºNode1ä¸æä¸¤å¼ ç½å¡ï¼Node1åNode2çéä¿¡ä½¿ç¨çç½å¡eth2 ipä¸º10.10.10.16ï¼å ä¸ºè½¬åå°å¶ä»èç¹ï¼æä»¥ä¼è¢«SNATã\n\n# curl 192.44.140.73\niKubernetes demoapp v1.0 !! ClientIP: 10.10.10.16, ServerName: demoapp-deployment-64bdcb8666-4prbk, ServerIP: 192.33.229.12!\n\n\n1\n2\n\n\nè¿éä¸»è¦æ¯çsrcådståå«æ¯clientè¯·æ±serviceçç®çIPï¼ç¶ååé¢åæä¸ä¸ªsrcådstå®æ¯ç±Node2ååç»Node1çæºåç®çIPï¼ä¹å°±æ¯æºæ¯podçIPï¼dstæ¯Node1èç¹IPã\n\nåé¢æ¯åéåçæ¹åï¼åé¢æ¯ååçæ¹åãéè¿æ¥è¯¢è¯¥è¡¨ï¼å³å¯ä»¥ä»Node1ååç»client\n\n# conntrack -L | grep 192.33.229.12\ntcp      6 107 TIME_WAIT src=10.65.196.41 dst=192.44.140.73 sport=33468 dport=80 src=192.33.229.12 dst=10.10.10.16 sport=80 dport=18623 [ASSURED] mark=0 use=1\n\n\n1\n2\n\n\nâ\n\n\n# æºåç®çIPç¸å\n\nå½podè®¿é®serviceæ¶ï¼æ­£å¥½DNATæèªå·±çIPï¼é£ä¹å°±å­å¨æºåç®çIPä¸æ ·çæåµã\n\n\n\nè¿ç§æ°æ®åæ¯å¾ç¹æ®çå­å¨ï¼ç½ç»è®¾å¤å¯è½ä¼å°è¿ç§æ°æ®åè§ä¸ºæ ææèå¼å¸¸çåè¢«ä¸¢å¼ï¼æå¥½ä¸è¦ä¸æ ·ï¼æä»¥ä¼å°æºIP SNATä¸ºä¸»æºçIPï¼è§£å³è¯¥é®é¢ã\n\nå®éª\n\n\n\nå½åèç¹çIPä¸ºï¼10.65.196.41ï¼ç¶åè¿å¥å¨å½åèç¹çPodåï¼å½åpodçipä¸ºï¼192.33.73.139\n\nkubectl exec -it -n zwf demoapp-deployment-64bdcb8666-cxmmz -- sh\n\n\n\n1\n2\n\n\nè¿è¡å¤æ¬¡curl service ipï¼å½æä¸æ¬¡è¯·æ±å°æ¬PODçIPæ¶ï¼æ¥çå¶ClientIPï¼åç°å¶æºIPæ¯ï¼10.65.196.41ï¼è¿ä¸ªå½åèç¹çIP\n\n# curl 192.44.140.73\niKubernetes demoapp v1.0 !! ClientIP: 10.65.196.41, ServerName: demoapp-deployment-64bdcb8666-cxmmz, ServerIP: 192.33.73.139!\n\n\n1\n2\n\n\n\n# NodePort\n\nä¸é¢ä»ç»çæ¯serivi type=ClusterIPæ¹å¼çï¼é£ä¹NodePortæä»ä¹åºå«å¢ï¼\n\n\n# æ­å»ºç¯å¢\n\nåå°clusterIPçserviceå äºï¼é²æ­¢å¹²æ°ã\n\nkubectl delete svc -n zwf demoapp-service\n\n\n1\n\n\nåå»ºNodePortçserviceæä»¶demo_service_nodeport.yaml\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: demoapp-nodeport-service\nspec:\n  selector:\n    app: demoapp\n  ports:\n    - name: http\n      protocol: TCP\n      port: 80\n      targetPort: 80\n  type: NodePort\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nåå»ºService\n\n# kubectl apply -n zwf -f demo_service_nodeport.yaml \n\n# kubectl get svc -n zwf\nNAME                       TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE\ndemoapp-nodeport-service   NodePort   192.44.152.223   <none>        80:30337/TCP   64s\n\n\n1\n2\n3\n4\n5\n\n\n\n# è¯·æ±clusterip\n\néè¿clusterip+ç«¯å£çæ¹å¼è¯·æ±serviceï¼åçåä¸é¢å°æ¯ä¸æ ·çã\n\nå¨POSTROUTINGåOUTPUTä¸­æ·»å äºKUBE-SERVICESé¾ï¼å¶ä¸­åå«äºæ°å¢çserviceå¯¹åºçKUBE-SVC-XXXå­é¾ï¼å½è®¿é®çæ¯å¶clusteripæ¶ï¼åå¹éä¸è¯¥é¾ãå¨å¶ä¸­åå«äºä»å¤ä¸ªpodä¸­éæºéæ©ä¸ä¸ªè¿è¡DNATæä½ï¼æä¸æ è®°ï¼å¨POSTROUTINGä¸­åSNATã\n\n# iptables -L PREROUTING -t nat\nChain PREROUTING (policy ACCEPT)\ntarget     prot opt source               destination       \nKUBE-SERVICES  all  --  anywhere             anywhere             /* kubernetes service portals */\ncali-PREROUTING  all  --  anywhere             anywhere             /* cali:6gwbT8clXdHdC1b1 */\n\n\n# iptables -L KUBE-SERVICES -t nat | grep zwf\nKUBE-SVC-YSWRJGOK5VEB6HOG  tcp  --  anywhere             192.44.152.223       /* zwf/demoapp-nodeport-service:http cluster IP */ tcp dpt:http\n\n# iptables -L KUBE-SVC-YSWRJGOK5VEB6HOG -t nat |grep zwf\nKUBE-MARK-MASQ  tcp  -- !192.33.0.0/16        192.44.152.223       /* zwf/demoapp-nodeport-service:http cluster IP */ tcp dpt:http\nKUBE-MARK-MASQ  tcp  --  anywhere             anywhere             /* zwf/demoapp-nodeport-service:http */ tcp dpt:30337\nKUBE-SEP-NMMBRSZXI4OIWDPB  all  --  anywhere             anywhere             /* zwf/demoapp-nodeport-service:http */ statistic mode random probability 0.33333333349\nKUBE-SEP-PXDORKZI3GD2RUMC  all  --  anywhere             anywhere             /* zwf/demoapp-nodeport-service:http */ statistic mode random probability 0.50000000000\nKUBE-SEP-YLPOR67MTHPHIZAB  all  --  anywhere             anywhere             /* zwf/demoapp-nodeport-service:http */\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n\n# è¯·æ±èç¹IP\n\nä½æ¯å¦æä¸æ¯éè¿ClusterIPèæ¯éè¿èç¹IPè¯·æ±serviceå¢ï¼å®æ¯æä¹åçï¼\n\nå ä¸ºæ¯èç¹IPï¼æä»¥æ æ³å¹éä¸è¯¥serviceçKUBE-SVC-XXXå­é¾ï¼ä½æ¯æä¸æ¡KUBE-NODEPORTS\n\n# iptables -L KUBE-SERVICES  -t nat | grep KUBE-NODEPORTS\nKUBE-NODEPORTS  all  --  anywhere             anywhere             /* kubernetes service nodeports; NOTE: this must be the last rule in this chain */ ADDRTYPE match dst-type LOCAL\n\n\n1\n2\n\n\nå¨å¶ä¸­åå«äºä¸æ¡å­é¾KUBE-SVC-YSWRJGOK5VEB6HOG ï¼åªè¦ç®çç«¯å£ä¸º30337å°±è½å¹éä¸ï¼èè¿ä¸ªç«¯å£æ­£å¥½å°±æ¯demoapp-nodeport-service çNodePortç«¯å£ã\n\nè¿æ¡å­é¾åä¸é¢å¹éclusterIPæ¶æ¯åä¸ä¸ªé¾ï¼é½æ¯è¿è¡ä¸ä¸ªDNATæä½ã\n\n# # iptables -L KUBE-NODEPORTS -t nat | grep zwf\nKUBE-SVC-YSWRJGOK5VEB6HOG  tcp  --  anywhere             anywhere             /* zwf/demoapp-nodeport-service:http */ tcp dpt:30337\n\n\n1\n2\n\n\nâ\n\n\n# åèé¾æ¥\n\n * netfilter é¾æ¥è·è¸ªæºå¶ä¸NATåç\n * k8s ä¹ service ip\n * è¿æ¥è·è¸ª conntrack",normalizedContent:"# kubernetes serviceå¦ä½éè¿iptablesè½¬å\n\n\n# åè¨\n\næ¬æä¸»è¦æ¯ä»ç»kubernetesçserviceæ¯å¦ä½å©ç¨iptablesæ¥è¿è¡æµéçè½¬åè¾¾å°æµéçè´è½½åè¡¡çï¼å¹¶ä¼éè¿å®è·µæä½æ¥æ´å¥½ççè§£ä¸éªè¯å¶åçã\n\n\n# ç¯å¢æ­å»º\n\næ­å»ºç¯å¢å¦ä¸å¾æç¤ºï¼\n\n\n\n 1. åå»ºä¸ä¸ªdeployï¼è®¾ç½®å¶å¯æ¬æ°ä¸º3\n\napiversion: apps/v1\nkind: deployment\nmetadata:\n  name: demoapp-deployment\n  labels:\n    app: demoapp\nspec:\n  replicas: 3\n  selector:\n    matchlabels:\n      app: demoapp\n  template:\n    metadata:\n      labels:\n        app: demoapp\n    spec:\n      containers:\n        - name: ubuntu\n          image: ikubernetes/demoapp:v1.0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n 2. åå»ºserviceï¼ä¸ºä¸é¢deploymentç3ä¸ªpodè¿è¡è´è½½åè¡¡è®¿é®\n\napiversion: v1\nkind: service\nmetadata:\n  name: demoapp-service\nspec:\n  selector:\n    app: demoapp\n  clusterip: 192.44.140.73\n  ports:\n    - name: http\n      protocol: tcp\n      port: 80\n      targetport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n 3. éªè¯\n\nåå»ºå®åï¼ç¯å¢å¦ä¸ï¼\n\n# kubectl get pods -n zwf -o wide\nname                                  ready   status    restarts   age     ip\ndemoapp-deployment-64bdcb8666-4prbk   1/1     running   0          7d17h   192.33.229.12   dmoc-fa163eee1e30\ndemoapp-deployment-64bdcb8666-cxmmz   1/1     running   0          7d17h   192.33.73.139   dmoc-fa163e7188d6\ndemoapp-deployment-64bdcb8666-kkzsg   1/1     running   0          7d17h   192.33.206.93   dmoc-fa163ee6bbe1\ndemoapp-pod                           1/1     running   0          4d17h   192.33.73.172   dmoc-fa163e7188d6\n\n# kubectl get svc -n zwf\nname                       type        cluster-ip       external-ip   port(s)        age\ndemoapp-service            clusterip   192.44.140.73    <none>        80/tcp         7s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå¯ä»¥ç´æ¥å¨ç¯å¢ä¸­è¯·æ±serviceçclusteripå°åï¼ä¼éæºè®¿é®å°ä¸ä¸ªpodï¼è¾åºçä¿¡æ¯åå«äºè¯·æ±ipåç®çipã\n\n# curl 192.44.140.73\nikubernetes demoapp v1.0 !! clientip: 10.10.10.16, servername: demoapp-deployment-64bdcb8666-kkzsg, serverip: 192.33.206.93!\n\n# curl 192.44.140.73\nikubernetes demoapp v1.0 !! clientip: 10.65.196.41, servername: demoapp-deployment-64bdcb8666-cxmmz, serverip: 192.33.73.139!\n\n# curl 192.44.140.73\nikubernetes demoapp v1.0 !! clientip: 10.10.10.16, servername: demoapp-deployment-64bdcb8666-4prbk, serverip: 192.33.229.12!\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# kube-services\n\nå¨prerouting åoutput é¾çnatè¡¨ä¸­ï¼é½åå«äºkube-services å­é¾ï¼è¯¥å­é¾ä¸­å°±åå«äºserivceçiptablesè§åçéç½®ã\n\n# iptables -l prerouting -t nat\nchain prerouting (policy accept)\ntarget     prot opt source               destination       \nkube-services  all  --  anywhere             anywhere             /* kubernetes service portals */\ncali-prerouting  all  --  anywhere             anywhere             /* cali:6gwbt8clxdhdc1b1 */\n\n# iptables -l output -t nat\nchain output (policy accept)\ntarget     prot opt source               destination       \nkube-services  all  --  anywhere             anywhere             /* kubernetes service portals */\ncali-output  all  --  anywhere             anywhere             /* cali:tvnhkvao15huipy0 */\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nä¸ºä»ä¹å¨preroutingåoutputé¾ä¸­æ·»å serviceè§åï¼\n\nserviceçä½ç¨æ¯è´è½½åè¡¡ï¼ä¹å°±æ¯éè¦å°ipåè¿è¡dnatæä½ï¼èè¿ä¸ªæä½éè¦å¨æé è¿åéçä½ç½®ãç½å¡æ¶å°çåè¿å¥å°ç½ç»åè®®æ æ¶ï¼æåè¿å¥çå°±æ¯preroutingé¾ï¼ä¹å°±æ¯èç¹å¤é¨çæµéè¿å¥çå¥å£ãoutputæ¯æ¬å°è¿ç¨ååºçåæåè¿å¥çé¾ãæä»¥éè¦å¨è¿ä¸¤æ¡é¾ä¸­æ·»å kube-servicesï¼è¯¦æå¯åèå¿«éäºè§£iptables\n\nä¸ºä»ä¹natè¡¨ï¼\n\nå ä¸ºè¦ådnatæä½ï¼æä»¥å¨natè¡¨ã\n\nkube-servicesä¸é¢æè®¸å¤kube-svc-xxxçå­é¾ï¼æ¯ä¸æ¡å­é¾é½æ¯ä¸ä¸ªéç¾¤ä¸­ä¸ä¸ªserviceçéç½®ï¼ç­éä¸ä¸\n\néè¿ç­édemoapp-service å¾å°ä¸é¢çå­é¾ï¼åªæè®¿é®ç®çå°åä¸º192.44.140.73æè½è¿å¥å°è¯¥å­é¾ä¸­ã\n\n# iptables -l kube-services -t nat | grep demoapp-service\nkube-svc-fihihdnrzeg5vqeq  tcp  --  anywhere             192.44.140.73        /* zwf/demoapp-service:http cluster ip */ tcp dpt:http\n\n\n1\n2\n\n\næ¥çube-svc-fihihdnrzeg5vqeq é¾ä¸­åå®¹ï¼å¶ä¸­åå«äºåæ¡å­é¾ã\n\n# iptables -l kube-svc-fihihdnrzeg5vqeq -t nat -n\nchain kube-svc-fihihdnrzeg5vqeq (1 references)\ntarget     prot opt source               destination       \nkube-mark-masq  tcp  -- !192.33.0.0/16        192.44.140.73        /* zwf/demoapp-service:http cluster ip */ tcp dpt:80\nkube-sep-fo7yk2k5daktcvse  all  --  0.0.0.0/0            0.0.0.0/0            /* zwf/demoapp-service:http */ statistic mode random probability 0.33333333349\nkube-sep-ipkl7nsntvgki4t5  all  --  0.0.0.0/0            0.0.0.0/0            /* zwf/demoapp-service:http */ statistic mode random probability 0.50000000000\nkube-sep-bper562isf3ufyoq  all  --  0.0.0.0/0            0.0.0.0/0            /* zwf/demoapp-service:http */\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nç¬¬ä¸æ¡é¾æ¯ï¼æºipä¸å¨192.33.0.0/16æ®µãç®çipä¸º192.44.140.73å¹¶ä¸ç®çç«¯å£æ¯80çæ°æ®åä¼å¹éå°è¯¥æ¡å­é¾è¿è¡è·³è½¬ãå¶ä¸­192.33.0.0/16æ¯podçç½æ®µï¼å¦æä¸æ¯éç¾¤åçæµéï¼åä¼å¹éä¸è¯¥æ¡å­é¾ï¼ä¼æä¸0x4000çæ è®°ã\n\n# iptables -l kube-mark-masq -t nat -n\nchain kube-mark-masq (548 references)\ntarget     prot opt source               destination       \nmark       all  --  0.0.0.0/0            0.0.0.0/0            mark or 0x4000\n\n\n1\n2\n3\n4\n\n\nåé¢çä¸æ¡é¾æ¯ä¸ºäºå°æµééæºçåéå°ä»»æä¸ä¸ªpodä¸­ãç¬¬äºæ¡é¾ä»£è¡¨çæ1/3çæ¦çä¼å¹éå°è¯¥é¾ï¼èç¬¬ä¸æ¡é¾ä»£è¡¨ç1/2ï¼æåä¸æ¡é¾ä»£è¡¨çç¾åç¾ã\n\nçç¬¬äºæ¡é¾ä¸­çè§åï¼ç¬¬ä¸æ¡è§åæ¯è·³è½¬å°å­é¾kube-mark-masq ï¼æºipä¸º192.33.206.93çæ°æ®åæä¸äº0x4000æ è®°ï¼åå°ç®çip dnatæ192.33.206.93ï¼è¯´æå¦æèªå·±è®¿é®èªå·±ï¼ä¹ä¼è¢«æä¸æ è®°ã\n\nè¿éç192.33.206.93æ¯æ¬èº«serviceæå¹éä¸çpod ipå°åï¼å¦æè°ç¨èªå·±çserviceåä¼å¹éä¸è¯¥é¾ï¼æä¸0x4000æ è®°ã\n\nèç¬¬äºæ¡è§åæ¯ä¸ä¸ªdnatæä½ï¼ä¼å°ç®æ å°åæ¹ä¸º192.33.206.93:80ï¼ä¹å°±æ¯podçå°åã\n\n # iptables -l kube-sep-fo7yk2k5daktcvse -t nat\nchain kube-sep-fo7yk2k5daktcvse (1 references)\ntarget     prot opt source               destination   \nkube-mark-masq  all  --  192.33.206.93        anywhere             /* zwf/demoapp-service:http */\ndnat       tcp  --  anywhere             anywhere             /* zwf/demoapp-service:http */ tcp to:192.33.206.93:80\n\n\n1\n2\n3\n4\n5\n\n\nå©ä¸çç¬¬3ã4æ¡è§åä¹æ¯ä¸æ ·çæä½ï¼ä¼å°æµédnatå°å¯¹åºçpodä¸­ã\n\n\n# postrouting\n\npostroutingä¸­åå«äºä¸æ¡kube-postroutingå­é¾ï¼å­é¾ä¹æ¯ç±kube-porxyæ¥åå¥çã\n\n# iptables -l postrouting -t nat\nchain postrouting (policy accept)\ntarget     prot opt source               destination       \nkube-postrouting  all  --  anywhere             anywhere             /* kubernetes postrouting rules */\ncali-postrouting  all  --  anywhere             anywhere             /* cali:o3lywmrlqyemjtb5 */\n\n\n1\n2\n3\n4\n5\n\n\næ¥çå­é¾kube-postrouting åå®¹ï¼\n\n 1. ç¬¬ä¸æ¡è§åæ¯æ²¡ææ è®°ä¸º0x400çæ°æ®åä¼returnï¼ä¸æ§è¡ä¸é¢çå­é¾ãè¿è®°å¾å¨kube-prerouting ä¸­æä¸¤æ¬¡æä¸0x4000æ è®°ï¼ä»£è¡¨çè®¿é®æ¯éç¾¤å¤é¨è®¿é®è¯¥serviceæèæ¯æºåç®çä¸æ ·ï¼é½ä¼å¾ä¸èµ°ã\n 2. ç¬¬äºæ¡è§åæ¯å¯¹æ°æ®åçæ è®°å¼è¿è¡å¼æï¼èè¿éæ¯0x4000ä¸0x4000è¿è¡å¼æï¼ä¹å°±æ¯0\n 3. ç¬¬ä¸æ¡è§åæ¶å¯¹è¯¥æ°æ®åè¿è¡snatï¼random-fullyæ¯å¯¹æºç«¯å£è¿è¡éæºè·åã\n\n# iptables -l kube-postrouting -t nat\nchain kube-postrouting (1 references)\ntarget     prot opt source               destination       \nreturn     all  --  anywhere             anywhere             mark match ! 0x4000/0x4000\nmark       all  --  anywhere             anywhere             mark xor 0x4000\nmasquerade  all  --  anywhere             anywhere             /* kubernetes service traffic requiring snat */ random-fully\n\n\n1\n2\n3\n4\n5\n6\n\n\nè¿éæä¸¤ç§æåµä¼è¢«snatï¼è¯´è¯´ä¸ºä»ä¹ã\n\n\n# snat\n\n\n# ä¸ºä»ä¹éç¾¤å¤é¨è®¿é®è¯¥serviceéè¦è¢«snatï¼\n\næ°æ®åéè¦ååï¼å¦ææ²¡æsnatï¼é£ä¹ååçç®çipæ¯å®¢æ·ç«¯çipï¼èæºipæ¯podçipï¼èå®¢æ·ç«¯å¹¶ä¸è®¤è¯¥æ°æ®åï¼åä¼è¢«ä¸¢å¼ã\n\nâ\n\nå¦ææåçsnatï¼é£ä¹ååçæ¶åå¯ä»¥åå°node1çèç¹ï¼ååå°clientã\n\nâ\n\nä½é®é¢åæ¥äºï¼æ¯æä¹ä»node1åååå°clientçå¢ï¼\n\n\n# conntrack\n\nconntrackæ¯ä¸ä¸ªè¿½è¸ªè¡¨ï¼å¨æ¯ä¸ä¸ªæ°æ®åè¿å¥å°netfilterçæ¶åï¼é½ä¼è®°å½ä¸æ¡è®°å½ï¼å½æä»¬è¿è¡snatådnatçæ¶åä¹é½ä¼æ´æ°è¯¥è¡¨ä¸­çè®°å½ã\n\næä»¥å¨node1ååç»clientæ¶åï¼å¯ä»¥éè¿æ¥è¯¢è¿ä¸ªè¡¨ä¸­çè®°å½ï¼ç¶ååæ¬¡snatådnatæ¢å¤åå»å°±å¯ä»¥è¿è¡æ­£å¸¸çååäºã\n\n\n\nå¯ä»¥çä¸conntrackéé¢çè®°å½é¿ä»ä¹æ ·å­ã\n\nåå¨æä¸å°èç¹ä¸curl serviceçipï¼ä¸å¾çclientå¶å®ä¹æ¯å¨node1ä¸çï¼å ä¸ºnode1ä¸æä¸¤å¼ ç½å¡ï¼node1ånode2çéä¿¡ä½¿ç¨çç½å¡eth2 ipä¸º10.10.10.16ï¼å ä¸ºè½¬åå°å¶ä»èç¹ï¼æä»¥ä¼è¢«snatã\n\n# curl 192.44.140.73\nikubernetes demoapp v1.0 !! clientip: 10.10.10.16, servername: demoapp-deployment-64bdcb8666-4prbk, serverip: 192.33.229.12!\n\n\n1\n2\n\n\nè¿éä¸»è¦æ¯çsrcådståå«æ¯clientè¯·æ±serviceçç®çipï¼ç¶ååé¢åæä¸ä¸ªsrcådstå®æ¯ç±node2ååç»node1çæºåç®çipï¼ä¹å°±æ¯æºæ¯podçipï¼dstæ¯node1èç¹ipã\n\nåé¢æ¯åéåçæ¹åï¼åé¢æ¯ååçæ¹åãéè¿æ¥è¯¢è¯¥è¡¨ï¼å³å¯ä»¥ä»node1ååç»client\n\n# conntrack -l | grep 192.33.229.12\ntcp      6 107 time_wait src=10.65.196.41 dst=192.44.140.73 sport=33468 dport=80 src=192.33.229.12 dst=10.10.10.16 sport=80 dport=18623 [assured] mark=0 use=1\n\n\n1\n2\n\n\nâ\n\n\n# æºåç®çipç¸å\n\nå½podè®¿é®serviceæ¶ï¼æ­£å¥½dnatæèªå·±çipï¼é£ä¹å°±å­å¨æºåç®çipä¸æ ·çæåµã\n\n\n\nè¿ç§æ°æ®åæ¯å¾ç¹æ®çå­å¨ï¼ç½ç»è®¾å¤å¯è½ä¼å°è¿ç§æ°æ®åè§ä¸ºæ ææèå¼å¸¸çåè¢«ä¸¢å¼ï¼æå¥½ä¸è¦ä¸æ ·ï¼æä»¥ä¼å°æºip snatä¸ºä¸»æºçipï¼è§£å³è¯¥é®é¢ã\n\nå®éª\n\n\n\nå½åèç¹çipä¸ºï¼10.65.196.41ï¼ç¶åè¿å¥å¨å½åèç¹çpodåï¼å½åpodçipä¸ºï¼192.33.73.139\n\nkubectl exec -it -n zwf demoapp-deployment-64bdcb8666-cxmmz -- sh\n\n\n\n1\n2\n\n\nè¿è¡å¤æ¬¡curl service ipï¼å½æä¸æ¬¡è¯·æ±å°æ¬podçipæ¶ï¼æ¥çå¶clientipï¼åç°å¶æºipæ¯ï¼10.65.196.41ï¼è¿ä¸ªå½åèç¹çip\n\n# curl 192.44.140.73\nikubernetes demoapp v1.0 !! clientip: 10.65.196.41, servername: demoapp-deployment-64bdcb8666-cxmmz, serverip: 192.33.73.139!\n\n\n1\n2\n\n\n\n# nodeport\n\nä¸é¢ä»ç»çæ¯serivi type=clusteripæ¹å¼çï¼é£ä¹nodeportæä»ä¹åºå«å¢ï¼\n\n\n# æ­å»ºç¯å¢\n\nåå°clusteripçserviceå äºï¼é²æ­¢å¹²æ°ã\n\nkubectl delete svc -n zwf demoapp-service\n\n\n1\n\n\nåå»ºnodeportçserviceæä»¶demo_service_nodeport.yaml\n\napiversion: v1\nkind: service\nmetadata:\n  name: demoapp-nodeport-service\nspec:\n  selector:\n    app: demoapp\n  ports:\n    - name: http\n      protocol: tcp\n      port: 80\n      targetport: 80\n  type: nodeport\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nåå»ºservice\n\n# kubectl apply -n zwf -f demo_service_nodeport.yaml \n\n# kubectl get svc -n zwf\nname                       type       cluster-ip       external-ip   port(s)        age\ndemoapp-nodeport-service   nodeport   192.44.152.223   <none>        80:30337/tcp   64s\n\n\n1\n2\n3\n4\n5\n\n\n\n# è¯·æ±clusterip\n\néè¿clusterip+ç«¯å£çæ¹å¼è¯·æ±serviceï¼åçåä¸é¢å°æ¯ä¸æ ·çã\n\nå¨postroutingåoutputä¸­æ·»å äºkube-servicesé¾ï¼å¶ä¸­åå«äºæ°å¢çserviceå¯¹åºçkube-svc-xxxå­é¾ï¼å½è®¿é®çæ¯å¶clusteripæ¶ï¼åå¹éä¸è¯¥é¾ãå¨å¶ä¸­åå«äºä»å¤ä¸ªpodä¸­éæºéæ©ä¸ä¸ªè¿è¡dnatæä½ï¼æä¸æ è®°ï¼å¨postroutingä¸­åsnatã\n\n# iptables -l prerouting -t nat\nchain prerouting (policy accept)\ntarget     prot opt source               destination       \nkube-services  all  --  anywhere             anywhere             /* kubernetes service portals */\ncali-prerouting  all  --  anywhere             anywhere             /* cali:6gwbt8clxdhdc1b1 */\n\n\n# iptables -l kube-services -t nat | grep zwf\nkube-svc-yswrjgok5veb6hog  tcp  --  anywhere             192.44.152.223       /* zwf/demoapp-nodeport-service:http cluster ip */ tcp dpt:http\n\n# iptables -l kube-svc-yswrjgok5veb6hog -t nat |grep zwf\nkube-mark-masq  tcp  -- !192.33.0.0/16        192.44.152.223       /* zwf/demoapp-nodeport-service:http cluster ip */ tcp dpt:http\nkube-mark-masq  tcp  --  anywhere             anywhere             /* zwf/demoapp-nodeport-service:http */ tcp dpt:30337\nkube-sep-nmmbrszxi4oiwdpb  all  --  anywhere             anywhere             /* zwf/demoapp-nodeport-service:http */ statistic mode random probability 0.33333333349\nkube-sep-pxdorkzi3gd2rumc  all  --  anywhere             anywhere             /* zwf/demoapp-nodeport-service:http */ statistic mode random probability 0.50000000000\nkube-sep-ylpor67mthphizab  all  --  anywhere             anywhere             /* zwf/demoapp-nodeport-service:http */\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n\n# è¯·æ±èç¹ip\n\nä½æ¯å¦æä¸æ¯éè¿clusteripèæ¯éè¿èç¹ipè¯·æ±serviceå¢ï¼å®æ¯æä¹åçï¼\n\nå ä¸ºæ¯èç¹ipï¼æä»¥æ æ³å¹éä¸è¯¥serviceçkube-svc-xxxå­é¾ï¼ä½æ¯æä¸æ¡kube-nodeports\n\n# iptables -l kube-services  -t nat | grep kube-nodeports\nkube-nodeports  all  --  anywhere             anywhere             /* kubernetes service nodeports; note: this must be the last rule in this chain */ addrtype match dst-type local\n\n\n1\n2\n\n\nå¨å¶ä¸­åå«äºä¸æ¡å­é¾kube-svc-yswrjgok5veb6hog ï¼åªè¦ç®çç«¯å£ä¸º30337å°±è½å¹éä¸ï¼èè¿ä¸ªç«¯å£æ­£å¥½å°±æ¯demoapp-nodeport-service çnodeportç«¯å£ã\n\nè¿æ¡å­é¾åä¸é¢å¹éclusteripæ¶æ¯åä¸ä¸ªé¾ï¼é½æ¯è¿è¡ä¸ä¸ªdnatæä½ã\n\n# # iptables -l kube-nodeports -t nat | grep zwf\nkube-svc-yswrjgok5veb6hog  tcp  --  anywhere             anywhere             /* zwf/demoapp-nodeport-service:http */ tcp dpt:30337\n\n\n1\n2\n\n\nâ\n\n\n# åèé¾æ¥\n\n * netfilter é¾æ¥è·è¸ªæºå¶ä¸natåç\n * k8s ä¹ service ip\n * è¿æ¥è·è¸ª conntrack",charsets:{cjk:!0},lastUpdated:"2024/01/18, 19:21:39",lastUpdatedTimestamp:1705576899e3},{title:"kafkaä¸­listeneråadvertised.listenersçä½ç¨",frontmatter:{title:"kafkaä¸­listeneråadvertised.listenersçä½ç¨",date:"2023-05-01T17:41:02.000Z",permalink:"/pages/fa114f/",categories:["ä¸­é´ä»¶","kafka"],tags:["kafka","ä¸­é´ä»¶"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"å¦ä¸éç½®ï¼",comment:!0,feed:{enable:!0},meta:[{name:"twitter:title",content:"kafkaä¸­listeneråadvertised.listenersçä½ç¨"},{name:"twitter:description",content:"å¦ä¸éç½®ï¼"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/01.kafka/01.listener%E5%92%8Cadvertised.listeners%E7%9A%84%E4%BD%9C%E7%94%A8.html"},{property:"og:type",content:"article"},{property:"og:title",content:"kafkaä¸­listeneråadvertised.listenersçä½ç¨"},{property:"og:description",content:"å¦ä¸éç½®ï¼"},{property:"og:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/01.kafka/01.listener%E5%92%8Cadvertised.listeners%E7%9A%84%E4%BD%9C%E7%94%A8.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-05-01T17:41:02.000Z"},{property:"article:tag",content:"kafka"},{property:"article:tag",content:"ä¸­é´ä»¶"},{itemprop:"name",content:"kafkaä¸­listeneråadvertised.listenersçä½ç¨"},{itemprop:"description",content:"å¦ä¸éç½®ï¼"}],readingShow:"top"},regularPath:"/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/01.kafka/01.listener%E5%92%8Cadvertised.listeners%E7%9A%84%E4%BD%9C%E7%94%A8.html",relativePath:"03.ä¸­é´ä»¶/01.kafka/01.listeneråadvertised.listenersçä½ç¨.md",key:"v-67c4fe98",path:"/pages/fa114f/",headers:[{level:2,title:"listener",slug:"listener",normalizedTitle:"listener",charIndex:2},{level:2,title:"advertised.listeners",slug:"advertised-listeners",normalizedTitle:"advertised.listeners",charIndex:630},{level:2,title:"åå¤ç½åæµ",slug:"åå¤ç½åæµ",normalizedTitle:"åå¤ç½åæµ",charIndex:1647},{level:2,title:"åèé¾æ¥",slug:"åèé¾æ¥",normalizedTitle:"åèé¾æ¥",charIndex:2246}],headersStr:"listener advertised.listeners åå¤ç½åæµ åèé¾æ¥",content:'# listener\n\nlisteneréç½®æ¯ç¨æ¥ç»å®BrokerIP+ç«¯å£å°å çï¼ä¹å°±æ¯åªæéè¿ç»å®çå°åæè½å¤è®¿é®å°è¯¥Brokerãé¤äºç»å®å°åä¹å¤ï¼è¿å¯ä»¥éç½®è¯¥çå¬å°åçè®¤è¯åè®®ï¼ä¹å°±æ¯ä½¿ç¨è¯¥å°åè¿æ¥Brokeræ¶éè¦æå®ä½¿ç¨ä½ç§åè®®æ¹å¼è¿è¡è¿æ¥ã\n\nå¦ä¸éç½®ï¼\n\nlisteners: INTERNAL://172.17.0.10:9092,EXTERNAL://172.17.0.10:9094\nkafka_listener_security_protocol_map: "INTERNAL:SASL_PLAINTEXT,EXTERNAL:SASL_PLAINTEXT"\n\n\n1\n2\n\n\nè¿æ¥è¯¥Brokerçå®¢æ·ç«¯åªè½éè¿172.17.0.10:9092 å172.17.0.10:9094 è¿ä¸¤ä¸ªå°åè®¿é®kafkaï¼å¹¶ç»åä¸ä¸ªå°åè®¾ç½®listeneråç§°ä¸ºINTERNAL ï¼åä¸ä¸ªä¸ºEXTERNAL\n\nå¨kafka_listener_security_protocol_map éç½®ä¸­è®¾ç½®listeneræä½¿ç¨çéä¿¡åè®®ï¼INTERNALè®¾ç½®çæ¯SASL_PLAINTEXT ï¼è¿ä¹æ¯å¸¸è§çç¨æ·ååå¯ç è®¤è¯åè®®ï¼EXTERNAL è®¾ç½®ä¹æ¯è¯¥åè®®ã\n\næç»ï¼kafka å®¢æ·ç«¯è¿æ¥è¯¥kafka brokerï¼éè¦éè¿172.17.0.10:9092 æ172.17.0.10:9094 å°åè¿è¡è¿æ¥ï¼å¹¶ä¸é½éè¦ä½¿ç¨ç¨æ·ååå¯ç è¿è¡è®¤è¯ã\n\n\n# advertised.listeners\n\nè¯¥éç½®æå®Kafka Brokerå¯¹å¤å¬å¼çç½ç»IPåç«¯å£ï¼ç¨äºåç¥å®¢æ·ç«¯å¦ä½è¿æ¥å°Kafka Brokerãå¬å¼çæ¹å¼æ¯éè¿å­å¨å¨zookeeperä¸­è¿è¡å±äº«æ°æ®çã\n\nå¦ä¸éç½®ï¼\n\nlisteners: INTERNAL://172.17.0.10:9092,EXTERNAL://172.17.0.10:9094\nadvertised_listeners: INTERNAL://172.17.0.10:9092,EXTERNAL://å¬ç½IP:ç«¯å£\nkafka_listener_security_protocol_map: "INTERNAL:SASL_PLAINTEXT,EXTERNAL:SASL_PLAINTEXT"\n\n\n1\n2\n3\n\n\nlisteners åkafka_listener_security_protocol_map çéç½®åä¸é¢è®²çä¸æ ·ï¼èadvertised_listeners çéç½®ålisteners éç½®å«ä¹åºæ¬ä¸è´ï¼ä½æ¯å®ä¼ä¿å­å¨zookeeperä¸­/brokers/ids/0 çendpointséã\n\n...\n"endpoints":["INTERNAL://172.17.0.10:9092","EXTERNAL://172.17.0.10:9094"]\n...\n\n\n1\n2\n3\n\n\nkafkaå®¢æ·ç«¯è¿æ¥kafka brokeræ¶ï¼ä¼åè·åææbrokersçåæ°æ®ä¿¡æ¯ï¼è·åå°endpointsçä¿¡æ¯ï¼ç¶ååéè¿å¶ä¸­çendpintè¿è¡å¯¹brokerè¿è¡è¿æ¥æä½ã\n\né®é¢æ¥äºï¼æé½ç¥éäºkafka brokerçIPå°å+ç«¯å£äºï¼ä¸ºä»ä¹è¿éè¦advertised.listeners?\n\nå¨éè¦ä»£çæè½è¿æ¥kafka brokeræ¶ï¼å¨è¿ç§åºæ¯æ¶ï¼éè¦å°advertised.listeners è®¾ç½®ä¸ºä»£ççå°åã\n\nå¨å¬æäºåºæ¯ä¸é¨ç½²kafkaéç¾¤ï¼å¬ç½IPä¸æ¯å¨æ¬èç¹ç½å¡ä¸çï¼æä»¥æ æ³éè¿listenerè¿è¡ç»å®ï¼æä»¥åªè½éè¿0.0.0.0è¿è¡ç»å®ãä½æ¯å¨éç¾¤å¤é¨æ¶ï¼kafkaå®¢æ·ç«¯è¿è¡è¿æ¥ï¼å®æ¯éè¦æè½åè®¿é®kafkaçæ¯ä¸ä¸ªbrokerèç¹çï¼æä»¥éè¦å¨advertised.listenersä¸­éç½®å¬ç½IPï¼å¹¶å­å¨å¨zookeeperä¸­ï¼è¿æ ·kafkaå®¢æ·ç«¯å°±è½æ¿å°ææbrokerèç¹çå¬ç½IPå¹¶è¿è¡è®¿é®ã\n\n\n# åå¤ç½åæµ\n\nå¨å¬æäºåºæ¯ä¸ï¼æä»¬å¸æå¨éç¾¤åé¨å®¢æ·ç«¯è®¿é®æ¶ä¸éè¦è®¤è¯ï¼èå¤é¨å®¢æ·ç«¯è®¿é®æ¶éè¦èµ°è®¤è¯å å¯è®¿é®ãéç½®å¦ä¸ï¼\n\nlisteners: INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9094\nadvertised_listeners: INTERNAL://åç½IP:9092,EXTERNAL://å¬ç½IP:9094\nkafka_listener_security_protocol_map: "INTERNAL:PLAINTEXT,EXTERNAL:SASL_PLAINTEXT"\n\n\n1\n2\n3\n\n\nlistenersé½è®¾ç½®æå¯¹0.0.0.0è¿è¡çå¬ä¹å°±æ¯çå¬ææçç½å¡ï¼ä½å®ä»¬çç«¯å£ä¸åï¼9092ç«¯å£ä½¿ç¨PLAINTEXTåè®®ï¼è9094ç«¯å£èµ°çæ¯SASL_PLAINTEXTåè®®\n\nadvertised_listenersï¼åç½IPä½¿ç¨PLAINTEXTåè®®ï¼å¬ç½IPä½¿ç¨SASL_PLAINTEXTåè®®ã\n\nå½åç½å®¢æ·ç«¯è®¿é®æ¶ï¼ä¼åè·åå°ææbrokersçadvertised_listenersä¿¡æ¯ï¼ç¶åéè¿PLAINTEXTåè®®èµ°åç½IPè®¿é®kafkaéç¾¤ã\n\nå½å¬ç½å®¢æ·ç«¯è®¿é®æ¶ï¼ä¼åè·åå°ææbrokersçadvertised_listenersä¿¡æ¯ï¼ç¶åéè¿SASL_PLAINTEXTèµ°å¬ç½IPè¿è¡è®¿é®ã\n\nâ\n\n\n# åèé¾æ¥\n\n * https://www.finclip.com/news/f/30226.html\n * https://juejin.cn/post/6893410969611927566',normalizedContent:'# listener\n\nlisteneréç½®æ¯ç¨æ¥ç»å®brokerip+ç«¯å£å°å çï¼ä¹å°±æ¯åªæéè¿ç»å®çå°åæè½å¤è®¿é®å°è¯¥brokerãé¤äºç»å®å°åä¹å¤ï¼è¿å¯ä»¥éç½®è¯¥çå¬å°åçè®¤è¯åè®®ï¼ä¹å°±æ¯ä½¿ç¨è¯¥å°åè¿æ¥brokeræ¶éè¦æå®ä½¿ç¨ä½ç§åè®®æ¹å¼è¿è¡è¿æ¥ã\n\nå¦ä¸éç½®ï¼\n\nlisteners: internal://172.17.0.10:9092,external://172.17.0.10:9094\nkafka_listener_security_protocol_map: "internal:sasl_plaintext,external:sasl_plaintext"\n\n\n1\n2\n\n\nè¿æ¥è¯¥brokerçå®¢æ·ç«¯åªè½éè¿172.17.0.10:9092 å172.17.0.10:9094 è¿ä¸¤ä¸ªå°åè®¿é®kafkaï¼å¹¶ç»åä¸ä¸ªå°åè®¾ç½®listeneråç§°ä¸ºinternal ï¼åä¸ä¸ªä¸ºexternal\n\nå¨kafka_listener_security_protocol_map éç½®ä¸­è®¾ç½®listeneræä½¿ç¨çéä¿¡åè®®ï¼internalè®¾ç½®çæ¯sasl_plaintext ï¼è¿ä¹æ¯å¸¸è§çç¨æ·ååå¯ç è®¤è¯åè®®ï¼external è®¾ç½®ä¹æ¯è¯¥åè®®ã\n\næç»ï¼kafka å®¢æ·ç«¯è¿æ¥è¯¥kafka brokerï¼éè¦éè¿172.17.0.10:9092 æ172.17.0.10:9094 å°åè¿è¡è¿æ¥ï¼å¹¶ä¸é½éè¦ä½¿ç¨ç¨æ·ååå¯ç è¿è¡è®¤è¯ã\n\n\n# advertised.listeners\n\nè¯¥éç½®æå®kafka brokerå¯¹å¤å¬å¼çç½ç»ipåç«¯å£ï¼ç¨äºåç¥å®¢æ·ç«¯å¦ä½è¿æ¥å°kafka brokerãå¬å¼çæ¹å¼æ¯éè¿å­å¨å¨zookeeperä¸­è¿è¡å±äº«æ°æ®çã\n\nå¦ä¸éç½®ï¼\n\nlisteners: internal://172.17.0.10:9092,external://172.17.0.10:9094\nadvertised_listeners: internal://172.17.0.10:9092,external://å¬ç½ip:ç«¯å£\nkafka_listener_security_protocol_map: "internal:sasl_plaintext,external:sasl_plaintext"\n\n\n1\n2\n3\n\n\nlisteners åkafka_listener_security_protocol_map çéç½®åä¸é¢è®²çä¸æ ·ï¼èadvertised_listeners çéç½®ålisteners éç½®å«ä¹åºæ¬ä¸è´ï¼ä½æ¯å®ä¼ä¿å­å¨zookeeperä¸­/brokers/ids/0 çendpointséã\n\n...\n"endpoints":["internal://172.17.0.10:9092","external://172.17.0.10:9094"]\n...\n\n\n1\n2\n3\n\n\nkafkaå®¢æ·ç«¯è¿æ¥kafka brokeræ¶ï¼ä¼åè·åææbrokersçåæ°æ®ä¿¡æ¯ï¼è·åå°endpointsçä¿¡æ¯ï¼ç¶ååéè¿å¶ä¸­çendpintè¿è¡å¯¹brokerè¿è¡è¿æ¥æä½ã\n\né®é¢æ¥äºï¼æé½ç¥éäºkafka brokerçipå°å+ç«¯å£äºï¼ä¸ºä»ä¹è¿éè¦advertised.listeners?\n\nå¨éè¦ä»£çæè½è¿æ¥kafka brokeræ¶ï¼å¨è¿ç§åºæ¯æ¶ï¼éè¦å°advertised.listeners è®¾ç½®ä¸ºä»£ççå°åã\n\nå¨å¬æäºåºæ¯ä¸é¨ç½²kafkaéç¾¤ï¼å¬ç½ipä¸æ¯å¨æ¬èç¹ç½å¡ä¸çï¼æä»¥æ æ³éè¿listenerè¿è¡ç»å®ï¼æä»¥åªè½éè¿0.0.0.0è¿è¡ç»å®ãä½æ¯å¨éç¾¤å¤é¨æ¶ï¼kafkaå®¢æ·ç«¯è¿è¡è¿æ¥ï¼å®æ¯éè¦æè½åè®¿é®kafkaçæ¯ä¸ä¸ªbrokerèç¹çï¼æä»¥éè¦å¨advertised.listenersä¸­éç½®å¬ç½ipï¼å¹¶å­å¨å¨zookeeperä¸­ï¼è¿æ ·kafkaå®¢æ·ç«¯å°±è½æ¿å°ææbrokerèç¹çå¬ç½ipå¹¶è¿è¡è®¿é®ã\n\n\n# åå¤ç½åæµ\n\nå¨å¬æäºåºæ¯ä¸ï¼æä»¬å¸æå¨éç¾¤åé¨å®¢æ·ç«¯è®¿é®æ¶ä¸éè¦è®¤è¯ï¼èå¤é¨å®¢æ·ç«¯è®¿é®æ¶éè¦èµ°è®¤è¯å å¯è®¿é®ãéç½®å¦ä¸ï¼\n\nlisteners: internal://0.0.0.0:9092,external://0.0.0.0:9094\nadvertised_listeners: internal://åç½ip:9092,external://å¬ç½ip:9094\nkafka_listener_security_protocol_map: "internal:plaintext,external:sasl_plaintext"\n\n\n1\n2\n3\n\n\nlistenersé½è®¾ç½®æå¯¹0.0.0.0è¿è¡çå¬ä¹å°±æ¯çå¬ææçç½å¡ï¼ä½å®ä»¬çç«¯å£ä¸åï¼9092ç«¯å£ä½¿ç¨plaintextåè®®ï¼è9094ç«¯å£èµ°çæ¯sasl_plaintextåè®®\n\nadvertised_listenersï¼åç½ipä½¿ç¨plaintextåè®®ï¼å¬ç½ipä½¿ç¨sasl_plaintextåè®®ã\n\nå½åç½å®¢æ·ç«¯è®¿é®æ¶ï¼ä¼åè·åå°ææbrokersçadvertised_listenersä¿¡æ¯ï¼ç¶åéè¿plaintextåè®®èµ°åç½ipè®¿é®kafkaéç¾¤ã\n\nå½å¬ç½å®¢æ·ç«¯è®¿é®æ¶ï¼ä¼åè·åå°ææbrokersçadvertised_listenersä¿¡æ¯ï¼ç¶åéè¿sasl_plaintextèµ°å¬ç½ipè¿è¡è®¿é®ã\n\nâ\n\n\n# åèé¾æ¥\n\n * https://www.finclip.com/news/f/30226.html\n * https://juejin.cn/post/6893410969611927566',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"mysqlä¹æ¥å¿",frontmatter:{title:"mysqlä¹æ¥å¿",date:"2023-01-01T20:23:07.000Z",permalink:"/pages/2d69c7/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä¸æ¡æ°æ®å¨æ´æ°è¿ç¨å½ä¸­ï¼å¦æä¸­é mysql crash äºï¼mysql æ¯å¦ä½ä¿è¯æ°æ®çä¸è´æ§åæä¹æ§çï¼å¨è¿ä¸ªè¿ç¨ä¸­ mysql çæ¥å¿ç³»ç»èµ·å°äºè³å³éè¦çä½ç¨ãæ¬æå°ä¼ä»ç» mysql ä¸­ç undo logãredo log å bin log å¨è¿å¶ä¸­çä½ç¨ã",feed:{enable:!0},tags:["mysql","æ°æ®åº"],categories:["æ°æ®åº","mysql"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/16699026890611669902688907.png"},{name:"twitter:title",content:"mysqlä¹æ¥å¿"},{name:"twitter:description",content:"ä¸æ¡æ°æ®å¨æ´æ°è¿ç¨å½ä¸­ï¼å¦æä¸­é mysql crash äºï¼mysql æ¯å¦ä½ä¿è¯æ°æ®çä¸è´æ§åæä¹æ§çï¼å¨è¿ä¸ªè¿ç¨ä¸­ mysql çæ¥å¿ç³»ç»èµ·å°äºè³å³éè¦çä½ç¨ãæ¬æå°ä¼ä»ç» mysql ä¸­ç undo logãredo log å bin log å¨è¿å¶ä¸­çä½ç¨ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/16699026890611669902688907.png"},{name:"twitter:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.mysql/01.mysql%E4%B9%8B%E6%97%A5%E5%BF%97.html"},{property:"og:type",content:"article"},{property:"og:title",content:"mysqlä¹æ¥å¿"},{property:"og:description",content:"ä¸æ¡æ°æ®å¨æ´æ°è¿ç¨å½ä¸­ï¼å¦æä¸­é mysql crash äºï¼mysql æ¯å¦ä½ä¿è¯æ°æ®çä¸è´æ§åæä¹æ§çï¼å¨è¿ä¸ªè¿ç¨ä¸­ mysql çæ¥å¿ç³»ç»èµ·å°äºè³å³éè¦çä½ç¨ãæ¬æå°ä¼ä»ç» mysql ä¸­ç undo logãredo log å bin log å¨è¿å¶ä¸­çä½ç¨ã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/16699026890611669902688907.png"},{property:"og:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.mysql/01.mysql%E4%B9%8B%E6%97%A5%E5%BF%97.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-01-01T20:23:07.000Z"},{property:"article:tag",content:"mysql"},{property:"article:tag",content:"æ°æ®åº"},{itemprop:"name",content:"mysqlä¹æ¥å¿"},{itemprop:"description",content:"ä¸æ¡æ°æ®å¨æ´æ°è¿ç¨å½ä¸­ï¼å¦æä¸­é mysql crash äºï¼mysql æ¯å¦ä½ä¿è¯æ°æ®çä¸è´æ§åæä¹æ§çï¼å¨è¿ä¸ªè¿ç¨ä¸­ mysql çæ¥å¿ç³»ç»èµ·å°äºè³å³éè¦çä½ç¨ãæ¬æå°ä¼ä»ç» mysql ä¸­ç undo logãredo log å bin log å¨è¿å¶ä¸­çä½ç¨ã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/16699026890611669902688907.png"}],readingShow:"top"},regularPath:"/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.mysql/01.mysql%E4%B9%8B%E6%97%A5%E5%BF%97.html",relativePath:"03.ä¸­é´ä»¶/03.mysql/01.mysqlä¹æ¥å¿.md",key:"v-cc91cd44",path:"/pages/2d69c7/",headers:[{level:2,title:"åè¨",slug:"åè¨",normalizedTitle:"åè¨",charIndex:2},{level:2,title:"buffer pool",slug:"buffer-pool",normalizedTitle:"buffer pool",charIndex:146},{level:2,title:"undo log",slug:"undo-log",normalizedTitle:"undo log",charIndex:105},{level:2,title:"redo log",slug:"redo-log",normalizedTitle:"redo log",charIndex:114},{level:3,title:"redo log çä½ç¨",slug:"redo-log-çä½ç¨",normalizedTitle:"redo log çä½ç¨",charIndex:537},{level:3,title:"redo logæä»¶ç»æ",slug:"redo-logæä»¶ç»æ",normalizedTitle:"redo logæä»¶ç»æ",charIndex:1128},{level:2,title:"binlog",slug:"binlog",normalizedTitle:"binlog",charIndex:1333},{level:2,title:"ä¸¤é¶æ®µæäº¤",slug:"ä¸¤é¶æ®µæäº¤",normalizedTitle:"ä¸¤é¶æ®µæäº¤",charIndex:1764},{level:2,title:"ç¸å³é¾æ¥",slug:"ç¸å³é¾æ¥",normalizedTitle:"ç¸å³é¾æ¥",charIndex:2647}],headersStr:"åè¨ buffer pool undo log redo log redo log çä½ç¨ redo logæä»¶ç»æ binlog ä¸¤é¶æ®µæäº¤ ç¸å³é¾æ¥",content:"# åè¨\n\nä¸æ¡æ°æ®å¨æ´æ°è¿ç¨å½ä¸­ï¼å¦æä¸­é mysql crash äºï¼mysql æ¯å¦ä½ä¿è¯æ°æ®çä¸è´æ§åæä¹æ§çï¼å¨è¿ä¸ªè¿ç¨ä¸­ mysql çæ¥å¿ç³»ç»èµ·å°äºè³å³éè¦çä½ç¨ãæ¬æå°ä¼ä»ç» mysql ä¸­ç undo logãredo log å bin log å¨è¿å¶ä¸­çä½ç¨ã\n\n\n# buffer pool\n\nå¨æ°æ®æ´æ°çæ¶åï¼æ°æ®å¹¶ä¸æ¯å®æ¶åæ­¥å°ç¡¬çä¸­ï¼èæ¯å¨ä¸åç¼å­ buffer pool ä¸­æ´æ°ï¼å¦æç¼å­ä¸­æ²¡ææ¥è¯¢å°è¯¥æ°æ®ï¼åä»ç£çä¸­å è½½å° buffer pool ä¸­ã\n\nå½ç¶ï¼ç¼å­çä½ç¨æ¯ä¸ºäºæé« IO æ§è½ï¼å¯ä»¥éè¿å°æ°æ®åä¿çå¨ç¼å­ä¸­ï¼ç¶åå¨éå½çæ¶æºï¼æ¹éåå¥å°ç¡¬çä¸­ã\n\nå¹¶ä¸å¨æ¥è¯¢æ°æ®æ¶ï¼åæ¯ä»ç¼å­ä¸­è¿è¡æ¥è¯¢ï¼ä¸ç¨å»ç£çä¸­æ¥æ¾ï¼åå° IO çæä½ï¼å å¿«æ¥è¯¢çéåº¦ã\n\n\n# undo log\n\næä»¬ç¥é InnoDB æ¯æ¯æäºå¡çï¼å¨äºå¡æäº¤å¤±è´¥æ¶ï¼æ¯ä¼åæ»å°æ§è¡ä¹åçç¶æï¼é£ä¹è¯å®æ¯éè¦ä¿å­ä¹åçç¶ææå¯ä»¥è¿è¡æ¢å¤çï¼è¿ä¸ªå°±æ¯éè¿ undo log æ¥å®ç°çã\n\nå¨æ°æ®åå¥ buffer pool çåæ¶ä¼å°æ´æ°åçæ°æ®ä¿å­å¨ undo log ä¸­ï¼éè¿è¯¥æ¥å¿è¯­å¥ä¾¿å¯ä»¥å¨äºå¡åæ»æ¶ï¼æ¢å¤å°ä¹åçç¶æã\n\n\n# redo log\n\n\n# redo log çä½ç¨\n\nååå° buffer pool ï¼å ä¸ºå®æ¯ç¼å­ï¼æ¯å¨åå­ä¸­ï¼ææå®çç¼ºç¹ä¹æ¾èæè§ï¼é£å°±æ¯å½æå¡å¨å®æºä¸­ï¼ç¼å­ä¸­çæ°æ®ä¼ä¸¢å¤±ï¼é£ä¹ mysql æ¯å¦ä½ä¿è¯æ°æ®çæä¹æ§å¢ï¼è¿ä¸ªæ¶åå°±è¦æ¥ä»ç»ä»ç» redo log äºã\n\nå¨æ°æ®æ´æ°å° buffer pool åï¼è¿ä¸ªæ¶åä¼å°æ´æ°åçæ°æ®è®°å½å° redo log buffer ä¸­ï¼è¿ä¸ªä¹æ¯ä¸ä¸ªç¼å­åºï¼å®å½ç¶ä¹å·å¤äºç¼å­ä¼ç¼ºç¹ï¼å¹¶ä¸é»è®¤æ¯å¨æäº¤äºå¡çæ¶ååå¥å° redo log ä¸­ï¼å·ççç­ç¥å¯ä»¥æ ¹æ® innodb_flush_log_at_trx_commit æ¥è®¾ç½®\n\n * 0ï¼ä¸å·å¥ç£ç\n * 1ï¼ç«å³å·å¥ç£çï¼é»è®¤ï¼\n * 2ï¼åå·å¥å° os cache ä¸­\n\nå ä¸º redo log æ¯é¡ºåºåå¥ï¼æä»¥ IO æ§è½ä¸ä¼å¤ªå·®ã\n\nå½ buffer pool ä¸­çæ°æ®è¿æ²¡æåå¥å°ç£çä¸­æ¶ï¼åçäºå®æºï¼å½ mysql éå¯æ¶ï¼ä¼è¯»åå·²ç»æä¹å redo log ä¸­çæ°æ®ï¼åæ¢å¤å° buffer pool ä¸­ã\n\nå¨å¼å¯äºå¡åå¤æ´æ°ä¸æ¡è®°å½æ¶ï¼InnoDB ä¼åå¨ buffer pool ä¸­æ´æ°æ°æ®ï¼ç¶åå°æ´æ°åçæ°æ®è®°å½å° redo log buffer ä¸­ï¼è¿ä¹æ¯ä¸ä¸ªç¼å­ãå½ç¶è¿ä¸ªæ¶åä¹æ¯ä¼åçå®æºï¼ä½æ¯æ²¡å³ç³»ï¼å¦æè¯¥é¨åæ°æ®ä¸¢å¤±ï¼åè®¤ä¸ºè¯¥æ¬¡äºå¡æäº¤å¤±è´¥ï¼æ°æ®ä¼æ¢å¤å°ä¹åçç¶æã\n\n\n# redo logæä»¶ç»æ\n\nredolog æ¯ç±å¤ä¸ªåºå®å¤§å°çæä»¶ç»æçä¸ä¸ªç¯å½¢ç»æï¼å¹¶å¨è¿ä¸ªç¯å½¢ç»æä¸­ä¸æ­çåå¥ä¸è¦ççè¿ç¨ã\n\n * write posï¼è®°å½å½åçä½ç½®\n * checkpointï¼å½åè¦æ¦é¤çä½ç½®\n\nå½ææ°ç redo log åå¥æ¶ï¼ä» wirte pos ä½ç½®å¾ååï¼è check point æ¯ä¸ä¸æ¬¡å·²ç»å·å¥ç£ççæ°æ®çä½ç½®ï¼ä¹æ¯è¦ä¸æ­çå¾åæ¨è¿ï¼ç¶åå°æ°æ®å·å¥ç£çä¸­ã\n\n\n# binlog\n\næ¯å¨ mysql å±çº§è®°å½çæ¥å¿ï¼ä¸»è¦æ¯ç¨äºä¸»ä»å¤å¶åæ°æ®æ¢å¤ï¼å¯ä»¥éè¿æä¸ªæ¶é´çå¨éå¤ä»½+binlog æ¥æ¢å¤å°ä»»ææ¶é´åçç¶æã\n\nå redo log çåºå«\n\næ§è´¨   REDO LOG                      BIN LOG                        \nå®ç°   innodb ç¬æå®ç°                   mysql server å±çº§å®ç°ï¼ææçå¼æé½å¯ä»¥ä½¿ç¨   \nåå®¹   ç©ç log, è®°å½çæ¯âå¨æä¸ªæ°æ®é¡µä¸åäºä»ä¹ä¿®æ¹â   é»è¾ logï¼ç» ID=2 è¿ä¸è¡ç c å­æ®µå  1     \nåå¥   å¾ªç¯åå¥                          è¿½å åï¼åå°ä¸å®å¤§å°åæ¢ä¸ä¸ä¸ªæä»¶ç»§ç»­å           \nåºç¨   å´©æºæ¢å¤(crash-safe)              ä¸»ä»åæ­¥ï¼æ°æ®æ¢å¤                      \n\n\n# ä¸¤é¶æ®µæäº¤\n\nä¸ºä»ä¹éè¦ä¸¤é¶æ®µæäº¤ï¼\n\næ¯ä¸ºäºè®© redo log å bin log ä¿æé»è¾ä¸è´æ§ã\n\n 1. å¦æåå redolog åå bin logãåè®¾ redo log åå®ï¼å bin log æ¶ crash äºã\n\nå ä¸º redo log åå®äºï¼æä»¥å³ä½¿ç³»ç»å´©æºï¼ä¹å¯ä»¥æ¢å¤æ°æ®ï¼ä½æ¯ bin log æ²¡åå® crash äºï¼è¿ä¸ªæ¶å bin log ä¸­å°äºè¯¥æ¡è¯­å¥ï¼å æ­¤æ°æ®å¤ä»½çæ¶åï¼å¦æä½¿ç¨äºè¯¥ä»½ bin log åä¼å°ä¸æ¬¡æ´æ°ã\n\n 2. å¦æåå bin log åå redo logãåè®¾ bin log åå®ï¼å redo log æ¶ crash äºã\n\nå ä¸º redo log æ²¡åå®ï¼æä»¥è¯¥äºå¡æ²¡æçæï¼ä½æ¯ binlog ä¸­å·²ç»æè¯¥æ¡è®°å½ï¼æä»¥ä½¿ç¨ bin log æ¶ï¼ä¼å¤åºä¸ä¸ªäºå¡ï¼ä¸åæ¥çæ°æ®ä¸ä¸è´ã\n\næä»¥ä½¿ç¨ä¸¤é¶æ®µæäº¤å¯ä»¥è§£å³ä¸é¢ä¸¤ç§åºæ¯ã\n\nä¸¤é¶æ®µæäº¤çå®ç°é»è¾\n\n 1. å¨æ´æ°æ°æ®æ¶ï¼ä¼åå¨ redo log ä¸­è®°å½å½åæ´æ°çæ°æ®ï¼å¹¶ä¸æ è®°ä¸º prepare ç¶æ\n 2. binlog åè¿è¡åå¥\n 3. äºå¡æäº¤æ¶ï¼ redo log åå°è¯¥æ¡è®°å½æ è®°ä¸º commit ç¶æå¹¶ä¸å·å¥å°ç£çä¸­ã\n\néè¿ prepare å commit ä¸¤ç§ç¶ææ¥å®æä¸¤é¶æ®µçæäº¤å®ç°ã\n\néªè¯ä¸¤é¶æ®µæäº¤\n\n 1. å¦æå¨ä¸¤é¶æ®µæäº¤çç¬¬ä¸æ­¥ååç crashï¼ä¹å°±æ¯ redo log å·²ç»æ´æ°äºæ°æ®å¹¶ä¸ä¸º Prepare ç¶æï¼ä½æ¯ binlog è¿æªåå¥å°±åºç°äº crashï¼è¿ä¸ªæ¶åï¼mysql éå¯åï¼å ä¸º redo log æª commitï¼å¯ä»¥éè¿åæ»å°æ°æ®æ¢å¤ã\n 2. å¦æå¨ç¬¬äºæ­¥åç crashï¼ä¹å°±æ¯ redo log ä¸º prepare ç¶æï¼å¹¶ä¸ binlog å·²ç»åå¥ï¼ä½æ¯è¿æ¶ååºç°äº crashï¼å¨ mysql éå¯åï¼å ä¸º binlog å·²ç»æäºè®°å½ï¼æä»¥ä¼ç»§ç»­æäº¤è¯¥äºå¡ï¼å¦å bin log ä¸­æ°æ®æ°å¢äºä¸æ¡ï¼è redo log æ²¡æäº¤åå¯è½åçä¸¤èæ°æ®ä¸ä¸è´çæåµã\n\n\n# ç¸å³é¾æ¥\n\n * ä¸æ¡ SQL çæ§è¡è¿ç¨è¯¦è§£\n * åºäºRedo LogåUndo LogçMySQLå´©æºæ¢å¤æµç¨",normalizedContent:"# åè¨\n\nä¸æ¡æ°æ®å¨æ´æ°è¿ç¨å½ä¸­ï¼å¦æä¸­é mysql crash äºï¼mysql æ¯å¦ä½ä¿è¯æ°æ®çä¸è´æ§åæä¹æ§çï¼å¨è¿ä¸ªè¿ç¨ä¸­ mysql çæ¥å¿ç³»ç»èµ·å°äºè³å³éè¦çä½ç¨ãæ¬æå°ä¼ä»ç» mysql ä¸­ç undo logãredo log å bin log å¨è¿å¶ä¸­çä½ç¨ã\n\n\n# buffer pool\n\nå¨æ°æ®æ´æ°çæ¶åï¼æ°æ®å¹¶ä¸æ¯å®æ¶åæ­¥å°ç¡¬çä¸­ï¼èæ¯å¨ä¸åç¼å­ buffer pool ä¸­æ´æ°ï¼å¦æç¼å­ä¸­æ²¡ææ¥è¯¢å°è¯¥æ°æ®ï¼åä»ç£çä¸­å è½½å° buffer pool ä¸­ã\n\nå½ç¶ï¼ç¼å­çä½ç¨æ¯ä¸ºäºæé« io æ§è½ï¼å¯ä»¥éè¿å°æ°æ®åä¿çå¨ç¼å­ä¸­ï¼ç¶åå¨éå½çæ¶æºï¼æ¹éåå¥å°ç¡¬çä¸­ã\n\nå¹¶ä¸å¨æ¥è¯¢æ°æ®æ¶ï¼åæ¯ä»ç¼å­ä¸­è¿è¡æ¥è¯¢ï¼ä¸ç¨å»ç£çä¸­æ¥æ¾ï¼åå° io çæä½ï¼å å¿«æ¥è¯¢çéåº¦ã\n\n\n# undo log\n\næä»¬ç¥é innodb æ¯æ¯æäºå¡çï¼å¨äºå¡æäº¤å¤±è´¥æ¶ï¼æ¯ä¼åæ»å°æ§è¡ä¹åçç¶æï¼é£ä¹è¯å®æ¯éè¦ä¿å­ä¹åçç¶ææå¯ä»¥è¿è¡æ¢å¤çï¼è¿ä¸ªå°±æ¯éè¿ undo log æ¥å®ç°çã\n\nå¨æ°æ®åå¥ buffer pool çåæ¶ä¼å°æ´æ°åçæ°æ®ä¿å­å¨ undo log ä¸­ï¼éè¿è¯¥æ¥å¿è¯­å¥ä¾¿å¯ä»¥å¨äºå¡åæ»æ¶ï¼æ¢å¤å°ä¹åçç¶æã\n\n\n# redo log\n\n\n# redo log çä½ç¨\n\nååå° buffer pool ï¼å ä¸ºå®æ¯ç¼å­ï¼æ¯å¨åå­ä¸­ï¼ææå®çç¼ºç¹ä¹æ¾èæè§ï¼é£å°±æ¯å½æå¡å¨å®æºä¸­ï¼ç¼å­ä¸­çæ°æ®ä¼ä¸¢å¤±ï¼é£ä¹ mysql æ¯å¦ä½ä¿è¯æ°æ®çæä¹æ§å¢ï¼è¿ä¸ªæ¶åå°±è¦æ¥ä»ç»ä»ç» redo log äºã\n\nå¨æ°æ®æ´æ°å° buffer pool åï¼è¿ä¸ªæ¶åä¼å°æ´æ°åçæ°æ®è®°å½å° redo log buffer ä¸­ï¼è¿ä¸ªä¹æ¯ä¸ä¸ªç¼å­åºï¼å®å½ç¶ä¹å·å¤äºç¼å­ä¼ç¼ºç¹ï¼å¹¶ä¸é»è®¤æ¯å¨æäº¤äºå¡çæ¶ååå¥å° redo log ä¸­ï¼å·ççç­ç¥å¯ä»¥æ ¹æ® innodb_flush_log_at_trx_commit æ¥è®¾ç½®\n\n * 0ï¼ä¸å·å¥ç£ç\n * 1ï¼ç«å³å·å¥ç£çï¼é»è®¤ï¼\n * 2ï¼åå·å¥å° os cache ä¸­\n\nå ä¸º redo log æ¯é¡ºåºåå¥ï¼æä»¥ io æ§è½ä¸ä¼å¤ªå·®ã\n\nå½ buffer pool ä¸­çæ°æ®è¿æ²¡æåå¥å°ç£çä¸­æ¶ï¼åçäºå®æºï¼å½ mysql éå¯æ¶ï¼ä¼è¯»åå·²ç»æä¹å redo log ä¸­çæ°æ®ï¼åæ¢å¤å° buffer pool ä¸­ã\n\nå¨å¼å¯äºå¡åå¤æ´æ°ä¸æ¡è®°å½æ¶ï¼innodb ä¼åå¨ buffer pool ä¸­æ´æ°æ°æ®ï¼ç¶åå°æ´æ°åçæ°æ®è®°å½å° redo log buffer ä¸­ï¼è¿ä¹æ¯ä¸ä¸ªç¼å­ãå½ç¶è¿ä¸ªæ¶åä¹æ¯ä¼åçå®æºï¼ä½æ¯æ²¡å³ç³»ï¼å¦æè¯¥é¨åæ°æ®ä¸¢å¤±ï¼åè®¤ä¸ºè¯¥æ¬¡äºå¡æäº¤å¤±è´¥ï¼æ°æ®ä¼æ¢å¤å°ä¹åçç¶æã\n\n\n# redo logæä»¶ç»æ\n\nredolog æ¯ç±å¤ä¸ªåºå®å¤§å°çæä»¶ç»æçä¸ä¸ªç¯å½¢ç»æï¼å¹¶å¨è¿ä¸ªç¯å½¢ç»æä¸­ä¸æ­çåå¥ä¸è¦ççè¿ç¨ã\n\n * write posï¼è®°å½å½åçä½ç½®\n * checkpointï¼å½åè¦æ¦é¤çä½ç½®\n\nå½ææ°ç redo log åå¥æ¶ï¼ä» wirte pos ä½ç½®å¾ååï¼è check point æ¯ä¸ä¸æ¬¡å·²ç»å·å¥ç£ççæ°æ®çä½ç½®ï¼ä¹æ¯è¦ä¸æ­çå¾åæ¨è¿ï¼ç¶åå°æ°æ®å·å¥ç£çä¸­ã\n\n\n# binlog\n\næ¯å¨ mysql å±çº§è®°å½çæ¥å¿ï¼ä¸»è¦æ¯ç¨äºä¸»ä»å¤å¶åæ°æ®æ¢å¤ï¼å¯ä»¥éè¿æä¸ªæ¶é´çå¨éå¤ä»½+binlog æ¥æ¢å¤å°ä»»ææ¶é´åçç¶æã\n\nå redo log çåºå«\n\næ§è´¨   redo log                      bin log                        \nå®ç°   innodb ç¬æå®ç°                   mysql server å±çº§å®ç°ï¼ææçå¼æé½å¯ä»¥ä½¿ç¨   \nåå®¹   ç©ç log, è®°å½çæ¯âå¨æä¸ªæ°æ®é¡µä¸åäºä»ä¹ä¿®æ¹â   é»è¾ logï¼ç» id=2 è¿ä¸è¡ç c å­æ®µå  1     \nåå¥   å¾ªç¯åå¥                          è¿½å åï¼åå°ä¸å®å¤§å°åæ¢ä¸ä¸ä¸ªæä»¶ç»§ç»­å           \nåºç¨   å´©æºæ¢å¤(crash-safe)              ä¸»ä»åæ­¥ï¼æ°æ®æ¢å¤                      \n\n\n# ä¸¤é¶æ®µæäº¤\n\nä¸ºä»ä¹éè¦ä¸¤é¶æ®µæäº¤ï¼\n\næ¯ä¸ºäºè®© redo log å bin log ä¿æé»è¾ä¸è´æ§ã\n\n 1. å¦æåå redolog åå bin logãåè®¾ redo log åå®ï¼å bin log æ¶ crash äºã\n\nå ä¸º redo log åå®äºï¼æä»¥å³ä½¿ç³»ç»å´©æºï¼ä¹å¯ä»¥æ¢å¤æ°æ®ï¼ä½æ¯ bin log æ²¡åå® crash äºï¼è¿ä¸ªæ¶å bin log ä¸­å°äºè¯¥æ¡è¯­å¥ï¼å æ­¤æ°æ®å¤ä»½çæ¶åï¼å¦æä½¿ç¨äºè¯¥ä»½ bin log åä¼å°ä¸æ¬¡æ´æ°ã\n\n 2. å¦æåå bin log åå redo logãåè®¾ bin log åå®ï¼å redo log æ¶ crash äºã\n\nå ä¸º redo log æ²¡åå®ï¼æä»¥è¯¥äºå¡æ²¡æçæï¼ä½æ¯ binlog ä¸­å·²ç»æè¯¥æ¡è®°å½ï¼æä»¥ä½¿ç¨ bin log æ¶ï¼ä¼å¤åºä¸ä¸ªäºå¡ï¼ä¸åæ¥çæ°æ®ä¸ä¸è´ã\n\næä»¥ä½¿ç¨ä¸¤é¶æ®µæäº¤å¯ä»¥è§£å³ä¸é¢ä¸¤ç§åºæ¯ã\n\nä¸¤é¶æ®µæäº¤çå®ç°é»è¾\n\n 1. å¨æ´æ°æ°æ®æ¶ï¼ä¼åå¨ redo log ä¸­è®°å½å½åæ´æ°çæ°æ®ï¼å¹¶ä¸æ è®°ä¸º prepare ç¶æ\n 2. binlog åè¿è¡åå¥\n 3. äºå¡æäº¤æ¶ï¼ redo log åå°è¯¥æ¡è®°å½æ è®°ä¸º commit ç¶æå¹¶ä¸å·å¥å°ç£çä¸­ã\n\néè¿ prepare å commit ä¸¤ç§ç¶ææ¥å®æä¸¤é¶æ®µçæäº¤å®ç°ã\n\néªè¯ä¸¤é¶æ®µæäº¤\n\n 1. å¦æå¨ä¸¤é¶æ®µæäº¤çç¬¬ä¸æ­¥ååç crashï¼ä¹å°±æ¯ redo log å·²ç»æ´æ°äºæ°æ®å¹¶ä¸ä¸º prepare ç¶æï¼ä½æ¯ binlog è¿æªåå¥å°±åºç°äº crashï¼è¿ä¸ªæ¶åï¼mysql éå¯åï¼å ä¸º redo log æª commitï¼å¯ä»¥éè¿åæ»å°æ°æ®æ¢å¤ã\n 2. å¦æå¨ç¬¬äºæ­¥åç crashï¼ä¹å°±æ¯ redo log ä¸º prepare ç¶æï¼å¹¶ä¸ binlog å·²ç»åå¥ï¼ä½æ¯è¿æ¶ååºç°äº crashï¼å¨ mysql éå¯åï¼å ä¸º binlog å·²ç»æäºè®°å½ï¼æä»¥ä¼ç»§ç»­æäº¤è¯¥äºå¡ï¼å¦å bin log ä¸­æ°æ®æ°å¢äºä¸æ¡ï¼è redo log æ²¡æäº¤åå¯è½åçä¸¤èæ°æ®ä¸ä¸è´çæåµã\n\n\n# ç¸å³é¾æ¥\n\n * ä¸æ¡ sql çæ§è¡è¿ç¨è¯¦è§£\n * åºäºredo logåundo logçmysqlå´©æºæ¢å¤æµç¨",charsets:{cjk:!0},lastUpdated:"2023/11/01, 11:48:43",lastUpdatedTimestamp:1698810523e3},{title:"mysqlä¹MVCCåç",frontmatter:{title:"mysqlä¹MVCCåç",date:"2023-01-01T20:23:21.000Z",permalink:"/pages/0d8f4a/",tags:["mysql","æ°æ®åº"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"MVCC çå¨ç§°æ¯ Multi- [Version](https://so.csdn.net/so/search?q=Version&spm=1001.2101.3001.7020)Â Concurrency Controlï¼ä¹å°±æ¯å¤çæ¬å¹¶åæ§å¶ï¼è¯¥æºå¶æ¯åªææ¯æäºå¡ç InnoDB å¼æä¸æå­å¨çï¼ç¨æ¥å®ç°æé«æ°æ®åºçå¹¶åæ§è½ï¼å¯ä»¥åå°ï¼è¯»ä¸å éï¼è¯»åä¸å²çªã",feed:{enable:!0},categories:["æ°æ®åº","mysql"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210821150008.png"},{name:"twitter:title",content:"mysqlä¹MVCCåç"},{name:"twitter:description",content:"MVCC çå¨ç§°æ¯ Multi- [Version](https://so.csdn.net/so/search?q=Version&spm=1001.2101.3001.7020)Â Concurrency Controlï¼ä¹å°±æ¯å¤çæ¬å¹¶åæ§å¶ï¼è¯¥æºå¶æ¯åªææ¯æäºå¡ç InnoDB å¼æä¸æå­å¨çï¼ç¨æ¥å®ç°æé«æ°æ®åºçå¹¶åæ§è½ï¼å¯ä»¥åå°ï¼è¯»ä¸å éï¼è¯»åä¸å²çªã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210821150008.png"},{name:"twitter:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.mysql/02.mysql%E4%B9%8BMVCC%E5%8E%9F%E7%90%86.html"},{property:"og:type",content:"article"},{property:"og:title",content:"mysqlä¹MVCCåç"},{property:"og:description",content:"MVCC çå¨ç§°æ¯ Multi- [Version](https://so.csdn.net/so/search?q=Version&spm=1001.2101.3001.7020)Â Concurrency Controlï¼ä¹å°±æ¯å¤çæ¬å¹¶åæ§å¶ï¼è¯¥æºå¶æ¯åªææ¯æäºå¡ç InnoDB å¼æä¸æå­å¨çï¼ç¨æ¥å®ç°æé«æ°æ®åºçå¹¶åæ§è½ï¼å¯ä»¥åå°ï¼è¯»ä¸å éï¼è¯»åä¸å²çªã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210821150008.png"},{property:"og:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.mysql/02.mysql%E4%B9%8BMVCC%E5%8E%9F%E7%90%86.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-01-01T20:23:21.000Z"},{property:"article:tag",content:"mysql"},{property:"article:tag",content:"æ°æ®åº"},{itemprop:"name",content:"mysqlä¹MVCCåç"},{itemprop:"description",content:"MVCC çå¨ç§°æ¯ Multi- [Version](https://so.csdn.net/so/search?q=Version&spm=1001.2101.3001.7020)Â Concurrency Controlï¼ä¹å°±æ¯å¤çæ¬å¹¶åæ§å¶ï¼è¯¥æºå¶æ¯åªææ¯æäºå¡ç InnoDB å¼æä¸æå­å¨çï¼ç¨æ¥å®ç°æé«æ°æ®åºçå¹¶åæ§è½ï¼å¯ä»¥åå°ï¼è¯»ä¸å éï¼è¯»åä¸å²çªã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210821150008.png"}],readingShow:"top"},regularPath:"/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.mysql/02.mysql%E4%B9%8BMVCC%E5%8E%9F%E7%90%86.html",relativePath:"03.ä¸­é´ä»¶/03.mysql/02.mysqlä¹MVCCåç.md",key:"v-16efd28d",path:"/pages/0d8f4a/",headers:[{level:2,title:"ä»ä¹æ¯ MVCC?",slug:"ä»ä¹æ¯-mvcc",normalizedTitle:"ä»ä¹æ¯ mvcc?",charIndex:2},{level:2,title:"MVCC çå®ç°åç",slug:"mvcc-çå®ç°åç",normalizedTitle:"mvcc çå®ç°åç",charIndex:145},{level:2,title:"ReadView",slug:"readview",normalizedTitle:"readview",charIndex:373},{level:2,title:"Undo æ¥å¿",slug:"undo-æ¥å¿",normalizedTitle:"undo æ¥å¿",charIndex:824},{level:2,title:"å¿«ç§è¯»åå½åè¯»",slug:"å¿«ç§è¯»åå½åè¯»",normalizedTitle:"å¿«ç§è¯»åå½åè¯»",charIndex:1026},{level:2,title:"ç¸å³é¾æ¥",slug:"ç¸å³é¾æ¥",normalizedTitle:"ç¸å³é¾æ¥",charIndex:1314}],headersStr:"ä»ä¹æ¯ MVCC? MVCC çå®ç°åç ReadView Undo æ¥å¿ å¿«ç§è¯»åå½åè¯» ç¸å³é¾æ¥",content:"# ä»ä¹æ¯ MVCC?\n\nMVCC çå¨ç§°æ¯ Multi- VersionÂ Concurrency Controlï¼ä¹å°±æ¯å¤çæ¬å¹¶åæ§å¶ï¼è¯¥æºå¶æ¯åªææ¯æäºå¡ç InnoDB å¼æä¸æå­å¨çï¼ç¨æ¥å®ç°æé«æ°æ®åºçå¹¶åæ§è½ï¼å¯ä»¥åå°ï¼è¯»ä¸å éï¼è¯»åä¸å²çªã\n\né£ä¹å®æ¯å¦ä½å®ç°çå¢ï¼\n\n\n# MVCC çå®ç°åç\n\nå¨ Innodb çæ¯ä¸è¡æ°æ®ä¸­é½ä¼ä¿å­å¤ä¸ªçæ¬ï¼æ¯ä¸ªçæ¬é½æå¯¹åºçäºå¡ IDã\n\nå¨å¼å¯æ¯ä¸ä¸ªäºå¡æ¶ï¼é½ä¼çæå½åäºå¡ççæ¬å·ï¼å½å¨è¯¥äºå¡ä¸­æä½ä¿®æ¹æ°æ®æ¶ï¼é½ä¼çæä¸ä¸ªæ°çæ°æ®è¡ï¼è¯¥æ°æ®è¡å¨æäº¤ä¹åå¯¹å¶ä»äºå¡æ¥è¯´æ¯ä¸å¯è§çï¼ç¶åå°çæ¬å·æ´æ°å°æ°æ®è¡ä¸­ï¼è¿æ ·å°±ä¿è¯äºæ¯ä¸ªäºå¡æä½çæ°æ®é½æ¯äºä¸å½±åçï¼ä¹ä¸å­å¨éçé®é¢ã\n\nå¨è¯»æä½æ¶ï¼æä»¬åªå»å¿«ç§è¯»ï¼èä¸è¯»åæ­£å¨ä¿®æ¹çæ°æ®ï¼è¿æ¯ä¸¤ä¸ªä¸åçæ¬çæ°æ®ï¼æä»¥æä½ä¸ä¸ä¼åçå²çªã\n\n\n# ReadView\n\nRead View æ¯æ¥è¡¨ç¤ºå½åäºå¡çå¯è§æ§çï¼éè¿ä¸é¢ç MVCC åçç¥éææçè¡æ°æ®é½æ¯æçæ¬çï¼é£ä¹åªäºçæ¬çæ°æ®å¨å½åäºå¡æ¯å¯è§çï¼ä¹å°±æ¯å¯è¯»å°çï¼åªäºæ¯ä¸å¯è§çã\n\nåå»º Read View æ¶ï¼ä¼æé ä¸ä¸ªæ°ç»æ¥ä¿å­å½åäºå¡å¯å¨ç¬é´å¯å¨äºä½æ¯æ²¡ææäº¤çäºå¡ IDã\n\n * å¦æå°äºæå°å¼ï¼åæ¯å·²ç»æäº¤çäºå¡ï¼æ¯å¯è§ç\n * å¦æå¤§äºæå¤§å¼ï¼åä»£è¡¨æ¯å°æ¥å¯å¨çäºå¡ï¼ä¸å¯è§\n * å¦æå¨æ°ç»åè¡¨ä¸­ï¼è¡¨ç¤ºè¿æ²¡æäº¤çäºå¡ï¼ä¸å¯è§\n * å¦æå¤§äºæå°å¼ï¼å°äºæå¤§å¼ï¼ä½ä¸å¨æ°ç»ä¸­ï¼è¡¨ç¤ºæ¯å·²ç»æäº¤äºçäºå¡ï¼å¯è§\n\nåå»º Read View çæ¶æºå¨ä¸åçéç¦»çº§å«æ¯ä¸åã\n\n * å¨è¯»æªæäº¤ä¸­ï¼ç´æ¥è¯»åçæ¯ææ°çæ¬çæ°æ®\n * å¨è¯»å·²æäº¤ä¸­ï¼å¨æ¯æ¬¡è¯»åæ°æ®åï¼å°±ä¼çæä¸ä¸ª Read Viewï¼ç¶ååè¯»åå¯è§çæ¬çæ°æ®ã\n * å¨å¯éå¤è¯»ä¸­ï¼å¨æ¯æ¬¡å¼å¯äºå¡çæ¶åï¼å°±ä¼çæ Read Viewï¼å¨æäº¤ä¹åé½ä¸ç´å¦æ­¤ä½¿ç¨ã\n * å¨ä¸²è¡åä¸­ï¼æ¯éè¿å éçæ¹å¼æ¥è®¿é®æ°æ®ã\n\n\n# Undo æ¥å¿\n\næ¯æ¡è®°å½æ´æ°æ¶ï¼é½ä¼åæ¶è®°å½ä¸æ¡åæ»æä½ãè®°å½ä¸çææ°å¼é½å¯éè¿åæ»æä½å¾å°åä¸ä¸ªç¶æå¼\n\nå¨è§å¾ AãBãC éé¢ï¼è¿ä¸ä¸ªè®°å½çå¼åå«æ¯ 1ã2ã4ï¼åä¸æ¡è®°å½å¨ç³»ç»ä¸­å¯ä»¥å­å¨å¤ä¸ªçæ¬ï¼å°±æ¯æ°æ®åºçå¤çæ¬å¹¶åæ§å¶ï¼MVCCï¼ãç³»ç»ä¼å¤æ­å¨æ²¡æäºå¡éè¦ç¨å°åæ»æ¥å¿æ¶ï¼åæ»æ¥å¿ä¼è¢«å é¤\n\nä¸å»ºè®®ä½¿ç¨é¿äºå¡çåå æ¯ï¼å¨äºå¡æäº¤ä¹åï¼åæ»æ¥å¿é½éè¦ä¿å­ï¼å¯¼è´å ç¨å¤§éå­å¨ç©ºé´ã\n\n\n\n\n# å¿«ç§è¯»åå½åè¯»\n\nå¿«ç§è¯»ï¼å°±æ¯å½è¿è¡æ¥è¯¢æ¶ï¼æ¯æ ¹æ® Read View çè§å¾å¯è§æ§æ¥è¯»åå¯¹åºçæ¬çæ°æ®ã\n\næè¿ä¹ä¸ä¸ªåºæ¯ï¼å½åæ¯å¯éå¤è¯»çéç¦»çå«ï¼å¼å§äºå¡çé¡ºåºåå«æ¯ AãBãCï¼äºå¡ C æ´æ° K ä¹åï¼ææ°ççæ¬ 102ï¼å½äºå¡ Bï¼æ ¹æ® Read View æ¯çä¸å° 102 çæ¬çæ°æ®ï¼é£ä¹å¶æ´æ°åªè½å¨ 90 çæ¬ä¸å»+1ï¼è¿æ ·çç»æè¯å®æ¯ä¸å¯¹çï¼å ä¸ºä¸æ¯å¨ææ°çç»æä¸è¿è¡+1ï¼æä»¥è¿ééè¦ç¨å° å½åè¯»ï¼ä¹å°±æ¯å»è¯»åå½åæ°æ®çææ°çæ¬çæ°æ®ï¼ç¶ååè¿è¡+1ãè¯¥å½åè¯»ä¼å¯¹è¯¥è¡æ°æ®è¿è¡å éï¼å¨è¯¥äºå¡ commit ä¹åï¼å¶ä»äºå¡é½ä¸è½å¯¹å¶è¿è¡æä½ã\n\n\n\n\n# ç¸å³é¾æ¥\n\n * https://blog.csdn.net/SIESTA030/article/details/123113437\n * https://blog.csdn.net/huaishu/article/details/89924250",normalizedContent:"# ä»ä¹æ¯ mvcc?\n\nmvcc çå¨ç§°æ¯ multi- versionÂ concurrency controlï¼ä¹å°±æ¯å¤çæ¬å¹¶åæ§å¶ï¼è¯¥æºå¶æ¯åªææ¯æäºå¡ç innodb å¼æä¸æå­å¨çï¼ç¨æ¥å®ç°æé«æ°æ®åºçå¹¶åæ§è½ï¼å¯ä»¥åå°ï¼è¯»ä¸å éï¼è¯»åä¸å²çªã\n\né£ä¹å®æ¯å¦ä½å®ç°çå¢ï¼\n\n\n# mvcc çå®ç°åç\n\nå¨ innodb çæ¯ä¸è¡æ°æ®ä¸­é½ä¼ä¿å­å¤ä¸ªçæ¬ï¼æ¯ä¸ªçæ¬é½æå¯¹åºçäºå¡ idã\n\nå¨å¼å¯æ¯ä¸ä¸ªäºå¡æ¶ï¼é½ä¼çæå½åäºå¡ççæ¬å·ï¼å½å¨è¯¥äºå¡ä¸­æä½ä¿®æ¹æ°æ®æ¶ï¼é½ä¼çæä¸ä¸ªæ°çæ°æ®è¡ï¼è¯¥æ°æ®è¡å¨æäº¤ä¹åå¯¹å¶ä»äºå¡æ¥è¯´æ¯ä¸å¯è§çï¼ç¶åå°çæ¬å·æ´æ°å°æ°æ®è¡ä¸­ï¼è¿æ ·å°±ä¿è¯äºæ¯ä¸ªäºå¡æä½çæ°æ®é½æ¯äºä¸å½±åçï¼ä¹ä¸å­å¨éçé®é¢ã\n\nå¨è¯»æä½æ¶ï¼æä»¬åªå»å¿«ç§è¯»ï¼èä¸è¯»åæ­£å¨ä¿®æ¹çæ°æ®ï¼è¿æ¯ä¸¤ä¸ªä¸åçæ¬çæ°æ®ï¼æä»¥æä½ä¸ä¸ä¼åçå²çªã\n\n\n# readview\n\nread view æ¯æ¥è¡¨ç¤ºå½åäºå¡çå¯è§æ§çï¼éè¿ä¸é¢ç mvcc åçç¥éææçè¡æ°æ®é½æ¯æçæ¬çï¼é£ä¹åªäºçæ¬çæ°æ®å¨å½åäºå¡æ¯å¯è§çï¼ä¹å°±æ¯å¯è¯»å°çï¼åªäºæ¯ä¸å¯è§çã\n\nåå»º read view æ¶ï¼ä¼æé ä¸ä¸ªæ°ç»æ¥ä¿å­å½åäºå¡å¯å¨ç¬é´å¯å¨äºä½æ¯æ²¡ææäº¤çäºå¡ idã\n\n * å¦æå°äºæå°å¼ï¼åæ¯å·²ç»æäº¤çäºå¡ï¼æ¯å¯è§ç\n * å¦æå¤§äºæå¤§å¼ï¼åä»£è¡¨æ¯å°æ¥å¯å¨çäºå¡ï¼ä¸å¯è§\n * å¦æå¨æ°ç»åè¡¨ä¸­ï¼è¡¨ç¤ºè¿æ²¡æäº¤çäºå¡ï¼ä¸å¯è§\n * å¦æå¤§äºæå°å¼ï¼å°äºæå¤§å¼ï¼ä½ä¸å¨æ°ç»ä¸­ï¼è¡¨ç¤ºæ¯å·²ç»æäº¤äºçäºå¡ï¼å¯è§\n\nåå»º read view çæ¶æºå¨ä¸åçéç¦»çº§å«æ¯ä¸åã\n\n * å¨è¯»æªæäº¤ä¸­ï¼ç´æ¥è¯»åçæ¯ææ°çæ¬çæ°æ®\n * å¨è¯»å·²æäº¤ä¸­ï¼å¨æ¯æ¬¡è¯»åæ°æ®åï¼å°±ä¼çæä¸ä¸ª read viewï¼ç¶ååè¯»åå¯è§çæ¬çæ°æ®ã\n * å¨å¯éå¤è¯»ä¸­ï¼å¨æ¯æ¬¡å¼å¯äºå¡çæ¶åï¼å°±ä¼çæ read viewï¼å¨æäº¤ä¹åé½ä¸ç´å¦æ­¤ä½¿ç¨ã\n * å¨ä¸²è¡åä¸­ï¼æ¯éè¿å éçæ¹å¼æ¥è®¿é®æ°æ®ã\n\n\n# undo æ¥å¿\n\næ¯æ¡è®°å½æ´æ°æ¶ï¼é½ä¼åæ¶è®°å½ä¸æ¡åæ»æä½ãè®°å½ä¸çææ°å¼é½å¯éè¿åæ»æä½å¾å°åä¸ä¸ªç¶æå¼\n\nå¨è§å¾ aãbãc éé¢ï¼è¿ä¸ä¸ªè®°å½çå¼åå«æ¯ 1ã2ã4ï¼åä¸æ¡è®°å½å¨ç³»ç»ä¸­å¯ä»¥å­å¨å¤ä¸ªçæ¬ï¼å°±æ¯æ°æ®åºçå¤çæ¬å¹¶åæ§å¶ï¼mvccï¼ãç³»ç»ä¼å¤æ­å¨æ²¡æäºå¡éè¦ç¨å°åæ»æ¥å¿æ¶ï¼åæ»æ¥å¿ä¼è¢«å é¤\n\nä¸å»ºè®®ä½¿ç¨é¿äºå¡çåå æ¯ï¼å¨äºå¡æäº¤ä¹åï¼åæ»æ¥å¿é½éè¦ä¿å­ï¼å¯¼è´å ç¨å¤§éå­å¨ç©ºé´ã\n\n\n\n\n# å¿«ç§è¯»åå½åè¯»\n\nå¿«ç§è¯»ï¼å°±æ¯å½è¿è¡æ¥è¯¢æ¶ï¼æ¯æ ¹æ® read view çè§å¾å¯è§æ§æ¥è¯»åå¯¹åºçæ¬çæ°æ®ã\n\næè¿ä¹ä¸ä¸ªåºæ¯ï¼å½åæ¯å¯éå¤è¯»çéç¦»çå«ï¼å¼å§äºå¡çé¡ºåºåå«æ¯ aãbãcï¼äºå¡ c æ´æ° k ä¹åï¼ææ°ççæ¬ 102ï¼å½äºå¡ bï¼æ ¹æ® read view æ¯çä¸å° 102 çæ¬çæ°æ®ï¼é£ä¹å¶æ´æ°åªè½å¨ 90 çæ¬ä¸å»+1ï¼è¿æ ·çç»æè¯å®æ¯ä¸å¯¹çï¼å ä¸ºä¸æ¯å¨ææ°çç»æä¸è¿è¡+1ï¼æä»¥è¿ééè¦ç¨å° å½åè¯»ï¼ä¹å°±æ¯å»è¯»åå½åæ°æ®çææ°çæ¬çæ°æ®ï¼ç¶ååè¿è¡+1ãè¯¥å½åè¯»ä¼å¯¹è¯¥è¡æ°æ®è¿è¡å éï¼å¨è¯¥äºå¡ commit ä¹åï¼å¶ä»äºå¡é½ä¸è½å¯¹å¶è¿è¡æä½ã\n\n\n\n\n# ç¸å³é¾æ¥\n\n * https://blog.csdn.net/siesta030/article/details/123113437\n * https://blog.csdn.net/huaishu/article/details/89924250",charsets:{cjk:!0},lastUpdated:"2023/11/01, 11:48:43",lastUpdatedTimestamp:1698810523e3},{title:"kube-proxyæºç åæ",frontmatter:{title:"kube-proxyæºç åæ",date:"2024-01-18T16:43:23.000Z",permalink:"/pages/6e0045/",categories:["äºåç","k8s"],tags:["k8s","æºç åæ","go"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä¸»è¦æ¯å¯¹kube-proxyçæºç åæï¼äºè§£å¶ä»£ç ç»æåå®ç°åçãè¿éæ¯æ ¹æ®[kubernetes1.23.9](https://github.com/kubernetes/kubernetes/tree/v1.23.9)çæ¬æ¥è¿è¡åæçãå¨ä¸é¢è´´ä¸çä»£ç ä¼ä¸å®è£åªï¼ä¸»è¦ç¨äºçè§£ä¸»æµç¨ã",comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/image-20240118162033-mma8vs8.png"},{name:"twitter:title",content:"kube-proxyæºç åæ"},{name:"twitter:description",content:"æ¬æä¸»è¦æ¯å¯¹kube-proxyçæºç åæï¼äºè§£å¶ä»£ç ç»æåå®ç°åçãè¿éæ¯æ ¹æ®[kubernetes1.23.9](https://github.com/kubernetes/kubernetes/tree/v1.23.9)çæ¬æ¥è¿è¡åæçãå¨ä¸é¢è´´ä¸çä»£ç ä¼ä¸å®è£åªï¼ä¸»è¦ç¨äºçè§£ä¸»æµç¨ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/image-20240118162033-mma8vs8.png"},{name:"twitter:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/17.kube-proxy%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html"},{property:"og:type",content:"article"},{property:"og:title",content:"kube-proxyæºç åæ"},{property:"og:description",content:"æ¬æä¸»è¦æ¯å¯¹kube-proxyçæºç åæï¼äºè§£å¶ä»£ç ç»æåå®ç°åçãè¿éæ¯æ ¹æ®[kubernetes1.23.9](https://github.com/kubernetes/kubernetes/tree/v1.23.9)çæ¬æ¥è¿è¡åæçãå¨ä¸é¢è´´ä¸çä»£ç ä¼ä¸å®è£åªï¼ä¸»è¦ç¨äºçè§£ä¸»æµç¨ã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/image-20240118162033-mma8vs8.png"},{property:"og:url",content:"https://www.msqfx.cc/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/17.kube-proxy%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2024-01-18T16:43:23.000Z"},{property:"article:tag",content:"k8s"},{property:"article:tag",content:"æºç åæ"},{property:"article:tag",content:"go"},{itemprop:"name",content:"kube-proxyæºç åæ"},{itemprop:"description",content:"æ¬æä¸»è¦æ¯å¯¹kube-proxyçæºç åæï¼äºè§£å¶ä»£ç ç»æåå®ç°åçãè¿éæ¯æ ¹æ®[kubernetes1.23.9](https://github.com/kubernetes/kubernetes/tree/v1.23.9)çæ¬æ¥è¿è¡åæçãå¨ä¸é¢è´´ä¸çä»£ç ä¼ä¸å®è£åªï¼ä¸»è¦ç¨äºçè§£ä¸»æµç¨ã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/image-20240118162033-mma8vs8.png"}],readingShow:"top"},regularPath:"/01.%E4%BA%91%E5%8E%9F%E7%94%9F/07.k8s/17.kube-proxy%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html",relativePath:"01.äºåç/07.k8s/17.kube-proxyæºç åæ.md",key:"v-079101b0",path:"/pages/6e0045/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:21},{level:2,title:"åå§å",slug:"åå§å",normalizedTitle:"åå§å",charIndex:119},{level:2,title:"Run",slug:"run",normalizedTitle:"run",charIndex:225},{level:2,title:"service å endpointslice åæ´äºä»¶",slug:"service-å-endpointslice-åæ´äºä»¶",normalizedTitle:"service å endpointslice åæ´äºä»¶",charIndex:12013},{level:2,title:"BoundedFrequencyRunner",slug:"boundedfrequencyrunner",normalizedTitle:"boundedfrequencyrunner",charIndex:9187},{level:2,title:"syncProxyRules",slug:"syncproxyrules",normalizedTitle:"syncproxyrules",charIndex:9117},{level:2,title:"æ»ç»",slug:"æ»ç»",normalizedTitle:"æ»ç»",charIndex:19890},{level:2,title:"ç¸å³é¾æ¥",slug:"ç¸å³é¾æ¥",normalizedTitle:"ç¸å³é¾æ¥",charIndex:20381}],headersStr:"ç®ä» åå§å Run service å endpointslice åæ´äºä»¶ BoundedFrequencyRunner syncProxyRules æ»ç» ç¸å³é¾æ¥",content:'# kube-proxyæºç åæ\n\n\n# ç®ä»\n\næ¬æä¸»è¦æ¯å¯¹kube-proxyçæºç åæï¼äºè§£å¶ä»£ç ç»æåå®ç°åçãè¿éæ¯æ ¹æ®kubernetes1.23.9çæ¬æ¥è¿è¡åæçãå¨ä¸é¢è´´ä¸çä»£ç ä¼ä¸å®è£åªï¼ä¸»è¦ç¨äºçè§£ä¸»æµç¨ã\n\n\n# åå§å\n\nkube-proxyå¥å£æä»¶å¨cmd/kube-proxy/proxy.go\n\nfunc main() {\n\tcommand := app.NewProxyCommand()\n\tcode := cli.Run(command)\n\tos.Exit(code)\n}\n\n\n1\n2\n3\n4\n5\n\n\næ¥çapp.NewProxyCommand()æ¹æ³ï¼ä½¿ç¨çcobraå½ä»¤è¡è§£æåºæ¥ä½ä¸ºç¨åºå¥å£\n\nfunc NewProxyCommand() *cobra.Command {\n\topts := NewOptions()\n\n\tcmd := &cobra.Command{\n\t\tUse: "kube-proxy",\n\t\tLong: `The Kubernetes network proxy runs on each node. This\nreflects services as defined in the Kubernetes API on each node and can do simple\nTCP, UDP, and SCTP stream forwarding or round robin TCP, UDP, and SCTP forwarding across a set of backends.\nService cluster IPs and ports are currently found through Docker-links-compatible\nenvironment variables specifying ports opened by the service proxy. There is an optional\naddon that provides cluster DNS for these cluster IPs. The user must create a service\nwith the apiserver API to configure the proxy.`,\n\t\tRunE: func(cmd *cobra.Command, args []string) error {\n\t\t\tverflag.PrintAndExitIfRequested()\n\t\t\tcliflag.PrintFlags(cmd.Flags())\n\n\t\t\tif err := initForOS(opts.WindowsService); err != nil {\n\t\t\t\treturn fmt.Errorf("failed os init: %w", err)\n\t\t\t}\n\n\t\t\t// 1. å è½½éç½®æä»¶kubeproxyconfig.KubeProxyConfiguration\n\t\t\t// 2. çæ§æä»¶åå\n\t\t\tif err := opts.Complete(); err != nil {\n\t\t\t\treturn fmt.Errorf("failed complete: %w", err)\n\t\t\t}\n\n\t\t\t// éç½®åæ°çæ ¡éª\n\t\t\tif err := opts.Validate(); err != nil {\n\t\t\t\treturn fmt.Errorf("failed validate: %w", err)\n\t\t\t}\n\n\t\t\t// è¿è¡æå¡\n\t\t\tif err := opts.Run(); err != nil {\n\t\t\t\tklog.ErrorS(err, "Error running ProxyServer")\n\t\t\t\treturn err\n\t\t\t}\n\n\t\t\treturn nil\n\t\t},\n\t\tArgs: func(cmd *cobra.Command, args []string) error {\n\t\t\tfor _, arg := range args {\n\t\t\t\tif len(arg) > 0 {\n\t\t\t\t\treturn fmt.Errorf("%q does not take any arguments, got %q", cmd.CommandPath(), args)\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn nil\n\t\t},\n\t}\n\n\tvar err error\n    // å¡«åä¸äºé»è®¤éç½®\n\topts.config, err = opts.ApplyDefaults(opts.config)\n\tif err != nil {\n\t\tklog.ErrorS(err, "Unable to create flag defaults")\n\t\t// ACTION REQUIRED: Exit code changed from 255 to 1\n\t\tos.Exit(1)\n\t}\n\n\tfs := cmd.Flags()\n\topts.AddFlags(fs)\n\t// å°goçå½ä»¤è¡åæ°ä¹å å°å½ä»¤è¡åæ°ä¸­\n\tfs.AddGoFlagSet(goflag.CommandLine) // for --boot-id-file and --machine-id-file\n\n\t_ = cmd.MarkFlagFilename("config", "yaml", "yml", "json")\n\n\treturn cmd\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n\n 1. è¯»åéç½®æä»¶KubeProxyConfigurationï¼å¹¶çå¬ååæ¶å°å¯¹åºçäºä»¶\n 2. å¯¹éç½®KubeProxyConfigurationè¿è¡æ ¡éª\n 3. å¯å¨æå¡\n\nåæ¥çopts.Run() æå¡å¯å¨çå®ç°\n\nfunc (o *Options) Run() error {\n\tdefer close(o.errCh)\n\n    // å¦æéç½®äºè¯¥å­æ®µï¼å°éç½®æä»¶åå¥æå®ä½ç½®ï¼ç¶åéåº\n\tif len(o.WriteConfigTo) > 0 {\n\t\treturn o.writeConfigFile()\n\t}\n\n    // åå»ºä»£çæå¡\n\tproxyServer, err := NewProxyServer(o)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t// æ¸é¤ææçiptablesè§å\n\tif o.CleanupAndExit {\n\t\treturn proxyServer.CleanupAndExit()\n\t}\n\n\t// å¯å¨ä»£çæå¡\n\to.proxyServer = proxyServer\n\treturn o.runLoop()\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nåçNewProxyServer() çå®ç°ï¼ä¸»è¦æ¯ç¨æ¥åå»ºproxyServerå¯¹è±¡ï¼å¹¶ä¸å¨å¶ä¸­æ ¹æ®å½åçç½ç»æ¨¡å¼ï¼éè¿iptables.NewProxieræ¥åå»ºproxierå¯¹è±¡ã\n\nfunc NewProxyServer(o *Options) (*ProxyServer, error) {\n\treturn newProxyServer(o.config, o.CleanupAndExit, o.master)\n}\n\nfunc newProxyServer(\n\tconfig *proxyconfigapi.KubeProxyConfiguration,\n\tcleanupAndExit bool,\n\tmaster string) (*ProxyServer, error) {\n\n\t// æ§è¡æ¬å°å½ä»¤çæ§å¶å¨\n\texecer := exec.New()\n\n\tkernelHandler = ipvs.NewLinuxKernelHandler() \n    // åå»ºipsetå½ä»¤çæ§è¡å¨\n\tipsetInterface = utilipset.New(execer)\n    // å¤æ­æ¯å¦æ¯æipvs\n\tcanUseIPVS, err := ipvs.CanUseIPVSProxier(kernelHandler, ipsetInterface, config.IPVS.Scheduler)\n\tif string(config.Mode) == proxyModeIPVS && err != nil {\n\t\tklog.ErrorS(err, "Can\'t use the IPVS proxier")\n\t}\n\n\tif canUseIPVS {\n        // å¦ææ¯æçè¯ï¼åå»ºipvsæ§è¡å¨\n\t\tipvsInterface = utilipvs.New()\n\t}\n\n\t// åå»ºäºä»¶è®°å½å¨\n\teventBroadcaster := events.NewBroadcaster(&events.EventSinkImpl{Interface: client.EventsV1()})\n\trecorder := eventBroadcaster.NewRecorder(scheme.Scheme, "kube-proxy")\n\n\t// åå»ºå¥åº·æ£æ¥æå¡\n\tvar healthzServer healthcheck.ProxierHealthUpdater\n\tif len(config.HealthzBindAddress) > 0 {\n\t\thealthzServer = healthcheck.NewProxierHealthServer(config.HealthzBindAddress, 2*config.IPTables.SyncPeriod.Duration, recorder, nodeRef)\n\t}\n\n    // è·åå½åçä»£çæ¨¡å¼\n\tproxyMode := getProxyMode(string(config.Mode), canUseIPVS, iptables.LinuxKernelCompatTester{})\n\t\n    // è·åå½åçä¸»è¦çIPåè®®\n\tprimaryProtocol := utiliptables.ProtocolIPv4\n\tif netutils.IsIPv6(nodeIP) {\n\t\tprimaryProtocol = utiliptables.ProtocolIPv6\n\t}\n\n\t// åå»ºiptablesæ§è¡å¨\n\tiptInterface = utiliptables.New(execer, primaryProtocol)\n\n\t// å¯è½æ¯æipv4åipv6ä¸¤ç§æ§è¡å¨\n\tvar ipt [2]utiliptables.Interface\n\tdualStack := true // While we assume that node supports, we do further checks below\n\n\t// å¦ææ¯æçæ¯iptablesæ¨¡å¼\n\tif proxyMode == proxyModeIPTables {\n\n\t\t// åç«¯æ¨¡å¼ï¼æ¯æIP4åIPV6\n\t\tif dualStack {\n\t\t\tproxier, err = iptables.NewDualStackProxier(\n\t\t\t\tipt,\n\t\t\t\tutilsysctl.New(),\n\t\t\t\texecer,\n\t\t\t\tconfig.IPTables.SyncPeriod.Duration,\n\t\t\t\tconfig.IPTables.MinSyncPeriod.Duration,\n\t\t\t\tconfig.IPTables.MasqueradeAll,\n\t\t\t\tint(*config.IPTables.MasqueradeBit),\n\t\t\t\tlocalDetectors,\n\t\t\t\thostname,\n\t\t\t\tnodeIPTuple(config.BindAddress),\n\t\t\t\trecorder,\n\t\t\t\thealthzServer,\n\t\t\t\tconfig.NodePortAddresses,\n\t\t\t)\n\t\t} else {\n\t\t\tproxier, err = iptables.NewProxier(\n\t\t\t\tiptInterface,\n\t\t\t\tutilsysctl.New(),\n\t\t\t\texecer,\n\t\t\t\tconfig.IPTables.SyncPeriod.Duration,\n\t\t\t\tconfig.IPTables.MinSyncPeriod.Duration,\n\t\t\t\tconfig.IPTables.MasqueradeAll,\n\t\t\t\tint(*config.IPTables.MasqueradeBit),\n\t\t\t\tlocalDetector,\n\t\t\t\thostname,\n\t\t\t\tnodeIP,\n\t\t\t\trecorder,\n\t\t\t\thealthzServer,\n\t\t\t\tconfig.NodePortAddresses,\n\t\t\t)\n\t\t}\n\n\t\tif err != nil {\n\t\t\treturn nil, fmt.Errorf("unable to create proxier: %v", err)\n\t\t}\n\t\tproxymetrics.RegisterMetrics()\n\n\telse if proxyMode == proxyModeIPVS {\n\t\t...\n\t}\n\n\treturn &ProxyServer{\n\t\tClient:                 client,\n\t\tEventClient:            eventClient,\n\t\tIptInterface:           iptInterface,\n\t\tIpvsInterface:          ipvsInterface,\n\t\tIpsetInterface:         ipsetInterface,\n\t\texecer:                 execer,\n\t\tProxier:                proxier,\n\t\tBroadcaster:            eventBroadcaster,\n\t\tRecorder:               recorder,\n\t\tConntrackConfiguration: config.Conntrack,\n\t\tConntracker:            &realConntracker{},\n\t\tProxyMode:              proxyMode,\n\t\tNodeRef:                nodeRef,\n\t\tMetricsBindAddress:     config.MetricsBindAddress,\n\t\tBindAddressHardFail:    config.BindAddressHardFail,\n\t\tEnableProfiling:        config.EnableProfiling,\n\t\tOOMScoreAdj:            config.OOMScoreAdj,\n\t\tConfigSyncPeriod:       config.ConfigSyncPeriod.Duration,\n\t\tHealthzServer:          healthzServer,\n\t\tUseEndpointSlices:      useEndpointSlices,\n\t}, nil\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n\n\nåæ¥çiptables.NewProxier() æ¹æ³\n\nfunc NewProxier(ipt utiliptables.Interface,\n\tsysctl utilsysctl.Interface,\n\texec utilexec.Interface,\n\tsyncPeriod time.Duration,\n\tminSyncPeriod time.Duration,\n\tmasqueradeAll bool,\n\tmasqueradeBit int,\n\tlocalDetector proxyutiliptables.LocalTrafficDetector,\n\thostname string,\n\tnodeIP net.IP,\n\trecorder events.EventRecorder,\n\thealthzServer healthcheck.ProxierHealthUpdater,\n\tnodePortAddresses []string,\n) (*Proxier, error) {\n\n\t// è¿ä¸ªå°±æ¯0x4000ï¼ä¹å°±æ¯ç»æ°æ®åæä¸æ è®°ï¼å¨åºä¸»æºçæ¶åä¼è¿è¡SNAT\n\tmasqueradeValue := 1 << uint(masqueradeBit)\n\tmasqueradeMark := fmt.Sprintf("%#08x", masqueradeValue)\n\n    // åå»ºå¥åº·æ£æ¥æå¡\n\tserviceHealthServer := healthcheck.NewServiceHealthServer(hostname, recorder, nodePortAddresses)\n\n\tproxier := &Proxier{\n\t\tserviceMap:               make(proxy.ServiceMap),\n\t\tserviceChanges:           proxy.NewServiceChangeTracker(newServiceInfo, ipFamily, recorder, nil),\n\t\tendpointsMap:             make(proxy.EndpointsMap),\n\t\tendpointsChanges:         proxy.NewEndpointChangeTracker(hostname, newEndpointInfo, ipFamily, recorder, nil),\n\t\tsyncPeriod:               syncPeriod,\n\t\tiptables:                 ipt,\n\t\tmasqueradeAll:            masqueradeAll,\n\t\tmasqueradeMark:           masqueradeMark,\n\t\texec:                     exec,\n\t\tlocalDetector:            localDetector,\n\t\thostname:                 hostname,\n\t\tnodeIP:                   nodeIP,\n\t\trecorder:                 recorder,\n\t\tserviceHealthServer:      serviceHealthServer,\n\t\thealthzServer:            healthzServer,\n\t\tprecomputedProbabilities: make([]string, 0, 1001),\n\t\tiptablesData:             bytes.NewBuffer(nil),\n\t\texistingFilterChainsData: bytes.NewBuffer(nil),\n\t\tfilterChains:             utilproxy.LineBuffer{},\n\t\tfilterRules:              utilproxy.LineBuffer{},\n\t\tnatChains:                utilproxy.LineBuffer{},\n\t\tnatRules:                 utilproxy.LineBuffer{},\n\t\tnodePortAddresses:        nodePortAddresses,\n\t\tnetworkInterfacer:        utilproxy.RealNetwork{},\n\t}\n\n\tburstSyncs := 2\n    // syncRunneræ¯ç¨æ¥æ§å¶å·æ°iptablesè§åé¢ççè¿è¡å¨ï¼proxier.syncProxyRulesæ¹æ³å°±æ¯çæ­£å·æ°iptablesè§åçæ¹æ³\n   \tproxier.syncRunner = async.NewBoundedFrequencyRunner("sync-runner", proxier.syncProxyRules, minSyncPeriod, time.Hour, burstSyncs)\n\n\t// è¿éå¯ç¨ä¸ä¸ªgoroutineãå¨ä¸ä¸ªè¡¨ä¸­é½åå»ºä¸ä¸ªKUBE-PROXY-CANARYå­é¾ï¼éè¿å­é¾æ¯å¦å­å¨æ¥å¤æ­iptablesæ¯å¦è¢«å·æã\n\t// å¦æè¯¥é¾ä¸å­å¨ï¼è¯´æiptablesè¢«å·æäºï¼åæ¬¡æ§è¡syncProxyRulesæ¹æ³å·åæ¥ã\n\tgo ipt.Monitor(kubeProxyCanaryChain, []utiliptables.Table{utiliptables.TableMangle, utiliptables.TableNAT, utiliptables.TableFilter},\n\t\tproxier.syncProxyRules, syncPeriod, wait.NeverStop)\n\treturn proxier, nil\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n\n\nä»¥ä¸ä¸»è¦çå¯¹è±¡å·²ç»åå§åå®æäºã\n\n\n# Run\n\nåå°o.Run() æ¹æ³ä¸­ï¼åæ¯åå»ºProxyServerå¯¹è±¡ï¼ç¶åå¨å¶ä¸­ååå»ºproxierå¯¹è±¡ï¼åäºä¸ç³»ååå§åå¨ä½ï¼æ¥ä¸æ¥å°±æ¯è¿è¡ä»£çæå¡äºï¼ç°å¨çårunLoop æ¹æ³\n\nfunc (o *Options) runLoop() error {\n\t// å¼å¯æä»¶çå¬\n\tif o.watcher != nil {\n\t\to.watcher.Run()\n\t}\n\n\t// run the proxy in goroutine\n\tgo func() {\n\t\terr := o.proxyServer.Run()\n\t\to.errCh <- err\n\t}()\n\n    // å¦ææ¥åå°errChååæ­¢æå¡\n\tfor {\n\t\terr := <-o.errCh\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nåçåo.proxyServer.Run() æ¹æ³ï¼è¿è¡ä»£çæå¡çä¸»æµç¨ã\n\nfunc (s *ProxyServer) Run() error {\n\t// è®¾ç½®å½åè¿ç¨çOOMåæ°ï¼èµæºç´§å¼ æ¶ï¼ä¸ä¼åkillækube-proxy\n\tvar oomAdjuster *oom.OOMAdjuster\n\tif s.OOMScoreAdj != nil {\n\t\toomAdjuster = oom.NewOOMAdjuster()\n\t\tif err := oomAdjuster.ApplyOOMScoreAdj(0, int(*s.OOMScoreAdj)); err != nil {\n\t\t\tklog.V(2).InfoS("Failed to apply OOMScore", "err", err)\n\t\t}\n\t}\n\n\t// å¼å¯å¥åº·æ£æ¥æå¡\n\tserveHealthz(s.HealthzServer, errCh)\n\n\t// å¼å¯ææ ä¸æ¥æå¡\n\tserveMetrics(s.MetricsBindAddress, s.ProxyMode, s.EnableProfiling, errCh)\n\n\t// åå»ºinformer\n\tinformerFactory := informers.NewSharedInformerFactoryWithOptions(s.Client, s.ConfigSyncPeriod,\n\t\tinformers.WithTweakListOptions(func(options *metav1.ListOptions) {\n\t\t\toptions.LabelSelector = labelSelector.String()\n\t\t}))\n\n\t// çå¬serviceåendpointå¹¶æ³¨åäºä»¶ï¼å½åçååæ¶ï¼åä¼è¿è¡å·æ°iptablesè§å\n\tserviceConfig := config.NewServiceConfig(informerFactory.Core().V1().Services(), s.ConfigSyncPeriod)\n\tserviceConfig.RegisterEventHandler(s.Proxier)\n\tgo serviceConfig.Run(wait.NeverStop)\n\n\tif endpointsHandler, ok := s.Proxier.(config.EndpointsHandler); ok && !s.UseEndpointSlices {\n\t\tendpointsConfig := config.NewEndpointsConfig(informerFactory.Core().V1().Endpoints(), s.ConfigSyncPeriod)\n\t\tendpointsConfig.RegisterEventHandler(endpointsHandler)\n\t\tgo endpointsConfig.Run(wait.NeverStop)\n\t} else {\n\t\tendpointSliceConfig := config.NewEndpointSliceConfig(informerFactory.Discovery().V1().EndpointSlices(), s.ConfigSyncPeriod)\n\t\tendpointSliceConfig.RegisterEventHandler(s.Proxier)\n\t\tgo endpointSliceConfig.Run(wait.NeverStop)\n\t}\n\n\tinformerFactory.Start(wait.NeverStop)\n\n\t// åéå¯å¨äºä»¶\n\ts.birthCry()\n\n\tgo s.Proxier.SyncLoop()\n\n\treturn <-errCh\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n\n\n\n# service å endpointslice åæ´äºä»¶\n\nç¨åºä¸­æ¯éè¿informeræ¥å®ç°å¯¹serviceåendpointåçååççå¬ï¼æç¥ååï¼å¹¶è§¦åäºä»¶å¹¶è¿è¡ç¸åºçå¤çã\n\nåçä¸ä¸NewServiceConfig() æ¹æ³ï¼å¶ä¸­æ³¨åäºå½serviceåçå¢ãå ãæ¹äºä»¶æ¶ï¼åå«æ§è¡result.handleAddService ãresult.handleUpdateService ãresult.handleDeleteService æ¹æ³ã\n\nfunc NewServiceConfig(serviceInformer coreinformers.ServiceInformer, resyncPeriod time.Duration) *ServiceConfig {\n\tresult := &ServiceConfig{\n\t\tlisterSynced: serviceInformer.Informer().HasSynced,\n\t}\n\n\t// æ³¨ååæ´äºä»¶\n\tserviceInformer.Informer().AddEventHandlerWithResyncPeriod(\n\t\tcache.ResourceEventHandlerFuncs{\n\t\t\tAddFunc:    result.handleAddService,\n\t\t\tUpdateFunc: result.handleUpdateService,\n\t\t\tDeleteFunc: result.handleDeleteService,\n\t\t},\n\t\tresyncPeriod,\n\t)\n\n\treturn result\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nåççå¶ä¸­çhandleAddService() æ¹æ³ï¼ä¼ å¥çåæ°objå°±æ¯æ°å¢çserviceå¯¹è±¡ï¼ç¶åä¼ å¥eventHandler.OnServiceAdd()æ¹æ³è¿è¡å¤çã\n\nfunc (c *ServiceConfig) handleAddService(obj interface{}) {\n\tservice, ok := obj.(*v1.Service)\n\tif !ok {\n\t\tutilruntime.HandleError(fmt.Errorf("unexpected object type: %v", obj))\n\t\treturn\n\t}\n\tfor i := range c.eventHandlers {\n\t\tklog.V(4).InfoS("Calling handler.OnServiceAdd")\n\t\tc.eventHandlers[i].OnServiceAdd(service)\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nè¿éc.eventHanlderså¶å®å°±æ¯proxierå¯¹è±¡ï¼å¨RegisterEventHandler()æ¹æ³ä¸­å°å¶æ·»å è¿å»çã\n\nserviceConfig.RegisterEventHandler(s.Proxier)\n\n\n1\n\n\nä¹å°±æ¯è¯´ï¼proxier.OnServiceAdd()ææ¯éè¦è§¦åçå¤çæ¹æ³\n\nfunc (proxier *Proxier) OnServiceAdd(service *v1.Service) {\n\tproxier.OnServiceUpdate(nil, service)\n}\n\n\n1\n2\n3\n\n\nç¬¬ä¸ä¸ªåæ°ä¸ºæ§çserviceï¼ç¬¬äºåæ°ä¸ºæ°çåæ°ãè¯¥æ¹æ³ç»å¯ä»¥OnServiceAdd å¤ç¨ï¼ä¼ å¥çç¬¬ä¸ä¸ªåæ°ä¸ºnilï¼ç¬¬äºä¸ªåæ°ä¸ä¸ºnilï¼å°±æ¯æ°å¢çæä½ã\n\nfunc (proxier *Proxier) OnServiceUpdate(oldService, service *v1.Service) {\n\tif proxier.serviceChanges.Update(oldService, service) && proxier.isInitialized() {\n\t\tproxier.Sync()\n\t}\n}\n\n\n1\n2\n3\n4\n5\n\n\nè¿å¯ä»¥çå°å é¤æä½ä¹è½å¤ç¨ï¼ææ§çserviceï¼èæ°serviceä¸ºnilä»£è¡¨å é¤ã\n\n// OnServiceDelete is called whenever deletion of an existing service\n// object is observed.\nfunc (proxier *Proxier) OnServiceDelete(service *v1.Service) {\n\tproxier.OnServiceUpdate(service, nil)\n}\n\n\n1\n2\n3\n4\n5\n\n\næ è®ºæ¯å¢ãå ãæ¹é½ä¼æ§è¡å°proxier.Sync()æ¹æ³\n\nfunc (proxier *Proxier) Sync() {\n\tif proxier.healthzServer != nil {\n\t\tproxier.healthzServer.QueuedUpdate()\n\t}\n\tmetrics.SyncProxyRulesLastQueuedTimestamp.SetToCurrentTime()\n\tproxier.syncRunner.Run()\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næç»å°proxier.syncRunner.Run() æ¹æ³ï¼å¯ä»¥çåºå®ä¼åéä¸ä¸ªä¿¡å·å°bfr.runç®¡éä¸­ãè¯¥æ¹æ³é¤äºæ¯serviceåçäºä»¶æ§è¡æä½çç»ç¹å¤ï¼endpointåçäºä»¶åæç»ä¹ä¼æ§è¡å°è¿éã\n\nfunc (bfr *BoundedFrequencyRunner) Run() {\n\t// If it takes a lot of time to run the underlying function, noone is really\n\t// processing elements from <run> channel. So to avoid blocking here on the\n\t// putting element to it, we simply skip it if there is already an element\n\t// in it.\n\tselect {\n\tcase bfr.run <- struct{}{}:\n\tdefault:\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# BoundedFrequencyRunner\n\næä»¬ååå°ä»£çæå¡çProxyServe.Run æ¹æ³ï¼æåæ§è¡äºs.Proxier.SyncLoop()\n\nfunc (proxier *Proxier) SyncLoop() {\n\t// Update healthz timestamp at beginning in case Sync() never succeeds.\n\tif proxier.healthzServer != nil {\n\t\tproxier.healthzServer.Updated()\n\t}\n\n\t// synthesize "last change queued" time as the informers are syncing.\n\tmetrics.SyncProxyRulesLastQueuedTimestamp.SetToCurrentTime()\n\tproxier.syncRunner.Loop(wait.NeverStop)\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nç¶ååæ§è¡proxier.syncRunner.Loop() æ¹æ³\n\nfunc (bfr *BoundedFrequencyRunner) Loop(stop <-chan struct{}) {\n\tklog.V(3).Infof("%s Loop running", bfr.name)\n\tbfr.timer.Reset(bfr.maxInterval)\n\tfor {\n\t\tselect {\n\t\tcase <-stop:\n\t\t\tbfr.stop()\n\t\t\tklog.V(3).Infof("%s Loop stopping", bfr.name)\n\t\t\treturn\n\t\tcase <-bfr.timer.C():\n\t\t\tbfr.tryRun()\n\t\tcase <-bfr.run:\n\t\t\tbfr.tryRun()\n\t\tcase <-bfr.retry:\n\t\t\tbfr.doRetry()\n\t\t}\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nå¯ä»¥çå°å¦æbfr.runç®¡éæ¥æ¶å°äºä¿¡å·ï¼ä¼æ§è¡brf.tryRun() æ¹æ³ï¼å¨è¿ä¸ªæ¹æ³ä¸­ä¼æ§è¡proxier.syncProxyRules() è¿è¡å·æ°iptablesè§åã\n\n// assumes the lock is not held\nfunc (bfr *BoundedFrequencyRunner) tryRun() {\n\tbfr.mu.Lock()\n\tdefer bfr.mu.Unlock()\n\n    // è¿éä¼éå¶è®¿é®éçï¼çæ¯å¦å¯ä»¥æ§è¡ã\n\tif bfr.limiter.TryAccept() {\n        // è¿éçfnå°±æ¯proxier.syncProxyRulesæ¹æ³\n\t\tbfr.fn()\n\t\tbfr.lastRun = bfr.timer.Now()\n\t\tbfr.timer.Stop()\n\t\tbfr.timer.Reset(bfr.maxInterval)\n\t\tklog.V(3).Infof("%s: ran, next possible in %v, periodic in %v", bfr.name, bfr.minInterval, bfr.maxInterval)\n\t\treturn\n\t}\n\n\t// It can\'t run right now, figure out when it can run next.\n\telapsed := bfr.timer.Since(bfr.lastRun)   // how long since last run\n\tnextPossible := bfr.minInterval - elapsed // time to next possible run\n\tnextScheduled := bfr.timer.Remaining()    // time to next scheduled run\n\tklog.V(4).Infof("%s: %v since last run, possible in %v, scheduled in %v", bfr.name, elapsed, nextPossible, nextScheduled)\n\n\t// It\'s hard to avoid race conditions in the unit tests unless we always reset\n\t// the timer here, even when it\'s unchanged\n\tif nextPossible < nextScheduled {\n\t\tnextScheduled = nextPossible\n\t}\n\tbfr.timer.Stop()\n\tbfr.timer.Reset(nextScheduled)\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\n\n# syncProxyRules\n\nè¯¥æ¹æ³ä¸»è¦æ¯æ´æ°èç¹ä¸çiptablesè§åã\n\nfunc (proxier *Proxier) syncProxyRules() {\n\n\t// è·åserviceåendpointåçååçæ°æ®\n\tserviceUpdateResult := proxier.serviceMap.Update(proxier.serviceChanges)\n\tendpointUpdateResult := proxier.endpointsMap.Update(proxier.endpointsChanges)\n\n\n\t// åå»ºä¸äºå¿è¦çiptablesé¾\n\tfor _, jump := range iptablesJumpChains {\n\t\tif _, err := proxier.iptables.EnsureChain(jump.table, jump.dstChain); err != nil {\n\t\t\tklog.ErrorS(err, "Failed to ensure chain exists", "table", jump.table, "chain", jump.dstChain)\n\t\t\treturn\n\t\t}\n\t\targs := append(jump.extraArgs,\n\t\t\t"-m", "comment", "--comment", jump.comment,\n\t\t\t"-j", string(jump.dstChain),\n\t\t)\n\t\tif _, err := proxier.iptables.EnsureRule(utiliptables.Prepend, jump.table, jump.srcChain, args...); err != nil {\n\t\t\tklog.ErrorS(err, "Failed to ensure chain jumps", "table", jump.table, "srcChain", jump.srcChain, "dstChain", jump.dstChain)\n\t\t\treturn\n\t\t}\n\t}\n\n\tfor _, ch := range iptablesEnsureChains {\n\t\tif _, err := proxier.iptables.EnsureChain(ch.table, ch.chain); err != nil {\n\t\t\tklog.ErrorS(err, "Failed to ensure chain exists", "table", ch.table, "chain", ch.chain)\n\t\t\treturn\n\t\t}\n\t}\n\n\t// å°å½åfilterè¡¨ä¸­ææå­å¨çè§ååå¥existingFilterChainsDataä¸­\n\tproxier.existingFilterChainsData.Reset()\n\terr := proxier.iptables.SaveInto(utiliptables.TableFilter, proxier.existingFilterChainsData)\n\n\t// å°natè¡¨ä¸­ææå­å¨çè§ååå¥iptablesDataä¸­\n\tproxier.iptablesData.Reset()\n\terr = proxier.iptables.SaveInto(utiliptables.TableNAT, proxier.iptablesData)\n\n\t// å°filterånaté¾ä¸­å¿è¦æ·»å çå­é¾ï¼éè¿å­ç¬¦ä¸²æ¼æ¥çæ¹å¼åå¥åéfilterChainsånatChainsä¸­\n\tfor _, chainName := range []utiliptables.Chain{kubeServicesChain, kubeExternalServicesChain, kubeForwardChain, kubeNodePortsChain} {\n\t\tif chain, ok := existingFilterChains[chainName]; ok {\n\t\t\tproxier.filterChains.WriteBytes(chain)\n\t\t} else {\n\t\t\tproxier.filterChains.Write(utiliptables.MakeChainLine(chainName))\n\t\t}\n\t}\n\tfor _, chainName := range []utiliptables.Chain{kubeServicesChain, kubeNodePortsChain, kubePostroutingChain, KubeMarkMasqChain} {\n\t\tif chain, ok := existingNATChains[chainName]; ok {\n\t\t\tproxier.natChains.WriteBytes(chain)\n\t\t} else {\n\t\t\tproxier.natChains.Write(utiliptables.MakeChainLine(chainName))\n\t\t}\n\t}\n\n\t// åé¢å°±æ¯å°åç§çiptablesè§åéè¿å­ç¬¦ä¸²æ¼æ¥èµ·æ¥\n    ...\n\n\t// å°ææé¾åè§åçiptableså¨é¨éæå°ä¸èµ·iptablesDataï¼ç¶ååéè¿iptables-restoreå½ä»¤å·æ°å°èç¹ä¸­ã\n\tproxier.iptablesData.Reset()\n\tproxier.iptablesData.Write(proxier.filterChains.Bytes())\n\tproxier.iptablesData.Write(proxier.filterRules.Bytes())\n\tproxier.iptablesData.Write(proxier.natChains.Bytes())\n\tproxier.iptablesData.Write(proxier.natRules.Bytes())\n\terr = proxier.iptables.RestoreAll(proxier.iptablesData.Bytes(), utiliptables.NoFlushTables, utiliptables.RestoreCounters)\n\tif err != nil {\n\t\tklog.ErrorS(err, "Failed to execute iptables-restore")\n\t\tmetrics.IptablesRestoreFailuresTotal.Inc()\n\t\treturn\n\t}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n\n\næ»ç»\n\n 1. è·ååçåæ´ç service å endpoint ä¿¡æ¯\n 2. åå»ºä¸äºå¿è¦çé¾\n 3. ä½¿ç¨ iptables-save å½ä»¤ï¼å°å½åç¯å¢ä¸­ nat å filter è¡¨ä¸­ç iptables è§åå¨é¨å è½½å°ç¨åºä¸­ã\n 4. éè¿æ¼æ¥å­ç¬¦ä¸²ï¼æé åºéè¦åå»ºç iptables è§åå­ç¬¦ä¸²ã\n 5. éè¿ iptables-restore å½ä»¤ï¼å°æé ç iptables è§åå­ç¬¦ä¸²å¨é¨åå·æ°å°èç¹ä¸\n\næè\n\nå ä¸ºæ¯ä¸æ¬¡é½ä¼å°å½åææçiptablesè§åå¨é¨å·æ°å°èç¹ä¸ï¼å¦æè§åéè¿å¤§çè¯ï¼æ§è½ä¼åå°å½±åï¼æä»¥ææipvsæ¨¡å¼ã\n\n\n# æ»ç»\n\næ´ä½ä»£ç æµç¨å¦ä¸ï¼\n\n 1. é¦åæ¯åç§å¯¹è±¡å¥å¨å¼çåå§åï¼Options->ProxyServier->proxier->syncRunner\n 2. ç¶åæ¯åinformerä¸­æ³¨åserviceåendpointäºä»¶ï¼å½åçæ¹å¨æ¶ï¼ä¼ç»bfr.runåéä¿¡å·\n 3. syncRunneræ¶å°ä¿¡å·ä¼å»æ§è¡proxier.syncProxyRules()æ¹æ³ï¼å·æ°ä¸»æºçiptablesè§å\n\n\n\n\n# ç¸å³é¾æ¥\n\nkubernetes æºç -kube-proxy åçåæºç åæï¼ä¸ï¼\n\nkube-proxy æºç è§£æ\n\nkube-proxy ä¿å§çº§å«æºç éè¯»\n\nè¿æ¥è·è¸ª conntrack\n\nkubernetes ä¹ client-go ä¹ informer å·¥ä½åçæºç è§£æ\n\nKubernetes EndpointSlice å Endpoint å¯¹è±¡çåºå«\n\nâ',normalizedContent:'# kube-proxyæºç åæ\n\n\n# ç®ä»\n\næ¬æä¸»è¦æ¯å¯¹kube-proxyçæºç åæï¼äºè§£å¶ä»£ç ç»æåå®ç°åçãè¿éæ¯æ ¹æ®kubernetes1.23.9çæ¬æ¥è¿è¡åæçãå¨ä¸é¢è´´ä¸çä»£ç ä¼ä¸å®è£åªï¼ä¸»è¦ç¨äºçè§£ä¸»æµç¨ã\n\n\n# åå§å\n\nkube-proxyå¥å£æä»¶å¨cmd/kube-proxy/proxy.go\n\nfunc main() {\n\tcommand := app.newproxycommand()\n\tcode := cli.run(command)\n\tos.exit(code)\n}\n\n\n1\n2\n3\n4\n5\n\n\næ¥çapp.newproxycommand()æ¹æ³ï¼ä½¿ç¨çcobraå½ä»¤è¡è§£æåºæ¥ä½ä¸ºç¨åºå¥å£\n\nfunc newproxycommand() *cobra.command {\n\topts := newoptions()\n\n\tcmd := &cobra.command{\n\t\tuse: "kube-proxy",\n\t\tlong: `the kubernetes network proxy runs on each node. this\nreflects services as defined in the kubernetes api on each node and can do simple\ntcp, udp, and sctp stream forwarding or round robin tcp, udp, and sctp forwarding across a set of backends.\nservice cluster ips and ports are currently found through docker-links-compatible\nenvironment variables specifying ports opened by the service proxy. there is an optional\naddon that provides cluster dns for these cluster ips. the user must create a service\nwith the apiserver api to configure the proxy.`,\n\t\trune: func(cmd *cobra.command, args []string) error {\n\t\t\tverflag.printandexitifrequested()\n\t\t\tcliflag.printflags(cmd.flags())\n\n\t\t\tif err := initforos(opts.windowsservice); err != nil {\n\t\t\t\treturn fmt.errorf("failed os init: %w", err)\n\t\t\t}\n\n\t\t\t// 1. å è½½éç½®æä»¶kubeproxyconfig.kubeproxyconfiguration\n\t\t\t// 2. çæ§æä»¶åå\n\t\t\tif err := opts.complete(); err != nil {\n\t\t\t\treturn fmt.errorf("failed complete: %w", err)\n\t\t\t}\n\n\t\t\t// éç½®åæ°çæ ¡éª\n\t\t\tif err := opts.validate(); err != nil {\n\t\t\t\treturn fmt.errorf("failed validate: %w", err)\n\t\t\t}\n\n\t\t\t// è¿è¡æå¡\n\t\t\tif err := opts.run(); err != nil {\n\t\t\t\tklog.errors(err, "error running proxyserver")\n\t\t\t\treturn err\n\t\t\t}\n\n\t\t\treturn nil\n\t\t},\n\t\targs: func(cmd *cobra.command, args []string) error {\n\t\t\tfor _, arg := range args {\n\t\t\t\tif len(arg) > 0 {\n\t\t\t\t\treturn fmt.errorf("%q does not take any arguments, got %q", cmd.commandpath(), args)\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn nil\n\t\t},\n\t}\n\n\tvar err error\n    // å¡«åä¸äºé»è®¤éç½®\n\topts.config, err = opts.applydefaults(opts.config)\n\tif err != nil {\n\t\tklog.errors(err, "unable to create flag defaults")\n\t\t// action required: exit code changed from 255 to 1\n\t\tos.exit(1)\n\t}\n\n\tfs := cmd.flags()\n\topts.addflags(fs)\n\t// å°goçå½ä»¤è¡åæ°ä¹å å°å½ä»¤è¡åæ°ä¸­\n\tfs.addgoflagset(goflag.commandline) // for --boot-id-file and --machine-id-file\n\n\t_ = cmd.markflagfilename("config", "yaml", "yml", "json")\n\n\treturn cmd\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n\n 1. è¯»åéç½®æä»¶kubeproxyconfigurationï¼å¹¶çå¬ååæ¶å°å¯¹åºçäºä»¶\n 2. å¯¹éç½®kubeproxyconfigurationè¿è¡æ ¡éª\n 3. å¯å¨æå¡\n\nåæ¥çopts.run() æå¡å¯å¨çå®ç°\n\nfunc (o *options) run() error {\n\tdefer close(o.errch)\n\n    // å¦æéç½®äºè¯¥å­æ®µï¼å°éç½®æä»¶åå¥æå®ä½ç½®ï¼ç¶åéåº\n\tif len(o.writeconfigto) > 0 {\n\t\treturn o.writeconfigfile()\n\t}\n\n    // åå»ºä»£çæå¡\n\tproxyserver, err := newproxyserver(o)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t// æ¸é¤ææçiptablesè§å\n\tif o.cleanupandexit {\n\t\treturn proxyserver.cleanupandexit()\n\t}\n\n\t// å¯å¨ä»£çæå¡\n\to.proxyserver = proxyserver\n\treturn o.runloop()\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nåçnewproxyserver() çå®ç°ï¼ä¸»è¦æ¯ç¨æ¥åå»ºproxyserverå¯¹è±¡ï¼å¹¶ä¸å¨å¶ä¸­æ ¹æ®å½åçç½ç»æ¨¡å¼ï¼éè¿iptables.newproxieræ¥åå»ºproxierå¯¹è±¡ã\n\nfunc newproxyserver(o *options) (*proxyserver, error) {\n\treturn newproxyserver(o.config, o.cleanupandexit, o.master)\n}\n\nfunc newproxyserver(\n\tconfig *proxyconfigapi.kubeproxyconfiguration,\n\tcleanupandexit bool,\n\tmaster string) (*proxyserver, error) {\n\n\t// æ§è¡æ¬å°å½ä»¤çæ§å¶å¨\n\texecer := exec.new()\n\n\tkernelhandler = ipvs.newlinuxkernelhandler() \n    // åå»ºipsetå½ä»¤çæ§è¡å¨\n\tipsetinterface = utilipset.new(execer)\n    // å¤æ­æ¯å¦æ¯æipvs\n\tcanuseipvs, err := ipvs.canuseipvsproxier(kernelhandler, ipsetinterface, config.ipvs.scheduler)\n\tif string(config.mode) == proxymodeipvs && err != nil {\n\t\tklog.errors(err, "can\'t use the ipvs proxier")\n\t}\n\n\tif canuseipvs {\n        // å¦ææ¯æçè¯ï¼åå»ºipvsæ§è¡å¨\n\t\tipvsinterface = utilipvs.new()\n\t}\n\n\t// åå»ºäºä»¶è®°å½å¨\n\teventbroadcaster := events.newbroadcaster(&events.eventsinkimpl{interface: client.eventsv1()})\n\trecorder := eventbroadcaster.newrecorder(scheme.scheme, "kube-proxy")\n\n\t// åå»ºå¥åº·æ£æ¥æå¡\n\tvar healthzserver healthcheck.proxierhealthupdater\n\tif len(config.healthzbindaddress) > 0 {\n\t\thealthzserver = healthcheck.newproxierhealthserver(config.healthzbindaddress, 2*config.iptables.syncperiod.duration, recorder, noderef)\n\t}\n\n    // è·åå½åçä»£çæ¨¡å¼\n\tproxymode := getproxymode(string(config.mode), canuseipvs, iptables.linuxkernelcompattester{})\n\t\n    // è·åå½åçä¸»è¦çipåè®®\n\tprimaryprotocol := utiliptables.protocolipv4\n\tif netutils.isipv6(nodeip) {\n\t\tprimaryprotocol = utiliptables.protocolipv6\n\t}\n\n\t// åå»ºiptablesæ§è¡å¨\n\tiptinterface = utiliptables.new(execer, primaryprotocol)\n\n\t// å¯è½æ¯æipv4åipv6ä¸¤ç§æ§è¡å¨\n\tvar ipt [2]utiliptables.interface\n\tdualstack := true // while we assume that node supports, we do further checks below\n\n\t// å¦ææ¯æçæ¯iptablesæ¨¡å¼\n\tif proxymode == proxymodeiptables {\n\n\t\t// åç«¯æ¨¡å¼ï¼æ¯æip4åipv6\n\t\tif dualstack {\n\t\t\tproxier, err = iptables.newdualstackproxier(\n\t\t\t\tipt,\n\t\t\t\tutilsysctl.new(),\n\t\t\t\texecer,\n\t\t\t\tconfig.iptables.syncperiod.duration,\n\t\t\t\tconfig.iptables.minsyncperiod.duration,\n\t\t\t\tconfig.iptables.masqueradeall,\n\t\t\t\tint(*config.iptables.masqueradebit),\n\t\t\t\tlocaldetectors,\n\t\t\t\thostname,\n\t\t\t\tnodeiptuple(config.bindaddress),\n\t\t\t\trecorder,\n\t\t\t\thealthzserver,\n\t\t\t\tconfig.nodeportaddresses,\n\t\t\t)\n\t\t} else {\n\t\t\tproxier, err = iptables.newproxier(\n\t\t\t\tiptinterface,\n\t\t\t\tutilsysctl.new(),\n\t\t\t\texecer,\n\t\t\t\tconfig.iptables.syncperiod.duration,\n\t\t\t\tconfig.iptables.minsyncperiod.duration,\n\t\t\t\tconfig.iptables.masqueradeall,\n\t\t\t\tint(*config.iptables.masqueradebit),\n\t\t\t\tlocaldetector,\n\t\t\t\thostname,\n\t\t\t\tnodeip,\n\t\t\t\trecorder,\n\t\t\t\thealthzserver,\n\t\t\t\tconfig.nodeportaddresses,\n\t\t\t)\n\t\t}\n\n\t\tif err != nil {\n\t\t\treturn nil, fmt.errorf("unable to create proxier: %v", err)\n\t\t}\n\t\tproxymetrics.registermetrics()\n\n\telse if proxymode == proxymodeipvs {\n\t\t...\n\t}\n\n\treturn &proxyserver{\n\t\tclient:                 client,\n\t\teventclient:            eventclient,\n\t\tiptinterface:           iptinterface,\n\t\tipvsinterface:          ipvsinterface,\n\t\tipsetinterface:         ipsetinterface,\n\t\texecer:                 execer,\n\t\tproxier:                proxier,\n\t\tbroadcaster:            eventbroadcaster,\n\t\trecorder:               recorder,\n\t\tconntrackconfiguration: config.conntrack,\n\t\tconntracker:            &realconntracker{},\n\t\tproxymode:              proxymode,\n\t\tnoderef:                noderef,\n\t\tmetricsbindaddress:     config.metricsbindaddress,\n\t\tbindaddresshardfail:    config.bindaddresshardfail,\n\t\tenableprofiling:        config.enableprofiling,\n\t\toomscoreadj:            config.oomscoreadj,\n\t\tconfigsyncperiod:       config.configsyncperiod.duration,\n\t\thealthzserver:          healthzserver,\n\t\tuseendpointslices:      useendpointslices,\n\t}, nil\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n\n\nåæ¥çiptables.newproxier() æ¹æ³\n\nfunc newproxier(ipt utiliptables.interface,\n\tsysctl utilsysctl.interface,\n\texec utilexec.interface,\n\tsyncperiod time.duration,\n\tminsyncperiod time.duration,\n\tmasqueradeall bool,\n\tmasqueradebit int,\n\tlocaldetector proxyutiliptables.localtrafficdetector,\n\thostname string,\n\tnodeip net.ip,\n\trecorder events.eventrecorder,\n\thealthzserver healthcheck.proxierhealthupdater,\n\tnodeportaddresses []string,\n) (*proxier, error) {\n\n\t// è¿ä¸ªå°±æ¯0x4000ï¼ä¹å°±æ¯ç»æ°æ®åæä¸æ è®°ï¼å¨åºä¸»æºçæ¶åä¼è¿è¡snat\n\tmasqueradevalue := 1 << uint(masqueradebit)\n\tmasquerademark := fmt.sprintf("%#08x", masqueradevalue)\n\n    // åå»ºå¥åº·æ£æ¥æå¡\n\tservicehealthserver := healthcheck.newservicehealthserver(hostname, recorder, nodeportaddresses)\n\n\tproxier := &proxier{\n\t\tservicemap:               make(proxy.servicemap),\n\t\tservicechanges:           proxy.newservicechangetracker(newserviceinfo, ipfamily, recorder, nil),\n\t\tendpointsmap:             make(proxy.endpointsmap),\n\t\tendpointschanges:         proxy.newendpointchangetracker(hostname, newendpointinfo, ipfamily, recorder, nil),\n\t\tsyncperiod:               syncperiod,\n\t\tiptables:                 ipt,\n\t\tmasqueradeall:            masqueradeall,\n\t\tmasquerademark:           masquerademark,\n\t\texec:                     exec,\n\t\tlocaldetector:            localdetector,\n\t\thostname:                 hostname,\n\t\tnodeip:                   nodeip,\n\t\trecorder:                 recorder,\n\t\tservicehealthserver:      servicehealthserver,\n\t\thealthzserver:            healthzserver,\n\t\tprecomputedprobabilities: make([]string, 0, 1001),\n\t\tiptablesdata:             bytes.newbuffer(nil),\n\t\texistingfilterchainsdata: bytes.newbuffer(nil),\n\t\tfilterchains:             utilproxy.linebuffer{},\n\t\tfilterrules:              utilproxy.linebuffer{},\n\t\tnatchains:                utilproxy.linebuffer{},\n\t\tnatrules:                 utilproxy.linebuffer{},\n\t\tnodeportaddresses:        nodeportaddresses,\n\t\tnetworkinterfacer:        utilproxy.realnetwork{},\n\t}\n\n\tburstsyncs := 2\n    // syncrunneræ¯ç¨æ¥æ§å¶å·æ°iptablesè§åé¢ççè¿è¡å¨ï¼proxier.syncproxyrulesæ¹æ³å°±æ¯çæ­£å·æ°iptablesè§åçæ¹æ³\n   \tproxier.syncrunner = async.newboundedfrequencyrunner("sync-runner", proxier.syncproxyrules, minsyncperiod, time.hour, burstsyncs)\n\n\t// è¿éå¯ç¨ä¸ä¸ªgoroutineãå¨ä¸ä¸ªè¡¨ä¸­é½åå»ºä¸ä¸ªkube-proxy-canaryå­é¾ï¼éè¿å­é¾æ¯å¦å­å¨æ¥å¤æ­iptablesæ¯å¦è¢«å·æã\n\t// å¦æè¯¥é¾ä¸å­å¨ï¼è¯´æiptablesè¢«å·æäºï¼åæ¬¡æ§è¡syncproxyrulesæ¹æ³å·åæ¥ã\n\tgo ipt.monitor(kubeproxycanarychain, []utiliptables.table{utiliptables.tablemangle, utiliptables.tablenat, utiliptables.tablefilter},\n\t\tproxier.syncproxyrules, syncperiod, wait.neverstop)\n\treturn proxier, nil\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n\n\nä»¥ä¸ä¸»è¦çå¯¹è±¡å·²ç»åå§åå®æäºã\n\n\n# run\n\nåå°o.run() æ¹æ³ä¸­ï¼åæ¯åå»ºproxyserverå¯¹è±¡ï¼ç¶åå¨å¶ä¸­ååå»ºproxierå¯¹è±¡ï¼åäºä¸ç³»ååå§åå¨ä½ï¼æ¥ä¸æ¥å°±æ¯è¿è¡ä»£çæå¡äºï¼ç°å¨çårunloop æ¹æ³\n\nfunc (o *options) runloop() error {\n\t// å¼å¯æä»¶çå¬\n\tif o.watcher != nil {\n\t\to.watcher.run()\n\t}\n\n\t// run the proxy in goroutine\n\tgo func() {\n\t\terr := o.proxyserver.run()\n\t\to.errch <- err\n\t}()\n\n    // å¦ææ¥åå°errchååæ­¢æå¡\n\tfor {\n\t\terr := <-o.errch\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nåçåo.proxyserver.run() æ¹æ³ï¼è¿è¡ä»£çæå¡çä¸»æµç¨ã\n\nfunc (s *proxyserver) run() error {\n\t// è®¾ç½®å½åè¿ç¨çoomåæ°ï¼èµæºç´§å¼ æ¶ï¼ä¸ä¼åkillækube-proxy\n\tvar oomadjuster *oom.oomadjuster\n\tif s.oomscoreadj != nil {\n\t\toomadjuster = oom.newoomadjuster()\n\t\tif err := oomadjuster.applyoomscoreadj(0, int(*s.oomscoreadj)); err != nil {\n\t\t\tklog.v(2).infos("failed to apply oomscore", "err", err)\n\t\t}\n\t}\n\n\t// å¼å¯å¥åº·æ£æ¥æå¡\n\tservehealthz(s.healthzserver, errch)\n\n\t// å¼å¯ææ ä¸æ¥æå¡\n\tservemetrics(s.metricsbindaddress, s.proxymode, s.enableprofiling, errch)\n\n\t// åå»ºinformer\n\tinformerfactory := informers.newsharedinformerfactorywithoptions(s.client, s.configsyncperiod,\n\t\tinformers.withtweaklistoptions(func(options *metav1.listoptions) {\n\t\t\toptions.labelselector = labelselector.string()\n\t\t}))\n\n\t// çå¬serviceåendpointå¹¶æ³¨åäºä»¶ï¼å½åçååæ¶ï¼åä¼è¿è¡å·æ°iptablesè§å\n\tserviceconfig := config.newserviceconfig(informerfactory.core().v1().services(), s.configsyncperiod)\n\tserviceconfig.registereventhandler(s.proxier)\n\tgo serviceconfig.run(wait.neverstop)\n\n\tif endpointshandler, ok := s.proxier.(config.endpointshandler); ok && !s.useendpointslices {\n\t\tendpointsconfig := config.newendpointsconfig(informerfactory.core().v1().endpoints(), s.configsyncperiod)\n\t\tendpointsconfig.registereventhandler(endpointshandler)\n\t\tgo endpointsconfig.run(wait.neverstop)\n\t} else {\n\t\tendpointsliceconfig := config.newendpointsliceconfig(informerfactory.discovery().v1().endpointslices(), s.configsyncperiod)\n\t\tendpointsliceconfig.registereventhandler(s.proxier)\n\t\tgo endpointsliceconfig.run(wait.neverstop)\n\t}\n\n\tinformerfactory.start(wait.neverstop)\n\n\t// åéå¯å¨äºä»¶\n\ts.birthcry()\n\n\tgo s.proxier.syncloop()\n\n\treturn <-errch\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n\n\n\n# service å endpointslice åæ´äºä»¶\n\nç¨åºä¸­æ¯éè¿informeræ¥å®ç°å¯¹serviceåendpointåçååççå¬ï¼æç¥ååï¼å¹¶è§¦åäºä»¶å¹¶è¿è¡ç¸åºçå¤çã\n\nåçä¸ä¸newserviceconfig() æ¹æ³ï¼å¶ä¸­æ³¨åäºå½serviceåçå¢ãå ãæ¹äºä»¶æ¶ï¼åå«æ§è¡result.handleaddservice ãresult.handleupdateservice ãresult.handledeleteservice æ¹æ³ã\n\nfunc newserviceconfig(serviceinformer coreinformers.serviceinformer, resyncperiod time.duration) *serviceconfig {\n\tresult := &serviceconfig{\n\t\tlistersynced: serviceinformer.informer().hassynced,\n\t}\n\n\t// æ³¨ååæ´äºä»¶\n\tserviceinformer.informer().addeventhandlerwithresyncperiod(\n\t\tcache.resourceeventhandlerfuncs{\n\t\t\taddfunc:    result.handleaddservice,\n\t\t\tupdatefunc: result.handleupdateservice,\n\t\t\tdeletefunc: result.handledeleteservice,\n\t\t},\n\t\tresyncperiod,\n\t)\n\n\treturn result\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nåççå¶ä¸­çhandleaddservice() æ¹æ³ï¼ä¼ å¥çåæ°objå°±æ¯æ°å¢çserviceå¯¹è±¡ï¼ç¶åä¼ å¥eventhandler.onserviceadd()æ¹æ³è¿è¡å¤çã\n\nfunc (c *serviceconfig) handleaddservice(obj interface{}) {\n\tservice, ok := obj.(*v1.service)\n\tif !ok {\n\t\tutilruntime.handleerror(fmt.errorf("unexpected object type: %v", obj))\n\t\treturn\n\t}\n\tfor i := range c.eventhandlers {\n\t\tklog.v(4).infos("calling handler.onserviceadd")\n\t\tc.eventhandlers[i].onserviceadd(service)\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nè¿éc.eventhanlderså¶å®å°±æ¯proxierå¯¹è±¡ï¼å¨registereventhandler()æ¹æ³ä¸­å°å¶æ·»å è¿å»çã\n\nserviceconfig.registereventhandler(s.proxier)\n\n\n1\n\n\nä¹å°±æ¯è¯´ï¼proxier.onserviceadd()ææ¯éè¦è§¦åçå¤çæ¹æ³\n\nfunc (proxier *proxier) onserviceadd(service *v1.service) {\n\tproxier.onserviceupdate(nil, service)\n}\n\n\n1\n2\n3\n\n\nç¬¬ä¸ä¸ªåæ°ä¸ºæ§çserviceï¼ç¬¬äºåæ°ä¸ºæ°çåæ°ãè¯¥æ¹æ³ç»å¯ä»¥onserviceadd å¤ç¨ï¼ä¼ å¥çç¬¬ä¸ä¸ªåæ°ä¸ºnilï¼ç¬¬äºä¸ªåæ°ä¸ä¸ºnilï¼å°±æ¯æ°å¢çæä½ã\n\nfunc (proxier *proxier) onserviceupdate(oldservice, service *v1.service) {\n\tif proxier.servicechanges.update(oldservice, service) && proxier.isinitialized() {\n\t\tproxier.sync()\n\t}\n}\n\n\n1\n2\n3\n4\n5\n\n\nè¿å¯ä»¥çå°å é¤æä½ä¹è½å¤ç¨ï¼ææ§çserviceï¼èæ°serviceä¸ºnilä»£è¡¨å é¤ã\n\n// onservicedelete is called whenever deletion of an existing service\n// object is observed.\nfunc (proxier *proxier) onservicedelete(service *v1.service) {\n\tproxier.onserviceupdate(service, nil)\n}\n\n\n1\n2\n3\n4\n5\n\n\næ è®ºæ¯å¢ãå ãæ¹é½ä¼æ§è¡å°proxier.sync()æ¹æ³\n\nfunc (proxier *proxier) sync() {\n\tif proxier.healthzserver != nil {\n\t\tproxier.healthzserver.queuedupdate()\n\t}\n\tmetrics.syncproxyruleslastqueuedtimestamp.settocurrenttime()\n\tproxier.syncrunner.run()\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næç»å°proxier.syncrunner.run() æ¹æ³ï¼å¯ä»¥çåºå®ä¼åéä¸ä¸ªä¿¡å·å°bfr.runç®¡éä¸­ãè¯¥æ¹æ³é¤äºæ¯serviceåçäºä»¶æ§è¡æä½çç»ç¹å¤ï¼endpointåçäºä»¶åæç»ä¹ä¼æ§è¡å°è¿éã\n\nfunc (bfr *boundedfrequencyrunner) run() {\n\t// if it takes a lot of time to run the underlying function, noone is really\n\t// processing elements from <run> channel. so to avoid blocking here on the\n\t// putting element to it, we simply skip it if there is already an element\n\t// in it.\n\tselect {\n\tcase bfr.run <- struct{}{}:\n\tdefault:\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# boundedfrequencyrunner\n\næä»¬ååå°ä»£çæå¡çproxyserve.run æ¹æ³ï¼æåæ§è¡äºs.proxier.syncloop()\n\nfunc (proxier *proxier) syncloop() {\n\t// update healthz timestamp at beginning in case sync() never succeeds.\n\tif proxier.healthzserver != nil {\n\t\tproxier.healthzserver.updated()\n\t}\n\n\t// synthesize "last change queued" time as the informers are syncing.\n\tmetrics.syncproxyruleslastqueuedtimestamp.settocurrenttime()\n\tproxier.syncrunner.loop(wait.neverstop)\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nç¶ååæ§è¡proxier.syncrunner.loop() æ¹æ³\n\nfunc (bfr *boundedfrequencyrunner) loop(stop <-chan struct{}) {\n\tklog.v(3).infof("%s loop running", bfr.name)\n\tbfr.timer.reset(bfr.maxinterval)\n\tfor {\n\t\tselect {\n\t\tcase <-stop:\n\t\t\tbfr.stop()\n\t\t\tklog.v(3).infof("%s loop stopping", bfr.name)\n\t\t\treturn\n\t\tcase <-bfr.timer.c():\n\t\t\tbfr.tryrun()\n\t\tcase <-bfr.run:\n\t\t\tbfr.tryrun()\n\t\tcase <-bfr.retry:\n\t\t\tbfr.doretry()\n\t\t}\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nå¯ä»¥çå°å¦æbfr.runç®¡éæ¥æ¶å°äºä¿¡å·ï¼ä¼æ§è¡brf.tryrun() æ¹æ³ï¼å¨è¿ä¸ªæ¹æ³ä¸­ä¼æ§è¡proxier.syncproxyrules() è¿è¡å·æ°iptablesè§åã\n\n// assumes the lock is not held\nfunc (bfr *boundedfrequencyrunner) tryrun() {\n\tbfr.mu.lock()\n\tdefer bfr.mu.unlock()\n\n    // è¿éä¼éå¶è®¿é®éçï¼çæ¯å¦å¯ä»¥æ§è¡ã\n\tif bfr.limiter.tryaccept() {\n        // è¿éçfnå°±æ¯proxier.syncproxyrulesæ¹æ³\n\t\tbfr.fn()\n\t\tbfr.lastrun = bfr.timer.now()\n\t\tbfr.timer.stop()\n\t\tbfr.timer.reset(bfr.maxinterval)\n\t\tklog.v(3).infof("%s: ran, next possible in %v, periodic in %v", bfr.name, bfr.mininterval, bfr.maxinterval)\n\t\treturn\n\t}\n\n\t// it can\'t run right now, figure out when it can run next.\n\telapsed := bfr.timer.since(bfr.lastrun)   // how long since last run\n\tnextpossible := bfr.mininterval - elapsed // time to next possible run\n\tnextscheduled := bfr.timer.remaining()    // time to next scheduled run\n\tklog.v(4).infof("%s: %v since last run, possible in %v, scheduled in %v", bfr.name, elapsed, nextpossible, nextscheduled)\n\n\t// it\'s hard to avoid race conditions in the unit tests unless we always reset\n\t// the timer here, even when it\'s unchanged\n\tif nextpossible < nextscheduled {\n\t\tnextscheduled = nextpossible\n\t}\n\tbfr.timer.stop()\n\tbfr.timer.reset(nextscheduled)\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\n\n# syncproxyrules\n\nè¯¥æ¹æ³ä¸»è¦æ¯æ´æ°èç¹ä¸çiptablesè§åã\n\nfunc (proxier *proxier) syncproxyrules() {\n\n\t// è·åserviceåendpointåçååçæ°æ®\n\tserviceupdateresult := proxier.servicemap.update(proxier.servicechanges)\n\tendpointupdateresult := proxier.endpointsmap.update(proxier.endpointschanges)\n\n\n\t// åå»ºä¸äºå¿è¦çiptablesé¾\n\tfor _, jump := range iptablesjumpchains {\n\t\tif _, err := proxier.iptables.ensurechain(jump.table, jump.dstchain); err != nil {\n\t\t\tklog.errors(err, "failed to ensure chain exists", "table", jump.table, "chain", jump.dstchain)\n\t\t\treturn\n\t\t}\n\t\targs := append(jump.extraargs,\n\t\t\t"-m", "comment", "--comment", jump.comment,\n\t\t\t"-j", string(jump.dstchain),\n\t\t)\n\t\tif _, err := proxier.iptables.ensurerule(utiliptables.prepend, jump.table, jump.srcchain, args...); err != nil {\n\t\t\tklog.errors(err, "failed to ensure chain jumps", "table", jump.table, "srcchain", jump.srcchain, "dstchain", jump.dstchain)\n\t\t\treturn\n\t\t}\n\t}\n\n\tfor _, ch := range iptablesensurechains {\n\t\tif _, err := proxier.iptables.ensurechain(ch.table, ch.chain); err != nil {\n\t\t\tklog.errors(err, "failed to ensure chain exists", "table", ch.table, "chain", ch.chain)\n\t\t\treturn\n\t\t}\n\t}\n\n\t// å°å½åfilterè¡¨ä¸­ææå­å¨çè§ååå¥existingfilterchainsdataä¸­\n\tproxier.existingfilterchainsdata.reset()\n\terr := proxier.iptables.saveinto(utiliptables.tablefilter, proxier.existingfilterchainsdata)\n\n\t// å°natè¡¨ä¸­ææå­å¨çè§ååå¥iptablesdataä¸­\n\tproxier.iptablesdata.reset()\n\terr = proxier.iptables.saveinto(utiliptables.tablenat, proxier.iptablesdata)\n\n\t// å°filterånaté¾ä¸­å¿è¦æ·»å çå­é¾ï¼éè¿å­ç¬¦ä¸²æ¼æ¥çæ¹å¼åå¥åéfilterchainsånatchainsä¸­\n\tfor _, chainname := range []utiliptables.chain{kubeserviceschain, kubeexternalserviceschain, kubeforwardchain, kubenodeportschain} {\n\t\tif chain, ok := existingfilterchains[chainname]; ok {\n\t\t\tproxier.filterchains.writebytes(chain)\n\t\t} else {\n\t\t\tproxier.filterchains.write(utiliptables.makechainline(chainname))\n\t\t}\n\t}\n\tfor _, chainname := range []utiliptables.chain{kubeserviceschain, kubenodeportschain, kubepostroutingchain, kubemarkmasqchain} {\n\t\tif chain, ok := existingnatchains[chainname]; ok {\n\t\t\tproxier.natchains.writebytes(chain)\n\t\t} else {\n\t\t\tproxier.natchains.write(utiliptables.makechainline(chainname))\n\t\t}\n\t}\n\n\t// åé¢å°±æ¯å°åç§çiptablesè§åéè¿å­ç¬¦ä¸²æ¼æ¥èµ·æ¥\n    ...\n\n\t// å°ææé¾åè§åçiptableså¨é¨éæå°ä¸èµ·iptablesdataï¼ç¶ååéè¿iptables-restoreå½ä»¤å·æ°å°èç¹ä¸­ã\n\tproxier.iptablesdata.reset()\n\tproxier.iptablesdata.write(proxier.filterchains.bytes())\n\tproxier.iptablesdata.write(proxier.filterrules.bytes())\n\tproxier.iptablesdata.write(proxier.natchains.bytes())\n\tproxier.iptablesdata.write(proxier.natrules.bytes())\n\terr = proxier.iptables.restoreall(proxier.iptablesdata.bytes(), utiliptables.noflushtables, utiliptables.restorecounters)\n\tif err != nil {\n\t\tklog.errors(err, "failed to execute iptables-restore")\n\t\tmetrics.iptablesrestorefailurestotal.inc()\n\t\treturn\n\t}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n\n\næ»ç»\n\n 1. è·ååçåæ´ç service å endpoint ä¿¡æ¯\n 2. åå»ºä¸äºå¿è¦çé¾\n 3. ä½¿ç¨ iptables-save å½ä»¤ï¼å°å½åç¯å¢ä¸­ nat å filter è¡¨ä¸­ç iptables è§åå¨é¨å è½½å°ç¨åºä¸­ã\n 4. éè¿æ¼æ¥å­ç¬¦ä¸²ï¼æé åºéè¦åå»ºç iptables è§åå­ç¬¦ä¸²ã\n 5. éè¿ iptables-restore å½ä»¤ï¼å°æé ç iptables è§åå­ç¬¦ä¸²å¨é¨åå·æ°å°èç¹ä¸\n\næè\n\nå ä¸ºæ¯ä¸æ¬¡é½ä¼å°å½åææçiptablesè§åå¨é¨å·æ°å°èç¹ä¸ï¼å¦æè§åéè¿å¤§çè¯ï¼æ§è½ä¼åå°å½±åï¼æä»¥ææipvsæ¨¡å¼ã\n\n\n# æ»ç»\n\næ´ä½ä»£ç æµç¨å¦ä¸ï¼\n\n 1. é¦åæ¯åç§å¯¹è±¡å¥å¨å¼çåå§åï¼options->proxyservier->proxier->syncrunner\n 2. ç¶åæ¯åinformerä¸­æ³¨åserviceåendpointäºä»¶ï¼å½åçæ¹å¨æ¶ï¼ä¼ç»bfr.runåéä¿¡å·\n 3. syncrunneræ¶å°ä¿¡å·ä¼å»æ§è¡proxier.syncproxyrules()æ¹æ³ï¼å·æ°ä¸»æºçiptablesè§å\n\n\n\n\n# ç¸å³é¾æ¥\n\nkubernetes æºç -kube-proxy åçåæºç åæï¼ä¸ï¼\n\nkube-proxy æºç è§£æ\n\nkube-proxy ä¿å§çº§å«æºç éè¯»\n\nè¿æ¥è·è¸ª conntrack\n\nkubernetes ä¹ client-go ä¹ informer å·¥ä½åçæºç è§£æ\n\nkubernetes endpointslice å endpoint å¯¹è±¡çåºå«\n\nâ',charsets:{cjk:!0},lastUpdated:"2024/01/18, 19:50:43",lastUpdatedTimestamp:1705578643e3},{title:"redisä¹äºç§åºæ¬æ°æ®ç±»å",frontmatter:{title:"redisä¹äºç§åºæ¬æ°æ®ç±»å",date:"2022-12-01T15:16:14.000Z",permalink:"/pages/2bbeb3/",tags:["redis","æ°æ®åº"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä¸»è¦è®²è§£ redis çäºç§åºæ¬æ°æ®ç±»åï¼StringãListãSetãSorted SetãHashãå­¦ä¹ å¦ä½ä½¿ç¨å®ä»¬ï¼å¹¶ä¸äºè§£å®ä»¬çåºå±æ°æ®ç»æå®ç°ï¼è¿æ ·æä»¬æè½å¨éå½çåºç¨åºæ¯éæ©æéåçæ°æ®ç±»åæ¥è§£å³æä»¬çéæ±ã",feed:{enable:!0},categories:["æ°æ®åº","redis"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210820163352.png"},{name:"twitter:title",content:"redisä¹äºç§åºæ¬æ°æ®ç±»å"},{name:"twitter:description",content:"æ¬æä¸»è¦è®²è§£ redis çäºç§åºæ¬æ°æ®ç±»åï¼StringãListãSetãSorted SetãHashãå­¦ä¹ å¦ä½ä½¿ç¨å®ä»¬ï¼å¹¶ä¸äºè§£å®ä»¬çåºå±æ°æ®ç»æå®ç°ï¼è¿æ ·æä»¬æè½å¨éå½çåºç¨åºæ¯éæ©æéåçæ°æ®ç±»åæ¥è§£å³æä»¬çéæ±ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210820163352.png"},{name:"twitter:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/01.redis%E4%B9%8B%E4%BA%94%E7%A7%8D%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html"},{property:"og:type",content:"article"},{property:"og:title",content:"redisä¹äºç§åºæ¬æ°æ®ç±»å"},{property:"og:description",content:"æ¬æä¸»è¦è®²è§£ redis çäºç§åºæ¬æ°æ®ç±»åï¼StringãListãSetãSorted SetãHashãå­¦ä¹ å¦ä½ä½¿ç¨å®ä»¬ï¼å¹¶ä¸äºè§£å®ä»¬çåºå±æ°æ®ç»æå®ç°ï¼è¿æ ·æä»¬æè½å¨éå½çåºç¨åºæ¯éæ©æéåçæ°æ®ç±»åæ¥è§£å³æä»¬çéæ±ã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210820163352.png"},{property:"og:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/01.redis%E4%B9%8B%E4%BA%94%E7%A7%8D%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-12-01T15:16:14.000Z"},{property:"article:tag",content:"redis"},{property:"article:tag",content:"æ°æ®åº"},{itemprop:"name",content:"redisä¹äºç§åºæ¬æ°æ®ç±»å"},{itemprop:"description",content:"æ¬æä¸»è¦è®²è§£ redis çäºç§åºæ¬æ°æ®ç±»åï¼StringãListãSetãSorted SetãHashãå­¦ä¹ å¦ä½ä½¿ç¨å®ä»¬ï¼å¹¶ä¸äºè§£å®ä»¬çåºå±æ°æ®ç»æå®ç°ï¼è¿æ ·æä»¬æè½å¨éå½çåºç¨åºæ¯éæ©æéåçæ°æ®ç±»åæ¥è§£å³æä»¬çéæ±ã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210820163352.png"}],readingShow:"top"},regularPath:"/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/01.redis%E4%B9%8B%E4%BA%94%E7%A7%8D%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html",relativePath:"03.ä¸­é´ä»¶/05.redis/01.redisä¹äºç§åºæ¬æ°æ®ç±»å.md",key:"v-27753cf3",path:"/pages/2bbeb3/",headers:[{level:2,title:"0. åè¨",slug:"_0-åè¨",normalizedTitle:"0. åè¨",charIndex:2},{level:2,title:"1. String",slug:"_1-string",normalizedTitle:"1. string",charIndex:127},{level:3,title:"1.1 ç®åä½¿ç¨",slug:"_1-1-ç®åä½¿ç¨",normalizedTitle:"1.1 ç®åä½¿ç¨",charIndex:141},{level:3,title:"1.2 æ°æ®ç¼ç ",slug:"_1-2-æ°æ®ç¼ç ",normalizedTitle:"1.2 æ°æ®ç¼ç ",charIndex:843},{level:3,title:"1.3 ç®åå¨æå­ç¬¦ä¸²(SDS)",slug:"_1-3-ç®åå¨æå­ç¬¦ä¸²-sds",normalizedTitle:"1.3 ç®åå¨æå­ç¬¦ä¸²(sds)",charIndex:1330},{level:3,title:"1.4 ä½¿ç¨åºæ¯",slug:"_1-4-ä½¿ç¨åºæ¯",normalizedTitle:"1.4 ä½¿ç¨åºæ¯",charIndex:2193},{level:2,title:"2. List",slug:"_2-list",normalizedTitle:"2. list",charIndex:2267},{level:3,title:"2.1 ç®åä½¿ç¨",slug:"_2-1-ç®åä½¿ç¨",normalizedTitle:"2.1 ç®åä½¿ç¨",charIndex:2279},{level:3,title:"2.2 æ°æ®ç¼ç ",slug:"_2-2-æ°æ®ç¼ç ",normalizedTitle:"2.2 æ°æ®ç¼ç ",charIndex:2884},{level:3,title:"2.3 åç¼©åè¡¨(ziplist)",slug:"_2-3-åç¼©åè¡¨-ziplist",normalizedTitle:"2.3 åç¼©åè¡¨(ziplist)",charIndex:3066},{level:3,title:"2.4 å¿«éåè¡¨(quicklist)",slug:"_2-4-å¿«éåè¡¨-quicklist",normalizedTitle:"2.4 å¿«éåè¡¨(quicklist)",charIndex:4017},{level:3,title:"2.5 ä½¿ç¨åºæ¯",slug:"_2-5-ä½¿ç¨åºæ¯",normalizedTitle:"2.5 ä½¿ç¨åºæ¯",charIndex:4241},{level:2,title:"3. Set",slug:"_3-set",normalizedTitle:"3. set",charIndex:4274},{level:3,title:"3.1 ç®åä½¿ç¨",slug:"_3-1-ç®åä½¿ç¨",normalizedTitle:"3.1 ç®åä½¿ç¨",charIndex:4319},{level:3,title:"3.2 æ°æ®ç¼ç ",slug:"_3-2-æ°æ®ç¼ç ",normalizedTitle:"3.2 æ°æ®ç¼ç ",charIndex:4685},{level:3,title:"3.3 æ´åæ°ç»(intset)",slug:"_3-3-æ´åæ°ç»-intset",normalizedTitle:"3.3 æ´åæ°ç»(intset)",charIndex:4986},{level:3,title:"3.4 ä½¿ç¨åºæ¯",slug:"_3-4-ä½¿ç¨åºæ¯",normalizedTitle:"3.4 ä½¿ç¨åºæ¯",charIndex:5534},{level:2,title:"4. Sorted Set",slug:"_4-sorted-set",normalizedTitle:"4. sorted set",charIndex:5618},{level:3,title:"4.1 ç®åä½¿ç¨",slug:"_4-1-ç®åä½¿ç¨",normalizedTitle:"4.1 ç®åä½¿ç¨",charIndex:5680},{level:3,title:"4.2 æ°æ®ç¼ç ",slug:"_4-2-æ°æ®ç¼ç ",normalizedTitle:"4.2 æ°æ®ç¼ç ",charIndex:6235},{level:3,title:"4.3 è·³è¡¨(skiplist)",slug:"_4-3-è·³è¡¨-skiplist",normalizedTitle:"4.3 è·³è¡¨(skiplist)",charIndex:6528},{level:3,title:"4.4 ä½¿ç¨åºæ¯",slug:"_4-4-ä½¿ç¨åºæ¯",normalizedTitle:"4.4 ä½¿ç¨åºæ¯",charIndex:6643},{level:2,title:"5. hash",slug:"_5-hash",normalizedTitle:"5. hash",charIndex:6684},{level:3,title:"5.1 ç®åä½¿ç¨",slug:"_5-1-ç®åä½¿ç¨",normalizedTitle:"5.1 ç®åä½¿ç¨",charIndex:6725},{level:3,title:"5.2 æ°æ®ç¼ç ",slug:"_5-2-æ°æ®ç¼ç ",normalizedTitle:"5.2 æ°æ®ç¼ç ",charIndex:7229},{level:3,title:"5.3 ä½¿ç¨åºæ¯",slug:"_5-3-ä½¿ç¨åºæ¯",normalizedTitle:"5.3 ä½¿ç¨åºæ¯",charIndex:7365},{level:2,title:"6. æ»ç»",slug:"_6-æ»ç»",normalizedTitle:"6. æ»ç»",charIndex:7391},{level:2,title:"7. ç¸å³é¾æ¥",slug:"_7-ç¸å³é¾æ¥",normalizedTitle:"7. ç¸å³é¾æ¥",charIndex:7469}],headersStr:"0. åè¨ 1. String 1.1 ç®åä½¿ç¨ 1.2 æ°æ®ç¼ç  1.3 ç®åå¨æå­ç¬¦ä¸²(SDS) 1.4 ä½¿ç¨åºæ¯ 2. List 2.1 ç®åä½¿ç¨ 2.2 æ°æ®ç¼ç  2.3 åç¼©åè¡¨(ziplist) 2.4 å¿«éåè¡¨(quicklist) 2.5 ä½¿ç¨åºæ¯ 3. Set 3.1 ç®åä½¿ç¨ 3.2 æ°æ®ç¼ç  3.3 æ´åæ°ç»(intset) 3.4 ä½¿ç¨åºæ¯ 4. Sorted Set 4.1 ç®åä½¿ç¨ 4.2 æ°æ®ç¼ç  4.3 è·³è¡¨(skiplist) 4.4 ä½¿ç¨åºæ¯ 5. hash 5.1 ç®åä½¿ç¨ 5.2 æ°æ®ç¼ç  5.3 ä½¿ç¨åºæ¯ 6. æ»ç» 7. ç¸å³é¾æ¥",content:'# 0. åè¨\n\næ¬æä¸»è¦è®²è§£ redis çäºç§åºæ¬æ°æ®ç±»åï¼StringãListãSetãSorted SetãHashãå­¦ä¹ å¦ä½ä½¿ç¨å®ä»¬ï¼å¹¶ä¸äºè§£å®ä»¬çåºå±æ°æ®ç»æå®ç°ï¼è¿æ ·æä»¬æè½å¨éå½çåºç¨åºæ¯éæ©æéåçæ°æ®ç±»åæ¥è§£å³æä»¬çéæ±ã\n\n\n# 1. String\n\n\n# 1.1 ç®åä½¿ç¨\n\nString æ¯ redis æç®åçä¸æå¸¸ç¨çæ°æ®ç±»åï¼å¯ä»¥ç¨æ¥å­å¨å­ç¬¦ä¸²ãæ´åä»¥åæµ®ç¹åã\n\n * å­ç¬¦ä¸²\n\n127.0.0.1:6379> set name zhangsan\nOK\n127.0.0.1:6379> get name\n"zhangsan"\n\n\n1\n2\n3\n4\n\n * æ´å\n\nè½ç¶ get age æ¶è¿åçæ¯å­ç¬¦ä¸²ï¼ä½æ¯å¯ä»¥éè¿ object encoding age çå°å¶çæ­£çç±»åã\n\n127.0.0.1:6379> set age 18\nOK\n127.0.0.1:6379> get age\n"18"\n127.0.0.1:6379> object encoding age\n"int"\n\n# èªå¢\n127.0.0.1:6379> incr age\n(integer) 19\n\n# èªå\n127.0.0.1:6379> decr age\n(integer) 18\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n * æµ®ç¹å\n\nåå¥çæµ®ç¹åï¼ä½è¿æ¯éè¿å­ç¬¦ä¸²æ¥ä¿å­çï¼ä½æ¯å¨ä½¿ç¨çæ¶åï¼ä¼å°å­ç¬¦ä¸²è½¬æ¢ææµ®ç¹æ°ã\n\n127.0.0.1:6379> set height 1.77\nOK\n127.0.0.1:6379> get height\n"1.77"\n127.0.0.1:6379> object encoding height\n"embstr"\n\n# æµ®ç¹æ°æä½\n127.0.0.1:6379> incrbyfloat height 1\n"2.77"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næ´å¤çæä½è¯·åèå®ç½\n\n\n# 1.2 æ°æ®ç¼ç \n\nString æ¯æçç¼ç ç±»åæ intãembstr å rawï¼å¨ä¸åæ¡ä»¶æ¶ï¼ä¼è½¬æ¢æå¯¹åºçç¼ç ã\n\n * int å½å­å¨çæ°æ®ä¸ºæ´åæ¶ï¼ä¼ä½¿ç¨ int ç¼ç ãå¶å®ç°æ¯ï¼ä¼ç´æ¥å°æ´åå¼å­å¨å¨ redisObject ç ptrï¼å° void* è½¬æ¢æ longï¼ ä¸­ï¼å¹¶ä¸å°å­ç¬¦ä¸²çå¯¹è±¡çç¼ç è®¾ç½®ä¸º intã\n\n * raw è¯¥ç§ç¼ç æ¯ä½¿ç¨ä¸ç§ç®åå¨æå­ç¬¦ä¸²(SDS)çæ°æ®ç»æå­å¨ï¼å½å­ç¬¦ä¸²çé¿åº¦å¤§äº 44 æ¶ï¼ä¼ä½¿ç¨è¯¥ç§æ°æ®ç¼ç æ¹å¼ã\n\n * embstr ä¹æ¯ä½¿ç¨ ç®åå¨æå­ç¬¦ä¸²(SDS)çæ°æ®ç»æå­å¨ï¼æ¯å½å­ç¬¦ä¸²é¿åº¦å°äºç­äº 44 æ¶ä½¿ç¨ã\n\nembstr å raw çåºå«æ¯ä»ä¹å¢ï¼\n\nåå»º string ä½¿ç¨ raw ç¼ç æ¶ï¼ä¼è°ç¨ä¸¤æ¬¡åå­åéæ¥åå»º redisObject å sds çæ°æ®ç»æï¼è embstr åªä¼è°ç¨ä¸æ¬¡æ¥åå»ºè¿ç»­çåå­ç©ºé´æ¥å­å¨ redisObject å sds ã\n\nå½å­ç¬¦ä¸²è¾å°æ¶ï¼embstr å°è°ç¨ä¸æ¬¡åå­åéï¼éæ¾ä¹åªéè¦ä¸æ¬¡ï¼ææ¾æ´å¿«ï¼å¹¶ä¸è¿ç»­çåå­ç©ºé´å¯ä»¥æ´å¥½çå©ç¨ cpu ç¼å­ã\n\n\n# 1.3 ç®åå¨æå­ç¬¦ä¸²(SDS)\n\nå¨æ°æ®ç¼ç ä¸­æå° embstr å raw é½æ¯ä½¿ç¨ SDS æ°æ®ç»æï¼é£ä¹è¿ç§æ°æ®ç»æçæ¯æä¹æ ·çï¼æä»ä¹å¥½å¤å¢ï¼\n\næ°æ®ç»æå¦ä¸å¾æç¤ºï¼\n\nstruct sdshdr {\n    //è®°å½bufæ°ç»ä¸­å·²ä½¿ç¨å­èçæ°éï¼ç­äºSDSæä¿å­å­ç¬¦ä¸²çé¿åº¦\n    int len;\n \n    //è®°å½buf æ°ç»ä¸­æªä½¿ç¨å­èçæ°é\n    int free;\n \n    //å­èæ°ç»ï¼ç¨äºä¿å­å­ç¬¦ä¸²\n    char buf[];\n};\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n * free: è¡¨ç¤ºè¿æå¤å°ç©ºä½ç©ºé´\n * len: å·²ä½¿ç¨å¤å°ç©ºé´\n * buf: å­å¨å­ç¬¦ä¸²çæ°ç»\n\né®é¢ï¼String ä¸ºä»ä¹ä½¿ç¨ç®åå¨æå­ç¬¦ä¸²æ¥å®ç°ï¼èä¸æ¯ä½¿ç¨ C ä¼ ç»å­ç¬¦ä¸²æ¥å®ç°å¢ï¼\n\n * é²æ­¢ç¼å­åºæº¢åº\n\nå¨æ©åå­ç¬¦ä¸²æ¶ï¼éè¦èèç¼å²åºæ¯å¦è¶³å¤ï¼SDS æä¾ API æ¥å¸®å©æä»¬å¤æ­å¹¶æ©åç©ºé´ã\n\n * å¸¸æ°è·åå­ç¬¦ä¸²é¿åº¦\n\nC ä¼ ç»å­ç¬¦ä¸²éè¦éåæè½ç¥éå·ä½çé¿åº¦ï¼æ¶é´å¤æåº¦ä¸º O(n)ï¼è SDS å¯ä»¥ç´æ¥è¯» len å±æ§è·åé¿åº¦ï¼æ¶é´å¤æåº¦ä¸º O(1)\n\n * åå°åå­åéçæ¬¡æ°\n\nå¨æ©å¤§å­ç¬¦ä¸²é¿åº¦æ¶ï¼éè¦éæ°ç³è¯·æ´å¤§çåå­ç©ºé´ï¼ç¶åæ·è´å°æ°çåå­ç©ºé´ä¸­ï¼ç¶ååéæ¾æ§çåå­ç©ºé´ã\n\nå¨ç¼©å°æ¶ä¹æ¯ä¸æ ·ï¼éè¦ç³è¯·æ°çç©ºé´ï¼åéæ¾æ§çç©ºé´ã\n\nå¨ SDS ä¸­å¯ä»¥éè¿ä»¥ä¸çæ¹å¼æ¥åå°åå­åéåéæ¾ï¼æé«æçã\n\n 1. ç©ºé´é¢åéï¼å¨åéç©ºé´æ¶ï¼é¤äºå¿è¦çç©ºé´å¤ï¼å¯ä»¥é¢å¤çåéæªä½¿ç¨çç©ºé´ï¼å¨ä¸æ¬¡ä½¿ç¨ï¼å¯ä»¥å¿«éä½¿ç¨è¿é¨åçç©ºé´ï¼èä¸å¿éæ°åéã\n 2. æ°æ§éæ¾ç©ºé´ï¼å¨ç¼©å°å­ç¬¦ä¸²æ¶ï¼ä¸éè¦é©¬ä¸éæ¾å¤ä½çç©ºé´ï¼å¯ä»¥é¢çç»ä¸æ¬¡ä½¿ç¨ã\n\n * äºè¿å¶å®å¨\n\nC è¯­è¨ä¸­æ¯ä»¥ç©ºå­ç¬¦æ¥è¡¨ç¤ºå­ç¬¦ä¸²çç»æï¼èä¸äºäºè¿å¶æä»¶åå®¹å¯è½æ¯åå«ç©ºå­ç¬¦ä¸²çï¼å æ­¤ C è¯­è¨å­ç¬¦ä¸²æ æ³æ­£ç¡®è¯»åï¼æä»¥ SDS é½æ¯ä»¥äºè¿å¶æ¹å¼å¤ç bufï¼å¹¶ä¸ä¸ä»¥ç©ºå­ç¬¦ä¸²å¤æ­æ¯å¦ç»æï¼èæ¯ç¨ len æ¥å¤æ­ã\n\n\n# 1.4 ä½¿ç¨åºæ¯\n\n * ç¼å­ï¼å­å¨ç­ç¹æ°æ®ä½ä¸ºç¼å­ï¼éä½æä¹åæ°æ®åºçè¯»åååã\n * åå¸å¼é\n * è®¡æ°å¨ï¼å¯ä»¥ä½¿ç¨ incr å½ä»¤\n\n\n# 2. List\n\n\n# 2.1 ç®åä½¿ç¨\n\nå½ä»¤       è¯´æ\nlpush    å°å¼ä»å·¦è¾¹æ¨å¥åè¡¨\nrpush    å°å¼ä»å³è¾¹æ¨å¥åè¡¨\nlpop     å°å¼ä»åè¡¨å·¦è¾¹å¼¹åºè¿å\nrpop     å°å¼ä»åè¡¨å³è¾¹å¼¹åºè¿å\nlrange   æ ¹æ®ç´¢å¼æ¥çåè¡¨ä¸­çæ°æ®\n\n127.0.0.1:6379> lpush mylist 1 2 3\n(integer) 3\n\n127.0.0.1:6379> lrange mylist 0 -1\n1) "3"\n2) "2"\n3) "1"\n\n127.0.0.1:6379> rpush mylist 4\n(integer) 4\n\n127.0.0.1:6379> lrange mylist 0 -1\n1) "3"\n2) "2"\n3) "1"\n4) "4"\n\n127.0.0.1:6379> lpop mylist\n"3"\n\n127.0.0.1:6379> lrange mylist 0 -1\n1) "2"\n2) "1"\n3) "4"\n\n127.0.0.1:6379> rpop mylist\n"4"\n\n127.0.0.1:6379> lrange mylist 0 -1\n1) "2"\n2) "1"\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# 2.2 æ°æ®ç¼ç \n\nå¨ redis3.2 ä¹åä½¿ç¨çæ¯ ziplist å linkedlist ä¸¤ç§ç¼ç æ¹å¼ãå¨æ°æ®éå°çæ¶åä½¿ç¨ ziplistï¼èæ°æ®å¤çæ¶åä½¿ç¨ linkedlistã\n\nèä¹åççæ¬ä½¿ç¨çæ¯ quicklist\n\n127.0.0.1:6379> object encoding mylist\n"quicklist"\n\n\n1\n2\n\n\n\n# 2.3 åç¼©åè¡¨(ziplist)\n\nè¯¥æ°æ®ç»æç±»ä¼¼äºä¸ä¸ªæ°ç»ï¼å¨æ°ç»çè¡¨å¤´æ·»å ä¸ä¸ªå­æ®µ zlbytesãzltailãzlenï¼åå¨è¡¨å°¾æ·»å  zlend è¡¨ç¤ºåè¡¨ç»æã\n\n\n\n * zlbytesï¼åå­å­èæ°\n * zltailï¼åè¡¨å°¾åç§»é\n * zllenï¼åè¡¨åç´ ä¸ªæ°\n * zlendï¼åè¡¨ç»ææ è®°\n\néè¿è¿å ä¸ªå­æ®µå¯ä»¥å¿«éå®ä½ç¬¬ä¸ä¸ªåç´ åæååç´ ï¼æ¶é´å¤æåº¦ä¸º O(1)ã\n\né¤äºè¡¨å¤´ä¸è¡¨å°¾ä¹å¤ï¼å¶ä»åç´ é½æ¯èç¹ï¼èç¹çæ°æ®ç»æå¦ä¸å¾ï¼\n\n\n\n * previous_entry_length : ä¸ä¸ä¸ªèç¹çé¿åº¦ãå¯ä»¥æ¨ç®åºä¸ä¸ä¸ªèç¹çå°å\n * encoding: è¯¥èç¹çæ°æ®ç±»ååé¿åº¦\n * content: èç¹çå¼\n\nè¿éæ´æ°é®é¢\n\nå¯¹äº previous_entry_lengthï¼\n\n * åä¸ä¸ªèç¹é¿åº¦å°äº 254 å­èï¼previous_entry_length é¿åº¦éè¦ç¨ 1 å­èä¿å­é¿åº¦å¼\n * åä¸ä¸ªèç¹é¿åº¦å¤§äº 254 å­èï¼previous_entry_length é¿åº¦éè¦ç¨ 5 å­èä¿å­é¿åº¦å¼\n\næè¿ä¸ç§åºæ¯ï¼å¦æåç¼©åè¡¨ä¸­æå¤ä¸ªè¿ç»­çèç¹é¿åº¦å¨ 250-253 å­èä¹é´ï¼è¿äºèç¹ previous_entry_length ä½¿ç¨ 1 ä¸ªå­èå­å¨å¤§å°ã\n\n * å½å¨æåæ¹æ·»å ä¸ä¸ªèç¹å¤§äºç­äº 254 å­èçèç¹æ¶ï¼åé¢çèç¹ previous_entry_length é½éè¦ä» 1 å­èæ©åå° 5 å­èï¼èµ·å°è¿éæ´æ°ï¼åé¢çèç¹é½éè¦æ´æ°ã\n\n\n\n * å½å é¤å¶ä¸­ small èç¹æ¶ï¼å¶åèç¹ previous_entry_length éè¦ä¿å­åé¢ç big èç¹ï¼éè¦æ©åèç¹ç©ºé´ï¼å¹¶ä¸åé¢åçè¿éæ´æ°\n\n\n\nè½ç¶è¿éæ´æ°å¤æåº¦å¾é«ï¼ä½æ¯é æçå¯è½æ§å¾ä½ã\n\n * é¿åº¦éè¦å¨ 250 å° 253 å­èä¹é´\n * è¢«æ´æ°çèç¹æ°éä¸å¤ï¼ä¹ä¸ä¼é ææ§è½å½±å\n\nä¼ç¹\n\n * åå­å°åè¿ç»­ï¼åå°äºåå­ç¢çåï¼å¯ä»¥ä½¿ç¨å°ç¼å­è¿è¡ä¼å\n * å¦ææ¯ååé¾è¡¨ï¼èç¹çå¤´å°¾é½éè¦æéæ¥æåä¸ä¸ä¸ªæèä¸ä¸ä¸ªèç¹ï¼èåç¼©åè¡¨çå»äºè¯¥é¨ååå­ç©ºé´çå ç¨ã\n\nç¼ºç¹\n\n * å¯¹äºå é¤åæå¥æä½é½éè¦ç§»å¨è¯¥èç¹ä½ç½®åé¢çåç´ ï¼å¹¶ä¸å¯è½ä¼è§¦åè¿éæ´æ°ååº\n\n\n# 2.4 å¿«éåè¡¨(quicklist)\n\nquicklist æ¯åç¼©åè¡¨åååé¾è¡¨ç»åå®ç°çï¼å¨å®è§ä¸å®æ¯ä¸ä¸ªååé¾è¡¨ï¼ç¶åå¶æ¯ä¸ªç»ç¹ä¸é½æäºä¸ä¸ª ziplistãå¦ä¸å¾æç¤ºï¼\n\nziplist å¨åè¡¨æ°éå¤§çæ¶åæ§è½ä¼ä¸éï¼å¾é¾åéä¸å¤§åè¿ç»­çåå­ç©ºé´ï¼å¹¶ä¸å¨å é¤åæå¥æä½æ§è½ä¸éçæ´ä¸ºåå®³ã\n\nèååé¾è¡¨ä¼å¯¼è´å¤§éçç¢çåç©ºé´ï¼èä¸æ¯ä¸ªèç¹çå¤´å°¾æéé½ä¼å ç¨ä¸å®çåå­ç©ºé´ã\n\nè quicklist ç®æ¯å¨ä¸¤èä¹é´åå¾äºä¸ä¸ªå¹³è¡¡ã\n\n\n# 2.5 ä½¿ç¨åºæ¯\n\n * æ¶æ¯éå\n * åè¡¨ååé¡µå±ç¤º\n\n\n# 3. Set\n\næ¯ä¸ä¸ªæ åºçéåï¼éååç´ æ¯å¯ä¸çï¼ä¼èªå¨å¯¹æ·»å çæ°æ®è¿è¡å»éã\n\n\n# 3.1 ç®åä½¿ç¨\n\nå½ä»¤          è¯´æ\nSADD        åéåæ·»å ä¸ä¸ªæå¤ä¸ªåç´ \nSCARD       è·åéåçæ°é\nSMEMBERS    è·åéåå¨é¨åç´ \nSISMEMBER   å¤æ­éåä¸­æ¯å¦æå®åç´ \n\n127.0.0.1:6379> sadd myset zheng wen feng zheng\n(integer) 3\n\n127.0.0.1:6379> scard myset\n(integer) 3\n\n127.0.0.1:6379> smembers myset\n1) "zheng"\n2) "feng"\n3) "wen"\n\n127.0.0.1:6379> sismember myset feng\n(integer) 1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# 3.2 æ°æ®ç¼ç \n\nè¯¥æ°æ®ç±»åä½¿ç¨æ°æ®ç¼ç çæ¯ intset æè hashtableï¼å½ set æ»¡è¶³ä»¥ä¸æ¡ä»¶æ¶ï¼ä½¿ç¨ç insetï¼å¶ä»æåµé½æ¯ hashtableã\n\n * å½ææçåç´ é½æ¯æ´æ°å¼æ¶\n * åç´ ä¸ªæ°ä¸è¶è¿ 512 ä¸ªæ¶\n\n127.0.0.1:6379> sadd myset2 1 2 4 4\n(integer) 3\n\n127.0.0.1:6379> SMEMBERS myset2\n1) "1"\n2) "2"\n3) "4"\n\n127.0.0.1:6379> OBJECT ENCODING myset2\n"intset"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# 3.3 æ´åæ°ç»(intset)\n\nintset æ°æ®ç»æå¦ä¸æç¤ºï¼\n\ntypedef struct intset {\n    // ç¼ç æ¹å¼\n    uint32_t encoding;\n    // éååå«çåç´ æ°é\n    uint32_t length;\n    // ä¿å­åç´ çæ°ç»\n    int8_t contents[];\n} intset;\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * encodingï¼contents ä¸­å­å¨çæ°æ®ç±»ååå³äºè¯¥å­æ®µ\n * length: æ°ç»é¿åº¦\n * contnets: å­å¨æ°æ®çæ´åæ°ç»ï¼æ°æ®çæ°æ®ç±»ååå³äº encodingï¼ä»å°å°å¤§æåº\n\ncontents æ°ç»ä¸­æ¯ä¸ä¸ªåç´ çç±»åé½æ¯ç± encoding å³å®çï¼ä½æ¯å½åæ¥çæ°æ®ç±»åæ¯ int16 æ¶ï¼ç°å¨è¦æå¥ä¸ä¸ª int32 æ¶ï¼è¯¥å¦ä½æä½å¢ï¼\n\nåçº§\n\nè¿ä¸ªæ¶åéè¦å¯¹ contents ä¸­çæ¯ä¸ªåç´ é½è¿è¡åçº§ï¼\n\n * æ ¹æ®æ°åç´ çç±»åï¼æ©å¤§ contents æ°ç»çç©ºé´å¤§å°\n * å°æ°ç»çææåç´ è½¬æ¢ææ°åç´ ç¸åçç±»åå¹¶æ¾å¥æ°ç»ä¸­\n * æåæ¹å encoding çå¼\n\nè¿ä¹åçå¥½å¤æ¯ï¼å½ææçæ°æ®é½æ¯å°æ´åæ¶ï¼å¯ä»¥èçåå­çå¼éã\n\nç®åä¸æ¯æéçº§ã\n\n\n# 3.4 ä½¿ç¨åºæ¯\n\n * æ ç­¾ï¼ç»ç¨æ·æä¸æ ç­¾ï¼ä»¥æ ç­¾ä¸º keyï¼ç¨æ· ID ä¸º value æ¾å¥ set ä¸­\n * ç¹èµï¼æ¶èç­ï¼å©ç¨ set çå¯ä¸ç¹æ§ã\n\n\n# 4. Sorted Set\n\næ¯ä¸ä¸ªä¸åè®¸éå¤åç´ çéåï¼ä½æ¯æ¯ä¸ªåç´ ä¼å³èä¸ä¸ªåæ°ï¼å¯ä»¥éè¿åæ°å¯¹éåè¿è¡æåºã\n\n\n# 4.1 ç®åä½¿ç¨\n\nå½ä»¤       è¯´æ\nZADD     åéåæ·»å ä¸ä¸ªæå¤ä¸ªåç´ \nZRANGE   æ ¹æ®ä½ç½®æ¥è¯¢è·åéåå¤ä¸ªåç´ \nZREM     å¦æåç´ å­å¨éåä¸­ï¼åè¿è¡å é¤\n\n127.0.0.1:6379> zadd myzset 100 zheng 99 wen 80 feng\n(integer) 3\n\n127.0.0.1:6379> zrange myzset 0 -1\n1) "feng"\n2) "wen"\n3) "zheng"\n\n127.0.0.1:6379> zadd myzset 91 hello\n(integer) 1\n\n# é»è®¤æ¯æ ¹æ®scoreååºæ¥è¯¢\n127.0.0.1:6379> zrange myzset 0 -1\n1) "feng"\n2) "hello"\n3) "wen"\n4) "zheng"\n\n127.0.0.1:6379> zrem myzset wen\n(integer) 1\n\n127.0.0.1:6379> zrange myzset 0 -1\n1) "feng"\n2) "hello"\n3) "zheng"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n\n# 4.2 æ°æ®ç¼ç \n\nè¯¥ç±»åçæ°æ®ç¼ç å¯ä»¥ä¸º ziplist æè skiplistï¼å½æ»¡è¶³ä»¥ä¸æ¡ä»¶æ¶ï¼ä½¿ç¨ç ziplistï¼å¶ä»æåµæ¯ skiplist\n\n * åç´ æ°éå°äº 128\n * æç´¢åç´ é¿åº¦å°äº 64\n\nå½æ°æ®ç¼ç ä¸º skiplist æ¶ï¼redis ä¸­ä½¿ç¨çå­å¨ç»ææ¯ zset æ°æ®ç»æï¼å¶ä¸­åå«äº zskiplist å dict\n\ntypedef struct zset {\n    zskiplist *zs1;\n    dict *dict;\n}\n\n\n1\n2\n3\n4\n\n\néè¿ zskiplist å¯ä»¥å¿«éçèå´æ¥è¯¢ï¼dict å¯ä»¥å¿«éå®ä½åä¸ªåç´ ã\n\n\n# 4.3 è·³è¡¨(skiplist)\n\nå¨æåºçé¾è¡¨ä¸æ·»å äºå¤çº§ç´¢å¼ï¼éè¿ç´¢å¼ä½ç½®çè·³è½¬ï¼å®ç°æ°æ®çå¿«éå®ä½ãå¦ä¸å¾æç¤ºï¼\n\nä¼ç¹ï¼\n\n 1. å¨éè¿èå´æ¥è¯¢ææåºæ¶ï¼å¯ä»¥å¨è·³è¡¨ä¸­åæ¾å°æå°å¼ï¼ç¶ååå¨æåºå±é¾è¡¨ä¸­éåè·åã\n\n\n# 4.4 ä½¿ç¨åºæ¯\n\n * æè¡æ¦ï¼éè¿ç»è§é¢ãæç« æåï¼ç¶åè¿è¡æåºå±ç¤º\n\n\n# 5. hash\n\nç¨äºå­å¨ string ç±»åçé®å¼å¯¹ï¼éç¨äºå­å¨å¯¹è±¡ã\n\n\n# 5.1 ç®åä½¿ç¨\n\nå½ä»¤        è¯´æ\nhset      è®¾ç½®é®å¼å¯¹\nhget      è·åæå® hash çé®å¯¹åºçå¼\nhgetall   è·åæå® hash ä¸­çææé®å¼å¯¹\nhdel      å é¤æå® hash ä¸­çé®å¼å¯¹\n\n127.0.0.1:6379> hset person name zhangsan\n(integer) 1\n\n127.0.0.1:6379> hset person age 18\n(integer) 1\n\n127.0.0.1:6379> hget persion name\n"zhangsan"\n\n127.0.0.1:6379> hgetall person\n1) "name"\n2) "zhangsan"\n3) "age"\n4) "18"\n\n127.0.0.1:6379> hdel person age\n(integer) 1\n\n127.0.0.1:6379> hgetall person\n1) "name"\n2) "zhangsan"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# 5.2 æ°æ®ç¼ç \n\nä½¿ç¨çæ°æ®ç¼ç æ¯ ziplist æ hashtableï¼æ»¡è¶³ä»¥ä¸æ¡ä»¶éæ©ä½¿ç¨ ziplistï¼å¶ä»æåµä½¿ç¨ hashtable\n\n * hash å¯¹è±¡ä¿å­çé®åå¼å­ç¬¦ä¸²é¿åº¦é½å°äº 64 å­è\n * hash å¯¹è±¡ä¿å­çé®å¼å¯¹æ°éå°äº 512\n\n\n# 5.3 ä½¿ç¨åºæ¯\n\n * ç¨æ¥å­å¨å¯¹è±¡ä¿¡æ¯\n\n\n# 6. æ»ç»\n\nredis ä¹æä»¥å¿«ï¼æ­£æ¯å ä¸ºå¶æçä¸°å¯çæ°æ®ç»æï¼æä»¥æä»¬éè¦çè§£å®ä»¬ï¼å¨è®¾è®¡æ¹æ¡æ¶ï¼å°±è½æ­£ç¡®çéæ©æ°æ®ç±»åæ¥å®ç°æä»¬çä¸å¡éæ±ã\n\n\n# 7. ç¸å³é¾æ¥\n\n * Redis è®¾è®¡ä¸å®ç°\n * å¾è§£ redis äºç§æ°æ®ç»æåºå±å®ç°\n * Redis è®¾è®¡ä¸å®ç°\n * æ¬æä¸»è¦æ¯å­¦ä¹ ãæå®¢æ¶é´-redis æ ¸å¿ææ¯ä¸å®æãä¸æ æ»ç»èæ¥',normalizedContent:'# 0. åè¨\n\næ¬æä¸»è¦è®²è§£ redis çäºç§åºæ¬æ°æ®ç±»åï¼stringãlistãsetãsorted setãhashãå­¦ä¹ å¦ä½ä½¿ç¨å®ä»¬ï¼å¹¶ä¸äºè§£å®ä»¬çåºå±æ°æ®ç»æå®ç°ï¼è¿æ ·æä»¬æè½å¨éå½çåºç¨åºæ¯éæ©æéåçæ°æ®ç±»åæ¥è§£å³æä»¬çéæ±ã\n\n\n# 1. string\n\n\n# 1.1 ç®åä½¿ç¨\n\nstring æ¯ redis æç®åçä¸æå¸¸ç¨çæ°æ®ç±»åï¼å¯ä»¥ç¨æ¥å­å¨å­ç¬¦ä¸²ãæ´åä»¥åæµ®ç¹åã\n\n * å­ç¬¦ä¸²\n\n127.0.0.1:6379> set name zhangsan\nok\n127.0.0.1:6379> get name\n"zhangsan"\n\n\n1\n2\n3\n4\n\n * æ´å\n\nè½ç¶ get age æ¶è¿åçæ¯å­ç¬¦ä¸²ï¼ä½æ¯å¯ä»¥éè¿ object encoding age çå°å¶çæ­£çç±»åã\n\n127.0.0.1:6379> set age 18\nok\n127.0.0.1:6379> get age\n"18"\n127.0.0.1:6379> object encoding age\n"int"\n\n# èªå¢\n127.0.0.1:6379> incr age\n(integer) 19\n\n# èªå\n127.0.0.1:6379> decr age\n(integer) 18\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n * æµ®ç¹å\n\nåå¥çæµ®ç¹åï¼ä½è¿æ¯éè¿å­ç¬¦ä¸²æ¥ä¿å­çï¼ä½æ¯å¨ä½¿ç¨çæ¶åï¼ä¼å°å­ç¬¦ä¸²è½¬æ¢ææµ®ç¹æ°ã\n\n127.0.0.1:6379> set height 1.77\nok\n127.0.0.1:6379> get height\n"1.77"\n127.0.0.1:6379> object encoding height\n"embstr"\n\n# æµ®ç¹æ°æä½\n127.0.0.1:6379> incrbyfloat height 1\n"2.77"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næ´å¤çæä½è¯·åèå®ç½\n\n\n# 1.2 æ°æ®ç¼ç \n\nstring æ¯æçç¼ç ç±»åæ intãembstr å rawï¼å¨ä¸åæ¡ä»¶æ¶ï¼ä¼è½¬æ¢æå¯¹åºçç¼ç ã\n\n * int å½å­å¨çæ°æ®ä¸ºæ´åæ¶ï¼ä¼ä½¿ç¨ int ç¼ç ãå¶å®ç°æ¯ï¼ä¼ç´æ¥å°æ´åå¼å­å¨å¨ redisobject ç ptrï¼å° void* è½¬æ¢æ longï¼ ä¸­ï¼å¹¶ä¸å°å­ç¬¦ä¸²çå¯¹è±¡çç¼ç è®¾ç½®ä¸º intã\n\n * raw è¯¥ç§ç¼ç æ¯ä½¿ç¨ä¸ç§ç®åå¨æå­ç¬¦ä¸²(sds)çæ°æ®ç»æå­å¨ï¼å½å­ç¬¦ä¸²çé¿åº¦å¤§äº 44 æ¶ï¼ä¼ä½¿ç¨è¯¥ç§æ°æ®ç¼ç æ¹å¼ã\n\n * embstr ä¹æ¯ä½¿ç¨ ç®åå¨æå­ç¬¦ä¸²(sds)çæ°æ®ç»æå­å¨ï¼æ¯å½å­ç¬¦ä¸²é¿åº¦å°äºç­äº 44 æ¶ä½¿ç¨ã\n\nembstr å raw çåºå«æ¯ä»ä¹å¢ï¼\n\nåå»º string ä½¿ç¨ raw ç¼ç æ¶ï¼ä¼è°ç¨ä¸¤æ¬¡åå­åéæ¥åå»º redisobject å sds çæ°æ®ç»æï¼è embstr åªä¼è°ç¨ä¸æ¬¡æ¥åå»ºè¿ç»­çåå­ç©ºé´æ¥å­å¨ redisobject å sds ã\n\nå½å­ç¬¦ä¸²è¾å°æ¶ï¼embstr å°è°ç¨ä¸æ¬¡åå­åéï¼éæ¾ä¹åªéè¦ä¸æ¬¡ï¼ææ¾æ´å¿«ï¼å¹¶ä¸è¿ç»­çåå­ç©ºé´å¯ä»¥æ´å¥½çå©ç¨ cpu ç¼å­ã\n\n\n# 1.3 ç®åå¨æå­ç¬¦ä¸²(sds)\n\nå¨æ°æ®ç¼ç ä¸­æå° embstr å raw é½æ¯ä½¿ç¨ sds æ°æ®ç»æï¼é£ä¹è¿ç§æ°æ®ç»æçæ¯æä¹æ ·çï¼æä»ä¹å¥½å¤å¢ï¼\n\næ°æ®ç»æå¦ä¸å¾æç¤ºï¼\n\nstruct sdshdr {\n    //è®°å½bufæ°ç»ä¸­å·²ä½¿ç¨å­èçæ°éï¼ç­äºsdsæä¿å­å­ç¬¦ä¸²çé¿åº¦\n    int len;\n \n    //è®°å½buf æ°ç»ä¸­æªä½¿ç¨å­èçæ°é\n    int free;\n \n    //å­èæ°ç»ï¼ç¨äºä¿å­å­ç¬¦ä¸²\n    char buf[];\n};\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n * free: è¡¨ç¤ºè¿æå¤å°ç©ºä½ç©ºé´\n * len: å·²ä½¿ç¨å¤å°ç©ºé´\n * buf: å­å¨å­ç¬¦ä¸²çæ°ç»\n\né®é¢ï¼string ä¸ºä»ä¹ä½¿ç¨ç®åå¨æå­ç¬¦ä¸²æ¥å®ç°ï¼èä¸æ¯ä½¿ç¨ c ä¼ ç»å­ç¬¦ä¸²æ¥å®ç°å¢ï¼\n\n * é²æ­¢ç¼å­åºæº¢åº\n\nå¨æ©åå­ç¬¦ä¸²æ¶ï¼éè¦èèç¼å²åºæ¯å¦è¶³å¤ï¼sds æä¾ api æ¥å¸®å©æä»¬å¤æ­å¹¶æ©åç©ºé´ã\n\n * å¸¸æ°è·åå­ç¬¦ä¸²é¿åº¦\n\nc ä¼ ç»å­ç¬¦ä¸²éè¦éåæè½ç¥éå·ä½çé¿åº¦ï¼æ¶é´å¤æåº¦ä¸º o(n)ï¼è sds å¯ä»¥ç´æ¥è¯» len å±æ§è·åé¿åº¦ï¼æ¶é´å¤æåº¦ä¸º o(1)\n\n * åå°åå­åéçæ¬¡æ°\n\nå¨æ©å¤§å­ç¬¦ä¸²é¿åº¦æ¶ï¼éè¦éæ°ç³è¯·æ´å¤§çåå­ç©ºé´ï¼ç¶åæ·è´å°æ°çåå­ç©ºé´ä¸­ï¼ç¶ååéæ¾æ§çåå­ç©ºé´ã\n\nå¨ç¼©å°æ¶ä¹æ¯ä¸æ ·ï¼éè¦ç³è¯·æ°çç©ºé´ï¼åéæ¾æ§çç©ºé´ã\n\nå¨ sds ä¸­å¯ä»¥éè¿ä»¥ä¸çæ¹å¼æ¥åå°åå­åéåéæ¾ï¼æé«æçã\n\n 1. ç©ºé´é¢åéï¼å¨åéç©ºé´æ¶ï¼é¤äºå¿è¦çç©ºé´å¤ï¼å¯ä»¥é¢å¤çåéæªä½¿ç¨çç©ºé´ï¼å¨ä¸æ¬¡ä½¿ç¨ï¼å¯ä»¥å¿«éä½¿ç¨è¿é¨åçç©ºé´ï¼èä¸å¿éæ°åéã\n 2. æ°æ§éæ¾ç©ºé´ï¼å¨ç¼©å°å­ç¬¦ä¸²æ¶ï¼ä¸éè¦é©¬ä¸éæ¾å¤ä½çç©ºé´ï¼å¯ä»¥é¢çç»ä¸æ¬¡ä½¿ç¨ã\n\n * äºè¿å¶å®å¨\n\nc è¯­è¨ä¸­æ¯ä»¥ç©ºå­ç¬¦æ¥è¡¨ç¤ºå­ç¬¦ä¸²çç»æï¼èä¸äºäºè¿å¶æä»¶åå®¹å¯è½æ¯åå«ç©ºå­ç¬¦ä¸²çï¼å æ­¤ c è¯­è¨å­ç¬¦ä¸²æ æ³æ­£ç¡®è¯»åï¼æä»¥ sds é½æ¯ä»¥äºè¿å¶æ¹å¼å¤ç bufï¼å¹¶ä¸ä¸ä»¥ç©ºå­ç¬¦ä¸²å¤æ­æ¯å¦ç»æï¼èæ¯ç¨ len æ¥å¤æ­ã\n\n\n# 1.4 ä½¿ç¨åºæ¯\n\n * ç¼å­ï¼å­å¨ç­ç¹æ°æ®ä½ä¸ºç¼å­ï¼éä½æä¹åæ°æ®åºçè¯»åååã\n * åå¸å¼é\n * è®¡æ°å¨ï¼å¯ä»¥ä½¿ç¨ incr å½ä»¤\n\n\n# 2. list\n\n\n# 2.1 ç®åä½¿ç¨\n\nå½ä»¤       è¯´æ\nlpush    å°å¼ä»å·¦è¾¹æ¨å¥åè¡¨\nrpush    å°å¼ä»å³è¾¹æ¨å¥åè¡¨\nlpop     å°å¼ä»åè¡¨å·¦è¾¹å¼¹åºè¿å\nrpop     å°å¼ä»åè¡¨å³è¾¹å¼¹åºè¿å\nlrange   æ ¹æ®ç´¢å¼æ¥çåè¡¨ä¸­çæ°æ®\n\n127.0.0.1:6379> lpush mylist 1 2 3\n(integer) 3\n\n127.0.0.1:6379> lrange mylist 0 -1\n1) "3"\n2) "2"\n3) "1"\n\n127.0.0.1:6379> rpush mylist 4\n(integer) 4\n\n127.0.0.1:6379> lrange mylist 0 -1\n1) "3"\n2) "2"\n3) "1"\n4) "4"\n\n127.0.0.1:6379> lpop mylist\n"3"\n\n127.0.0.1:6379> lrange mylist 0 -1\n1) "2"\n2) "1"\n3) "4"\n\n127.0.0.1:6379> rpop mylist\n"4"\n\n127.0.0.1:6379> lrange mylist 0 -1\n1) "2"\n2) "1"\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# 2.2 æ°æ®ç¼ç \n\nå¨ redis3.2 ä¹åä½¿ç¨çæ¯ ziplist å linkedlist ä¸¤ç§ç¼ç æ¹å¼ãå¨æ°æ®éå°çæ¶åä½¿ç¨ ziplistï¼èæ°æ®å¤çæ¶åä½¿ç¨ linkedlistã\n\nèä¹åççæ¬ä½¿ç¨çæ¯ quicklist\n\n127.0.0.1:6379> object encoding mylist\n"quicklist"\n\n\n1\n2\n\n\n\n# 2.3 åç¼©åè¡¨(ziplist)\n\nè¯¥æ°æ®ç»æç±»ä¼¼äºä¸ä¸ªæ°ç»ï¼å¨æ°ç»çè¡¨å¤´æ·»å ä¸ä¸ªå­æ®µ zlbytesãzltailãzlenï¼åå¨è¡¨å°¾æ·»å  zlend è¡¨ç¤ºåè¡¨ç»æã\n\n\n\n * zlbytesï¼åå­å­èæ°\n * zltailï¼åè¡¨å°¾åç§»é\n * zllenï¼åè¡¨åç´ ä¸ªæ°\n * zlendï¼åè¡¨ç»ææ è®°\n\néè¿è¿å ä¸ªå­æ®µå¯ä»¥å¿«éå®ä½ç¬¬ä¸ä¸ªåç´ åæååç´ ï¼æ¶é´å¤æåº¦ä¸º o(1)ã\n\né¤äºè¡¨å¤´ä¸è¡¨å°¾ä¹å¤ï¼å¶ä»åç´ é½æ¯èç¹ï¼èç¹çæ°æ®ç»æå¦ä¸å¾ï¼\n\n\n\n * previous_entry_length : ä¸ä¸ä¸ªèç¹çé¿åº¦ãå¯ä»¥æ¨ç®åºä¸ä¸ä¸ªèç¹çå°å\n * encoding: è¯¥èç¹çæ°æ®ç±»ååé¿åº¦\n * content: èç¹çå¼\n\nè¿éæ´æ°é®é¢\n\nå¯¹äº previous_entry_lengthï¼\n\n * åä¸ä¸ªèç¹é¿åº¦å°äº 254 å­èï¼previous_entry_length é¿åº¦éè¦ç¨ 1 å­èä¿å­é¿åº¦å¼\n * åä¸ä¸ªèç¹é¿åº¦å¤§äº 254 å­èï¼previous_entry_length é¿åº¦éè¦ç¨ 5 å­èä¿å­é¿åº¦å¼\n\næè¿ä¸ç§åºæ¯ï¼å¦æåç¼©åè¡¨ä¸­æå¤ä¸ªè¿ç»­çèç¹é¿åº¦å¨ 250-253 å­èä¹é´ï¼è¿äºèç¹ previous_entry_length ä½¿ç¨ 1 ä¸ªå­èå­å¨å¤§å°ã\n\n * å½å¨æåæ¹æ·»å ä¸ä¸ªèç¹å¤§äºç­äº 254 å­èçèç¹æ¶ï¼åé¢çèç¹ previous_entry_length é½éè¦ä» 1 å­èæ©åå° 5 å­èï¼èµ·å°è¿éæ´æ°ï¼åé¢çèç¹é½éè¦æ´æ°ã\n\n\n\n * å½å é¤å¶ä¸­ small èç¹æ¶ï¼å¶åèç¹ previous_entry_length éè¦ä¿å­åé¢ç big èç¹ï¼éè¦æ©åèç¹ç©ºé´ï¼å¹¶ä¸åé¢åçè¿éæ´æ°\n\n\n\nè½ç¶è¿éæ´æ°å¤æåº¦å¾é«ï¼ä½æ¯é æçå¯è½æ§å¾ä½ã\n\n * é¿åº¦éè¦å¨ 250 å° 253 å­èä¹é´\n * è¢«æ´æ°çèç¹æ°éä¸å¤ï¼ä¹ä¸ä¼é ææ§è½å½±å\n\nä¼ç¹\n\n * åå­å°åè¿ç»­ï¼åå°äºåå­ç¢çåï¼å¯ä»¥ä½¿ç¨å°ç¼å­è¿è¡ä¼å\n * å¦ææ¯ååé¾è¡¨ï¼èç¹çå¤´å°¾é½éè¦æéæ¥æåä¸ä¸ä¸ªæèä¸ä¸ä¸ªèç¹ï¼èåç¼©åè¡¨çå»äºè¯¥é¨ååå­ç©ºé´çå ç¨ã\n\nç¼ºç¹\n\n * å¯¹äºå é¤åæå¥æä½é½éè¦ç§»å¨è¯¥èç¹ä½ç½®åé¢çåç´ ï¼å¹¶ä¸å¯è½ä¼è§¦åè¿éæ´æ°ååº\n\n\n# 2.4 å¿«éåè¡¨(quicklist)\n\nquicklist æ¯åç¼©åè¡¨åååé¾è¡¨ç»åå®ç°çï¼å¨å®è§ä¸å®æ¯ä¸ä¸ªååé¾è¡¨ï¼ç¶åå¶æ¯ä¸ªç»ç¹ä¸é½æäºä¸ä¸ª ziplistãå¦ä¸å¾æç¤ºï¼\n\nziplist å¨åè¡¨æ°éå¤§çæ¶åæ§è½ä¼ä¸éï¼å¾é¾åéä¸å¤§åè¿ç»­çåå­ç©ºé´ï¼å¹¶ä¸å¨å é¤åæå¥æä½æ§è½ä¸éçæ´ä¸ºåå®³ã\n\nèååé¾è¡¨ä¼å¯¼è´å¤§éçç¢çåç©ºé´ï¼èä¸æ¯ä¸ªèç¹çå¤´å°¾æéé½ä¼å ç¨ä¸å®çåå­ç©ºé´ã\n\nè quicklist ç®æ¯å¨ä¸¤èä¹é´åå¾äºä¸ä¸ªå¹³è¡¡ã\n\n\n# 2.5 ä½¿ç¨åºæ¯\n\n * æ¶æ¯éå\n * åè¡¨ååé¡µå±ç¤º\n\n\n# 3. set\n\næ¯ä¸ä¸ªæ åºçéåï¼éååç´ æ¯å¯ä¸çï¼ä¼èªå¨å¯¹æ·»å çæ°æ®è¿è¡å»éã\n\n\n# 3.1 ç®åä½¿ç¨\n\nå½ä»¤          è¯´æ\nsadd        åéåæ·»å ä¸ä¸ªæå¤ä¸ªåç´ \nscard       è·åéåçæ°é\nsmembers    è·åéåå¨é¨åç´ \nsismember   å¤æ­éåä¸­æ¯å¦æå®åç´ \n\n127.0.0.1:6379> sadd myset zheng wen feng zheng\n(integer) 3\n\n127.0.0.1:6379> scard myset\n(integer) 3\n\n127.0.0.1:6379> smembers myset\n1) "zheng"\n2) "feng"\n3) "wen"\n\n127.0.0.1:6379> sismember myset feng\n(integer) 1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# 3.2 æ°æ®ç¼ç \n\nè¯¥æ°æ®ç±»åä½¿ç¨æ°æ®ç¼ç çæ¯ intset æè hashtableï¼å½ set æ»¡è¶³ä»¥ä¸æ¡ä»¶æ¶ï¼ä½¿ç¨ç insetï¼å¶ä»æåµé½æ¯ hashtableã\n\n * å½ææçåç´ é½æ¯æ´æ°å¼æ¶\n * åç´ ä¸ªæ°ä¸è¶è¿ 512 ä¸ªæ¶\n\n127.0.0.1:6379> sadd myset2 1 2 4 4\n(integer) 3\n\n127.0.0.1:6379> smembers myset2\n1) "1"\n2) "2"\n3) "4"\n\n127.0.0.1:6379> object encoding myset2\n"intset"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# 3.3 æ´åæ°ç»(intset)\n\nintset æ°æ®ç»æå¦ä¸æç¤ºï¼\n\ntypedef struct intset {\n    // ç¼ç æ¹å¼\n    uint32_t encoding;\n    // éååå«çåç´ æ°é\n    uint32_t length;\n    // ä¿å­åç´ çæ°ç»\n    int8_t contents[];\n} intset;\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * encodingï¼contents ä¸­å­å¨çæ°æ®ç±»ååå³äºè¯¥å­æ®µ\n * length: æ°ç»é¿åº¦\n * contnets: å­å¨æ°æ®çæ´åæ°ç»ï¼æ°æ®çæ°æ®ç±»ååå³äº encodingï¼ä»å°å°å¤§æåº\n\ncontents æ°ç»ä¸­æ¯ä¸ä¸ªåç´ çç±»åé½æ¯ç± encoding å³å®çï¼ä½æ¯å½åæ¥çæ°æ®ç±»åæ¯ int16 æ¶ï¼ç°å¨è¦æå¥ä¸ä¸ª int32 æ¶ï¼è¯¥å¦ä½æä½å¢ï¼\n\nåçº§\n\nè¿ä¸ªæ¶åéè¦å¯¹ contents ä¸­çæ¯ä¸ªåç´ é½è¿è¡åçº§ï¼\n\n * æ ¹æ®æ°åç´ çç±»åï¼æ©å¤§ contents æ°ç»çç©ºé´å¤§å°\n * å°æ°ç»çææåç´ è½¬æ¢ææ°åç´ ç¸åçç±»åå¹¶æ¾å¥æ°ç»ä¸­\n * æåæ¹å encoding çå¼\n\nè¿ä¹åçå¥½å¤æ¯ï¼å½ææçæ°æ®é½æ¯å°æ´åæ¶ï¼å¯ä»¥èçåå­çå¼éã\n\nç®åä¸æ¯æéçº§ã\n\n\n# 3.4 ä½¿ç¨åºæ¯\n\n * æ ç­¾ï¼ç»ç¨æ·æä¸æ ç­¾ï¼ä»¥æ ç­¾ä¸º keyï¼ç¨æ· id ä¸º value æ¾å¥ set ä¸­\n * ç¹èµï¼æ¶èç­ï¼å©ç¨ set çå¯ä¸ç¹æ§ã\n\n\n# 4. sorted set\n\næ¯ä¸ä¸ªä¸åè®¸éå¤åç´ çéåï¼ä½æ¯æ¯ä¸ªåç´ ä¼å³èä¸ä¸ªåæ°ï¼å¯ä»¥éè¿åæ°å¯¹éåè¿è¡æåºã\n\n\n# 4.1 ç®åä½¿ç¨\n\nå½ä»¤       è¯´æ\nzadd     åéåæ·»å ä¸ä¸ªæå¤ä¸ªåç´ \nzrange   æ ¹æ®ä½ç½®æ¥è¯¢è·åéåå¤ä¸ªåç´ \nzrem     å¦æåç´ å­å¨éåä¸­ï¼åè¿è¡å é¤\n\n127.0.0.1:6379> zadd myzset 100 zheng 99 wen 80 feng\n(integer) 3\n\n127.0.0.1:6379> zrange myzset 0 -1\n1) "feng"\n2) "wen"\n3) "zheng"\n\n127.0.0.1:6379> zadd myzset 91 hello\n(integer) 1\n\n# é»è®¤æ¯æ ¹æ®scoreååºæ¥è¯¢\n127.0.0.1:6379> zrange myzset 0 -1\n1) "feng"\n2) "hello"\n3) "wen"\n4) "zheng"\n\n127.0.0.1:6379> zrem myzset wen\n(integer) 1\n\n127.0.0.1:6379> zrange myzset 0 -1\n1) "feng"\n2) "hello"\n3) "zheng"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n\n# 4.2 æ°æ®ç¼ç \n\nè¯¥ç±»åçæ°æ®ç¼ç å¯ä»¥ä¸º ziplist æè skiplistï¼å½æ»¡è¶³ä»¥ä¸æ¡ä»¶æ¶ï¼ä½¿ç¨ç ziplistï¼å¶ä»æåµæ¯ skiplist\n\n * åç´ æ°éå°äº 128\n * æç´¢åç´ é¿åº¦å°äº 64\n\nå½æ°æ®ç¼ç ä¸º skiplist æ¶ï¼redis ä¸­ä½¿ç¨çå­å¨ç»ææ¯ zset æ°æ®ç»æï¼å¶ä¸­åå«äº zskiplist å dict\n\ntypedef struct zset {\n    zskiplist *zs1;\n    dict *dict;\n}\n\n\n1\n2\n3\n4\n\n\néè¿ zskiplist å¯ä»¥å¿«éçèå´æ¥è¯¢ï¼dict å¯ä»¥å¿«éå®ä½åä¸ªåç´ ã\n\n\n# 4.3 è·³è¡¨(skiplist)\n\nå¨æåºçé¾è¡¨ä¸æ·»å äºå¤çº§ç´¢å¼ï¼éè¿ç´¢å¼ä½ç½®çè·³è½¬ï¼å®ç°æ°æ®çå¿«éå®ä½ãå¦ä¸å¾æç¤ºï¼\n\nä¼ç¹ï¼\n\n 1. å¨éè¿èå´æ¥è¯¢ææåºæ¶ï¼å¯ä»¥å¨è·³è¡¨ä¸­åæ¾å°æå°å¼ï¼ç¶ååå¨æåºå±é¾è¡¨ä¸­éåè·åã\n\n\n# 4.4 ä½¿ç¨åºæ¯\n\n * æè¡æ¦ï¼éè¿ç»è§é¢ãæç« æåï¼ç¶åè¿è¡æåºå±ç¤º\n\n\n# 5. hash\n\nç¨äºå­å¨ string ç±»åçé®å¼å¯¹ï¼éç¨äºå­å¨å¯¹è±¡ã\n\n\n# 5.1 ç®åä½¿ç¨\n\nå½ä»¤        è¯´æ\nhset      è®¾ç½®é®å¼å¯¹\nhget      è·åæå® hash çé®å¯¹åºçå¼\nhgetall   è·åæå® hash ä¸­çææé®å¼å¯¹\nhdel      å é¤æå® hash ä¸­çé®å¼å¯¹\n\n127.0.0.1:6379> hset person name zhangsan\n(integer) 1\n\n127.0.0.1:6379> hset person age 18\n(integer) 1\n\n127.0.0.1:6379> hget persion name\n"zhangsan"\n\n127.0.0.1:6379> hgetall person\n1) "name"\n2) "zhangsan"\n3) "age"\n4) "18"\n\n127.0.0.1:6379> hdel person age\n(integer) 1\n\n127.0.0.1:6379> hgetall person\n1) "name"\n2) "zhangsan"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# 5.2 æ°æ®ç¼ç \n\nä½¿ç¨çæ°æ®ç¼ç æ¯ ziplist æ hashtableï¼æ»¡è¶³ä»¥ä¸æ¡ä»¶éæ©ä½¿ç¨ ziplistï¼å¶ä»æåµä½¿ç¨ hashtable\n\n * hash å¯¹è±¡ä¿å­çé®åå¼å­ç¬¦ä¸²é¿åº¦é½å°äº 64 å­è\n * hash å¯¹è±¡ä¿å­çé®å¼å¯¹æ°éå°äº 512\n\n\n# 5.3 ä½¿ç¨åºæ¯\n\n * ç¨æ¥å­å¨å¯¹è±¡ä¿¡æ¯\n\n\n# 6. æ»ç»\n\nredis ä¹æä»¥å¿«ï¼æ­£æ¯å ä¸ºå¶æçä¸°å¯çæ°æ®ç»æï¼æä»¥æä»¬éè¦çè§£å®ä»¬ï¼å¨è®¾è®¡æ¹æ¡æ¶ï¼å°±è½æ­£ç¡®çéæ©æ°æ®ç±»åæ¥å®ç°æä»¬çä¸å¡éæ±ã\n\n\n# 7. ç¸å³é¾æ¥\n\n * redis è®¾è®¡ä¸å®ç°\n * å¾è§£ redis äºç§æ°æ®ç»æåºå±å®ç°\n * redis è®¾è®¡ä¸å®ç°\n * æ¬æä¸»è¦æ¯å­¦ä¹ ãæå®¢æ¶é´-redis æ ¸å¿ææ¯ä¸å®æãä¸æ æ»ç»èæ¥',charsets:{cjk:!0},lastUpdated:"2023/11/01, 11:48:43",lastUpdatedTimestamp:1698810523e3},{title:"redisä¹æä¹å",frontmatter:{title:"redisä¹æä¹å",date:"2022-12-01T15:18:02.000Z",permalink:"/pages/4c6b13/",tags:["redis","æ°æ®åº"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä¸»è¦æ¯ä»ç» redis æ¯å¦ä½è¿è¡æä¹åæ°æ®çï¼æä»¬ç¥é redis æ¯åºäºåå­çæ°æ®åºï¼é£ä¹åªè¦æå¡å¨ä¸æ¦å®æºï¼é£ä¹æ°æ®åå°å¨é¨ä¸¢å¤±ï¼å¦æä»åç«¯æ°æ®åºè¿è¡æ¢å¤ï¼åå¯è½å¯¼è´æ§è½åæ¢ï¼é£ä¹ redis éè¦èªèº«æä¹åï¼èä¸éè¿åç«¯æ°æ®åºæ¥æ¢å¤æ°æ®æ¯éè¦çã",feed:{enable:!0},categories:["æ°æ®åº","redis"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210805185829.png"},{name:"twitter:title",content:"redisä¹æä¹å"},{name:"twitter:description",content:"æ¬æä¸»è¦æ¯ä»ç» redis æ¯å¦ä½è¿è¡æä¹åæ°æ®çï¼æä»¬ç¥é redis æ¯åºäºåå­çæ°æ®åºï¼é£ä¹åªè¦æå¡å¨ä¸æ¦å®æºï¼é£ä¹æ°æ®åå°å¨é¨ä¸¢å¤±ï¼å¦æä»åç«¯æ°æ®åºè¿è¡æ¢å¤ï¼åå¯è½å¯¼è´æ§è½åæ¢ï¼é£ä¹ redis éè¦èªèº«æä¹åï¼èä¸éè¿åç«¯æ°æ®åºæ¥æ¢å¤æ°æ®æ¯éè¦çã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210805185829.png"},{name:"twitter:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/02.redis%E4%B9%8B%E6%8C%81%E4%B9%85%E5%8C%96.html"},{property:"og:type",content:"article"},{property:"og:title",content:"redisä¹æä¹å"},{property:"og:description",content:"æ¬æä¸»è¦æ¯ä»ç» redis æ¯å¦ä½è¿è¡æä¹åæ°æ®çï¼æä»¬ç¥é redis æ¯åºäºåå­çæ°æ®åºï¼é£ä¹åªè¦æå¡å¨ä¸æ¦å®æºï¼é£ä¹æ°æ®åå°å¨é¨ä¸¢å¤±ï¼å¦æä»åç«¯æ°æ®åºè¿è¡æ¢å¤ï¼åå¯è½å¯¼è´æ§è½åæ¢ï¼é£ä¹ redis éè¦èªèº«æä¹åï¼èä¸éè¿åç«¯æ°æ®åºæ¥æ¢å¤æ°æ®æ¯éè¦çã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210805185829.png"},{property:"og:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/02.redis%E4%B9%8B%E6%8C%81%E4%B9%85%E5%8C%96.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-12-01T15:18:02.000Z"},{property:"article:tag",content:"redis"},{property:"article:tag",content:"æ°æ®åº"},{itemprop:"name",content:"redisä¹æä¹å"},{itemprop:"description",content:"æ¬æä¸»è¦æ¯ä»ç» redis æ¯å¦ä½è¿è¡æä¹åæ°æ®çï¼æä»¬ç¥é redis æ¯åºäºåå­çæ°æ®åºï¼é£ä¹åªè¦æå¡å¨ä¸æ¦å®æºï¼é£ä¹æ°æ®åå°å¨é¨ä¸¢å¤±ï¼å¦æä»åç«¯æ°æ®åºè¿è¡æ¢å¤ï¼åå¯è½å¯¼è´æ§è½åæ¢ï¼é£ä¹ redis éè¦èªèº«æä¹åï¼èä¸éè¿åç«¯æ°æ®åºæ¥æ¢å¤æ°æ®æ¯éè¦çã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210805185829.png"}],readingShow:"top"},regularPath:"/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/02.redis%E4%B9%8B%E6%8C%81%E4%B9%85%E5%8C%96.html",relativePath:"03.ä¸­é´ä»¶/05.redis/02.redisä¹æä¹å.md",key:"v-d04209ac",path:"/pages/4c6b13/",headers:[{level:2,title:"0. åè¨",slug:"_0-åè¨",normalizedTitle:"0. åè¨",charIndex:2},{level:2,title:"1. AOF",slug:"_1-aof",normalizedTitle:"1. aof",charIndex:143},{level:3,title:"1.1 ä¸ºä»ä¹æ¯ AOF ?",slug:"_1-1-ä¸ºä»ä¹æ¯-aof",normalizedTitle:"1.1 ä¸ºä»ä¹æ¯ aof ?",charIndex:204},{level:3,title:"1.2 AOF éåæºå¶",slug:"_1-2-aof-éåæºå¶",normalizedTitle:"1.2 aof éåæºå¶",charIndex:461},{level:2,title:"2. RDB åå­å¿«ç§",slug:"_2-rdb-åå­å¿«ç§",normalizedTitle:"2. rdb åå­å¿«ç§",charIndex:1331},{level:2,title:"3. æ»ç»",slug:"_3-æ»ç»",normalizedTitle:"3. æ»ç»",charIndex:2178},{level:2,title:"4. åèæç« ",slug:"_4-åèæç« ",normalizedTitle:"4. åèæç« ",charIndex:2449}],headersStr:"0. åè¨ 1. AOF 1.1 ä¸ºä»ä¹æ¯ AOF ? 1.2 AOF éåæºå¶ 2. RDB åå­å¿«ç§ 3. æ»ç» 4. åèæç« ",content:"# 0. åè¨\n\næ¬æä¸»è¦æ¯ä»ç» redis æ¯å¦ä½è¿è¡æä¹åæ°æ®çï¼æä»¬ç¥é redis æ¯åºäºåå­çæ°æ®åºï¼é£ä¹åªè¦æå¡å¨ä¸æ¦å®æºï¼é£ä¹æ°æ®åå°å¨é¨ä¸¢å¤±ï¼å¦æä»åç«¯æ°æ®åºè¿è¡æ¢å¤ï¼åå¯è½å¯¼è´æ§è½åæ¢ï¼é£ä¹ redis éè¦èªèº«æä¹åï¼èä¸éè¿åç«¯æ°æ®åºæ¥æ¢å¤æ°æ®æ¯éè¦çã\n\n\n# 1. AOF\n\nAOFï¼ç§°ä¸ºååæ¥å¿ï¼å°±æ¯åæ§è¡å½ä»¤ï¼ææ°æ®åå¥å°æ°æ®åºä¸­ä¹åï¼åè¿è¡è®°å½æ¥å¿ãè¿ç¨å¦ä¸å¾æç¤ºï¼\n\n\n# 1.1 ä¸ºä»ä¹æ¯ AOF ?\n\nRedis å AOF åæ¥å¿æ¶ï¼å¹¶ä¸ä¼æ ¡éªå½ä»¤çè¯­æ³ï¼å¦æåè®°æ¥å¿ï¼åå¯è½ä¿å­äºéè¯¯çå½ä»¤å¯¼è´åºéãæä»¥è®©ç³»ç»åæ§è¡å½ä»¤ï¼æ§è¡æåååè®°å½æ¥å¿ã\n\nååæ¥å¿ä¹ä¸ä¼é»å¡å½åæä½ï¼ä½æ¯ä¸ä¸æ¬¡æä½æé»å¡é£é©ãAOF ä¹æ¯å¨ä¸»çº¿ç¨æ§è¡ï¼å¦æåå¥çæ¶åç£çååè¿å¤§ï¼å°±å¯è½ä¼å¤§è´é»å¡ã\n\nä½è¯¥ç§æ¹å¼æé£é©ï¼å¦æåå¥åå­æåï¼è®°æ¥å¿æ¶åçå®æºï¼åä¼ä¸¢å¤±æ¥å¿ã\n\næ­£å ä¸ºæè¿ä¸ªé£é©ï¼æä»¥ redis æä¾ä¸ç§åå¥ç­ç¥ï¼\n\nè¿ä¸ç§ç­ç¥å°±æ¯æ§è½ä¸å¯é æ§çæè¡¡ï¼å¯ä»¥æ ¹æ®å·ä½çä¸å¡è¿è¡éæ©ã\n\n\n# 1.2 AOF éåæºå¶\n\nAOF è®°å½çæ¯ Redis çæ¯ä¸æ¡å½ä»¤ï¼ä»¥ææ¬å½¢å¼ä¿å­ï¼é£ä¹å½ AOF æ¥å¿åçè¶æ¥è¶å¤çæ¶åï¼AOF æä»¶è¶æ¥è¶å¤§ï¼ä»¥åéè¿ AOF æ¢å¤æ°æ®ä¹ä¼åå¾å¾æ¢ï¼redis æä¾äº AOF éåæºå¶æ¥åå° AOF æ¥å¿æä»¶ã\n\nå° AOF æä»¶çæçææ°æ°æ®çæææ°çæä½æ¥å¿å¹¶è®°å½å°æ°ç AOF æä»¶ä¸­ï¼è¿æ ·æ°ç AOF æä»¶ä¸­å°±æ²¡æäºåä½å½ä»¤ï¼åæ¿æ¢ææ§ç AOF æä»¶ã\n\nAOF éåè¿ç¨\n\nAOF éåçè¿ç¨ä¼ fork åº bgrewriteof åå°å­è¿ç¨ï¼fork ä¼å°ä¸»çº¿ç¨çæ°æ®åå­æ·è´å°å­è¿ç¨ï¼å­è¿ç¨å¨ä¸å½±åä¸»çº¿ç¨çæåµä¸å°æ·è´çæ°æ®è½¬æ¢ææä½åå¥å°éåæ¥å¿ä¸­ã\n\nå¨éåæ¥å¿æ¶ï¼ä¸»çº¿ç¨ä»»ç¶æ¥åæ°çæä½ï¼æä½ä¼è®°å½å° AOF ç¼å²å AOF éåç¼å²åºï¼AOF æ¥å¿ä¸ä¼ä¸¢å¤±ææ°çæä½ï¼å¨æ·è´æ°æ®éåå®æåï¼åå° AOF éåç¼å²åºçæ¥å¿è®°å½åå¥æ°ç AOF æä»¶ä¸­ï¼ä¿è¯æ°ç AOF æä»¶çæ°æ®ä¹æ¯ææ°çç¶æãæ­¤æ¶å°±å¯ä»¥æ¾å¿å°æ°åå¥ç AOF æä»¶ä»£æ¿æ§æä»¶ã\n\n\n\nåæ¶å¤å¶ copy on write\n\nfork éç¨æä½ç³»ç»ç åæ¶å¤å¶æºå¶ï¼é¿åä¸æ¬¡æ§æ·è´å¤§éåå­æ°æ®ç»å­è¿ç¨ãfork å­è¿ç¨æ¶ï¼å­è¿ç¨ä¼æ·è´ç¶è¿ç¨çåå­é¡µè¡¨(èæåå­åç©çåå­çæ å°ç´¢å¼è¡¨)èä¸ä¼æ·è´å¶ææçç©çåå­æ°æ®ï¼è¿æ ·ä¸¤ä¸ªè¿ç¨ä½¿ç¨çæ°æ®æ¯åä¸ä»½åå­ç©ºé´ãå½ä¸»çº¿ç¨åå¥æ°æ°æ®æ¶ï¼ä¼æ·è´ä¸ä»½æ°æ°æ®å¹¶è¿è¡ä¿®æ¹ï¼è¿æ ·å¹¶ä¸å½±åå­è¿ç¨çè¯»åã\n\nAOF éåé»å¡ç¹\n\n * å¨ fork å­è¿ç¨æ¶ï¼å³ä½¿æ¯æ·è´é¡µè¡¨åä¸äºå¿è¦çæ°æ®ç»æä¹æ¯éè¦æ¶èå¤§éç CPUï¼ä¼å¯¹ä¸»çº¿ç¨è¿è¡é»å¡\n * å¨ AOF éåè¿ç¨ä¸­ï¼å¦ææ big key åå¥æ¶ï¼ä¼æ·è´æ§æ°æ®å°åå»ºçæ°åå­ç©ºé´ä¸­ï¼ä¹ä¼è¿è¡é»å¡ã\n\nAOF éåæ¥å¿ä¸ºä»ä¹ä¸å±äº« AOF æ¬èº«æ¥å¿ï¼\n\n * ä¸¤ä¸ªè¿ç¨æä½åä¸ä¸ªæä»¶ï¼å­å¨ç«äºé®é¢ï¼å½±åç¶è¿ç¨æ§è½\n * å¦æéåå¤±è´¥ï¼AOF æ¥å¿åè¢«æ±¡æäºï¼æ æ³æ¢å¤ä½¿ç¨ãéåä¸ä¸ªæä»¶ï¼å¦æéåå¤±è´¥ï¼å é¤éæ¥å³å¯ã\n\n\n# 2. RDB åå­å¿«ç§\n\nAOF æ¹æ³æ¢å¤æ°æ®éè¦å°æä½æ¥å¿å¨é¨æ§è¡ä¸éï¼å¦ææ¥å¿éå¸¸å¤ï¼åæ¢å¤çè¿ç¨ç¼æ¢ãèåå­å¿«ç§æ¯å°æä¸æ¶å»çæ°æ®ä»¥æä»¶(RDB)è®°å½å°ç£çä¸ï¼å¨æ¢å¤çæ¶åï¼ç´æ¥è¯»å¥åå­å³å¯ã\n\nä¼ä¸ä¼é»å¡ä¸»çº¿ç¨?\n\nRedis æä¾ save å bgsave ä¸¤ä¸ªå½ä»¤çæ RDB æä»¶\n\n * save æ¯å¨ä¸»çº¿ç¨æ§è¡ä¼é»å¡ï¼ä¸å»ºè®®å¨çº¿ä¸ä½¿ç¨\n * bgsave ä¼åå»ºå­è¿ç¨çæ RDBï¼é»è®¤ã\n\nå¦æå¨è§¦åå¿«ç§æ¶ï¼è½ä¿®æ¹æ°æ®åï¼\n\nå¦æå¨ t æ¶å»ï¼éè¦å¿«ç§æ°æ® Aï¼å¨å¿«ç§æ¶ä¿®æ¹äº A æ°æ®ä¸º A'ï¼è¿æ¶ç ´åäºå¿«ç§çå®æ´æ§ï¼è¿æ¶ A'å¹¶ä¸æ¯ t æ¶å»çç¶æã\n\nå¦æå¨å¿«ç§æ¶ï¼ä¸åè®¸ä¿®æ¹ï¼è½ç¶è§£å³äºä¸é¢çé®é¢ï¼ä½æ¯ä¼å½±åä¸å¡ã\n\nè¿éè§£å³åæ³è¿æ¯ä½¿ç¨äºæä½ç³»ç»ç åæ¶å¤å¶æºå¶ï¼å¨æ°çæ°æ®éè¦åå¥æ¶ï¼ä¸»çº¿ç¨ä¼å°è¯¥æ°æ®å¤å¶ä¸ä»½ï¼ç¶åå¯¹è¯¥å¯æ¬è¿è¡ä¿®æ¹ï¼èå­è¿ç¨ä½¿ç¨åæ¥çæ°æ®è¿è¡å¿«ç§ã\n\n\n\næ¢ç¶å¯ä»¥ä½¿ç¨ RDB å¿«éæ¢å¤æ°æ®ï¼é£ä¹æ¯å¦å¯ä»¥æ¯ç§åä¸æ¬¡å¿«ç§å¢ï¼\n\nä¸¤æ¬¡å¿«ç§ä¹é´çæ°æ®ï¼å¦æéå°å®æºï¼å¯è½ä¼åçä¸¢å¤±ï¼æä»¥éè¦å°½éç­çæ¶é´åå¿«ç§ã\n\nä½è½ç¶çæ RDB æä»¶ä½¿ç¨å­è¿ç¨ï¼ä½æ¯é¢ç¹çæ§è¡å¨éå¿«ç§è¿æ¯ä¼å¸¦æ¥é¢å¤çå¼éï¼\n\n * é¢ç¹çåç£çï¼å¢å¤§ç£çåå\n * fork å­è¿ç¨æ¶ï¼å¦ææ°æ®åå­è¿å¤§ï¼æ¯ä¼é»å¡ä¸»çº¿ç¨çã\n\nå¦ä½è§£å³å¿«ç§é´ä¸¢å¤±æ°æ®ï¼\n\nå¢éå¿«ç§ãæ··åä½¿ç¨ AOF æ¥å¿ååå­å¿«ç§ã\n\nä½¿ç¨ AOF è®°å½ä¸¤æ¬¡å¿«ç§é´çæä½ãå¨çæå¿«ç§æ¶ï¼ä½¿ç¨ AOF æ¥å¿è®°å½æ°è¿å¥çä¿®æ¹æä½ï¼å¨ä¸ä¸æ¬¡å¿«ç§åå®æºé½å¯ä»¥éè¿ AOF æ¥å¿è¿è¡æ¢å¤ãä¸ä¸æ¬¡å¿«ç§æ¶å¯ä»¥åæ¸ç©º AOF æ¥å¿éæ°è®°å½\n\n\n\nå¦ä½å¨ AOF å RDB è¿è¡éæ©?\n\n * æ°æ®ä¸è½ä¸¢å¤±æ¶ï¼åå­å¿«ç§å AOF çæ··åä½¿ç¨æ¯ä¸ä¸ªå¾å¥½çéæ©ï¼\n * å¦æåè®¸åéçº§å«çæ°æ®ä¸¢å¤±ï¼å¯ä»¥åªä½¿ç¨ RDBï¼\n * å¦æåªç¨ AOFï¼ä¼åä½¿ç¨ everysec çéç½®éé¡¹ï¼å ä¸ºå®å¨å¯é æ§åæ§è½ä¹é´åäºä¸ä¸ªå¹³è¡¡ã\n\n\n# 3. æ»ç»\n\néè¿ä¸é¢çä»ç»ï¼äºè§£å° RDB å AOF é½æ¯éè¿ fork å­è¿ç¨æ¥å®æçï¼æ¯ä¸ºäºä¸ä¼é æä¸»çº¿ç¨çé»å¡ï¼ä½æ¯ä¹å¹¶ä¸è½å®å¨é¿åï¼æä»¥æä»¬éè¦å°½å¯è½çéä½ fork çé¢çã\n\nå¹¶ä¸é½ä½¿ç¨äºæä½ç³»ç»ç COW æºå¶ï¼è¯¥æºå¶å¯ä»¥å¤§å¤§çåå° cpu ä¸åå­çæ¶èï¼æä»¬å¨å¾å¤ç»ä»¶ä¸­ä¼åç°å®ä»¬é½ç¨å°äº linux çä¸äºå¥½ç¨çæºå¶ï¼å Kafka ç¨å°çé¶æ·è´å PageCache ç­ç­ãæä»¬å¨è®¾è®¡ä¸­éè¦åç¨è¿äºæºå¶ï¼å¯ä»¥éå¸¸å¤§çä¼åç¨åºçæ§è½ï¼å¹¶ä¸ç®åæä»¬éè¦åçæ¶åäº¤ç»æä½ç³»ç»å»å®æï¼å¹¶ä¸å®æçæ¯æä»¬åçæ´å¥½æ´ç¨³å®ã\n\n\n# 4. åèæç« \n\n * æ¬æä¸»è¦æ¯å­¦ä¹ ãæå®¢æ¶é´-redis æ ¸å¿ææ¯ä¸å®æãä¸æ æ»ç»èæ¥",normalizedContent:"# 0. åè¨\n\næ¬æä¸»è¦æ¯ä»ç» redis æ¯å¦ä½è¿è¡æä¹åæ°æ®çï¼æä»¬ç¥é redis æ¯åºäºåå­çæ°æ®åºï¼é£ä¹åªè¦æå¡å¨ä¸æ¦å®æºï¼é£ä¹æ°æ®åå°å¨é¨ä¸¢å¤±ï¼å¦æä»åç«¯æ°æ®åºè¿è¡æ¢å¤ï¼åå¯è½å¯¼è´æ§è½åæ¢ï¼é£ä¹ redis éè¦èªèº«æä¹åï¼èä¸éè¿åç«¯æ°æ®åºæ¥æ¢å¤æ°æ®æ¯éè¦çã\n\n\n# 1. aof\n\naofï¼ç§°ä¸ºååæ¥å¿ï¼å°±æ¯åæ§è¡å½ä»¤ï¼ææ°æ®åå¥å°æ°æ®åºä¸­ä¹åï¼åè¿è¡è®°å½æ¥å¿ãè¿ç¨å¦ä¸å¾æç¤ºï¼\n\n\n# 1.1 ä¸ºä»ä¹æ¯ aof ?\n\nredis å aof åæ¥å¿æ¶ï¼å¹¶ä¸ä¼æ ¡éªå½ä»¤çè¯­æ³ï¼å¦æåè®°æ¥å¿ï¼åå¯è½ä¿å­äºéè¯¯çå½ä»¤å¯¼è´åºéãæä»¥è®©ç³»ç»åæ§è¡å½ä»¤ï¼æ§è¡æåååè®°å½æ¥å¿ã\n\nååæ¥å¿ä¹ä¸ä¼é»å¡å½åæä½ï¼ä½æ¯ä¸ä¸æ¬¡æä½æé»å¡é£é©ãaof ä¹æ¯å¨ä¸»çº¿ç¨æ§è¡ï¼å¦æåå¥çæ¶åç£çååè¿å¤§ï¼å°±å¯è½ä¼å¤§è´é»å¡ã\n\nä½è¯¥ç§æ¹å¼æé£é©ï¼å¦æåå¥åå­æåï¼è®°æ¥å¿æ¶åçå®æºï¼åä¼ä¸¢å¤±æ¥å¿ã\n\næ­£å ä¸ºæè¿ä¸ªé£é©ï¼æä»¥ redis æä¾ä¸ç§åå¥ç­ç¥ï¼\n\nè¿ä¸ç§ç­ç¥å°±æ¯æ§è½ä¸å¯é æ§çæè¡¡ï¼å¯ä»¥æ ¹æ®å·ä½çä¸å¡è¿è¡éæ©ã\n\n\n# 1.2 aof éåæºå¶\n\naof è®°å½çæ¯ redis çæ¯ä¸æ¡å½ä»¤ï¼ä»¥ææ¬å½¢å¼ä¿å­ï¼é£ä¹å½ aof æ¥å¿åçè¶æ¥è¶å¤çæ¶åï¼aof æä»¶è¶æ¥è¶å¤§ï¼ä»¥åéè¿ aof æ¢å¤æ°æ®ä¹ä¼åå¾å¾æ¢ï¼redis æä¾äº aof éåæºå¶æ¥åå° aof æ¥å¿æä»¶ã\n\nå° aof æä»¶çæçææ°æ°æ®çæææ°çæä½æ¥å¿å¹¶è®°å½å°æ°ç aof æä»¶ä¸­ï¼è¿æ ·æ°ç aof æä»¶ä¸­å°±æ²¡æäºåä½å½ä»¤ï¼åæ¿æ¢ææ§ç aof æä»¶ã\n\naof éåè¿ç¨\n\naof éåçè¿ç¨ä¼ fork åº bgrewriteof åå°å­è¿ç¨ï¼fork ä¼å°ä¸»çº¿ç¨çæ°æ®åå­æ·è´å°å­è¿ç¨ï¼å­è¿ç¨å¨ä¸å½±åä¸»çº¿ç¨çæåµä¸å°æ·è´çæ°æ®è½¬æ¢ææä½åå¥å°éåæ¥å¿ä¸­ã\n\nå¨éåæ¥å¿æ¶ï¼ä¸»çº¿ç¨ä»»ç¶æ¥åæ°çæä½ï¼æä½ä¼è®°å½å° aof ç¼å²å aof éåç¼å²åºï¼aof æ¥å¿ä¸ä¼ä¸¢å¤±ææ°çæä½ï¼å¨æ·è´æ°æ®éåå®æåï¼åå° aof éåç¼å²åºçæ¥å¿è®°å½åå¥æ°ç aof æä»¶ä¸­ï¼ä¿è¯æ°ç aof æä»¶çæ°æ®ä¹æ¯ææ°çç¶æãæ­¤æ¶å°±å¯ä»¥æ¾å¿å°æ°åå¥ç aof æä»¶ä»£æ¿æ§æä»¶ã\n\n\n\nåæ¶å¤å¶ copy on write\n\nfork éç¨æä½ç³»ç»ç åæ¶å¤å¶æºå¶ï¼é¿åä¸æ¬¡æ§æ·è´å¤§éåå­æ°æ®ç»å­è¿ç¨ãfork å­è¿ç¨æ¶ï¼å­è¿ç¨ä¼æ·è´ç¶è¿ç¨çåå­é¡µè¡¨(èæåå­åç©çåå­çæ å°ç´¢å¼è¡¨)èä¸ä¼æ·è´å¶ææçç©çåå­æ°æ®ï¼è¿æ ·ä¸¤ä¸ªè¿ç¨ä½¿ç¨çæ°æ®æ¯åä¸ä»½åå­ç©ºé´ãå½ä¸»çº¿ç¨åå¥æ°æ°æ®æ¶ï¼ä¼æ·è´ä¸ä»½æ°æ°æ®å¹¶è¿è¡ä¿®æ¹ï¼è¿æ ·å¹¶ä¸å½±åå­è¿ç¨çè¯»åã\n\naof éåé»å¡ç¹\n\n * å¨ fork å­è¿ç¨æ¶ï¼å³ä½¿æ¯æ·è´é¡µè¡¨åä¸äºå¿è¦çæ°æ®ç»æä¹æ¯éè¦æ¶èå¤§éç cpuï¼ä¼å¯¹ä¸»çº¿ç¨è¿è¡é»å¡\n * å¨ aof éåè¿ç¨ä¸­ï¼å¦ææ big key åå¥æ¶ï¼ä¼æ·è´æ§æ°æ®å°åå»ºçæ°åå­ç©ºé´ä¸­ï¼ä¹ä¼è¿è¡é»å¡ã\n\naof éåæ¥å¿ä¸ºä»ä¹ä¸å±äº« aof æ¬èº«æ¥å¿ï¼\n\n * ä¸¤ä¸ªè¿ç¨æä½åä¸ä¸ªæä»¶ï¼å­å¨ç«äºé®é¢ï¼å½±åç¶è¿ç¨æ§è½\n * å¦æéåå¤±è´¥ï¼aof æ¥å¿åè¢«æ±¡æäºï¼æ æ³æ¢å¤ä½¿ç¨ãéåä¸ä¸ªæä»¶ï¼å¦æéåå¤±è´¥ï¼å é¤éæ¥å³å¯ã\n\n\n# 2. rdb åå­å¿«ç§\n\naof æ¹æ³æ¢å¤æ°æ®éè¦å°æä½æ¥å¿å¨é¨æ§è¡ä¸éï¼å¦ææ¥å¿éå¸¸å¤ï¼åæ¢å¤çè¿ç¨ç¼æ¢ãèåå­å¿«ç§æ¯å°æä¸æ¶å»çæ°æ®ä»¥æä»¶(rdb)è®°å½å°ç£çä¸ï¼å¨æ¢å¤çæ¶åï¼ç´æ¥è¯»å¥åå­å³å¯ã\n\nä¼ä¸ä¼é»å¡ä¸»çº¿ç¨?\n\nredis æä¾ save å bgsave ä¸¤ä¸ªå½ä»¤çæ rdb æä»¶\n\n * save æ¯å¨ä¸»çº¿ç¨æ§è¡ä¼é»å¡ï¼ä¸å»ºè®®å¨çº¿ä¸ä½¿ç¨\n * bgsave ä¼åå»ºå­è¿ç¨çæ rdbï¼é»è®¤ã\n\nå¦æå¨è§¦åå¿«ç§æ¶ï¼è½ä¿®æ¹æ°æ®åï¼\n\nå¦æå¨ t æ¶å»ï¼éè¦å¿«ç§æ°æ® aï¼å¨å¿«ç§æ¶ä¿®æ¹äº a æ°æ®ä¸º a'ï¼è¿æ¶ç ´åäºå¿«ç§çå®æ´æ§ï¼è¿æ¶ a'å¹¶ä¸æ¯ t æ¶å»çç¶æã\n\nå¦æå¨å¿«ç§æ¶ï¼ä¸åè®¸ä¿®æ¹ï¼è½ç¶è§£å³äºä¸é¢çé®é¢ï¼ä½æ¯ä¼å½±åä¸å¡ã\n\nè¿éè§£å³åæ³è¿æ¯ä½¿ç¨äºæä½ç³»ç»ç åæ¶å¤å¶æºå¶ï¼å¨æ°çæ°æ®éè¦åå¥æ¶ï¼ä¸»çº¿ç¨ä¼å°è¯¥æ°æ®å¤å¶ä¸ä»½ï¼ç¶åå¯¹è¯¥å¯æ¬è¿è¡ä¿®æ¹ï¼èå­è¿ç¨ä½¿ç¨åæ¥çæ°æ®è¿è¡å¿«ç§ã\n\n\n\næ¢ç¶å¯ä»¥ä½¿ç¨ rdb å¿«éæ¢å¤æ°æ®ï¼é£ä¹æ¯å¦å¯ä»¥æ¯ç§åä¸æ¬¡å¿«ç§å¢ï¼\n\nä¸¤æ¬¡å¿«ç§ä¹é´çæ°æ®ï¼å¦æéå°å®æºï¼å¯è½ä¼åçä¸¢å¤±ï¼æä»¥éè¦å°½éç­çæ¶é´åå¿«ç§ã\n\nä½è½ç¶çæ rdb æä»¶ä½¿ç¨å­è¿ç¨ï¼ä½æ¯é¢ç¹çæ§è¡å¨éå¿«ç§è¿æ¯ä¼å¸¦æ¥é¢å¤çå¼éï¼\n\n * é¢ç¹çåç£çï¼å¢å¤§ç£çåå\n * fork å­è¿ç¨æ¶ï¼å¦ææ°æ®åå­è¿å¤§ï¼æ¯ä¼é»å¡ä¸»çº¿ç¨çã\n\nå¦ä½è§£å³å¿«ç§é´ä¸¢å¤±æ°æ®ï¼\n\nå¢éå¿«ç§ãæ··åä½¿ç¨ aof æ¥å¿ååå­å¿«ç§ã\n\nä½¿ç¨ aof è®°å½ä¸¤æ¬¡å¿«ç§é´çæä½ãå¨çæå¿«ç§æ¶ï¼ä½¿ç¨ aof æ¥å¿è®°å½æ°è¿å¥çä¿®æ¹æä½ï¼å¨ä¸ä¸æ¬¡å¿«ç§åå®æºé½å¯ä»¥éè¿ aof æ¥å¿è¿è¡æ¢å¤ãä¸ä¸æ¬¡å¿«ç§æ¶å¯ä»¥åæ¸ç©º aof æ¥å¿éæ°è®°å½\n\n\n\nå¦ä½å¨ aof å rdb è¿è¡éæ©?\n\n * æ°æ®ä¸è½ä¸¢å¤±æ¶ï¼åå­å¿«ç§å aof çæ··åä½¿ç¨æ¯ä¸ä¸ªå¾å¥½çéæ©ï¼\n * å¦æåè®¸åéçº§å«çæ°æ®ä¸¢å¤±ï¼å¯ä»¥åªä½¿ç¨ rdbï¼\n * å¦æåªç¨ aofï¼ä¼åä½¿ç¨ everysec çéç½®éé¡¹ï¼å ä¸ºå®å¨å¯é æ§åæ§è½ä¹é´åäºä¸ä¸ªå¹³è¡¡ã\n\n\n# 3. æ»ç»\n\néè¿ä¸é¢çä»ç»ï¼äºè§£å° rdb å aof é½æ¯éè¿ fork å­è¿ç¨æ¥å®æçï¼æ¯ä¸ºäºä¸ä¼é æä¸»çº¿ç¨çé»å¡ï¼ä½æ¯ä¹å¹¶ä¸è½å®å¨é¿åï¼æä»¥æä»¬éè¦å°½å¯è½çéä½ fork çé¢çã\n\nå¹¶ä¸é½ä½¿ç¨äºæä½ç³»ç»ç cow æºå¶ï¼è¯¥æºå¶å¯ä»¥å¤§å¤§çåå° cpu ä¸åå­çæ¶èï¼æä»¬å¨å¾å¤ç»ä»¶ä¸­ä¼åç°å®ä»¬é½ç¨å°äº linux çä¸äºå¥½ç¨çæºå¶ï¼å kafka ç¨å°çé¶æ·è´å pagecache ç­ç­ãæä»¬å¨è®¾è®¡ä¸­éè¦åç¨è¿äºæºå¶ï¼å¯ä»¥éå¸¸å¤§çä¼åç¨åºçæ§è½ï¼å¹¶ä¸ç®åæä»¬éè¦åçæ¶åäº¤ç»æä½ç³»ç»å»å®æï¼å¹¶ä¸å®æçæ¯æä»¬åçæ´å¥½æ´ç¨³å®ã\n\n\n# 4. åèæç« \n\n * æ¬æä¸»è¦æ¯å­¦ä¹ ãæå®¢æ¶é´-redis æ ¸å¿ææ¯ä¸å®æãä¸æ æ»ç»èæ¥",charsets:{cjk:!0},lastUpdated:"2023/11/01, 11:48:43",lastUpdatedTimestamp:1698810523e3},{title:"redisä¹ä¸»ä»åºåæ­¥",frontmatter:{title:"redisä¹ä¸»ä»åºåæ­¥",date:"2022-12-01T15:18:20.000Z",permalink:"/pages/8072eb/",tags:["redis","æ°æ®åº"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"å¨åç¹æéåï¼æä»¬éè¦ä¿è¯æå¡ä¸é´æ­ï¼æä»¥éè¦ä½¿ç¨åä½çå¯æ¬æä¾éç¾¤æå¡ï¼ä»èè¾¾å°æå¡çé«å¯ç¨ãredis æä¾äºä¸»ä»åºæ°æ®åæ­¥æºå¶ï¼ä»èä¿è¯æ°æ®å¯æ¬çä¸è´æ§ï¼èä¸»ä»åºä½¿ç¨çæ¯è¯»ååç¦»çæºå¶ã",feed:{enable:!0},categories:["æ°æ®åº","redis"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210806172905.png"},{name:"twitter:title",content:"redisä¹ä¸»ä»åºåæ­¥"},{name:"twitter:description",content:"å¨åç¹æéåï¼æä»¬éè¦ä¿è¯æå¡ä¸é´æ­ï¼æä»¥éè¦ä½¿ç¨åä½çå¯æ¬æä¾éç¾¤æå¡ï¼ä»èè¾¾å°æå¡çé«å¯ç¨ãredis æä¾äºä¸»ä»åºæ°æ®åæ­¥æºå¶ï¼ä»èä¿è¯æ°æ®å¯æ¬çä¸è´æ§ï¼èä¸»ä»åºä½¿ç¨çæ¯è¯»ååç¦»çæºå¶ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210806172905.png"},{name:"twitter:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/03.%20redis%E4%B9%8B%E4%B8%BB%E4%BB%8E%E5%BA%93%E5%90%8C%E6%AD%A5.html"},{property:"og:type",content:"article"},{property:"og:title",content:"redisä¹ä¸»ä»åºåæ­¥"},{property:"og:description",content:"å¨åç¹æéåï¼æä»¬éè¦ä¿è¯æå¡ä¸é´æ­ï¼æä»¥éè¦ä½¿ç¨åä½çå¯æ¬æä¾éç¾¤æå¡ï¼ä»èè¾¾å°æå¡çé«å¯ç¨ãredis æä¾äºä¸»ä»åºæ°æ®åæ­¥æºå¶ï¼ä»èä¿è¯æ°æ®å¯æ¬çä¸è´æ§ï¼èä¸»ä»åºä½¿ç¨çæ¯è¯»ååç¦»çæºå¶ã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210806172905.png"},{property:"og:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/03.%20redis%E4%B9%8B%E4%B8%BB%E4%BB%8E%E5%BA%93%E5%90%8C%E6%AD%A5.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-12-01T15:18:20.000Z"},{property:"article:tag",content:"redis"},{property:"article:tag",content:"æ°æ®åº"},{itemprop:"name",content:"redisä¹ä¸»ä»åºåæ­¥"},{itemprop:"description",content:"å¨åç¹æéåï¼æä»¬éè¦ä¿è¯æå¡ä¸é´æ­ï¼æä»¥éè¦ä½¿ç¨åä½çå¯æ¬æä¾éç¾¤æå¡ï¼ä»èè¾¾å°æå¡çé«å¯ç¨ãredis æä¾äºä¸»ä»åºæ°æ®åæ­¥æºå¶ï¼ä»èä¿è¯æ°æ®å¯æ¬çä¸è´æ§ï¼èä¸»ä»åºä½¿ç¨çæ¯è¯»ååç¦»çæºå¶ã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210806172905.png"}],readingShow:"top"},regularPath:"/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/03.%20redis%E4%B9%8B%E4%B8%BB%E4%BB%8E%E5%BA%93%E5%90%8C%E6%AD%A5.html",relativePath:"03.ä¸­é´ä»¶/05.redis/03. redisä¹ä¸»ä»åºåæ­¥.md",key:"v-7a226c10",path:"/pages/8072eb/",headers:[{level:2,title:"0. åè¨",slug:"_0-åè¨",normalizedTitle:"0. åè¨",charIndex:2},{level:2,title:"1. è¯»ååç¦»æ¨¡å¼",slug:"_1-è¯»ååç¦»æ¨¡å¼",normalizedTitle:"1. è¯»ååç¦»æ¨¡å¼",charIndex:110},{level:2,title:"2. å¨éå¤å¶",slug:"_2-å¨éå¤å¶",normalizedTitle:"2. å¨éå¤å¶",charIndex:314},{level:3,title:"2.1 ä¸»ä»åºåæ­¥çè¿ç¨",slug:"_2-1-ä¸»ä»åºåæ­¥çè¿ç¨",normalizedTitle:"2.1 ä¸»ä»åºåæ­¥çè¿ç¨",charIndex:326},{level:3,title:"2.2 å¦ä½åå°ä¸»ä»åæ­¥æ¶ï¼å¯¹ä¸»åºçåå?",slug:"_2-2-å¦ä½åå°ä¸»ä»åæ­¥æ¶-å¯¹ä¸»åºçåå",normalizedTitle:"2.2 å¦ä½åå°ä¸»ä»åæ­¥æ¶ï¼å¯¹ä¸»åºçåå?",charIndex:692},{level:2,title:"3. å¢éå¤å¶",slug:"_3-å¢éå¤å¶",normalizedTitle:"3. å¢éå¤å¶",charIndex:905},{level:3,title:"3.1 å¢éå¤å¶çè¿ç¨",slug:"_3-1-å¢éå¤å¶çè¿ç¨",normalizedTitle:"3.1 å¢éå¤å¶çè¿ç¨",charIndex:1106},{level:2,title:"4. åèæç« ",slug:"_4-åèæç« ",normalizedTitle:"4. åèæç« ",charIndex:1760}],headersStr:"0. åè¨ 1. è¯»ååç¦»æ¨¡å¼ 2. å¨éå¤å¶ 2.1 ä¸»ä»åºåæ­¥çè¿ç¨ 2.2 å¦ä½åå°ä¸»ä»åæ­¥æ¶ï¼å¯¹ä¸»åºçåå? 3. å¢éå¤å¶ 3.1 å¢éå¤å¶çè¿ç¨ 4. åèæç« ",content:"# 0. åè¨\n\nå¨åç¹æéåï¼æä»¬éè¦ä¿è¯æå¡ä¸é´æ­ï¼æä»¥éè¦ä½¿ç¨åä½çå¯æ¬æä¾éç¾¤æå¡ï¼ä»èè¾¾å°æå¡çé«å¯ç¨ãredis æä¾äºä¸»ä»åºæ°æ®åæ­¥æºå¶ï¼ä»èä¿è¯æ°æ®å¯æ¬çä¸è´æ§ï¼èä¸»ä»åºä½¿ç¨çæ¯è¯»ååç¦»çæºå¶ã\n\n\n# 1. è¯»ååç¦»æ¨¡å¼\n\néè¿è¯¥æ¨¡å¼æå»ºå¤ä¸ªæ°æ®å¯æ¬ï¼ä½¿ç¨è¯»ååç¦»çæ¹å¼\n\n * è¯»æä½: ä¸»ä»åºé½å¯ä»¥è¿è¡è¯»åã\n * åæä½: ååå¥å°ä¸»åºï¼å¨åæ­¥å°ä»åºã\n\n\n\nä¸ºä»ä¹è¦è¯»ååç¦»å¢ï¼\n\nå¦æä»åºä¹å¯ä»¥è¿è¡åæä½ï¼é£ä¹ä¸»ä»åºå¨åä¸ä¸ª key ä¸­å­å¨çå¼å¯è½ä¼ä¸ä¸è´ï¼å¦æè¦ä¿è¯ä¸è´æ§ï¼éè¦éè¿å éæ¥è§£å³ï¼ä½è¿æ ·ä¼é ææ§è½çæèã\n\nä½å¦æåªæä¸»åºåå¥ï¼å¨åæ­¥ç»ä»åºï¼åè½ä¿è¯ææå®ä¾ä¸­æ°æ®çä¸è´æ§ã\n\n\n# 2. å¨éå¤å¶\n\n\n# 2.1 ä¸»ä»åºåæ­¥çè¿ç¨\n\nç¬¬ä¸é¶æ®µ\n\nä»åºåä¸»åºåépsyncå½ä»¤è¿è¡æ°æ®åæ­¥ï¼è¯¥å½ä»¤åå«ä¸»åºçrunIDåå¤å¶è¿åº¦offset\n\n * runIDï¼æ¯ä¸ªå®ä¾èªå¨çæçéæº IDï¼ç¬¬ä¸æ¬¡ä»åºä¸ç¥éä¸»åº runIDï¼è®¾ç½®ä¸º?\n * offsetï¼è®°å½å¤å¶çè¿åº¦ï¼ç¬¬ä¸æ¬¡è¿åº¦è®¾ç½®ä¸º-1\n\nä¸»åºä¼åå¤ runID å offset ç»ä»åº\n\nç¬¬äºé¶æ®µ\n\nä¸»ä»ç¬¬ä¸æ¬¡åæ­¥æ¯éç¨å¨éå¤å¶çæ¹å¼ï¼ä¸»åºçæ RDB æä»¶ï¼ç¶ååéç»ä»åºï¼ä»åºæ¸ç©ºå½åæ°æ®åè¯»å¥ RDB æä»¶å®æç¬¬ä¸æ¬¡åæ­¥ã\n\nå¨çæ RDB æä»¶æ¶ï¼è¿æ¯ä¼ææ°çæä½çä¼è¿è¡ï¼ä¸ºäºä¿ææ°æ®çä¸è´æ§ï¼ä¼å°æ°çæä½è®°å½å° replication buffer ä¸­ã\n\nç¬¬ä¸é¶æ®µ\n\nRDB æä»¶åéå°ä»åºåï¼å replication buffer ä¸­çæä½ååéç»ä»åºã\n\n\n# 2.2 å¦ä½åå°ä¸»ä»åæ­¥æ¶ï¼å¯¹ä¸»åºçåå?\n\nä¸»ä»åæ­¥æåªäºååï¼\n\n * çæ RDBï¼è¿ä¸ªæä½ä¼ fork å­è¿ç¨ï¼ä¼é»å¡ä¸»çº¿ç¨çæ­£å¸¸è¯·æ±ã\n * ä¼ è¾ RDBï¼ä¼å ç¨ä¸»åºçç½ç»å¸¦å®½\n\nä¸»-ä»-ä»æ¨¡å¼\n\nå¯ä»¥æå¨éæ©ä¸ä¸ªä»åºï¼æ¯å¦éæ©åå­èµæºéç½®è¾é«çä»åºï¼ï¼ç¨äºçº§èå¶ä»çä»åºãç±ä»åºçæ RDB åä¼ è¾ç»ä»åºï¼åå°äºä¸»åºçååã\n\nå¨ä¸»åºå¨éå¤å¶ä¹åï¼ä¼ç»´æ¤ä¸ä¸ªé¿è¿æ¥ï¼åéçæä½å½ä»¤éè¿è¯¥è¿æ¥åæ­¥ç»ä»åº\n\n\n\n\n# 3. å¢éå¤å¶\n\nå¨éå¤å¶æ¯éè¿çæ RDB åéå°ä»åºç¶åè¿è¡è¯»ååè¿è¡åæ­¥ãæä»¬ç¥éçæ RDB æ¬èº«å°±æ¯ä¸ä¸ªæ¶è CPU çæä½ï¼å¹¶ä¸å­å¨é»å¡ä¸»çº¿ç¨çé£é©ï¼æä»¥æä»¬éè¦å°½éå°çæ§è¡å¨éå¤å¶çæä½ã\n\næä»¥å¨ç¬¬ä¸æ¬¡ä½¿ç¨ RDB å¨éå¤å¶åï¼ä¸»ä»åºä¼å»ºç«ä¸ä¸ªé¿è¿æ¥ï¼ä¸»åºæ¶å°çæ°å½ä»¤ä¼ååæ­¥å°ä»åºï¼è¿æ ·å°±é¿åé¢ç¹å¨éå¤å¶ã\n\nä½æ¯æä¸ä¸ªé£é©ç¹æ¯ï¼å¦æè¿ç¨åçäºç½ç»ä¸­æ­æèé»å¡ï¼è¯¥å¦ä½è§£å³ï¼\n\n\n# 3.1 å¢éå¤å¶çè¿ç¨\n\nå½ä¸»ä»è¿æ¥æ¶ï¼ä¼å°æ°çæä½çå½ä»¤åå¥ replication buffer å repl_backlog_buffer ç¼å²åºä¸­\n\nrepl_backlog_buffer æ¯ä¸ä¸ªç¯å½¢ç¼å²åºï¼ä¸»åºä¼è®°å½å½åçåç§»é master_repl_offsetï¼è®°å½èªå·±åå°çä½ç½®ï¼èä»åºå¨ä¸é¢ä¹æå¯¹åºçåç§»é slave_repl_offsetï¼è®°å½èªå·±æ­£å¨è¯»å°çåç§»éã\n\nå¨æ¢å¤è¿æ¥æ¶ï¼ä»åºä¼éè¿ psync å½ä»¤å°èªå·±çåç§»é slave_repl_offset åéç»ä¸»åºï¼ä¸»åºä¼å° slave_repl_offset å master_repl_offset ä¹é´çå½ä»¤åæ­¥ç»ä»åºå³å¯ã\n\n\n\nä¸¾äºä¾å­ï¼ ä¸»åºåä»åºä¹é´ç¸å·®äº put d e å put d f ä¸¤ä¸ªæä½ï¼å¨å¢éå¤å¶æ¶ï¼ä¸»åºåªéè¦æå®ä»¬åæ­¥ç»ä»åºï¼å°±è¡äºã\n\nå ä¸º replication buffer æ¯ä¸ä¸ªç¯å½¢çç¼å­ï¼å½ä¸»ä»åºé¿ææ­å¼æ¶ï¼æ¯æå¯è½è¢«è¦çææ§çæ°æ®ï¼è¿ä¸ªæ¶åæ¯ä¼éæ°åèµ·å¨éå¤å¶ï¼ä¸»åºæ ¹æ®ä»åºåéç slave_repl_offset æ¥å¤æ­æ¯å¢éè¿æ¯å¨éçå¤å¶ã\n\né£ä¸ºä»ä¹å¨éå¤å¶ä½¿ç¨ RDB èä¸æ¯ä½¿ç¨ AOF å¢ï¼\n\n * RDB æä»¶æ¯ç»è¿åç¼©çäºè¿å¶æä»¶ï¼AOF æä»¶æ¯è®°å½æ¯ä¸æ¬¡çæä½ï¼åå«å¯¹åä¸ä¸ª key çå¤æ¬¡åä½æä½ï¼æä»¶æ¯ RDB è¦å¤§çå¤ï¼ä½¿ç¨ AOF å¯ä»¥åå°å¸¦å®½\n * RDB æ¯äºè¿å¶æ°æ®ï¼ä»åºè¿åéåº¦å¿«ãè AOF éè¦ä¾æ¬¡éæ¾æ¯ä¸ä¸ªå½ä»¤ï¼æ¢å¤éåº¦æ¢ã\n\n\n# 4. åèæç« \n\n * æ¬æä¸»è¦æ¯å­¦ä¹ ãæå®¢æ¶é´-redis æ ¸å¿ææ¯ä¸å®æãä¸æ æ»ç»èæ¥",normalizedContent:"# 0. åè¨\n\nå¨åç¹æéåï¼æä»¬éè¦ä¿è¯æå¡ä¸é´æ­ï¼æä»¥éè¦ä½¿ç¨åä½çå¯æ¬æä¾éç¾¤æå¡ï¼ä»èè¾¾å°æå¡çé«å¯ç¨ãredis æä¾äºä¸»ä»åºæ°æ®åæ­¥æºå¶ï¼ä»èä¿è¯æ°æ®å¯æ¬çä¸è´æ§ï¼èä¸»ä»åºä½¿ç¨çæ¯è¯»ååç¦»çæºå¶ã\n\n\n# 1. è¯»ååç¦»æ¨¡å¼\n\néè¿è¯¥æ¨¡å¼æå»ºå¤ä¸ªæ°æ®å¯æ¬ï¼ä½¿ç¨è¯»ååç¦»çæ¹å¼\n\n * è¯»æä½: ä¸»ä»åºé½å¯ä»¥è¿è¡è¯»åã\n * åæä½: ååå¥å°ä¸»åºï¼å¨åæ­¥å°ä»åºã\n\n\n\nä¸ºä»ä¹è¦è¯»ååç¦»å¢ï¼\n\nå¦æä»åºä¹å¯ä»¥è¿è¡åæä½ï¼é£ä¹ä¸»ä»åºå¨åä¸ä¸ª key ä¸­å­å¨çå¼å¯è½ä¼ä¸ä¸è´ï¼å¦æè¦ä¿è¯ä¸è´æ§ï¼éè¦éè¿å éæ¥è§£å³ï¼ä½è¿æ ·ä¼é ææ§è½çæèã\n\nä½å¦æåªæä¸»åºåå¥ï¼å¨åæ­¥ç»ä»åºï¼åè½ä¿è¯ææå®ä¾ä¸­æ°æ®çä¸è´æ§ã\n\n\n# 2. å¨éå¤å¶\n\n\n# 2.1 ä¸»ä»åºåæ­¥çè¿ç¨\n\nç¬¬ä¸é¶æ®µ\n\nä»åºåä¸»åºåépsyncå½ä»¤è¿è¡æ°æ®åæ­¥ï¼è¯¥å½ä»¤åå«ä¸»åºçrunidåå¤å¶è¿åº¦offset\n\n * runidï¼æ¯ä¸ªå®ä¾èªå¨çæçéæº idï¼ç¬¬ä¸æ¬¡ä»åºä¸ç¥éä¸»åº runidï¼è®¾ç½®ä¸º?\n * offsetï¼è®°å½å¤å¶çè¿åº¦ï¼ç¬¬ä¸æ¬¡è¿åº¦è®¾ç½®ä¸º-1\n\nä¸»åºä¼åå¤ runid å offset ç»ä»åº\n\nç¬¬äºé¶æ®µ\n\nä¸»ä»ç¬¬ä¸æ¬¡åæ­¥æ¯éç¨å¨éå¤å¶çæ¹å¼ï¼ä¸»åºçæ rdb æä»¶ï¼ç¶ååéç»ä»åºï¼ä»åºæ¸ç©ºå½åæ°æ®åè¯»å¥ rdb æä»¶å®æç¬¬ä¸æ¬¡åæ­¥ã\n\nå¨çæ rdb æä»¶æ¶ï¼è¿æ¯ä¼ææ°çæä½çä¼è¿è¡ï¼ä¸ºäºä¿ææ°æ®çä¸è´æ§ï¼ä¼å°æ°çæä½è®°å½å° replication buffer ä¸­ã\n\nç¬¬ä¸é¶æ®µ\n\nrdb æä»¶åéå°ä»åºåï¼å replication buffer ä¸­çæä½ååéç»ä»åºã\n\n\n# 2.2 å¦ä½åå°ä¸»ä»åæ­¥æ¶ï¼å¯¹ä¸»åºçåå?\n\nä¸»ä»åæ­¥æåªäºååï¼\n\n * çæ rdbï¼è¿ä¸ªæä½ä¼ fork å­è¿ç¨ï¼ä¼é»å¡ä¸»çº¿ç¨çæ­£å¸¸è¯·æ±ã\n * ä¼ è¾ rdbï¼ä¼å ç¨ä¸»åºçç½ç»å¸¦å®½\n\nä¸»-ä»-ä»æ¨¡å¼\n\nå¯ä»¥æå¨éæ©ä¸ä¸ªä»åºï¼æ¯å¦éæ©åå­èµæºéç½®è¾é«çä»åºï¼ï¼ç¨äºçº§èå¶ä»çä»åºãç±ä»åºçæ rdb åä¼ è¾ç»ä»åºï¼åå°äºä¸»åºçååã\n\nå¨ä¸»åºå¨éå¤å¶ä¹åï¼ä¼ç»´æ¤ä¸ä¸ªé¿è¿æ¥ï¼åéçæä½å½ä»¤éè¿è¯¥è¿æ¥åæ­¥ç»ä»åº\n\n\n\n\n# 3. å¢éå¤å¶\n\nå¨éå¤å¶æ¯éè¿çæ rdb åéå°ä»åºç¶åè¿è¡è¯»ååè¿è¡åæ­¥ãæä»¬ç¥éçæ rdb æ¬èº«å°±æ¯ä¸ä¸ªæ¶è cpu çæä½ï¼å¹¶ä¸å­å¨é»å¡ä¸»çº¿ç¨çé£é©ï¼æä»¥æä»¬éè¦å°½éå°çæ§è¡å¨éå¤å¶çæä½ã\n\næä»¥å¨ç¬¬ä¸æ¬¡ä½¿ç¨ rdb å¨éå¤å¶åï¼ä¸»ä»åºä¼å»ºç«ä¸ä¸ªé¿è¿æ¥ï¼ä¸»åºæ¶å°çæ°å½ä»¤ä¼ååæ­¥å°ä»åºï¼è¿æ ·å°±é¿åé¢ç¹å¨éå¤å¶ã\n\nä½æ¯æä¸ä¸ªé£é©ç¹æ¯ï¼å¦æè¿ç¨åçäºç½ç»ä¸­æ­æèé»å¡ï¼è¯¥å¦ä½è§£å³ï¼\n\n\n# 3.1 å¢éå¤å¶çè¿ç¨\n\nå½ä¸»ä»è¿æ¥æ¶ï¼ä¼å°æ°çæä½çå½ä»¤åå¥ replication buffer å repl_backlog_buffer ç¼å²åºä¸­\n\nrepl_backlog_buffer æ¯ä¸ä¸ªç¯å½¢ç¼å²åºï¼ä¸»åºä¼è®°å½å½åçåç§»é master_repl_offsetï¼è®°å½èªå·±åå°çä½ç½®ï¼èä»åºå¨ä¸é¢ä¹æå¯¹åºçåç§»é slave_repl_offsetï¼è®°å½èªå·±æ­£å¨è¯»å°çåç§»éã\n\nå¨æ¢å¤è¿æ¥æ¶ï¼ä»åºä¼éè¿ psync å½ä»¤å°èªå·±çåç§»é slave_repl_offset åéç»ä¸»åºï¼ä¸»åºä¼å° slave_repl_offset å master_repl_offset ä¹é´çå½ä»¤åæ­¥ç»ä»åºå³å¯ã\n\n\n\nä¸¾äºä¾å­ï¼ ä¸»åºåä»åºä¹é´ç¸å·®äº put d e å put d f ä¸¤ä¸ªæä½ï¼å¨å¢éå¤å¶æ¶ï¼ä¸»åºåªéè¦æå®ä»¬åæ­¥ç»ä»åºï¼å°±è¡äºã\n\nå ä¸º replication buffer æ¯ä¸ä¸ªç¯å½¢çç¼å­ï¼å½ä¸»ä»åºé¿ææ­å¼æ¶ï¼æ¯æå¯è½è¢«è¦çææ§çæ°æ®ï¼è¿ä¸ªæ¶åæ¯ä¼éæ°åèµ·å¨éå¤å¶ï¼ä¸»åºæ ¹æ®ä»åºåéç slave_repl_offset æ¥å¤æ­æ¯å¢éè¿æ¯å¨éçå¤å¶ã\n\né£ä¸ºä»ä¹å¨éå¤å¶ä½¿ç¨ rdb èä¸æ¯ä½¿ç¨ aof å¢ï¼\n\n * rdb æä»¶æ¯ç»è¿åç¼©çäºè¿å¶æä»¶ï¼aof æä»¶æ¯è®°å½æ¯ä¸æ¬¡çæä½ï¼åå«å¯¹åä¸ä¸ª key çå¤æ¬¡åä½æä½ï¼æä»¶æ¯ rdb è¦å¤§çå¤ï¼ä½¿ç¨ aof å¯ä»¥åå°å¸¦å®½\n * rdb æ¯äºè¿å¶æ°æ®ï¼ä»åºè¿åéåº¦å¿«ãè aof éè¦ä¾æ¬¡éæ¾æ¯ä¸ä¸ªå½ä»¤ï¼æ¢å¤éåº¦æ¢ã\n\n\n# 4. åèæç« \n\n * æ¬æä¸»è¦æ¯å­¦ä¹ ãæå®¢æ¶é´-redis æ ¸å¿ææ¯ä¸å®æãä¸æ æ»ç»èæ¥",charsets:{cjk:!0},lastUpdated:"2023/11/01, 11:48:43",lastUpdatedTimestamp:1698810523e3},{title:"redisä¹å¨åµæºå¶",frontmatter:{title:"redisä¹å¨åµæºå¶",date:"2022-12-01T15:18:35.000Z",permalink:"/pages/ffee9e/",tags:["redis","æ°æ®åº"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä¸»è¦ä»ç»çæ¯ Redis æä¾çå¨åµæºå¶ï¼éè¿å¨åµçæ§ä¸»åºçç¶åµï¼å¦æåç°ä¸»åºä¸çº¿ï¼åä¼ä»ä»åºä¸­éæ©ä¸ä¸ªç¶æä¼ç§çå½åä¸»åºï¼ä»èä¿è¯æå¡çé«å¯ç¨ã",feed:{enable:!0},categories:["æ°æ®åº","redis"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210807101732.png"},{name:"twitter:title",content:"redisä¹å¨åµæºå¶"},{name:"twitter:description",content:"æ¬æä¸»è¦ä»ç»çæ¯ Redis æä¾çå¨åµæºå¶ï¼éè¿å¨åµçæ§ä¸»åºçç¶åµï¼å¦æåç°ä¸»åºä¸çº¿ï¼åä¼ä»ä»åºä¸­éæ©ä¸ä¸ªç¶æä¼ç§çå½åä¸»åºï¼ä»èä¿è¯æå¡çé«å¯ç¨ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210807101732.png"},{name:"twitter:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/04.%20redis%E4%B9%8B%E5%93%A8%E5%85%B5%E6%9C%BA%E5%88%B6.html"},{property:"og:type",content:"article"},{property:"og:title",content:"redisä¹å¨åµæºå¶"},{property:"og:description",content:"æ¬æä¸»è¦ä»ç»çæ¯ Redis æä¾çå¨åµæºå¶ï¼éè¿å¨åµçæ§ä¸»åºçç¶åµï¼å¦æåç°ä¸»åºä¸çº¿ï¼åä¼ä»ä»åºä¸­éæ©ä¸ä¸ªç¶æä¼ç§çå½åä¸»åºï¼ä»èä¿è¯æå¡çé«å¯ç¨ã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210807101732.png"},{property:"og:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/04.%20redis%E4%B9%8B%E5%93%A8%E5%85%B5%E6%9C%BA%E5%88%B6.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-12-01T15:18:35.000Z"},{property:"article:tag",content:"redis"},{property:"article:tag",content:"æ°æ®åº"},{itemprop:"name",content:"redisä¹å¨åµæºå¶"},{itemprop:"description",content:"æ¬æä¸»è¦ä»ç»çæ¯ Redis æä¾çå¨åµæºå¶ï¼éè¿å¨åµçæ§ä¸»åºçç¶åµï¼å¦æåç°ä¸»åºä¸çº¿ï¼åä¼ä»ä»åºä¸­éæ©ä¸ä¸ªç¶æä¼ç§çå½åä¸»åºï¼ä»èä¿è¯æå¡çé«å¯ç¨ã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210807101732.png"}],readingShow:"top"},regularPath:"/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/04.%20redis%E4%B9%8B%E5%93%A8%E5%85%B5%E6%9C%BA%E5%88%B6.html",relativePath:"03.ä¸­é´ä»¶/05.redis/04. redisä¹å¨åµæºå¶.md",key:"v-97fa14a4",path:"/pages/ffee9e/",headers:[{level:2,title:"0. åè¨",slug:"_0-åè¨",normalizedTitle:"0. åè¨",charIndex:2},{level:2,title:"1. å¨åµå¦ä½ä¿è¯é«å¯ç¨ï¼",slug:"_1-å¨åµå¦ä½ä¿è¯é«å¯ç¨",normalizedTitle:"1. å¨åµå¦ä½ä¿è¯é«å¯ç¨ï¼",charIndex:140},{level:3,title:"1.1 çæ§",slug:"_1-1-çæ§",normalizedTitle:"1.1 çæ§",charIndex:158},{level:3,title:"1.2 éæ©æ°ä¸»åº",slug:"_1-2-éæ©æ°ä¸»åº",normalizedTitle:"1.2 éæ©æ°ä¸»åº",charIndex:297},{level:3,title:"1.3 éç¥",slug:"_1-3-éç¥",normalizedTitle:"1.3 éç¥",charIndex:457},{level:2,title:"2. å¨åµéç¾¤çç»å»º",slug:"_2-å¨åµéç¾¤çç»å»º",normalizedTitle:"2. å¨åµéç¾¤çç»å»º",charIndex:562},{level:3,title:"2.1 å¨åµä¸ä»åºå»ºç«è¿æ¥",slug:"_2-1-å¨åµä¸ä»åºå»ºç«è¿æ¥",normalizedTitle:"2.1 å¨åµä¸ä»åºå»ºç«è¿æ¥",charIndex:748},{level:3,title:"2.2 å¨åµä¸å®¢æ·ç«¯å»ºç«è¿æ¥",slug:"_2-2-å¨åµä¸å®¢æ·ç«¯å»ºç«è¿æ¥",normalizedTitle:"2.2 å¨åµä¸å®¢æ·ç«¯å»ºç«è¿æ¥",charIndex:868},{level:2,title:"3. ç±åªä¸ªå¨åµæ¥æ§è¡ä¸»ä»åæ¢ ï¼",slug:"_3-ç±åªä¸ªå¨åµæ¥æ§è¡ä¸»ä»åæ¢",normalizedTitle:"3. ç±åªä¸ªå¨åµæ¥æ§è¡ä¸»ä»åæ¢ ï¼",charIndex:1019},{level:2,title:"4. åèæç« ",slug:"_4-åèæç« ",normalizedTitle:"4. åèæç« ",charIndex:1248}],headersStr:"0. åè¨ 1. å¨åµå¦ä½ä¿è¯é«å¯ç¨ï¼ 1.1 çæ§ 1.2 éæ©æ°ä¸»åº 1.3 éç¥ 2. å¨åµéç¾¤çç»å»º 2.1 å¨åµä¸ä»åºå»ºç«è¿æ¥ 2.2 å¨åµä¸å®¢æ·ç«¯å»ºç«è¿æ¥ 3. ç±åªä¸ªå¨åµæ¥æ§è¡ä¸»ä»åæ¢ ï¼ 4. åèæç« ",content:'# 0. åè¨\n\næä»¬ç¥éï¼åªæä¸»åºæè½æåæä½ï¼èä»åºåªè½è¿è¡è¯»æä½ï¼é£ä¹å½ä¸»åºå®æºåï¼å¦ä½ä¿è¯æå¡çæ­£å¸¸è¿è¡å¢ï¼\n\næ¬æä¸»è¦ä»ç»çæ¯ Redis æä¾çå¨åµæºå¶ï¼éè¿å¨åµçæ§ä¸»åºçç¶åµï¼å¦æåç°ä¸»åºä¸çº¿ï¼åä¼ä»ä»åºä¸­éæ©ä¸ä¸ªç¶æä¼ç§çå½åä¸»åºï¼ä»èä¿è¯æå¡çé«å¯ç¨ã\n\n\n# 1. å¨åµå¦ä½ä¿è¯é«å¯ç¨ï¼\n\n\n# 1.1 çæ§\n\nå¨åµè¿ç¨ä¼åé PING å½ä»¤ç»ä¸»ä»åºæ£æµç½ç»è¿æ¥ï¼å¦æè¶æ¶ï¼åå¤æ­ä¸º"ä¸»è§ä¸çº¿"ã\n\nä½æ¯å¦æå¨åµè¯¯å¤å¯è½ä¼å¯¼è´ä¸»ä»åæ¢ï¼å¯¼è´æ§è½çé¢å¤å¼éï¼æä»¥å¼å¥äºå¨åµéç¾¤ï¼åªæå¤æ°å¨åµè®¤ä¸ºä¸»åºå·²ç»ä¸»è§ä¸çº¿ï¼ä¸»åºä¼è¢«æ è®°ä¸º"å®¢è§ä¸çº¿"ï¼è¿æ¶æä¼è¿è¡ä¸»ä»åæ¢ã\n\n\n\n\n# 1.2 éæ©æ°ä¸»åº\n\néè¿ä¸å®çç­éæ¡ä»¶ï¼æä¸ç¬¦åæ¡ä»¶çä»åºå»æï¼åæç§ä¸å®è§åç»ä»åºæåï¼å¾åæé«çä¸ºæ°ä¸»åº\n\n\n\nç­éæ¡ä»¶ï¼\n\n * å½åä»åºçç¶æ\n * ä¹åä¸æ®µæ¶é´çç½ç»ç¶æ\n\næåè§åï¼\n\n * ç¨æ·å¯ä»¥ç»ä»åº slave-priority éç½®ä¼åçº§\n * ä¸»ä»åºåæ­¥ç¨åº¦\n * ID å·å°çå¾åé«\n\n\n# 1.3 éç¥\n\nå¨åµä¼ææ°ä¸»åºçè¿æ¥ä¿¡æ¯åç»å¶ä»ä»åºï¼è®©å®ä»¬æ§è¡ replicaof å½ä»¤ï¼åæ°ä¸»åºå»ºç«è¿æ¥ï¼å¹¶è¿è¡æ°æ®å¤å¶ãåæ¶ï¼å¨åµä¼ææ°ä¸»åºçè¿æ¥ä¿¡æ¯éç¥ç»å®¢æ·ç«¯ï¼è®©å®ä»¬æè¯·æ±æä½åå°æ°ä¸»åºä¸ã\n\n\n# 2. å¨åµéç¾¤çç»å»º\n\nå¨åµå®ä¾ä¹é´äºç¸åç°æ¯åºäº Redis æä¾ç pub/sub æºå¶ï¼åå¸/è®¢éæºå¶ã\n\nå¨åµåªè¦ä¸ä¸»åºå»ºç«è¿æ¥ï¼ä¼å¨ä¸»åº __sentinel__:hello é¢éä¸åå¸æ¶æ¯ï¼æ¯å¦èªå·±ç ip å°ååç«¯å£ä¿¡æ¯ï¼è®¢éäºè¯¥é¢éçå¶ä»å¨åµä¼è·åå°åå¸æ¶æ¯å¨åµç IP åç«¯å£ï¼å³å¯ä»¥ä¸å¶å»ºç«ç½ç»è¿æ¥ï¼ä¹åç¸äºé´å°±å¯ä»¥éè¿ç½ç»è¿æ¥è¿è¡éä¿¡ã\n\n\n\n\n# 2.1 å¨åµä¸ä»åºå»ºç«è¿æ¥\n\nå¨åµè¿éè¦åä»åºå»ºç«è¿æ¥ï¼è¿æ ·æè½çæ§ä»åºçè¿æ¥ç¶æï¼å½ä¸»åºä¸çº¿åï¼æè½ä»å®ä»¬ä¸­éä¸¾åºæ°çä¸»åºã\n\nå¨åµä½¿ç¨ INFO å½ä»¤åéç»ä¸»åºï¼ä¸»åºä¼è¿åä»åºåè¡¨è¿æ¥ä¿¡æ¯ï¼è¿æ ·ä¹è½åä»åºå»ºç«è¿æ¥å¹¶è¿è¡çæ§\n\n\n\n\n# 2.2 å¨åµä¸å®¢æ·ç«¯å»ºç«è¿æ¥\n\nå½ä¸»åºä¸çº¿åï¼å®¢æ·ç«¯éè¦å¾ç¥ä¸»åºä¸çº¿çæ¶æ¯ï¼åæä½éè¦åæ¢å°æ°çä¸»åºä¸­ï¼æä»¥å¨åµéè¦ä¸å®¢æ·ç«¯å»ºç«è¿æ¥ï¼å¹¶åæ¶éç¥å®¢æ·ç«¯ã\n\nå®¢æ·ç«¯å¯ä»¥ä»å¨åµè®¢éæ¶æ¯ï¼è·åå°ä¸»ä»åæ¢çåç§äºä»¶ã\n\nå®¢æ·ç«¯è¯»åå¨åµçéç½®æä»¶ï¼è·åå¨åµçå°ååç«¯å£ï¼å»ºç«è¿æ¥ï¼ç¶åå³å¯è®¢éæ¶æ¯ã\n\n\n\n\n# 3. ç±åªä¸ªå¨åµæ¥æ§è¡ä¸»ä»åæ¢ ï¼\n\nä»»ä½ä¸ä¸ªå¨åµå¤æ­ä¸»åº ä¸»è§ä¸çº¿ å°±ä¼åå¶ä»å¨åµåé is-master-down-by-addr å½ä»¤ãå¶ä»å®ä¾ä¼æ´å·èªå·±ä¸ä¸»åºçè¿æ¥æåµæåºèµæç¥¨æåå¯¹ç¥¨ãå½å¤æ°å¨åµæèµæç¥¨æ¶ï¼åä¸»åºè¢«è®¤ä¸º å®¢è§ä¸çº¿ã\n\næ­¤æ¶ï¼è¯¥å¨åµååå½ä»¤ç»å¶ä»å¨åµè¿è¡ leaderéä¸¾ï¼å¸æç±èªå·±æ¥è¿è¡ä¸»ä»åæ¢ãå¨è¿ä¸ªè¿ç¨ä¸­ï¼ä»»ä½ä¸ä¸ªå¨åµé½å¯ä»¥åä¸éä¸¾ï¼åªè¦ç¥¨æ°åæ°ä»¥ä¸å¹¶ä¸å¤§äºç­äº quorum å¼ï¼åå¯ä»¥æä¸º leader\n\n\n\n\n\n\n# 4. åèæç« \n\n * æ¬æä¸»è¦æ¯å­¦ä¹ ãæå®¢æ¶é´-redis æ ¸å¿ææ¯ä¸å®æãä¸æ æ»ç»èæ¥',normalizedContent:'# 0. åè¨\n\næä»¬ç¥éï¼åªæä¸»åºæè½æåæä½ï¼èä»åºåªè½è¿è¡è¯»æä½ï¼é£ä¹å½ä¸»åºå®æºåï¼å¦ä½ä¿è¯æå¡çæ­£å¸¸è¿è¡å¢ï¼\n\næ¬æä¸»è¦ä»ç»çæ¯ redis æä¾çå¨åµæºå¶ï¼éè¿å¨åµçæ§ä¸»åºçç¶åµï¼å¦æåç°ä¸»åºä¸çº¿ï¼åä¼ä»ä»åºä¸­éæ©ä¸ä¸ªç¶æä¼ç§çå½åä¸»åºï¼ä»èä¿è¯æå¡çé«å¯ç¨ã\n\n\n# 1. å¨åµå¦ä½ä¿è¯é«å¯ç¨ï¼\n\n\n# 1.1 çæ§\n\nå¨åµè¿ç¨ä¼åé ping å½ä»¤ç»ä¸»ä»åºæ£æµç½ç»è¿æ¥ï¼å¦æè¶æ¶ï¼åå¤æ­ä¸º"ä¸»è§ä¸çº¿"ã\n\nä½æ¯å¦æå¨åµè¯¯å¤å¯è½ä¼å¯¼è´ä¸»ä»åæ¢ï¼å¯¼è´æ§è½çé¢å¤å¼éï¼æä»¥å¼å¥äºå¨åµéç¾¤ï¼åªæå¤æ°å¨åµè®¤ä¸ºä¸»åºå·²ç»ä¸»è§ä¸çº¿ï¼ä¸»åºä¼è¢«æ è®°ä¸º"å®¢è§ä¸çº¿"ï¼è¿æ¶æä¼è¿è¡ä¸»ä»åæ¢ã\n\n\n\n\n# 1.2 éæ©æ°ä¸»åº\n\néè¿ä¸å®çç­éæ¡ä»¶ï¼æä¸ç¬¦åæ¡ä»¶çä»åºå»æï¼åæç§ä¸å®è§åç»ä»åºæåï¼å¾åæé«çä¸ºæ°ä¸»åº\n\n\n\nç­éæ¡ä»¶ï¼\n\n * å½åä»åºçç¶æ\n * ä¹åä¸æ®µæ¶é´çç½ç»ç¶æ\n\næåè§åï¼\n\n * ç¨æ·å¯ä»¥ç»ä»åº slave-priority éç½®ä¼åçº§\n * ä¸»ä»åºåæ­¥ç¨åº¦\n * id å·å°çå¾åé«\n\n\n# 1.3 éç¥\n\nå¨åµä¼ææ°ä¸»åºçè¿æ¥ä¿¡æ¯åç»å¶ä»ä»åºï¼è®©å®ä»¬æ§è¡ replicaof å½ä»¤ï¼åæ°ä¸»åºå»ºç«è¿æ¥ï¼å¹¶è¿è¡æ°æ®å¤å¶ãåæ¶ï¼å¨åµä¼ææ°ä¸»åºçè¿æ¥ä¿¡æ¯éç¥ç»å®¢æ·ç«¯ï¼è®©å®ä»¬æè¯·æ±æä½åå°æ°ä¸»åºä¸ã\n\n\n# 2. å¨åµéç¾¤çç»å»º\n\nå¨åµå®ä¾ä¹é´äºç¸åç°æ¯åºäº redis æä¾ç pub/sub æºå¶ï¼åå¸/è®¢éæºå¶ã\n\nå¨åµåªè¦ä¸ä¸»åºå»ºç«è¿æ¥ï¼ä¼å¨ä¸»åº __sentinel__:hello é¢éä¸åå¸æ¶æ¯ï¼æ¯å¦èªå·±ç ip å°ååç«¯å£ä¿¡æ¯ï¼è®¢éäºè¯¥é¢éçå¶ä»å¨åµä¼è·åå°åå¸æ¶æ¯å¨åµç ip åç«¯å£ï¼å³å¯ä»¥ä¸å¶å»ºç«ç½ç»è¿æ¥ï¼ä¹åç¸äºé´å°±å¯ä»¥éè¿ç½ç»è¿æ¥è¿è¡éä¿¡ã\n\n\n\n\n# 2.1 å¨åµä¸ä»åºå»ºç«è¿æ¥\n\nå¨åµè¿éè¦åä»åºå»ºç«è¿æ¥ï¼è¿æ ·æè½çæ§ä»åºçè¿æ¥ç¶æï¼å½ä¸»åºä¸çº¿åï¼æè½ä»å®ä»¬ä¸­éä¸¾åºæ°çä¸»åºã\n\nå¨åµä½¿ç¨ info å½ä»¤åéç»ä¸»åºï¼ä¸»åºä¼è¿åä»åºåè¡¨è¿æ¥ä¿¡æ¯ï¼è¿æ ·ä¹è½åä»åºå»ºç«è¿æ¥å¹¶è¿è¡çæ§\n\n\n\n\n# 2.2 å¨åµä¸å®¢æ·ç«¯å»ºç«è¿æ¥\n\nå½ä¸»åºä¸çº¿åï¼å®¢æ·ç«¯éè¦å¾ç¥ä¸»åºä¸çº¿çæ¶æ¯ï¼åæä½éè¦åæ¢å°æ°çä¸»åºä¸­ï¼æä»¥å¨åµéè¦ä¸å®¢æ·ç«¯å»ºç«è¿æ¥ï¼å¹¶åæ¶éç¥å®¢æ·ç«¯ã\n\nå®¢æ·ç«¯å¯ä»¥ä»å¨åµè®¢éæ¶æ¯ï¼è·åå°ä¸»ä»åæ¢çåç§äºä»¶ã\n\nå®¢æ·ç«¯è¯»åå¨åµçéç½®æä»¶ï¼è·åå¨åµçå°ååç«¯å£ï¼å»ºç«è¿æ¥ï¼ç¶åå³å¯è®¢éæ¶æ¯ã\n\n\n\n\n# 3. ç±åªä¸ªå¨åµæ¥æ§è¡ä¸»ä»åæ¢ ï¼\n\nä»»ä½ä¸ä¸ªå¨åµå¤æ­ä¸»åº ä¸»è§ä¸çº¿ å°±ä¼åå¶ä»å¨åµåé is-master-down-by-addr å½ä»¤ãå¶ä»å®ä¾ä¼æ´å·èªå·±ä¸ä¸»åºçè¿æ¥æåµæåºèµæç¥¨æåå¯¹ç¥¨ãå½å¤æ°å¨åµæèµæç¥¨æ¶ï¼åä¸»åºè¢«è®¤ä¸º å®¢è§ä¸çº¿ã\n\næ­¤æ¶ï¼è¯¥å¨åµååå½ä»¤ç»å¶ä»å¨åµè¿è¡ leaderéä¸¾ï¼å¸æç±èªå·±æ¥è¿è¡ä¸»ä»åæ¢ãå¨è¿ä¸ªè¿ç¨ä¸­ï¼ä»»ä½ä¸ä¸ªå¨åµé½å¯ä»¥åä¸éä¸¾ï¼åªè¦ç¥¨æ°åæ°ä»¥ä¸å¹¶ä¸å¤§äºç­äº quorum å¼ï¼åå¯ä»¥æä¸º leader\n\n\n\n\n\n\n# 4. åèæç« \n\n * æ¬æä¸»è¦æ¯å­¦ä¹ ãæå®¢æ¶é´-redis æ ¸å¿ææ¯ä¸å®æãä¸æ æ»ç»èæ¥',charsets:{cjk:!0},lastUpdated:"2023/11/01, 11:48:43",lastUpdatedTimestamp:1698810523e3},{title:"redisä¹åçéç¾¤",frontmatter:{title:"redisä¹åçéç¾¤",date:"2022-12-01T15:18:45.000Z",permalink:"/pages/1c2914/",tags:["redis","æ°æ®åº"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"å¨æµ·éçæ°æ®é¢åï¼åä¸ª redis å®ä¾çè½åæ¯æéçï¼æ å¯è½æ éå¢å¤§çåå­ï¼æä»¥å¿é¡»è¦æå»ºåçéç¾¤ï¼æ¥æ¨ªåæå±æ¥æ¯æä¿å­æ´å¤çæ°æ®ã",feed:{enable:!0},categories:["æ°æ®åº","redis"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210808133416.png"},{name:"twitter:title",content:"redisä¹åçéç¾¤"},{name:"twitter:description",content:"å¨æµ·éçæ°æ®é¢åï¼åä¸ª redis å®ä¾çè½åæ¯æéçï¼æ å¯è½æ éå¢å¤§çåå­ï¼æä»¥å¿é¡»è¦æå»ºåçéç¾¤ï¼æ¥æ¨ªåæå±æ¥æ¯æä¿å­æ´å¤çæ°æ®ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210808133416.png"},{name:"twitter:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/05.%20redis%E4%B9%8B%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4.html"},{property:"og:type",content:"article"},{property:"og:title",content:"redisä¹åçéç¾¤"},{property:"og:description",content:"å¨æµ·éçæ°æ®é¢åï¼åä¸ª redis å®ä¾çè½åæ¯æéçï¼æ å¯è½æ éå¢å¤§çåå­ï¼æä»¥å¿é¡»è¦æå»ºåçéç¾¤ï¼æ¥æ¨ªåæå±æ¥æ¯æä¿å­æ´å¤çæ°æ®ã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210808133416.png"},{property:"og:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/05.%20redis%E4%B9%8B%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-12-01T15:18:45.000Z"},{property:"article:tag",content:"redis"},{property:"article:tag",content:"æ°æ®åº"},{itemprop:"name",content:"redisä¹åçéç¾¤"},{itemprop:"description",content:"å¨æµ·éçæ°æ®é¢åï¼åä¸ª redis å®ä¾çè½åæ¯æéçï¼æ å¯è½æ éå¢å¤§çåå­ï¼æä»¥å¿é¡»è¦æå»ºåçéç¾¤ï¼æ¥æ¨ªåæå±æ¥æ¯æä¿å­æ´å¤çæ°æ®ã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20210808133416.png"}],readingShow:"top"},regularPath:"/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/05.%20redis%E4%B9%8B%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4.html",relativePath:"03.ä¸­é´ä»¶/05.redis/05. redisä¹åçéç¾¤.md",key:"v-8855b59c",path:"/pages/1c2914/",headers:[{level:2,title:"0. åè¨",slug:"_0-åè¨",normalizedTitle:"0. åè¨",charIndex:2},{level:2,title:"1. åçéç¾¤æ¯ä»ä¹ï¼",slug:"_1-åçéç¾¤æ¯ä»ä¹",normalizedTitle:"1. åçéç¾¤æ¯ä»ä¹ï¼",charIndex:81},{level:2,title:"2. åçéç¾¤çç»å»º",slug:"_2-åçéç¾¤çç»å»º",normalizedTitle:"2. åçéç¾¤çç»å»º",charIndex:279},{level:2,title:"3. å®¢æ·ç«¯å¦ä½è¯»ååçéç¾¤",slug:"_3-å®¢æ·ç«¯å¦ä½è¯»ååçéç¾¤",normalizedTitle:"3. å®¢æ·ç«¯å¦ä½è¯»ååçéç¾¤",charIndex:587},{level:2,title:"4. åèæç« ",slug:"_4-åèæç« ",normalizedTitle:"4. åèæç« ",charIndex:1418}],headersStr:"0. åè¨ 1. åçéç¾¤æ¯ä»ä¹ï¼ 2. åçéç¾¤çç»å»º 3. å®¢æ·ç«¯å¦ä½è¯»ååçéç¾¤ 4. åèæç« ",content:"# 0. åè¨\n\nå¨æµ·éçæ°æ®é¢åï¼åä¸ª redis å®ä¾çè½åæ¯æéçï¼æ å¯è½æ éå¢å¤§çåå­ï¼æä»¥å¿é¡»è¦æå»ºåçéç¾¤ï¼æ¥æ¨ªåæå±æ¥æ¯æä¿å­æ´å¤çæ°æ®ã\n\n\n# 1. åçéç¾¤æ¯ä»ä¹ï¼\n\nåçéç¾¤ä¸»è¦æ¯å° redis çæ°æ®ååæå¤ä»½ï¼æ¯ä¸ä»½é½ç±ä¸ä¸ªå®ä¾æ¥ä¿å­ï¼ç¶åç±å¤ä¸ªå®ä¾æ¥ç»æä¸ä¸ªä¸ä¸ªéç¾¤ã\n\nä¸ºä»ä¹ä½¿ç¨åçéç¾¤èä¸æ¯å¢å åå­ï¼\n\n * å¨ RDB è¿è¡æä¹åæ¶ï¼ä¼ fork å­è¿ç¨æ¥å®æï¼fork æä½ä¼é»å¡ä¸»çº¿ç¨çæ¶é¿ä¸æ°æ®éææ­£æ¯ã\n * ç¡¬ä»¶ææ¬ï¼æåå­ä» 32GB æ©å±å° 64GB è¿ç®å®¹æï¼ä½æ¯ï¼è¦æ³æ©åå° 1TBï¼ææ¬å¤ªé«ã\n\n\n# 2. åçéç¾¤çç»å»º\n\nå¨ Redis Cluster æ¹æ¡ä¸­ï¼ä¸ä¸ªåçéç¾¤æ 16384 ä¸ªåå¸æ§½ï¼æ¯ä¸ªé®å¼å¯¹ç key ä¼è¿è¡è®¡ç®å¹¶å¯¹ 16384 åæ¨¡ï¼åéå°ä¸ä¸ªå¯¹åºç¼å·çåå¸æ§½ã\n\nå¨ä½¿ç¨ cluster create å½ä»¤åå»ºéç¾¤æ¶ï¼ä¼èªå¨å° 16384 ä¸ªæ§½å¹³ååéå°éç¾¤å®ä¾ä¸­ãä¹å¯ä»¥éè¿ cluster meet å½ä»¤æå¨å»ºç«å®ä¾é´çè¿æ¥å½¢æéç¾¤ï¼åä½¿ç¨ cluster addslots å½ä»¤æå®æ¯ä¸ªå®ä¾ä¸çåå¸æ§½çä¸ªæ°ã\n\nå¨æå¨åéåå¸æ§½æ¶ï¼éè¦æ 16384 ä¸ªæ§½é½åéå®ï¼å¦å Redis éç¾¤æ æ³æ­£å¸¸å·¥ä½ã\n\næ°æ®åéå°åªä¸ªå®ä¾?\n\næ°æ®æ ¹æ®åéå°åå¸æ§½ç¼å·åå¥å°å¯¹åºçå®ä¾ä¸­ã\n\n\n# 3. å®¢æ·ç«¯å¦ä½è¯»ååçéç¾¤\n\nå®¢æ·ç«¯ä»åªä¸ªå®ä¾ä¸­è¯»åæ°æ®ï¼\n\nå®¢æ·ç«¯ä¸éç¾¤å»ºç«è¿æ¥åï¼å®ä¾ä¼å°åå¸æ§½çåéä¿¡æ¯åéç»å®¢æ·ç«¯ãå®¢æ·ç«¯å°åå¸æ§½ä¿¡æ¯ç¼å­å¨æ¬å°ï¼å½å®¢æ·ç«¯æä½é®å¼å¯¹æ¶ï¼åè®¡ç®å¾å°å¯¹åºçåå¸æ§½ï¼ååéè¯·æ±å°ç¸åºçå®ä¾ã\n\nä½åå¸æ§½ä¸å®ä¾çæ å°å³ç³»å¹¶ä¸æ¯ä¸æä¸åçï¼å¯è½ä¼åçååï¼\n\n * éç¾¤ä¸­ï¼å®ä¾ææ°å¢æå é¤ï¼redis ä¼éæ°åéåå¸æ§½\n * ä¸ºäºè´è½½åè¡¡ï¼redis ä¼å°åå¸æ§½å¨ææå®ä¾ä¸­éæ°åå¸ã\n\nå½æ å°å³ç³»ååæ¶ï¼å®¢æ·ç«¯å¦ä½æç¥ï¼\n\néå®åæºå¶ãå®¢æ·ç«¯åéæ°æ®ç»ä¸ä¸ªå®ä¾ï¼ä½æ¯å¹¶æ²¡æè¿ä¸ªé®å¼å¯¹çåå¸æ§½ä¿¡æ¯ï¼åå®ä¾ä¼åé MOVED å½ä»¤ç»æç»å®¢æ·ç«¯ï¼åå«æ°å®ä¾çè®¿é®å°åãå®¢æ·ç«¯æ´æ°æ¬å°ç¼å­å®ä¾ä¸åå¸æ§½çæ å°å³ç³»ï¼å¹¶åæ°å®ä¾åéè¯·æ±ã\n\nGET hello:key\n(error) MOVED 13320 172.16.19.5:6379\n\n\n1\n2\n\n\nå®¢æ·ç«¯è¯·æ±çåå¸æ§½ 13320 å¨ 172.16.19.5 è¿ä¸ªå®ä¾ä¸\n\n\n\nå¦æè®¿é®çæ°æ®æ­£å¨è¿ç§»çåå¸æ§½ï¼è¯¥å¦ä½è®¿é®æ°æ®?\n\nSlot 2 æ­£å¨ä»å®ä¾ 2 å¾å®ä¾ 3 è¿ç§»ï¼key1 å key2 å·²ç»è¿ç§»è¿å»ï¼key3 å key4 è¿å¨å®ä¾ 2ãå®¢æ·ç«¯åå®ä¾ 2 è¯·æ± key2 åï¼å°±ä¼æ¶å°å®ä¾ 2 è¿åç ASK å½ä»¤ã\n\nASK å½ä»¤è¡¨ç¤ºä¸¤å±å«ä¹ï¼ç¬¬ä¸ï¼è¡¨æ Slot æ°æ®è¿å¨è¿ç§»ä¸­ï¼ç¬¬äºï¼ASK å½ä»¤æå®¢æ·ç«¯æè¯·æ±æ°æ®çææ°å®ä¾å°åè¿åç»å®¢æ·ç«¯ï¼æ­¤æ¶ï¼å®¢æ·ç«¯éè¦ç»å®ä¾ 3 åé ASKING å½ä»¤ï¼ç¶åååéæä½å½ä»¤ã\n\nå MOVED å½ä»¤ä¸åï¼ASK å½ä»¤å¹¶ä¸ä¼æ´æ°å®¢æ·ç«¯ç¼å­çåå¸æ§½åéä¿¡æ¯ã\n\nASK å½ä»¤çä½ç¨åªæ¯è®©å®¢æ·ç«¯è½ç»æ°å®ä¾åéä¸æ¬¡è¯·æ±ï¼èä¸å MOVED å½ä»¤é£æ ·ï¼ä¼æ´æ¹æ¬å°ç¼å­ï¼è®©åç»­ææå½ä»¤é½åå¾æ°å®ä¾ã\n\n\n\nå®¢æ·ç«¯ä¸ºä»ä¹å¯ä»¥å¨ä»»æä¸ä¸ªå®ä¾è·åææçåå¸æ§½ä¿¡æ¯ï¼\n\nredis å®ä¾ä¹é´ä¹ä¼å»ºç«è¿æ¥ï¼åäº«èªå·±çåå¸æ§½ä¿¡æ¯ã\n\n\n# 4. åèæç« \n\n * æ¬æä¸»è¦æ¯å­¦ä¹ ãæå®¢æ¶é´-redis æ ¸å¿ææ¯ä¸å®æãä¸æ æ»ç»èæ¥",normalizedContent:"# 0. åè¨\n\nå¨æµ·éçæ°æ®é¢åï¼åä¸ª redis å®ä¾çè½åæ¯æéçï¼æ å¯è½æ éå¢å¤§çåå­ï¼æä»¥å¿é¡»è¦æå»ºåçéç¾¤ï¼æ¥æ¨ªåæå±æ¥æ¯æä¿å­æ´å¤çæ°æ®ã\n\n\n# 1. åçéç¾¤æ¯ä»ä¹ï¼\n\nåçéç¾¤ä¸»è¦æ¯å° redis çæ°æ®ååæå¤ä»½ï¼æ¯ä¸ä»½é½ç±ä¸ä¸ªå®ä¾æ¥ä¿å­ï¼ç¶åç±å¤ä¸ªå®ä¾æ¥ç»æä¸ä¸ªä¸ä¸ªéç¾¤ã\n\nä¸ºä»ä¹ä½¿ç¨åçéç¾¤èä¸æ¯å¢å åå­ï¼\n\n * å¨ rdb è¿è¡æä¹åæ¶ï¼ä¼ fork å­è¿ç¨æ¥å®æï¼fork æä½ä¼é»å¡ä¸»çº¿ç¨çæ¶é¿ä¸æ°æ®éææ­£æ¯ã\n * ç¡¬ä»¶ææ¬ï¼æåå­ä» 32gb æ©å±å° 64gb è¿ç®å®¹æï¼ä½æ¯ï¼è¦æ³æ©åå° 1tbï¼ææ¬å¤ªé«ã\n\n\n# 2. åçéç¾¤çç»å»º\n\nå¨ redis cluster æ¹æ¡ä¸­ï¼ä¸ä¸ªåçéç¾¤æ 16384 ä¸ªåå¸æ§½ï¼æ¯ä¸ªé®å¼å¯¹ç key ä¼è¿è¡è®¡ç®å¹¶å¯¹ 16384 åæ¨¡ï¼åéå°ä¸ä¸ªå¯¹åºç¼å·çåå¸æ§½ã\n\nå¨ä½¿ç¨ cluster create å½ä»¤åå»ºéç¾¤æ¶ï¼ä¼èªå¨å° 16384 ä¸ªæ§½å¹³ååéå°éç¾¤å®ä¾ä¸­ãä¹å¯ä»¥éè¿ cluster meet å½ä»¤æå¨å»ºç«å®ä¾é´çè¿æ¥å½¢æéç¾¤ï¼åä½¿ç¨ cluster addslots å½ä»¤æå®æ¯ä¸ªå®ä¾ä¸çåå¸æ§½çä¸ªæ°ã\n\nå¨æå¨åéåå¸æ§½æ¶ï¼éè¦æ 16384 ä¸ªæ§½é½åéå®ï¼å¦å redis éç¾¤æ æ³æ­£å¸¸å·¥ä½ã\n\næ°æ®åéå°åªä¸ªå®ä¾?\n\næ°æ®æ ¹æ®åéå°åå¸æ§½ç¼å·åå¥å°å¯¹åºçå®ä¾ä¸­ã\n\n\n# 3. å®¢æ·ç«¯å¦ä½è¯»ååçéç¾¤\n\nå®¢æ·ç«¯ä»åªä¸ªå®ä¾ä¸­è¯»åæ°æ®ï¼\n\nå®¢æ·ç«¯ä¸éç¾¤å»ºç«è¿æ¥åï¼å®ä¾ä¼å°åå¸æ§½çåéä¿¡æ¯åéç»å®¢æ·ç«¯ãå®¢æ·ç«¯å°åå¸æ§½ä¿¡æ¯ç¼å­å¨æ¬å°ï¼å½å®¢æ·ç«¯æä½é®å¼å¯¹æ¶ï¼åè®¡ç®å¾å°å¯¹åºçåå¸æ§½ï¼ååéè¯·æ±å°ç¸åºçå®ä¾ã\n\nä½åå¸æ§½ä¸å®ä¾çæ å°å³ç³»å¹¶ä¸æ¯ä¸æä¸åçï¼å¯è½ä¼åçååï¼\n\n * éç¾¤ä¸­ï¼å®ä¾ææ°å¢æå é¤ï¼redis ä¼éæ°åéåå¸æ§½\n * ä¸ºäºè´è½½åè¡¡ï¼redis ä¼å°åå¸æ§½å¨ææå®ä¾ä¸­éæ°åå¸ã\n\nå½æ å°å³ç³»ååæ¶ï¼å®¢æ·ç«¯å¦ä½æç¥ï¼\n\néå®åæºå¶ãå®¢æ·ç«¯åéæ°æ®ç»ä¸ä¸ªå®ä¾ï¼ä½æ¯å¹¶æ²¡æè¿ä¸ªé®å¼å¯¹çåå¸æ§½ä¿¡æ¯ï¼åå®ä¾ä¼åé moved å½ä»¤ç»æç»å®¢æ·ç«¯ï¼åå«æ°å®ä¾çè®¿é®å°åãå®¢æ·ç«¯æ´æ°æ¬å°ç¼å­å®ä¾ä¸åå¸æ§½çæ å°å³ç³»ï¼å¹¶åæ°å®ä¾åéè¯·æ±ã\n\nget hello:key\n(error) moved 13320 172.16.19.5:6379\n\n\n1\n2\n\n\nå®¢æ·ç«¯è¯·æ±çåå¸æ§½ 13320 å¨ 172.16.19.5 è¿ä¸ªå®ä¾ä¸\n\n\n\nå¦æè®¿é®çæ°æ®æ­£å¨è¿ç§»çåå¸æ§½ï¼è¯¥å¦ä½è®¿é®æ°æ®?\n\nslot 2 æ­£å¨ä»å®ä¾ 2 å¾å®ä¾ 3 è¿ç§»ï¼key1 å key2 å·²ç»è¿ç§»è¿å»ï¼key3 å key4 è¿å¨å®ä¾ 2ãå®¢æ·ç«¯åå®ä¾ 2 è¯·æ± key2 åï¼å°±ä¼æ¶å°å®ä¾ 2 è¿åç ask å½ä»¤ã\n\nask å½ä»¤è¡¨ç¤ºä¸¤å±å«ä¹ï¼ç¬¬ä¸ï¼è¡¨æ slot æ°æ®è¿å¨è¿ç§»ä¸­ï¼ç¬¬äºï¼ask å½ä»¤æå®¢æ·ç«¯æè¯·æ±æ°æ®çææ°å®ä¾å°åè¿åç»å®¢æ·ç«¯ï¼æ­¤æ¶ï¼å®¢æ·ç«¯éè¦ç»å®ä¾ 3 åé asking å½ä»¤ï¼ç¶åååéæä½å½ä»¤ã\n\nå moved å½ä»¤ä¸åï¼ask å½ä»¤å¹¶ä¸ä¼æ´æ°å®¢æ·ç«¯ç¼å­çåå¸æ§½åéä¿¡æ¯ã\n\nask å½ä»¤çä½ç¨åªæ¯è®©å®¢æ·ç«¯è½ç»æ°å®ä¾åéä¸æ¬¡è¯·æ±ï¼èä¸å moved å½ä»¤é£æ ·ï¼ä¼æ´æ¹æ¬å°ç¼å­ï¼è®©åç»­ææå½ä»¤é½åå¾æ°å®ä¾ã\n\n\n\nå®¢æ·ç«¯ä¸ºä»ä¹å¯ä»¥å¨ä»»æä¸ä¸ªå®ä¾è·åææçåå¸æ§½ä¿¡æ¯ï¼\n\nredis å®ä¾ä¹é´ä¹ä¼å»ºç«è¿æ¥ï¼åäº«èªå·±çåå¸æ§½ä¿¡æ¯ã\n\n\n# 4. åèæç« \n\n * æ¬æä¸»è¦æ¯å­¦ä¹ ãæå®¢æ¶é´-redis æ ¸å¿ææ¯ä¸å®æãä¸æ æ»ç»èæ¥",charsets:{cjk:!0},lastUpdated:"2023/11/01, 11:48:43",lastUpdatedTimestamp:1698810523e3},{title:"redisä¹ç¼å­",frontmatter:{title:"redisä¹ç¼å­",date:"2022-12-01T15:18:55.000Z",permalink:"/pages/0d7b25/",tags:["redis","æ°æ®åº"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"reids æ¯åºäºåå­çæ°æ®åºï¼å®çç¹æ§ä¹ä¸å°±å¿«ï¼ç¼å­æ¯å¶æä¸»è¦çåºç¨åºæ¯ï¼æ¬æä¸»è¦ä»ç» redis çç¼å­ç¹æ§ï¼ä»¥åè¯¥å¦ä½æ­£ç¡®çä½¿ç¨å®ã",feed:{enable:!0},categories:["æ°æ®åº","redis"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/16698736280551669873627898.png"},{name:"twitter:title",content:"redisä¹ç¼å­"},{name:"twitter:description",content:"reids æ¯åºäºåå­çæ°æ®åºï¼å®çç¹æ§ä¹ä¸å°±å¿«ï¼ç¼å­æ¯å¶æä¸»è¦çåºç¨åºæ¯ï¼æ¬æä¸»è¦ä»ç» redis çç¼å­ç¹æ§ï¼ä»¥åè¯¥å¦ä½æ­£ç¡®çä½¿ç¨å®ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/16698736280551669873627898.png"},{name:"twitter:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/06.%20redis%E4%B9%8B%E7%BC%93%E5%AD%98.html"},{property:"og:type",content:"article"},{property:"og:title",content:"redisä¹ç¼å­"},{property:"og:description",content:"reids æ¯åºäºåå­çæ°æ®åºï¼å®çç¹æ§ä¹ä¸å°±å¿«ï¼ç¼å­æ¯å¶æä¸»è¦çåºç¨åºæ¯ï¼æ¬æä¸»è¦ä»ç» redis çç¼å­ç¹æ§ï¼ä»¥åè¯¥å¦ä½æ­£ç¡®çä½¿ç¨å®ã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/16698736280551669873627898.png"},{property:"og:url",content:"https://www.msqfx.cc/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/06.%20redis%E4%B9%8B%E7%BC%93%E5%AD%98.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-12-01T15:18:55.000Z"},{property:"article:tag",content:"redis"},{property:"article:tag",content:"æ°æ®åº"},{itemprop:"name",content:"redisä¹ç¼å­"},{itemprop:"description",content:"reids æ¯åºäºåå­çæ°æ®åºï¼å®çç¹æ§ä¹ä¸å°±å¿«ï¼ç¼å­æ¯å¶æä¸»è¦çåºç¨åºæ¯ï¼æ¬æä¸»è¦ä»ç» redis çç¼å­ç¹æ§ï¼ä»¥åè¯¥å¦ä½æ­£ç¡®çä½¿ç¨å®ã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/16698736280551669873627898.png"}],readingShow:"top"},regularPath:"/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.redis/06.%20redis%E4%B9%8B%E7%BC%93%E5%AD%98.html",relativePath:"03.ä¸­é´ä»¶/05.redis/06. redisä¹ç¼å­.md",key:"v-3dc84304",path:"/pages/0d7b25/",headers:[{level:2,title:"1. åè¨",slug:"_1-åè¨",normalizedTitle:"1. åè¨",charIndex:2},{level:2,title:"2. ç¼å­ç±»å",slug:"_2-ç¼å­ç±»å",normalizedTitle:"2. ç¼å­ç±»å",charIndex:83},{level:3,title:"2.1 åªè¯»ç¼å­",slug:"_2-1-åªè¯»ç¼å­",normalizedTitle:"2.1 åªè¯»ç¼å­",charIndex:95},{level:3,title:"2.2 è¯»åç¼å­",slug:"_2-2-è¯»åç¼å­",normalizedTitle:"2.2 è¯»åç¼å­",charIndex:250},{level:2,title:"2. ç¼å­åæ°æ®åºçæ°æ®ä¸è´æ§",slug:"_2-ç¼å­åæ°æ®åºçæ°æ®ä¸è´æ§",normalizedTitle:"2. ç¼å­åæ°æ®åºçæ°æ®ä¸è´æ§",charIndex:468},{level:3,title:"2.1 åªäºæåµä¼å¯¼è´æ°æ®ä¸ä¸è´ ï¼",slug:"_2-1-åªäºæåµä¼å¯¼è´æ°æ®ä¸ä¸è´",normalizedTitle:"2.1 åªäºæåµä¼å¯¼è´æ°æ®ä¸ä¸è´ ï¼",charIndex:488},{level:3,title:"2.3 éå+éè¯æºå¶",slug:"_2-3-éå-éè¯æºå¶",normalizedTitle:"2.3 éå+éè¯æºå¶",charIndex:738},{level:2,title:"3. æ·æ±°ç­ç¥",slug:"_3-æ·æ±°ç­ç¥",normalizedTitle:"3. æ·æ±°ç­ç¥",charIndex:1364},{level:2,title:"4. ç¼å­éªå´©",slug:"_4-ç¼å­éªå´©",normalizedTitle:"4. ç¼å­éªå´©",charIndex:1896},{level:2,title:"5. ç¼å­å»ç©¿",slug:"_5-ç¼å­å»ç©¿",normalizedTitle:"5. ç¼å­å»ç©¿",charIndex:2234},{level:2,title:"6. ç¼å­ç©¿é",slug:"_6-ç¼å­ç©¿é",normalizedTitle:"6. ç¼å­ç©¿é",charIndex:2445},{level:2,title:"7. åèæç« ",slug:"_7-åèæç« ",normalizedTitle:"7. åèæç« ",charIndex:2741}],headersStr:"1. åè¨ 2. ç¼å­ç±»å 2.1 åªè¯»ç¼å­ 2.2 è¯»åç¼å­ 2. ç¼å­åæ°æ®åºçæ°æ®ä¸è´æ§ 2.1 åªäºæåµä¼å¯¼è´æ°æ®ä¸ä¸è´ ï¼ 2.3 éå+éè¯æºå¶ 3. æ·æ±°ç­ç¥ 4. ç¼å­éªå´© 5. ç¼å­å»ç©¿ 6. ç¼å­ç©¿é 7. åèæç« ",content:"# 1. åè¨\n\nreids æ¯åºäºåå­çæ°æ®åºï¼å®çç¹æ§ä¹ä¸å°±å¿«ï¼ç¼å­æ¯å¶æä¸»è¦çåºç¨åºæ¯ï¼æ¬æä¸»è¦ä»ç» redis çç¼å­ç¹æ§ï¼ä»¥åè¯¥å¦ä½æ­£ç¡®çä½¿ç¨å®ã\n\n\n# 2. ç¼å­ç±»å\n\n\n# 2.1 åªè¯»ç¼å­\n\nå½åå¥æ°æ®æ¶ï¼ç´æ¥æä½åç«¯æ°æ®åºï¼è¿è¡å¢å æ¹ãå åæ¹æä½ï¼å¦æ redis å·²ç»ç¼å­äºå¯¹åºçæ°æ®ï¼åéè¦è¿è¡å é¤ãå½åºç¨è¯»åæ°æ®æ¶ï¼åçç¼å­ç¼ºå¤±ï¼åä¼ä»åç«¯æ°æ®åºè¯»åå° redis ä¸­ä½¿ç¨ã\n\n\n\nå¥½å¤æ¯ææçæ°æ®é½å¨åç«¯æ°æ®åºä¸­ï¼èåç«¯æ°æ®æä¾å¯é æ§ä¿éï¼ä¸ä¼æä¸¢å¤±æ°æ®çé£é©ã\n\n\n# 2.2 è¯»åç¼å­\n\nææ°çæ°æ®å¨ redis ä¸­ãå¨åå¥æ°æ®æ¶ï¼ä¼ååå¥å° redisï¼å¹¶ä¸å ä¸ºç¼å­çé«æ§è½è®¿é®ï¼å¯ä»¥å¿«éè¿åç»ä¸å¡åºç¨ã\n\nä½æ¯ç±äº redis æ¯åå­æ°æ®åºå­å¨æ°æ®ä¸¢å¤±çé£é©ï¼æä»¥è¿æ¯éè¦åå¥å°åç«¯æ°æ®åºä¸­ä¿è¯å¯é æ§ãæä¸¤ç§åå¥ç­ç¥ï¼\n\n * åæ­¥ç´åï¼å¨å redis æ¶ï¼åæ­¥åå¥å°åç«¯æ°æ®åºï¼å®æååè¿åç»ä¸å¡ãä¼å¢å ååºå»¶è¿ã\n * å¼æ­¥ç´åï¼ç­å¾å¢æ¹çæ°æ®è¦è¢«ä»ç¼å­æ·æ±°æ¶ãååååç«¯æ°æ®åºã\n\n\n\n\n# 2. ç¼å­åæ°æ®åºçæ°æ®ä¸è´æ§\n\n\n# 2.1 åªäºæåµä¼å¯¼è´æ°æ®ä¸ä¸è´ ï¼\n\n * æä»¬åè®¾åºç¨åå é¤ç¼å­ï¼åæ´æ°æ°æ®åºï¼å¦æç¼å­å é¤æåï¼ä½æ¯æ°æ®åºæ´æ°å¤±è´¥ï¼é£ä¹ï¼åºç¨åè®¿é®æ°æ®æ¶ï¼ç¼å­ä¸­æ²¡ææ°æ®ï¼å°±ä¼åçç¼å­ç¼ºå¤±ãç¶åï¼åºç¨åè®¿é®æ°æ®åºï¼ä½æ¯æ°æ®åºä¸­çå¼ä¸ºæ§å¼ï¼åºç¨å°±è®¿é®å°æ§å¼äºã\n\n * å¦æåºç¨åå®æäºæ°æ®åºçæ´æ°ï¼ä½æ¯ï¼å¨å é¤ç¼å­æ¶å¤±è´¥äºï¼é£ä¹ï¼æ°æ®åºä¸­çå¼æ¯æ°å¼ï¼èç¼å­ä¸­çæ¯æ§å¼ï¼è¿è¯å®æ¯ä¸ä¸è´çãè¿ä¸ªæ¶åï¼å¦ææå¶ä»çå¹¶åè¯·æ±æ¥è®¿é®æ°æ®ï¼æç§æ­£å¸¸çç¼å­è®¿é®æµç¨ï¼å°±ä¼åå¨ç¼å­ä¸­æ¥è¯¢ï¼ä½æ­¤æ¶ï¼å°±ä¼è¯»å°æ§å¼äºã\n\n\n\n\n# 2.3 éå+éè¯æºå¶\n\nå¯ä»¥æè¦å é¤çç¼å­å¼æèæ¯è¦æ´æ°çæ°æ®åºå¼æå­å°æ¶æ¯éåä¸­ï¼ä¾å¦ä½¿ç¨ Kafka æ¶æ¯éåï¼ãå½åºç¨æ²¡æè½å¤æåå°å é¤ç¼å­å¼æèæ¯æ´æ°æ°æ®åºå¼æ¶ï¼å¯ä»¥ä»æ¶æ¯éåä¸­éæ°è¯»åè¿äºå¼ï¼ç¶ååæ¬¡è¿è¡å é¤ææ´æ°ã\n\nå¦æè½å¤æåå°å é¤ææ´æ°ï¼æä»¬å°±è¦æè¿äºå¼ä»æ¶æ¯éåä¸­å»é¤ï¼ä»¥åéå¤æä½\n\nä½æ¯å¨å¹¶åæåµä¸ï¼æ è®ºæ¯åå æ°æ®åºè¿æ¯åå ç¼å­æä½å¤±è´¥çæåµä¸ï¼è¿æ¯ä¼æè¯»åå°ä¸ä¸è´æ°æ®çæåµã\n\n * æåµä¸ï¼åå é¤ç¼å­ï¼åæ´æ°æ°æ®åºã\n\nå¨æ´æ°æ°æ®åºå¤±è´¥çæåµä¸ï¼å¦ä¸ä¸ªçº¿ç¨è¿æ¥è¯»åæ°æ®ï¼åç°ç¼å­ç¼ºå¤±ï¼æ¥è¯¢æ°æ®åºçæ°æ®ï¼å¹¶æ´æ°å°ç¼å­ä¸­ï¼æç»ç¼å­ä¸­å­å¨çæ¯æ§çæ°æ®ã\n\nå»¶è¿åå \n\nå¨çº¿ç¨ A æ´æ°å®æ°æ®åºçå¼ä»¥åï¼åè®©å® sleep ä¸ä¼å¿ï¼åå é¤ç¼å­ãç®çæ¯ä¸ºäºè®©çº¿ç¨ B å¯ä»¥å°æ°æ®åºçå¼åå¥å°ç¼å­ä¸­ï¼ç¶ååå é¤å®ã ä¼ªä»£ç å¦ä¸ï¼\n\nredis.delKey(X)\ndb.update(X)\nThread.sleep(N)\nredis.delKey(X)\n\n\n1\n2\n3\n4\n\n\nç½ä¸æä½¿ç¨è¿ç§æ¹æ¡æ¥è§£å³ï¼ä¸ªäººæ¯ä¸æ¨èè¿ç§æ¹æ¡ï¼å¨é«å¹¶åçæåµä¸ï¼è¿ä¸ª sleep æ¶é´ä¸å¥½ç¡®å®ï¼å¹¶ä¸ç¥éå¶ä»çº¿ç¨ä»ä¹æ¶åæ§è¡åç»æã\n\n * æåµäºï¼åæ´æ°æ°æ®åºå¼ï¼åå é¤ç¼å­å¼ã\n\nå¨å é¤ç¼å­å¼å¤±è´¥çæåµä¸ï¼å¹¶åæ¶ï¼ä¼æå¤ä¸ªçº¿ç¨æ¿å°æ§çæ°æ®æåµã\n\nè¿ä¸¤ç§å¹¶ååºæ¯ï¼ä¸ªäººæè§å¯ä¸çåæ³å°±æ¯ä½¿ç¨åæ­¥æ¥å®æè¿ä¸¤ä¸ªæä½ï¼å¯ä»¥ä½¿ç¨åå¸å¼éæèå¶ä»ã\n\n\n# 3. æ·æ±°ç­ç¥\n\nç¼å­çå®¹éæ¯æéçï¼é£ä¹å½ç¼å­æ»¡äºï¼å¯ä»¥æ¯ç¨æ·æ±°ç­ç¥æ¥å°é¨åæ°æ®æ·æ±°ã\n\nç¼å­è®¾ç½®æå¤å¤§æ¯è¾åéï¼ æç§äºå«åçï¼ä¸è¬ 20%æ°æ®ä¼å ç¨ 80%çè®¿é®ï¼æä»¥å»ºè®®å°ç¼å­çå®¹éè®¾ç½®ä¸ºæ»æ°æ®éç 15%æè 30%ä¼æ¯è¾åçã\n\næ·æ±°ç­ç¥æåªäº?\n\n * ä¸æ·æ±°\n   * noevictionï¼å¦æç¼å­å·²æ»¡åæåè¯·æ±ï¼åè¿åéè¯¯\n * å¯¹è®¾ç½®è¿ææ¶é´çæ°æ®è¿è¡æ·æ±°\n   * volatile-ttl å¨ç­éæ¶ï¼ä¼éå¯¹è®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ï¼æ ¹æ®è¿ææ¶é´çååè¿è¡å é¤ï¼è¶æ©è¿æçè¶åè¢«å é¤ã\n   * volatile-random å°±åå®çåç§°ä¸æ ·ï¼å¨è®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ä¸­ï¼è¿è¡éæºå é¤ã\n   * volatile-lru ä¼ä½¿ç¨ LRU ç®æ³ç­éè®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ã\n   * volatile-lfu ä¼ä½¿ç¨ LFU ç®æ³éæ©è®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ã\n * å¯¹æææ°æ®è¿è¡æ·æ±°\n   * allkeys-random ç­ç¥ï¼ä»ææé®å¼å¯¹ä¸­éæºéæ©å¹¶å é¤æ°æ®ï¼\n   * allkeys-lru ç­ç¥ï¼ä½¿ç¨ LRU ç®æ³å¨æææ°æ®ä¸­è¿è¡ç­éã\n   * allkeys-lfu ç­ç¥ï¼ä½¿ç¨ LFU ç®æ³å¨æææ°æ®ä¸­è¿è¡ç­éã\n\n\n# 4. ç¼å­éªå´©\n\nç¼å­éªå´©æ¯æå¤§éçåºç¨è¯·æ±æ æ³å¨ Redis ç¼å­ä¸­è¿è¡å¤çï¼ç´§æ¥çï¼åºç¨å°å¤§éè¯·æ±åéå°æ°æ®åºå±ï¼å¯¼è´æ°æ®åºå±çååæ¿å¢ã\n\näº§ççåå \n\n * ç¼å­ä¸­æå¤§éæ°æ®åæ¶è¿æï¼å¯¼è´å¤§éè¯·æ±æ æ³å¾å°å¤ç\n * redisæå¡å®æº\n\nåçåææè§£å³åæ³\n\n 1. æ¯å¨ä¸å¡ç³»ç»ä¸­å®ç°æå¡çæ­æè¯·æ±éæµæºå¶ã\n\n\n\n 2. æå¡éçº§ãéæ ¸å¿æ°æ®ï¼ç´æ¥è¿åé¢å®ä¹ä¿¡æ¯ï¼éè¯¯æç©ºå¼ãæ ¸å¿ä¸å¡ä»ç¶æ¥è¯¢ç¼å­ãåå°æ°æ®åºåå\n\næåé¢é²\n\nä¸é¢çé½æ¯åçåææçè§£å³æªæ½ï¼æä»¥æå¥½çåæ³æ¯æåé¢é²ï¼è®©å®ä¸è¦åçã\n\n 1. é¿åå¤§éæ°æ®è®¾ç½®ç¸åç¹é¢è¿ææ¶é´ï¼å¦ææï¼å¯ä»¥å ä¸ªéæºæ°ã\n 2. æ­å»ºé«å¯ç¨éç¾¤ï¼ä¸»èç¹æéå®æºï¼ä»èç¹å¯ä»¥åæ¢æä¸»èç¹ï¼ç»§ç»­æä¾ç¼å­æå¡ã\n\n\n# 5. ç¼å­å»ç©¿\n\nç¼å­å»ç©¿æ¯æï¼éå¯¹æä¸ªè®¿é®éå¸¸é¢ç¹çç­ç¹æ°æ®çè¯·æ±ï¼æ æ³å¨ç¼å­ä¸­è¿è¡å¤çï¼ç´§æ¥çï¼è®¿é®è¯¥æ°æ®çå¤§éè¯·æ±ï¼ä¸ä¸å­é½åéå°äºåç«¯æ°æ®åºï¼å¯¼è´äºæ°æ®åºååæ¿å¢ï¼ä¼å½±åæ°æ®åºå¤çå¶ä»è¯·æ±ãç¼å­å»ç©¿çæåµï¼ç»å¸¸åçå¨ç­ç¹æ°æ®è¿æå¤±ææ¶\n\n\n\näº§ççåå \n\n * ç­ç¹æ°æ®åçè¿æè¢«æ·æ±°å¯¼è´è®¿é®åç«¯æ°æ®åº\n\nåçåææçè§£å³åæ³\n\n * æ¥å£éæµä¸çæ­ï¼éçº§ã\n\næåé¢é²\n\n * è®¾ç½®ç­ç¹æ°æ®æ°¸è¿ä¸è¿æã\n\n\n# 6. ç¼å­ç©¿é\n\nç¼å­ç©¿éæ¯æè¦è®¿é®çæ°æ®æ¢ä¸å¨ Redis ç¼å­ä¸­ï¼ä¹ä¸å¨æ°æ®åºä¸­ï¼å¯¼è´è¯·æ±å¨è®¿é®ç¼å­æ¶ï¼åçç¼å­ç¼ºå¤±ï¼åå»è®¿é®æ°æ®åºæ¶ï¼åç°æ°æ®åºä¸­ä¹æ²¡æè¦è®¿é®çæ°æ®ã\n\näº§ççåå \n\n * ä¸å¡å±è¯¯æä½ï¼ç¼å­ä¸­çæ°æ®åæ°æ®åºä¸­çæ°æ®è¢«è¯¯å é¤äºï¼æä»¥ç¼å­åæ°æ®åºä¸­é½æ²¡ææ°æ®ï¼\n * æ¶ææ»å»ï¼ä¸é¨è®¿é®æ°æ®åºä¸­æ²¡æçæ°æ®ã\n\n\n\nåºå¯¹æ¹æ¡\n\n * å¨è¯·æ±å¥å£ååæ³æ§æ ¡éªï¼ææ¶æè¯·æ±è¿æ»¤æã\n * å¸éè¿æ»¤å¨ï¼å¿«éæ ¡éªæ°æ®æ¯å¦å­å¨ï¼é¿åä»æ°æ®åºä¸­æ¥è¯¢æ°æ®æ¯å¦å­å¨ï¼åè½»æ°æ®åºååã\n * ä¸æ¦åçæ°æ®ä¸å­å¨çæåµï¼å¯ä»¥ç¼å­ä¸ä¸ªç¼ºçå¼ï¼ä¸æ¬¡è¿ä½¿ç¨è¯¥ ID è®¿é®æ¶ï¼å¯ä»¥è¿åç¼ºçå¼ã\n\n\n# 7. åèæç« \n\n * æ¬æä¸»è¦æ¯å­¦ä¹ ãæå®¢æ¶é´-redis æ ¸å¿ææ¯ä¸å®æãä¸æ æ»ç»èæ¥",normalizedContent:"# 1. åè¨\n\nreids æ¯åºäºåå­çæ°æ®åºï¼å®çç¹æ§ä¹ä¸å°±å¿«ï¼ç¼å­æ¯å¶æä¸»è¦çåºç¨åºæ¯ï¼æ¬æä¸»è¦ä»ç» redis çç¼å­ç¹æ§ï¼ä»¥åè¯¥å¦ä½æ­£ç¡®çä½¿ç¨å®ã\n\n\n# 2. ç¼å­ç±»å\n\n\n# 2.1 åªè¯»ç¼å­\n\nå½åå¥æ°æ®æ¶ï¼ç´æ¥æä½åç«¯æ°æ®åºï¼è¿è¡å¢å æ¹ãå åæ¹æä½ï¼å¦æ redis å·²ç»ç¼å­äºå¯¹åºçæ°æ®ï¼åéè¦è¿è¡å é¤ãå½åºç¨è¯»åæ°æ®æ¶ï¼åçç¼å­ç¼ºå¤±ï¼åä¼ä»åç«¯æ°æ®åºè¯»åå° redis ä¸­ä½¿ç¨ã\n\n\n\nå¥½å¤æ¯ææçæ°æ®é½å¨åç«¯æ°æ®åºä¸­ï¼èåç«¯æ°æ®æä¾å¯é æ§ä¿éï¼ä¸ä¼æä¸¢å¤±æ°æ®çé£é©ã\n\n\n# 2.2 è¯»åç¼å­\n\nææ°çæ°æ®å¨ redis ä¸­ãå¨åå¥æ°æ®æ¶ï¼ä¼ååå¥å° redisï¼å¹¶ä¸å ä¸ºç¼å­çé«æ§è½è®¿é®ï¼å¯ä»¥å¿«éè¿åç»ä¸å¡åºç¨ã\n\nä½æ¯ç±äº redis æ¯åå­æ°æ®åºå­å¨æ°æ®ä¸¢å¤±çé£é©ï¼æä»¥è¿æ¯éè¦åå¥å°åç«¯æ°æ®åºä¸­ä¿è¯å¯é æ§ãæä¸¤ç§åå¥ç­ç¥ï¼\n\n * åæ­¥ç´åï¼å¨å redis æ¶ï¼åæ­¥åå¥å°åç«¯æ°æ®åºï¼å®æååè¿åç»ä¸å¡ãä¼å¢å ååºå»¶è¿ã\n * å¼æ­¥ç´åï¼ç­å¾å¢æ¹çæ°æ®è¦è¢«ä»ç¼å­æ·æ±°æ¶ãååååç«¯æ°æ®åºã\n\n\n\n\n# 2. ç¼å­åæ°æ®åºçæ°æ®ä¸è´æ§\n\n\n# 2.1 åªäºæåµä¼å¯¼è´æ°æ®ä¸ä¸è´ ï¼\n\n * æä»¬åè®¾åºç¨åå é¤ç¼å­ï¼åæ´æ°æ°æ®åºï¼å¦æç¼å­å é¤æåï¼ä½æ¯æ°æ®åºæ´æ°å¤±è´¥ï¼é£ä¹ï¼åºç¨åè®¿é®æ°æ®æ¶ï¼ç¼å­ä¸­æ²¡ææ°æ®ï¼å°±ä¼åçç¼å­ç¼ºå¤±ãç¶åï¼åºç¨åè®¿é®æ°æ®åºï¼ä½æ¯æ°æ®åºä¸­çå¼ä¸ºæ§å¼ï¼åºç¨å°±è®¿é®å°æ§å¼äºã\n\n * å¦æåºç¨åå®æäºæ°æ®åºçæ´æ°ï¼ä½æ¯ï¼å¨å é¤ç¼å­æ¶å¤±è´¥äºï¼é£ä¹ï¼æ°æ®åºä¸­çå¼æ¯æ°å¼ï¼èç¼å­ä¸­çæ¯æ§å¼ï¼è¿è¯å®æ¯ä¸ä¸è´çãè¿ä¸ªæ¶åï¼å¦ææå¶ä»çå¹¶åè¯·æ±æ¥è®¿é®æ°æ®ï¼æç§æ­£å¸¸çç¼å­è®¿é®æµç¨ï¼å°±ä¼åå¨ç¼å­ä¸­æ¥è¯¢ï¼ä½æ­¤æ¶ï¼å°±ä¼è¯»å°æ§å¼äºã\n\n\n\n\n# 2.3 éå+éè¯æºå¶\n\nå¯ä»¥æè¦å é¤çç¼å­å¼æèæ¯è¦æ´æ°çæ°æ®åºå¼æå­å°æ¶æ¯éåä¸­ï¼ä¾å¦ä½¿ç¨ kafka æ¶æ¯éåï¼ãå½åºç¨æ²¡æè½å¤æåå°å é¤ç¼å­å¼æèæ¯æ´æ°æ°æ®åºå¼æ¶ï¼å¯ä»¥ä»æ¶æ¯éåä¸­éæ°è¯»åè¿äºå¼ï¼ç¶ååæ¬¡è¿è¡å é¤ææ´æ°ã\n\nå¦æè½å¤æåå°å é¤ææ´æ°ï¼æä»¬å°±è¦æè¿äºå¼ä»æ¶æ¯éåä¸­å»é¤ï¼ä»¥åéå¤æä½\n\nä½æ¯å¨å¹¶åæåµä¸ï¼æ è®ºæ¯åå æ°æ®åºè¿æ¯åå ç¼å­æä½å¤±è´¥çæåµä¸ï¼è¿æ¯ä¼æè¯»åå°ä¸ä¸è´æ°æ®çæåµã\n\n * æåµä¸ï¼åå é¤ç¼å­ï¼åæ´æ°æ°æ®åºã\n\nå¨æ´æ°æ°æ®åºå¤±è´¥çæåµä¸ï¼å¦ä¸ä¸ªçº¿ç¨è¿æ¥è¯»åæ°æ®ï¼åç°ç¼å­ç¼ºå¤±ï¼æ¥è¯¢æ°æ®åºçæ°æ®ï¼å¹¶æ´æ°å°ç¼å­ä¸­ï¼æç»ç¼å­ä¸­å­å¨çæ¯æ§çæ°æ®ã\n\nå»¶è¿åå \n\nå¨çº¿ç¨ a æ´æ°å®æ°æ®åºçå¼ä»¥åï¼åè®©å® sleep ä¸ä¼å¿ï¼åå é¤ç¼å­ãç®çæ¯ä¸ºäºè®©çº¿ç¨ b å¯ä»¥å°æ°æ®åºçå¼åå¥å°ç¼å­ä¸­ï¼ç¶ååå é¤å®ã ä¼ªä»£ç å¦ä¸ï¼\n\nredis.delkey(x)\ndb.update(x)\nthread.sleep(n)\nredis.delkey(x)\n\n\n1\n2\n3\n4\n\n\nç½ä¸æä½¿ç¨è¿ç§æ¹æ¡æ¥è§£å³ï¼ä¸ªäººæ¯ä¸æ¨èè¿ç§æ¹æ¡ï¼å¨é«å¹¶åçæåµä¸ï¼è¿ä¸ª sleep æ¶é´ä¸å¥½ç¡®å®ï¼å¹¶ä¸ç¥éå¶ä»çº¿ç¨ä»ä¹æ¶åæ§è¡åç»æã\n\n * æåµäºï¼åæ´æ°æ°æ®åºå¼ï¼åå é¤ç¼å­å¼ã\n\nå¨å é¤ç¼å­å¼å¤±è´¥çæåµä¸ï¼å¹¶åæ¶ï¼ä¼æå¤ä¸ªçº¿ç¨æ¿å°æ§çæ°æ®æåµã\n\nè¿ä¸¤ç§å¹¶ååºæ¯ï¼ä¸ªäººæè§å¯ä¸çåæ³å°±æ¯ä½¿ç¨åæ­¥æ¥å®æè¿ä¸¤ä¸ªæä½ï¼å¯ä»¥ä½¿ç¨åå¸å¼éæèå¶ä»ã\n\n\n# 3. æ·æ±°ç­ç¥\n\nç¼å­çå®¹éæ¯æéçï¼é£ä¹å½ç¼å­æ»¡äºï¼å¯ä»¥æ¯ç¨æ·æ±°ç­ç¥æ¥å°é¨åæ°æ®æ·æ±°ã\n\nç¼å­è®¾ç½®æå¤å¤§æ¯è¾åéï¼ æç§äºå«åçï¼ä¸è¬ 20%æ°æ®ä¼å ç¨ 80%çè®¿é®ï¼æä»¥å»ºè®®å°ç¼å­çå®¹éè®¾ç½®ä¸ºæ»æ°æ®éç 15%æè 30%ä¼æ¯è¾åçã\n\næ·æ±°ç­ç¥æåªäº?\n\n * ä¸æ·æ±°\n   * noevictionï¼å¦æç¼å­å·²æ»¡åæåè¯·æ±ï¼åè¿åéè¯¯\n * å¯¹è®¾ç½®è¿ææ¶é´çæ°æ®è¿è¡æ·æ±°\n   * volatile-ttl å¨ç­éæ¶ï¼ä¼éå¯¹è®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ï¼æ ¹æ®è¿ææ¶é´çååè¿è¡å é¤ï¼è¶æ©è¿æçè¶åè¢«å é¤ã\n   * volatile-random å°±åå®çåç§°ä¸æ ·ï¼å¨è®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ä¸­ï¼è¿è¡éæºå é¤ã\n   * volatile-lru ä¼ä½¿ç¨ lru ç®æ³ç­éè®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ã\n   * volatile-lfu ä¼ä½¿ç¨ lfu ç®æ³éæ©è®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ã\n * å¯¹æææ°æ®è¿è¡æ·æ±°\n   * allkeys-random ç­ç¥ï¼ä»ææé®å¼å¯¹ä¸­éæºéæ©å¹¶å é¤æ°æ®ï¼\n   * allkeys-lru ç­ç¥ï¼ä½¿ç¨ lru ç®æ³å¨æææ°æ®ä¸­è¿è¡ç­éã\n   * allkeys-lfu ç­ç¥ï¼ä½¿ç¨ lfu ç®æ³å¨æææ°æ®ä¸­è¿è¡ç­éã\n\n\n# 4. ç¼å­éªå´©\n\nç¼å­éªå´©æ¯æå¤§éçåºç¨è¯·æ±æ æ³å¨ redis ç¼å­ä¸­è¿è¡å¤çï¼ç´§æ¥çï¼åºç¨å°å¤§éè¯·æ±åéå°æ°æ®åºå±ï¼å¯¼è´æ°æ®åºå±çååæ¿å¢ã\n\näº§ççåå \n\n * ç¼å­ä¸­æå¤§éæ°æ®åæ¶è¿æï¼å¯¼è´å¤§éè¯·æ±æ æ³å¾å°å¤ç\n * redisæå¡å®æº\n\nåçåææè§£å³åæ³\n\n 1. æ¯å¨ä¸å¡ç³»ç»ä¸­å®ç°æå¡çæ­æè¯·æ±éæµæºå¶ã\n\n\n\n 2. æå¡éçº§ãéæ ¸å¿æ°æ®ï¼ç´æ¥è¿åé¢å®ä¹ä¿¡æ¯ï¼éè¯¯æç©ºå¼ãæ ¸å¿ä¸å¡ä»ç¶æ¥è¯¢ç¼å­ãåå°æ°æ®åºåå\n\næåé¢é²\n\nä¸é¢çé½æ¯åçåææçè§£å³æªæ½ï¼æä»¥æå¥½çåæ³æ¯æåé¢é²ï¼è®©å®ä¸è¦åçã\n\n 1. é¿åå¤§éæ°æ®è®¾ç½®ç¸åç¹é¢è¿ææ¶é´ï¼å¦ææï¼å¯ä»¥å ä¸ªéæºæ°ã\n 2. æ­å»ºé«å¯ç¨éç¾¤ï¼ä¸»èç¹æéå®æºï¼ä»èç¹å¯ä»¥åæ¢æä¸»èç¹ï¼ç»§ç»­æä¾ç¼å­æå¡ã\n\n\n# 5. ç¼å­å»ç©¿\n\nç¼å­å»ç©¿æ¯æï¼éå¯¹æä¸ªè®¿é®éå¸¸é¢ç¹çç­ç¹æ°æ®çè¯·æ±ï¼æ æ³å¨ç¼å­ä¸­è¿è¡å¤çï¼ç´§æ¥çï¼è®¿é®è¯¥æ°æ®çå¤§éè¯·æ±ï¼ä¸ä¸å­é½åéå°äºåç«¯æ°æ®åºï¼å¯¼è´äºæ°æ®åºååæ¿å¢ï¼ä¼å½±åæ°æ®åºå¤çå¶ä»è¯·æ±ãç¼å­å»ç©¿çæåµï¼ç»å¸¸åçå¨ç­ç¹æ°æ®è¿æå¤±ææ¶\n\n\n\näº§ççåå \n\n * ç­ç¹æ°æ®åçè¿æè¢«æ·æ±°å¯¼è´è®¿é®åç«¯æ°æ®åº\n\nåçåææçè§£å³åæ³\n\n * æ¥å£éæµä¸çæ­ï¼éçº§ã\n\næåé¢é²\n\n * è®¾ç½®ç­ç¹æ°æ®æ°¸è¿ä¸è¿æã\n\n\n# 6. ç¼å­ç©¿é\n\nç¼å­ç©¿éæ¯æè¦è®¿é®çæ°æ®æ¢ä¸å¨ redis ç¼å­ä¸­ï¼ä¹ä¸å¨æ°æ®åºä¸­ï¼å¯¼è´è¯·æ±å¨è®¿é®ç¼å­æ¶ï¼åçç¼å­ç¼ºå¤±ï¼åå»è®¿é®æ°æ®åºæ¶ï¼åç°æ°æ®åºä¸­ä¹æ²¡æè¦è®¿é®çæ°æ®ã\n\näº§ççåå \n\n * ä¸å¡å±è¯¯æä½ï¼ç¼å­ä¸­çæ°æ®åæ°æ®åºä¸­çæ°æ®è¢«è¯¯å é¤äºï¼æä»¥ç¼å­åæ°æ®åºä¸­é½æ²¡ææ°æ®ï¼\n * æ¶ææ»å»ï¼ä¸é¨è®¿é®æ°æ®åºä¸­æ²¡æçæ°æ®ã\n\n\n\nåºå¯¹æ¹æ¡\n\n * å¨è¯·æ±å¥å£ååæ³æ§æ ¡éªï¼ææ¶æè¯·æ±è¿æ»¤æã\n * å¸éè¿æ»¤å¨ï¼å¿«éæ ¡éªæ°æ®æ¯å¦å­å¨ï¼é¿åä»æ°æ®åºä¸­æ¥è¯¢æ°æ®æ¯å¦å­å¨ï¼åè½»æ°æ®åºååã\n * ä¸æ¦åçæ°æ®ä¸å­å¨çæåµï¼å¯ä»¥ç¼å­ä¸ä¸ªç¼ºçå¼ï¼ä¸æ¬¡è¿ä½¿ç¨è¯¥ id è®¿é®æ¶ï¼å¯ä»¥è¿åç¼ºçå¼ã\n\n\n# 7. åèæç« \n\n * æ¬æä¸»è¦æ¯å­¦ä¹ ãæå®¢æ¶é´-redis æ ¸å¿ææ¯ä¸å®æãä¸æ æ»ç»èæ¥",charsets:{cjk:!0},lastUpdated:"2023/11/01, 11:48:43",lastUpdatedTimestamp:1698810523e3},{title:"pythonè¿­ä»£å¨ä¸çæå¨",frontmatter:{title:"pythonè¿­ä»£å¨ä¸çæå¨",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/e31b06/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä»ç»äºpythonçè¿­ä»£å¨ä¸çæå¨çç¨æ³ä¸åç",feed:{enable:!0},tags:["python"],categories:["ç¼ç¨","python","åºç¡"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604801659428.png#crop=0&crop=0&crop=1&crop=1&id=Wm3Ir&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="},{name:"twitter:title",content:"pythonè¿­ä»£å¨ä¸çæå¨"},{name:"twitter:description",content:"æ¬æä»ç»äºpythonçè¿­ä»£å¨ä¸çæå¨çç¨æ³ä¸åç"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604801659428.png#crop=0&crop=0&crop=1&crop=1&id=Wm3Ir&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/01.python%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8.html"},{property:"og:type",content:"article"},{property:"og:title",content:"pythonè¿­ä»£å¨ä¸çæå¨"},{property:"og:description",content:"æ¬æä»ç»äºpythonçè¿­ä»£å¨ä¸çæå¨çç¨æ³ä¸åç"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604801659428.png#crop=0&crop=0&crop=1&crop=1&id=Wm3Ir&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/01.python%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{itemprop:"name",content:"pythonè¿­ä»£å¨ä¸çæå¨"},{itemprop:"description",content:"æ¬æä»ç»äºpythonçè¿­ä»£å¨ä¸çæå¨çç¨æ³ä¸åç"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604801659428.png#crop=0&crop=0&crop=1&crop=1&id=Wm3Ir&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/01.python%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8.html",relativePath:"04.ç¼ç¨/01.python/01.åºç¡/01.pythonè¿­ä»£å¨ä¸çæå¨.md",key:"v-cee6b5d2",path:"/pages/e31b06/",headers:[{level:2,title:"è¿­ä»£å¨åå¯è¿­ä»£å¯¹è±¡",slug:"è¿­ä»£å¨åå¯è¿­ä»£å¯¹è±¡",normalizedTitle:"è¿­ä»£å¨åå¯è¿­ä»£å¯¹è±¡",charIndex:2},{level:2,title:"å¦ä½å®ç°è¿­ä»£å¨ï¼",slug:"å¦ä½å®ç°è¿­ä»£å¨",normalizedTitle:"å¦ä½å®ç°è¿­ä»£å¨ï¼",charIndex:146},{level:2,title:"çæå¨åçæå¨å½æ°",slug:"çæå¨åçæå¨å½æ°",normalizedTitle:"çæå¨åçæå¨å½æ°",charIndex:661},{level:3,title:"çæå¨å½æ°åå»ºçæå¨",slug:"çæå¨å½æ°åå»ºçæå¨",normalizedTitle:"çæå¨å½æ°åå»ºçæå¨",charIndex:698},{level:3,title:"çæå¨è¡¨è¾¾å¼åå»ºçæå¨",slug:"çæå¨è¡¨è¾¾å¼åå»ºçæå¨",normalizedTitle:"çæå¨è¡¨è¾¾å¼åå»ºçæå¨",charIndex:1146}],headersStr:"è¿­ä»£å¨åå¯è¿­ä»£å¯¹è±¡ å¦ä½å®ç°è¿­ä»£å¨ï¼ çæå¨åçæå¨å½æ° çæå¨å½æ°åå»ºçæå¨ çæå¨è¡¨è¾¾å¼åå»ºçæå¨",content:'# è¿­ä»£å¨åå¯è¿­ä»£å¯¹è±¡\n\nå®ç°äº__iter__çå¯¹è±¡æ¯å¯è¿­ä»£å¯¹è±¡.\n\nå®ç°äº__iter__å__next__çæ¯è¿­ä»£å¨.\n\nä¸¤èä¹é´çå³ç³»: Pythonä»å¯è¿­ä»£çå¯¹è±¡ä¸­è·åè¿­ä»£å¨\n\nå¯è¿­ä»£å¯¹è±¡çæ½è±¡åºç±»æ¯abc.Iterable è¿­ä»£å¨çæ½è±¡åºç±»æ¯abc.Iterator\n\n\n\n\n# å¦ä½å®ç°è¿­ä»£å¨ï¼\n\nå®ä¹__iter__æ¹æ³è¿åå¸¦æ__next__æ¹æ³çå¯¹è±¡ï¼__iter__å¯ä»¥ç®åçè¿åself.\n\nå½æ²¡ææ°æ®è¿åæ¶ï¼ä¼æåºStopIterationå¼å¸¸åæ­¢è¿åæ°æ®ã\n\n\nclass MyIter():\n    def __init__(self, data):\n        self.data = data\n        self.index = len(data)\n\n    def __iter__(self):\n        return self\n\n    def __next__(self):\n        if self.index == 0:\n            raise StopIteration\n        \n        self.index = self.index - 1\n        return self.data[self.index]\n\nmy_iter = MyIter()\niter(my_iter)   # è¿åä¸ä¸ªè¿­ä»£å¨\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n\n# çæå¨åçæå¨å½æ°\n\nå½æ°ä¸­æyieldå³é®å­çï¼å°±æ¯çæå¨å½æ°\n\n\n# çæå¨å½æ°åå»ºçæå¨\n\nä¸é¢ç__iter__æ¯ä¸ä¸ªçæå¨å½æ°ï¼éè¿è¯¥çæå¨å½æ°åå»ºçæå¨å¯¹è±¡ï¼åè£çæå¨å½æ°çå®ä¹ãæçæå¨ä¼ ç»next(...)å½æ°æ¶ï¼çæå¨å½æ°ä¼ååï¼æ§è¡å½æ°å®ä¹ä½ä¸­çä¸ä¸ä¸ªyieldè¯­å¥ï¼è¿åäº§åºçå¼ï¼å¹¶å¨å½æ°å®ä¹ä½çå½åä½ç½®æåãå½æ æ°æ®è¿åæ¶ï¼çæå¨å¯¹è±¡ä¼æåºStopIterationå¼å¸¸ã\n\n\n\nä¾å­:\n\n\nimport re\nimport reprlib\n\nRE_WORD = re.compile("\\w+")\n\nclass Sentence:\n    def __init__(self, text):\n        self.text = text\n        \n    def __iter__(self):\n        for match in RE_WORD.finditer(self.text):\n            yield matc.group()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# çæå¨è¡¨è¾¾å¼åå»ºçæå¨\n\nçæå¨è¡¨è¾¾å¼å¯ä»¥çè§£ä¸ºåè¡¨æ¨å¯¼çæ°æ§çæ¬: ä¸ä¼è¿«åå°æå»ºåè¡¨ï¼èæ¯è¿åä¸ä¸ªçæå¨ï¼æéæ°æ§çæåç´ ã\n\nåè¡¨è¡¨è¾¾å¼ã ä¼é©¬ä¸å è½½ææçåç´ å°åå­ä¸­\n\n[i for i in range(10)]\n\n\n1\n\n\nçæå¨è¡¨è¾¾å¼: ä¼å¾å°ä¸ä¸ªçæå¨å¯¹è±¡ï¼å¯ä»¥éè¿nextæèå¾ªç¯çæ¹å¼æ°æ§æ±å¼ã\n\n(i for i in range(10))\n\n\n1\n\n\nè½ç¶ä¸é¢ç__iter__æ²¡æyieldå³é®å­ï¼ä½æ¯å´æå·æçæå¨è¡¨è¾¾å¼ï¼æä»¥__iter__å¾å°çä¹æ¯ä¸ä¸ªçæå¨å¯¹è±¡ã\n\nä¾å­:\n\nclass A:\n    def __iter__(self):\n        return (x*3 for x in range(10))\n\n\n1\n2\n3\n',normalizedContent:'# è¿­ä»£å¨åå¯è¿­ä»£å¯¹è±¡\n\nå®ç°äº__iter__çå¯¹è±¡æ¯å¯è¿­ä»£å¯¹è±¡.\n\nå®ç°äº__iter__å__next__çæ¯è¿­ä»£å¨.\n\nä¸¤èä¹é´çå³ç³»: pythonä»å¯è¿­ä»£çå¯¹è±¡ä¸­è·åè¿­ä»£å¨\n\nå¯è¿­ä»£å¯¹è±¡çæ½è±¡åºç±»æ¯abc.iterable è¿­ä»£å¨çæ½è±¡åºç±»æ¯abc.iterator\n\n\n\n\n# å¦ä½å®ç°è¿­ä»£å¨ï¼\n\nå®ä¹__iter__æ¹æ³è¿åå¸¦æ__next__æ¹æ³çå¯¹è±¡ï¼__iter__å¯ä»¥ç®åçè¿åself.\n\nå½æ²¡ææ°æ®è¿åæ¶ï¼ä¼æåºstopiterationå¼å¸¸åæ­¢è¿åæ°æ®ã\n\n\nclass myiter():\n    def __init__(self, data):\n        self.data = data\n        self.index = len(data)\n\n    def __iter__(self):\n        return self\n\n    def __next__(self):\n        if self.index == 0:\n            raise stopiteration\n        \n        self.index = self.index - 1\n        return self.data[self.index]\n\nmy_iter = myiter()\niter(my_iter)   # è¿åä¸ä¸ªè¿­ä»£å¨\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n\n# çæå¨åçæå¨å½æ°\n\nå½æ°ä¸­æyieldå³é®å­çï¼å°±æ¯çæå¨å½æ°\n\n\n# çæå¨å½æ°åå»ºçæå¨\n\nä¸é¢ç__iter__æ¯ä¸ä¸ªçæå¨å½æ°ï¼éè¿è¯¥çæå¨å½æ°åå»ºçæå¨å¯¹è±¡ï¼åè£çæå¨å½æ°çå®ä¹ãæçæå¨ä¼ ç»next(...)å½æ°æ¶ï¼çæå¨å½æ°ä¼ååï¼æ§è¡å½æ°å®ä¹ä½ä¸­çä¸ä¸ä¸ªyieldè¯­å¥ï¼è¿åäº§åºçå¼ï¼å¹¶å¨å½æ°å®ä¹ä½çå½åä½ç½®æåãå½æ æ°æ®è¿åæ¶ï¼çæå¨å¯¹è±¡ä¼æåºstopiterationå¼å¸¸ã\n\n\n\nä¾å­:\n\n\nimport re\nimport reprlib\n\nre_word = re.compile("\\w+")\n\nclass sentence:\n    def __init__(self, text):\n        self.text = text\n        \n    def __iter__(self):\n        for match in re_word.finditer(self.text):\n            yield matc.group()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# çæå¨è¡¨è¾¾å¼åå»ºçæå¨\n\nçæå¨è¡¨è¾¾å¼å¯ä»¥çè§£ä¸ºåè¡¨æ¨å¯¼çæ°æ§çæ¬: ä¸ä¼è¿«åå°æå»ºåè¡¨ï¼èæ¯è¿åä¸ä¸ªçæå¨ï¼æéæ°æ§çæåç´ ã\n\nåè¡¨è¡¨è¾¾å¼ã ä¼é©¬ä¸å è½½ææçåç´ å°åå­ä¸­\n\n[i for i in range(10)]\n\n\n1\n\n\nçæå¨è¡¨è¾¾å¼: ä¼å¾å°ä¸ä¸ªçæå¨å¯¹è±¡ï¼å¯ä»¥éè¿nextæèå¾ªç¯çæ¹å¼æ°æ§æ±å¼ã\n\n(i for i in range(10))\n\n\n1\n\n\nè½ç¶ä¸é¢ç__iter__æ²¡æyieldå³é®å­ï¼ä½æ¯å´æå·æçæå¨è¡¨è¾¾å¼ï¼æä»¥__iter__å¾å°çä¹æ¯ä¸ä¸ªçæå¨å¯¹è±¡ã\n\nä¾å­:\n\nclass a:\n    def __iter__(self):\n        return (x*3 for x in range(10))\n\n\n1\n2\n3\n',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"pythonåå¾åæ¶æºå¶",frontmatter:{title:"pythonåå¾åæ¶æºå¶",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/78c648/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"pythonçåå¾åæ¶æºå¶çå ç§æ¹å¼ï¼å¼ç¨è®¡æ°ãæ è®°æ¸æ¥ååä»£åæ¶ï¼ä»ç»ä»ä»¬çåçã",feed:{enable:!0},tags:["python"],categories:["ç¼ç¨","python","åºç¡"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220907215650.png"},{name:"twitter:title",content:"pythonåå¾åæ¶æºå¶"},{name:"twitter:description",content:"pythonçåå¾åæ¶æºå¶çå ç§æ¹å¼ï¼å¼ç¨è®¡æ°ãæ è®°æ¸æ¥ååä»£åæ¶ï¼ä»ç»ä»ä»¬çåçã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220907215650.png"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/03.python%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html"},{property:"og:type",content:"article"},{property:"og:title",content:"pythonåå¾åæ¶æºå¶"},{property:"og:description",content:"pythonçåå¾åæ¶æºå¶çå ç§æ¹å¼ï¼å¼ç¨è®¡æ°ãæ è®°æ¸æ¥ååä»£åæ¶ï¼ä»ç»ä»ä»¬çåçã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220907215650.png"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/03.python%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{itemprop:"name",content:"pythonåå¾åæ¶æºå¶"},{itemprop:"description",content:"pythonçåå¾åæ¶æºå¶çå ç§æ¹å¼ï¼å¼ç¨è®¡æ°ãæ è®°æ¸æ¥ååä»£åæ¶ï¼ä»ç»ä»ä»¬çåçã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220907215650.png"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/03.python%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html",relativePath:"04.ç¼ç¨/01.python/01.åºç¡/03.pythonåå¾åæ¶æºå¶.md",key:"v-5be0bc4c",path:"/pages/78c648/",headers:[{level:2,title:"å¼ç¨è®¡æ°",slug:"å¼ç¨è®¡æ°",normalizedTitle:"å¼ç¨è®¡æ°",charIndex:2},{level:2,title:"æ è®°-æ¸é¤",slug:"æ è®°-æ¸é¤",normalizedTitle:"æ è®°-æ¸é¤",charIndex:68},{level:2,title:"åä»£åæ¶",slug:"åä»£åæ¶",normalizedTitle:"åä»£åæ¶",charIndex:428},{level:2,title:"åå¾åæ¶è§¦åæåµ",slug:"åå¾åæ¶è§¦åæåµ",normalizedTitle:"åå¾åæ¶è§¦åæåµ",charIndex:684}],headersStr:"å¼ç¨è®¡æ° æ è®°-æ¸é¤ åä»£åæ¶ åå¾åæ¶è§¦åæåµ",content:"# å¼ç¨è®¡æ°\n\næ¯æ¬¡å¯¹è±¡è¢«å¼ç¨æ¶ï¼ä¼è¢«è®¡æ°å 1ï¼å½è®¡æ°ä¸º0æ¶ï¼ååæ¶è¯¥å¯¹è±¡ã\n\næ³¨æï¼ å¾ªç¯å¼ç¨çæåµï¼å¼ç¨è®¡æ°ä¸è½è§£å³.\n\n\n\n\n# æ è®°-æ¸é¤\n\nå¯¹æææ´»è·çå¯¹è±¡è¿è¡æ è®°ï¼å¯¹éæ´»è·å¯¹è±¡è¿è¡åæ¶ãå¯ä»¥ææçè§£å³å¾ªç¯å¼ç¨çé®é¢\n\nåç å¯¹è±¡ä¹é´éè¿å¼ç¨æå»ºæåå¾ï¼ä»root object(å¨å±åéï¼å¯å­å¨ç­ä¸å¯å é¤çå¯¹è±¡)åºåï¼æ²¿çæåè¾¹éåå¯¹è±¡ï¼å¯è¾¾çå¯¹è±¡æ è®°ä¸ºæ´»è·å¯¹è±¡ï¼ä¸å¯è¾¾çå¯¹è±¡å°±æ¯è¦è¢«æ¸é¤çéæ´»å¨å¯¹è±¡ã\n\nå¨ä¸å¾ä¸­ï¼ä»é»ç¹å¼å§åºåï¼1å¯¹è±¡å¯è¾¾ï¼2ã3é´æ¥å¯è¾¾ï¼1ã2ã3æ¯æ´»è·å¯¹è±¡ï¼4,5ä¸å¯è¾¾ï¼æä»¥æ¯éæ´»è·å¯¹è±¡ï¼è¿è¡åæ¶ã\n\nè¿ç¨ æ¾å°root objectéå, å¨åå­å»ºç«ä¸¤æ¡è¿è¡¨ï¼ä¸æ¡é¾è¡¨ç»´æ¤root objectéåï¼å¦ä¸æ¡é¾è¡¨å¦ç»´æ¤å©ä¸çå¯¹è±¡ï¼å¨æ è®°çè¿ç¨ä¸­ï¼å¦æå¨ä¸å¯è¾¾é¾è¡¨ä¸­å­å¨è¢«rooté¾è¡¨ä¸­çç¬äº«ï¼ç´æ¥æé´æ¥å¼ç¨ç¬äº«ï¼å°±å°å¶ä»ä¸å¯è¾¾é¾è¡¨ç§»å°rooté¾è¡¨ä¸­ãå½å®ææ è®°åï¼ä¸å¯è¾¾é¾è¡¨å©ä¸çå¯¹è±¡é½æ¯åå¾å¯¹è±¡ï¼è¿è¡åæ¶ã\n\n\n# åä»£åæ¶\n\nå¯¹è±¡åå¨ä¸åéåä¸­ï¼æ¯ä¸ªéåç§°ä¸ºä¸ä¸ªä»£, Pythonä¸­åä¸º3ä»£ï¼å¹´è½»ä»£(ç¬¬0ä»£)ãä¸­å¹´ä»£(ç¬¬1ä»£)ãèå¹´ä»£(ç¬¬äºä»£)ï¼å¯¹åº3åé¾è¡¨ï¼æ¯ä¸ä»£GCé¢çä¸åï¼ç¬¬0ä»£æé«ï¼ç¬¬1ä»£æ¬¡ä¹ï¼ç¬¬äºä»£æä½(è¶å¹´è½»çå¯¹è±¡è¶å®¹ææ­»æï¼èèçå¯¹è±¡éå¸¸ä¼å­éæ´ä¹)ï¼æ°ççå¯¹è±¡æ¾å¥ç¬¬0ä»£ï¼å¦æè¯¥å¯¹è±¡å¨ç¬¬0ä»£çä¸æ¬¡GCä¸­å­æ´»ï¼åç§»å¨å°ç¬¬1ä»£ï¼å¦æç¬¬ä¸ä»£å¯¹è±¡å¨ç¬¬1ä»£GCä¸­å­éï¼åç§»å¨å°ç¬¬2ä»£ã\n\nä»ä¹æåµè§¦åGCï¼ å¯ä»¥è®¾ç½®éå¼ï¼ä¹å¯ä»¥æå¨è°ç¨gc.collect()\n\næ¯æ¬¡æ«æå¨é¨å¯¹è±¡ï¼è´¹æ¶è´¹åï¼æé«GCçæçã\n\n\n# åå¾åæ¶è§¦åæåµ\n\nè°ç¨gc.collect(),éè¦åå¯¼å¥gcæ¨¡åã\n\nå½gcæ¨¡åçè®¡æ°å¨è¾¾å°éå¼çæ¶åãéå¼å¯ä»¥è®¾ç½®",normalizedContent:"# å¼ç¨è®¡æ°\n\næ¯æ¬¡å¯¹è±¡è¢«å¼ç¨æ¶ï¼ä¼è¢«è®¡æ°å 1ï¼å½è®¡æ°ä¸º0æ¶ï¼ååæ¶è¯¥å¯¹è±¡ã\n\næ³¨æï¼ å¾ªç¯å¼ç¨çæåµï¼å¼ç¨è®¡æ°ä¸è½è§£å³.\n\n\n\n\n# æ è®°-æ¸é¤\n\nå¯¹æææ´»è·çå¯¹è±¡è¿è¡æ è®°ï¼å¯¹éæ´»è·å¯¹è±¡è¿è¡åæ¶ãå¯ä»¥ææçè§£å³å¾ªç¯å¼ç¨çé®é¢\n\nåç å¯¹è±¡ä¹é´éè¿å¼ç¨æå»ºæåå¾ï¼ä»root object(å¨å±åéï¼å¯å­å¨ç­ä¸å¯å é¤çå¯¹è±¡)åºåï¼æ²¿çæåè¾¹éåå¯¹è±¡ï¼å¯è¾¾çå¯¹è±¡æ è®°ä¸ºæ´»è·å¯¹è±¡ï¼ä¸å¯è¾¾çå¯¹è±¡å°±æ¯è¦è¢«æ¸é¤çéæ´»å¨å¯¹è±¡ã\n\nå¨ä¸å¾ä¸­ï¼ä»é»ç¹å¼å§åºåï¼1å¯¹è±¡å¯è¾¾ï¼2ã3é´æ¥å¯è¾¾ï¼1ã2ã3æ¯æ´»è·å¯¹è±¡ï¼4,5ä¸å¯è¾¾ï¼æä»¥æ¯éæ´»è·å¯¹è±¡ï¼è¿è¡åæ¶ã\n\nè¿ç¨ æ¾å°root objectéå, å¨åå­å»ºç«ä¸¤æ¡è¿è¡¨ï¼ä¸æ¡é¾è¡¨ç»´æ¤root objectéåï¼å¦ä¸æ¡é¾è¡¨å¦ç»´æ¤å©ä¸çå¯¹è±¡ï¼å¨æ è®°çè¿ç¨ä¸­ï¼å¦æå¨ä¸å¯è¾¾é¾è¡¨ä¸­å­å¨è¢«rooté¾è¡¨ä¸­çç¬äº«ï¼ç´æ¥æé´æ¥å¼ç¨ç¬äº«ï¼å°±å°å¶ä»ä¸å¯è¾¾é¾è¡¨ç§»å°rooté¾è¡¨ä¸­ãå½å®ææ è®°åï¼ä¸å¯è¾¾é¾è¡¨å©ä¸çå¯¹è±¡é½æ¯åå¾å¯¹è±¡ï¼è¿è¡åæ¶ã\n\n\n# åä»£åæ¶\n\nå¯¹è±¡åå¨ä¸åéåä¸­ï¼æ¯ä¸ªéåç§°ä¸ºä¸ä¸ªä»£, pythonä¸­åä¸º3ä»£ï¼å¹´è½»ä»£(ç¬¬0ä»£)ãä¸­å¹´ä»£(ç¬¬1ä»£)ãèå¹´ä»£(ç¬¬äºä»£)ï¼å¯¹åº3åé¾è¡¨ï¼æ¯ä¸ä»£gcé¢çä¸åï¼ç¬¬0ä»£æé«ï¼ç¬¬1ä»£æ¬¡ä¹ï¼ç¬¬äºä»£æä½(è¶å¹´è½»çå¯¹è±¡è¶å®¹ææ­»æï¼èèçå¯¹è±¡éå¸¸ä¼å­éæ´ä¹)ï¼æ°ççå¯¹è±¡æ¾å¥ç¬¬0ä»£ï¼å¦æè¯¥å¯¹è±¡å¨ç¬¬0ä»£çä¸æ¬¡gcä¸­å­æ´»ï¼åç§»å¨å°ç¬¬1ä»£ï¼å¦æç¬¬ä¸ä»£å¯¹è±¡å¨ç¬¬1ä»£gcä¸­å­éï¼åç§»å¨å°ç¬¬2ä»£ã\n\nä»ä¹æåµè§¦ågcï¼ å¯ä»¥è®¾ç½®éå¼ï¼ä¹å¯ä»¥æå¨è°ç¨gc.collect()\n\næ¯æ¬¡æ«æå¨é¨å¯¹è±¡ï¼è´¹æ¶è´¹åï¼æé«gcçæçã\n\n\n# åå¾åæ¶è§¦åæåµ\n\nè°ç¨gc.collect(),éè¦åå¯¼å¥gcæ¨¡åã\n\nå½gcæ¨¡åçè®¡æ°å¨è¾¾å°éå¼çæ¶åãéå¼å¯ä»¥è®¾ç½®",charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"pythonä¸ä¸æç®¡çå¨",frontmatter:{title:"pythonä¸ä¸æç®¡çå¨",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/a6b804/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"pythonçä¸ä¸æç®¡ççä½¿ç¨åå®ç°çå ç§æ¹å¼",feed:{enable:!0},tags:["python"],categories:["ç¼ç¨","python","åºç¡"],comment:!0,meta:[{name:"twitter:title",content:"pythonä¸ä¸æç®¡çå¨"},{name:"twitter:description",content:"pythonçä¸ä¸æç®¡ççä½¿ç¨åå®ç°çå ç§æ¹å¼"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/04.python%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8.html"},{property:"og:type",content:"article"},{property:"og:title",content:"pythonä¸ä¸æç®¡çå¨"},{property:"og:description",content:"pythonçä¸ä¸æç®¡ççä½¿ç¨åå®ç°çå ç§æ¹å¼"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/04.python%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{itemprop:"name",content:"pythonä¸ä¸æç®¡çå¨"},{itemprop:"description",content:"pythonçä¸ä¸æç®¡ççä½¿ç¨åå®ç°çå ç§æ¹å¼"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/04.python%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8.html",relativePath:"04.ç¼ç¨/01.python/01.åºç¡/04.pythonä¸ä¸æç®¡çå¨.md",key:"v-54ae2f6d",path:"/pages/a6b804/",headers:[{level:2,title:"ä»ä¹æ¯ä¸ä¸æç®¡çå¨",slug:"ä»ä¹æ¯ä¸ä¸æç®¡çå¨",normalizedTitle:"ä»ä¹æ¯ä¸ä¸æç®¡çå¨",charIndex:2},{level:2,title:"ç»å¸openæ¡ä¾",slug:"ç»å¸openæ¡ä¾",normalizedTitle:"ç»å¸openæ¡ä¾",charIndex:89},{level:2,title:"èªå®ä¹ä¸ä¸æç®¡çå¨",slug:"èªå®ä¹ä¸ä¸æç®¡çå¨",normalizedTitle:"èªå®ä¹ä¸ä¸æç®¡çå¨",charIndex:314},{level:3,title:"ç±»å®ç°",slug:"ç±»å®ç°",normalizedTitle:"ç±»å®ç°",charIndex:328},{level:3,title:"æ¹æ³å®ç°",slug:"æ¹æ³å®ç°",normalizedTitle:"æ¹æ³å®ç°",charIndex:631}],headersStr:"ä»ä¹æ¯ä¸ä¸æç®¡çå¨ ç»å¸openæ¡ä¾ èªå®ä¹ä¸ä¸æç®¡çå¨ ç±»å®ç° æ¹æ³å®ç°",content:'# ä»ä¹æ¯ä¸ä¸æç®¡çå¨\n\npythonä¸­ä½¿ç¨withæ¥ä½¿ç¨ä¸ä¸æç®¡çå¨.\n\nå¨ä½¿ç¨æä¸ªèµæºæ¶ï¼å¯ä»¥å¯¹è¯¥èµæºè¿è¡åå§ååèµæºçæ¸çä¸¤ä¸ªæä½ï¼å¨è¿ä¸¤ä¸ªæä½ä¹é´è¾¹æä¸ºä¸ä¸æã\n\n\n# ç»å¸openæ¡ä¾\n\nå¯¹æä»¶æä½æ¶ï¼éè¦æå¼æä»¶åå³é­æä»¶ãç¶åå¨è¿ä¹é´è¿è¡æä»¶çæä½ã\n\nf = open("a.txt")\nf.write("hello world")\nf.close()\n\n\n1\n2\n3\n\n\nä½¿ç¨ä¸ä¸æç®¡çå¨ æå¼æä»¶åï¼å¾å°æä»¶æè¿°ç¬¦ï¼å¨withä»£ç åä¸­å¯¹fè¿è¡æä½ï¼ç»ææ¶ï¼ä¼èªå¨çè¿è¡å³é­æä½.\n\nwith open("a.txt") as f:\n    f.write("hello world")\n\n\n1\n2\n\n\n\n# èªå®ä¹ä¸ä¸æç®¡çå¨\n\n\n# ç±»å®ç°\n\nè¿å¥ä¸ä¸ææ¶ï¼è°ç¨__enter__æ¹æ³è¿è¡åå§åï¼éåºæ¶ï¼è°ç¨__exit__éåºã\n\n\nclass A:\ndef __enter__(self):\n    print("è¿å¥")\n\ndef __exit__(self, exc_type, exc_val, exc_tb):\n    print("éæ¾èµæº")\n\nwith A() as f:\n    print("hello")\n    print("world")\n   \noutput: \nè¿å¥\nhello\nworld\néæ¾èµæº\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# æ¹æ³å®ç°\n\nä½¿ç¨contextlib.contextmanager å¯¹æ¹æ³å®ç°ä¸ä¸æç®¡çå¨. ä½¿ç¨çæå¨å®æã\n\n\nimport contextlib\n\n@contextlib.contextmanager\ndef test(a):\n    print("open..")\n    yield a\n    print("close")\n    \nwith test(2) as f:\n    print(f)\n\noutput:\nopen..\n2\nclose\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n',normalizedContent:'# ä»ä¹æ¯ä¸ä¸æç®¡çå¨\n\npythonä¸­ä½¿ç¨withæ¥ä½¿ç¨ä¸ä¸æç®¡çå¨.\n\nå¨ä½¿ç¨æä¸ªèµæºæ¶ï¼å¯ä»¥å¯¹è¯¥èµæºè¿è¡åå§ååèµæºçæ¸çä¸¤ä¸ªæä½ï¼å¨è¿ä¸¤ä¸ªæä½ä¹é´è¾¹æä¸ºä¸ä¸æã\n\n\n# ç»å¸openæ¡ä¾\n\nå¯¹æä»¶æä½æ¶ï¼éè¦æå¼æä»¶åå³é­æä»¶ãç¶åå¨è¿ä¹é´è¿è¡æä»¶çæä½ã\n\nf = open("a.txt")\nf.write("hello world")\nf.close()\n\n\n1\n2\n3\n\n\nä½¿ç¨ä¸ä¸æç®¡çå¨ æå¼æä»¶åï¼å¾å°æä»¶æè¿°ç¬¦ï¼å¨withä»£ç åä¸­å¯¹fè¿è¡æä½ï¼ç»ææ¶ï¼ä¼èªå¨çè¿è¡å³é­æä½.\n\nwith open("a.txt") as f:\n    f.write("hello world")\n\n\n1\n2\n\n\n\n# èªå®ä¹ä¸ä¸æç®¡çå¨\n\n\n# ç±»å®ç°\n\nè¿å¥ä¸ä¸ææ¶ï¼è°ç¨__enter__æ¹æ³è¿è¡åå§åï¼éåºæ¶ï¼è°ç¨__exit__éåºã\n\n\nclass a:\ndef __enter__(self):\n    print("è¿å¥")\n\ndef __exit__(self, exc_type, exc_val, exc_tb):\n    print("éæ¾èµæº")\n\nwith a() as f:\n    print("hello")\n    print("world")\n   \noutput: \nè¿å¥\nhello\nworld\néæ¾èµæº\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# æ¹æ³å®ç°\n\nä½¿ç¨contextlib.contextmanager å¯¹æ¹æ³å®ç°ä¸ä¸æç®¡çå¨. ä½¿ç¨çæå¨å®æã\n\n\nimport contextlib\n\n@contextlib.contextmanager\ndef test(a):\n    print("open..")\n    yield a\n    print("close")\n    \nwith test(2) as f:\n    print(f)\n\noutput:\nopen..\n2\nclose\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"pythonåç¼ç¨",frontmatter:{title:"pythonåç¼ç¨",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/5fa368/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä»ç»pythonä¸­åç¼ç¨çå±æ§åä½¿ç¨æ¹æ³",feed:{enable:!0},tags:["python"],categories:["ç¼ç¨","python","åºç¡"],comment:!0,meta:[{name:"twitter:title",content:"pythonåç¼ç¨"},{name:"twitter:description",content:"æ¬æä»ç»pythonä¸­åç¼ç¨çå±æ§åä½¿ç¨æ¹æ³"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/02.python%E5%85%83%E7%BC%96%E7%A8%8B.html"},{property:"og:type",content:"article"},{property:"og:title",content:"pythonåç¼ç¨"},{property:"og:description",content:"æ¬æä»ç»pythonä¸­åç¼ç¨çå±æ§åä½¿ç¨æ¹æ³"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/02.python%E5%85%83%E7%BC%96%E7%A8%8B.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{itemprop:"name",content:"pythonåç¼ç¨"},{itemprop:"description",content:"æ¬æä»ç»pythonä¸­åç¼ç¨çå±æ§åä½¿ç¨æ¹æ³"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/02.python%E5%85%83%E7%BC%96%E7%A8%8B.html",relativePath:"04.ç¼ç¨/01.python/01.åºç¡/02.pythonåç¼ç¨.md",key:"v-6b5349e8",path:"/pages/5fa368/",headers:[{level:2,title:"propertyå¨æå±æ§",slug:"propertyå¨æå±æ§",normalizedTitle:"propertyå¨æå±æ§",charIndex:2},{level:2,title:"_getattribute å getattr_",slug:"getattribute-å-getattr",normalizedTitle:"<em>getattribute å getattr</em>",charIndex:null},{level:2,title:"å±æ§æè¿°ç¬¦",slug:"å±æ§æè¿°ç¬¦",normalizedTitle:"å±æ§æè¿°ç¬¦",charIndex:744},{level:3,title:"å±æ§æè¿°ç¬¦æ¥æ¾è¿ç¨",slug:"å±æ§æè¿°ç¬¦æ¥æ¾è¿ç¨",normalizedTitle:"å±æ§æè¿°ç¬¦æ¥æ¾è¿ç¨",charIndex:1032},{level:2,title:"åç±»",slug:"åç±»",normalizedTitle:"åç±»",charIndex:2152},{level:3,title:"éè¿typeåå»ºclass",slug:"éè¿typeåå»ºclass",normalizedTitle:"éè¿typeåå»ºclass",charIndex:2211},{level:3,title:"èªå®ä¹åç±»",slug:"èªå®ä¹åç±»",normalizedTitle:"èªå®ä¹åç±»",charIndex:2588}],headersStr:"propertyå¨æå±æ§ _getattribute å getattr_ å±æ§æè¿°ç¬¦ å±æ§æè¿°ç¬¦æ¥æ¾è¿ç¨ åç±» éè¿typeåå»ºclass èªå®ä¹åç±»",content:'# propertyå¨æå±æ§\n\néè¿ä½¿ç¨propertyå¯ä»¥å°æ¹æ³åå±æ§ä¸æ ·è·åå¼ãä½¿ç¨setterå¯¹æ¹æ³è¿è¡èµå¼æä½\n\n\nfrom datetime import datetime, date\nclass Student:\n\n    def __init__(self, name, birthday):\n        self.name = name\n        self.birthday = birthday\n        self._age = 0\n    \n    @property\n    def age(self):\n        return datetime.now().year - self.birthday.year\n    \n    @age.setter\n    def age(self, value):\n        self._age = value\n    \nstu = Student("zhangsan", date(year=1995, month=3, day=7))\nstu.age = 4\nprint(stu.age)\n\noutput: 24\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# getattribute å getattr\n\n__getattr__å¨ç±»ä¸­æ¾ä¸å°å±æ§æ¶ï¼è°ç¨è¯¥å½æ°ã __getattribute__é¦åè°ç¨è¯¥å½æ°ï¼ç¶åæ¾å±æ§.\n\nå¨__getattribute__ä¸­æåºAttributeErroræ¶ï¼ä¼è°ç¨__getattr__\n\nè°ç¨é¡ºåº __getattribute__ > __getattr__\n\n\n# å±æ§æè¿°ç¬¦\n\nå¨ç±»ä¸­åªè¦å®ç°äº__get__ã__set__ã__delete__æ¹æ³ä¸­çä¸ä¸ªå°±è®¤ä¸ºæ¯æè¿°ç¬¦. åªå®ç°äº__get__çå¯¹è±¡æ¯éæ°æ®æè¿°ç¬¦. åªè¯» å®ç°äº__get__å__set__çå¯¹è±¡æ¯æ°æ®æè¿°ç¬¦. å¯è¯»å¯å.\n\nclass IntField:\n    def __get__(self):\n        pass\n        \n    def __set__(self):\n        pass\n        \n    def __delete__(self):\n        pass\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# å±æ§æè¿°ç¬¦æ¥æ¾è¿ç¨\n\nå±æ§æè¿°ç¬¦åççè¿ç¨å¨__getattribute__ä¸­.\n\nå¦æageæ¯å±æ§æè¿°ç¬¦ï¼åè°ç¨IntFieldä¸­ç__get__è·å¾å±æ§å¼ï¼å¦æè·åå¤±è´¥ï¼åè°ç¨__dict__è·åå¼ãå¦æageä¸æ¯å±æ§æè¿°ç¬¦ï¼åç´æ¥è·å__dict__å¯¹åºçå¼ã\n\n\nimport numbers\nclass IntField:\n    # æ°æ®æè¿°ç¬¦\n    def __get__(self, instance, owner):\n        return self.value\n        \n    def __set__(self, instance, value):\n        if not isinstance(value, numbers.Integral):\n            raise ValueError("int value need")\n        if value < 0:\n            raise ValueError("positive value need")\n        self.value = value\n        \n    def __delete__(self, instance):\n        pass\n    \nclass NonDataIntField:\n    # éæ°æ®å±æ§æè¿°ç¬¦\n    def __get__(self, instance, owner):\n        return "NonDataIntField = {}".format(self.value)\n\nclass User:\n    age = IntField()\n    #age = NonDataIntField()\n\nuser = User()\nuser.name = "zhangsan"    # nameä¸æ¯å±æ§æè¿°ç¬¦ï¼æä»¥ç´æ¥å å¥å°`__dict__`ä¸­\nprint(user.__dict__)\n\nuser.age = 12               # ageæ¯å±æ§æè¿°ç¬¦, è°ç¨`IntField`ä¸­ç`__set__`æ¹æ³ï¼ èä¸ä¼å å¥å°`__dict__`ä¸­\nprint(user.__dict__)\nprint(user.age)              # è°ç¨`IntField`ä¸­ç`__get__`æ¹æ³\n\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n\n# åç±»\n\nåç±»æ¯åå»ºç±»çç±». type -> class -> å¯¹è±¡\n\nææçç±»é½æ¯éè¿typeå®ä¾åå¾å°çã\n\n\n# éè¿typeåå»ºclass\n\nä½¿ç¨typeåå»ºUserç±»ï¼è¯¥ç±»ç»§æ¿Baseç±»ï¼å¹¶ä¸ætestæ¹æ³ånameå±æ§\n\n\nclass Base:\n    def __init__(self, *args, **kwargs):\n        print("Base __init__")\n        super().__init__(*args, **kwargs)\n\ndef test(self):\n    print("test = {}".format(self.name))\n \nUser = type("User", (Base,), {"test": test, "name": "zhangsan"})\nuser = User()\nuser.test()\n\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# èªå®ä¹åç±»\n\nèªå®ä¹åç±»éè¦éè¿ç»§æ¿typeå®ç°\n\nå¦æç¶ç±»æmetaclassï¼åå­ç±»åç¶ç±»çåå»ºé½éè¦éè¿è¯¥åç±»å®ä¾åå¾å°ã\n\n\n\nclass BaseMeta(type):\n\n    def __new__(cls, name, bases, args, **kwargs):\n        # print(name)\n        # print(bases)\n        # print(args)\n        print("BaseMeta __new__..")\n        \n        if name == "Base":\n            return super().__new__(cls, name, bases, args, **kwargs)\n            \n        meta = args[\'Meta\']\n        name = getattr(meta, "name")    # è·åå°Aä¸­metaçnameçå¼. djangoçormä¹æ¯è¿æ ·å®ç°ç\n        print(name)\n        \n        return super().__new__(cls, name, bases, args, **kwargs)\n\n\n\nclass Base(metaclass=BaseMeta):\n\n    def __new__(cls, *args, **kwargs):\n        print("Base __new__..")\n        return super().__new__(cls, *args, **kwargs)\n        \n    def __init__(self, *args, **kwargs):\n        print("Base init..")\n        super().__init__(*args, **kwargs)\n    \nclass A(Base):\n\n    def __new__(cls, *args, **kwargs):\n        print("A __new__..")\n        return super().__new__(cls, *args, **kwargs)\n        \n    def __init__(self, *args, **kwargs):\n        print("A init..")\n        super().__init__(*args, **kwargs)\n        \n    class Meta:\n        name = "zhangsan"\n\n\n# AåBaseé½ä¼éè¿BaseMetaåå»ºï¼æä»¥ä¼è°ç¨ä¸¤æ¬¡__new__åå»ºå®ä¾\noutput:\n\nBaseMeta __new__..\nBaseMeta __new__..\nzhangsan\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n\n\nåç±»çç»å¸ä¾å­æ¯django ORM',normalizedContent:'# propertyå¨æå±æ§\n\néè¿ä½¿ç¨propertyå¯ä»¥å°æ¹æ³åå±æ§ä¸æ ·è·åå¼ãä½¿ç¨setterå¯¹æ¹æ³è¿è¡èµå¼æä½\n\n\nfrom datetime import datetime, date\nclass student:\n\n    def __init__(self, name, birthday):\n        self.name = name\n        self.birthday = birthday\n        self._age = 0\n    \n    @property\n    def age(self):\n        return datetime.now().year - self.birthday.year\n    \n    @age.setter\n    def age(self, value):\n        self._age = value\n    \nstu = student("zhangsan", date(year=1995, month=3, day=7))\nstu.age = 4\nprint(stu.age)\n\noutput: 24\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# getattribute å getattr\n\n__getattr__å¨ç±»ä¸­æ¾ä¸å°å±æ§æ¶ï¼è°ç¨è¯¥å½æ°ã __getattribute__é¦åè°ç¨è¯¥å½æ°ï¼ç¶åæ¾å±æ§.\n\nå¨__getattribute__ä¸­æåºattributeerroræ¶ï¼ä¼è°ç¨__getattr__\n\nè°ç¨é¡ºåº __getattribute__ > __getattr__\n\n\n# å±æ§æè¿°ç¬¦\n\nå¨ç±»ä¸­åªè¦å®ç°äº__get__ã__set__ã__delete__æ¹æ³ä¸­çä¸ä¸ªå°±è®¤ä¸ºæ¯æè¿°ç¬¦. åªå®ç°äº__get__çå¯¹è±¡æ¯éæ°æ®æè¿°ç¬¦. åªè¯» å®ç°äº__get__å__set__çå¯¹è±¡æ¯æ°æ®æè¿°ç¬¦. å¯è¯»å¯å.\n\nclass intfield:\n    def __get__(self):\n        pass\n        \n    def __set__(self):\n        pass\n        \n    def __delete__(self):\n        pass\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# å±æ§æè¿°ç¬¦æ¥æ¾è¿ç¨\n\nå±æ§æè¿°ç¬¦åççè¿ç¨å¨__getattribute__ä¸­.\n\nå¦æageæ¯å±æ§æè¿°ç¬¦ï¼åè°ç¨intfieldä¸­ç__get__è·å¾å±æ§å¼ï¼å¦æè·åå¤±è´¥ï¼åè°ç¨__dict__è·åå¼ãå¦æageä¸æ¯å±æ§æè¿°ç¬¦ï¼åç´æ¥è·å__dict__å¯¹åºçå¼ã\n\n\nimport numbers\nclass intfield:\n    # æ°æ®æè¿°ç¬¦\n    def __get__(self, instance, owner):\n        return self.value\n        \n    def __set__(self, instance, value):\n        if not isinstance(value, numbers.integral):\n            raise valueerror("int value need")\n        if value < 0:\n            raise valueerror("positive value need")\n        self.value = value\n        \n    def __delete__(self, instance):\n        pass\n    \nclass nondataintfield:\n    # éæ°æ®å±æ§æè¿°ç¬¦\n    def __get__(self, instance, owner):\n        return "nondataintfield = {}".format(self.value)\n\nclass user:\n    age = intfield()\n    #age = nondataintfield()\n\nuser = user()\nuser.name = "zhangsan"    # nameä¸æ¯å±æ§æè¿°ç¬¦ï¼æä»¥ç´æ¥å å¥å°`__dict__`ä¸­\nprint(user.__dict__)\n\nuser.age = 12               # ageæ¯å±æ§æè¿°ç¬¦, è°ç¨`intfield`ä¸­ç`__set__`æ¹æ³ï¼ èä¸ä¼å å¥å°`__dict__`ä¸­\nprint(user.__dict__)\nprint(user.age)              # è°ç¨`intfield`ä¸­ç`__get__`æ¹æ³\n\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n\n# åç±»\n\nåç±»æ¯åå»ºç±»çç±». type -> class -> å¯¹è±¡\n\nææçç±»é½æ¯éè¿typeå®ä¾åå¾å°çã\n\n\n# éè¿typeåå»ºclass\n\nä½¿ç¨typeåå»ºuserç±»ï¼è¯¥ç±»ç»§æ¿baseç±»ï¼å¹¶ä¸ætestæ¹æ³ånameå±æ§\n\n\nclass base:\n    def __init__(self, *args, **kwargs):\n        print("base __init__")\n        super().__init__(*args, **kwargs)\n\ndef test(self):\n    print("test = {}".format(self.name))\n \nuser = type("user", (base,), {"test": test, "name": "zhangsan"})\nuser = user()\nuser.test()\n\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# èªå®ä¹åç±»\n\nèªå®ä¹åç±»éè¦éè¿ç»§æ¿typeå®ç°\n\nå¦æç¶ç±»æmetaclassï¼åå­ç±»åç¶ç±»çåå»ºé½éè¦éè¿è¯¥åç±»å®ä¾åå¾å°ã\n\n\n\nclass basemeta(type):\n\n    def __new__(cls, name, bases, args, **kwargs):\n        # print(name)\n        # print(bases)\n        # print(args)\n        print("basemeta __new__..")\n        \n        if name == "base":\n            return super().__new__(cls, name, bases, args, **kwargs)\n            \n        meta = args[\'meta\']\n        name = getattr(meta, "name")    # è·åå°aä¸­metaçnameçå¼. djangoçormä¹æ¯è¿æ ·å®ç°ç\n        print(name)\n        \n        return super().__new__(cls, name, bases, args, **kwargs)\n\n\n\nclass base(metaclass=basemeta):\n\n    def __new__(cls, *args, **kwargs):\n        print("base __new__..")\n        return super().__new__(cls, *args, **kwargs)\n        \n    def __init__(self, *args, **kwargs):\n        print("base init..")\n        super().__init__(*args, **kwargs)\n    \nclass a(base):\n\n    def __new__(cls, *args, **kwargs):\n        print("a __new__..")\n        return super().__new__(cls, *args, **kwargs)\n        \n    def __init__(self, *args, **kwargs):\n        print("a init..")\n        super().__init__(*args, **kwargs)\n        \n    class meta:\n        name = "zhangsan"\n\n\n# aåbaseé½ä¼éè¿basemetaåå»ºï¼æä»¥ä¼è°ç¨ä¸¤æ¬¡__new__åå»ºå®ä¾\noutput:\n\nbasemeta __new__..\nbasemeta __new__..\nzhangsan\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n\n\nåç±»çç»å¸ä¾å­æ¯django orm',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"ä½¿ç¨pythonå®ç°åä¾æ¨¡å¼çä¸ç§æ¹å¼",frontmatter:{title:"ä½¿ç¨pythonå®ç°åä¾æ¨¡å¼çä¸ç§æ¹å¼",date:"2022-12-10T16:47:40.000Z",permalink:"/pages/33b8d0/",tags:["python"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä¸»è¦ä»ç»ä½¿ç¨pythonçä¸ç§å®ç°åä¾æ¨¡å¼çæ¹å¼ã",feed:{enable:!0},categories:["ç¼ç¨","python","åºç¡"],comment:!0,meta:[{name:"twitter:title",content:"ä½¿ç¨pythonå®ç°åä¾æ¨¡å¼çä¸ç§æ¹å¼"},{name:"twitter:description",content:"æ¬æä¸»è¦ä»ç»ä½¿ç¨pythonçä¸ç§å®ç°åä¾æ¨¡å¼çæ¹å¼ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/06.%E4%BD%BF%E7%94%A8python%E5%AE%9E%E7%8E%B0%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ä½¿ç¨pythonå®ç°åä¾æ¨¡å¼çä¸ç§æ¹å¼"},{property:"og:description",content:"æ¬æä¸»è¦ä»ç»ä½¿ç¨pythonçä¸ç§å®ç°åä¾æ¨¡å¼çæ¹å¼ã"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/06.%E4%BD%BF%E7%94%A8python%E5%AE%9E%E7%8E%B0%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-12-10T16:47:40.000Z"},{property:"article:tag",content:"python"},{itemprop:"name",content:"ä½¿ç¨pythonå®ç°åä¾æ¨¡å¼çä¸ç§æ¹å¼"},{itemprop:"description",content:"æ¬æä¸»è¦ä»ç»ä½¿ç¨pythonçä¸ç§å®ç°åä¾æ¨¡å¼çæ¹å¼ã"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/06.%E4%BD%BF%E7%94%A8python%E5%AE%9E%E7%8E%B0%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F.html",relativePath:"04.ç¼ç¨/01.python/01.åºç¡/06.ä½¿ç¨pythonå®ç°åä¾æ¨¡å¼çä¸ç§æ¹å¼.md",key:"v-788e5ef9",path:"/pages/33b8d0/",headers:[{level:2,title:"0 . åè¨",slug:"_0-åè¨",normalizedTitle:"0 . åè¨",charIndex:2},{level:2,title:"1. å¨ç±»ä¸­_new_æ¹æ³ä¸­å®ç°",slug:"_1-å¨ç±»ä¸­-new-æ¹æ³ä¸­å®ç°",normalizedTitle:"1. å¨ç±»ä¸­_new_æ¹æ³ä¸­å®ç°",charIndex:null},{level:2,title:"2. éè¿åç±»å®ç°",slug:"_2-éè¿åç±»å®ç°",normalizedTitle:"2. éè¿åç±»å®ç°",charIndex:627},{level:2,title:"3. éè¿è£é¥°å¨å®ç°åä¾",slug:"_3-éè¿è£é¥°å¨å®ç°åä¾",normalizedTitle:"3. éè¿è£é¥°å¨å®ç°åä¾",charIndex:2516}],headersStr:"0 . åè¨ 1. å¨ç±»ä¸­_new_æ¹æ³ä¸­å®ç° 2. éè¿åç±»å®ç° 3. éè¿è£é¥°å¨å®ç°åä¾",content:'# 0 . åè¨\n\nå¨æ´ä¸ªè¿ç¨ä¸­ï¼æä¸åªæä¸ä¸ªå¯¹è±¡å­å¨ï¼å¨ä»»ä½å°ç¹ä½¿ç¨é½æ¯åä¸ä¸ªå¯¹è±¡ï¼å¯ä»¥è§£å³å¤çº¿ç¨èµæºç«äºé®é¢ï¼ä¹å¸¸ç¨äºéç½®ä¿¡æ¯ã\n\næ¬æä¸»è¦ä»ç»ä½¿ç¨pythonçä¸ç§å®ç°åä¾æ¨¡å¼çæ¹å¼ã\n\n\n# 1. å¨ç±»ä¸­__new__æ¹æ³ä¸­å®ç°\n\nå¨éè¦å®ç°åä¾ç class ä¸­æ·»å __new__æ¹æ³ï¼å¨åå»ºè¯¥ class å¯¹è±¡æ¶ä¼è°ç¨è¯¥æ¹æ³ï¼ä½¿ç¨ç±»åé _instance æ¥ä¿å­å½åå¯¹è±¡ï¼æ¯æ¬¡åå»ºä¹åé½ä¼å¤æ­æ¯å¦æè¯¥å¯¹è±¡ï¼æ²¡æååå»ºï¼æåç´æ¥è¿åã\n\nfrom typing import Any\n\nclass A:\n    def __new__(cls, *args, **kwargs) -> Any:\n        if not hasattr(cls, "_instance"):\n            cls._instance = super().__new__(cls, *args, **kwargs)\n    return cls._instance\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næä»¬åå»ºä¸¤ä¸ª class A å¯¹è±¡ï¼ç¶ååå«æå°ä»ä»¬çåå­ IDï¼ä¼åç°ä¸¤è ID æ¯ä¸è´çï¼ä¹å°±æ¯æ¯åä¸ä¸ªå¯¹è±¡ã\n\na1 = A()  \na2 = A()  \nprint(id(a1))  \nprint(id(a2))\n\nOutput: \n2659742107728\n2659742107728\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 2. éè¿åç±»å®ç°\n\nä¸é¢çæ¹å¼éè¦å¨æ¯ä¸ä¸ªåä¾ç±»ä¸­é½è¦æ·»å ä¸ä¸ª__new__æ¹æ³ï¼æå¤§éçéå¤ä»£ç ãæ¥ä¸æ¥æä»¬ä»ç»éè¿åç±»æ¥å®ç°åä¾ã\n\n * ç¬¬ä¸ç\n\né¦ååå»º class Singleton æ¥ç»§æ¿ typeï¼è¯¥ç±»ä¸ºæä»¬èªå®ä¹çåç±»ãç¶ååå»ºæä»¬éè¦åä¾ç class A å Bï¼å®ä»¬é½éè¦éè¿ metaclass=Singleton æ¥éæ© Singleton ä½ä¸ºå®ä»¬çåç±»ã\n\nå¨åç±»ä¸­ï¼åå»º __call__ æ¹æ³ï¼è¯¥æ¹æ³ä¼å¨ class A å B åå»ºå¯¹è±¡æ¶è°ç¨ï¼å¨è¯¥æ¹æ³ä¸­ä¼è°ç¨ __new__ å __init__ æ¹æ³ï¼åå»ºå®å¯¹è±¡åï¼åå°è¯¥å¯¹è±¡æ¾å¨ç±»åé _instance ä¸­ï¼å 1. å¨__new__ä¸­å®ç°åä¾ çæ¹æ³ä¸æ ·ã\n\nfrom typing import Any\n\nclass Singleton(type):\n    def __call__(self, *args: Any, **kwds: Any) -> Any:\n        if not hasattr(self, "_instance"):\n            self._instance = super(Singleton, self).__call__(*args, **kwds)\n\n        return self._instance\n\nclass A(metaclass=Singleton):\n    pass\n\nclass B(metaclass=Singleton):\n    pass\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næä»¬åéè¿æµè¯ï¼å¯ä»¥çå° class A å B é½å®ç°äºåä¾ã\n\na1 = A()\na2 = A()\nprint(id(a1))\nprint(id(a2))\n\nb1 = B()\nb2 = B()\nprint(id(b1))\nprint(id(b2))\n\nOutput:\n>>> 2802632572784\n>>> 2802632572784\n>>> 2802632572400\n>>> 2802632572400\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nä½è¿ä¸ªåä¾è®¾è®¡åªéç¨äºåçº¿ç¨ï¼å¨å¤çº¿ç¨ä¸­ï¼å¦æä¸¤ä¸ªçº¿ç¨é½åç hasattr ä¸é¢ï¼å¯è½è¿æ¯ä¼åå»ºä¸¤ä¸ªå¯¹è±¡ï¼è¾¾ä¸å°åä¾çææã\n\n * ç¬¬äºç\n\néè¿å éè§£å³ä¸é¢å¹¶åçé®é¢ã\n\nimport threading\n\nclass Singleton(type):\n    lock = threading.Lock()\n    \n    def __call__(self, *args: Any, **kwds: Any) -> Any:\n        with Singleton.lock:\n            if not hasattr(self, "_instance"):\n                self._instance = super(Singleton, self).__call__(*args, **kwds)\n\n        return self._instance\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nä½æ¯å¶å®åªæç¬¬ä¸æ¬¡åå»ºå¯¹è±¡æ¶ï¼éè¦éè¿éåæ­¥è·ååä¾å¯¹è±¡ï¼å¨å·²æå¯¹è±¡æ¶ï¼ä¸éè¦åç¨éäºï¼å¨è¿ç§æåµä¸ï¼æ¯æ¬¡è·åå¯¹è±¡é½ç»è¿éï¼ä¼å½±åæ§è½ã\n\n * æç»ç\n\næä»¥åå ä¸ä¸éå¤æ­ï¼åå°æ¯æ¬¡éå¤æ­å¸¦æ¥çæ§è½æ¶èã\n\nimport threading\nclass Singleton(type):\n    lock = threading.Lock()\n    \n    def __call__(self, *args: Any, **kwds: Any) -> Any:\n        if not hasattr(self, "_instance"):\n            with Singleton.lock:\n                if not hasattr(self, "_instance"):\n                    self._instance = super(Singleton, self).__call__(*args, **kwds)\n\n        return self._instance\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# 3. éè¿è£é¥°å¨å®ç°åä¾\n\nè¯¥æ¹æ³æ¯éè¿å®ç°ä¸ä¸ªè£é¥°å¨ï¼å¨éè¦å®ç°ç±»ä¸æ·»å è¯¥è£é¥°å¨å³å¯å®æï¼ä½¿ç¨ç®åã\n\néè¿å°ææçåä¾å¯¹è±¡ä¿å­å¨è£é¥°å¨ç _instance å­å¸ä¸­ï¼ä»¥ç±»ä¸º keyï¼å¯¹è±¡ä¸º value è¿è¡å­å¨ã\n\ndef Singleton(cls):\n    _instance = {}\n    def _singleton(*args, **kargs):\n        if cls not in _instance:\n            _instance[cls] = cls(*args, **kargs)\n        return _instance[cls]\n    return _singleton\n@Singleton\nclass A:\n    pass\n  \n@Singleton\nclass B:\n    pass\n  \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n',normalizedContent:'# 0 . åè¨\n\nå¨æ´ä¸ªè¿ç¨ä¸­ï¼æä¸åªæä¸ä¸ªå¯¹è±¡å­å¨ï¼å¨ä»»ä½å°ç¹ä½¿ç¨é½æ¯åä¸ä¸ªå¯¹è±¡ï¼å¯ä»¥è§£å³å¤çº¿ç¨èµæºç«äºé®é¢ï¼ä¹å¸¸ç¨äºéç½®ä¿¡æ¯ã\n\næ¬æä¸»è¦ä»ç»ä½¿ç¨pythonçä¸ç§å®ç°åä¾æ¨¡å¼çæ¹å¼ã\n\n\n# 1. å¨ç±»ä¸­__new__æ¹æ³ä¸­å®ç°\n\nå¨éè¦å®ç°åä¾ç class ä¸­æ·»å __new__æ¹æ³ï¼å¨åå»ºè¯¥ class å¯¹è±¡æ¶ä¼è°ç¨è¯¥æ¹æ³ï¼ä½¿ç¨ç±»åé _instance æ¥ä¿å­å½åå¯¹è±¡ï¼æ¯æ¬¡åå»ºä¹åé½ä¼å¤æ­æ¯å¦æè¯¥å¯¹è±¡ï¼æ²¡æååå»ºï¼æåç´æ¥è¿åã\n\nfrom typing import any\n\nclass a:\n    def __new__(cls, *args, **kwargs) -> any:\n        if not hasattr(cls, "_instance"):\n            cls._instance = super().__new__(cls, *args, **kwargs)\n    return cls._instance\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næä»¬åå»ºä¸¤ä¸ª class a å¯¹è±¡ï¼ç¶ååå«æå°ä»ä»¬çåå­ idï¼ä¼åç°ä¸¤è id æ¯ä¸è´çï¼ä¹å°±æ¯æ¯åä¸ä¸ªå¯¹è±¡ã\n\na1 = a()  \na2 = a()  \nprint(id(a1))  \nprint(id(a2))\n\noutput: \n2659742107728\n2659742107728\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 2. éè¿åç±»å®ç°\n\nä¸é¢çæ¹å¼éè¦å¨æ¯ä¸ä¸ªåä¾ç±»ä¸­é½è¦æ·»å ä¸ä¸ª__new__æ¹æ³ï¼æå¤§éçéå¤ä»£ç ãæ¥ä¸æ¥æä»¬ä»ç»éè¿åç±»æ¥å®ç°åä¾ã\n\n * ç¬¬ä¸ç\n\né¦ååå»º class singleton æ¥ç»§æ¿ typeï¼è¯¥ç±»ä¸ºæä»¬èªå®ä¹çåç±»ãç¶ååå»ºæä»¬éè¦åä¾ç class a å bï¼å®ä»¬é½éè¦éè¿ metaclass=singleton æ¥éæ© singleton ä½ä¸ºå®ä»¬çåç±»ã\n\nå¨åç±»ä¸­ï¼åå»º __call__ æ¹æ³ï¼è¯¥æ¹æ³ä¼å¨ class a å b åå»ºå¯¹è±¡æ¶è°ç¨ï¼å¨è¯¥æ¹æ³ä¸­ä¼è°ç¨ __new__ å __init__ æ¹æ³ï¼åå»ºå®å¯¹è±¡åï¼åå°è¯¥å¯¹è±¡æ¾å¨ç±»åé _instance ä¸­ï¼å 1. å¨__new__ä¸­å®ç°åä¾ çæ¹æ³ä¸æ ·ã\n\nfrom typing import any\n\nclass singleton(type):\n    def __call__(self, *args: any, **kwds: any) -> any:\n        if not hasattr(self, "_instance"):\n            self._instance = super(singleton, self).__call__(*args, **kwds)\n\n        return self._instance\n\nclass a(metaclass=singleton):\n    pass\n\nclass b(metaclass=singleton):\n    pass\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næä»¬åéè¿æµè¯ï¼å¯ä»¥çå° class a å b é½å®ç°äºåä¾ã\n\na1 = a()\na2 = a()\nprint(id(a1))\nprint(id(a2))\n\nb1 = b()\nb2 = b()\nprint(id(b1))\nprint(id(b2))\n\noutput:\n>>> 2802632572784\n>>> 2802632572784\n>>> 2802632572400\n>>> 2802632572400\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nä½è¿ä¸ªåä¾è®¾è®¡åªéç¨äºåçº¿ç¨ï¼å¨å¤çº¿ç¨ä¸­ï¼å¦æä¸¤ä¸ªçº¿ç¨é½åç hasattr ä¸é¢ï¼å¯è½è¿æ¯ä¼åå»ºä¸¤ä¸ªå¯¹è±¡ï¼è¾¾ä¸å°åä¾çææã\n\n * ç¬¬äºç\n\néè¿å éè§£å³ä¸é¢å¹¶åçé®é¢ã\n\nimport threading\n\nclass singleton(type):\n    lock = threading.lock()\n    \n    def __call__(self, *args: any, **kwds: any) -> any:\n        with singleton.lock:\n            if not hasattr(self, "_instance"):\n                self._instance = super(singleton, self).__call__(*args, **kwds)\n\n        return self._instance\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nä½æ¯å¶å®åªæç¬¬ä¸æ¬¡åå»ºå¯¹è±¡æ¶ï¼éè¦éè¿éåæ­¥è·ååä¾å¯¹è±¡ï¼å¨å·²æå¯¹è±¡æ¶ï¼ä¸éè¦åç¨éäºï¼å¨è¿ç§æåµä¸ï¼æ¯æ¬¡è·åå¯¹è±¡é½ç»è¿éï¼ä¼å½±åæ§è½ã\n\n * æç»ç\n\næä»¥åå ä¸ä¸éå¤æ­ï¼åå°æ¯æ¬¡éå¤æ­å¸¦æ¥çæ§è½æ¶èã\n\nimport threading\nclass singleton(type):\n    lock = threading.lock()\n    \n    def __call__(self, *args: any, **kwds: any) -> any:\n        if not hasattr(self, "_instance"):\n            with singleton.lock:\n                if not hasattr(self, "_instance"):\n                    self._instance = super(singleton, self).__call__(*args, **kwds)\n\n        return self._instance\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# 3. éè¿è£é¥°å¨å®ç°åä¾\n\nè¯¥æ¹æ³æ¯éè¿å®ç°ä¸ä¸ªè£é¥°å¨ï¼å¨éè¦å®ç°ç±»ä¸æ·»å è¯¥è£é¥°å¨å³å¯å®æï¼ä½¿ç¨ç®åã\n\néè¿å°ææçåä¾å¯¹è±¡ä¿å­å¨è£é¥°å¨ç _instance å­å¸ä¸­ï¼ä»¥ç±»ä¸º keyï¼å¯¹è±¡ä¸º value è¿è¡å­å¨ã\n\ndef singleton(cls):\n    _instance = {}\n    def _singleton(*args, **kargs):\n        if cls not in _instance:\n            _instance[cls] = cls(*args, **kargs)\n        return _instance[cls]\n    return _singleton\n@singleton\nclass a:\n    pass\n  \n@singleton\nclass b:\n    pass\n  \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"pythonè£é¥°å¨çä½¿ç¨æ¹æ³",frontmatter:{title:"pythonè£é¥°å¨çä½¿ç¨æ¹æ³",date:"2022-10-23T17:18:08.000Z",permalink:"/pages/7434f1/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä»ç»pythonä¸­çè£é¥°å¨çå ç§å¸¸è§çä½¿ç¨æ¹æ³å¹¶çè§£å®ä»¬çå®ç°åçã",feed:{enable:!0},tags:["python"],categories:["ç¼ç¨","python","åºç¡"],comment:!0,meta:[{name:"twitter:title",content:"pythonè£é¥°å¨çä½¿ç¨æ¹æ³"},{name:"twitter:description",content:"ä»ç»pythonä¸­çè£é¥°å¨çå ç§å¸¸è§çä½¿ç¨æ¹æ³å¹¶çè§£å®ä»¬çå®ç°åçã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/05.python%E8%A3%85%E9%A5%B0%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95.html"},{property:"og:type",content:"article"},{property:"og:title",content:"pythonè£é¥°å¨çä½¿ç¨æ¹æ³"},{property:"og:description",content:"ä»ç»pythonä¸­çè£é¥°å¨çå ç§å¸¸è§çä½¿ç¨æ¹æ³å¹¶çè§£å®ä»¬çå®ç°åçã"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/05.python%E8%A3%85%E9%A5%B0%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-10-23T17:18:08.000Z"},{property:"article:tag",content:"python"},{itemprop:"name",content:"pythonè£é¥°å¨çä½¿ç¨æ¹æ³"},{itemprop:"description",content:"ä»ç»pythonä¸­çè£é¥°å¨çå ç§å¸¸è§çä½¿ç¨æ¹æ³å¹¶çè§£å®ä»¬çå®ç°åçã"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/05.python%E8%A3%85%E9%A5%B0%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95.html",relativePath:"04.ç¼ç¨/01.python/01.åºç¡/05.pythonè£é¥°å¨çä½¿ç¨æ¹æ³.md",key:"v-597fc7ce",path:"/pages/7434f1/",headers:[{level:2,title:"0. åè¨",slug:"_0-åè¨",normalizedTitle:"0. åè¨",charIndex:2},{level:2,title:"1. ä½¿ç¨",slug:"_1-ä½¿ç¨",normalizedTitle:"1. ä½¿ç¨",charIndex:87},{level:3,title:"1.1 å¨å½æ°ä¸æ·»å è£é¥°å¨",slug:"_1-1-å¨å½æ°ä¸æ·»å è£é¥°å¨",normalizedTitle:"1.1 å¨å½æ°ä¸æ·»å è£é¥°å¨",charIndex:97},{level:3,title:"1.2 è£é¥°å¨çè¿è¡è¿ç¨",slug:"_1-2-è£é¥°å¨çè¿è¡è¿ç¨",normalizedTitle:"1.2 è£é¥°å¨çè¿è¡è¿ç¨",charIndex:547},{level:3,title:"1.3 ä¿å­åå½æ°ä¿¡æ¯",slug:"_1-3-ä¿å­åå½æ°ä¿¡æ¯",normalizedTitle:"1.3 ä¿å­åå½æ°ä¿¡æ¯",charIndex:1077},{level:3,title:"1.4 è°ç¨åå½æ°",slug:"_1-4-è°ç¨åå½æ°",normalizedTitle:"1.4 è°ç¨åå½æ°",charIndex:2311},{level:3,title:"1.5 å¸¦åæ°çè£é¥°å¨",slug:"_1-5-å¸¦åæ°çè£é¥°å¨",normalizedTitle:"1.5 å¸¦åæ°çè£é¥°å¨",charIndex:2824},{level:3,title:"1.6 å¸¦å¯éåæ°çè£é¥°å¨",slug:"_1-6-å¸¦å¯éåæ°çè£é¥°å¨",normalizedTitle:"1.6 å¸¦å¯éåæ°çè£é¥°å¨",charIndex:3581},{level:3,title:"1.7 å¨ç±»ä¸æ·»å è£é¥°å¨",slug:"_1-7-å¨ç±»ä¸æ·»å è£é¥°å¨",normalizedTitle:"1.7 å¨ç±»ä¸æ·»å è£é¥°å¨",charIndex:4553},{level:3,title:"1.8 ç±»è£é¥°å¨",slug:"_1-8-ç±»è£é¥°å¨",normalizedTitle:"1.8 ç±»è£é¥°å¨",charIndex:5209},{level:3,title:"1.9 æ´é²è¢«è£é¥°çåä¿¡æ¯",slug:"_1-9-æ´é²è¢«è£é¥°çåä¿¡æ¯",normalizedTitle:"1.9 æ´é²è¢«è£é¥°çåä¿¡æ¯",charIndex:5869},{level:3,title:"1.10 å¸¦åæ°çç±»è£é¥°å¨",slug:"_1-10-å¸¦åæ°çç±»è£é¥°å¨",normalizedTitle:"1.10 å¸¦åæ°çç±»è£é¥°å¨",charIndex:6595},{level:2,title:"2. æ»ç»",slug:"_2-æ»ç»",normalizedTitle:"2. æ»ç»",charIndex:7334},{level:2,title:"3. åèèµæ",slug:"_3-åèèµæ",normalizedTitle:"3. åèèµæ",charIndex:7395}],headersStr:"0. åè¨ 1. ä½¿ç¨ 1.1 å¨å½æ°ä¸æ·»å è£é¥°å¨ 1.2 è£é¥°å¨çè¿è¡è¿ç¨ 1.3 ä¿å­åå½æ°ä¿¡æ¯ 1.4 è°ç¨åå½æ° 1.5 å¸¦åæ°çè£é¥°å¨ 1.6 å¸¦å¯éåæ°çè£é¥°å¨ 1.7 å¨ç±»ä¸æ·»å è£é¥°å¨ 1.8 ç±»è£é¥°å¨ 1.9 æ´é²è¢«è£é¥°çåä¿¡æ¯ 1.10 å¸¦åæ°çç±»è£é¥°å¨ 2. æ»ç» 3. åèèµæ",content:'# 0. åè¨\n\nè£é¥°å¨å¨ python ä¸­ä½¿ç¨çé¢çéå¸¸é«ï¼å®å¯ä»¥å¨ä¸æ¹å¨åæå½æ°çåºç¡ä¸å¯¹å¶è¿è¡å¢å¼ºåè½ã\n\nä¸é¢ä¸»è¦æ¯ä»ç»è£é¥°å¨çåç§ç¨æ³ï¼å¹¶çè§£å¶è¿è¡è¿ç¨ã\n\n\n# 1. ä½¿ç¨\n\n\n# 1.1 å¨å½æ°ä¸æ·»å è£é¥°å¨\n\ndecro æ¯ä¸ä¸ªè£é¥°å¨å½æ°ï¼å¶å®ç°æ¯å°åé¨çå½æ° wrapper ä½ä¸ºè¿åå¼è¿ååºå»ã\n\nå¨å½æ° test ä¸æ·»å  @decro è¿è¡ä½¿ç¨ï¼å¯ä»¥å°æ¬å½æ°ä½ä¸ºä¸ä¸ªåæ°ä¼ å¥å° decro å½æ°ä¸­ï¼ç¶åï¼ç¶åå¾å°çæ¯è£é¥°å¨å½æ°åé¨è¿åçå½æ° wrapper, æä»¬å¨è°ç¨ test æ¹æ³æ¶ï¼å¶å®è°ç¨çæ¯è£é¥°å¨è¿åç wrapper å½æ°ï¼è¯¥å½æ°ä¸­ä¼è°ç¨è¢«è£é¥°çå½æ° test\n\ndef decro(func):  \n    def wrapper(*args, **kwargs):  \n        print("wrapper")  \n        return func()  \n  \n    return wrapper\n\n\n@decro  \ndef test():  \n    print("test")  \n\n\ntest()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nè¾åºï¼\n\nwrapper\ntest\n\n\n1\n2\n\n\n\n# 1.2 è£é¥°å¨çè¿è¡è¿ç¨\n\nè£é¥°å¨æ¶å¨è¢«è£é¥°çå½æ°å®ä¹ä¹åç«å³è¿è¡çï¼å½æ§è¡å°@decro è£é¥° test å½æ°æ¶ï¼ä¼é©¬ä¸æ§è¡å½æ° decroï¼ç¶åå° wrapper ç»è¿ååºå»ã\n\ndef decro(func):  \n    print("decro")  \n  \n    def wrapper(*args, **kwargs):  \n        print("wrapper")  \n        return func()  \n  \n    return wrapper  \n  \nprint("start")  \n  \n@decro  \ndef test():  \n    print("test")  \n  \nprint("end")\n\ntest()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè¾åºå¦ä¸ï¼å¯ä»¥çå°åæ§è¡äº startï¼ç¶åé©¬ä¸æ§è¡äºè£é¥°å¨ decroï¼ç¶ååæ§è¡ endï¼å½æä»¬è°ç¨ test å½æ°æ¶ï¼æ§è¡äºè£é¥°å¨åé¨å½æ° wrapperï¼ç¶ååè°ç¨è¢«è£é¥°çå½æ° test\n\nstart\ndecro\nend\nwrapper\ntest\n\n\n1\n2\n3\n4\n5\n\n\n\n# 1.3 ä¿å­åå½æ°ä¿¡æ¯\n\nå¨ä½¿ç¨è£é¥°å¨æ¶ï¼è°ç¨çåæ¹æ³å·²ç»è¢«æ¿æ¢ä¸ºè£é¥°å¨è¿åçæ°æ¹æ³äºï¼æä»¥æ¹æ³çåä¿¡æ¯å·²ç»è¢«æ¿æ¢äº, éè¿ nameãdoc å¾å°çåæ°æ®å·²ç»è¢«æ¿æ¢æäºæ°æ¹æ³çã\n\ndef decro(func):  \n    def wrapper(*args, **kwargs):  \n        """ wrapper doc """  \n        print("wrapper")  \n        return func(*args, **kwargs)  \n  \n    return wrapper  \n  \n  \n@decro  \ndef test():  \n    """ test doc """  \n    print("test")  \n  \n  \nprint("test\'s __name__ = {}".format(test.__name__))  \nprint("test\'s __doc__ = {}".format(test.__doc__))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nè¾åºå¦ä¸ï¼ä¼åç°å½æ° test çå½æ°ä¿¡æ¯ __name__ å __doc__ åæ wrapper çä¿¡æ¯ã\n\ntest\'s __name__ = wrapper\ntest\'s __doc__ =  wrapper doc\n\n\n1\n2\n\n\nä½æ¯æä»¬ä¸æ³è¦æ¹ååæ¹æ³çåä¿¡æ¯ï¼è¿ä¸ªæ¶åéè¦ä½¿ç¨ functools.wraps è§£å³ã\n\nfrom functools import wraps  \n  \ndef decro(func):  \n  \n    @wraps(func)  \n    def wrapper(*args, **kwargs):  \n        """ wrapper doc """  \n        print("wrapper")  \n        return func(*args, **kwargs)  \n  \n    return wrapper  \n  \n  \n@decro  \ndef test():  \n    """ test doc """  \n    print("test")  \n  \n  \nprint("test\'s __name__ = {}".format(test.__name__))  \nprint("test\'s __doc__ = {}".format(test.__doc__))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nè¾åºå¦ä¸ï¼ä¼åç°ï¼test å½æ°ä¿¡æ¯æ²¡æè¢«æ¿æ¢æï¼ä¿è¯äºå½æ°çåæ±åå³ã\n\ntest\'s __name__ = test\ntest\'s __doc__ =  test doc \n\n\n1\n2\n\n\n\n# 1.4 è°ç¨åå½æ°\n\nè£é¥°å¨å¯ä»¥å¢å¼ºå½æ°çåè½ï¼ä½æ¯å¨æäºåºæ¯æå°±æ³è¦ä½¿ç¨åå½æ°ï¼èä¸æ³ä½¿ç¨è£é¥°ä¹åçå½æ°ï¼å¯ä»¥éè¿è°ç¨__wrapped__æ¥è°ç¨åå½æ°ã\n\nfrom functools import wraps  \n  \n\ndef decro(func):  \n    @wraps(func)  \n    def wrapper(*args, **kwargs):  \n        """ wrapper doc """  \n        print("wrapper")  \n        return func(*args, **kwargs)  \n  \n    return wrapper  \n  \n  \n@decro  \ndef test():  \n    """ test doc """  \n    print("test")  \n  \n  \ntest.__wrapped__()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nè¾åºå¦ä¸ï¼è¾åº textï¼èæ²¡æè¾åº wrapperï¼è¯´æè°ç¨çæ¯åå½æ°ã\n\ntest\n\n\n1\n\n\n\n# 1.5 å¸¦åæ°çè£é¥°å¨\n\nè¿æè¿ä¹ä¸ç§åºæ¯ï¼æä»¬æ³è¦å¨è£é¥°å¨ä¸­æ·»å åæ°ã\n\næ³è¦éè¿åæ°å³å®æ¥å¿çº§å«ï¼è¿éç logged æ¥æ¶ level åæ°å¹¶å°å®ä½ç¨å¨åé¨å½æ°ä¸­ï¼è¿åå¼æ¯å° decro å½æ°è¿åï¼ç¶ååå°å½æ° test ä½ä¸ºåæ°ä»ä¼ å¥å° decro å½æ°ä¸­ï¼åå° wrapper è¿åï¼æç» test è¿æ¯æ¿æ¢æäº wrapperï¼å¨è¯¥æ¹æ³ä¸­ä½¿ç¨äºä¼ å¥ç ERROR çæ¥å¿çº§å«ã\n\nfrom functools import wraps  \nimport logging  \n  \n  \ndef logged(level):  \n    def decro(func):  \n        @wraps(func)  \n        def wrapper(*args, **kwargs):  \n            """ wrapper doc """  \n            logging.log(level, func.__name__)  \n            return func(*args, **kwargs)  \n  \n        return wrapper  \n  \n    return decro  \n  \n  \n@logged(level=logging.ERROR)  \ndef test():  \n    """ test doc """  \n    print("test")  \n  \n  \ntest()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nè¾åºäº ERROR æ¥å¿çº§å«çæ¥å¿ï¼\n\nERROR:root:test\ntest\n\n\n1\n2\n\n\n\n# 1.6 å¸¦å¯éåæ°çè£é¥°å¨\n\nä¸é¢å®ç°çè£é¥°å¨æ¯å¿é¡»è¦å¸¦ä¸åæ°çï¼ä½æ¯æçæ¶åï¼æä»¬ä¸éè¦å¸¦åæ°ï¼é£ä¹è¯¥å¦ä½å®ç°ï¼\n\nè£é¥°å¨ç func é»è®¤å¼ä¸º Noneï¼å½ä¼ å¥ level åæ°æ¶ï¼åè¿ååå½æ° partial ï¼è¯¥å½æ°ä¼åºäº logged åå»ºä¸ä¸ªä»åå« level çæ°çå½æ°ï¼è¿ä¸ªæ°çå½æ°ä½ä¸ºæ°çè£é¥°å¨æ¥è£é¥° add å½æ°ã\n\nå½æ²¡æä¼ å¥ level åæ°æ¶ï¼å°±åæ®éçè£é¥°å¨ä¸æ ·ä½¿ç¨ã\n\nfrom functools import wraps, partial  \nimport logging  \n  \n  \ndef logged(func=None, level=logging.INFO):  \n    if func is None:  \n        return partial(logged, level=level)  \n  \n    @wraps(func)  \n    def wrapper(*args, **kwargs):  \n        logging.log(level, func.__name__)  \n        return func(*args, **kwargs)  \n  \n    return wrapper  \n  \n  \n@logged(level=logging.ERROR)  \ndef add(a, b):  \n    print("add")  \n    return a + b  \n  \n  \n@logged  \ndef add2(a, b):  \n    print("add2")  \n    return a + b  \n  \n  \nprint(add(1, 2))  \nprint("-" * 10)  \nprint(add2(1, 2))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\nè¾åºå¦ä¸ï¼add å½æ°çè£é¥°å¨ä¼ å¥äºæ¥å¿çº§å«ä¸º ERROR çåæ°ï¼è¾åºäº ERROR çæ¥å¿ï¼èadd2 æ²¡æã\n\nERROR:root:add\nadd\n3\n----------\nadd2\n3\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 1.7 å¨ç±»ä¸æ·»å è£é¥°å¨\n\nä¸é¢é½æ¯ä½¿ç¨è£é¥°å¨æ¥å¢å¼ºå½æ°çåè½ï¼ä½å®è¿å¯ä»¥å¢å¼ºç±»çåè½ï¼å¯¹ç±»è¿è¡è£é¥°ã\n\nä¸é¢çä¾å­ä¸­ï¼decro å°è¢«è£é¥°çç±» Demo ä¼ å¥è¿æ¥ï¼ä¸»è¦æ¯å°å¶ç±»ä¸­ __getattribute__ æ¹æ³æ¿æ¢æäº new_getattribute æ¹æ³ã\n\ndef decro(cls):  \n    orig_getattribute = cls.__getattribute__  \n  \n    def new_getattribute(self, name):  \n        print("get name = {}".format(name))  \n        return orig_getattribute(self, name)  \n  \n    cls.__getattribute__ = new_getattribute  \n    return cls  \n  \n  \n@decro  \nclass Demo:  \n  \n    def __init__(self, num):  \n        self.num = num  \n  \n  \nd = Demo(1)  \nprint(d.num)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nè¾åºå¦ä¸ï¼è·å num çå¼æ¶ï¼è°ç¨äºè£é¥°å¨æ¿æ¢ç new_getattribute æ¹æ³ã\n\nget name = num\n1\n\n\n1\n2\n\n\n\n# 1.8 ç±»è£é¥°å¨\n\nä¹åé½æ¯ä½¿ç¨å½æ°æ¹æ³æ¥å®ä¹è£é¥°å¨ï¼ä½å¶å®ä¹å¯ä»¥éè¿ç±»æ¥å®ä¹è£é¥°å¨ã\n\nå¨ç±»è£é¥°å¨ä¸­å®ä¹__init__æ¹æ³ï¼è¢«å®è£é¥°çå½æ°ä¼è¢«ä¼ å¥å° func åæ°ä¸­ï¼è¿ä¸ªæ¶åè¯¥ç±»è£é¥°å¨å·²ç»è¢«å®ä¾åäºï¼ä¹å°±æ¯å°è¯¥å®ä¾å¯¹è±¡æ¿æ¢äºè¢«è£é¥°çå½æ° sayã\n\nå½æä»¬è°ç¨ say å½æ°æ¶ï¼å¶å®è°ç¨çæ¯ç±»è£é¥°å¨çå¯¹è±¡ï¼è¿ä¸ªæ¶åä¼è°ç¨__call__æ¹æ³ï¼è¯¥æ¹æ³ä¸­å¯ä»¥å¯¹åå½æ°è¿è¡å¢å¼ºï¼å¹¶è¿è¡è°ç¨åæ¹æ³ã\n\nclass logger(object):  \n    def __init__(self, func):  \n        self.func = func  \n  \n    def __call__(self, *args, **kwargs):  \n        print("the function {func}() is running...".format(func=self.func.__name__))  \n        return self.func(*args, **kwargs)  \n  \n  \n@logger  \ndef say(something):  \n    print("say {}!".format(something))  \n  \n  \nsay("hello")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè¾åºå¦ä¸ï¼\n\nthe function say() is running...\nsay hello!\n\n\n1\n2\n\n\n\n# 1.9 æ´é²è¢«è£é¥°çåä¿¡æ¯\n\nè¿ä¸ªæ¶åä¼åºç°åå½æ°è£é¥°å¨ä¸æ ·çé®é¢ï¼é£å°±æ¯è¢«è£é¥°çå½æ°çåä¿¡æ¯å·²ç»è¢«æ¿æ¢æäºï¼è¿ä¸ªæ¶åæä»¬è¿æ¯æ³ä¿çåæçåä¿¡æ¯ã\n\nè¿æ¯ä½¿ç¨ wraps å½æ°æ¥è§£å³è¯¥é®é¢ã\n\nfrom functools import wraps  \n  \n  \nclass logger(object):  \n    """ logger doc """  \n  \n    def __init__(self, func):  \n        wraps(func)(self)  \n  \n    def __call__(self, *args, **kwargs):  \n        print("the function {func}() is running...".format(func=self.__wrapped__.__name__))  \n        return self.__wrapped__(*args, **kwargs)  \n  \n  \n@logger  \ndef say(something):  \n    """ say doc """  \n    print("say {}!".format(something))  \n  \n  \nsay("hello2")  \nprint(say.__doc__)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nè¾åºçæ¯ say æ¹æ³ç docï¼\n\nthe function say() is running...\nsay hello2!\n say doc \n\n\n1\n2\n3\n\n\n\n# 1.10 å¸¦åæ°çç±»è£é¥°å¨\n\né£ä¹å¸¦åæ°çç±»è£é¥°å¨è¯¥å¦ä½å®ç°å¢ï¼\n\nå¨ __init__ æ¹æ³ä¸­æ¥æ¶è£é¥°å¨ä¼ å¥çåæ°ï¼ä¿å­èµ·æ¥ï¼ç¶ååéè¿ __call__ å½æ°å°åé¨å½æ° wrapper ç»è¿ååºå»ï¼è¿ä¸ªæ¶åè¢«è£é¥°çå½æ°å·²ç»è¢« wrapper ç»æ¿æ¢äºã\n\nclass logger(object):  \n  \n    def __init__(self, level="INFO"):  \n        self.level = level  \n  \n    def __call__(self, func):  \n        def wrapper(*args, **kwargs): \n\t        print("[{level}]: the function {func}() is running...".format(level=self.level, func=func.__name__)) \n            func(*args, **kwargs)  \n  \n        return wrapper  \n  \n  \n@logger(level="ERROR")  \ndef say(something):  \n    print("say {}!".format(something))  \n  \n  \nsay("hello2")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nè¾åºå¦ä¸ï¼è°ç¨ say å½æ°ä¹å°±æ¯è°ç¨ wrapper å½æ°ï¼\n\n[ERROR]: the function say() is running...\nsay hello2!\n\n\n1\n2\n\n\n\n# 2. æ»ç»\n\nè£é¥°å¨çç¨æ³å¾å¤ï¼å°è£æåºï¼ç»å¶ä»äººä½¿ç¨ä¹éå¸¸çæ¹ä¾¿ï¼æä»¬éè¦çè§£å®çè¿è¡è¿ç¨ï¼æè½æ´å¥½çä½¿ç¨å®ã\n\n\n# 3. åèèµæ\n\n * https://python3-cookbook.readthedocs.io/zh_CN/latest/c09/p01_put_wrapper_around_function.html',normalizedContent:'# 0. åè¨\n\nè£é¥°å¨å¨ python ä¸­ä½¿ç¨çé¢çéå¸¸é«ï¼å®å¯ä»¥å¨ä¸æ¹å¨åæå½æ°çåºç¡ä¸å¯¹å¶è¿è¡å¢å¼ºåè½ã\n\nä¸é¢ä¸»è¦æ¯ä»ç»è£é¥°å¨çåç§ç¨æ³ï¼å¹¶çè§£å¶è¿è¡è¿ç¨ã\n\n\n# 1. ä½¿ç¨\n\n\n# 1.1 å¨å½æ°ä¸æ·»å è£é¥°å¨\n\ndecro æ¯ä¸ä¸ªè£é¥°å¨å½æ°ï¼å¶å®ç°æ¯å°åé¨çå½æ° wrapper ä½ä¸ºè¿åå¼è¿ååºå»ã\n\nå¨å½æ° test ä¸æ·»å  @decro è¿è¡ä½¿ç¨ï¼å¯ä»¥å°æ¬å½æ°ä½ä¸ºä¸ä¸ªåæ°ä¼ å¥å° decro å½æ°ä¸­ï¼ç¶åï¼ç¶åå¾å°çæ¯è£é¥°å¨å½æ°åé¨è¿åçå½æ° wrapper, æä»¬å¨è°ç¨ test æ¹æ³æ¶ï¼å¶å®è°ç¨çæ¯è£é¥°å¨è¿åç wrapper å½æ°ï¼è¯¥å½æ°ä¸­ä¼è°ç¨è¢«è£é¥°çå½æ° test\n\ndef decro(func):  \n    def wrapper(*args, **kwargs):  \n        print("wrapper")  \n        return func()  \n  \n    return wrapper\n\n\n@decro  \ndef test():  \n    print("test")  \n\n\ntest()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nè¾åºï¼\n\nwrapper\ntest\n\n\n1\n2\n\n\n\n# 1.2 è£é¥°å¨çè¿è¡è¿ç¨\n\nè£é¥°å¨æ¶å¨è¢«è£é¥°çå½æ°å®ä¹ä¹åç«å³è¿è¡çï¼å½æ§è¡å°@decro è£é¥° test å½æ°æ¶ï¼ä¼é©¬ä¸æ§è¡å½æ° decroï¼ç¶åå° wrapper ç»è¿ååºå»ã\n\ndef decro(func):  \n    print("decro")  \n  \n    def wrapper(*args, **kwargs):  \n        print("wrapper")  \n        return func()  \n  \n    return wrapper  \n  \nprint("start")  \n  \n@decro  \ndef test():  \n    print("test")  \n  \nprint("end")\n\ntest()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè¾åºå¦ä¸ï¼å¯ä»¥çå°åæ§è¡äº startï¼ç¶åé©¬ä¸æ§è¡äºè£é¥°å¨ decroï¼ç¶ååæ§è¡ endï¼å½æä»¬è°ç¨ test å½æ°æ¶ï¼æ§è¡äºè£é¥°å¨åé¨å½æ° wrapperï¼ç¶ååè°ç¨è¢«è£é¥°çå½æ° test\n\nstart\ndecro\nend\nwrapper\ntest\n\n\n1\n2\n3\n4\n5\n\n\n\n# 1.3 ä¿å­åå½æ°ä¿¡æ¯\n\nå¨ä½¿ç¨è£é¥°å¨æ¶ï¼è°ç¨çåæ¹æ³å·²ç»è¢«æ¿æ¢ä¸ºè£é¥°å¨è¿åçæ°æ¹æ³äºï¼æä»¥æ¹æ³çåä¿¡æ¯å·²ç»è¢«æ¿æ¢äº, éè¿ nameãdoc å¾å°çåæ°æ®å·²ç»è¢«æ¿æ¢æäºæ°æ¹æ³çã\n\ndef decro(func):  \n    def wrapper(*args, **kwargs):  \n        """ wrapper doc """  \n        print("wrapper")  \n        return func(*args, **kwargs)  \n  \n    return wrapper  \n  \n  \n@decro  \ndef test():  \n    """ test doc """  \n    print("test")  \n  \n  \nprint("test\'s __name__ = {}".format(test.__name__))  \nprint("test\'s __doc__ = {}".format(test.__doc__))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nè¾åºå¦ä¸ï¼ä¼åç°å½æ° test çå½æ°ä¿¡æ¯ __name__ å __doc__ åæ wrapper çä¿¡æ¯ã\n\ntest\'s __name__ = wrapper\ntest\'s __doc__ =  wrapper doc\n\n\n1\n2\n\n\nä½æ¯æä»¬ä¸æ³è¦æ¹ååæ¹æ³çåä¿¡æ¯ï¼è¿ä¸ªæ¶åéè¦ä½¿ç¨ functools.wraps è§£å³ã\n\nfrom functools import wraps  \n  \ndef decro(func):  \n  \n    @wraps(func)  \n    def wrapper(*args, **kwargs):  \n        """ wrapper doc """  \n        print("wrapper")  \n        return func(*args, **kwargs)  \n  \n    return wrapper  \n  \n  \n@decro  \ndef test():  \n    """ test doc """  \n    print("test")  \n  \n  \nprint("test\'s __name__ = {}".format(test.__name__))  \nprint("test\'s __doc__ = {}".format(test.__doc__))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nè¾åºå¦ä¸ï¼ä¼åç°ï¼test å½æ°ä¿¡æ¯æ²¡æè¢«æ¿æ¢æï¼ä¿è¯äºå½æ°çåæ±åå³ã\n\ntest\'s __name__ = test\ntest\'s __doc__ =  test doc \n\n\n1\n2\n\n\n\n# 1.4 è°ç¨åå½æ°\n\nè£é¥°å¨å¯ä»¥å¢å¼ºå½æ°çåè½ï¼ä½æ¯å¨æäºåºæ¯æå°±æ³è¦ä½¿ç¨åå½æ°ï¼èä¸æ³ä½¿ç¨è£é¥°ä¹åçå½æ°ï¼å¯ä»¥éè¿è°ç¨__wrapped__æ¥è°ç¨åå½æ°ã\n\nfrom functools import wraps  \n  \n\ndef decro(func):  \n    @wraps(func)  \n    def wrapper(*args, **kwargs):  \n        """ wrapper doc """  \n        print("wrapper")  \n        return func(*args, **kwargs)  \n  \n    return wrapper  \n  \n  \n@decro  \ndef test():  \n    """ test doc """  \n    print("test")  \n  \n  \ntest.__wrapped__()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nè¾åºå¦ä¸ï¼è¾åº textï¼èæ²¡æè¾åº wrapperï¼è¯´æè°ç¨çæ¯åå½æ°ã\n\ntest\n\n\n1\n\n\n\n# 1.5 å¸¦åæ°çè£é¥°å¨\n\nè¿æè¿ä¹ä¸ç§åºæ¯ï¼æä»¬æ³è¦å¨è£é¥°å¨ä¸­æ·»å åæ°ã\n\næ³è¦éè¿åæ°å³å®æ¥å¿çº§å«ï¼è¿éç logged æ¥æ¶ level åæ°å¹¶å°å®ä½ç¨å¨åé¨å½æ°ä¸­ï¼è¿åå¼æ¯å° decro å½æ°è¿åï¼ç¶ååå°å½æ° test ä½ä¸ºåæ°ä»ä¼ å¥å° decro å½æ°ä¸­ï¼åå° wrapper è¿åï¼æç» test è¿æ¯æ¿æ¢æäº wrapperï¼å¨è¯¥æ¹æ³ä¸­ä½¿ç¨äºä¼ å¥ç error çæ¥å¿çº§å«ã\n\nfrom functools import wraps  \nimport logging  \n  \n  \ndef logged(level):  \n    def decro(func):  \n        @wraps(func)  \n        def wrapper(*args, **kwargs):  \n            """ wrapper doc """  \n            logging.log(level, func.__name__)  \n            return func(*args, **kwargs)  \n  \n        return wrapper  \n  \n    return decro  \n  \n  \n@logged(level=logging.error)  \ndef test():  \n    """ test doc """  \n    print("test")  \n  \n  \ntest()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nè¾åºäº error æ¥å¿çº§å«çæ¥å¿ï¼\n\nerror:root:test\ntest\n\n\n1\n2\n\n\n\n# 1.6 å¸¦å¯éåæ°çè£é¥°å¨\n\nä¸é¢å®ç°çè£é¥°å¨æ¯å¿é¡»è¦å¸¦ä¸åæ°çï¼ä½æ¯æçæ¶åï¼æä»¬ä¸éè¦å¸¦åæ°ï¼é£ä¹è¯¥å¦ä½å®ç°ï¼\n\nè£é¥°å¨ç func é»è®¤å¼ä¸º noneï¼å½ä¼ å¥ level åæ°æ¶ï¼åè¿ååå½æ° partial ï¼è¯¥å½æ°ä¼åºäº logged åå»ºä¸ä¸ªä»åå« level çæ°çå½æ°ï¼è¿ä¸ªæ°çå½æ°ä½ä¸ºæ°çè£é¥°å¨æ¥è£é¥° add å½æ°ã\n\nå½æ²¡æä¼ å¥ level åæ°æ¶ï¼å°±åæ®éçè£é¥°å¨ä¸æ ·ä½¿ç¨ã\n\nfrom functools import wraps, partial  \nimport logging  \n  \n  \ndef logged(func=none, level=logging.info):  \n    if func is none:  \n        return partial(logged, level=level)  \n  \n    @wraps(func)  \n    def wrapper(*args, **kwargs):  \n        logging.log(level, func.__name__)  \n        return func(*args, **kwargs)  \n  \n    return wrapper  \n  \n  \n@logged(level=logging.error)  \ndef add(a, b):  \n    print("add")  \n    return a + b  \n  \n  \n@logged  \ndef add2(a, b):  \n    print("add2")  \n    return a + b  \n  \n  \nprint(add(1, 2))  \nprint("-" * 10)  \nprint(add2(1, 2))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\nè¾åºå¦ä¸ï¼add å½æ°çè£é¥°å¨ä¼ å¥äºæ¥å¿çº§å«ä¸º error çåæ°ï¼è¾åºäº error çæ¥å¿ï¼èadd2 æ²¡æã\n\nerror:root:add\nadd\n3\n----------\nadd2\n3\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 1.7 å¨ç±»ä¸æ·»å è£é¥°å¨\n\nä¸é¢é½æ¯ä½¿ç¨è£é¥°å¨æ¥å¢å¼ºå½æ°çåè½ï¼ä½å®è¿å¯ä»¥å¢å¼ºç±»çåè½ï¼å¯¹ç±»è¿è¡è£é¥°ã\n\nä¸é¢çä¾å­ä¸­ï¼decro å°è¢«è£é¥°çç±» demo ä¼ å¥è¿æ¥ï¼ä¸»è¦æ¯å°å¶ç±»ä¸­ __getattribute__ æ¹æ³æ¿æ¢æäº new_getattribute æ¹æ³ã\n\ndef decro(cls):  \n    orig_getattribute = cls.__getattribute__  \n  \n    def new_getattribute(self, name):  \n        print("get name = {}".format(name))  \n        return orig_getattribute(self, name)  \n  \n    cls.__getattribute__ = new_getattribute  \n    return cls  \n  \n  \n@decro  \nclass demo:  \n  \n    def __init__(self, num):  \n        self.num = num  \n  \n  \nd = demo(1)  \nprint(d.num)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nè¾åºå¦ä¸ï¼è·å num çå¼æ¶ï¼è°ç¨äºè£é¥°å¨æ¿æ¢ç new_getattribute æ¹æ³ã\n\nget name = num\n1\n\n\n1\n2\n\n\n\n# 1.8 ç±»è£é¥°å¨\n\nä¹åé½æ¯ä½¿ç¨å½æ°æ¹æ³æ¥å®ä¹è£é¥°å¨ï¼ä½å¶å®ä¹å¯ä»¥éè¿ç±»æ¥å®ä¹è£é¥°å¨ã\n\nå¨ç±»è£é¥°å¨ä¸­å®ä¹__init__æ¹æ³ï¼è¢«å®è£é¥°çå½æ°ä¼è¢«ä¼ å¥å° func åæ°ä¸­ï¼è¿ä¸ªæ¶åè¯¥ç±»è£é¥°å¨å·²ç»è¢«å®ä¾åäºï¼ä¹å°±æ¯å°è¯¥å®ä¾å¯¹è±¡æ¿æ¢äºè¢«è£é¥°çå½æ° sayã\n\nå½æä»¬è°ç¨ say å½æ°æ¶ï¼å¶å®è°ç¨çæ¯ç±»è£é¥°å¨çå¯¹è±¡ï¼è¿ä¸ªæ¶åä¼è°ç¨__call__æ¹æ³ï¼è¯¥æ¹æ³ä¸­å¯ä»¥å¯¹åå½æ°è¿è¡å¢å¼ºï¼å¹¶è¿è¡è°ç¨åæ¹æ³ã\n\nclass logger(object):  \n    def __init__(self, func):  \n        self.func = func  \n  \n    def __call__(self, *args, **kwargs):  \n        print("the function {func}() is running...".format(func=self.func.__name__))  \n        return self.func(*args, **kwargs)  \n  \n  \n@logger  \ndef say(something):  \n    print("say {}!".format(something))  \n  \n  \nsay("hello")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè¾åºå¦ä¸ï¼\n\nthe function say() is running...\nsay hello!\n\n\n1\n2\n\n\n\n# 1.9 æ´é²è¢«è£é¥°çåä¿¡æ¯\n\nè¿ä¸ªæ¶åä¼åºç°åå½æ°è£é¥°å¨ä¸æ ·çé®é¢ï¼é£å°±æ¯è¢«è£é¥°çå½æ°çåä¿¡æ¯å·²ç»è¢«æ¿æ¢æäºï¼è¿ä¸ªæ¶åæä»¬è¿æ¯æ³ä¿çåæçåä¿¡æ¯ã\n\nè¿æ¯ä½¿ç¨ wraps å½æ°æ¥è§£å³è¯¥é®é¢ã\n\nfrom functools import wraps  \n  \n  \nclass logger(object):  \n    """ logger doc """  \n  \n    def __init__(self, func):  \n        wraps(func)(self)  \n  \n    def __call__(self, *args, **kwargs):  \n        print("the function {func}() is running...".format(func=self.__wrapped__.__name__))  \n        return self.__wrapped__(*args, **kwargs)  \n  \n  \n@logger  \ndef say(something):  \n    """ say doc """  \n    print("say {}!".format(something))  \n  \n  \nsay("hello2")  \nprint(say.__doc__)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nè¾åºçæ¯ say æ¹æ³ç docï¼\n\nthe function say() is running...\nsay hello2!\n say doc \n\n\n1\n2\n3\n\n\n\n# 1.10 å¸¦åæ°çç±»è£é¥°å¨\n\né£ä¹å¸¦åæ°çç±»è£é¥°å¨è¯¥å¦ä½å®ç°å¢ï¼\n\nå¨ __init__ æ¹æ³ä¸­æ¥æ¶è£é¥°å¨ä¼ å¥çåæ°ï¼ä¿å­èµ·æ¥ï¼ç¶ååéè¿ __call__ å½æ°å°åé¨å½æ° wrapper ç»è¿ååºå»ï¼è¿ä¸ªæ¶åè¢«è£é¥°çå½æ°å·²ç»è¢« wrapper ç»æ¿æ¢äºã\n\nclass logger(object):  \n  \n    def __init__(self, level="info"):  \n        self.level = level  \n  \n    def __call__(self, func):  \n        def wrapper(*args, **kwargs): \n\t        print("[{level}]: the function {func}() is running...".format(level=self.level, func=func.__name__)) \n            func(*args, **kwargs)  \n  \n        return wrapper  \n  \n  \n@logger(level="error")  \ndef say(something):  \n    print("say {}!".format(something))  \n  \n  \nsay("hello2")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nè¾åºå¦ä¸ï¼è°ç¨ say å½æ°ä¹å°±æ¯è°ç¨ wrapper å½æ°ï¼\n\n[error]: the function say() is running...\nsay hello2!\n\n\n1\n2\n\n\n\n# 2. æ»ç»\n\nè£é¥°å¨çç¨æ³å¾å¤ï¼å°è£æåºï¼ç»å¶ä»äººä½¿ç¨ä¹éå¸¸çæ¹ä¾¿ï¼æä»¬éè¦çè§£å®çè¿è¡è¿ç¨ï¼æè½æ´å¥½çä½¿ç¨å®ã\n\n\n# 3. åèèµæ\n\n * https://python3-cookbook.readthedocs.io/zh_cn/latest/c09/p01_put_wrapper_around_function.html',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"pythonä¸­importåç",frontmatter:{title:"pythonä¸­importåç",date:"2023-02-07T09:34:33.000Z",permalink:"/pages/d8fd49/",categories:["ç¼ç¨","python","åºç¡"],tags:["python"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä»ç»pythonæ­£å¨import moduleæ¶åäºä»ä¹ï¼å®åæ¯å¦ä½å è½½moduleçã",comment:!0,feed:{enable:!0},meta:[{name:"twitter:title",content:"pythonä¸­importåç"},{name:"twitter:description",content:"æ¬æä»ç»pythonæ­£å¨import moduleæ¶åäºä»ä¹ï¼å®åæ¯å¦ä½å è½½moduleçã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/07.python%E4%B8%ADimport%E5%8E%9F%E7%90%86.html"},{property:"og:type",content:"article"},{property:"og:title",content:"pythonä¸­importåç"},{property:"og:description",content:"æ¬æä»ç»pythonæ­£å¨import moduleæ¶åäºä»ä¹ï¼å®åæ¯å¦ä½å è½½moduleçã"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/07.python%E4%B8%ADimport%E5%8E%9F%E7%90%86.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-02-07T09:34:33.000Z"},{property:"article:tag",content:"python"},{itemprop:"name",content:"pythonä¸­importåç"},{itemprop:"description",content:"æ¬æä»ç»pythonæ­£å¨import moduleæ¶åäºä»ä¹ï¼å®åæ¯å¦ä½å è½½moduleçã"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/01.%E5%9F%BA%E7%A1%80/07.python%E4%B8%ADimport%E5%8E%9F%E7%90%86.html",relativePath:"04.ç¼ç¨/01.python/01.åºç¡/07.pythonä¸­importåç.md",key:"v-0e418e98",path:"/pages/d8fd49/",headers:[{level:2,title:"0. åè¨",slug:"_0-åè¨",normalizedTitle:"0. åè¨",charIndex:2},{level:2,title:"1. ä»ä¹æ¯ moduleï¼",slug:"_1-ä»ä¹æ¯-module",normalizedTitle:"1. ä»ä¹æ¯ moduleï¼",charIndex:84},{level:2,title:"2. ä»ä¹æ¯ Package?",slug:"_2-ä»ä¹æ¯-package",normalizedTitle:"2. ä»ä¹æ¯ package?",charIndex:471},{level:2,title:"3. module ç¼å­",slug:"_3-module-ç¼å­",normalizedTitle:"3. module ç¼å­",charIndex:1510},{level:2,title:"4. æç´¢è·¯å¾",slug:"_4-æç´¢è·¯å¾",normalizedTitle:"4. æç´¢è·¯å¾",charIndex:4108},{level:2,title:"5. æ»ç»",slug:"_5-æ»ç»",normalizedTitle:"5. æ»ç»",charIndex:4366},{level:2,title:"6. å å¥è¾è®¯äºå¼åèç¤¾åº",slug:"_6-å å¥è¾è®¯äºå¼åèç¤¾åº",normalizedTitle:"6. å å¥è¾è®¯äºå¼åèç¤¾åº",charIndex:4527}],headersStr:"0. åè¨ 1. ä»ä¹æ¯ moduleï¼ 2. ä»ä¹æ¯ Package? 3. module ç¼å­ 4. æç´¢è·¯å¾ 5. æ»ç» 6. å å¥è¾è®¯äºå¼åèç¤¾åº",content:"# 0. åè¨\n\nå¨ python ä¸­å¼å¥ Module æ¯åå¸¸è§ä¸è¿äºï¼é£ä¹å½æä»¬ import æ¶å®åäºä»ä¹äºæå¢ï¼å®æ¯å¦ä½å è½½ Module ä½¿ç¨çå¢ï¼\n\n\n# 1. ä»ä¹æ¯ moduleï¼\n\nä¸è¬ï¼Module æ¯ä¸ä¸ªåç¼ä¸º .py çæä»¶ï¼å¶ module åç§°ä¸è¬æ¯æä»¶åç§°å»é¤ .pyï¼æä»¬å¯ä»¥éè¿ __name__ æ¥æ¥ç module åç§°ã\n\ndemo.py æ¯éè¦è¢«å¼å¥ç moduleï¼main.py æ¯å¥å£ç¨åºï¼å®ä»¬å¨åä¸çº§ç®å½ã\n\n# demo.py\nprint(__name__)\n\n# main.py\nimport demo\n\n>>> python main.py\ndemo\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¦æ module ä¸ºå¥å£æä»¶ï¼å__name__ä¸º __main__ï¼è¿ä¹æ¯å¸¸è§ if __name__ == __main__: çåæ³ç±æ¥ã\n\n# demo.py\nprint(__name__)\n\n>>> python demo.py\n__main__\n\n\n1\n2\n3\n4\n5\n\n\n\n# 2. ä»ä¹æ¯ Package?\n\nåå«äº __init__ æä»¶çç®å½ä¸º Packageï¼è¯¥ç®å½åå«å¤ä¸ª py æä»¶ï¼é½å±äº Moduleãæä»¬å¨ import package æ¶ï¼ä¼åå§åæ§è¡ package ç __init__.py æä»¶ï¼ç¶åå°å¶ä½ä¸ºä¸ä¸ª Module å¯¹è±¡ç»æ¾å¨å½åçå¨å±åéä¸­ã\n\nââââdemo\nâ   â   __init__.py\n|   main.py\n\n\n1\n2\n3\n\n\n# __init__.py\nprint(\"demo __init__\")\n\n# main.py\nimport demo\nprint(demo)\nprint(globals()[\"demo\"])\n\n>>> python main.py\noutput: \ndemo __init__.py\n<module 'demo' from 'D:\\\\code\\\\my_demo\\\\demo\\\\__init__.py'>\n<module 'demo' from 'D:\\\\code\\\\my_demo\\\\demo\\\\__init__.py'>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nå¯ä»¥çå° package çåç§° demo æ¯å¨ globals()ä¸­çï¼å¹¶ä¸å¶æ¯ä¸ä¸ª module å¯¹è±¡ï¼åå«äºè¯¥ __init__.py æä»¶æå¨çè·¯å¾ã\n\nå¦ææ³è¦å¯¼å¥ package ä¸ç moduleï¼å¯ä»¥éè¿ from package import module çæ¹å¼å°å¶å è½½å°å½åçå¨å±åéä¸­ã\n\nââââdemo\nâ   â   __init__.py\n|   |   a.py\n|   main.py\n\n\n1\n2\n3\n4\n\n\n# __init__.py\n\n# a.py\nclass Demo:\n\tpass\n\n# main.py\nfrom demo import a\nprint(a)\nprint(a.Demo)\nprint(globals()[\"a\"])\n\n>>> python main.py\n<module 'demo.a' from 'D:\\\\code\\\\my_demo\\\\demo\\\\a.py'>\n<class 'demo.a.Demo'>\n<module 'demo.a' from 'D:\\\\code\\\\my_demo\\\\demo\\\\a.py'>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n\n# 3. module ç¼å­\n\n * module ç¼å­åå§å\n\nå¨ python ç¨åºåå§åæ¶ï¼ä¼å°å¤§æ¹çåç½® module æåå è½½å°åå­ä¸­ï¼ä¿å­å¨ sys.modules ä¸­ï¼è¿æ¯ä¸ä¸ªå­å¸ï¼æ¯ä»¥ module åç§°æè package åç§°ä¸º keyï¼module å¯¹è±¡ä¸º value å­å¨ã\n\n>>> import sys\n>>> sys.modules\n{... 'os': <module 'os' from '/usr/lib64/python3.6/os.py'> ...}\n>>> sys.modules[\"os\"].cpu_count()\n8\n>>> os.cpu_count()\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nNameError: name 'os' is not defined\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n * å° module æ·»å å°å½åå»å¨å±åéä¸­\n\næ¢ç¶æåå è½½äºï¼ä½æ¯è¿éä¸ºä»ä¹æ¾ä¸å° os å¢ï¼è¿æ¯å ä¸ºè½ç¶ sys.modules ä¸­å·²ç»å­å¨äºï¼ä½æ¯å¹¶æ²¡ææ os å å¥å°å½åçå¨å±åéä¸­ã\n\n>>> globals()[\"os\"]\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nKeyError: 'os'\n\n\n1\n2\n3\n4\n\n\næä»¥å½æä»¬éè¿ import os æ¶ï¼å®ä¼éè¿æ¨¡ååç§°å¨ sys.modules æ¾å°å¶ module å¯¹è±¡ï¼ç¶ååå°å¶å å¥å°å½åçå¨å±åéä¸­ï¼è¿æ ·å°±å¯ä»¥ä½¿ç¨å®äºã\n\n>>> import os\n>>> globals()[\"os\"]\n<module 'os' from '/usr/lib64/python3.6/os.py'>\n>>> os.cpu_count()\n8\n>>> id(sys.modules[\"os\"])\n140260375998856\n>>> id(os)\n140260375998856\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¯ä»¥çå°ä» sys.modules ä¸­æ¿å°ç os å¯¹è±¡çå°ååå½åå¯¼å¥ç os çå°åæ¯ä¸è´çï¼æ è®º import å¤å°æ¬¡ç¸åç moduleï¼é½æ¯ä»è¯¥å¨å± sys.modules ä¸­è·åï¼æ¿å°çé½æ¯åä¸ä¸ªå¯¹è±¡ï¼ä¹æ¯åä¾æ¨¡å¼å®ç°çä¸ç§ã\n\n * å¯¼å¥ module ä¸­çå±æ§\n\nå¦ææåªæ¯å¼å¥ module ä¸­çä¸ä¸ªå±æ§åéå¢ï¼é£ sys.modules ä¸­è¿æ¯ä¼å è½½è¯¥ moduleï¼å°å¶å±æ§åéä½ä¸ºå¨å±åéå¼å¥ã\n\n>>> import sys\n>>> sys.modules[\"json\"]\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nKeyError: 'json'\n>>> from json import load\n>>> sys.modules[\"json\"]\n<module 'json' from '/usr/lib64/python3.6/json/__init__.py'>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * æ¨¡åä¸éè¦äºï¼del éæ¯\n\ndel éæ¯çåªæ¯éæ¯å½åå¨å±åéä¸­çåéï¼å¹¶ä¸ä¼å½±å sys.modules ä¸­çç¼å­ãä¸ºä»ä¹ä¸éæ¯ sys.modules ä¸­çå¢ï¼æ¯å ä¸ºè¯¥éæ¯ç module å¯è½è¿ä¼å¨å¶ä»çæä»¶ä¸­å¼ç¨ã\n\n>>> import json\n>>> import sys\n>>> sys.modules[\"json\"]\n<module 'json' from '/usr/lib64/python3.6/json/__init__.py'>\n>>> globals()[\"json\"]\n<module 'json' from '/usr/lib64/python3.6/json/__init__.py'>\n>>> del json\n>>> sys.modules[\"json\"]\n<module 'json' from '/usr/lib64/python3.6/json/__init__.py'>\n>>> globals()[\"json\"]\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nKeyError: 'json'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n * module éæ°å è½½\n\nå ä¸ºæ¯æ¬¡ import é½æ¯ä» sys.modules çç¼å­ä¸­è·åï¼é£ä¹å¦æ module æä»¶åå¨ï¼åæ æ³æ¿å°ææ°ç moduleï¼è¿ä¸ªæ¶åéè¦éè¿æå¨è°ç¨ importlib.reload æ¥éæ°å è½½ï¼ä»æ¬å°æä»¶ä¸­éæ°å è½½ module å¯¹è±¡å° sys.modules ä¸­ã\n\nå¨å½åç®å½ä¸åå»º demo.py æä»¶ï¼åå®¹ä¸ºç©º\n\n# demo.py\n\n>>> import demo\n>>> demo.Demo\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nAttributeError: module 'demo' has no attribute 'Demo'\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¿ä¸ªæ¶åå¨ demo.py ä¸­æ·»å ï¼\n\nclass Demo:\n    pass\n\n\n1\n2\n\n\nreload demo åï¼å¯ä»¥çå°å è½½å° Demo äºã\n\n>>> reload(demo)\n<module 'demo' from '/root/work/mydemo/demo.py'>\n>>> demo.Demo\n<class 'demo.Demo'>\n\n\n1\n2\n3\n4\n\n\né£å¦æ import ç module æè package æ²¡æå¨ sys.modules ä¸­å¢ï¼è¿ä¸ªæ¶åå°±è¦å» sys.path ä¸­å»æ¬å°æç´¢äºã\n\n\n# 4. æç´¢è·¯å¾\n\nsys.path æ¯ä¸ä¸ªåè¡¨ï¼å¶ä¸­åå«äºè¦å»æç´¢ module çæ¬å°è·¯å¾ãå½ sys.modules ä¸­æ¥æ¾ä¸å° module æ¶ï¼å°ä¼ä»è¯¥è·¯å¾ä¸­æç´¢å° module æä»¶å¹¶å°å¶å è½½å° sys.modules ä¸­æ¥ã\n\nsys.path çè·¯å¾çæ¥æºæï¼\n\n * è¿è¡èæ¬æå¨çç®å½\n * PYTHONPATH ç¯å¢åé\n * python å®è£æ¶çé»è®¤è®¾ç½®\n\nå½å¨æç´¢è·¯å¾æ¾å°è¯¥ module çæ¬å°è·¯å¾åï¼ä¼å°å¶å è½½å° sys.modules ä¸­ï¼ç¶ååå°å¶æ·»å å°å½åçå¨å±åéä¸­ã\n\n\n# 5. æ»ç»\n\nimport çå è½½è¿ç¨ï¼\n\n 1. åä» sys.modules ä¸­æ¥çæ¯å¦æå¯¼å¥çæ¨¡åï¼æï¼åè·åè¯¥æ¨¡åï¼å¹¶å å¥å°å½åçå¨å±åéä¸­ã\n 2. å¦æ sys.modules ä¸­æ²¡æéè¦å¯¼å¥çæ¨¡åï¼åæç§ sys.path ä¸­çç®å½è·¯å¾è¿è¡æç´¢æ¾å°å¯¹åºçæ¨¡åæä»¶åå è½½å° module å¯¹è±¡ä¸­è¿åã\n\n\n# 6. å å¥è¾è®¯äºå¼åèç¤¾åº\n\næçåå®¢å³å°åæ­¥è³è¾è®¯äºå¼åèç¤¾åºï¼éè¯·å¤§å®¶ä¸åå¥é©»ï¼https://cloud.tencent.com/developer/support-plan?invite_code=3u3wcswfaeiok",normalizedContent:"# 0. åè¨\n\nå¨ python ä¸­å¼å¥ module æ¯åå¸¸è§ä¸è¿äºï¼é£ä¹å½æä»¬ import æ¶å®åäºä»ä¹äºæå¢ï¼å®æ¯å¦ä½å è½½ module ä½¿ç¨çå¢ï¼\n\n\n# 1. ä»ä¹æ¯ moduleï¼\n\nä¸è¬ï¼module æ¯ä¸ä¸ªåç¼ä¸º .py çæä»¶ï¼å¶ module åç§°ä¸è¬æ¯æä»¶åç§°å»é¤ .pyï¼æä»¬å¯ä»¥éè¿ __name__ æ¥æ¥ç module åç§°ã\n\ndemo.py æ¯éè¦è¢«å¼å¥ç moduleï¼main.py æ¯å¥å£ç¨åºï¼å®ä»¬å¨åä¸çº§ç®å½ã\n\n# demo.py\nprint(__name__)\n\n# main.py\nimport demo\n\n>>> python main.py\ndemo\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¦æ module ä¸ºå¥å£æä»¶ï¼å__name__ä¸º __main__ï¼è¿ä¹æ¯å¸¸è§ if __name__ == __main__: çåæ³ç±æ¥ã\n\n# demo.py\nprint(__name__)\n\n>>> python demo.py\n__main__\n\n\n1\n2\n3\n4\n5\n\n\n\n# 2. ä»ä¹æ¯ package?\n\nåå«äº __init__ æä»¶çç®å½ä¸º packageï¼è¯¥ç®å½åå«å¤ä¸ª py æä»¶ï¼é½å±äº moduleãæä»¬å¨ import package æ¶ï¼ä¼åå§åæ§è¡ package ç __init__.py æä»¶ï¼ç¶åå°å¶ä½ä¸ºä¸ä¸ª module å¯¹è±¡ç»æ¾å¨å½åçå¨å±åéä¸­ã\n\nââââdemo\nâ   â   __init__.py\n|   main.py\n\n\n1\n2\n3\n\n\n# __init__.py\nprint(\"demo __init__\")\n\n# main.py\nimport demo\nprint(demo)\nprint(globals()[\"demo\"])\n\n>>> python main.py\noutput: \ndemo __init__.py\n<module 'demo' from 'd:\\\\code\\\\my_demo\\\\demo\\\\__init__.py'>\n<module 'demo' from 'd:\\\\code\\\\my_demo\\\\demo\\\\__init__.py'>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nå¯ä»¥çå° package çåç§° demo æ¯å¨ globals()ä¸­çï¼å¹¶ä¸å¶æ¯ä¸ä¸ª module å¯¹è±¡ï¼åå«äºè¯¥ __init__.py æä»¶æå¨çè·¯å¾ã\n\nå¦ææ³è¦å¯¼å¥ package ä¸ç moduleï¼å¯ä»¥éè¿ from package import module çæ¹å¼å°å¶å è½½å°å½åçå¨å±åéä¸­ã\n\nââââdemo\nâ   â   __init__.py\n|   |   a.py\n|   main.py\n\n\n1\n2\n3\n4\n\n\n# __init__.py\n\n# a.py\nclass demo:\n\tpass\n\n# main.py\nfrom demo import a\nprint(a)\nprint(a.demo)\nprint(globals()[\"a\"])\n\n>>> python main.py\n<module 'demo.a' from 'd:\\\\code\\\\my_demo\\\\demo\\\\a.py'>\n<class 'demo.a.demo'>\n<module 'demo.a' from 'd:\\\\code\\\\my_demo\\\\demo\\\\a.py'>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n\n# 3. module ç¼å­\n\n * module ç¼å­åå§å\n\nå¨ python ç¨åºåå§åæ¶ï¼ä¼å°å¤§æ¹çåç½® module æåå è½½å°åå­ä¸­ï¼ä¿å­å¨ sys.modules ä¸­ï¼è¿æ¯ä¸ä¸ªå­å¸ï¼æ¯ä»¥ module åç§°æè package åç§°ä¸º keyï¼module å¯¹è±¡ä¸º value å­å¨ã\n\n>>> import sys\n>>> sys.modules\n{... 'os': <module 'os' from '/usr/lib64/python3.6/os.py'> ...}\n>>> sys.modules[\"os\"].cpu_count()\n8\n>>> os.cpu_count()\ntraceback (most recent call last):\n  file \"<stdin>\", line 1, in <module>\nnameerror: name 'os' is not defined\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n * å° module æ·»å å°å½åå»å¨å±åéä¸­\n\næ¢ç¶æåå è½½äºï¼ä½æ¯è¿éä¸ºä»ä¹æ¾ä¸å° os å¢ï¼è¿æ¯å ä¸ºè½ç¶ sys.modules ä¸­å·²ç»å­å¨äºï¼ä½æ¯å¹¶æ²¡ææ os å å¥å°å½åçå¨å±åéä¸­ã\n\n>>> globals()[\"os\"]\ntraceback (most recent call last):\n  file \"<stdin>\", line 1, in <module>\nkeyerror: 'os'\n\n\n1\n2\n3\n4\n\n\næä»¥å½æä»¬éè¿ import os æ¶ï¼å®ä¼éè¿æ¨¡ååç§°å¨ sys.modules æ¾å°å¶ module å¯¹è±¡ï¼ç¶ååå°å¶å å¥å°å½åçå¨å±åéä¸­ï¼è¿æ ·å°±å¯ä»¥ä½¿ç¨å®äºã\n\n>>> import os\n>>> globals()[\"os\"]\n<module 'os' from '/usr/lib64/python3.6/os.py'>\n>>> os.cpu_count()\n8\n>>> id(sys.modules[\"os\"])\n140260375998856\n>>> id(os)\n140260375998856\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¯ä»¥çå°ä» sys.modules ä¸­æ¿å°ç os å¯¹è±¡çå°ååå½åå¯¼å¥ç os çå°åæ¯ä¸è´çï¼æ è®º import å¤å°æ¬¡ç¸åç moduleï¼é½æ¯ä»è¯¥å¨å± sys.modules ä¸­è·åï¼æ¿å°çé½æ¯åä¸ä¸ªå¯¹è±¡ï¼ä¹æ¯åä¾æ¨¡å¼å®ç°çä¸ç§ã\n\n * å¯¼å¥ module ä¸­çå±æ§\n\nå¦ææåªæ¯å¼å¥ module ä¸­çä¸ä¸ªå±æ§åéå¢ï¼é£ sys.modules ä¸­è¿æ¯ä¼å è½½è¯¥ moduleï¼å°å¶å±æ§åéä½ä¸ºå¨å±åéå¼å¥ã\n\n>>> import sys\n>>> sys.modules[\"json\"]\ntraceback (most recent call last):\n  file \"<stdin>\", line 1, in <module>\nkeyerror: 'json'\n>>> from json import load\n>>> sys.modules[\"json\"]\n<module 'json' from '/usr/lib64/python3.6/json/__init__.py'>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * æ¨¡åä¸éè¦äºï¼del éæ¯\n\ndel éæ¯çåªæ¯éæ¯å½åå¨å±åéä¸­çåéï¼å¹¶ä¸ä¼å½±å sys.modules ä¸­çç¼å­ãä¸ºä»ä¹ä¸éæ¯ sys.modules ä¸­çå¢ï¼æ¯å ä¸ºè¯¥éæ¯ç module å¯è½è¿ä¼å¨å¶ä»çæä»¶ä¸­å¼ç¨ã\n\n>>> import json\n>>> import sys\n>>> sys.modules[\"json\"]\n<module 'json' from '/usr/lib64/python3.6/json/__init__.py'>\n>>> globals()[\"json\"]\n<module 'json' from '/usr/lib64/python3.6/json/__init__.py'>\n>>> del json\n>>> sys.modules[\"json\"]\n<module 'json' from '/usr/lib64/python3.6/json/__init__.py'>\n>>> globals()[\"json\"]\ntraceback (most recent call last):\n  file \"<stdin>\", line 1, in <module>\nkeyerror: 'json'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n * module éæ°å è½½\n\nå ä¸ºæ¯æ¬¡ import é½æ¯ä» sys.modules çç¼å­ä¸­è·åï¼é£ä¹å¦æ module æä»¶åå¨ï¼åæ æ³æ¿å°ææ°ç moduleï¼è¿ä¸ªæ¶åéè¦éè¿æå¨è°ç¨ importlib.reload æ¥éæ°å è½½ï¼ä»æ¬å°æä»¶ä¸­éæ°å è½½ module å¯¹è±¡å° sys.modules ä¸­ã\n\nå¨å½åç®å½ä¸åå»º demo.py æä»¶ï¼åå®¹ä¸ºç©º\n\n# demo.py\n\n>>> import demo\n>>> demo.demo\ntraceback (most recent call last):\n  file \"<stdin>\", line 1, in <module>\nattributeerror: module 'demo' has no attribute 'demo'\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¿ä¸ªæ¶åå¨ demo.py ä¸­æ·»å ï¼\n\nclass demo:\n    pass\n\n\n1\n2\n\n\nreload demo åï¼å¯ä»¥çå°å è½½å° demo äºã\n\n>>> reload(demo)\n<module 'demo' from '/root/work/mydemo/demo.py'>\n>>> demo.demo\n<class 'demo.demo'>\n\n\n1\n2\n3\n4\n\n\né£å¦æ import ç module æè package æ²¡æå¨ sys.modules ä¸­å¢ï¼è¿ä¸ªæ¶åå°±è¦å» sys.path ä¸­å»æ¬å°æç´¢äºã\n\n\n# 4. æç´¢è·¯å¾\n\nsys.path æ¯ä¸ä¸ªåè¡¨ï¼å¶ä¸­åå«äºè¦å»æç´¢ module çæ¬å°è·¯å¾ãå½ sys.modules ä¸­æ¥æ¾ä¸å° module æ¶ï¼å°ä¼ä»è¯¥è·¯å¾ä¸­æç´¢å° module æä»¶å¹¶å°å¶å è½½å° sys.modules ä¸­æ¥ã\n\nsys.path çè·¯å¾çæ¥æºæï¼\n\n * è¿è¡èæ¬æå¨çç®å½\n * pythonpath ç¯å¢åé\n * python å®è£æ¶çé»è®¤è®¾ç½®\n\nå½å¨æç´¢è·¯å¾æ¾å°è¯¥ module çæ¬å°è·¯å¾åï¼ä¼å°å¶å è½½å° sys.modules ä¸­ï¼ç¶ååå°å¶æ·»å å°å½åçå¨å±åéä¸­ã\n\n\n# 5. æ»ç»\n\nimport çå è½½è¿ç¨ï¼\n\n 1. åä» sys.modules ä¸­æ¥çæ¯å¦æå¯¼å¥çæ¨¡åï¼æï¼åè·åè¯¥æ¨¡åï¼å¹¶å å¥å°å½åçå¨å±åéä¸­ã\n 2. å¦æ sys.modules ä¸­æ²¡æéè¦å¯¼å¥çæ¨¡åï¼åæç§ sys.path ä¸­çç®å½è·¯å¾è¿è¡æç´¢æ¾å°å¯¹åºçæ¨¡åæä»¶åå è½½å° module å¯¹è±¡ä¸­è¿åã\n\n\n# 6. å å¥è¾è®¯äºå¼åèç¤¾åº\n\næçåå®¢å³å°åæ­¥è³è¾è®¯äºå¼åèç¤¾åºï¼éè¯·å¤§å®¶ä¸åå¥é©»ï¼https://cloud.tencent.com/developer/support-plan?invite_code=3u3wcswfaeiok",charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"ä½¿ç¨ddtå®ç°unittestçåæ°åæµè¯",frontmatter:{title:"ä½¿ç¨ddtå®ç°unittestçåæ°åæµè¯",date:"2022-10-12T14:48:10.000Z",permalink:"/pages/8d9ab9/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä»ç»å¦ä½ä½¿ç¨ddtåºæ¥å®æunitestçåæ°åè®¾ç½®ã",feed:{enable:!0},tags:["python"],categories:["ç¼ç¨","python","ç¬¬ä¸æ¹åº"],comment:!0,meta:[{name:"twitter:title",content:"ä½¿ç¨ddtå®ç°unittestçåæ°åæµè¯"},{name:"twitter:description",content:"æ¬æä»ç»å¦ä½ä½¿ç¨ddtåºæ¥å®æunitestçåæ°åè®¾ç½®ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/02.%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/01.%E4%BD%BF%E7%94%A8ddt%E5%AE%9E%E7%8E%B0unittest%E7%9A%84%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ä½¿ç¨ddtå®ç°unittestçåæ°åæµè¯"},{property:"og:description",content:"æ¬æä»ç»å¦ä½ä½¿ç¨ddtåºæ¥å®æunitestçåæ°åè®¾ç½®ã"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/02.%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/01.%E4%BD%BF%E7%94%A8ddt%E5%AE%9E%E7%8E%B0unittest%E7%9A%84%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-10-12T14:48:10.000Z"},{property:"article:tag",content:"python"},{itemprop:"name",content:"ä½¿ç¨ddtå®ç°unittestçåæ°åæµè¯"},{itemprop:"description",content:"æ¬æä»ç»å¦ä½ä½¿ç¨ddtåºæ¥å®æunitestçåæ°åè®¾ç½®ã"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/02.%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/01.%E4%BD%BF%E7%94%A8ddt%E5%AE%9E%E7%8E%B0unittest%E7%9A%84%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95.html",relativePath:"04.ç¼ç¨/01.python/02.ç¬¬ä¸æ¹åº/01.ä½¿ç¨ddtå®ç°unittestçåæ°åæµè¯.md",key:"v-208228f3",path:"/pages/8d9ab9/",headers:[{level:2,title:"0. åè¨",slug:"_0-åè¨",normalizedTitle:"0. åè¨",charIndex:2},{level:2,title:"1. ä¸ºä»ä¹éè¦åæ°å",slug:"_1-ä¸ºä»ä¹éè¦åæ°å",normalizedTitle:"1. ä¸ºä»ä¹éè¦åæ°å",charIndex:67},{level:2,title:"2. ä½¿ç¨ddtå®ç°åæ°å",slug:"_2-ä½¿ç¨ddtå®ç°åæ°å",normalizedTitle:"2. ä½¿ç¨ddtå®ç°åæ°å",charIndex:677},{level:3,title:"2.1 åºæ¬ä½¿ç¨",slug:"_2-1-åºæ¬ä½¿ç¨",normalizedTitle:"2.1 åºæ¬ä½¿ç¨",charIndex:733},{level:3,title:"2.2 å¤ä¸ªå¼ä½¿ç¨åæ°å",slug:"_2-2-å¤ä¸ªå¼ä½¿ç¨åæ°å",normalizedTitle:"2.2 å¤ä¸ªå¼ä½¿ç¨åæ°å",charIndex:1735},{level:3,title:"2.3 åæ°åæå¹³ä½¿ç¨",slug:"_2-3-åæ°åæå¹³ä½¿ç¨",normalizedTitle:"2.3 åæ°åæå¹³ä½¿ç¨",charIndex:2586},{level:3,title:"2.4 å½ååæ°",slug:"_2-4-å½ååæ°",normalizedTitle:"2.4 å½ååæ°",charIndex:3419},{level:3,title:"2.5 ä»jsonæä»¶ä¸­è¯»ååæ°è¿è¡åæµ",slug:"_2-5-ä»jsonæä»¶ä¸­è¯»ååæ°è¿è¡åæµ",normalizedTitle:"2.5 ä»jsonæä»¶ä¸­è¯»ååæ°è¿è¡åæµ",charIndex:4254},{level:2,title:"3. æ»ç»",slug:"_3-æ»ç»",normalizedTitle:"3. æ»ç»",charIndex:5266}],headersStr:"0. åè¨ 1. ä¸ºä»ä¹éè¦åæ°å 2. ä½¿ç¨ddtå®ç°åæ°å 2.1 åºæ¬ä½¿ç¨ 2.2 å¤ä¸ªå¼ä½¿ç¨åæ°å 2.3 åæ°åæå¹³ä½¿ç¨ 2.4 å½ååæ° 2.5 ä»jsonæä»¶ä¸­è¯»ååæ°è¿è¡åæµ 3. æ»ç»",content:'# 0. åè¨\n\næ¬æä»ç»å¦ä½ä½¿ç¨ddtåºæ¥å®æunitestçåæ°åè®¾ç½®ã\n\nddtçgithubå°å\n\nddtçå®æ¹ææ¡£\n\n\n# 1. ä¸ºä»ä¹éè¦åæ°å\n\næä»¬å¨ååæµä¸­ï¼éè¦èèå°åç§åºæ¯ï¼éè¿è¾å¥åç§åºæ¯çå¼æ§è¡ç®ççæ¹æ³ï¼æ¥å¤æ­è¾åºæ¯å¦æ¯æä»¬ææå¾çå¼ã\n\nå¦ä¸ä»£ç ä»£ç æç¤ºï¼éå¯¹large_than_twoæ¹æ³è¿è¡äºä¸ç§åºæ¯çæ ¡éªåäºä¸ä¸ªåæµï¼ä½å¶ä¸­é»è¾ä»£ç æ¯ä¸è´çï¼èåªéè¦ä½¿ç¨ä¸åçåæ°å¼è¿è¡è¾å¥ï¼å¯¼è´æè®¸å¤çéå¤ä»£ç è¿è¡å¤å¶ç²è´´ã\n\nfrom unittest.case import TestCase\n\n\ndef large_than_two(value) -> bool:\n    return value > 2\n\n\nclass TestDemoCase(TestCase):\n\n    def test_larger_than_two_with_three(self):\n        self.assertTrue(large_than_two(3))\n\n    def test_larger_than_two_with_eight(self):\n        self.assertTrue(large_than_two(8))\n\n    def test_larger_than_two_with_five(self):\n        self.assertFalse(large_than_two(5))\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# 2. ä½¿ç¨ddtå®ç°åæ°å\n\né¦åéè¦éè¿pipæ¥å®è£è¯¥åº\n\npip install ddt\n\n\n1\n\n\n\n# 2.1 åºæ¬ä½¿ç¨\n\næä»¬å¨TestCaseä¸æ·»å ddtè£é¥°å¨ï¼ç¶åå¨åæµæ¹æ³ä¸æ·»å dataè£é¥°å¨ï¼å¹¶æ·»å äº3ç§åºæ¯çè¾å¥åæ°ï¼å¦ä¸ä»£ç æç¤ºï¼\n\nfrom unittest.case import TestCase\n\nfrom ddt import ddt, data\n\n\ndef large_than_two(value) -> bool:\n    return value > 2\n\n\n@ddt\nclass TestDemoCase(TestCase):\n\n    @data(3, 8, 5)\n    def test_larger_than_two(self, value):\n        self.assertTrue(large_than_two(value))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\næ§è¡ä¸é¢çåæµï¼è¾å¥åºå¦ä¸ï¼\n\n============================= test session starts =============================\ncollecting ... collected 3 items\n\ntest_demo.py::TestDemoCase::test_larger_than_two_with_three_1_3 PASSED   [ 33%]\ntest_demo.py::TestDemoCase::test_larger_than_two_with_three_2_8 PASSED   [ 66%]\ntest_demo.py::TestDemoCase::test_larger_than_two_with_three_3_5 PASSED   [100%]\n\n============================== 3 passed in 0.02s ==============================\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nä¼åç°ï¼è½ç¶æä»¬åäºä¸ä¸ªåæµç¨ä¾ï¼ä½æ¯å´æ§è¡äº3ä¸ªç¨ä¾ï¼è¿æ¯å ä¸ºddtä¼å°dataç3ä¸ªåæ°åå«æ³¨å¥å°test_larger_than_twoæ¹æ³ä¸­valueä¸­å¹¶æ§è¡åæµã\n\nå¨è¾åºçåæµä¿¡æ¯ä¸­ï¼ä¼è¾åºåæµæ¹æ³+ç¬¬å¤å°ä¸ªåæµ+åæ°å¼æ¥è¡¨ç¤ºå½åç¨ä¾çæ§è¡ã\n\néè¿è¿ç§æ¹å¼å¯ä»¥åå°æä»¬çéå¤ä»£ç ã\n\n\n# 2.2 å¤ä¸ªå¼ä½¿ç¨åæ°å\n\nå½æä»¬éè¦å¨ä¸ä¸ªåæµç¨ä¾ä¸­æ³¨å¥å¤ä¸ªå¼æ¶ï¼å¯ä»¥å¨dataä¸­ä¼ å¥å¤ä¸ªåç»è¿è¡åæ°åï¼ä½æ§è¡åä¾æ¶ï¼ä¼å°åç»æ³¨å¥å°valueä¸­ï¼æä»¬å°å¶è§£å¼åè½æ¿å°å¤ä¸ªå¼ãä»£ç å¦ä¸å¾æç¤ºï¼\n\ndef greater(v1, v2) -> bool:\n    return v1 > v2\n\n\n@ddt\nclass TestDemoCase(TestCase):\n\n    @data(\n        (3, 2),\n        (4, 1),\n        (8, 6))\n    def test_greater(self, value):\n        v1, v2 = value\n        self.assertTrue(greater(v1, v2))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ§è¡ä¹åè¾åºå¦ä¸æç¤ºï¼\n\n============================= test session starts =============================\ncollecting ... collected 3 items\n\ntest_demo.py::TestDemoCase::test_greater_1__3__2_ PASSED                 [ 33%]\ntest_demo.py::TestDemoCase::test_greater_2__4__1_ PASSED                 [ 66%]\ntest_demo.py::TestDemoCase::test_greater_3__8__6_ PASSED                 [100%]\n\n============================== 3 passed in 0.02s ==============================\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 2.3 åæ°åæå¹³ä½¿ç¨\n\nåç»ä¸­çæ°æ®å¯ä»¥ç±ddtè§£å¼åæ³¨å¥å°åæµæ¹æ³ä¸­çåæ°ä¸­ãåªéè¦å¨åæµæ¹æ³é±æ·»å unpackè£é¥°å¨å³å¯ãä»£ç å¦ä¸æç¤ºï¼\n\nfrom unittest.case import TestCase\n\nfrom ddt import ddt, data, unpack\n\n@ddt\nclass TestDemoCase(TestCase):\n\n    @unpack\n    @data(\n        (3, 2),\n        (4, 1),\n        (8, 6))\n    def test_greater(self, v1, v2):\n        self.assertTrue(greater(v1, v2))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ§è¡åç»æå¦ä¸ï¼\n\n============================= test session starts =============================\ncollecting ... collected 3 items\n\ntest_demo.py::TestDemoCase::test_greater_1__3__2_ PASSED                 [ 33%]\ntest_demo.py::TestDemoCase::test_greater_2__4__1_ PASSED                 [ 66%]\ntest_demo.py::TestDemoCase::test_greater_3__8__6_ PASSED                 [100%]\n\n============================== 3 passed in 0.02s ==============================\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 2.4 å½ååæ°\n\næä»¬è¿å¯ä»¥ç»ä¼ å¥çåæ°è¿è¡å½åèä¸æ¯åç»çå½¢å¼ï¼ä¼ å¥çåæ°åç§°ä¸åæµæ¹æ³ä¸­åæ°çåéåå¯¹åºï¼åä¸éè¦å¯¹åºé¡ºåºä¼ å¥ï¼å¯è¯»æ§æ´å¼ºäºãä»£ç å¦ä¸ï¼\n\n@ddt\nclass TestDemoCase(TestCase):\n\n    @unpack\n    @data(\n        {"first": 3, "second": 2},\n        {"first": 4, "second": 1},\n        {"first": 8, "second": 6}\n    )\n    def test_greater(self, second, first):\n        self.assertTrue(greater(first, second))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\næ§è¡åè¾åºï¼\n\n============================= test session starts =============================\ncollecting ... collected 3 items\n\ntest_demo.py::TestDemoCase::test_greater_1 PASSED                        [ 33%]\ntest_demo.py::TestDemoCase::test_greater_2 PASSED                        [ 66%]\ntest_demo.py::TestDemoCase::test_greater_3 PASSED                        [100%]\n\n============================== 3 passed in 0.01s ==============================\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 2.5 ä»jsonæä»¶ä¸­è¯»ååæ°è¿è¡åæµ\n\nå¨æäºä¸å¡ä¸­ï¼è¾å¥çåæ°è¿äºå¤æï¼å¹¶ä¸åºæ¯ç¹å¤ï¼å¦æå°åæ°æ°æ®å¨é¨æ¾å¨åæµä»£ç ä¸­ï¼åä¼æ¾å¾ç¹éï¼èä¸ä»£ç ä¸æè¯»ï¼ddtæä¾äºä»jsonæä»¶ä¸­è¯»ååæ°æ¥ä½ä¸ºåæµçè¾å¥æ°æ®ã\n\nåå»ºdata.jsonæä»¶ï¼å¶ä¸­åå«äºåæ°æ°æ®ã\n\n[\n  {\n    "first": 3,\n    "second": 2\n  },\n  {\n    "first": 4,\n    "second": 1\n  },\n  {\n    "first": 8,\n    "second": 6\n  }\n]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nç¶åä½¿ç¨file_dataä½ä¸ºåæµæ¹æ³çè£é¥°å¨ï¼å¹¶ä¼ å¥ä¸é¢æ°æ®æä»¶çè·¯å¾ã\n\nfrom ddt import ddt, file_data\n\n@ddt\nclass TestDemoCase(TestCase):\n\n    @file_data("data.json")\n    def test_greater(self, second, first):\n        self.assertTrue(greater(first, second))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ§è¡æåå¹¶è¾åºï¼\n\n============================= test session starts =============================\ncollecting ... collected 3 items\n\ntest_demo.py::TestDemoCase::test_greater_1 PASSED                        [ 33%]\ntest_demo.py::TestDemoCase::test_greater_2 PASSED                        [ 66%]\ntest_demo.py::TestDemoCase::test_greater_3 PASSED                        [100%]\n\n============================== 3 passed in 0.02s ==============================\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 3. æ»ç»\n\næ¬ææ¯ä»ç»ddtçåºæ¬å¹¶å¸¸ç¨çç¨æ³ï¼å¦ææ³è¦æ·±å¥ä½¿ç¨å¯ä»¥åèå®æ¹ææ¡£ã\n\nå¶å®ddtæä¸ªç¼ºç¹æ¯ä¸è½éå¯¹æä¸ä¸ªåæµæ¹æ³è¿è¡åç¬çæ§è¡ï¼å¿é¡»è¦è¿è¡æ´ä¸ªUnittest classæè¡ï¼è¿æ ·å¨è°è¯çè¿ç¨ä¸­éå¸¸ä¸æ¹ä¾¿ã\n\nå¦æä½ çå°æ¬æå¶å®ææ¯è¾æ¨èä½ ä½¿ç¨pytestæ¥æ¿ä»£unittestä½¿ç¨ï¼pytestä¸­ä¹æåæ°åçä½¿ç¨ï¼å¹¶ä¸å¯ä»¥åç¬çå»è¿è¡æ¯ä¸ä¸ªåæµã\n\nææ¯å ä¸ºå¨åä¸ä¸ªdjangoé¡¹ç®ï¼å¶ä¸­ä½¿ç¨çæ¯django testæ¥ååæµçï¼èdjango testæ¯åºäºUnittestæ¥å®ç°çï¼æä»¥åªè½ä½¿ç¨ddtæ¥å®ç°åæ°åã',normalizedContent:'# 0. åè¨\n\næ¬æä»ç»å¦ä½ä½¿ç¨ddtåºæ¥å®æunitestçåæ°åè®¾ç½®ã\n\nddtçgithubå°å\n\nddtçå®æ¹ææ¡£\n\n\n# 1. ä¸ºä»ä¹éè¦åæ°å\n\næä»¬å¨ååæµä¸­ï¼éè¦èèå°åç§åºæ¯ï¼éè¿è¾å¥åç§åºæ¯çå¼æ§è¡ç®ççæ¹æ³ï¼æ¥å¤æ­è¾åºæ¯å¦æ¯æä»¬ææå¾çå¼ã\n\nå¦ä¸ä»£ç ä»£ç æç¤ºï¼éå¯¹large_than_twoæ¹æ³è¿è¡äºä¸ç§åºæ¯çæ ¡éªåäºä¸ä¸ªåæµï¼ä½å¶ä¸­é»è¾ä»£ç æ¯ä¸è´çï¼èåªéè¦ä½¿ç¨ä¸åçåæ°å¼è¿è¡è¾å¥ï¼å¯¼è´æè®¸å¤çéå¤ä»£ç è¿è¡å¤å¶ç²è´´ã\n\nfrom unittest.case import testcase\n\n\ndef large_than_two(value) -> bool:\n    return value > 2\n\n\nclass testdemocase(testcase):\n\n    def test_larger_than_two_with_three(self):\n        self.asserttrue(large_than_two(3))\n\n    def test_larger_than_two_with_eight(self):\n        self.asserttrue(large_than_two(8))\n\n    def test_larger_than_two_with_five(self):\n        self.assertfalse(large_than_two(5))\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# 2. ä½¿ç¨ddtå®ç°åæ°å\n\né¦åéè¦éè¿pipæ¥å®è£è¯¥åº\n\npip install ddt\n\n\n1\n\n\n\n# 2.1 åºæ¬ä½¿ç¨\n\næä»¬å¨testcaseä¸æ·»å ddtè£é¥°å¨ï¼ç¶åå¨åæµæ¹æ³ä¸æ·»å dataè£é¥°å¨ï¼å¹¶æ·»å äº3ç§åºæ¯çè¾å¥åæ°ï¼å¦ä¸ä»£ç æç¤ºï¼\n\nfrom unittest.case import testcase\n\nfrom ddt import ddt, data\n\n\ndef large_than_two(value) -> bool:\n    return value > 2\n\n\n@ddt\nclass testdemocase(testcase):\n\n    @data(3, 8, 5)\n    def test_larger_than_two(self, value):\n        self.asserttrue(large_than_two(value))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\næ§è¡ä¸é¢çåæµï¼è¾å¥åºå¦ä¸ï¼\n\n============================= test session starts =============================\ncollecting ... collected 3 items\n\ntest_demo.py::testdemocase::test_larger_than_two_with_three_1_3 passed   [ 33%]\ntest_demo.py::testdemocase::test_larger_than_two_with_three_2_8 passed   [ 66%]\ntest_demo.py::testdemocase::test_larger_than_two_with_three_3_5 passed   [100%]\n\n============================== 3 passed in 0.02s ==============================\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nä¼åç°ï¼è½ç¶æä»¬åäºä¸ä¸ªåæµç¨ä¾ï¼ä½æ¯å´æ§è¡äº3ä¸ªç¨ä¾ï¼è¿æ¯å ä¸ºddtä¼å°dataç3ä¸ªåæ°åå«æ³¨å¥å°test_larger_than_twoæ¹æ³ä¸­valueä¸­å¹¶æ§è¡åæµã\n\nå¨è¾åºçåæµä¿¡æ¯ä¸­ï¼ä¼è¾åºåæµæ¹æ³+ç¬¬å¤å°ä¸ªåæµ+åæ°å¼æ¥è¡¨ç¤ºå½åç¨ä¾çæ§è¡ã\n\néè¿è¿ç§æ¹å¼å¯ä»¥åå°æä»¬çéå¤ä»£ç ã\n\n\n# 2.2 å¤ä¸ªå¼ä½¿ç¨åæ°å\n\nå½æä»¬éè¦å¨ä¸ä¸ªåæµç¨ä¾ä¸­æ³¨å¥å¤ä¸ªå¼æ¶ï¼å¯ä»¥å¨dataä¸­ä¼ å¥å¤ä¸ªåç»è¿è¡åæ°åï¼ä½æ§è¡åä¾æ¶ï¼ä¼å°åç»æ³¨å¥å°valueä¸­ï¼æä»¬å°å¶è§£å¼åè½æ¿å°å¤ä¸ªå¼ãä»£ç å¦ä¸å¾æç¤ºï¼\n\ndef greater(v1, v2) -> bool:\n    return v1 > v2\n\n\n@ddt\nclass testdemocase(testcase):\n\n    @data(\n        (3, 2),\n        (4, 1),\n        (8, 6))\n    def test_greater(self, value):\n        v1, v2 = value\n        self.asserttrue(greater(v1, v2))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ§è¡ä¹åè¾åºå¦ä¸æç¤ºï¼\n\n============================= test session starts =============================\ncollecting ... collected 3 items\n\ntest_demo.py::testdemocase::test_greater_1__3__2_ passed                 [ 33%]\ntest_demo.py::testdemocase::test_greater_2__4__1_ passed                 [ 66%]\ntest_demo.py::testdemocase::test_greater_3__8__6_ passed                 [100%]\n\n============================== 3 passed in 0.02s ==============================\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 2.3 åæ°åæå¹³ä½¿ç¨\n\nåç»ä¸­çæ°æ®å¯ä»¥ç±ddtè§£å¼åæ³¨å¥å°åæµæ¹æ³ä¸­çåæ°ä¸­ãåªéè¦å¨åæµæ¹æ³é±æ·»å unpackè£é¥°å¨å³å¯ãä»£ç å¦ä¸æç¤ºï¼\n\nfrom unittest.case import testcase\n\nfrom ddt import ddt, data, unpack\n\n@ddt\nclass testdemocase(testcase):\n\n    @unpack\n    @data(\n        (3, 2),\n        (4, 1),\n        (8, 6))\n    def test_greater(self, v1, v2):\n        self.asserttrue(greater(v1, v2))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ§è¡åç»æå¦ä¸ï¼\n\n============================= test session starts =============================\ncollecting ... collected 3 items\n\ntest_demo.py::testdemocase::test_greater_1__3__2_ passed                 [ 33%]\ntest_demo.py::testdemocase::test_greater_2__4__1_ passed                 [ 66%]\ntest_demo.py::testdemocase::test_greater_3__8__6_ passed                 [100%]\n\n============================== 3 passed in 0.02s ==============================\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 2.4 å½ååæ°\n\næä»¬è¿å¯ä»¥ç»ä¼ å¥çåæ°è¿è¡å½åèä¸æ¯åç»çå½¢å¼ï¼ä¼ å¥çåæ°åç§°ä¸åæµæ¹æ³ä¸­åæ°çåéåå¯¹åºï¼åä¸éè¦å¯¹åºé¡ºåºä¼ å¥ï¼å¯è¯»æ§æ´å¼ºäºãä»£ç å¦ä¸ï¼\n\n@ddt\nclass testdemocase(testcase):\n\n    @unpack\n    @data(\n        {"first": 3, "second": 2},\n        {"first": 4, "second": 1},\n        {"first": 8, "second": 6}\n    )\n    def test_greater(self, second, first):\n        self.asserttrue(greater(first, second))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\næ§è¡åè¾åºï¼\n\n============================= test session starts =============================\ncollecting ... collected 3 items\n\ntest_demo.py::testdemocase::test_greater_1 passed                        [ 33%]\ntest_demo.py::testdemocase::test_greater_2 passed                        [ 66%]\ntest_demo.py::testdemocase::test_greater_3 passed                        [100%]\n\n============================== 3 passed in 0.01s ==============================\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 2.5 ä»jsonæä»¶ä¸­è¯»ååæ°è¿è¡åæµ\n\nå¨æäºä¸å¡ä¸­ï¼è¾å¥çåæ°è¿äºå¤æï¼å¹¶ä¸åºæ¯ç¹å¤ï¼å¦æå°åæ°æ°æ®å¨é¨æ¾å¨åæµä»£ç ä¸­ï¼åä¼æ¾å¾ç¹éï¼èä¸ä»£ç ä¸æè¯»ï¼ddtæä¾äºä»jsonæä»¶ä¸­è¯»ååæ°æ¥ä½ä¸ºåæµçè¾å¥æ°æ®ã\n\nåå»ºdata.jsonæä»¶ï¼å¶ä¸­åå«äºåæ°æ°æ®ã\n\n[\n  {\n    "first": 3,\n    "second": 2\n  },\n  {\n    "first": 4,\n    "second": 1\n  },\n  {\n    "first": 8,\n    "second": 6\n  }\n]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nç¶åä½¿ç¨file_dataä½ä¸ºåæµæ¹æ³çè£é¥°å¨ï¼å¹¶ä¼ å¥ä¸é¢æ°æ®æä»¶çè·¯å¾ã\n\nfrom ddt import ddt, file_data\n\n@ddt\nclass testdemocase(testcase):\n\n    @file_data("data.json")\n    def test_greater(self, second, first):\n        self.asserttrue(greater(first, second))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ§è¡æåå¹¶è¾åºï¼\n\n============================= test session starts =============================\ncollecting ... collected 3 items\n\ntest_demo.py::testdemocase::test_greater_1 passed                        [ 33%]\ntest_demo.py::testdemocase::test_greater_2 passed                        [ 66%]\ntest_demo.py::testdemocase::test_greater_3 passed                        [100%]\n\n============================== 3 passed in 0.02s ==============================\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 3. æ»ç»\n\næ¬ææ¯ä»ç»ddtçåºæ¬å¹¶å¸¸ç¨çç¨æ³ï¼å¦ææ³è¦æ·±å¥ä½¿ç¨å¯ä»¥åèå®æ¹ææ¡£ã\n\nå¶å®ddtæä¸ªç¼ºç¹æ¯ä¸è½éå¯¹æä¸ä¸ªåæµæ¹æ³è¿è¡åç¬çæ§è¡ï¼å¿é¡»è¦è¿è¡æ´ä¸ªunittest classæè¡ï¼è¿æ ·å¨è°è¯çè¿ç¨ä¸­éå¸¸ä¸æ¹ä¾¿ã\n\nå¦æä½ çå°æ¬æå¶å®ææ¯è¾æ¨èä½ ä½¿ç¨pytestæ¥æ¿ä»£unittestä½¿ç¨ï¼pytestä¸­ä¹æåæ°åçä½¿ç¨ï¼å¹¶ä¸å¯ä»¥åç¬çå»è¿è¡æ¯ä¸ä¸ªåæµã\n\nææ¯å ä¸ºå¨åä¸ä¸ªdjangoé¡¹ç®ï¼å¶ä¸­ä½¿ç¨çæ¯django testæ¥ååæµçï¼èdjango testæ¯åºäºunittestæ¥å®ç°çï¼æä»¥åªè½ä½¿ç¨ddtæ¥å®ç°åæ°åã',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"ddtæºç åæ",frontmatter:{title:"ddtæºç åæ",date:"2022-10-23T20:04:51.000Z",permalink:"/pages/069c65/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ddt æ¯ python çç¬¬ä¸æ¹åºï¼ä¸»è¦æ¯è§£å³ä½¿ç¨ unittest æ¥ååæµæ¶å¯ä»¥æ¯æåæ°åçéç½®ï¼æ¬æä»ç»æºç è§£æè¯¥åºï¼çè§£å®çå®ç°è¿ç¨ã",feed:{enable:!0},tags:["python"],categories:["ç¼ç¨","python","ç¬¬ä¸æ¹åº"],comment:!0,meta:[{name:"twitter:title",content:"ddtæºç åæ"},{name:"twitter:description",content:"ddt æ¯ python çç¬¬ä¸æ¹åºï¼ä¸»è¦æ¯è§£å³ä½¿ç¨ unittest æ¥ååæµæ¶å¯ä»¥æ¯æåæ°åçéç½®ï¼æ¬æä»ç»æºç è§£æè¯¥åºï¼çè§£å®çå®ç°è¿ç¨ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/02.%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/02.ddt%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ddtæºç åæ"},{property:"og:description",content:"ddt æ¯ python çç¬¬ä¸æ¹åºï¼ä¸»è¦æ¯è§£å³ä½¿ç¨ unittest æ¥ååæµæ¶å¯ä»¥æ¯æåæ°åçéç½®ï¼æ¬æä»ç»æºç è§£æè¯¥åºï¼çè§£å®çå®ç°è¿ç¨ã"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/02.%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/02.ddt%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-10-23T20:04:51.000Z"},{property:"article:tag",content:"python"},{itemprop:"name",content:"ddtæºç åæ"},{itemprop:"description",content:"ddt æ¯ python çç¬¬ä¸æ¹åºï¼ä¸»è¦æ¯è§£å³ä½¿ç¨ unittest æ¥ååæµæ¶å¯ä»¥æ¯æåæ°åçéç½®ï¼æ¬æä»ç»æºç è§£æè¯¥åºï¼çè§£å®çå®ç°è¿ç¨ã"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/02.%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/02.ddt%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html",relativePath:"04.ç¼ç¨/01.python/02.ç¬¬ä¸æ¹åº/02.ddtæºç åæ.md",key:"v-4534d8ad",path:"/pages/069c65/",headers:[{level:2,title:"0. åè¨",slug:"_0-åè¨",normalizedTitle:"0. åè¨",charIndex:2},{level:2,title:"1. æºç åæ",slug:"_1-æºç åæ",normalizedTitle:"1. æºç åæ",charIndex:177},{level:3,title:"1.1 example",slug:"_1-1-example",normalizedTitle:"1.1 example",charIndex:189},{level:3,title:"1.2 æºç åææµç¨",slug:"_1-2-æºç åææµç¨",normalizedTitle:"1.2 æºç åææµç¨",charIndex:2004},{level:2,title:"2. æ»ç»",slug:"_2-æ»ç»",normalizedTitle:"2. æ»ç»",charIndex:5859}],headersStr:"0. åè¨ 1. æºç åæ 1.1 example 1.2 æºç åææµç¨ 2. æ»ç»",content:'# 0. åè¨\n\nddt æ¯ python çç¬¬ä¸æ¹åºï¼ä¸»è¦æ¯è§£å³ä½¿ç¨ unittest æ¥ååæµæ¶å¯ä»¥æ¯æåæ°åçéç½®ï¼è¿ä¸ªåºçä½¿ç¨æ¹æ³å¯ä»¥åèæä¹ååçä½¿ç¨ddtå®ç°unittestçåæ°åæµè¯ãæ¬æä¸»è¦æ¯è®²èªå·±å¨å­¦ä¹  ddt åºæ¶æè·ã\n\nddt åºçä½¿ç¨æ¹æ³æ¯ç¨è£é¥°å¨æ¥å®ç°çï¼å¯ä»¥åèè¿è¾¹æç« pythonè£é¥°å¨çä½¿ç¨æ¹æ³æ¥å­¦ä¹ è£é¥°å¨.\n\n\n# 1. æºç åæ\n\n\n# 1.1 example\n\nåçä¸ä¸ªæç®åçä½¿ç¨ä¾å­ï¼æä»¬åå»º larger_than_two å½æ°ï¼å¹¶ä½¿ç¨ unittest å¯¹å¶ç¼ååæµã\n\nè¿éä½¿ç¨äº @ddt æ¥è£é¥° DemoTestCaseï¼å¹¶ä½¿ç¨ @data å¡«åå¤ä¸ªæµè¯çåæ°ï¼è¿æ ·æ§è¡å°±å®æäºåæ°åçåæµäºã\n\nimport unittest  \nfrom ddt import ddt, data  \n  \n  \ndef larger_than_two(value):  \n    return value > 2  \n  \n  \n@ddt  \nclass DemoTestCase(unittest.TestCase):  \n  \n    @data(1, 2, 3)  \n    def test_larger_than_two(self, value):  \n        self.assertTrue(larger_than_two(value))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næä»¬æ§è¡ä¸é¢çåæµä¼åç°ï¼è½ç¶æä»¬ä»£ç åªåäºä¸ä¸ªç¨ä¾ï¼ä½æ¯æ§è¡å´æ¯ 3 ä¸ªç¨ä¾ï¼æåäº 1 ä¸ªï¼å¤±è´¥äº 2 ä¸ªï¼å¹¶ä¸è¾åºäºå¤±è´¥çç¨ä¾çåç§°ï¼test_larger_than_two_1_1 å test_larger_than_two_2_2ï¼åç§°çè§åæ¯ï¼åæµçåç§°_ç´¢å¼_åæ°ã\n\nFF.\n======================================================================\nFAIL: test_larger_than_two_1_1 (__main__.DemoTestCase)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File "c:\\crazyboy\\code\\ddt\\ddt.py", line 220, in wrapper\n    return func(self, *args, **kwargs)\n  File "C:\\CrazyBoy\\workspace\\demo\\demo.py", line 24, in test_larger_than_two\n    self.assertTrue(larger_than_two(value))\nAssertionError: False is not true\n\n======================================================================\nFAIL: test_larger_than_two_2_2 (__main__.DemoTestCase)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File "c:\\crazyboy\\code\\ddt\\ddt.py", line 220, in wrapper\n    return func(self, *args, **kwargs)\n  File "C:\\CrazyBoy\\workspace\\demo\\demo.py", line 24, in test_larger_than_two\n    self.assertTrue(larger_than_two(value))\nAssertionError: False is not true\n\n----------------------------------------------------------------------\nRan 3 tests in 0.004s\n\nFAILED (failures=2)\n\nProcess finished with exit code 1\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\nè¿æ¯å¦ä½å®ç°çå¢ï¼\n\n\n# 1.2 æºç åææµç¨\n\næä»¬é¦åæ¥çç @data è£é¥°å¨éé¢åäºä»ä¹ï¼\n\ndef data(*values):  \n    return idata(values)\n\n\n1\n2\n\n\ndata è°ç¨äºå½æ° idataï¼æä»¬åæ¥çç idata çå®ç°ï¼éè¿ setattr æ¹æ³ï¼ç»è¢«è£é¥°çåæµç¨ä¾æ·»å ä¸¤ä¸ªå±æ§\n\n * DATA_ATTR æ¯ç¨æ¥ä¿å­ data çåæ°åçåæ°ã\n * INDEX_LEN ç¨æ¥ä¿å­åæ°åçé¿åº¦ã\n\nDATA_ATTR = \'%values\'\nINDEX_LEN = \'%index_len\'\n\ndef idata(iterable, index_len=None):  \n    if index_len is None:  \n        iterable = tuple(iterable)  \n        index_len = len(str(len(iterable)))  \n  \n    def wrapper(func):  \n        setattr(func, DATA_ATTR, iterable)  \n        setattr(func, INDEX_LEN, index_len)  \n        return func  \n  \n    return wrapper\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nç¶åæä»¬åæ¥çè£é¥°å¨@ddt ä¸­ï¼ä¼ å¥ç cls æ¯è¢«è£é¥°çåæµç±»ï¼éè¿è¯¥ç±»ï¼æ¾å°ä¸é¢ä½¿ç¨@data è£é¥°å¨ä¸­æ·»å çå±æ§ DATA_ATTR åå¯¹åºçåæµæ¹æ³ï¼å¶ä¸­çæ¯æ¡æ°æ®é½æ¯ä¸ä¸ªç¨ä¾ï¼éè¿éåè¯¥å±æ§ä¸­çåæ°å¼è°ç¨å½æ° mk_test_name å»æé æ¯ä¸æ¡åæ°çç¨ä¾åç§°ã\n\nç¶ååè°ç¨ add_test å½æ°å»çæå¯¹åºçåæµç¨ä¾ã\n\ndef ddt(arg=None, **kwargs):\n\tfmt_test_name = kwargs.get("testNameFormat", TestNameFormat.DEFAULT)  \n\t  \n\tdef wrapper(cls):  \n\t    for name, func in list(cls.__dict__.items()):  \n\t        if hasattr(func, DATA_ATTR):  \n\t            index_len = getattr(func, INDEX_LEN)  \n\t            for i, v in enumerate(getattr(func, DATA_ATTR)):  \n\t                test_name = mk_test_name(  \n\t                    name,  \n\t                    getattr(v, "__name__", v),  \n\t                    i,  \n\t                    index_len,  \n\t                    fmt_test_name  \n\t                )  \n\t                test_data_docstring = _get_test_data_docstring(func, v)  \n\t                if hasattr(func, UNPACK_ATTR):  \n\t                    if isinstance(v, tuple) or isinstance(v, list):  \n\t                        add_test(  \n\t                            cls,  \n\t                            test_name,  \n\t                            test_data_docstring,  \n\t                            func,  \n\t                            *v  \n\t                        )  \n\t                    else:  \n\t                        # unpack dictionary  \n\t                        add_test(  \n\t                            cls,  \n\t                            test_name,  \n\t                            test_data_docstring,  \n\t                            func,  \n\t                            **v  \n\t                        )  \n\t                else:  \n\t                    add_test(cls, test_name, test_data_docstring, func, v)  \n\t            delattr(cls, name)  \n\t        elif hasattr(func, FILE_ATTR):  \n\t            file_attr = getattr(func, FILE_ATTR)  \n\t            process_file_data(cls, name, func, file_attr)  \n\t            delattr(cls, name)  \n\t    return cls  \n\t  \n\t# ``arg`` is the unittest\'s test class when decorating with ``@ddt`` while  \n\t# it is ``None`` when decorating a test class with ``@ddt(k=v)``.  \n\treturn wrapper(arg) if inspect.isclass(arg) else wrapper\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n\n\næä»¬çç add_test åäºä»ä¹ï¼å¾ç®åï¼å°±æ¯ç»åæµç TestCase æ·»å å±æ§ï¼ä»¥åæµç¨ä¾åç§°ä¸ºåï¼feed_data çè¿åå¼ä¸ºå¼ã\n\nfeed_data ä¸­ï¼æ ¹æ®åä¸ªåæ°å¼åè¢«@data è£é¥°çå½æ°ç»æä¸ä¸ªæ°çåæµç¨ä¾ï¼å¹¶è¿ååºå»ã\n\ndef add_test(cls, test_name, test_docstring, func, *args, **kwargs):  \n\tsetattr(cls, test_name, feed_data(func, test_name, test_docstring, *args, **kwargs))\n\ndef feed_data(func, new_name, test_data_docstring, *args, **kwargs):      \n    @wraps(func)  \n    def wrapper(self):  \n        return func(self, *args, **kwargs)  \n    wrapper.__name__ = new_name  \n    wrapper.__wrapped__ = func  \n    # set docstring if exists  \n    if test_data_docstring is not None:  \n        wrapper.__doc__ = test_data_docstring  \n    else:  \n        # Try to call format on the docstring  \n        if func.__doc__:  \n            try:  \n                wrapper.__doc__ = func.__doc__.format(*args, **kwargs)  \n            except (IndexError, KeyError):  \n\t\t\t\tpass  \n    return wrapper\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nä¹å°±æ¯è¯´ï¼åæ°åçæ¯ä¸ªå¼é½ä¼çæä¸ä¸ªç¨ä¾æ¹æ³å¹¶æ³¨åå°è¢«@ddt è£é¥°ç TestCase ç±»ä¸­ã\n\n\n# 2. æ»ç»\n\nä¸»è¦æµç¨æ¯ï¼éè¿ @data è£é¥°å¨å°åæ°åæ³¨åå°è¯¥åæµç¨ä¾æ¹æ³ç DATA_ATTR å±æ§ä¸­ï¼ç¶å@ddt è£é¥°å¨éåå½å TestCase çææåå« DATA_ATTR å±æ§çç¨ä¾æ¹æ³ï¼åéåå¶ DATA_ATTR çåæ°å¼ï¼ææ¯æ¡åæ°å¼é½çæä¸æ¡ç¨ä¾æ¹æ³ï¼å¹¶æ³¨åå° TestCase ä¸­ãè¿æ ·æ§è¡è¯¥ TestCase æ¶ï¼è½ç¶åªç¼ç äºä¸æ¡åæµï¼ä½æ¯å´æå¤æ¡ç¨ä¾è¢«æ§è¡ã\n\næ´ä¸ªè¿ç¨é½æ¯å¯¹ç±»ååæµæ¹æ³çåæ°æ®å±æ§è¿è¡åç§æä½æ¥å®ç°çã',normalizedContent:'# 0. åè¨\n\nddt æ¯ python çç¬¬ä¸æ¹åºï¼ä¸»è¦æ¯è§£å³ä½¿ç¨ unittest æ¥ååæµæ¶å¯ä»¥æ¯æåæ°åçéç½®ï¼è¿ä¸ªåºçä½¿ç¨æ¹æ³å¯ä»¥åèæä¹ååçä½¿ç¨ddtå®ç°unittestçåæ°åæµè¯ãæ¬æä¸»è¦æ¯è®²èªå·±å¨å­¦ä¹  ddt åºæ¶æè·ã\n\nddt åºçä½¿ç¨æ¹æ³æ¯ç¨è£é¥°å¨æ¥å®ç°çï¼å¯ä»¥åèè¿è¾¹æç« pythonè£é¥°å¨çä½¿ç¨æ¹æ³æ¥å­¦ä¹ è£é¥°å¨.\n\n\n# 1. æºç åæ\n\n\n# 1.1 example\n\nåçä¸ä¸ªæç®åçä½¿ç¨ä¾å­ï¼æä»¬åå»º larger_than_two å½æ°ï¼å¹¶ä½¿ç¨ unittest å¯¹å¶ç¼ååæµã\n\nè¿éä½¿ç¨äº @ddt æ¥è£é¥° demotestcaseï¼å¹¶ä½¿ç¨ @data å¡«åå¤ä¸ªæµè¯çåæ°ï¼è¿æ ·æ§è¡å°±å®æäºåæ°åçåæµäºã\n\nimport unittest  \nfrom ddt import ddt, data  \n  \n  \ndef larger_than_two(value):  \n    return value > 2  \n  \n  \n@ddt  \nclass demotestcase(unittest.testcase):  \n  \n    @data(1, 2, 3)  \n    def test_larger_than_two(self, value):  \n        self.asserttrue(larger_than_two(value))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næä»¬æ§è¡ä¸é¢çåæµä¼åç°ï¼è½ç¶æä»¬ä»£ç åªåäºä¸ä¸ªç¨ä¾ï¼ä½æ¯æ§è¡å´æ¯ 3 ä¸ªç¨ä¾ï¼æåäº 1 ä¸ªï¼å¤±è´¥äº 2 ä¸ªï¼å¹¶ä¸è¾åºäºå¤±è´¥çç¨ä¾çåç§°ï¼test_larger_than_two_1_1 å test_larger_than_two_2_2ï¼åç§°çè§åæ¯ï¼åæµçåç§°_ç´¢å¼_åæ°ã\n\nff.\n======================================================================\nfail: test_larger_than_two_1_1 (__main__.demotestcase)\n----------------------------------------------------------------------\ntraceback (most recent call last):\n  file "c:\\crazyboy\\code\\ddt\\ddt.py", line 220, in wrapper\n    return func(self, *args, **kwargs)\n  file "c:\\crazyboy\\workspace\\demo\\demo.py", line 24, in test_larger_than_two\n    self.asserttrue(larger_than_two(value))\nassertionerror: false is not true\n\n======================================================================\nfail: test_larger_than_two_2_2 (__main__.demotestcase)\n----------------------------------------------------------------------\ntraceback (most recent call last):\n  file "c:\\crazyboy\\code\\ddt\\ddt.py", line 220, in wrapper\n    return func(self, *args, **kwargs)\n  file "c:\\crazyboy\\workspace\\demo\\demo.py", line 24, in test_larger_than_two\n    self.asserttrue(larger_than_two(value))\nassertionerror: false is not true\n\n----------------------------------------------------------------------\nran 3 tests in 0.004s\n\nfailed (failures=2)\n\nprocess finished with exit code 1\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\nè¿æ¯å¦ä½å®ç°çå¢ï¼\n\n\n# 1.2 æºç åææµç¨\n\næä»¬é¦åæ¥çç @data è£é¥°å¨éé¢åäºä»ä¹ï¼\n\ndef data(*values):  \n    return idata(values)\n\n\n1\n2\n\n\ndata è°ç¨äºå½æ° idataï¼æä»¬åæ¥çç idata çå®ç°ï¼éè¿ setattr æ¹æ³ï¼ç»è¢«è£é¥°çåæµç¨ä¾æ·»å ä¸¤ä¸ªå±æ§\n\n * data_attr æ¯ç¨æ¥ä¿å­ data çåæ°åçåæ°ã\n * index_len ç¨æ¥ä¿å­åæ°åçé¿åº¦ã\n\ndata_attr = \'%values\'\nindex_len = \'%index_len\'\n\ndef idata(iterable, index_len=none):  \n    if index_len is none:  \n        iterable = tuple(iterable)  \n        index_len = len(str(len(iterable)))  \n  \n    def wrapper(func):  \n        setattr(func, data_attr, iterable)  \n        setattr(func, index_len, index_len)  \n        return func  \n  \n    return wrapper\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nç¶åæä»¬åæ¥çè£é¥°å¨@ddt ä¸­ï¼ä¼ å¥ç cls æ¯è¢«è£é¥°çåæµç±»ï¼éè¿è¯¥ç±»ï¼æ¾å°ä¸é¢ä½¿ç¨@data è£é¥°å¨ä¸­æ·»å çå±æ§ data_attr åå¯¹åºçåæµæ¹æ³ï¼å¶ä¸­çæ¯æ¡æ°æ®é½æ¯ä¸ä¸ªç¨ä¾ï¼éè¿éåè¯¥å±æ§ä¸­çåæ°å¼è°ç¨å½æ° mk_test_name å»æé æ¯ä¸æ¡åæ°çç¨ä¾åç§°ã\n\nç¶ååè°ç¨ add_test å½æ°å»çæå¯¹åºçåæµç¨ä¾ã\n\ndef ddt(arg=none, **kwargs):\n\tfmt_test_name = kwargs.get("testnameformat", testnameformat.default)  \n\t  \n\tdef wrapper(cls):  \n\t    for name, func in list(cls.__dict__.items()):  \n\t        if hasattr(func, data_attr):  \n\t            index_len = getattr(func, index_len)  \n\t            for i, v in enumerate(getattr(func, data_attr)):  \n\t                test_name = mk_test_name(  \n\t                    name,  \n\t                    getattr(v, "__name__", v),  \n\t                    i,  \n\t                    index_len,  \n\t                    fmt_test_name  \n\t                )  \n\t                test_data_docstring = _get_test_data_docstring(func, v)  \n\t                if hasattr(func, unpack_attr):  \n\t                    if isinstance(v, tuple) or isinstance(v, list):  \n\t                        add_test(  \n\t                            cls,  \n\t                            test_name,  \n\t                            test_data_docstring,  \n\t                            func,  \n\t                            *v  \n\t                        )  \n\t                    else:  \n\t                        # unpack dictionary  \n\t                        add_test(  \n\t                            cls,  \n\t                            test_name,  \n\t                            test_data_docstring,  \n\t                            func,  \n\t                            **v  \n\t                        )  \n\t                else:  \n\t                    add_test(cls, test_name, test_data_docstring, func, v)  \n\t            delattr(cls, name)  \n\t        elif hasattr(func, file_attr):  \n\t            file_attr = getattr(func, file_attr)  \n\t            process_file_data(cls, name, func, file_attr)  \n\t            delattr(cls, name)  \n\t    return cls  \n\t  \n\t# ``arg`` is the unittest\'s test class when decorating with ``@ddt`` while  \n\t# it is ``none`` when decorating a test class with ``@ddt(k=v)``.  \n\treturn wrapper(arg) if inspect.isclass(arg) else wrapper\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n\n\næä»¬çç add_test åäºä»ä¹ï¼å¾ç®åï¼å°±æ¯ç»åæµç testcase æ·»å å±æ§ï¼ä»¥åæµç¨ä¾åç§°ä¸ºåï¼feed_data çè¿åå¼ä¸ºå¼ã\n\nfeed_data ä¸­ï¼æ ¹æ®åä¸ªåæ°å¼åè¢«@data è£é¥°çå½æ°ç»æä¸ä¸ªæ°çåæµç¨ä¾ï¼å¹¶è¿ååºå»ã\n\ndef add_test(cls, test_name, test_docstring, func, *args, **kwargs):  \n\tsetattr(cls, test_name, feed_data(func, test_name, test_docstring, *args, **kwargs))\n\ndef feed_data(func, new_name, test_data_docstring, *args, **kwargs):      \n    @wraps(func)  \n    def wrapper(self):  \n        return func(self, *args, **kwargs)  \n    wrapper.__name__ = new_name  \n    wrapper.__wrapped__ = func  \n    # set docstring if exists  \n    if test_data_docstring is not none:  \n        wrapper.__doc__ = test_data_docstring  \n    else:  \n        # try to call format on the docstring  \n        if func.__doc__:  \n            try:  \n                wrapper.__doc__ = func.__doc__.format(*args, **kwargs)  \n            except (indexerror, keyerror):  \n\t\t\t\tpass  \n    return wrapper\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nä¹å°±æ¯è¯´ï¼åæ°åçæ¯ä¸ªå¼é½ä¼çæä¸ä¸ªç¨ä¾æ¹æ³å¹¶æ³¨åå°è¢«@ddt è£é¥°ç testcase ç±»ä¸­ã\n\n\n# 2. æ»ç»\n\nä¸»è¦æµç¨æ¯ï¼éè¿ @data è£é¥°å¨å°åæ°åæ³¨åå°è¯¥åæµç¨ä¾æ¹æ³ç data_attr å±æ§ä¸­ï¼ç¶å@ddt è£é¥°å¨éåå½å testcase çææåå« data_attr å±æ§çç¨ä¾æ¹æ³ï¼åéåå¶ data_attr çåæ°å¼ï¼ææ¯æ¡åæ°å¼é½çæä¸æ¡ç¨ä¾æ¹æ³ï¼å¹¶æ³¨åå° testcase ä¸­ãè¿æ ·æ§è¡è¯¥ testcase æ¶ï¼è½ç¶åªç¼ç äºä¸æ¡åæµï¼ä½æ¯å´æå¤æ¡ç¨ä¾è¢«æ§è¡ã\n\næ´ä¸ªè¿ç¨é½æ¯å¯¹ç±»ååæµæ¹æ³çåæ°æ®å±æ§è¿è¡åç§æä½æ¥å®ç°çã',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"django-apscheduleå®æ¶ä»»å¡å¼å¸¸åæ­¢",frontmatter:{title:"django-apscheduleå®æ¶ä»»å¡å¼å¸¸åæ­¢",date:"2023-10-30T16:53:28.000Z",permalink:"/pages/ec5110/",categories:["ç¼ç¨","python","ç¬¬ä¸æ¹åº"],tags:["python","django"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"å¨djangoé¡¹ç®ä¸­ä½¿ç¨`django-apschedule`æ¥å®ç°å®æ¶ä»»å¡ï¼ä½¿ç¨çæ¯`BackgroundScheduler`è°åº¦ç±»ï¼è¯¥è°åº¦çå®ç°æ¯éè¿åå°çº¿ç¨çæ¹å¼æ§è¡å®æ¶ä»»å¡ãå¶ä¸­ä»»å¡é½æ¯æä¹åå°æ°æ®åºä¸­çãå¨é¡¹ç®çè¿è¡è¿ç¨ä¸­ï¼å ä¸ºæ°æ®åºçå¼å¸¸ï¼å¯¼è´å®æ¶ä»»å¡çº¿ç¨å¼å¸¸ç»æ­¢ï¼å³ä½¿æ°æ®åºåç»­æ¢å¤æ­£å¸¸ï¼ä½ä¹ä¸åç»§ç»­æ§è¡ãæå¤æ¬¡å°è¯å¤ç°æªæï¼å¨å¼å¯å®æ¶ä»»å¡æé´ï¼æå¨å°æ°æ®åºè¿æ¥æ­å¼ï¼å®æ¶ä»»å¡æ§è¡å¤±è´¥ï¼ç¶ååå°æ°æ®åºå»ºç«è¿æ¥ï¼å®æ¶ä»»å¡ç«ç¶éæ°æ¢å¤äºï¼è¿è®©æä¸æ¶æ¸ä¸çå¤´èã",comment:!0,feed:{enable:!0},meta:[{name:"twitter:title",content:"django-apscheduleå®æ¶ä»»å¡å¼å¸¸åæ­¢"},{name:"twitter:description",content:"å¨djangoé¡¹ç®ä¸­ä½¿ç¨`django-apschedule`æ¥å®ç°å®æ¶ä»»å¡ï¼ä½¿ç¨çæ¯`BackgroundScheduler`è°åº¦ç±»ï¼è¯¥è°åº¦çå®ç°æ¯éè¿åå°çº¿ç¨çæ¹å¼æ§è¡å®æ¶ä»»å¡ãå¶ä¸­ä»»å¡é½æ¯æä¹åå°æ°æ®åºä¸­çãå¨é¡¹ç®çè¿è¡è¿ç¨ä¸­ï¼å ä¸ºæ°æ®åºçå¼å¸¸ï¼å¯¼è´å®æ¶ä»»å¡çº¿ç¨å¼å¸¸ç»æ­¢ï¼å³ä½¿æ°æ®åºåç»­æ¢å¤æ­£å¸¸ï¼ä½ä¹ä¸åç»§ç»­æ§è¡ãæå¤æ¬¡å°è¯å¤ç°æªæï¼å¨å¼å¯å®æ¶ä»»å¡æé´ï¼æå¨å°æ°æ®åºè¿æ¥æ­å¼ï¼å®æ¶ä»»å¡æ§è¡å¤±è´¥ï¼ç¶ååå°æ°æ®åºå»ºç«è¿æ¥ï¼å®æ¶ä»»å¡ç«ç¶éæ°æ¢å¤äºï¼è¿è®©æä¸æ¶æ¸ä¸çå¤´èã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/02.%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/03.django-apschedule%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%BC%82%E5%B8%B8%E5%81%9C%E6%AD%A2.html"},{property:"og:type",content:"article"},{property:"og:title",content:"django-apscheduleå®æ¶ä»»å¡å¼å¸¸åæ­¢"},{property:"og:description",content:"å¨djangoé¡¹ç®ä¸­ä½¿ç¨`django-apschedule`æ¥å®ç°å®æ¶ä»»å¡ï¼ä½¿ç¨çæ¯`BackgroundScheduler`è°åº¦ç±»ï¼è¯¥è°åº¦çå®ç°æ¯éè¿åå°çº¿ç¨çæ¹å¼æ§è¡å®æ¶ä»»å¡ãå¶ä¸­ä»»å¡é½æ¯æä¹åå°æ°æ®åºä¸­çãå¨é¡¹ç®çè¿è¡è¿ç¨ä¸­ï¼å ä¸ºæ°æ®åºçå¼å¸¸ï¼å¯¼è´å®æ¶ä»»å¡çº¿ç¨å¼å¸¸ç»æ­¢ï¼å³ä½¿æ°æ®åºåç»­æ¢å¤æ­£å¸¸ï¼ä½ä¹ä¸åç»§ç»­æ§è¡ãæå¤æ¬¡å°è¯å¤ç°æªæï¼å¨å¼å¯å®æ¶ä»»å¡æé´ï¼æå¨å°æ°æ®åºè¿æ¥æ­å¼ï¼å®æ¶ä»»å¡æ§è¡å¤±è´¥ï¼ç¶ååå°æ°æ®åºå»ºç«è¿æ¥ï¼å®æ¶ä»»å¡ç«ç¶éæ°æ¢å¤äºï¼è¿è®©æä¸æ¶æ¸ä¸çå¤´èã"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/02.%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/03.django-apschedule%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%BC%82%E5%B8%B8%E5%81%9C%E6%AD%A2.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-10-30T16:53:28.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"django-apscheduleå®æ¶ä»»å¡å¼å¸¸åæ­¢"},{itemprop:"description",content:"å¨djangoé¡¹ç®ä¸­ä½¿ç¨`django-apschedule`æ¥å®ç°å®æ¶ä»»å¡ï¼ä½¿ç¨çæ¯`BackgroundScheduler`è°åº¦ç±»ï¼è¯¥è°åº¦çå®ç°æ¯éè¿åå°çº¿ç¨çæ¹å¼æ§è¡å®æ¶ä»»å¡ãå¶ä¸­ä»»å¡é½æ¯æä¹åå°æ°æ®åºä¸­çãå¨é¡¹ç®çè¿è¡è¿ç¨ä¸­ï¼å ä¸ºæ°æ®åºçå¼å¸¸ï¼å¯¼è´å®æ¶ä»»å¡çº¿ç¨å¼å¸¸ç»æ­¢ï¼å³ä½¿æ°æ®åºåç»­æ¢å¤æ­£å¸¸ï¼ä½ä¹ä¸åç»§ç»­æ§è¡ãæå¤æ¬¡å°è¯å¤ç°æªæï¼å¨å¼å¯å®æ¶ä»»å¡æé´ï¼æå¨å°æ°æ®åºè¿æ¥æ­å¼ï¼å®æ¶ä»»å¡æ§è¡å¤±è´¥ï¼ç¶ååå°æ°æ®åºå»ºç«è¿æ¥ï¼å®æ¶ä»»å¡ç«ç¶éæ°æ¢å¤äºï¼è¿è®©æä¸æ¶æ¸ä¸çå¤´èã"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/02.%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/03.django-apschedule%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%BC%82%E5%B8%B8%E5%81%9C%E6%AD%A2.html",relativePath:"04.ç¼ç¨/01.python/02.ç¬¬ä¸æ¹åº/03.django-apscheduleå®æ¶ä»»å¡å¼å¸¸åæ­¢.md",key:"v-98683fbe",path:"/pages/ec5110/",headers:[{level:2,title:"èæ¯",slug:"èæ¯",normalizedTitle:"èæ¯",charIndex:2},{level:2,title:"æºç åæåå ",slug:"æºç åæåå ",normalizedTitle:"æºç åæåå ",charIndex:3211},{level:2,title:"æ­å»ºdemo",slug:"æ­å»ºdemo",normalizedTitle:"æ­å»ºdemo",charIndex:5215},{level:2,title:"çº¿ç¨éå¯",slug:"çº¿ç¨éå¯",normalizedTitle:"çº¿ç¨éå¯",charIndex:7380},{level:2,title:"listener",slug:"listener",normalizedTitle:"listener",charIndex:7666},{level:2,title:"æè·çº¿ç¨ä¸­å½æ°çå¼å¸¸",slug:"æè·çº¿ç¨ä¸­å½æ°çå¼å¸¸",normalizedTitle:"æè·çº¿ç¨ä¸­å½æ°çå¼å¸¸",charIndex:8659},{level:2,title:"ç¸å³é¾æ¥",slug:"ç¸å³é¾æ¥",normalizedTitle:"ç¸å³é¾æ¥",charIndex:9435}],headersStr:"èæ¯ æºç åæåå  æ­å»ºdemo çº¿ç¨éå¯ listener æè·çº¿ç¨ä¸­å½æ°çå¼å¸¸ ç¸å³é¾æ¥",content:'# èæ¯\n\nå¨djangoé¡¹ç®ä¸­ä½¿ç¨django-apscheduleæ¥å®ç°å®æ¶ä»»å¡ï¼ä½¿ç¨çæ¯BackgroundSchedulerè°åº¦ç±»ï¼è¯¥è°åº¦çå®ç°æ¯éè¿åå°çº¿ç¨çæ¹å¼æ§è¡å®æ¶ä»»å¡ãå¶ä¸­ä»»å¡é½æ¯æä¹åå°æ°æ®åºä¸­çã\n\nå¨é¡¹ç®çè¿è¡è¿ç¨ä¸­ï¼å ä¸ºæ°æ®åºçå¼å¸¸ï¼å¯¼è´å®æ¶ä»»å¡çº¿ç¨å¼å¸¸ç»æ­¢ï¼å³ä½¿æ°æ®åºåç»­æ¢å¤æ­£å¸¸ï¼ä½ä¹ä¸åç»§ç»­æ§è¡ãæå¤æ¬¡å°è¯å¤ç°æªæï¼å¨å¼å¯å®æ¶ä»»å¡æé´ï¼æå¨å°æ°æ®åºè¿æ¥æ­å¼ï¼å®æ¶ä»»å¡æ§è¡å¤±è´¥ï¼ç¶ååå°æ°æ®åºå»ºç«è¿æ¥ï¼å®æ¶ä»»å¡ç«ç¶éæ°æ¢å¤äºï¼è¿è®©æä¸æ¶æ¸ä¸çå¤´èã\n\nå·ä½çéè¯¯æ¥å¿å¦ä¸ï¼éè¿åæï¼æ¯update_jobè¿æ¥æ°æ®åºå¼å¸¸ï¼æ²¡æä»»ä½æè·æºå¶ï¼ç¶åå±å±ç½ä¸æï¼æç»å¯¼è´çº¿ç¨åæ­¢ï¼å¯ä»¥å¾è¯å®çæ¯ï¼ç»å¯¹æ¯å ä¸ºæ°æ®åºè¿æ¥å¤±è´¥å¯¼è´çå®æ¶ä»»å¡å¤±è´¥ï¼é£ä¸ºä»ä¹æ æ³å¤ç°å¢ï¼\n\nTraceback (most recent call last):\n  File "/usr/local/python3/lib/python3.7/threading.py", line 926, in _bootstrap_inner\n    self.run()\n  File "/usr/local/python3/lib/python3.7/threading.py", line 870, in run\n    self._target(*self._args, **self._kwargs)\n  File "/usr/local/python3/lib/python3.7/site-packages/apscheduler/schedulers/blocking.py", line 32, in _main_loop\n    wait_seconds = self._process_jobs()\n  File "/usr/local/python3/lib/python3.7/site-packages/apscheduler/schedulers/base.py", line 1009, in _process_jobs\n    jobstore.update_job(job)\n  File "/usr/local/python3/lib/python3.7/site-packages/django_apscheduler/util.py", line 105, in func_wrapper\n    result = func(*args, **kwargs)\n  File "/usr/local/python3/lib/python3.7/site-packages/django_apscheduler/jobstores.py", line 249, in update_job\n    with transaction.atomic():\n  File "/usr/local/python3/lib/python3.7/site-packages/django/db/transaction.py", line 189, in __enter__\n    if not connection.get_autocommit():\n  File "/usr/local/python3/lib/python3.7/site-packages/django/db/backends/base/base.py", line 389, in get_autocommit\n    self.ensure_connection()\n  File "/usr/local/python3/lib/python3.7/site-packages/django/utils/asyncio.py", line 33, in inner\n     return func(*args, **kwargs)\n  File "/usr/local/python3/lib/python3.7/site-packages/django/db/backends/base/base.py", line 219, in ensure_connection\n    self.connect()\n  File "/usr/local/python3/lib/python3.7/site-packages/django/db/utils.py", line 90, in __exit__\n    raise dj_exc_value.with_traceback(traceback) from exc_value\n  File "/usr/local/python3/lib/python3.7/site-packages/django/db/backends/base/base.py", line 219, in ensure_connection\n    self.connect()\n  File "/usr/local/python3/lib/python3.7/site-packages/django/utils/asyncio.py", line 33, in inner\n    return func(*args, **kwargs)\n  File "/usr/local/python3/lib/python3.7/site-packages/django/db/backends/base/base.py", line 200, in connect\n    self.connection = self.get_new_connection(conn_params)\n  File "/usr/local/python3/lib/python3.7/site-packages/django/utils/asyncio.py", line 33, in inner\n    return func(*args, **kwargs)\n  File "/usr/local/python3/lib/python3.7/site-packages/django/db/backends/postgresql/base.py", line 187, in get_new_connection\n    connection = Database.connect(**conn_params)\n  File "/usr/local/python3/lib/python3.7/site-packages/psycopg2/__init__.py", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\ndjango.db.utils.OperationalError: connection to server at "xxxx.postgresql.svc.cluster.local" (xx.xx.xx.xx), port xxxx failed: server closed the connection unexpectedly\nThis probably means the server terminated abnormally\nbefore or while processing the request.\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\n\n# æºç åæåå \n\nå¯ä»¥åçä¸BackgroundSchedulerçå®ç°æ¹å¼ï¼å¨startæ¹æ³ä¸­åå»ºäºä¸ªå­çº¿ç¨ã\n\nclass BackgroundScheduler(BlockingScheduler):\n\n    _thread = None\n\n    def start(self, *args, **kwargs):\n        if self._event is None or self._event.is_set():\n            self._event = Event()\n\n        BaseScheduler.start(self, *args, **kwargs)\n        self._thread = Thread(target=self._main_loop, name=\'APScheduler\')\n        self._thread.daemon = self._daemon\n        self._thread.start()\n\n    def shutdown(self, *args, **kwargs):\n        super(BackgroundScheduler, self).shutdown(*args, **kwargs)\n        self._thread.join()\n        del self._thread\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nå¶ä¸­_main_loopå¨BlockingSchedulerä¸­å®ç°ï¼æ¯ä¸ä¸ªæ­»å¾ªç¯ï¼æ§è¡_process_jobsæ¹æ³\n\nclass BlockingScheduler(BaseScheduler):\n    \n    ...\n\n    def _main_loop(self):\n        wait_seconds = TIMEOUT_MAX\n        while self.state != STATE_STOPPED:\n            self._event.wait(wait_seconds)\n            self._event.clear()\n            wait_seconds = self._process_jobs()\n    \n    ...\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nåç_process_jobsä¸­çåå®¹ï¼å¨BaseSchedulerå®ç°çï¼ä¸»è¦æµç¨å¦ä¸ï¼åæ¾å°ææè¦æ§è¡çjobï¼ç¶åè¿è¡éåè¿è¡å¹¶æ´æ°Jobçç¶æãä¹åçéè¯¯æ¥å¿ï¼ä¹å°±æ¯è¿éçupdate_jobæåºå¼å¸¸ï¼èè¿éå¹¶æ²¡ææè·å¼å¸¸ï¼æç»å±å±å¾ä¸æï¼update_job -> _process_jobs -> _main_loopï¼æç»çº¿ç¨å¼å¸¸ç»æ­¢ã\n\ndef _process_jobs(self):\n    for jobstore_alias, jobstore in six.iteritems(self._jobstores):\n        try:\n            due_jobs = jobstore.get_due_jobs(now)\n        except Exception as e:\n            ...\n            continue\n\n        ...\n                \n        for job in due_jobs:\n      \n            ...\n            \n            try:\n                executor.submit_job(job, run_times)\n            except BaseException:\n                ...\n\n            ...\n            jobstore.update_job(job)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\né£ä¸ºä»ä¹å¤ç°ä¸äºå¢ï¼è¿ä¸ªæ¯å ä¸ºï¼å³é­æ°æ®åºè¿æ¥æ¶ï¼ç¨åºä¸ä¸å®å¯ä»¥æ­£å¥½è¿è¡å¨update_jobï¼å¯ä»¥çå°åé¢çget_due_jobsè¿è¡äºå¼å¸¸æè·ï¼å¦æè¿éæåºæ°æ®åºè¿æ¥å¼å¸¸æ¯å¯ä»¥æè·å°çï¼ç¶åè·³è¿åé¢çæä½ï¼ç­å¾ä¸ä¸æ¬¡å®æ¶ä»»å¡çæ§è¡ï¼å¦æè¿æ¯å¤±è´¥ï¼ååæ¬¡ç­å¾ï¼æä»¥è¿éçå¼å¸¸ä¸ä¼æå°æä¸å±å¯¼è´çº¿ç¨åæ­¢ã\n\nä½å¦ææä¸ªæ¶æºï¼ä¸é¢è¿æ¥æ°æ®åºé½æåäºï¼å°update_jobè¿éå¼å¸¸æåºï¼åä¼å¯¼è´æ´ä¸ªçº¿ç¨åæ­¢ï¼å®æ¶ä»»å¡ä¸åæ§è¡ã\n\né£å¦ä½è§£å³è¯¥é®é¢å¢ï¼\n\n\n# æ­å»ºdemo\n\né¦åæä»¬æ­å»ºä¸ä¸ªdemoåºæ¥ï¼æ¨¡æå¤ç°è¯¥é®é¢ã\n\n 1. åå»ºdjangoé¡¹ç®\n\n\ndjango-admin startproject apschedule_demo\n\npython manage.py startapp demo\n\npython manage.py makemigrations\n\npython manage.py migrate\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n 2. å¨settings.pyä¸­éç½®å°å¥½æ°æ®åºä¿¡æ¯\n\nDATABASES = {\n    "default": {\n        "ENGINE": "django.db.backends.postgresql",\n        "NAME": "apschedule_demo",\n        "HOST": "xxxx",\n        "PORT": 5432,\n        "USER": "xxx",\n        "PASSWORD": "xxx"\n    }\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n 3. æ ¹æ®django-apscheduleå®æ¹æä¾çææ¡£æ­å»ºdemo\n\nå¨settings.pyä¸­æ·»å è¯¥APP\n\nINSTALLED_APPS = (\n    # ...\n    "django_apscheduler",\n)\n\n\n1\n2\n3\n4\n\n\nåå»ºç®å½demo/management/commandsï¼å¹¶å¨å¶ä¸é¢åå»ºrunapscheduler.pyæä»¶ï¼ä»£ç åå®¹å¦ä¸ï¼\n\nimport logging\n\nfrom django.conf import settings\n\nfrom apscheduler.schedulers.blocking import BlockingScheduler\nfrom apscheduler.triggers.cron import CronTrigger\nfrom django.core.management.base import BaseCommand\nfrom django_apscheduler.jobstores import DjangoJobStore\n\nlogger = logging.getLogger(__name__)\n\n\ndef my_job():\n  # Your job processing logic here...\n  print("job..")\n\n\nclass Command(BaseCommand):\n  help = "Runs APScheduler."\n\n  def handle(self, *args, **options):\n    scheduler = BlockingScheduler(timezone=settings.TIME_ZONE)\n    scheduler.add_jobstore(DjangoJobStore(), "default")\n\n    scheduler.add_job(\n      my_job,\n      trigger=CronTrigger(second="*/3"),  # Every 3 seconds\n      id="my_job",  # The `id` assigned to each job MUST be unique\n      max_instances=1,\n      replace_existing=True,\n    )\n    logger.info("Added job \'my_job\'.")\n\n    try:\n      logger.info("Starting scheduler...")\n      scheduler.start()\n\n    # å ä¸ºä¸é¢æ¯éé»å¡å¼å¯å®æ¶ä»»å¡ï¼æä»¥è¿ééè¦é»å¡ï¼ä¸è®©ä¸»çº¿ç¨ç»æã\n    while True:\n            time.sleep(10)\n    except KeyboardInterrupt:\n      logger.info("Stopping scheduler...")\n      scheduler.shutdown()\n      logger.info("Scheduler shut down successfully!")\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n\n\nå¯ä»¥éè¿python manage.py runapscheduleræ§è¡ä¸é¢çå½ä»¤è¿è¡å®æ¶ä»»å¡ï¼è¯¥èæ¬åå»ºäºä¸ä¸ªæ¯3ç§æ§è¡ä¸æ¬¡çä»»å¡ã\n\n 4. å¤ç°\n\næä»¬å°æ­ç¹æå¨jobstore.update_job(job)ä¸ï¼ç¶åä½¿ç¨debugæ¨¡å¼è¿è¡è°è¯ï¼å½ç¨åºè¿è¡å°æ­ç¹ä¸æ¶ï¼å°æ°æ®åºå³é­ï¼ç¶åç¨åºç»§ç»­è¿è¡ï¼åä¼æ¥éï¼å¹¶æåºå¼å¸¸ï¼çº¿ç¨åæ­¢äºè¿è¡ãè³æ­¤ï¼æä»¬å¤ç°äºè¯¥é®é¢ã\n\n\n# çº¿ç¨éå¯\n\næä¸å¼å§æ³ï¼æå¯ä»¥å¤æ­è¯¥çº¿ç¨æ¯å¦å¼å¸¸ï¼å¦æå¼å¸¸åå°çº¿ç¨éå¯å°±å¥½äº\n\n    while True:\n        if not scheduler._thread.is_alive():\n            scheduler._thread.start()\n\n        time.sleep(10)\n\n\n1\n2\n3\n4\n5\n\n\nä½äºä¸æ¿è¿ï¼æåºäºå¼å¸¸ï¼å¼å¸¸ä¿¡æ¯å¦ä¸ï¼\n\nRuntimeError: threads can only be started once\n\n\n1\n\n\néè¿æ¥çå®æ¹ææ¡£å¯ä»¥ç¥éï¼çº¿ç¨çstartæ¹æ³åªè½è°ç¨ä¸æ¬¡ã\n\n\n# listener\n\napscheduleä¸­æä¾äºçå¬å¨æºå¶ï¼ä¹å°±æ¯å¨å®æ¶ä»»å¡çæåãå¤±è´¥ç­ç¶æé½å¯ä»¥éè¿æåæ³¨åçlisteneræ¹æ³æ¥è¿è¡åè°ãä½éè¿åææºç ï¼å¶å¹¶ä¸è½æè·å°å®æ¶ä»»å¡çº¿ç¨çå¼å¸¸ã\n\nä¸é¢æ¯ç®åäºä»£ç çlistenersçåçæµç¨ï¼\n\n 1. å¤é¨éè¿add_listeneræ¹æ³æ³¨ååè°æ¹æ³\n 2. å¨å®æ¶ä»»å¡çº¿ç¨ä¸»æµç¨_process_jobsä¸­åççåä¸ªäºä»¶æ·»å å°eventsä¸­\n 3. éåeventsäºä»¶ï¼ç¶åéè¿ä¸æ³¨åçåè°æ¹æ³maskè¿è¡å¹éï¼å¹éä¸åè°ç¨åè°æ¹æ³\n\nclass BaseScheduler:\n    def __init__(...):\n        self._listeners = []\n\n    def add_listener(self, callback, mask=EVENT_ALL):\n        self._listeners.append((callback, mask))\n\n    def _process_jobs(self):\n\n        events = []\n        \n        ...\n\n        events.append(event)\n \n        ...\n\n\n        for event in events:\n            self._dispatch_event(event)\n\n\n    def _dispatch_event(self, event):\n        for cb, mask in listeners:\n            if event.code & mask:\n                try:\n                    cb(event)\n                except BaseException:\n                    self._logger.exception(\'Error notifying listener\')\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\nå¦æçº¿ç¨æ¬èº«æäºï¼åè°æ¹æ³æ¯ä¸å¯æ§è¡çã\n\n\n# æè·çº¿ç¨ä¸­å½æ°çå¼å¸¸\n\nå¦æupdate_jobæåºå¼å¸¸å¯¼è´çº¿ç¨åæ­¢ï¼é£ææè·å®çå¼å¸¸ï¼ç¶ååcontinueï¼ç­å¾ä¸æ¬¡å®æ¶ä»»å¡è¿è¡åéè¯ä¸å°±å¥½äºï¼ä½æ¯è¿å°±éè¦æ¹å¨æºç ï¼è½ä¸è½æ¹æºç å°±å°½éä¸æ¹ãæä»¥è¿è¾¹æéç¨äºç»§æ¿BackgroundSchedulerç±»ï¼ç¶ååéå_process_jobsæ¹æ³æ¥è§£å³ã\n\nå¨éåç_process_jobsæ¹æ³ä¸­ï¼å¯¹ç¶ç±»ç_process_jobs()è¿è¡å¼å¸¸çæè·ï¼ç¶ååä¸æ­çè¿è¡éè¯ï¼è¿æ ·å³ä½¿update_jobæåºå¼å¸¸äºï¼ä¹å¯ä»¥ä¸æ­çè¿è¡å°è¯æ¢å¤ï¼ç´è³æåã\n\nclass DemoBackgroundScheduler(BackgroundScheduler):\n    def _process_jobs(self):\n        while True:\n            try:\n                return super()._process_jobs()\n            except BaseException:\n                time.sleep(5)\n\nclass Command(BaseCommand):\n    help = "Runs APScheduler."\n\n    def handle(self, *args, **options):\n        scheduler = DemoBackgroundScheduler(timezone=settings.TIME_ZONE)\n        ...\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nç¶ååæ¬¡å°è¯å¤ç°è¯¥é®é¢ï¼å¯ä»¥åç°å¨æ­å¼æ°æ®åºåï¼å®è½å¤ä¸ç´è¿è¡éè¯ï¼çº¿ç¨æ²¡æåæ­¢ï¼å½æ°æ®åºæ¢å¤è¿è¡åï¼jobæ§è¡æåï¼ä¸åæåºå¼å¸¸ã\n\n\n# ç¸å³é¾æ¥\n\n * APSchedulerå®æ¹ææ¡£',normalizedContent:'# èæ¯\n\nå¨djangoé¡¹ç®ä¸­ä½¿ç¨django-apscheduleæ¥å®ç°å®æ¶ä»»å¡ï¼ä½¿ç¨çæ¯backgroundschedulerè°åº¦ç±»ï¼è¯¥è°åº¦çå®ç°æ¯éè¿åå°çº¿ç¨çæ¹å¼æ§è¡å®æ¶ä»»å¡ãå¶ä¸­ä»»å¡é½æ¯æä¹åå°æ°æ®åºä¸­çã\n\nå¨é¡¹ç®çè¿è¡è¿ç¨ä¸­ï¼å ä¸ºæ°æ®åºçå¼å¸¸ï¼å¯¼è´å®æ¶ä»»å¡çº¿ç¨å¼å¸¸ç»æ­¢ï¼å³ä½¿æ°æ®åºåç»­æ¢å¤æ­£å¸¸ï¼ä½ä¹ä¸åç»§ç»­æ§è¡ãæå¤æ¬¡å°è¯å¤ç°æªæï¼å¨å¼å¯å®æ¶ä»»å¡æé´ï¼æå¨å°æ°æ®åºè¿æ¥æ­å¼ï¼å®æ¶ä»»å¡æ§è¡å¤±è´¥ï¼ç¶ååå°æ°æ®åºå»ºç«è¿æ¥ï¼å®æ¶ä»»å¡ç«ç¶éæ°æ¢å¤äºï¼è¿è®©æä¸æ¶æ¸ä¸çå¤´èã\n\nå·ä½çéè¯¯æ¥å¿å¦ä¸ï¼éè¿åæï¼æ¯update_jobè¿æ¥æ°æ®åºå¼å¸¸ï¼æ²¡æä»»ä½æè·æºå¶ï¼ç¶åå±å±ç½ä¸æï¼æç»å¯¼è´çº¿ç¨åæ­¢ï¼å¯ä»¥å¾è¯å®çæ¯ï¼ç»å¯¹æ¯å ä¸ºæ°æ®åºè¿æ¥å¤±è´¥å¯¼è´çå®æ¶ä»»å¡å¤±è´¥ï¼é£ä¸ºä»ä¹æ æ³å¤ç°å¢ï¼\n\ntraceback (most recent call last):\n  file "/usr/local/python3/lib/python3.7/threading.py", line 926, in _bootstrap_inner\n    self.run()\n  file "/usr/local/python3/lib/python3.7/threading.py", line 870, in run\n    self._target(*self._args, **self._kwargs)\n  file "/usr/local/python3/lib/python3.7/site-packages/apscheduler/schedulers/blocking.py", line 32, in _main_loop\n    wait_seconds = self._process_jobs()\n  file "/usr/local/python3/lib/python3.7/site-packages/apscheduler/schedulers/base.py", line 1009, in _process_jobs\n    jobstore.update_job(job)\n  file "/usr/local/python3/lib/python3.7/site-packages/django_apscheduler/util.py", line 105, in func_wrapper\n    result = func(*args, **kwargs)\n  file "/usr/local/python3/lib/python3.7/site-packages/django_apscheduler/jobstores.py", line 249, in update_job\n    with transaction.atomic():\n  file "/usr/local/python3/lib/python3.7/site-packages/django/db/transaction.py", line 189, in __enter__\n    if not connection.get_autocommit():\n  file "/usr/local/python3/lib/python3.7/site-packages/django/db/backends/base/base.py", line 389, in get_autocommit\n    self.ensure_connection()\n  file "/usr/local/python3/lib/python3.7/site-packages/django/utils/asyncio.py", line 33, in inner\n     return func(*args, **kwargs)\n  file "/usr/local/python3/lib/python3.7/site-packages/django/db/backends/base/base.py", line 219, in ensure_connection\n    self.connect()\n  file "/usr/local/python3/lib/python3.7/site-packages/django/db/utils.py", line 90, in __exit__\n    raise dj_exc_value.with_traceback(traceback) from exc_value\n  file "/usr/local/python3/lib/python3.7/site-packages/django/db/backends/base/base.py", line 219, in ensure_connection\n    self.connect()\n  file "/usr/local/python3/lib/python3.7/site-packages/django/utils/asyncio.py", line 33, in inner\n    return func(*args, **kwargs)\n  file "/usr/local/python3/lib/python3.7/site-packages/django/db/backends/base/base.py", line 200, in connect\n    self.connection = self.get_new_connection(conn_params)\n  file "/usr/local/python3/lib/python3.7/site-packages/django/utils/asyncio.py", line 33, in inner\n    return func(*args, **kwargs)\n  file "/usr/local/python3/lib/python3.7/site-packages/django/db/backends/postgresql/base.py", line 187, in get_new_connection\n    connection = database.connect(**conn_params)\n  file "/usr/local/python3/lib/python3.7/site-packages/psycopg2/__init__.py", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\ndjango.db.utils.operationalerror: connection to server at "xxxx.postgresql.svc.cluster.local" (xx.xx.xx.xx), port xxxx failed: server closed the connection unexpectedly\nthis probably means the server terminated abnormally\nbefore or while processing the request.\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\n\n# æºç åæåå \n\nå¯ä»¥åçä¸backgroundschedulerçå®ç°æ¹å¼ï¼å¨startæ¹æ³ä¸­åå»ºäºä¸ªå­çº¿ç¨ã\n\nclass backgroundscheduler(blockingscheduler):\n\n    _thread = none\n\n    def start(self, *args, **kwargs):\n        if self._event is none or self._event.is_set():\n            self._event = event()\n\n        basescheduler.start(self, *args, **kwargs)\n        self._thread = thread(target=self._main_loop, name=\'apscheduler\')\n        self._thread.daemon = self._daemon\n        self._thread.start()\n\n    def shutdown(self, *args, **kwargs):\n        super(backgroundscheduler, self).shutdown(*args, **kwargs)\n        self._thread.join()\n        del self._thread\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nå¶ä¸­_main_loopå¨blockingschedulerä¸­å®ç°ï¼æ¯ä¸ä¸ªæ­»å¾ªç¯ï¼æ§è¡_process_jobsæ¹æ³\n\nclass blockingscheduler(basescheduler):\n    \n    ...\n\n    def _main_loop(self):\n        wait_seconds = timeout_max\n        while self.state != state_stopped:\n            self._event.wait(wait_seconds)\n            self._event.clear()\n            wait_seconds = self._process_jobs()\n    \n    ...\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nåç_process_jobsä¸­çåå®¹ï¼å¨baseschedulerå®ç°çï¼ä¸»è¦æµç¨å¦ä¸ï¼åæ¾å°ææè¦æ§è¡çjobï¼ç¶åè¿è¡éåè¿è¡å¹¶æ´æ°jobçç¶æãä¹åçéè¯¯æ¥å¿ï¼ä¹å°±æ¯è¿éçupdate_jobæåºå¼å¸¸ï¼èè¿éå¹¶æ²¡ææè·å¼å¸¸ï¼æç»å±å±å¾ä¸æï¼update_job -> _process_jobs -> _main_loopï¼æç»çº¿ç¨å¼å¸¸ç»æ­¢ã\n\ndef _process_jobs(self):\n    for jobstore_alias, jobstore in six.iteritems(self._jobstores):\n        try:\n            due_jobs = jobstore.get_due_jobs(now)\n        except exception as e:\n            ...\n            continue\n\n        ...\n                \n        for job in due_jobs:\n      \n            ...\n            \n            try:\n                executor.submit_job(job, run_times)\n            except baseexception:\n                ...\n\n            ...\n            jobstore.update_job(job)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\né£ä¸ºä»ä¹å¤ç°ä¸äºå¢ï¼è¿ä¸ªæ¯å ä¸ºï¼å³é­æ°æ®åºè¿æ¥æ¶ï¼ç¨åºä¸ä¸å®å¯ä»¥æ­£å¥½è¿è¡å¨update_jobï¼å¯ä»¥çå°åé¢çget_due_jobsè¿è¡äºå¼å¸¸æè·ï¼å¦æè¿éæåºæ°æ®åºè¿æ¥å¼å¸¸æ¯å¯ä»¥æè·å°çï¼ç¶åè·³è¿åé¢çæä½ï¼ç­å¾ä¸ä¸æ¬¡å®æ¶ä»»å¡çæ§è¡ï¼å¦æè¿æ¯å¤±è´¥ï¼ååæ¬¡ç­å¾ï¼æä»¥è¿éçå¼å¸¸ä¸ä¼æå°æä¸å±å¯¼è´çº¿ç¨åæ­¢ã\n\nä½å¦ææä¸ªæ¶æºï¼ä¸é¢è¿æ¥æ°æ®åºé½æåäºï¼å°update_jobè¿éå¼å¸¸æåºï¼åä¼å¯¼è´æ´ä¸ªçº¿ç¨åæ­¢ï¼å®æ¶ä»»å¡ä¸åæ§è¡ã\n\né£å¦ä½è§£å³è¯¥é®é¢å¢ï¼\n\n\n# æ­å»ºdemo\n\né¦åæä»¬æ­å»ºä¸ä¸ªdemoåºæ¥ï¼æ¨¡æå¤ç°è¯¥é®é¢ã\n\n 1. åå»ºdjangoé¡¹ç®\n\n\ndjango-admin startproject apschedule_demo\n\npython manage.py startapp demo\n\npython manage.py makemigrations\n\npython manage.py migrate\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n 2. å¨settings.pyä¸­éç½®å°å¥½æ°æ®åºä¿¡æ¯\n\ndatabases = {\n    "default": {\n        "engine": "django.db.backends.postgresql",\n        "name": "apschedule_demo",\n        "host": "xxxx",\n        "port": 5432,\n        "user": "xxx",\n        "password": "xxx"\n    }\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n 3. æ ¹æ®django-apscheduleå®æ¹æä¾çææ¡£æ­å»ºdemo\n\nå¨settings.pyä¸­æ·»å è¯¥app\n\ninstalled_apps = (\n    # ...\n    "django_apscheduler",\n)\n\n\n1\n2\n3\n4\n\n\nåå»ºç®å½demo/management/commandsï¼å¹¶å¨å¶ä¸é¢åå»ºrunapscheduler.pyæä»¶ï¼ä»£ç åå®¹å¦ä¸ï¼\n\nimport logging\n\nfrom django.conf import settings\n\nfrom apscheduler.schedulers.blocking import blockingscheduler\nfrom apscheduler.triggers.cron import crontrigger\nfrom django.core.management.base import basecommand\nfrom django_apscheduler.jobstores import djangojobstore\n\nlogger = logging.getlogger(__name__)\n\n\ndef my_job():\n  # your job processing logic here...\n  print("job..")\n\n\nclass command(basecommand):\n  help = "runs apscheduler."\n\n  def handle(self, *args, **options):\n    scheduler = blockingscheduler(timezone=settings.time_zone)\n    scheduler.add_jobstore(djangojobstore(), "default")\n\n    scheduler.add_job(\n      my_job,\n      trigger=crontrigger(second="*/3"),  # every 3 seconds\n      id="my_job",  # the `id` assigned to each job must be unique\n      max_instances=1,\n      replace_existing=true,\n    )\n    logger.info("added job \'my_job\'.")\n\n    try:\n      logger.info("starting scheduler...")\n      scheduler.start()\n\n    # å ä¸ºä¸é¢æ¯éé»å¡å¼å¯å®æ¶ä»»å¡ï¼æä»¥è¿ééè¦é»å¡ï¼ä¸è®©ä¸»çº¿ç¨ç»æã\n    while true:\n            time.sleep(10)\n    except keyboardinterrupt:\n      logger.info("stopping scheduler...")\n      scheduler.shutdown()\n      logger.info("scheduler shut down successfully!")\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n\n\nå¯ä»¥éè¿python manage.py runapscheduleræ§è¡ä¸é¢çå½ä»¤è¿è¡å®æ¶ä»»å¡ï¼è¯¥èæ¬åå»ºäºä¸ä¸ªæ¯3ç§æ§è¡ä¸æ¬¡çä»»å¡ã\n\n 4. å¤ç°\n\næä»¬å°æ­ç¹æå¨jobstore.update_job(job)ä¸ï¼ç¶åä½¿ç¨debugæ¨¡å¼è¿è¡è°è¯ï¼å½ç¨åºè¿è¡å°æ­ç¹ä¸æ¶ï¼å°æ°æ®åºå³é­ï¼ç¶åç¨åºç»§ç»­è¿è¡ï¼åä¼æ¥éï¼å¹¶æåºå¼å¸¸ï¼çº¿ç¨åæ­¢äºè¿è¡ãè³æ­¤ï¼æä»¬å¤ç°äºè¯¥é®é¢ã\n\n\n# çº¿ç¨éå¯\n\næä¸å¼å§æ³ï¼æå¯ä»¥å¤æ­è¯¥çº¿ç¨æ¯å¦å¼å¸¸ï¼å¦æå¼å¸¸åå°çº¿ç¨éå¯å°±å¥½äº\n\n    while true:\n        if not scheduler._thread.is_alive():\n            scheduler._thread.start()\n\n        time.sleep(10)\n\n\n1\n2\n3\n4\n5\n\n\nä½äºä¸æ¿è¿ï¼æåºäºå¼å¸¸ï¼å¼å¸¸ä¿¡æ¯å¦ä¸ï¼\n\nruntimeerror: threads can only be started once\n\n\n1\n\n\néè¿æ¥çå®æ¹ææ¡£å¯ä»¥ç¥éï¼çº¿ç¨çstartæ¹æ³åªè½è°ç¨ä¸æ¬¡ã\n\n\n# listener\n\napscheduleä¸­æä¾äºçå¬å¨æºå¶ï¼ä¹å°±æ¯å¨å®æ¶ä»»å¡çæåãå¤±è´¥ç­ç¶æé½å¯ä»¥éè¿æåæ³¨åçlisteneræ¹æ³æ¥è¿è¡åè°ãä½éè¿åææºç ï¼å¶å¹¶ä¸è½æè·å°å®æ¶ä»»å¡çº¿ç¨çå¼å¸¸ã\n\nä¸é¢æ¯ç®åäºä»£ç çlistenersçåçæµç¨ï¼\n\n 1. å¤é¨éè¿add_listeneræ¹æ³æ³¨ååè°æ¹æ³\n 2. å¨å®æ¶ä»»å¡çº¿ç¨ä¸»æµç¨_process_jobsä¸­åççåä¸ªäºä»¶æ·»å å°eventsä¸­\n 3. éåeventsäºä»¶ï¼ç¶åéè¿ä¸æ³¨åçåè°æ¹æ³maskè¿è¡å¹éï¼å¹éä¸åè°ç¨åè°æ¹æ³\n\nclass basescheduler:\n    def __init__(...):\n        self._listeners = []\n\n    def add_listener(self, callback, mask=event_all):\n        self._listeners.append((callback, mask))\n\n    def _process_jobs(self):\n\n        events = []\n        \n        ...\n\n        events.append(event)\n \n        ...\n\n\n        for event in events:\n            self._dispatch_event(event)\n\n\n    def _dispatch_event(self, event):\n        for cb, mask in listeners:\n            if event.code & mask:\n                try:\n                    cb(event)\n                except baseexception:\n                    self._logger.exception(\'error notifying listener\')\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\nå¦æçº¿ç¨æ¬èº«æäºï¼åè°æ¹æ³æ¯ä¸å¯æ§è¡çã\n\n\n# æè·çº¿ç¨ä¸­å½æ°çå¼å¸¸\n\nå¦æupdate_jobæåºå¼å¸¸å¯¼è´çº¿ç¨åæ­¢ï¼é£ææè·å®çå¼å¸¸ï¼ç¶ååcontinueï¼ç­å¾ä¸æ¬¡å®æ¶ä»»å¡è¿è¡åéè¯ä¸å°±å¥½äºï¼ä½æ¯è¿å°±éè¦æ¹å¨æºç ï¼è½ä¸è½æ¹æºç å°±å°½éä¸æ¹ãæä»¥è¿è¾¹æéç¨äºç»§æ¿backgroundschedulerç±»ï¼ç¶ååéå_process_jobsæ¹æ³æ¥è§£å³ã\n\nå¨éåç_process_jobsæ¹æ³ä¸­ï¼å¯¹ç¶ç±»ç_process_jobs()è¿è¡å¼å¸¸çæè·ï¼ç¶ååä¸æ­çè¿è¡éè¯ï¼è¿æ ·å³ä½¿update_jobæåºå¼å¸¸äºï¼ä¹å¯ä»¥ä¸æ­çè¿è¡å°è¯æ¢å¤ï¼ç´è³æåã\n\nclass demobackgroundscheduler(backgroundscheduler):\n    def _process_jobs(self):\n        while true:\n            try:\n                return super()._process_jobs()\n            except baseexception:\n                time.sleep(5)\n\nclass command(basecommand):\n    help = "runs apscheduler."\n\n    def handle(self, *args, **options):\n        scheduler = demobackgroundscheduler(timezone=settings.time_zone)\n        ...\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nç¶ååæ¬¡å°è¯å¤ç°è¯¥é®é¢ï¼å¯ä»¥åç°å¨æ­å¼æ°æ®åºåï¼å®è½å¤ä¸ç´è¿è¡éè¯ï¼çº¿ç¨æ²¡æåæ­¢ï¼å½æ°æ®åºæ¢å¤è¿è¡åï¼jobæ§è¡æåï¼ä¸åæåºå¼å¸¸ã\n\n\n# ç¸å³é¾æ¥\n\n * apschedulerå®æ¹ææ¡£',charsets:{cjk:!0},lastUpdated:"2023/11/17, 16:03:58",lastUpdatedTimestamp:1700208238e3},{title:"django celery ç»åä½¿ç¨",frontmatter:{title:"django celery ç»åä½¿ç¨",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/853501/",tags:["python","django"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä¸»è¦ä»ç»djangoåceleryç»åä½¿ç¨çæ¡ä¾ã",feed:{enable:!0},categories:["ç¼ç¨","python","django"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604217044049.png#alt=#crop=0&crop=0&crop=1&crop=1&id=kAMz1&originHeight=475&originWidth=564&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="},{name:"twitter:title",content:"django celery ç»åä½¿ç¨"},{name:"twitter:description",content:"æ¬æä¸»è¦ä»ç»djangoåceleryç»åä½¿ç¨çæ¡ä¾ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604217044049.png#alt=#crop=0&crop=0&crop=1&crop=1&id=kAMz1&originHeight=475&originWidth=564&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/01.django%20celery%20%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8.html"},{property:"og:type",content:"article"},{property:"og:title",content:"django celery ç»åä½¿ç¨"},{property:"og:description",content:"æ¬æä¸»è¦ä»ç»djangoåceleryç»åä½¿ç¨çæ¡ä¾ã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604217044049.png#alt=#crop=0&crop=0&crop=1&crop=1&id=kAMz1&originHeight=475&originWidth=564&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/01.django%20celery%20%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"django celery ç»åä½¿ç¨"},{itemprop:"description",content:"æ¬æä¸»è¦ä»ç»djangoåceleryç»åä½¿ç¨çæ¡ä¾ã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604217044049.png#alt=#crop=0&crop=0&crop=1&crop=1&id=kAMz1&originHeight=475&originWidth=564&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/01.django%20celery%20%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8.html",relativePath:"04.ç¼ç¨/01.python/06.django/01.django celery ç»åä½¿ç¨.md",key:"v-7dfe11b0",path:"/pages/853501/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"æµç¨",slug:"æµç¨",normalizedTitle:"æµç¨",charIndex:143},{level:2,title:"æ¶æ¯ååä¸ä»»å¡è°åº¦çå®ç°æºå¶",slug:"æ¶æ¯ååä¸ä»»å¡è°åº¦çå®ç°æºå¶",normalizedTitle:"æ¶æ¯ååä¸ä»»å¡è°åº¦çå®ç°æºå¶",charIndex:233},{level:2,title:"celery-beat",slug:"celery-beat",normalizedTitle:"celery-beat",charIndex:254},{level:2,title:"æ¡ä¾1",slug:"æ¡ä¾1",normalizedTitle:"æ¡ä¾1",charIndex:399},{level:3,title:"éç½®celery",slug:"éç½®celery",normalizedTitle:"éç½®celery",charIndex:425},{level:3,title:"å¨viewä¸­å¼æ­¥æ§è¡task",slug:"å¨viewä¸­å¼æ­¥æ§è¡task",normalizedTitle:"å¨viewä¸­å¼æ­¥æ§è¡task",charIndex:1933},{level:2,title:"æ¡ä¾2",slug:"æ¡ä¾2",normalizedTitle:"æ¡ä¾2",charIndex:2660},{level:3,title:"å®æ¶ä»»å¡ç®ä»",slug:"å®æ¶ä»»å¡ç®ä»",normalizedTitle:"å®æ¶ä»»å¡ç®ä»",charIndex:2678},{level:3,title:"éç½®",slug:"éç½®",normalizedTitle:"éç½®",charIndex:425},{level:3,title:"å®æ¶ä»»å¡",slug:"å®æ¶ä»»å¡",normalizedTitle:"å®æ¶ä»»å¡",charIndex:66},{level:2,title:"æ¡ä¾ä¸-è·¯ç±",slug:"æ¡ä¾ä¸-è·¯ç±",normalizedTitle:"æ¡ä¾ä¸-è·¯ç±",charIndex:3083},{level:3,title:"ç®¡çworker è¿ç¨",slug:"ç®¡çworker-è¿ç¨",normalizedTitle:"ç®¡çworker è¿ç¨",charIndex:3819},{level:3,title:"åºæ¬æä½",slug:"åºæ¬æä½",normalizedTitle:"åºæ¬æä½",charIndex:3861},{level:3,title:"å½ä»¤",slug:"å½ä»¤",normalizedTitle:"å½ä»¤",charIndex:3970},{level:3,title:"éåceleryä½¿ç¨",slug:"éåceleryä½¿ç¨",normalizedTitle:"éåceleryä½¿ç¨",charIndex:4105},{level:3,title:"é®é¢",slug:"é®é¢",normalizedTitle:"é®é¢",charIndex:5604},{level:2,title:"ä½¿ç¨flowerçæ§celery",slug:"ä½¿ç¨flowerçæ§celery",normalizedTitle:"ä½¿ç¨flowerçæ§celery",charIndex:5786},{level:3,title:"æä¹å",slug:"æä¹å",normalizedTitle:"æä¹å",charIndex:5930},{level:3,title:"æ¶åºé®é¢",slug:"æ¶åºé®é¢",normalizedTitle:"æ¶åºé®é¢",charIndex:6018}],headersStr:"ç®ä» æµç¨ æ¶æ¯ååä¸ä»»å¡è°åº¦çå®ç°æºå¶ celery-beat æ¡ä¾1 éç½®celery å¨viewä¸­å¼æ­¥æ§è¡task æ¡ä¾2 å®æ¶ä»»å¡ç®ä» éç½® å®æ¶ä»»å¡ æ¡ä¾ä¸-è·¯ç± ç®¡çworker è¿ç¨ åºæ¬æä½ å½ä»¤ éåceleryä½¿ç¨ é®é¢ ä½¿ç¨flowerçæ§celery æä¹å æ¶åºé®é¢",content:"# ç®ä»\n\næ¬æä¸»è¦ä»ç»djangoåceleryç»åä½¿ç¨çæ¡ä¾ã\n\ncelery æ¯ä¸ä¸ªå¼æ­¥ä»»å¡çè°åº¦å·¥å·ï¼å¯ä»¥å®æä¸äºå¼æ­¥ä»»å¡åå®æ¶ä»»å¡ã\n\næ¬æä½¿ç¨djceleryæ¥å®ædjangoåceleryçç»åä½¿ç¨ã\n\nè¯¥æ¡ä¾å¨githubä¸­django_celery_demo\n\n\n# æµç¨\n\nä»»å¡åå¸è(Producer)å°ä»»å¡ä¸¢å°æ¶æ¯éå(Broker)ä¸­ï¼ä»»å¡æ¶è´¹è(worker)ä»æ¶æ¯ä»£çä¸­è·åä»»å¡æ§è¡ï¼ç¶åå°ä¿å­å­å¨ç»æ(backend)ã\n\n\n\n\n# æ¶æ¯ååä¸ä»»å¡è°åº¦çå®ç°æºå¶\n\n\n\n\n# celery-beat\n\ncelery æä¸ªå®æ¶åè½ï¼éè¿å®æ¶å»å°taskä¸¢å°brokerä¸­ï¼ç¶åworkerå»æ§è¡ä»»å¡ãä½æ¯æä¸ªç¡®å®æ¯ï¼è¯¥å®æ¶ä»»å¡å¿é¡»ç¡¬ç¼åå°ä»£ç ä¸­ï¼ä¸å¯å¨ç¨åºè¿è¡ä¸­å¨æå¢å ä»»å¡ãä½¿ç¨djceleryå¯ä»¥å°å®æ¶ä»»å¡åå¥å°æ°æ®åºä¸­ï¼ç¶åéè¿æä½æ°æ®åºæä½å®æ¶ä»»å¡ã\n\n\n# æ¡ä¾1\n\nè®¿é®æ¥å£ï¼å¼æ­¥è°ç¨ç¨åºä¸­task\n\n\n# éç½®celery\n\nå®è£**djcelery**\n\n> pip install django_celery\n\nå¨settingsä¸­è®¾ç½®celeryéç½®\n\nä»£ç : django_celery_demo/settings.py\n\nimport djcelery\ndjcelery.setup_loader() # å è½½djcelery\n\n\n# åè®¸çæ ¼å¼\nCELERY_ACCEPT_CONTENT = ['pickle', 'json', 'yaml']\n\nBROKER_URL = 'redis://localhost:6379/1' # redisä½ä¸ºä¸­é´ä»¶\nBROKER_TRANSPORT = 'redis'\n\nCELERYBEAT_SCHEDULER = 'djcelery.schedulers.DatabaseScheduler' # å®æ¶ä»»å¡ä½¿ç¨æ°æ®åºæ¥æä½\nCELERY_RESULT_BACKEND = 'djcelery.backends.database:DatabaseBackend'  # ç»æå­å¨å°æ°æ®åºä¸­\n\n# worker å¹¶åæ°\nCELERY_CONCURRENCY = 2\n\n# æå®å¯¼å¥taskä»»å¡\nCELERY_IMPORTS = {\n'tasks.tasks'\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\ncelery app éç½®\n\nä»£ç : django_celery_demo/celery.py\n\nimport os\n\nimport django\nfrom celery import Celery, shared_task\nfrom celery.schedules import crontab\nfrom celery.signals import task_success\nfrom django.conf import settings\nfrom django.utils import timezone\n\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'django_celery_demo.settings')\ndjango.setup()\n\napp = Celery('django_celery_demo')\napp.config_from_object('django.conf:settings') # celery app å è½½ settingsä¸­çéç½®\n\napp.now = timezone.now # è®¾ç½®æ¶é´æ¶åºådjangoä¸æ ·\n\n# å è½½æ¯ä¸ªdjango appä¸çtasks.pyä¸­çtaskä»»å¡\napp.autodiscover_tasks(lambda: settings.INSTALLED_APPS)\n\n# è¿ä¸ªä¸ä¸ªtask\n@app.task(bind=True)\ndef debug_task(self):\n    print('Request: {0!r}'.format(self.request))\n    \n# å¼æ­¥æ§è¡è¿ä¸ªtask\ndebug_task.delay()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\nåå»ºdjceleryä¸­çè¡¨\n\nä¼èªå¨åå»ºdjceleryä¸­çè¡¨ãéé¢æä¿å­å®æ¶è®°å½ãç»æè®°å½ç­ç­è¡¨ã\n\n> python manage.py migrate\n\n\n# å¨viewä¸­å¼æ­¥æ§è¡task\n\nå¨appä¸­åå»º**add**task\n\nä»£ç : demo/tasks.py\n\nfrom celery import shared_task\n\n@shared_task(name=\"add\")\ndef add(a, b):\n    return int(a) + int(b)\n\n\n1\n2\n3\n4\n5\n\n\nåå»ºviewå»å¼æ­¥æ§è¡è¯¥task\n\nä»£ç : demo/views.py\n\nfrom django.http import HttpResponse\nfrom demo.tasks import add as add_task\n\ndef add(request):\n    a = request.GET[\"a\"]\n    b = request.GET[\"b\"]\n    add_task.delay(a, b)\n    \n    return HttpResponse(\"success\")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nurlä¸­éç½®view\n\nfrom demo.views import add\n\nurlpatterns = [\n    path('add', add),\n]\n\n\n1\n2\n3\n4\n5\n\n\nè¿è¡celery worker\n\n> celery -A django_celery_demo worker -l info\n\nè¿è¡é¡¹ç®\n\n> python manage.py runserver 0:8888\n\nè®¿é®æ¥å£\n\nhttp://127.0.0.1:8888/add?a=1&b=2\n\nç»æ: è¿åsuccessï¼å¨workerä¸­å¯ä»¥çå°addä»»å¡è¢«è°ç¨ï¼å¹¶ä¸ç»ææ¯3\n\n\n\n\n# æ¡ä¾2\n\nå®æ¶è°ç¨å¼æ­¥ä»»å¡\n\n\n# å®æ¶ä»»å¡ç®ä»\n\næä¸¤ç§å®æ¶ä»»å¡æ¹å¼ï¼è¿éä½¿ç¨çæ¯å¸¸è§çcrontabï¼ä¸linuxä¸æ¯ä¸æ ·ï¼æ¹ä¾¿å¾å¤ã\n\n\n# éç½®\n\néç½®åæ¡ä¾1ä¸­ä¸æ ·ã\n\n\n# å®æ¶ä»»å¡\n\nç¡¬ç¼ç ä¸­åå»ºå®æ¶ä»»å¡\n\næ¯åéè°ç¨ä¸æ¬¡add task\n\nä»£ç : django_celery_demo/celery.py\n\n# è¿ä¸ªæ¯ç¡¬ç¼ç çå®æ¶ä»»å¡\napp.conf.beat_schedule = {\n    'aa': {\n        'task': 'add',\n        'schedule': crontab(minute=\"*/1\"),\n        'args': (2, 4)\n    },\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¼å¯celery beat\n\n> celery beat -A django_celery_demo -l info\n\nè¿ä¸ªæå¡ä¼å°æ°æ®åºä¸­çå®æ¶ä»»å¡ä¸¢å°broker ä¸­\n\n\n# æ¡ä¾ä¸-è·¯ç±\n\nå°ä¸åçä»»å¡æ¾å°ä¸åçéåä¸­ï¼æ¾å°ä¸åçworkerä¸­ã\n\nå¾: æ¶æ¯ååä¸ä»»å¡è°åº¦çå®ç°æºå¶\n\ndefault = Exchange('default', type=\"direct\")\nfrequent = Exchange('frequent', type=\"direct\")\n\nCELERY_QUEUES = {\n    Queue('default', default, routing_key=\"default\"),\n    Queue('frequent', frequent, routing_key=\"frequent\")\n}\n\napp.conf.task_default_queue = 'default'\n\ntask_routes = {\n    'apps.periodic.tasks.oozie_workflow_task': {'queue': 'default'},\n    'apps.periodic.tasks.oozie_workflow_status': {'queue': 'custom'}\n}\n\napp.conf.beat_schedule = {\n\n    # æ¯åéæ£æ¥oozieè¿è¡ä¸­çä»»å¡ç¶æ\n    'oozie_workflow_status': {\n        'task': 'oozie_workflow_status',\n        'schedule': crontab(),\n        'args': (2, 1)\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# ç®¡çworker è¿ç¨\n\nä½¿ç¨supervisoræ¥ç®¡çworkerè¿ç¨ã\n\n\n# åºæ¬æä½\n\nå®è£\n\n> pip install supervisor\n\nçæé»è®¤éç½®æä»¶\n\n> echo_supervisord_conf > /etc/supervisor/supervisord.conf\n\n\n# å½ä»¤\n\nsupervisorctl\n\nå½ä»¤          æè¿°\nstatus      \nreread      è¯»åéç½®æä»¶\nupdate      å è½½ææ°çè¿ç¨\nstop è¿ç¨å    \nstart è¿ç¨å   \nreload      éæ°å è½½éç½®\n\n\n# éåceleryä½¿ç¨\n\nå¨supervisord.confä¸­æ·»å ä¸é¢çéç½®ã\n\n[include]\n; files = relative/directory/*.ini\nfiles = /home/jim/conf/supervisor/supervisord.conf.d/*.conf\n\n\n1\n2\n3\n\n\nåå»ºéç½®æä»¶/home/jim/conf/supervisor/supervisord.conf.d/celeryd_worker.confï¼æ·»å ä¸é¢éç½®\n\n[program:celeryworker]\ncommand=celery -A datahub_poster worker -l info\ndirectory=/home/hadoop/jim/projs/datahub_poster\nstdout_logfile=/yun/jim/log/supervisor/celeryworker.log\n;stderr_logfile=/yun/jim/log/supervisor/celeryworker_err.log\nredirect_stderr=true\nautorestart=true\nautostart=true\nnumprocs=1\nstartsecs=10\nstopwaitsecs = 600\npriority=15\n\n[program:celerybeat]\ncommand=celery -A datahub_poster beat -l info\ndirectory=/home/hadoop/jim/projs/datahub_poster\nstdout_logfile=/yun/jim/log/supervisor/celerybeat.log\n;stderr_logfile=/yun/jim/log/supervisor/celerybeat_err.log\nredirect_stderr=true\nautorestart=true\nautostart=true\nnumprocs=1\nstartsecs=10\nstopwaitsecs = 600\npriority=15\n\n[program:celery_flower]\ncommand=celery -A datahub_poster flower --port=5555\ndirectory=/home/hadoop/jim/projs/datahub_poster\nstdout_logfile=/yun/jim/log/supervisor/celery_flower.log\n;stderr_logfile=/yun/jim/log/supervisor/celery_flower_err.log\nredirect_stderr=true\nautorestart=true\nautostart=true\nnumprocs=1\nstartsecs=10\nstopwaitsecs = 600\npriority=15\n\n[inet_http_server]\nport=127.0.0.1:9001\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n\n\nä½¿ç¨éç½®æä»¶å¯å¨supervisor\n\n> supervisord -c /etc/supervisor/supervisord.conf\n\n\n# é®é¢\n\n 1. å¨supervisorctl statusæ¶ï¼åºç°http://localhost:9001 refused connectionéè¯¯ã\n\nè§£å³åæ³ï¼\n\nå¨éç½®æä»¶supervisord.confä¸­æ·»å \n\n[inet_http_server]\nport=127.0.0.1:9001\n\n\n1\n2\n\n\nç¶ååupdateæreloadä»¥ä¸ã\n\n\n# ä½¿ç¨flowerçæ§celery\n\nå¯ä»¥éè¿flowerçæ§celeryä¸­çworkerãtaskç­ç­ã\n\nå®è£flower\n\n> pip install flower\n\nè¿è¡\n\n> celery flower --broker=redis://localhost:6379/0\n\n\n# æä¹å\n\né®é¢: æ¯æ¬¡éå¯flowerä¹ååç°ï¼ä»¥åçtaskè¿è¡è®°å½æ¸ç©ºã\n\nè§£å³: å¯å¨floweræ¶æ·»å  --persistent=Trueï¼å¯ä»¥æä¹åtask\n\n\n# æ¶åºé®é¢\n\nflowerä¼è¯»åceleryçæ¶åºéç½®ï¼å¨é¡¹ç®ä¸­éç½®ä¸é¢åæ°å³å¯ã\n\nTIME_ZONE = 'Asia/Shanghai'\nCELERY_TIMEZONE = TIME_ZONE\n\n\n1\n2\n",normalizedContent:"# ç®ä»\n\næ¬æä¸»è¦ä»ç»djangoåceleryç»åä½¿ç¨çæ¡ä¾ã\n\ncelery æ¯ä¸ä¸ªå¼æ­¥ä»»å¡çè°åº¦å·¥å·ï¼å¯ä»¥å®æä¸äºå¼æ­¥ä»»å¡åå®æ¶ä»»å¡ã\n\næ¬æä½¿ç¨djceleryæ¥å®ædjangoåceleryçç»åä½¿ç¨ã\n\nè¯¥æ¡ä¾å¨githubä¸­django_celery_demo\n\n\n# æµç¨\n\nä»»å¡åå¸è(producer)å°ä»»å¡ä¸¢å°æ¶æ¯éå(broker)ä¸­ï¼ä»»å¡æ¶è´¹è(worker)ä»æ¶æ¯ä»£çä¸­è·åä»»å¡æ§è¡ï¼ç¶åå°ä¿å­å­å¨ç»æ(backend)ã\n\n\n\n\n# æ¶æ¯ååä¸ä»»å¡è°åº¦çå®ç°æºå¶\n\n\n\n\n# celery-beat\n\ncelery æä¸ªå®æ¶åè½ï¼éè¿å®æ¶å»å°taskä¸¢å°brokerä¸­ï¼ç¶åworkerå»æ§è¡ä»»å¡ãä½æ¯æä¸ªç¡®å®æ¯ï¼è¯¥å®æ¶ä»»å¡å¿é¡»ç¡¬ç¼åå°ä»£ç ä¸­ï¼ä¸å¯å¨ç¨åºè¿è¡ä¸­å¨æå¢å ä»»å¡ãä½¿ç¨djceleryå¯ä»¥å°å®æ¶ä»»å¡åå¥å°æ°æ®åºä¸­ï¼ç¶åéè¿æä½æ°æ®åºæä½å®æ¶ä»»å¡ã\n\n\n# æ¡ä¾1\n\nè®¿é®æ¥å£ï¼å¼æ­¥è°ç¨ç¨åºä¸­task\n\n\n# éç½®celery\n\nå®è£**djcelery**\n\n> pip install django_celery\n\nå¨settingsä¸­è®¾ç½®celeryéç½®\n\nä»£ç : django_celery_demo/settings.py\n\nimport djcelery\ndjcelery.setup_loader() # å è½½djcelery\n\n\n# åè®¸çæ ¼å¼\ncelery_accept_content = ['pickle', 'json', 'yaml']\n\nbroker_url = 'redis://localhost:6379/1' # redisä½ä¸ºä¸­é´ä»¶\nbroker_transport = 'redis'\n\ncelerybeat_scheduler = 'djcelery.schedulers.databasescheduler' # å®æ¶ä»»å¡ä½¿ç¨æ°æ®åºæ¥æä½\ncelery_result_backend = 'djcelery.backends.database:databasebackend'  # ç»æå­å¨å°æ°æ®åºä¸­\n\n# worker å¹¶åæ°\ncelery_concurrency = 2\n\n# æå®å¯¼å¥taskä»»å¡\ncelery_imports = {\n'tasks.tasks'\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\ncelery app éç½®\n\nä»£ç : django_celery_demo/celery.py\n\nimport os\n\nimport django\nfrom celery import celery, shared_task\nfrom celery.schedules import crontab\nfrom celery.signals import task_success\nfrom django.conf import settings\nfrom django.utils import timezone\n\nos.environ.setdefault('django_settings_module', 'django_celery_demo.settings')\ndjango.setup()\n\napp = celery('django_celery_demo')\napp.config_from_object('django.conf:settings') # celery app å è½½ settingsä¸­çéç½®\n\napp.now = timezone.now # è®¾ç½®æ¶é´æ¶åºådjangoä¸æ ·\n\n# å è½½æ¯ä¸ªdjango appä¸çtasks.pyä¸­çtaskä»»å¡\napp.autodiscover_tasks(lambda: settings.installed_apps)\n\n# è¿ä¸ªä¸ä¸ªtask\n@app.task(bind=true)\ndef debug_task(self):\n    print('request: {0!r}'.format(self.request))\n    \n# å¼æ­¥æ§è¡è¿ä¸ªtask\ndebug_task.delay()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\nåå»ºdjceleryä¸­çè¡¨\n\nä¼èªå¨åå»ºdjceleryä¸­çè¡¨ãéé¢æä¿å­å®æ¶è®°å½ãç»æè®°å½ç­ç­è¡¨ã\n\n> python manage.py migrate\n\n\n# å¨viewä¸­å¼æ­¥æ§è¡task\n\nå¨appä¸­åå»º**add**task\n\nä»£ç : demo/tasks.py\n\nfrom celery import shared_task\n\n@shared_task(name=\"add\")\ndef add(a, b):\n    return int(a) + int(b)\n\n\n1\n2\n3\n4\n5\n\n\nåå»ºviewå»å¼æ­¥æ§è¡è¯¥task\n\nä»£ç : demo/views.py\n\nfrom django.http import httpresponse\nfrom demo.tasks import add as add_task\n\ndef add(request):\n    a = request.get[\"a\"]\n    b = request.get[\"b\"]\n    add_task.delay(a, b)\n    \n    return httpresponse(\"success\")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nurlä¸­éç½®view\n\nfrom demo.views import add\n\nurlpatterns = [\n    path('add', add),\n]\n\n\n1\n2\n3\n4\n5\n\n\nè¿è¡celery worker\n\n> celery -a django_celery_demo worker -l info\n\nè¿è¡é¡¹ç®\n\n> python manage.py runserver 0:8888\n\nè®¿é®æ¥å£\n\nhttp://127.0.0.1:8888/add?a=1&b=2\n\nç»æ: è¿åsuccessï¼å¨workerä¸­å¯ä»¥çå°addä»»å¡è¢«è°ç¨ï¼å¹¶ä¸ç»ææ¯3\n\n\n\n\n# æ¡ä¾2\n\nå®æ¶è°ç¨å¼æ­¥ä»»å¡\n\n\n# å®æ¶ä»»å¡ç®ä»\n\næä¸¤ç§å®æ¶ä»»å¡æ¹å¼ï¼è¿éä½¿ç¨çæ¯å¸¸è§çcrontabï¼ä¸linuxä¸æ¯ä¸æ ·ï¼æ¹ä¾¿å¾å¤ã\n\n\n# éç½®\n\néç½®åæ¡ä¾1ä¸­ä¸æ ·ã\n\n\n# å®æ¶ä»»å¡\n\nç¡¬ç¼ç ä¸­åå»ºå®æ¶ä»»å¡\n\næ¯åéè°ç¨ä¸æ¬¡add task\n\nä»£ç : django_celery_demo/celery.py\n\n# è¿ä¸ªæ¯ç¡¬ç¼ç çå®æ¶ä»»å¡\napp.conf.beat_schedule = {\n    'aa': {\n        'task': 'add',\n        'schedule': crontab(minute=\"*/1\"),\n        'args': (2, 4)\n    },\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¼å¯celery beat\n\n> celery beat -a django_celery_demo -l info\n\nè¿ä¸ªæå¡ä¼å°æ°æ®åºä¸­çå®æ¶ä»»å¡ä¸¢å°broker ä¸­\n\n\n# æ¡ä¾ä¸-è·¯ç±\n\nå°ä¸åçä»»å¡æ¾å°ä¸åçéåä¸­ï¼æ¾å°ä¸åçworkerä¸­ã\n\nå¾: æ¶æ¯ååä¸ä»»å¡è°åº¦çå®ç°æºå¶\n\ndefault = exchange('default', type=\"direct\")\nfrequent = exchange('frequent', type=\"direct\")\n\ncelery_queues = {\n    queue('default', default, routing_key=\"default\"),\n    queue('frequent', frequent, routing_key=\"frequent\")\n}\n\napp.conf.task_default_queue = 'default'\n\ntask_routes = {\n    'apps.periodic.tasks.oozie_workflow_task': {'queue': 'default'},\n    'apps.periodic.tasks.oozie_workflow_status': {'queue': 'custom'}\n}\n\napp.conf.beat_schedule = {\n\n    # æ¯åéæ£æ¥oozieè¿è¡ä¸­çä»»å¡ç¶æ\n    'oozie_workflow_status': {\n        'task': 'oozie_workflow_status',\n        'schedule': crontab(),\n        'args': (2, 1)\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# ç®¡çworker è¿ç¨\n\nä½¿ç¨supervisoræ¥ç®¡çworkerè¿ç¨ã\n\n\n# åºæ¬æä½\n\nå®è£\n\n> pip install supervisor\n\nçæé»è®¤éç½®æä»¶\n\n> echo_supervisord_conf > /etc/supervisor/supervisord.conf\n\n\n# å½ä»¤\n\nsupervisorctl\n\nå½ä»¤          æè¿°\nstatus      \nreread      è¯»åéç½®æä»¶\nupdate      å è½½ææ°çè¿ç¨\nstop è¿ç¨å    \nstart è¿ç¨å   \nreload      éæ°å è½½éç½®\n\n\n# éåceleryä½¿ç¨\n\nå¨supervisord.confä¸­æ·»å ä¸é¢çéç½®ã\n\n[include]\n; files = relative/directory/*.ini\nfiles = /home/jim/conf/supervisor/supervisord.conf.d/*.conf\n\n\n1\n2\n3\n\n\nåå»ºéç½®æä»¶/home/jim/conf/supervisor/supervisord.conf.d/celeryd_worker.confï¼æ·»å ä¸é¢éç½®\n\n[program:celeryworker]\ncommand=celery -a datahub_poster worker -l info\ndirectory=/home/hadoop/jim/projs/datahub_poster\nstdout_logfile=/yun/jim/log/supervisor/celeryworker.log\n;stderr_logfile=/yun/jim/log/supervisor/celeryworker_err.log\nredirect_stderr=true\nautorestart=true\nautostart=true\nnumprocs=1\nstartsecs=10\nstopwaitsecs = 600\npriority=15\n\n[program:celerybeat]\ncommand=celery -a datahub_poster beat -l info\ndirectory=/home/hadoop/jim/projs/datahub_poster\nstdout_logfile=/yun/jim/log/supervisor/celerybeat.log\n;stderr_logfile=/yun/jim/log/supervisor/celerybeat_err.log\nredirect_stderr=true\nautorestart=true\nautostart=true\nnumprocs=1\nstartsecs=10\nstopwaitsecs = 600\npriority=15\n\n[program:celery_flower]\ncommand=celery -a datahub_poster flower --port=5555\ndirectory=/home/hadoop/jim/projs/datahub_poster\nstdout_logfile=/yun/jim/log/supervisor/celery_flower.log\n;stderr_logfile=/yun/jim/log/supervisor/celery_flower_err.log\nredirect_stderr=true\nautorestart=true\nautostart=true\nnumprocs=1\nstartsecs=10\nstopwaitsecs = 600\npriority=15\n\n[inet_http_server]\nport=127.0.0.1:9001\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n\n\nä½¿ç¨éç½®æä»¶å¯å¨supervisor\n\n> supervisord -c /etc/supervisor/supervisord.conf\n\n\n# é®é¢\n\n 1. å¨supervisorctl statusæ¶ï¼åºç°http://localhost:9001 refused connectionéè¯¯ã\n\nè§£å³åæ³ï¼\n\nå¨éç½®æä»¶supervisord.confä¸­æ·»å \n\n[inet_http_server]\nport=127.0.0.1:9001\n\n\n1\n2\n\n\nç¶ååupdateæreloadä»¥ä¸ã\n\n\n# ä½¿ç¨flowerçæ§celery\n\nå¯ä»¥éè¿flowerçæ§celeryä¸­çworkerãtaskç­ç­ã\n\nå®è£flower\n\n> pip install flower\n\nè¿è¡\n\n> celery flower --broker=redis://localhost:6379/0\n\n\n# æä¹å\n\né®é¢: æ¯æ¬¡éå¯flowerä¹ååç°ï¼ä»¥åçtaskè¿è¡è®°å½æ¸ç©ºã\n\nè§£å³: å¯å¨floweræ¶æ·»å  --persistent=trueï¼å¯ä»¥æä¹åtask\n\n\n# æ¶åºé®é¢\n\nflowerä¼è¯»åceleryçæ¶åºéç½®ï¼å¨é¡¹ç®ä¸­éç½®ä¸é¢åæ°å³å¯ã\n\ntime_zone = 'asia/shanghai'\ncelery_timezone = time_zone\n\n\n1\n2\n",charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"django rest_framework Authentication",frontmatter:{tags:["python","django"],title:"django rest_framework Authentication",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/626675/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä»ç»çæ¯ django rest_frameworkçè®¤è¯æ¹å¼.",feed:{enable:!0},categories:["ç¼ç¨","python","django"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604217645776.png#alt="},{name:"twitter:title",content:"django rest_framework Authentication"},{name:"twitter:description",content:"æ¬æä»ç»çæ¯ django rest_frameworkçè®¤è¯æ¹å¼."},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604217645776.png#alt="},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/03.django%20rest_framework%20Authentication.html"},{property:"og:type",content:"article"},{property:"og:title",content:"django rest_framework Authentication"},{property:"og:description",content:"æ¬æä»ç»çæ¯ django rest_frameworkçè®¤è¯æ¹å¼."},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604217645776.png#alt="},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/03.django%20rest_framework%20Authentication.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"django rest_framework Authentication"},{itemprop:"description",content:"æ¬æä»ç»çæ¯ django rest_frameworkçè®¤è¯æ¹å¼."},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604217645776.png#alt="}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/03.django%20rest_framework%20Authentication.html",relativePath:"04.ç¼ç¨/01.python/06.django/03.django rest_framework Authentication.md",key:"v-502d161c",path:"/pages/626675/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"æºç è§£æ",slug:"æºç è§£æ",normalizedTitle:"æºç è§£æ",charIndex:132},{level:2,title:"è®¤è¯æ¹å¼",slug:"è®¤è¯æ¹å¼",normalizedTitle:"è®¤è¯æ¹å¼",charIndex:35},{level:3,title:"Token",slug:"token",normalizedTitle:"token",charIndex:42},{level:4,title:"ä½¿ç¨",slug:"ä½¿ç¨",normalizedTitle:"ä½¿ç¨",charIndex:124},{level:4,title:"ç¼ºé·",slug:"ç¼ºé·",normalizedTitle:"ç¼ºé·",charIndex:1493},{level:3,title:"session",slug:"session",normalizedTitle:"session",charIndex:1683}],headersStr:"ç®ä» æºç è§£æ è®¤è¯æ¹å¼ Token ä½¿ç¨ ç¼ºé· session",content:"# ç®ä»\n\næ¬æä»ç»çæ¯ django rest_frameworkçè®¤è¯æ¹å¼.\n\nTokenãSessionãRemoteUserãjwtç­è®¤è¯æ¹å¼ãåä¸ç§æ¯æ¡æ¶èªå¸¦çï¼èjwtéè¦å®è£ç¬¬ä¸æ¹åºdjangorestframework-jwtï¼ç¶åä½¿ç¨ã\n\n\n# æºç è§£æ\n\nä»¥ä¸æ¯è®¤è¯æºç è®¤è¯æµç¨.\n\n 1. éè¿è·¯ç±å¹éåé¦åè¿å¥å°ApiView.as_viewä¸­.\n\n 2. ApiViewç»§æ¿DjangoçViewï¼ç¶åè°ç¨View.as_view\n\n 3. å¨Viewä¸­è°ç¨dispatchæ¹æ³ï¼å ä¸ºApiViewå®ç°dispatchæ¹æ³ï¼æä»¥è°ç¨çæ¯ApiView.dispatchèä¸æ¯View.dispatch.\n\n 4. å¨ApiView.dispatchä¸­å°django.requeståæ¬¡å°è£ææ¡æ¶çrest_framework.request\n\n 5. å°è£çè¿ç¨ä¸­å°éç½®çAuthenticationç±»æ³¨å¥å°requestä¸­.\n\n 6. å°è£å®requeståï¼è°ç¨ApiView.perform_authenticationå¼å§è®¤è¯\n\n 7. è®¤è¯çè¿ç¨æ¯éè¿request.userï¼ç¶ååè°ç¨request._authenticationè¿è¡å¾ªç¯éåæææ³¨å¥çAuthentiationç±»ä¸­authenticateæ¹æ³è¿è¡è®¤è¯ï¼è®¤è¯æååè¿åuseråauthä¸¤ä¸ªç»æ.\n\n\n\n\n# è®¤è¯æ¹å¼\n\nå¯ä»¥èªå®ä¹è®¤è¯ç±»ï¼åªéè¦ç»§æ¿BaseAuthenticationç±»ï¼ç¶åå®ç°authenticateæ¹æ³å³å¯ï¼ç¶åå°è¯¥ç±»æ³¨å¥å°requestå³å¯.\n\næèä½¿ç¨æ¡æ¶èªå¸¦çè®¤è¯ç±»ä¹å¯ã\n\n\n# Token\n\næ¯æ¡æ¶èªå¸¦çè®¤è¯æ¹å¼ä¹ä¸.\n\n# ä½¿ç¨\n\n 1. éç½®authtoken app settings\n\nINSTALLED_APPS = [\n    ...\n    'rest_framework.authtoken']\n\n\n1\n2\n3\n\n\nç¶åä½¿ç¨python manage.py migrateï¼ä¼åå»ºauthtokenè¡¨ï¼è¯¥è¡¨è¿æ¥auth_user.è¡¨ï¼æ¯ä¸ªç¨æ·é½æå¯¹åºä¸ä¸ªtokenï¼ç¨æ·æ¯æ¬¡è®¿é®å¸¦æè¯¥tokenï¼ç³»ç»å°±è½éè¿tokenå¾å°å½åuser.\n\n 2. å±é¨æ·»å è®¤è¯æ¹å¼.\n\nå¨TestViewæ·»å TokenAuthenticationè®¤è¯, è·¯ç±å°TestViewæ¶ï¼ä¼è°ç¨è¯¥ç±»ä¸­çauthenticateæ¹æ³ï¼éè¿tokenè·åå°user.\n\nview.py\n\n\nfrom rest_framework.authentication import TokenAuthentication\n\nclass TestView(APIView):\n    authentication_classes = (TokenAuthentication,)\n\n    def get(self, *args, **kwargs):\n        return HttpResponse(self.request.user)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n 3. å¨å±æ·»å è®¤è¯æ¹å¼\n\nä»»ä½è·¯ç±è¯·æ±éè¦éè¿Tokenè®¤è¯.\n\nsettings.py\n\nREST_FRAMEWORK = {\n    'DEFAULT_AUTHENTICATION_CLASSES': [\n        'rest_framework.authentication.TokenAuthentication',\n    ]\n}\n\n\n1\n2\n3\n4\n5\n\n\n# ç¼ºé·\n\n * Tokenéªè¯æ¯æ¾å¨ä¸å¼ è¡¨ä¸­ï¼å³authtoken_tokenä¸­ï¼keyæ²¡æå¤±ææ¶é´ï¼æ°¸ä¹ææï¼ä¸æ¦æ³é²ï¼åæä¸å¯æ³è±¡ï¼å®å¨æ§æå·®ã\n * ä¸å©äºåå¸å¼é¨ç½²æå¤ä¸ªç³»ç»ä½¿ç¨ä¸å¥éªè¯ï¼authtoken_tokenæ¯æ¾å¨æå°æå¡å¨ä¸çï¼å¦æåå¸å¼é¨ç½²ï¼å°å¤±æï¼æå¤ä¸ªç³»ç»ç¨ä¸å¥éªè¯ï¼å°å¿é¡»å¤å¶è¯¥è¡¨å°ç¸åºæå¡å¨ä¸ï¼éº»ç¦è´¹åã\n\né´äºä»¥ä¸ç¼ºé·ï¼ä½¿ç¨jwtæ´å ä¼ç§.\n\n\n# session\n\ndrfä¸­sessionè®¤è¯ï¼æ¯éè¿django SessionMiddlewareåAuthenticationMiddlewareä¸­å°userå­å¨å°requestä¸­ï¼ç¶åè·åå°ç.\n\n",normalizedContent:"# ç®ä»\n\næ¬æä»ç»çæ¯ django rest_frameworkçè®¤è¯æ¹å¼.\n\ntokenãsessionãremoteuserãjwtç­è®¤è¯æ¹å¼ãåä¸ç§æ¯æ¡æ¶èªå¸¦çï¼èjwtéè¦å®è£ç¬¬ä¸æ¹åºdjangorestframework-jwtï¼ç¶åä½¿ç¨ã\n\n\n# æºç è§£æ\n\nä»¥ä¸æ¯è®¤è¯æºç è®¤è¯æµç¨.\n\n 1. éè¿è·¯ç±å¹éåé¦åè¿å¥å°apiview.as_viewä¸­.\n\n 2. apiviewç»§æ¿djangoçviewï¼ç¶åè°ç¨view.as_view\n\n 3. å¨viewä¸­è°ç¨dispatchæ¹æ³ï¼å ä¸ºapiviewå®ç°dispatchæ¹æ³ï¼æä»¥è°ç¨çæ¯apiview.dispatchèä¸æ¯view.dispatch.\n\n 4. å¨apiview.dispatchä¸­å°django.requeståæ¬¡å°è£ææ¡æ¶çrest_framework.request\n\n 5. å°è£çè¿ç¨ä¸­å°éç½®çauthenticationç±»æ³¨å¥å°requestä¸­.\n\n 6. å°è£å®requeståï¼è°ç¨apiview.perform_authenticationå¼å§è®¤è¯\n\n 7. è®¤è¯çè¿ç¨æ¯éè¿request.userï¼ç¶ååè°ç¨request._authenticationè¿è¡å¾ªç¯éåæææ³¨å¥çauthentiationç±»ä¸­authenticateæ¹æ³è¿è¡è®¤è¯ï¼è®¤è¯æååè¿åuseråauthä¸¤ä¸ªç»æ.\n\n\n\n\n# è®¤è¯æ¹å¼\n\nå¯ä»¥èªå®ä¹è®¤è¯ç±»ï¼åªéè¦ç»§æ¿baseauthenticationç±»ï¼ç¶åå®ç°authenticateæ¹æ³å³å¯ï¼ç¶åå°è¯¥ç±»æ³¨å¥å°requestå³å¯.\n\næèä½¿ç¨æ¡æ¶èªå¸¦çè®¤è¯ç±»ä¹å¯ã\n\n\n# token\n\næ¯æ¡æ¶èªå¸¦çè®¤è¯æ¹å¼ä¹ä¸.\n\n# ä½¿ç¨\n\n 1. éç½®authtoken app settings\n\ninstalled_apps = [\n    ...\n    'rest_framework.authtoken']\n\n\n1\n2\n3\n\n\nç¶åä½¿ç¨python manage.py migrateï¼ä¼åå»ºauthtokenè¡¨ï¼è¯¥è¡¨è¿æ¥auth_user.è¡¨ï¼æ¯ä¸ªç¨æ·é½æå¯¹åºä¸ä¸ªtokenï¼ç¨æ·æ¯æ¬¡è®¿é®å¸¦æè¯¥tokenï¼ç³»ç»å°±è½éè¿tokenå¾å°å½åuser.\n\n 2. å±é¨æ·»å è®¤è¯æ¹å¼.\n\nå¨testviewæ·»å tokenauthenticationè®¤è¯, è·¯ç±å°testviewæ¶ï¼ä¼è°ç¨è¯¥ç±»ä¸­çauthenticateæ¹æ³ï¼éè¿tokenè·åå°user.\n\nview.py\n\n\nfrom rest_framework.authentication import tokenauthentication\n\nclass testview(apiview):\n    authentication_classes = (tokenauthentication,)\n\n    def get(self, *args, **kwargs):\n        return httpresponse(self.request.user)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n 3. å¨å±æ·»å è®¤è¯æ¹å¼\n\nä»»ä½è·¯ç±è¯·æ±éè¦éè¿tokenè®¤è¯.\n\nsettings.py\n\nrest_framework = {\n    'default_authentication_classes': [\n        'rest_framework.authentication.tokenauthentication',\n    ]\n}\n\n\n1\n2\n3\n4\n5\n\n\n# ç¼ºé·\n\n * tokenéªè¯æ¯æ¾å¨ä¸å¼ è¡¨ä¸­ï¼å³authtoken_tokenä¸­ï¼keyæ²¡æå¤±ææ¶é´ï¼æ°¸ä¹ææï¼ä¸æ¦æ³é²ï¼åæä¸å¯æ³è±¡ï¼å®å¨æ§æå·®ã\n * ä¸å©äºåå¸å¼é¨ç½²æå¤ä¸ªç³»ç»ä½¿ç¨ä¸å¥éªè¯ï¼authtoken_tokenæ¯æ¾å¨æå°æå¡å¨ä¸çï¼å¦æåå¸å¼é¨ç½²ï¼å°å¤±æï¼æå¤ä¸ªç³»ç»ç¨ä¸å¥éªè¯ï¼å°å¿é¡»å¤å¶è¯¥è¡¨å°ç¸åºæå¡å¨ä¸ï¼éº»ç¦è´¹åã\n\né´äºä»¥ä¸ç¼ºé·ï¼ä½¿ç¨jwtæ´å ä¼ç§.\n\n\n# session\n\ndrfä¸­sessionè®¤è¯ï¼æ¯éè¿django sessionmiddlewareåauthenticationmiddlewareä¸­å°userå­å¨å°requestä¸­ï¼ç¶åè·åå°ç.\n\n",charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"django rest_frameworkå¼å¸¸å¤ç",frontmatter:{tags:["python","django"],title:"django rest_frameworkå¼å¸¸å¤ç",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/070fec/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"å½ç¨åºä¸­åºç°å¼å¸¸æ¶ï¼æä»¬æ³è¦è¿åçæ¯åå«å¼å¸¸ä¿¡æ¯çjsonæ°æ®ãè¿åæ­£å¸¸çä¿¡æ¯åå¼å¸¸ä¿¡æ¯çæ ¼å¼ä¸è´åã",feed:{enable:!0},categories:["ç¼ç¨","python","django"],comment:!0,meta:[{name:"twitter:title",content:"django rest_frameworkå¼å¸¸å¤ç"},{name:"twitter:description",content:"å½ç¨åºä¸­åºç°å¼å¸¸æ¶ï¼æä»¬æ³è¦è¿åçæ¯åå«å¼å¸¸ä¿¡æ¯çjsonæ°æ®ãè¿åæ­£å¸¸çä¿¡æ¯åå¼å¸¸ä¿¡æ¯çæ ¼å¼ä¸è´åã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/04.django%20rest_framework%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86.html"},{property:"og:type",content:"article"},{property:"og:title",content:"django rest_frameworkå¼å¸¸å¤ç"},{property:"og:description",content:"å½ç¨åºä¸­åºç°å¼å¸¸æ¶ï¼æä»¬æ³è¦è¿åçæ¯åå«å¼å¸¸ä¿¡æ¯çjsonæ°æ®ãè¿åæ­£å¸¸çä¿¡æ¯åå¼å¸¸ä¿¡æ¯çæ ¼å¼ä¸è´åã"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/04.django%20rest_framework%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"django rest_frameworkå¼å¸¸å¤ç"},{itemprop:"description",content:"å½ç¨åºä¸­åºç°å¼å¸¸æ¶ï¼æä»¬æ³è¦è¿åçæ¯åå«å¼å¸¸ä¿¡æ¯çjsonæ°æ®ãè¿åæ­£å¸¸çä¿¡æ¯åå¼å¸¸ä¿¡æ¯çæ ¼å¼ä¸è´åã"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/04.django%20rest_framework%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86.html",relativePath:"04.ç¼ç¨/01.python/06.django/04.django rest_frameworkå¼å¸¸å¤ç.md",key:"v-abb9096c",path:"/pages/070fec/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"æä½",slug:"æä½",normalizedTitle:"æä½",charIndex:62}],headersStr:"ç®ä» æä½",content:'# ç®ä»\n\nå½ç¨åºä¸­åºç°å¼å¸¸æ¶ï¼æä»¬æ³è¦è¿åçæ¯åå«å¼å¸¸ä¿¡æ¯çjsonæ°æ®ãè¿åæ­£å¸¸çä¿¡æ¯åå¼å¸¸ä¿¡æ¯çæ ¼å¼ä¸è´åã\n\n\n# æä½\n\n 1. èªå®ä¹jsonè¿åçæ ¼å¼\n\nlibs/response.py\n\nfrom rest_framework.response import Response\n\n\nclass JsonResponse(Response):\n    def __init__(self, data=None, code=None, msg=None, status=None,\n                 template_name=None, headers=None,\n                 exception=False, content_type=None):\n        rsp_data = {"code": code, "message": msg, "data": data}\n        super(JsonResponse, self).__init__(data=rsp_data, status=status, template_name=template_name,\n                                                 headers=headers,\n                                                 exception=exception, content_type=content_type)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n 2. èªå®ä¹å¨å±çå¼å¸¸å¤çæ¹æ³ libs/exceptions.py\n\n\nfrom rest_framework import status\nfrom rest_framework.views import exception_handler\nfrom libs.response import JsonResponse\n\n\nclass DataException(Exception):\n\n    def __init__(self, message="", code=0, status=status.HTTP_400_BAD_REQUEST, data=None):\n        self.code = code\n        self.status = status\n        self.detail = message\n        self.data = data if data else {}\n\n        def __str__(self):\n            return self.message\n\n\ndef custom_exception_handler(exc, context):\n    data = exc.data if hasattr(exc, "data") else {}\n    return JsonResponse(msg=exc.detail, status=exc.status_code, data=data, code=exc.status_code)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n 3. å°è¯¥å¼å¸¸æ¹æ³æ³¨åå°rest_frameworkæ¡æ¶ä¸­ settings.py\n\nREST_FRAMEWORK = {\n    \'EXCEPTION_HANDLER\': \'libs.exceptions.custom_exception_handler\',\n}\n\n\n1\n2\n3\n',normalizedContent:'# ç®ä»\n\nå½ç¨åºä¸­åºç°å¼å¸¸æ¶ï¼æä»¬æ³è¦è¿åçæ¯åå«å¼å¸¸ä¿¡æ¯çjsonæ°æ®ãè¿åæ­£å¸¸çä¿¡æ¯åå¼å¸¸ä¿¡æ¯çæ ¼å¼ä¸è´åã\n\n\n# æä½\n\n 1. èªå®ä¹jsonè¿åçæ ¼å¼\n\nlibs/response.py\n\nfrom rest_framework.response import response\n\n\nclass jsonresponse(response):\n    def __init__(self, data=none, code=none, msg=none, status=none,\n                 template_name=none, headers=none,\n                 exception=false, content_type=none):\n        rsp_data = {"code": code, "message": msg, "data": data}\n        super(jsonresponse, self).__init__(data=rsp_data, status=status, template_name=template_name,\n                                                 headers=headers,\n                                                 exception=exception, content_type=content_type)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n 2. èªå®ä¹å¨å±çå¼å¸¸å¤çæ¹æ³ libs/exceptions.py\n\n\nfrom rest_framework import status\nfrom rest_framework.views import exception_handler\nfrom libs.response import jsonresponse\n\n\nclass dataexception(exception):\n\n    def __init__(self, message="", code=0, status=status.http_400_bad_request, data=none):\n        self.code = code\n        self.status = status\n        self.detail = message\n        self.data = data if data else {}\n\n        def __str__(self):\n            return self.message\n\n\ndef custom_exception_handler(exc, context):\n    data = exc.data if hasattr(exc, "data") else {}\n    return jsonresponse(msg=exc.detail, status=exc.status_code, data=data, code=exc.status_code)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n 3. å°è¯¥å¼å¸¸æ¹æ³æ³¨åå°rest_frameworkæ¡æ¶ä¸­ settings.py\n\nrest_framework = {\n    \'exception_handler\': \'libs.exceptions.custom_exception_handler\',\n}\n\n\n1\n2\n3\n',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"django rest_framework èªå®ä¹ææ¡£",frontmatter:{title:"django rest_framework èªå®ä¹ææ¡£",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/c3af6a/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"django rest_framework èªå¨çæææ¡£çåè½ï¼è½å¤å¾å¥½çç»åç«¯æä¾å¸®å©ï¼å¨ææ¡£ä¸­å¯ä»¥çå°apiçåæ°åå¶æä¾çåè½ä¿¡æ¯ï¼å¹¶ä¸è¿è½å¤å¨ä¸é¢ç´æ¥æµè¯apiæ¥å£ã",feed:{enable:!0},tags:["python","django"],categories:["ç¼ç¨","python","django"],comment:!0,meta:[{name:"twitter:title",content:"django rest_framework èªå®ä¹ææ¡£"},{name:"twitter:description",content:"django rest_framework èªå¨çæææ¡£çåè½ï¼è½å¤å¾å¥½çç»åç«¯æä¾å¸®å©ï¼å¨ææ¡£ä¸­å¯ä»¥çå°apiçåæ°åå¶æä¾çåè½ä¿¡æ¯ï¼å¹¶ä¸è¿è½å¤å¨ä¸é¢ç´æ¥æµè¯apiæ¥å£ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/05.django%20rest_framework%20%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E6%A1%A3.html"},{property:"og:type",content:"article"},{property:"og:title",content:"django rest_framework èªå®ä¹ææ¡£"},{property:"og:description",content:"django rest_framework èªå¨çæææ¡£çåè½ï¼è½å¤å¾å¥½çç»åç«¯æä¾å¸®å©ï¼å¨ææ¡£ä¸­å¯ä»¥çå°apiçåæ°åå¶æä¾çåè½ä¿¡æ¯ï¼å¹¶ä¸è¿è½å¤å¨ä¸é¢ç´æ¥æµè¯apiæ¥å£ã"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/05.django%20rest_framework%20%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E6%A1%A3.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"django rest_framework èªå®ä¹ææ¡£"},{itemprop:"description",content:"django rest_framework èªå¨çæææ¡£çåè½ï¼è½å¤å¾å¥½çç»åç«¯æä¾å¸®å©ï¼å¨ææ¡£ä¸­å¯ä»¥çå°apiçåæ°åå¶æä¾çåè½ä¿¡æ¯ï¼å¹¶ä¸è¿è½å¤å¨ä¸é¢ç´æ¥æµè¯apiæ¥å£ã"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/05.django%20rest_framework%20%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E6%A1%A3.html",relativePath:"04.ç¼ç¨/01.python/06.django/05.django rest_framework èªå®ä¹ææ¡£.md",key:"v-2c646377",path:"/pages/c3af6a/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"éç½®",slug:"éç½®",normalizedTitle:"éç½®",charIndex:102},{level:2,title:"èªå®ä¹ææ¡£",slug:"èªå®ä¹ææ¡£",normalizedTitle:"èªå®ä¹ææ¡£",charIndex:293},{level:2,title:"schema",slug:"schema",normalizedTitle:"schema",charIndex:335},{level:3,title:"æ¹æ³ä¸",slug:"æ¹æ³ä¸",normalizedTitle:"æ¹æ³ä¸",charIndex:371},{level:3,title:"æ¹æ³äº",slug:"æ¹æ³äº",normalizedTitle:"æ¹æ³äº",charIndex:3082},{level:2,title:"location",slug:"location",normalizedTitle:"location",charIndex:3219}],headersStr:"ç®ä» éç½® èªå®ä¹ææ¡£ schema æ¹æ³ä¸ æ¹æ³äº location",content:'# ç®ä»\n\ndjango rest_framework èªå¨çæææ¡£çåè½ï¼è½å¤å¾å¥½çç»åç«¯æä¾å¸®å©ï¼å¨ææ¡£ä¸­å¯ä»¥çå°apiçåæ°åå¶æä¾çåè½ä¿¡æ¯ï¼å¹¶ä¸è¿è½å¤å¨ä¸é¢ç´æ¥æµè¯apiæ¥å£ã\n\nå®ç½\n\n\n# éç½®\n\nurls.py\n\nfrom rest_framework.documentation import include_docs_urls\n\nurlpatterns = [\n    ...\n    url(r\'^docs/\', include_docs_urls(title=\'My API title\'))]\n\n\n1\n2\n3\n4\n5\n\n\nå³å¯ä½¿ç¨è¯¥urlå¯¹ææ¡£çè®¿é®\n\n\n# èªå®ä¹ææ¡£\n\nè½ç¶å¯ä»¥èªå¨çæææ¡£ï¼ä½æ¯ä¸æ¯å¾å®åï¼æä»¥éè¦èªå®ä¹åææ¡£ã\n\n\n# schema\n\néè¿æ¹åAutoSchemaæ¥å®æèªå®ä¹ææ¡£ã\n\n\n# æ¹æ³ä¸\n\nget_linkæ¯AutoSchemaä¸­çå½æ°. éåget_linkå½æ°ï¼å¯¹ææ¡£ä¸­çæ¯ä¸ªå­æ®µçè¯´æè¿è¡æ¹åã\n\néæAutoSchemaï¼å¨__init__åå§åparams_desc_dictåæ°ï¼è¯¥åæ°åå«ææ¡£ä¸­å­æ®µå¯¹åºçæ³¨éï¼ç¶åå¨get_linkå¯¹è¯¥åæ°è¿è¡è§£æï¼å¹¶æ¿æ¢å­æ®µæ³¨é.\n\nclass BaseSchema(AutoSchema):\n    """\n    èªå¨çæçææ¡£ä¼æç¼ºå¤±ï¼æèæ¯å ä¸ºå¯è¯»æ§æ¯è¾å·®ãæä»¥éè¦å¯¹ææ¡£ä¸­çå­æ®µè¿è¡èªå®ä¹æ³¨è§£ã\n    è¯¥ç±»æ¯éç¨çå¯¹ææ¡£ä¸­çgetãpostãputãdeleteãpatchè¿è¡æ³¨éã\n    æ¯å¨å·²æå­æ®µçåºç¡ä¸ä¿®æ¹æ³¨é.\n    \n    `get`æ¯å¯¹getä¸­çå­æ®µè¿è¡æ³¨è§£è¯´æã\n    `other`æ¯`post`ã`put`ã`delete`ã`patch`\n    \n    ä¾å­:\n        {\n            "get": {\n                "å­æ®µå": "å¯¹è¯¥å­æ®µè¿è¡æ³¨é"\n            },\n            "post": {\n                "å­æ®µå": "å¯¹è¯¥å­æ®µè¿è¡æ³¨é"\n            }\n        }\n\n    """\n    def __init__(self, manual_fields=None, params_desc_dict=None):\n        self.params_desc_dict = {\n            "get": {\n                "page": "å½åé¡µç ",\n                "page_size": "æ¯ä¸é¡µæ¾ç¤ºçè¡æ°. é»è®¤ä¼  10æ¡"\n            },\n            "other": {\n\n            }\n        }\n\n        if params_desc_dict:\n            if \'get\' in params_desc_dict:\n                self.params_desc_dict[\'get\'].update(params_desc_dict[\'get\'])\n\n            if \'other\' in params_desc_dict:\n                self.params_desc_dict[\'other\'].update(params_desc_dict[\'other\'])\n\n        super(BaseSchema, self).__init__(manual_fields)\n\n    def get_link(self, path, method, base_url):\n        link = super(BaseSchema, self).get_link(path, method, base_url)\n\n        fields = []\n\n        params_method = \'get\' if method.lower() == \'get\' else \'other\'\n\n        for field in link.fields:\n            if field.name in self.params_desc_dict[params_method].keys():\n                field = field._replace(\n                    schema=coreschema.String(description=self.params_desc_dict[params_method][field.name]))\n\n            fields.append(field)\n\n        return coreapi.Link(\n            url=link.url,\n            action=link.action,\n            encoding=link.encoding,\n            fields=fields,\n            description=link.description\n        )\n\nperiodictaskSchema = BaseSchema(params_desc_dict={\n    \'other\': {\n        "crontab": "å®æ¶crontab. jsonã åå«çå­æ®µæ: minute, hour, day_of_week, day_of_month, month_of_year",\n        "name": "è¯¥å®æ¶ä»»å¡åç§°",\n        "task": "æ¨¡æ¿ä»»å¡å",\n        "args": "ä¼ éç»ä»»å¡æ¨¡æ¿åæ°. æ°ç»",\n        "kwargs": "ä¼ éç»ä»»å¡æ¨¡æ¿åæ°. jsonå­ç¬¦ä¸²",\n        "queue": "å°ä»»å¡æ¾å¨åªä¸ªéåä¸­.",\n        "enabled": "æ¯å¦å¼å¯è¯¥ä»»å¡. True or False. é»è®¤ä¸ºTrue",\n        "description": "å®æ¶ä»»å¡è¯´æ"\n    }\n})\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n\n\nå¨viewä¸­ç»å®èªå®ä¹çschema\n\nclass PeriodictasksViewSet(viewsets.ModelViewSet):\n    queryset = PeriodicTask.objects.all()\n    serializer_class = PeriodictaskSerializer\n    schema = periodictaskSchema\n\n\n1\n2\n3\n4\n\n\n\n# æ¹æ³äº\n\nå¦æåªæ¯æ®éçAPIViewçè¯ï¼ç´æ¥å¨AutoSchemaä¸­æ·»å å­æ®µå³å¯ã\n\ndatabaseInfoSchema = AutoSchema(manual_fields=[\n    coreapi.Field(name="db", required=True, location="query",\n                  schema=coreschema.String(description="æ°æ®åºhost, normalæèsub")),\n    coreapi.Field(name="database", location="query", schema=coreschema.String(description="æ°æ®åº")),\n    coreapi.Field(name="table", required=True, location="query", schema=coreschema.String(description="æ°æ®åºè¡¨"))\n])\n\n\n1\n2\n3\n4\n5\n6\n\n\nç»å®èªå®ä¹schema\n\nclass DataBaseInfo(APIView):\n    schema = databaseInfoSchema\n\n    def get(self, request):\n        pass\n\n\n1\n2\n3\n4\n5\n\n\n\n# location\n\nLOCATION   æè¿°\nquery      æ¥è¯¢. list\nform       è¡¨åæäº¤. post\npath       å¨urlä¸­çï¼/oozieJob/{id}/. read',normalizedContent:'# ç®ä»\n\ndjango rest_framework èªå¨çæææ¡£çåè½ï¼è½å¤å¾å¥½çç»åç«¯æä¾å¸®å©ï¼å¨ææ¡£ä¸­å¯ä»¥çå°apiçåæ°åå¶æä¾çåè½ä¿¡æ¯ï¼å¹¶ä¸è¿è½å¤å¨ä¸é¢ç´æ¥æµè¯apiæ¥å£ã\n\nå®ç½\n\n\n# éç½®\n\nurls.py\n\nfrom rest_framework.documentation import include_docs_urls\n\nurlpatterns = [\n    ...\n    url(r\'^docs/\', include_docs_urls(title=\'my api title\'))]\n\n\n1\n2\n3\n4\n5\n\n\nå³å¯ä½¿ç¨è¯¥urlå¯¹ææ¡£çè®¿é®\n\n\n# èªå®ä¹ææ¡£\n\nè½ç¶å¯ä»¥èªå¨çæææ¡£ï¼ä½æ¯ä¸æ¯å¾å®åï¼æä»¥éè¦èªå®ä¹åææ¡£ã\n\n\n# schema\n\néè¿æ¹åautoschemaæ¥å®æèªå®ä¹ææ¡£ã\n\n\n# æ¹æ³ä¸\n\nget_linkæ¯autoschemaä¸­çå½æ°. éåget_linkå½æ°ï¼å¯¹ææ¡£ä¸­çæ¯ä¸ªå­æ®µçè¯´æè¿è¡æ¹åã\n\néæautoschemaï¼å¨__init__åå§åparams_desc_dictåæ°ï¼è¯¥åæ°åå«ææ¡£ä¸­å­æ®µå¯¹åºçæ³¨éï¼ç¶åå¨get_linkå¯¹è¯¥åæ°è¿è¡è§£æï¼å¹¶æ¿æ¢å­æ®µæ³¨é.\n\nclass baseschema(autoschema):\n    """\n    èªå¨çæçææ¡£ä¼æç¼ºå¤±ï¼æèæ¯å ä¸ºå¯è¯»æ§æ¯è¾å·®ãæä»¥éè¦å¯¹ææ¡£ä¸­çå­æ®µè¿è¡èªå®ä¹æ³¨è§£ã\n    è¯¥ç±»æ¯éç¨çå¯¹ææ¡£ä¸­çgetãpostãputãdeleteãpatchè¿è¡æ³¨éã\n    æ¯å¨å·²æå­æ®µçåºç¡ä¸ä¿®æ¹æ³¨é.\n    \n    `get`æ¯å¯¹getä¸­çå­æ®µè¿è¡æ³¨è§£è¯´æã\n    `other`æ¯`post`ã`put`ã`delete`ã`patch`\n    \n    ä¾å­:\n        {\n            "get": {\n                "å­æ®µå": "å¯¹è¯¥å­æ®µè¿è¡æ³¨é"\n            },\n            "post": {\n                "å­æ®µå": "å¯¹è¯¥å­æ®µè¿è¡æ³¨é"\n            }\n        }\n\n    """\n    def __init__(self, manual_fields=none, params_desc_dict=none):\n        self.params_desc_dict = {\n            "get": {\n                "page": "å½åé¡µç ",\n                "page_size": "æ¯ä¸é¡µæ¾ç¤ºçè¡æ°. é»è®¤ä¼  10æ¡"\n            },\n            "other": {\n\n            }\n        }\n\n        if params_desc_dict:\n            if \'get\' in params_desc_dict:\n                self.params_desc_dict[\'get\'].update(params_desc_dict[\'get\'])\n\n            if \'other\' in params_desc_dict:\n                self.params_desc_dict[\'other\'].update(params_desc_dict[\'other\'])\n\n        super(baseschema, self).__init__(manual_fields)\n\n    def get_link(self, path, method, base_url):\n        link = super(baseschema, self).get_link(path, method, base_url)\n\n        fields = []\n\n        params_method = \'get\' if method.lower() == \'get\' else \'other\'\n\n        for field in link.fields:\n            if field.name in self.params_desc_dict[params_method].keys():\n                field = field._replace(\n                    schema=coreschema.string(description=self.params_desc_dict[params_method][field.name]))\n\n            fields.append(field)\n\n        return coreapi.link(\n            url=link.url,\n            action=link.action,\n            encoding=link.encoding,\n            fields=fields,\n            description=link.description\n        )\n\nperiodictaskschema = baseschema(params_desc_dict={\n    \'other\': {\n        "crontab": "å®æ¶crontab. jsonã åå«çå­æ®µæ: minute, hour, day_of_week, day_of_month, month_of_year",\n        "name": "è¯¥å®æ¶ä»»å¡åç§°",\n        "task": "æ¨¡æ¿ä»»å¡å",\n        "args": "ä¼ éç»ä»»å¡æ¨¡æ¿åæ°. æ°ç»",\n        "kwargs": "ä¼ éç»ä»»å¡æ¨¡æ¿åæ°. jsonå­ç¬¦ä¸²",\n        "queue": "å°ä»»å¡æ¾å¨åªä¸ªéåä¸­.",\n        "enabled": "æ¯å¦å¼å¯è¯¥ä»»å¡. true or false. é»è®¤ä¸ºtrue",\n        "description": "å®æ¶ä»»å¡è¯´æ"\n    }\n})\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n\n\nå¨viewä¸­ç»å®èªå®ä¹çschema\n\nclass periodictasksviewset(viewsets.modelviewset):\n    queryset = periodictask.objects.all()\n    serializer_class = periodictaskserializer\n    schema = periodictaskschema\n\n\n1\n2\n3\n4\n\n\n\n# æ¹æ³äº\n\nå¦æåªæ¯æ®éçapiviewçè¯ï¼ç´æ¥å¨autoschemaä¸­æ·»å å­æ®µå³å¯ã\n\ndatabaseinfoschema = autoschema(manual_fields=[\n    coreapi.field(name="db", required=true, location="query",\n                  schema=coreschema.string(description="æ°æ®åºhost, normalæèsub")),\n    coreapi.field(name="database", location="query", schema=coreschema.string(description="æ°æ®åº")),\n    coreapi.field(name="table", required=true, location="query", schema=coreschema.string(description="æ°æ®åºè¡¨"))\n])\n\n\n1\n2\n3\n4\n5\n6\n\n\nç»å®èªå®ä¹schema\n\nclass databaseinfo(apiview):\n    schema = databaseinfoschema\n\n    def get(self, request):\n        pass\n\n\n1\n2\n3\n4\n5\n\n\n\n# location\n\nlocation   æè¿°\nquery      æ¥è¯¢. list\nform       è¡¨åæäº¤. post\npath       å¨urlä¸­çï¼/ooziejob/{id}/. read',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"djangoåç¼©æä»¶ä¸è½½",frontmatter:{title:"djangoåç¼©æä»¶ä¸è½½",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/f2738b/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä»ç»å¨djangoä¸­ï¼å¦ä½å°æ°æ®çæzipæä»¶æä¾ç»ç¨æ·è¿è¡ä¸è½½",feed:{enable:!0},tags:["python","django"],categories:["ç¼ç¨","python","django"],comment:!0,meta:[{name:"twitter:title",content:"djangoåç¼©æä»¶ä¸è½½"},{name:"twitter:description",content:"ä»ç»å¨djangoä¸­ï¼å¦ä½å°æ°æ®çæzipæä»¶æä¾ç»ç¨æ·è¿è¡ä¸è½½"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/06.django%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD.html"},{property:"og:type",content:"article"},{property:"og:title",content:"djangoåç¼©æä»¶ä¸è½½"},{property:"og:description",content:"ä»ç»å¨djangoä¸­ï¼å¦ä½å°æ°æ®çæzipæä»¶æä¾ç»ç¨æ·è¿è¡ä¸è½½"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/06.django%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"djangoåç¼©æä»¶ä¸è½½"},{itemprop:"description",content:"ä»ç»å¨djangoä¸­ï¼å¦ä½å°æ°æ®çæzipæä»¶æä¾ç»ç¨æ·è¿è¡ä¸è½½"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/06.django%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD.html",relativePath:"04.ç¼ç¨/01.python/06.django/06.djangoåç¼©æä»¶ä¸è½½.md",key:"v-bb440a42",path:"/pages/f2738b/",headersStr:null,content:'# ç®ä»\n\néæ±: éè¦å¨è¯·æ±æ¶ï¼å°æ°æ®çæzipæä»¶æä¾ç»ç¨æ·ä¸è½½ã\n\nä¸æ³è¦å¨çæååæä¾ç»ç¨æ·ä¸è½½\n\nè§£å³: ä½¿ç¨BytesIOå¨åå­ä¸­åå¥æ°æ®ï¼èä¸æ¯è½å°å°æ¬å°ä¸­ã\n\n\n# æ å­\n\n\nfrom io import BytesIO\nimport zipfile\nfrom django.http import FileResponse\n\ndef view():\n\n    download_io = BytesIO()\n\n    with zipfile.ZipFile(pb_zip_io, "w", zipfile.ZIP_DEFLATED) as zip_fp:\n        zip_fp.open("a.txt", "w") as f:\n            f.write("hello world")\n\n\n    # æ³¨æï¼éè¦è¦å°æéæååå­çå¼å§ä½ç½®\n    download_io.seek(0)\n\n    return FileResponse(download_io, as_attachment=True, filename="a.zip")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n',normalizedContent:'# ç®ä»\n\néæ±: éè¦å¨è¯·æ±æ¶ï¼å°æ°æ®çæzipæä»¶æä¾ç»ç¨æ·ä¸è½½ã\n\nä¸æ³è¦å¨çæååæä¾ç»ç¨æ·ä¸è½½\n\nè§£å³: ä½¿ç¨bytesioå¨åå­ä¸­åå¥æ°æ®ï¼èä¸æ¯è½å°å°æ¬å°ä¸­ã\n\n\n# æ å­\n\n\nfrom io import bytesio\nimport zipfile\nfrom django.http import fileresponse\n\ndef view():\n\n    download_io = bytesio()\n\n    with zipfile.zipfile(pb_zip_io, "w", zipfile.zip_deflated) as zip_fp:\n        zip_fp.open("a.txt", "w") as f:\n            f.write("hello world")\n\n\n    # æ³¨æï¼éè¦è¦å°æéæååå­çå¼å§ä½ç½®\n    download_io.seek(0)\n\n    return fileresponse(download_io, as_attachment=true, filename="a.zip")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"django rest_frameworkä½¿ç¨pytestååæµè¯",frontmatter:{title:"django rest_frameworkä½¿ç¨pytestååæµè¯",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/c28126/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä»ç»å¨djangoçrest_frameworkä¸­å¦ä½ä½¿ç¨pytestè¿è¡ååæµè¯èä¸æ¯èªå¸¦çæµè¯æ¡æ¶ã",feed:{enable:!0},tags:["python","django"],categories:["ç¼ç¨","python","django"],comment:!0,meta:[{name:"twitter:title",content:"django rest_frameworkä½¿ç¨pytestååæµè¯"},{name:"twitter:description",content:"ä»ç»å¨djangoçrest_frameworkä¸­å¦ä½ä½¿ç¨pytestè¿è¡ååæµè¯èä¸æ¯èªå¸¦çæµè¯æ¡æ¶ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/07.django%20rest_framework%E4%BD%BF%E7%94%A8pytest%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95.html"},{property:"og:type",content:"article"},{property:"og:title",content:"django rest_frameworkä½¿ç¨pytestååæµè¯"},{property:"og:description",content:"ä»ç»å¨djangoçrest_frameworkä¸­å¦ä½ä½¿ç¨pytestè¿è¡ååæµè¯èä¸æ¯èªå¸¦çæµè¯æ¡æ¶ã"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/07.django%20rest_framework%E4%BD%BF%E7%94%A8pytest%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"django rest_frameworkä½¿ç¨pytestååæµè¯"},{itemprop:"description",content:"ä»ç»å¨djangoçrest_frameworkä¸­å¦ä½ä½¿ç¨pytestè¿è¡ååæµè¯èä¸æ¯èªå¸¦çæµè¯æ¡æ¶ã"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/07.django%20rest_framework%E4%BD%BF%E7%94%A8pytest%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95.html",relativePath:"04.ç¼ç¨/01.python/06.django/07.django rest_frameworkä½¿ç¨pytestååæµè¯.md",key:"v-50cf7a82",path:"/pages/c28126/",headers:[{level:2,title:"djangèªå¸¦æµè¯",slug:"djangèªå¸¦æµè¯",normalizedTitle:"djangèªå¸¦æµè¯",charIndex:2},{level:2,title:"rest framework",slug:"rest-framework",normalizedTitle:"rest framework",charIndex:665}],headersStr:"djangèªå¸¦æµè¯ rest framework",content:'# djangèªå¸¦æµè¯\n\n> djangoæ¬èº«èªå¸¦äºæµè¯æ¡æ¶åºï¼æ¯åºäºunittestçã\n\næ§è¡ python manager.py test ä¼å¯¹è·¯å¾æætest*.py è¿è¡æµè¯\n\nfrom django.test import TestCase\nfrom event_track.models.app import Appclass \n\nAppTestCase(TestCase):    \n    def setUp(self):        \n        App.objects.create(name="app1", package_name="package1")        \n        App.objects.create(name="app2", package_name="package2")    \n    def test_app(self):        \n        app1 = App.objects.get(name="app1")        \n        self.assertEqual(app1.package_name, "package1")        \n        app1 = App.objects.get(name="app2")        \n        self.assertEqual(app1.package_name, "package3")\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# rest framework\n\n> ä¸é¢æ¯ä¸ä¸ªç®åçæµè¯æ¡ä¾ãä½¿ç¨pytestå¯¹rest frameworkè¿è¡æµè¯\n\n1. æ·»å ä¸ä¸ªéç½®æä»¶ å·ä½çpytest-djangoå®ç½\n\n[pytest]\nDJANGO_SETTINGS_MODULE=event_track_root.settings\npython_files = tests.py test_*.py *_tests.py\n\n\n1\n2\n3\n\n\n2. åå»ºä¸ä¸ªmodel app.py\n\nfrom django.db import models\nclass App(models.Model):    \n    name = models.CharField(max_length=24)    \n    package_name = models.CharField(max_length=50, unique=True)\n\n\n1\n2\n3\n4\n\n\n> å¯¹appçmodelç±»è¿è¡å¢å æ¹æ¥çæµè¯ modelæµè¯å¿é¡»æ·»å @pytest.mark.django_dbæå¯ä»¥å¯ç¨æ°æ®åºã ä½¿ç¨APITestCaseå¯¹æ¥å£è¿è¡æµè¯\n\n3. ç¼åæµè¯ç¨ä¾ test_app.py\n\n\n@pytest.mark.django_db\n@pytest.fixture(scope="module")\ndef init_app_data():\n    App.objects.create(name="app1", package_name="package1")\n    App.objects.create(name="app2", package_name="package2")\n    App.objects.create(name="app3", package_name="package3")\n    App.objects.create(name="app4", package_name="package4")\n\nclass AppTests(APITestCase):\n\n    def test_create_app(self):\n        url = reverse(\'event_track:App-list\')\n        data_list = [{"name": "app1", "package_name": "package1"},\n                     {"name": "app2", "package_name": "package2"},\n                     {"name": "app3", "package_name": "package3"},\n                     {"name": "app4", "package_name": "package4"}\n                     ]\n\n        for data in data_list:\n            response = self.client.post(url, data)\n            self.assertEqual(response.status_code, status.HTTP_201_CREATED)\n\n        self.assertEqual(App.objects.count(), 4)\n        self.assertEqual(App.objects.get(name="app1").package_name, "package1")\n\n    @pytest.mark.usefixtures(\'init_app_data\')\n    def test_delete_app(self):\n        app = App.objects.get(package_name="package3")\n        url = reverse(\'event_track:App-detail\', [app.id])\n        response = self.client.delete(url)\n\n        self.assertEqual(App.objects.count(), 3)\n        with pytest.raises(App.DoesNotExist):\n            App.objects.get(package_name="package3")\n        self.assertEqual(response.status_code, 204)\n\n    @pytest.mark.usefixtures(\'init_app_data\')\n    def test_update_app(self):\n        app = App.objects.get(name="app4")\n        url = reverse(\'event_track:App-detail\', [app.id])\n\n        app.package_name = "package_update"\n        response = self.client.put(url, AppSerializer(app).data)\n\n        self.assertEqual(response.status_code, 200)\n        self.assertEqual(response.data[\'package_name\'], \'package_update\')\n        self.assertEqual(App.objects.get(name="app4").package_name, \'package_update\')\n\n    @pytest.mark.usefixtures(\'init_app_data\')\n    def test_list_app(self):\n        url = reverse(\'event_track:App-list\')\n        response = self.client.get(url, {\'limit\': 2, \'offset\': 2})\n\n        self.assertEqual(response.status_code, 200)\n        self.assertEqual(len(response.data[\'results\']), 2)\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n',normalizedContent:'# djangèªå¸¦æµè¯\n\n> djangoæ¬èº«èªå¸¦äºæµè¯æ¡æ¶åºï¼æ¯åºäºunittestçã\n\næ§è¡ python manager.py test ä¼å¯¹è·¯å¾æætest*.py è¿è¡æµè¯\n\nfrom django.test import testcase\nfrom event_track.models.app import appclass \n\napptestcase(testcase):    \n    def setup(self):        \n        app.objects.create(name="app1", package_name="package1")        \n        app.objects.create(name="app2", package_name="package2")    \n    def test_app(self):        \n        app1 = app.objects.get(name="app1")        \n        self.assertequal(app1.package_name, "package1")        \n        app1 = app.objects.get(name="app2")        \n        self.assertequal(app1.package_name, "package3")\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# rest framework\n\n> ä¸é¢æ¯ä¸ä¸ªç®åçæµè¯æ¡ä¾ãä½¿ç¨pytestå¯¹rest frameworkè¿è¡æµè¯\n\n1. æ·»å ä¸ä¸ªéç½®æä»¶ å·ä½çpytest-djangoå®ç½\n\n[pytest]\ndjango_settings_module=event_track_root.settings\npython_files = tests.py test_*.py *_tests.py\n\n\n1\n2\n3\n\n\n2. åå»ºä¸ä¸ªmodel app.py\n\nfrom django.db import models\nclass app(models.model):    \n    name = models.charfield(max_length=24)    \n    package_name = models.charfield(max_length=50, unique=true)\n\n\n1\n2\n3\n4\n\n\n> å¯¹appçmodelç±»è¿è¡å¢å æ¹æ¥çæµè¯ modelæµè¯å¿é¡»æ·»å @pytest.mark.django_dbæå¯ä»¥å¯ç¨æ°æ®åºã ä½¿ç¨apitestcaseå¯¹æ¥å£è¿è¡æµè¯\n\n3. ç¼åæµè¯ç¨ä¾ test_app.py\n\n\n@pytest.mark.django_db\n@pytest.fixture(scope="module")\ndef init_app_data():\n    app.objects.create(name="app1", package_name="package1")\n    app.objects.create(name="app2", package_name="package2")\n    app.objects.create(name="app3", package_name="package3")\n    app.objects.create(name="app4", package_name="package4")\n\nclass apptests(apitestcase):\n\n    def test_create_app(self):\n        url = reverse(\'event_track:app-list\')\n        data_list = [{"name": "app1", "package_name": "package1"},\n                     {"name": "app2", "package_name": "package2"},\n                     {"name": "app3", "package_name": "package3"},\n                     {"name": "app4", "package_name": "package4"}\n                     ]\n\n        for data in data_list:\n            response = self.client.post(url, data)\n            self.assertequal(response.status_code, status.http_201_created)\n\n        self.assertequal(app.objects.count(), 4)\n        self.assertequal(app.objects.get(name="app1").package_name, "package1")\n\n    @pytest.mark.usefixtures(\'init_app_data\')\n    def test_delete_app(self):\n        app = app.objects.get(package_name="package3")\n        url = reverse(\'event_track:app-detail\', [app.id])\n        response = self.client.delete(url)\n\n        self.assertequal(app.objects.count(), 3)\n        with pytest.raises(app.doesnotexist):\n            app.objects.get(package_name="package3")\n        self.assertequal(response.status_code, 204)\n\n    @pytest.mark.usefixtures(\'init_app_data\')\n    def test_update_app(self):\n        app = app.objects.get(name="app4")\n        url = reverse(\'event_track:app-detail\', [app.id])\n\n        app.package_name = "package_update"\n        response = self.client.put(url, appserializer(app).data)\n\n        self.assertequal(response.status_code, 200)\n        self.assertequal(response.data[\'package_name\'], \'package_update\')\n        self.assertequal(app.objects.get(name="app4").package_name, \'package_update\')\n\n    @pytest.mark.usefixtures(\'init_app_data\')\n    def test_list_app(self):\n        url = reverse(\'event_track:app-list\')\n        response = self.client.get(url, {\'limit\': 2, \'offset\': 2})\n\n        self.assertequal(response.status_code, 200)\n        self.assertequal(len(response.data[\'results\']), 2)\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"django restframework choice èªå®ä¹è¾åºæ°æ®",frontmatter:{title:"django restframework choice èªå®ä¹è¾åºæ°æ®",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/b90015/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä»ç»å¦ä½å¨django restframeworkä¸­ä½¿ç¨choiceæ¥èªå®ä¹è¾åºæ°æ®ã",feed:{enable:!0},tags:["python","django"],categories:["ç¼ç¨","python","django"],comment:!0,meta:[{name:"twitter:title",content:"django restframework choice èªå®ä¹è¾åºæ°æ®"},{name:"twitter:description",content:"ä»ç»å¦ä½å¨django restframeworkä¸­ä½¿ç¨choiceæ¥èªå®ä¹è¾åºæ°æ®ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/08.django%20restframework%20choice%20%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E6%95%B0%E6%8D%AE.html"},{property:"og:type",content:"article"},{property:"og:title",content:"django restframework choice èªå®ä¹è¾åºæ°æ®"},{property:"og:description",content:"ä»ç»å¦ä½å¨django restframeworkä¸­ä½¿ç¨choiceæ¥èªå®ä¹è¾åºæ°æ®ã"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/08.django%20restframework%20choice%20%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E6%95%B0%E6%8D%AE.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"django restframework choice èªå®ä¹è¾åºæ°æ®"},{itemprop:"description",content:"ä»ç»å¦ä½å¨django restframeworkä¸­ä½¿ç¨choiceæ¥èªå®ä¹è¾åºæ°æ®ã"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/08.django%20restframework%20choice%20%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E6%95%B0%E6%8D%AE.html",relativePath:"04.ç¼ç¨/01.python/06.django/08.django restframework choice èªå®ä¹è¾åºæ°æ®.md",key:"v-6e6e165e",path:"/pages/b90015/",headers:[{level:2,title:"é®é¢",slug:"é®é¢",normalizedTitle:"é®é¢",charIndex:2},{level:2,title:"è§£å³æ¹æ¡",slug:"è§£å³æ¹æ¡",normalizedTitle:"è§£å³æ¹æ¡",charIndex:502}],headersStr:"é®é¢ è§£å³æ¹æ¡",content:"# é®é¢\n\nææä¸ä¸ªè¿æ ·çéæ±ï¼è¿åçæ°æ®jsonä¸­è¿åçæ¯idï¼ä½æ¯ææ³è¦å¾å°è¯¥idå¯¹åºçnameã\n\nidå¯¹åºçname\n\nPlatformType = (   \n    (0, 'éç¨'),   \n    (1, 'åè£'),   \n    (2, 'åè£'),   \n    (3, 'æµ·å¤åè£'),   \n    (4, 'æµ·å¤åè£'),   \n    (5, 'å°ç³»ç»')\n)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nclass TrackSerializer(serializers.ModelSerializer):\n    \n    platform = serializers.ChoiceField(choices=PlatformType)\n    \n    class Meta:    \n        model = Track    \n        fields = \"__all__\"\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¿åçç»ææ¯:\n\n{\n    platform: 1\n}\n\n\n1\n2\n3\n\n\nä½æ¯ææ³è¦çæ¯1å¯¹åºçåè£ï¼è¿ä¸ªæ¶åéè¦èªå®ä¹è¿åçæ°æ®ã\n\n\n# è§£å³æ¹æ¡\n\n 1. èªå®ä¹å­æ®µç±»åï¼éåChoiceFieldå­æ®µç±»ï¼å¹¶éåto_representationæ¹æ³ï¼å¨åºååplatformå­æ®µæ¶ï¼ä¼è°ç¨to_representationæ¹æ³è½¬æ¢ææä»¬æ³è¦çæ ¼å¼ã\n\nclass PlatFormField(serializers.ChoiceField):    \n    def to_representation(self, value: Any):        \n        return self.choices[value]\n\nclass TrackSerializer(serializers.ModelSerializer):\n    \n    platform = PlatFormField(choices=PlatformType)\n    \n    class Meta:    \n        model = Track    \n        fields = \"__all__\"\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n 2. éåæ¾ç¤ºçå­æ®µã\n\nå°platformå­æ®µéæ°è¿è¡æ¹åï¼è·åå¶æ¾ç¤ºçåå­ã\n\nclass TrackSerializer(serializers.ModelSerializer):\n    platform = serializers.SerializerMethodField()\n    class Meta:\n        model = Track\n        fields = \"__all__\"\n\ndef get_platform(self, obj):\n    return obj.get_platform_display()\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n",normalizedContent:"# é®é¢\n\nææä¸ä¸ªè¿æ ·çéæ±ï¼è¿åçæ°æ®jsonä¸­è¿åçæ¯idï¼ä½æ¯ææ³è¦å¾å°è¯¥idå¯¹åºçnameã\n\nidå¯¹åºçname\n\nplatformtype = (   \n    (0, 'éç¨'),   \n    (1, 'åè£'),   \n    (2, 'åè£'),   \n    (3, 'æµ·å¤åè£'),   \n    (4, 'æµ·å¤åè£'),   \n    (5, 'å°ç³»ç»')\n)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nclass trackserializer(serializers.modelserializer):\n    \n    platform = serializers.choicefield(choices=platformtype)\n    \n    class meta:    \n        model = track    \n        fields = \"__all__\"\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¿åçç»ææ¯:\n\n{\n    platform: 1\n}\n\n\n1\n2\n3\n\n\nä½æ¯ææ³è¦çæ¯1å¯¹åºçåè£ï¼è¿ä¸ªæ¶åéè¦èªå®ä¹è¿åçæ°æ®ã\n\n\n# è§£å³æ¹æ¡\n\n 1. èªå®ä¹å­æ®µç±»åï¼éåchoicefieldå­æ®µç±»ï¼å¹¶éåto_representationæ¹æ³ï¼å¨åºååplatformå­æ®µæ¶ï¼ä¼è°ç¨to_representationæ¹æ³è½¬æ¢ææä»¬æ³è¦çæ ¼å¼ã\n\nclass platformfield(serializers.choicefield):    \n    def to_representation(self, value: any):        \n        return self.choices[value]\n\nclass trackserializer(serializers.modelserializer):\n    \n    platform = platformfield(choices=platformtype)\n    \n    class meta:    \n        model = track    \n        fields = \"__all__\"\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n 2. éåæ¾ç¤ºçå­æ®µã\n\nå°platformå­æ®µéæ°è¿è¡æ¹åï¼è·åå¶æ¾ç¤ºçåå­ã\n\nclass trackserializer(serializers.modelserializer):\n    platform = serializers.serializermethodfield()\n    class meta:\n        model = track\n        fields = \"__all__\"\n\ndef get_platform(self, obj):\n    return obj.get_platform_display()\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n",charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"django Filtering ä½¿ç¨",frontmatter:{title:"django Filtering ä½¿ç¨",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/cfdb5f/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä»ç»django-filteræ¯å¦ä½ä½¿ç¨çã",feed:{enable:!0},tags:["python","django"],categories:["ç¼ç¨","python","django"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604217188654.png#alt="},{name:"twitter:title",content:"django Filtering ä½¿ç¨"},{name:"twitter:description",content:"ä»ç»django-filteræ¯å¦ä½ä½¿ç¨çã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604217188654.png#alt="},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/09.django%20Filtering%20%E4%BD%BF%E7%94%A8.html"},{property:"og:type",content:"article"},{property:"og:title",content:"django Filtering ä½¿ç¨"},{property:"og:description",content:"ä»ç»django-filteræ¯å¦ä½ä½¿ç¨çã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604217188654.png#alt="},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/09.django%20Filtering%20%E4%BD%BF%E7%94%A8.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"django Filtering ä½¿ç¨"},{itemprop:"description",content:"ä»ç»django-filteræ¯å¦ä½ä½¿ç¨çã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604217188654.png#alt="}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/09.django%20Filtering%20%E4%BD%BF%E7%94%A8.html",relativePath:"04.ç¼ç¨/01.python/06.django/09.django Filtering ä½¿ç¨.md",key:"v-72f4b6b0",path:"/pages/cfdb5f/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"åå¤å·¥ä½",slug:"åå¤å·¥ä½",normalizedTitle:"åå¤å·¥ä½",charIndex:157},{level:2,title:"DjangoFilterBackend",slug:"djangofilterbackend",normalizedTitle:"djangofilterbackend",charIndex:97},{level:2,title:"ä½¿ç¨é»è®¤çè¿æ»¤",slug:"ä½¿ç¨é»è®¤çè¿æ»¤",normalizedTitle:"ä½¿ç¨é»è®¤çè¿æ»¤",charIndex:334},{level:2,title:"èªå®ä¹è¿æ»¤",slug:"èªå®ä¹è¿æ»¤",normalizedTitle:"èªå®ä¹è¿æ»¤",charIndex:801},{level:2,title:"SearchFilter",slug:"searchfilter",normalizedTitle:"searchfilter",charIndex:121},{level:2,title:"OrderingFilter",slug:"orderingfilter",normalizedTitle:"orderingfilter",charIndex:138},{level:2,title:"èªå®ä¹è¿æ»¤æ¡ä»¶",slug:"èªå®ä¹è¿æ»¤æ¡ä»¶",normalizedTitle:"èªå®ä¹è¿æ»¤æ¡ä»¶",charIndex:2994}],headersStr:"ç®ä» åå¤å·¥ä½ DjangoFilterBackend ä½¿ç¨é»è®¤çè¿æ»¤ èªå®ä¹è¿æ»¤ SearchFilter OrderingFilter èªå®ä¹è¿æ»¤æ¡ä»¶",content:"# ç®ä»\n\ndjango-filteræ¯åç¬çä¸ä¸ªåºï¼ä¸å±äºdjangorestframeworkä¸­çï¼å±äºå¤é¨åºå¼ç¨è¿æ¥ä½¿ç¨ãä¸é¢å°±æ¥ä»ç»ä¸filter\n\næä¸ç§filteræ¹å¼:\n\n 1. DjangoFilterBackend\n 2. SearchFilter\n 3. OrderingFilter\n\n\n# åå¤å·¥ä½\n\né¦åéè¦å®è£django-filter\n\n> pip install django-filter\n\nç¶åéè¦å°django_filters æ·»å å° INSTALLED_APPSä¸­\n\nINSTALLED_APPS = [\n    'django_filters',\n]\n\n\n1\n2\n3\n\n\n\n# DjangoFilterBackend\n\n\n# ä½¿ç¨é»è®¤çè¿æ»¤\n\nå¨Viewä¸­æ·»å filter_backendså±æ§,è®¾ç½®è¿æ»¤æ¹å¼DjangoFilterBackendï¼å¹¶ä¸è®¾ç½®è¿æ»¤çå±æ§ã\n\n\nfrom django_filters.rest_framework import DjangoFilterBackend\n\nclass GoodsListViewSet(ModelViewSet):    \n    queryset = Goods.objects.all()    \n    serializer_class = GoodsSerializer    \n    pagination_class = MyPagination    \n    filter_backends = (DjangoFilterBackend,)    \n    filterset_fields = ('name', 'shop_price')\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¨è°è¯çé¢ä¸­ä¼åºç°è¿æ»¤å¨éé¡¹, å¯ä»¥å¨å¶ä¸­è¿æ»¤nameåshop_priceä¸¤ä¸ªå±æ§çå¼\n\n\n# èªå®ä¹è¿æ»¤\n\nåå»ºfilters.pyï¼å¨éé¢å®ä¹èªå·±çè¿æ»¤å¨ã å¯ä»¥éè¿æå°çä»·æ ¼ãæå¤§çä»·æ ¼ï¼åæ¨¡ç³æ¥è¯¢åå­å»è¿æ»¤æ³è¦çæ°æ®ã\n\nfrom django_filters import FilterSet, NumberFilter, CharFilter\nfrom .models import Goods\n\nclass GoodsFilter(FilterSet):   \n    \"\"\"    ååçè¿æ»¤ç±»    \"\"\"    \n    price_min = NumberFilter(field_name='shop_price', help_text=\"æä½ä»·æ ¼\", lookup_expr='gte')    \n    price_max = NumberFilter(field_name='shop_price', lookup_expr='lte')    \n    name = CharFilter(field_name='name', lookup_expr=\"icontains\")    \n    class Meta:        \n        model = Goods        \n        fields = ['price_min', 'price_max', 'name']\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå°è¯¥è¿æ»¤å¨æ·»å å°viewä¸­ view.py\n\nclass GoodsListViewSet(ModelViewSet):    \n    queryset = Goods.objects.all()    \n    serializer_class = GoodsSerializer   \n    pagination_class = MyPagination    \n    filter_backends = (DjangoFilterBackend,)    \n    filter_class = GoodsFilter\n\n\n1\n2\n3\n4\n5\n6\n\n\næåå¯ä»¥éè¿ http://127.0.0.1:8000/goods/?price_min=150&price_max=160&name=æ°´æ å»è¿æ»¤å¾å°æ³è¦çæ°æ®ã\n\n\n# SearchFilter\n\nè¿ä¸ªFilteræ¯åºäºDjangoçæç´¢ãç°å¨æä»¬å°SearchFilteréæå°è¿æ»¤éé¢æ¥ãå¨filter_backendsä¸­æ·»å SearchFilerï¼ç¶ååå¨search_fieldsä¸­æ·»å éè¦æç´¢çå­æ®µå³å¯ï¼å¨æç´¢çå­æ®µåé¢å­ç¬¦åéæ¥æé«æç´¢æçã\n\n * '^' Starts-with search.\n * '=' Exact matches.\n * '@' Full-text search. (Currently only supported Django's MySQL backend.)\n * '$' Regex search.\n\nview.py\n\nfrom rest_framework.filters import SearchFilter\n\nclass GoodsListViewSet(ModelViewSet):    \n    queryset = Goods.objects.all()    \n    serializer_class = GoodsSerializer    \n    pagination_class = MyPagination    \n    filter_backends = (DjangoFilterBackend, SearchFilter)    \n    filter_class = GoodsFilter    \n    search_fields = (\"=name\", 'goods_brief', 'goods_desc')\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# OrderingFilter\n\nå¯ä»¥å¯¹æ°æ®è¿è¡æåºç­éæ°æ®ãæä»¬å°å¶å å¥è¿å»\n\nview.py\n\nfrom rest_framework.filters import SearchFilter, OrderingFilter\n\n\n\nclass GoodsListViewSet(ModelViewSet):    \n    queryset = Goods.objects.all()    \n    serializer_class = GoodsSerializer    \n    pagination_class = MyPagination    \n    filter_backends = (DjangoFilterBackend, SearchFilter, OrderingFilter) \n    filter_class = GoodsFilter    \n    search_fields = (\"=name\", 'goods_brief', 'goods_desc')\n    ordering_fields = (\"sold_num\", \"add_time\")\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# èªå®ä¹è¿æ»¤æ¡ä»¶\n\nä¿®æ¹filters.pyæä»¶ï¼ç¼åè¿æ»¤æ¹æ³top_category_filterç»å®å°top_categoryå­æ®µä¸­ï¼å³å¯éè¿è¯¥å±æ§åè¿è¡ç¸åºçç­éã\n\nclass GoodsFilter(FilterSet):    \n    \"\"\"    ååçè¿æ»¤ç±»    \"\"\"    \n    pricemin = NumberFilter(field_name='shop_price', help_text=\"æä½ä»·æ ¼\", lookup_expr='gte')    \n    pricemax = NumberFilter(field_name='shop_price', lookup_expr='lte')    \n    name = CharFilter(field_name='name', lookup_expr=\"icontains\")   \n    top_category = NumberFilter(method='top_category_filter')    \n    \n    def top_category_filter(self, queryset, name, value):        \n        return queryset.filter(Q(category_id=value) | Q(category__parent_category_id=value) | (category__parent_category__parent_category_id=value))\n    \n    class Meta:        \n        model = Goods\n        fields = ['pricemin', 'pricemax', 'name']\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n",normalizedContent:"# ç®ä»\n\ndjango-filteræ¯åç¬çä¸ä¸ªåºï¼ä¸å±äºdjangorestframeworkä¸­çï¼å±äºå¤é¨åºå¼ç¨è¿æ¥ä½¿ç¨ãä¸é¢å°±æ¥ä»ç»ä¸filter\n\næä¸ç§filteræ¹å¼:\n\n 1. djangofilterbackend\n 2. searchfilter\n 3. orderingfilter\n\n\n# åå¤å·¥ä½\n\né¦åéè¦å®è£django-filter\n\n> pip install django-filter\n\nç¶åéè¦å°django_filters æ·»å å° installed_appsä¸­\n\ninstalled_apps = [\n    'django_filters',\n]\n\n\n1\n2\n3\n\n\n\n# djangofilterbackend\n\n\n# ä½¿ç¨é»è®¤çè¿æ»¤\n\nå¨viewä¸­æ·»å filter_backendså±æ§,è®¾ç½®è¿æ»¤æ¹å¼djangofilterbackendï¼å¹¶ä¸è®¾ç½®è¿æ»¤çå±æ§ã\n\n\nfrom django_filters.rest_framework import djangofilterbackend\n\nclass goodslistviewset(modelviewset):    \n    queryset = goods.objects.all()    \n    serializer_class = goodsserializer    \n    pagination_class = mypagination    \n    filter_backends = (djangofilterbackend,)    \n    filterset_fields = ('name', 'shop_price')\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¨è°è¯çé¢ä¸­ä¼åºç°è¿æ»¤å¨éé¡¹, å¯ä»¥å¨å¶ä¸­è¿æ»¤nameåshop_priceä¸¤ä¸ªå±æ§çå¼\n\n\n# èªå®ä¹è¿æ»¤\n\nåå»ºfilters.pyï¼å¨éé¢å®ä¹èªå·±çè¿æ»¤å¨ã å¯ä»¥éè¿æå°çä»·æ ¼ãæå¤§çä»·æ ¼ï¼åæ¨¡ç³æ¥è¯¢åå­å»è¿æ»¤æ³è¦çæ°æ®ã\n\nfrom django_filters import filterset, numberfilter, charfilter\nfrom .models import goods\n\nclass goodsfilter(filterset):   \n    \"\"\"    ååçè¿æ»¤ç±»    \"\"\"    \n    price_min = numberfilter(field_name='shop_price', help_text=\"æä½ä»·æ ¼\", lookup_expr='gte')    \n    price_max = numberfilter(field_name='shop_price', lookup_expr='lte')    \n    name = charfilter(field_name='name', lookup_expr=\"icontains\")    \n    class meta:        \n        model = goods        \n        fields = ['price_min', 'price_max', 'name']\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå°è¯¥è¿æ»¤å¨æ·»å å°viewä¸­ view.py\n\nclass goodslistviewset(modelviewset):    \n    queryset = goods.objects.all()    \n    serializer_class = goodsserializer   \n    pagination_class = mypagination    \n    filter_backends = (djangofilterbackend,)    \n    filter_class = goodsfilter\n\n\n1\n2\n3\n4\n5\n6\n\n\næåå¯ä»¥éè¿ http://127.0.0.1:8000/goods/?price_min=150&price_max=160&name=æ°´æ å»è¿æ»¤å¾å°æ³è¦çæ°æ®ã\n\n\n# searchfilter\n\nè¿ä¸ªfilteræ¯åºäºdjangoçæç´¢ãç°å¨æä»¬å°searchfilteréæå°è¿æ»¤éé¢æ¥ãå¨filter_backendsä¸­æ·»å searchfilerï¼ç¶ååå¨search_fieldsä¸­æ·»å éè¦æç´¢çå­æ®µå³å¯ï¼å¨æç´¢çå­æ®µåé¢å­ç¬¦åéæ¥æé«æç´¢æçã\n\n * '^' starts-with search.\n * '=' exact matches.\n * '@' full-text search. (currently only supported django's mysql backend.)\n * '$' regex search.\n\nview.py\n\nfrom rest_framework.filters import searchfilter\n\nclass goodslistviewset(modelviewset):    \n    queryset = goods.objects.all()    \n    serializer_class = goodsserializer    \n    pagination_class = mypagination    \n    filter_backends = (djangofilterbackend, searchfilter)    \n    filter_class = goodsfilter    \n    search_fields = (\"=name\", 'goods_brief', 'goods_desc')\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# orderingfilter\n\nå¯ä»¥å¯¹æ°æ®è¿è¡æåºç­éæ°æ®ãæä»¬å°å¶å å¥è¿å»\n\nview.py\n\nfrom rest_framework.filters import searchfilter, orderingfilter\n\n\n\nclass goodslistviewset(modelviewset):    \n    queryset = goods.objects.all()    \n    serializer_class = goodsserializer    \n    pagination_class = mypagination    \n    filter_backends = (djangofilterbackend, searchfilter, orderingfilter) \n    filter_class = goodsfilter    \n    search_fields = (\"=name\", 'goods_brief', 'goods_desc')\n    ordering_fields = (\"sold_num\", \"add_time\")\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# èªå®ä¹è¿æ»¤æ¡ä»¶\n\nä¿®æ¹filters.pyæä»¶ï¼ç¼åè¿æ»¤æ¹æ³top_category_filterç»å®å°top_categoryå­æ®µä¸­ï¼å³å¯éè¿è¯¥å±æ§åè¿è¡ç¸åºçç­éã\n\nclass goodsfilter(filterset):    \n    \"\"\"    ååçè¿æ»¤ç±»    \"\"\"    \n    pricemin = numberfilter(field_name='shop_price', help_text=\"æä½ä»·æ ¼\", lookup_expr='gte')    \n    pricemax = numberfilter(field_name='shop_price', lookup_expr='lte')    \n    name = charfilter(field_name='name', lookup_expr=\"icontains\")   \n    top_category = numberfilter(method='top_category_filter')    \n    \n    def top_category_filter(self, queryset, name, value):        \n        return queryset.filter(q(category_id=value) | q(category__parent_category_id=value) | (category__parent_category__parent_category_id=value))\n    \n    class meta:        \n        model = goods\n        fields = ['pricemin', 'pricemax', 'name']\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n",charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"django viewset å Router éåä½¿ç¨æ¶æ¥çé",frontmatter:{title:"django viewset å Router éåä½¿ç¨æ¶æ¥çé",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/e75ceb/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"è§£å³django viewsetårouteréåä½¿ç¨æ¶æ¥çéè¯¯",feed:{enable:!0},tags:["python","django"],categories:["ç¼ç¨","python","django"],comment:!0,meta:[{name:"twitter:title",content:"django viewset å Router éåä½¿ç¨æ¶æ¥çé"},{name:"twitter:description",content:"è§£å³django viewsetårouteréåä½¿ç¨æ¶æ¥çéè¯¯"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/10.django%20viewset%20%E5%92%8C%20Router%20%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8%E6%97%B6%E6%8A%A5%E7%9A%84%E9%94%99.html"},{property:"og:type",content:"article"},{property:"og:title",content:"django viewset å Router éåä½¿ç¨æ¶æ¥çé"},{property:"og:description",content:"è§£å³django viewsetårouteréåä½¿ç¨æ¶æ¥çéè¯¯"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/10.django%20viewset%20%E5%92%8C%20Router%20%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8%E6%97%B6%E6%8A%A5%E7%9A%84%E9%94%99.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"django viewset å Router éåä½¿ç¨æ¶æ¥çé"},{itemprop:"description",content:"è§£å³django viewsetårouteréåä½¿ç¨æ¶æ¥çéè¯¯"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/10.django%20viewset%20%E5%92%8C%20Router%20%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8%E6%97%B6%E6%8A%A5%E7%9A%84%E9%94%99.html",relativePath:"04.ç¼ç¨/01.python/06.django/10.django viewset å Router éåä½¿ç¨æ¶æ¥çé.md",key:"v-3e16c4d8",path:"/pages/e75ceb/",headersStr:null,content:"æ¥éåå®¹:\n\n> 'basename' argument not specified, and could not automatically determine the name from the viewset, as it does not have a '.queryset' attribute.\n\nbasenameæ¯Router.register()ä¸­çä¸ä¸ªå±æ§ã\n\nå¦ææ²¡æè®¾ç½®basenameå°ä¼èªå¨çåºäºviewsetä¸­çquerysetå±æ§ãå¦æä¸ä½¿ç¨querysetå±æ§ï¼èªå®ä¹get_quertsetæ¹æ³ï¼é£ä¹éè¦è®¾ç½®basenameåæ°ã\n\nç¤ºä¾ä»£ç å¦ä¸. è¿éä½¿ç¨äºèªå®ä¹çget_quertsetæ¹æ³ï¼æä»¥router.register()ä¸­å¿é¡»å ä¸basenameï¼ä¸ç¶ä¼åºç°ä»¥ä¸éè¯¯ view.py\n\nclass GoodsListViewSet(ModelViewSet):    \n    # queryset = Goods.objects.all()    \n    serializer_class = GoodsSerializer    \n    pagination_class = MyPagination    \n    \n    def get_queryset(self):        \n        queryset = Goods.objects.all()        \n        price_min = self.request.query_params.get(\"price_min\", 0)        \n        if price_min:            \n            queryset = queryset.filter(shop_price__gt=int(price_min))        \n    \n    return queryset\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nurl.py\n\nfrom rest_framework.routers import DefaultRouter\nrouter = DefaultRouter()\nrouter.register(r'goods', GoodsListViewSet, base_name=\"goods\")\n\n\n1\n2\n3\n",normalizedContent:"æ¥éåå®¹:\n\n> 'basename' argument not specified, and could not automatically determine the name from the viewset, as it does not have a '.queryset' attribute.\n\nbasenameæ¯router.register()ä¸­çä¸ä¸ªå±æ§ã\n\nå¦ææ²¡æè®¾ç½®basenameå°ä¼èªå¨çåºäºviewsetä¸­çquerysetå±æ§ãå¦æä¸ä½¿ç¨querysetå±æ§ï¼èªå®ä¹get_quertsetæ¹æ³ï¼é£ä¹éè¦è®¾ç½®basenameåæ°ã\n\nç¤ºä¾ä»£ç å¦ä¸. è¿éä½¿ç¨äºèªå®ä¹çget_quertsetæ¹æ³ï¼æä»¥router.register()ä¸­å¿é¡»å ä¸basenameï¼ä¸ç¶ä¼åºç°ä»¥ä¸éè¯¯ view.py\n\nclass goodslistviewset(modelviewset):    \n    # queryset = goods.objects.all()    \n    serializer_class = goodsserializer    \n    pagination_class = mypagination    \n    \n    def get_queryset(self):        \n        queryset = goods.objects.all()        \n        price_min = self.request.query_params.get(\"price_min\", 0)        \n        if price_min:            \n            queryset = queryset.filter(shop_price__gt=int(price_min))        \n    \n    return queryset\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nurl.py\n\nfrom rest_framework.routers import defaultrouter\nrouter = defaultrouter()\nrouter.register(r'goods', goodslistviewset, base_name=\"goods\")\n\n\n1\n2\n3\n",charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"django modelçåºåå",frontmatter:{title:"django modelçåºåå",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/acdd50/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"django modelå¦ä½å®ç°åºååã",feed:{enable:!0},tags:["python","django"],categories:["ç¼ç¨","python","django"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604217291865.png#alt="},{name:"twitter:title",content:"django modelçåºåå"},{name:"twitter:description",content:"django modelå¦ä½å®ç°åºååã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604217291865.png#alt="},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/11.django%20model%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96.html"},{property:"og:type",content:"article"},{property:"og:title",content:"django modelçåºåå"},{property:"og:description",content:"django modelå¦ä½å®ç°åºååã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604217291865.png#alt="},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/11.django%20model%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"django modelçåºåå"},{itemprop:"description",content:"django modelå¦ä½å®ç°åºååã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604217291865.png#alt="}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/11.django%20model%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96.html",relativePath:"04.ç¼ç¨/01.python/06.django/11.django modelçåºåå.md",key:"v-242c57bc",path:"/pages/acdd50/",headersStr:null,content:'ç½ç»ä¼ è¾æ°æ®ç°å¨æµè¡çæ¯jsonæ°æ®æ ¼å¼ï¼æä»¥éå¸¸éè¦å°æ°æ®åºæ¥è¯¢çå°å¯¹è±¡æ°æ®åºååæjsonæ ¼å¼ï¼ç¶åè¿åç»åç«¯è¿è¡æ°æ®å±ç¤ºã\n\nä¸é¢è®¨è®ºå¨djangoä¸­å¦ä½æ´æ¹ä¾¿çå°model åºååã\n\nä¸ä¸ªgoodsçmodleå¦ä¸ã\n\n class Goods(models.Model):\n    name = models.CharField(max_length=100, verbose_name="ååå")\n    market_price = models.FloatField(default=0, verbose_name="å¸åºä»·æ ¼")\n    goods_front_image = models.ImageField(upload_to="goods/images/", null=True, blank=True, verbose_name="å°é¢å¾")    \n    .....\n\n\n\n1\n2\n3\n4\n5\n6\n\n\nåºååä¸. æåå§çmodelåºååï¼æ¯è¾ç¹ç..å¤ªä¸æºè½äº.\n\ngoodList = Goods.objects.all()[:10]\nfor good in goodList:\n    json_dict = {}\n    json_dict["name"] = good.name                    \n    json_dict["market_price"] = good.market_price\n    json_dict["add_time"] = good.add_time\n    json_list.append(json_dict)\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nåºååäº.\n\nfrom django.forms.models import model_to_dict\n\ngoodsList = Goods.objects.all()[:10]\nfor goods in goodsList:    json_list.append(model_to_dict(good))\n\n\n1\n2\n3\n4\n\n\néè¿ä½¿ç¨model_to_dict æ´æ¹ä¾¿çå»åºåågoodså¯¹è±¡ãå¯ä¸ä¸è¶³çæ¯æ æ³åºååImageFieldå­æ®µã\n\n\n\nåºååä¸.\n\ngoodsList = Goods.objects.all()[:10]\ngoods_json = serialize(\'json\', goodList)\n\n\n1\n2\n\n\nç´æ¥å°æ´ä¸ªgoods list è¿è¡åºååï¼æ´å æ¹ä¾¿çä½¿ç¨ãä½æ¯è½ç¶è½å¤å°ImageFieldåºååï¼ä½æ¯å¾å°çå¾çè·¯å¾æ¯ä»æ°æ®åºä¸­æ¿å°çï¼å¹¶ä¸æ¯å¾ççå®çè·¯å¾ï¼åç«¯æ¿å°åéè¦åå¤çæè½ä½¿ç¨ã\n\n\n\næåï¼è¿ææ²¡ææ´æ¹ä¾¿çåºååæ¹å¼å¢ï¼å½ç¶æï¼å»äºè§£ä¸djangorestframeworkå§ï¼åææä¹ä¼æåå³äºè¯¥æ¡æ¶çåå®¢ã',normalizedContent:'ç½ç»ä¼ è¾æ°æ®ç°å¨æµè¡çæ¯jsonæ°æ®æ ¼å¼ï¼æä»¥éå¸¸éè¦å°æ°æ®åºæ¥è¯¢çå°å¯¹è±¡æ°æ®åºååæjsonæ ¼å¼ï¼ç¶åè¿åç»åç«¯è¿è¡æ°æ®å±ç¤ºã\n\nä¸é¢è®¨è®ºå¨djangoä¸­å¦ä½æ´æ¹ä¾¿çå°model åºååã\n\nä¸ä¸ªgoodsçmodleå¦ä¸ã\n\n class goods(models.model):\n    name = models.charfield(max_length=100, verbose_name="ååå")\n    market_price = models.floatfield(default=0, verbose_name="å¸åºä»·æ ¼")\n    goods_front_image = models.imagefield(upload_to="goods/images/", null=true, blank=true, verbose_name="å°é¢å¾")    \n    .....\n\n\n\n1\n2\n3\n4\n5\n6\n\n\nåºååä¸. æåå§çmodelåºååï¼æ¯è¾ç¹ç..å¤ªä¸æºè½äº.\n\ngoodlist = goods.objects.all()[:10]\nfor good in goodlist:\n    json_dict = {}\n    json_dict["name"] = good.name                    \n    json_dict["market_price"] = good.market_price\n    json_dict["add_time"] = good.add_time\n    json_list.append(json_dict)\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nåºååäº.\n\nfrom django.forms.models import model_to_dict\n\ngoodslist = goods.objects.all()[:10]\nfor goods in goodslist:    json_list.append(model_to_dict(good))\n\n\n1\n2\n3\n4\n\n\néè¿ä½¿ç¨model_to_dict æ´æ¹ä¾¿çå»åºåågoodså¯¹è±¡ãå¯ä¸ä¸è¶³çæ¯æ æ³åºååimagefieldå­æ®µã\n\n\n\nåºååä¸.\n\ngoodslist = goods.objects.all()[:10]\ngoods_json = serialize(\'json\', goodlist)\n\n\n1\n2\n\n\nç´æ¥å°æ´ä¸ªgoods list è¿è¡åºååï¼æ´å æ¹ä¾¿çä½¿ç¨ãä½æ¯è½ç¶è½å¤å°imagefieldåºååï¼ä½æ¯å¾å°çå¾çè·¯å¾æ¯ä»æ°æ®åºä¸­æ¿å°çï¼å¹¶ä¸æ¯å¾ççå®çè·¯å¾ï¼åç«¯æ¿å°åéè¦åå¤çæè½ä½¿ç¨ã\n\n\n\næåï¼è¿ææ²¡ææ´æ¹ä¾¿çåºååæ¹å¼å¢ï¼å½ç¶æï¼å»äºè§£ä¸djangorestframeworkå§ï¼åææä¹ä¼æåå³äºè¯¥æ¡æ¶çåå®¢ã',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"djangoä¸­ä½¿ç¨AbStractUser",frontmatter:{title:"djangoä¸­ä½¿ç¨AbStractUser",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/382755/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä»ç»å¨djangoä¸­å¦ä½ä½¿ç¨AbStractUser",feed:{enable:!0},tags:["python","django"],categories:["ç¼ç¨","python","django"],comment:!0,meta:[{name:"twitter:title",content:"djangoä¸­ä½¿ç¨AbStractUser"},{name:"twitter:description",content:"ä»ç»å¨djangoä¸­å¦ä½ä½¿ç¨AbStractUser"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/12.django%E4%B8%AD%E4%BD%BF%E7%94%A8AbStractUser.html"},{property:"og:type",content:"article"},{property:"og:title",content:"djangoä¸­ä½¿ç¨AbStractUser"},{property:"og:description",content:"ä»ç»å¨djangoä¸­å¦ä½ä½¿ç¨AbStractUser"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/12.django%E4%B8%AD%E4%BD%BF%E7%94%A8AbStractUser.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"djangoä¸­ä½¿ç¨AbStractUser"},{itemprop:"description",content:"ä»ç»å¨djangoä¸­å¦ä½ä½¿ç¨AbStractUser"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/12.django%E4%B8%AD%E4%BD%BF%E7%94%A8AbStractUser.html",relativePath:"04.ç¼ç¨/01.python/06.django/12.djangoä¸­ä½¿ç¨AbStractUser.md",key:"v-580c8dac",path:"/pages/382755/",headersStr:null,content:"> Djangoåç½®çUserå¯¹è±¡ï¼å·²ç»åå«äºä¸äºä¸»è¦çå±æ§ï¼å¦usernameãpasswordãemailç­ï¼ä½å®éæåµå¯è½è¿éè¦æµç§°ãå¤´åç­å¶ä»å±æ§ï¼ä»ä»ä½¿ç¨åç½®çUserå±æ§æ¯ä¸å¤çã\n> \n> éè¿ä½¿ç¨AbstractUserå¯ä»¥å¯¹Userè¿è¡æ©å±ä½¿ç¨ï¼æ·»å ç¨æ·èªå®ä¹çå±æ§ã\n\nUseræ¨¡åæºç å¦ä¸ã\n\nclass User(AbstractUser):\n    class Meta(AbstractUser.Meta):\n        swappable = 'AUTH_USER_MODEL'\n\n\n1\n2\n3\n\n\nç±æ­¤å¯è§ï¼Userå¯¹AbstractUserä»ä»æ¯ç»§æ¿ï¼æ²¡æè¿è¡ä»»ä½çæ©å±ãæä»¥æä»¬ç»§æ¿AbstractUserå¯ä»¥è·å¾Userçææç¹æ§ã\n\n * modelä¸­ä½¿ç¨\n\nç»§æ¿AbstractUser\n\nfrom django.contrib.auth.models import AbstractUser\n\nclass MyUser(AbstractUser):\n    pass\n\n\n1\n2\n3\n4\n\n * å¨å±settings.pyä¸­è®¾ç½®\n\nè¦çé»è®¤çuser model\n\nAUTH_USER_MODEL = 'app.MyUser'\n\n\n1\n\n * å¨admin.pyä¸­æ³¨åMyUser\n\nfrom django.contrib import admin\nfrom .models import UserProfile\nadmin.site.register(UserProfile,UserAdmin)  \n#ç¨UserAdminå»æ³¨åUserProfile\n\n\n1\n2\n3\n4\n",normalizedContent:"> djangoåç½®çuserå¯¹è±¡ï¼å·²ç»åå«äºä¸äºä¸»è¦çå±æ§ï¼å¦usernameãpasswordãemailç­ï¼ä½å®éæåµå¯è½è¿éè¦æµç§°ãå¤´åç­å¶ä»å±æ§ï¼ä»ä»ä½¿ç¨åç½®çuserå±æ§æ¯ä¸å¤çã\n> \n> éè¿ä½¿ç¨abstractuserå¯ä»¥å¯¹userè¿è¡æ©å±ä½¿ç¨ï¼æ·»å ç¨æ·èªå®ä¹çå±æ§ã\n\nuseræ¨¡åæºç å¦ä¸ã\n\nclass user(abstractuser):\n    class meta(abstractuser.meta):\n        swappable = 'auth_user_model'\n\n\n1\n2\n3\n\n\nç±æ­¤å¯è§ï¼userå¯¹abstractuserä»ä»æ¯ç»§æ¿ï¼æ²¡æè¿è¡ä»»ä½çæ©å±ãæä»¥æä»¬ç»§æ¿abstractuserå¯ä»¥è·å¾userçææç¹æ§ã\n\n * modelä¸­ä½¿ç¨\n\nç»§æ¿abstractuser\n\nfrom django.contrib.auth.models import abstractuser\n\nclass myuser(abstractuser):\n    pass\n\n\n1\n2\n3\n4\n\n * å¨å±settings.pyä¸­è®¾ç½®\n\nè¦çé»è®¤çuser model\n\nauth_user_model = 'app.myuser'\n\n\n1\n\n * å¨admin.pyä¸­æ³¨åmyuser\n\nfrom django.contrib import admin\nfrom .models import userprofile\nadmin.site.register(userprofile,useradmin)  \n#ç¨useradminå»æ³¨åuserprofile\n\n\n1\n2\n3\n4\n",charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"django.core.exceptions.ImproperlyConfigured Application labels aren't unique, duplicates users",frontmatter:{title:"django.core.exceptions.ImproperlyConfigured Application labels aren't unique, duplicates users",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/060c51/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä½¿ç¨pycharm professional å¼ådjangoæ¶åºç°ä»¥ä¸å¼å¸¸ã",feed:{enable:!0},tags:["python","django"],categories:["ç¼ç¨","python","django"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604218742346.png#alt="},{name:"twitter:title",content:"django.core.exceptions.ImproperlyConfigured Application labels aren't unique, duplicates users"},{name:"twitter:description",content:"ä½¿ç¨pycharm professional å¼ådjangoæ¶åºç°ä»¥ä¸å¼å¸¸ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604218742346.png#alt="},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/13.django.core.exceptions.ImproperlyConfigured%20Application%20labels%20aren't%20unique,%20duplicates%20users.html"},{property:"og:type",content:"article"},{property:"og:title",content:"django.core.exceptions.ImproperlyConfigured Application labels aren't unique, duplicates users"},{property:"og:description",content:"ä½¿ç¨pycharm professional å¼ådjangoæ¶åºç°ä»¥ä¸å¼å¸¸ã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604218742346.png#alt="},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/13.django.core.exceptions.ImproperlyConfigured%20Application%20labels%20aren't%20unique,%20duplicates%20users.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"django.core.exceptions.ImproperlyConfigured Application labels aren't unique, duplicates users"},{itemprop:"description",content:"ä½¿ç¨pycharm professional å¼ådjangoæ¶åºç°ä»¥ä¸å¼å¸¸ã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604218742346.png#alt="}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/13.django.core.exceptions.ImproperlyConfigured%20Application%20labels%20aren't%20unique,%20duplicates%20users.html",relativePath:"04.ç¼ç¨/01.python/06.django/13.django.core.exceptions.ImproperlyConfigured Application labels aren't unique, duplicates users.md",key:"v-669ddbd6",path:"/pages/060c51/",headersStr:null,content:"ä½¿ç¨pycharm professional å¼ådjangoæ¶åºç°ä»¥ä¸å¼å¸¸ã\n\n> django.core.exceptions.ImproperlyConfigured: Application labels aren't unique, duplicates: users\n\næ¥æ¾èµæååç°ï¼å ä¸ºusersåºç¨éå¤äºï¼æä»¥æ¥éã\n\n> å¨ä½¿ç¨pycharm professional åå»ºdjangoé¡¹ç®æ¶ï¼å·²ç»åå»ºäºusers åºç¨ï¼å¹¶èªå¨æ·»å å°é¡¹ç®ä¸­ã\n\n\n\n> åé¢åå¨INSTALLED_APPSä¸­æ·»å usersåä¼éå¤æ·»å usersåºç¨ã\n\n",normalizedContent:"ä½¿ç¨pycharm professional å¼ådjangoæ¶åºç°ä»¥ä¸å¼å¸¸ã\n\n> django.core.exceptions.improperlyconfigured: application labels aren't unique, duplicates: users\n\næ¥æ¾èµæååç°ï¼å ä¸ºusersåºç¨éå¤äºï¼æä»¥æ¥éã\n\n> å¨ä½¿ç¨pycharm professional åå»ºdjangoé¡¹ç®æ¶ï¼å·²ç»åå»ºäºusers åºç¨ï¼å¹¶èªå¨æ·»å å°é¡¹ç®ä¸­ã\n\n\n\n> åé¢åå¨installed_appsä¸­æ·»å usersåä¼éå¤æ·»å usersåºç¨ã\n\n",charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"django ä¸­ mediaéç½®",frontmatter:{title:"django ä¸­ mediaéç½®",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/de01e2/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"mediaæä»¶å¤¹ä¸è¬ç¨äºä¸ä¼ åªä½æä»¶å°æå¡ä¸­å­æ¾çå°æ¹ãä»ç»å¨djangoä¸­å¦ä½ä½¿ç¨mediaçéç½®",feed:{enable:!0},tags:["python","django"],categories:["ç¼ç¨","python","django"],comment:!0,meta:[{name:"twitter:title",content:"django ä¸­ mediaéç½®"},{name:"twitter:description",content:"mediaæä»¶å¤¹ä¸è¬ç¨äºä¸ä¼ åªä½æä»¶å°æå¡ä¸­å­æ¾çå°æ¹ãä»ç»å¨djangoä¸­å¦ä½ä½¿ç¨mediaçéç½®"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/14.django%20%E4%B8%AD%20media%E9%85%8D%E7%BD%AE.html"},{property:"og:type",content:"article"},{property:"og:title",content:"django ä¸­ mediaéç½®"},{property:"og:description",content:"mediaæä»¶å¤¹ä¸è¬ç¨äºä¸ä¼ åªä½æä»¶å°æå¡ä¸­å­æ¾çå°æ¹ãä»ç»å¨djangoä¸­å¦ä½ä½¿ç¨mediaçéç½®"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/14.django%20%E4%B8%AD%20media%E9%85%8D%E7%BD%AE.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"django ä¸­ mediaéç½®"},{itemprop:"description",content:"mediaæä»¶å¤¹ä¸è¬ç¨äºä¸ä¼ åªä½æä»¶å°æå¡ä¸­å­æ¾çå°æ¹ãä»ç»å¨djangoä¸­å¦ä½ä½¿ç¨mediaçéç½®"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/14.django%20%E4%B8%AD%20media%E9%85%8D%E7%BD%AE.html",relativePath:"04.ç¼ç¨/01.python/06.django/14.django ä¸­ mediaéç½®.md",key:"v-5f11081e",path:"/pages/de01e2/",headersStr:null,content:'mediaæä»¶å¤¹ä¸è¬ç¨äºä¸ä¼ åªä½æä»¶å°æå¡ä¸­å­æ¾çå°æ¹ã\n\néç½®\n\n 1. å¨é¡¹ç®ä¸­åå»ºmediaæä»¶å¤¹\n\n 2. models éç½®\n\nclass UserModel(models.Model):\n    \n    # æä»¶ä¼ä¸ä¼ å° /media/usersç®å½ä¸\n    image = models.ImageField(max_length=200, upload_to="users/")\n\n\n1\n2\n3\n4\n\n 3. settings éç½®\n\nMEDIA_URL = "/media/"\nMEDIA_ROOT = os.path.join(BASE_DIR, "media")\n\n\n1\n2\n\n 4. urls.py éç½®\n\nfrom django.urls import re_path\nfrom settings import MEDIA_ROOT\n\nurlpatterns = [    \n    re_path(r\'^media/(?P<path>.*)$\', serve, {"document_root": MEDIA_ROOT})\n]\n\n\n1\n2\n3\n4\n5\n6\n\n 5. æµè¯\n\n> éè¿localhost:8000/media/user/a.jpg å¯ä»¥è®¿é®å¾ç',normalizedContent:'mediaæä»¶å¤¹ä¸è¬ç¨äºä¸ä¼ åªä½æä»¶å°æå¡ä¸­å­æ¾çå°æ¹ã\n\néç½®\n\n 1. å¨é¡¹ç®ä¸­åå»ºmediaæä»¶å¤¹\n\n 2. models éç½®\n\nclass usermodel(models.model):\n    \n    # æä»¶ä¼ä¸ä¼ å° /media/usersç®å½ä¸\n    image = models.imagefield(max_length=200, upload_to="users/")\n\n\n1\n2\n3\n4\n\n 3. settings éç½®\n\nmedia_url = "/media/"\nmedia_root = os.path.join(base_dir, "media")\n\n\n1\n2\n\n 4. urls.py éç½®\n\nfrom django.urls import re_path\nfrom settings import media_root\n\nurlpatterns = [    \n    re_path(r\'^media/(?p<path>.*)$\', serve, {"document_root": media_root})\n]\n\n\n1\n2\n3\n4\n5\n6\n\n 5. æµè¯\n\n> éè¿localhost:8000/media/user/a.jpg å¯ä»¥è®¿é®å¾ç',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"django å¤é®å¼ç¨èªèº«åon_deleteåæ°",frontmatter:{title:"django å¤é®å¼ç¨èªèº«åon_deleteåæ°",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/b422bd/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"djangoä¸­ä½¿ç¨å¤é®å¼ç¨èªèº«çæ¹æ³åon_deleteåæ°çéç½®",feed:{enable:!0},tags:["python","django"],categories:["ç¼ç¨","python","django"],comment:!0,meta:[{name:"twitter:title",content:"django å¤é®å¼ç¨èªèº«åon_deleteåæ°"},{name:"twitter:description",content:"djangoä¸­ä½¿ç¨å¤é®å¼ç¨èªèº«çæ¹æ³åon_deleteåæ°çéç½®"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/15.django%20%E5%A4%96%E9%94%AE%E5%BC%95%E7%94%A8%E8%87%AA%E8%BA%AB%E5%92%8Con_delete%E5%8F%82%E6%95%B0.html"},{property:"og:type",content:"article"},{property:"og:title",content:"django å¤é®å¼ç¨èªèº«åon_deleteåæ°"},{property:"og:description",content:"djangoä¸­ä½¿ç¨å¤é®å¼ç¨èªèº«çæ¹æ³åon_deleteåæ°çéç½®"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/15.django%20%E5%A4%96%E9%94%AE%E5%BC%95%E7%94%A8%E8%87%AA%E8%BA%AB%E5%92%8Con_delete%E5%8F%82%E6%95%B0.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"django å¤é®å¼ç¨èªèº«åon_deleteåæ°"},{itemprop:"description",content:"djangoä¸­ä½¿ç¨å¤é®å¼ç¨èªèº«çæ¹æ³åon_deleteåæ°çéç½®"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/15.django%20%E5%A4%96%E9%94%AE%E5%BC%95%E7%94%A8%E8%87%AA%E8%BA%AB%E5%92%8Con_delete%E5%8F%82%E6%95%B0.html",relativePath:"04.ç¼ç¨/01.python/06.django/15.django å¤é®å¼ç¨èªèº«åon_deleteåæ°.md",key:"v-e8f812b8",path:"/pages/b422bd/",headersStr:null,content:"æ¡ä¾. è¯¥æ¨¡åä½¿ç¨å¤é®å¼ç¨èªå·±æ¬èº«ã\n\nfrom django.db import models\n\nclass Category(models.Model):\n    name = models.TextField()\n    parent_cat = models.ForeignKey('self',on_delete=models.CASCADE)\n\n\n1\n2\n3\n4\n5\n\n\non_deleteåæ°å¦ä¸:\n\n 1. CASCADEï¼çº§èæä½ãå¦æå¤é®å¯¹åºçé£æ¡æ°æ®è¢«å é¤äºï¼é£ä¹è¿æ¡æ°æ®ä¹ä¼è¢«å é¤ã\n\n 2. PROTECTï¼åä¿æ¤ãå³åªè¦è¿æ¡æ°æ®å¼ç¨äºå¤é®çé£æ¡æ°æ®ï¼é£ä¹å°±ä¸è½å é¤å¤é®çé£æ¡æ°æ®ãå¦ææä»¬å¼ºè¡å é¤ï¼Djangoå°±ä¼æ¥éã\n\n 3. SET_NULLï¼è®¾ç½®ä¸ºç©ºãå¦æå¤é®çé£æ¡æ°æ®è¢«å é¤äºï¼é£ä¹å¨æ¬æ¡æ°æ®ä¸å°±å°è¿ä¸ªå­æ®µè®¾ç½®ä¸ºç©ºãå¦æè®¾ç½®è¿ä¸ªéé¡¹ï¼åææ¯è¦æå®è¿ä¸ªå­æ®µå¯ä»¥ä¸ºç©ºã\n\n 4. SET_DEFAULTï¼è®¾ç½®é»è®¤å¼ãå¦æå¤é®çé£æ¡æ°æ®è¢«å é¤äºï¼é£ä¹æ¬æ¡æ°æ®ä¸å°±å°è¿ä¸ªå­æ®µè®¾ç½®ä¸ºé»è®¤å¼ãå¦æè®¾ç½®è¿ä¸ªéé¡¹ï¼== åææ¯è¦æå®è¿ä¸ªå­æ®µä¸ä¸ªé»è®¤å¼ ==ã\n\n 5. SET()ï¼å¦æå¤é®çé£æ¡æ°æ®è¢«å é¤äºãé£ä¹å°ä¼è·åSETå½æ°ä¸­çå¼æ¥ä½ä¸ºè¿ä¸ªå¤é®çå¼ãSETå½æ°å¯ä»¥æ¥æ¶ä¸ä¸ªå¯ä»¥è°ç¨çå¯¹è±¡ï¼æ¯å¦å½æ°æèæ¹æ³ï¼ï¼å¦ææ¯å¯ä»¥è°ç¨çå¯¹è±¡ï¼é£ä¹ä¼å°è¿ä¸ªå¯¹è±¡è°ç¨åçç»æä½ä¸ºå¼è¿ååå»ã== å¯ä»¥ä¸ç¨æå®é»è®¤å¼ ==\n\n 6. DO_NOTHINGï¼ä¸éåä»»ä½è¡ä¸ºãä¸åå¨çæ°æ®åºçº§å«ççº¦æã\n\næ³¨æ:ä»¥ä¸çéç½®é½æ¯djangoçº§å«çï¼å¨æ°æ®åºä¸­ççº§å«ä¾æ§æ¯RESTRICT\n\næ°æ®åºå±é¢ççº¦ææ:\n\n 1. RESTRICTï¼é»è®¤çéé¡¹ï¼å¦ææ³è¦å é¤ç¶è¡¨çè®°å½æ¶ï¼èå¨å­è¡¨ä¸­æå³èè¯¥ç¶è¡¨çè®°å½ï¼åä¸åè®¸å é¤ç¶è¡¨ä¸­çè®°å½ï¼\n\n 2. NOACTIONï¼å RESTRICTææä¸æ ·ï¼ä¹æ¯é¦ååæ£æ¥å¤é®;\n\n 3. CASCADEï¼ç¶è¡¨deleteãupdateçæ¶åï¼å­è¡¨ä¼deleteãupdateæå³èè®°å½ï¼\n\n 4. SET NULL:ç¶è¡¨deleteãupdateçæ¶åï¼å­è¡¨ä¼å°å³èè®°å½çå¤é®å­æ®µæå¨åè®¾ä¸ºnullï¼æä»¥æ³¨æå¨è®¾è®¡å­è¡¨æ¶å¤é®ä¸è½è®¾ä¸ºnot nullï¼\n\nä¸ºä»ä¹å¨djangoä¸­å¯ä»¥æ¯ç¨ä¸åççº¦æå»æä½æ°æ®åºå¢ã\n\n> æ¯å¦ django ä¸­ on_delete=CASCADE, ä½æ¯æ°æ®åºçå¤é®çº¦ææ¯RESTRICT. å¨è¿è¡å é¤Aè¡¨æ°æ®æ¶ï¼åç°è¢«å¤é®çº¦æçï¼ä½¿æ°æ®ä¸è½è¢«å é¤ï¼ådjangoä¼åå»å é¤çº¦æçBè¡¨æ°æ®ï¼ç¶ååæ¥å é¤Aè¡¨æ°æ®ã",normalizedContent:"æ¡ä¾. è¯¥æ¨¡åä½¿ç¨å¤é®å¼ç¨èªå·±æ¬èº«ã\n\nfrom django.db import models\n\nclass category(models.model):\n    name = models.textfield()\n    parent_cat = models.foreignkey('self',on_delete=models.cascade)\n\n\n1\n2\n3\n4\n5\n\n\non_deleteåæ°å¦ä¸:\n\n 1. cascadeï¼çº§èæä½ãå¦æå¤é®å¯¹åºçé£æ¡æ°æ®è¢«å é¤äºï¼é£ä¹è¿æ¡æ°æ®ä¹ä¼è¢«å é¤ã\n\n 2. protectï¼åä¿æ¤ãå³åªè¦è¿æ¡æ°æ®å¼ç¨äºå¤é®çé£æ¡æ°æ®ï¼é£ä¹å°±ä¸è½å é¤å¤é®çé£æ¡æ°æ®ãå¦ææä»¬å¼ºè¡å é¤ï¼djangoå°±ä¼æ¥éã\n\n 3. set_nullï¼è®¾ç½®ä¸ºç©ºãå¦æå¤é®çé£æ¡æ°æ®è¢«å é¤äºï¼é£ä¹å¨æ¬æ¡æ°æ®ä¸å°±å°è¿ä¸ªå­æ®µè®¾ç½®ä¸ºç©ºãå¦æè®¾ç½®è¿ä¸ªéé¡¹ï¼åææ¯è¦æå®è¿ä¸ªå­æ®µå¯ä»¥ä¸ºç©ºã\n\n 4. set_defaultï¼è®¾ç½®é»è®¤å¼ãå¦æå¤é®çé£æ¡æ°æ®è¢«å é¤äºï¼é£ä¹æ¬æ¡æ°æ®ä¸å°±å°è¿ä¸ªå­æ®µè®¾ç½®ä¸ºé»è®¤å¼ãå¦æè®¾ç½®è¿ä¸ªéé¡¹ï¼== åææ¯è¦æå®è¿ä¸ªå­æ®µä¸ä¸ªé»è®¤å¼ ==ã\n\n 5. set()ï¼å¦æå¤é®çé£æ¡æ°æ®è¢«å é¤äºãé£ä¹å°ä¼è·åsetå½æ°ä¸­çå¼æ¥ä½ä¸ºè¿ä¸ªå¤é®çå¼ãsetå½æ°å¯ä»¥æ¥æ¶ä¸ä¸ªå¯ä»¥è°ç¨çå¯¹è±¡ï¼æ¯å¦å½æ°æèæ¹æ³ï¼ï¼å¦ææ¯å¯ä»¥è°ç¨çå¯¹è±¡ï¼é£ä¹ä¼å°è¿ä¸ªå¯¹è±¡è°ç¨åçç»æä½ä¸ºå¼è¿ååå»ã== å¯ä»¥ä¸ç¨æå®é»è®¤å¼ ==\n\n 6. do_nothingï¼ä¸éåä»»ä½è¡ä¸ºãä¸åå¨çæ°æ®åºçº§å«ççº¦æã\n\næ³¨æ:ä»¥ä¸çéç½®é½æ¯djangoçº§å«çï¼å¨æ°æ®åºä¸­ççº§å«ä¾æ§æ¯restrict\n\næ°æ®åºå±é¢ççº¦ææ:\n\n 1. restrictï¼é»è®¤çéé¡¹ï¼å¦ææ³è¦å é¤ç¶è¡¨çè®°å½æ¶ï¼èå¨å­è¡¨ä¸­æå³èè¯¥ç¶è¡¨çè®°å½ï¼åä¸åè®¸å é¤ç¶è¡¨ä¸­çè®°å½ï¼\n\n 2. noactionï¼å restrictææä¸æ ·ï¼ä¹æ¯é¦ååæ£æ¥å¤é®;\n\n 3. cascadeï¼ç¶è¡¨deleteãupdateçæ¶åï¼å­è¡¨ä¼deleteãupdateæå³èè®°å½ï¼\n\n 4. set null:ç¶è¡¨deleteãupdateçæ¶åï¼å­è¡¨ä¼å°å³èè®°å½çå¤é®å­æ®µæå¨åè®¾ä¸ºnullï¼æä»¥æ³¨æå¨è®¾è®¡å­è¡¨æ¶å¤é®ä¸è½è®¾ä¸ºnot nullï¼\n\nä¸ºä»ä¹å¨djangoä¸­å¯ä»¥æ¯ç¨ä¸åççº¦æå»æä½æ°æ®åºå¢ã\n\n> æ¯å¦ django ä¸­ on_delete=cascade, ä½æ¯æ°æ®åºçå¤é®çº¦ææ¯restrict. å¨è¿è¡å é¤aè¡¨æ°æ®æ¶ï¼åç°è¢«å¤é®çº¦æçï¼ä½¿æ°æ®ä¸è½è¢«å é¤ï¼ådjangoä¼åå»å é¤çº¦æçbè¡¨æ°æ®ï¼ç¶ååæ¥å é¤aè¡¨æ°æ®ã",charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"django è­¦å while time zone support is active",frontmatter:{title:"django è­¦å while time zone support is active",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/f0d816/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"djangoä¸­çæ¶åºé®é¢",feed:{enable:!0},tags:["python","django"],categories:["ç¼ç¨","python","django"],comment:!0,meta:[{name:"twitter:title",content:"django è­¦å while time zone support is active"},{name:"twitter:description",content:"djangoä¸­çæ¶åºé®é¢"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/16.django%20%E8%AD%A6%E5%91%8A%20while%20time%20zone%20support%20is%20active.html"},{property:"og:type",content:"article"},{property:"og:title",content:"django è­¦å while time zone support is active"},{property:"og:description",content:"djangoä¸­çæ¶åºé®é¢"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/16.django%20%E8%AD%A6%E5%91%8A%20while%20time%20zone%20support%20is%20active.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"django è­¦å while time zone support is active"},{itemprop:"description",content:"djangoä¸­çæ¶åºé®é¢"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/16.django%20%E8%AD%A6%E5%91%8A%20while%20time%20zone%20support%20is%20active.html",relativePath:"04.ç¼ç¨/01.python/06.django/16.django è­¦å while time zone support is active.md",key:"v-35d0167d",path:"/pages/f0d816/",headersStr:null,content:"åè­¦éè¯¯å¦ä¸ã\n\n> DateTimeField Customer.updated received a naive datetime (2016-06-19 07:18:21.118000) while time zone support is active\n\nå¨ settings.py ä¸­è®¾ç½®ç USE_TZ=Trueï¼æä»¥éè¦ä½¿ç¨ active datetime, ä½æ¯å´å¾å°äº naive datetime.\n\n> naive datetime æ¯éè¿ datetime è¾åºä¸å¸¦æ¶åºçæ¶é´. active time æ¯ä½¿ç¨django.utils.timezone.now() è¾åºçæ¯å¸¦æ¶åºutcæ¶é´ã\n\nè§£å³åæ³\n\n 1. ä½¿ç¨å¸¦æ¶åºçæ¶é´, djangoä¸­ä½¿ç¨ django.utils.timezone.now() , settings.py ä¸­ USE_TZ=True\n\n 2. ä½¿ç¨ä¸å¸¦æ¶åºçæ¶é´, djangoä¸­ä½¿ç¨ datetime.now(), settings.py ä¸­ USE_TZ=False",normalizedContent:"åè­¦éè¯¯å¦ä¸ã\n\n> datetimefield customer.updated received a naive datetime (2016-06-19 07:18:21.118000) while time zone support is active\n\nå¨ settings.py ä¸­è®¾ç½®ç use_tz=trueï¼æä»¥éè¦ä½¿ç¨ active datetime, ä½æ¯å´å¾å°äº naive datetime.\n\n> naive datetime æ¯éè¿ datetime è¾åºä¸å¸¦æ¶åºçæ¶é´. active time æ¯ä½¿ç¨django.utils.timezone.now() è¾åºçæ¯å¸¦æ¶åºutcæ¶é´ã\n\nè§£å³åæ³\n\n 1. ä½¿ç¨å¸¦æ¶åºçæ¶é´, djangoä¸­ä½¿ç¨ django.utils.timezone.now() , settings.py ä¸­ use_tz=true\n\n 2. ä½¿ç¨ä¸å¸¦æ¶åºçæ¶é´, djangoä¸­ä½¿ç¨ datetime.now(), settings.py ä¸­ use_tz=false",charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"django rest_framework åé¡µ",frontmatter:{title:"django rest_framework åé¡µ",date:"2023-03-20T11:32:52.000Z",permalink:"/pages/cb262f/",categories:["ç¼ç¨","python","django"],tags:[null],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä¸»è¦ä»ç»å¨drfæ¡æ¶ä¸­å¦ä½å¯¹æ¥è¯¢çæ°æ®è¿è¡åé¡µï¼å¨drfæ¡æ¶ä¸­ææä¾è¯¥åºç¡åè½çä½¿ç¨æ¡ä¾åææ¡£ï¼è¯¦æåèdrf-pagination-å®ç½ææ¡£",comment:!0,meta:[{name:"twitter:title",content:"django rest_framework åé¡µ"},{name:"twitter:description",content:"æ¬æä¸»è¦ä»ç»å¨drfæ¡æ¶ä¸­å¦ä½å¯¹æ¥è¯¢çæ°æ®è¿è¡åé¡µï¼å¨drfæ¡æ¶ä¸­ææä¾è¯¥åºç¡åè½çä½¿ç¨æ¡ä¾åææ¡£ï¼è¯¦æåèdrf-pagination-å®ç½ææ¡£"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/17.django%20rest_framework%20%E5%88%86%E9%A1%B5.html"},{property:"og:type",content:"article"},{property:"og:title",content:"django rest_framework åé¡µ"},{property:"og:description",content:"æ¬æä¸»è¦ä»ç»å¨drfæ¡æ¶ä¸­å¦ä½å¯¹æ¥è¯¢çæ°æ®è¿è¡åé¡µï¼å¨drfæ¡æ¶ä¸­ææä¾è¯¥åºç¡åè½çä½¿ç¨æ¡ä¾åææ¡£ï¼è¯¦æåèdrf-pagination-å®ç½ææ¡£"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/17.django%20rest_framework%20%E5%88%86%E9%A1%B5.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-03-20T11:32:52.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"django rest_framework åé¡µ"},{itemprop:"description",content:"æ¬æä¸»è¦ä»ç»å¨drfæ¡æ¶ä¸­å¦ä½å¯¹æ¥è¯¢çæ°æ®è¿è¡åé¡µï¼å¨drfæ¡æ¶ä¸­ææä¾è¯¥åºç¡åè½çä½¿ç¨æ¡ä¾åææ¡£ï¼è¯¦æåèdrf-pagination-å®ç½ææ¡£"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/17.django%20rest_framework%20%E5%88%86%E9%A1%B5.html",relativePath:"04.ç¼ç¨/01.python/06.django/17.django rest_framework åé¡µ.md",key:"v-788c4982",path:"/pages/cb262f/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"åç½®åé¡µæ¹å¼",slug:"åç½®åé¡µæ¹å¼",normalizedTitle:"åç½®åé¡µæ¹å¼",charIndex:84},{level:2,title:"èªå®ä¹åé¡µ",slug:"èªå®ä¹åé¡µ",normalizedTitle:"èªå®ä¹åé¡µ",charIndex:375},{level:2,title:"èªå®ä¹åé¡µååºæ°æ®",slug:"èªå®ä¹åé¡µååºæ°æ®",normalizedTitle:"èªå®ä¹åé¡µååºæ°æ®",charIndex:906},{level:2,title:"éç½®",slug:"éç½®",normalizedTitle:"éç½®",charIndex:1513},{level:3,title:"å¨å±",slug:"å¨å±",normalizedTitle:"å¨å±",charIndex:1520},{level:3,title:"å±é¨",slug:"å±é¨",normalizedTitle:"å±é¨",charIndex:1862}],headersStr:"ç®ä» åç½®åé¡µæ¹å¼ èªå®ä¹åé¡µ èªå®ä¹åé¡µååºæ°æ® éç½® å¨å± å±é¨",content:"# ç®ä»\n\næ¬æä¸»è¦ä»ç»å¨drfæ¡æ¶ä¸­å¦ä½å¯¹æ¥è¯¢çæ°æ®è¿è¡åé¡µï¼å¨drfæ¡æ¶ä¸­ææä¾è¯¥åºç¡åè½çä½¿ç¨æ¡ä¾åææ¡£ï¼è¯¦æåèdrf-pagination-å®ç½ææ¡£\n\n\n# åç½®åé¡µæ¹å¼\n\ndrfæ¡æ¶ä¸­é»è®¤æä¾å ç§åé¡µæ¹å¼ï¼å¹¶å°è£æäºæ¨¡åæä¾ç»å¼åèè°ç¨ï¼ä¸»è¦æ¯ä»¥ä¸å ç§ï¼\n\n * PageNumberPaginationï¼ä¸»è¦æ¯æä¾page åpage_size è¿è¡åé¡µã\n   * pageï¼å½åé¡µæ°\n   * page_sizeï¼æ¯é¡µå±ç¤ºçæ°é\n * LimitOffsetPaginationï¼æä¾limit åoffset è¿è¡åé¡µ\n   * limitï¼å½ååé¡µå±ç¤ºçæ°é\n   * offsetï¼å½åæ°æ®æ¯ä»ç¬¬å è¡å¼å§ã\n * CursorPaginationï¼å¯¹ç»æéä¸­æä¾åè¿ä¸åéçé¾æ¥æ¥è¿è¡æä½ï¼ä¸åè®¸éæè·³å¨å°ä»»æä½ç½®ã\n\n\n# èªå®ä¹åé¡µ\n\næ¡æ¶æ¬èº«æä¾äºåç±»çæ¨¡åï¼ä½å¨å®éå·¥ä½ä¸­å¹¶ä¸éç¨ï¼æä»¥æä»¬å¯ä»¥éè¿ç»§æ¿çæ¹å¼å¯¹åç½®çåé¡µæ¨¡åä¸­çé¨åå±æ§è¿è¡è¦çï¼ä»¥ç¬¦åèªèº«ä¸å¡ã\n\nclass LargeResultsSetPagination(PageNumberPagination):\n    page_size = 1000\n    page_size_query_param = 'page_size'\n    max_page_size = 10000\n\nclass StandardResultsSetPagination(PageNumberPagination):\n    page_size = 100   \n    page_size_query_param = 'page_size'\n    max_page_size = 1000\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nåæ°ï¼\n\n * page_sizeï¼è¯·æ±æ¥å£æªæææ¶ï¼é»è®¤ä½¿ç¨è¯¥å¼æ¥æ¥è¯¢æ°æ®é\n * max_page_sizeï¼è¿ä¸ªæ¯éå¶ä¸é¡µæå¤§è½å±ç¤ºçæ°éã\n * page_size_query_paramï¼åç«¯è¯·æ±åé¡µæ°éçå­æ®µ\n\nä¸é¢æ¯é¨åå¸¸ç¨çå­æ®µï¼å¦ææç¹æ®ä¸å¡å¯ä»¥çæºç åè¿è¡ä¿®æ¹ã\n\n\n# èªå®ä¹åé¡µååºæ°æ®\n\nå¨åç½®çåé¡µç±»PageNumberPagination ä¸­ååºçæ°æ®æ ¼å¼å¦ä¸ï¼\n\n{\n    \"count\": æ»æ°,\n    \"next\": ä¸ä¸é¡µçé¾æ¥,\n    \"previous\": ä¸ä¸é¡µçé¾æ¥,\n    \"results\": åé¡µåçæ°æ®\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nä½å®æä»¬å¨ä¸å¡ä¸­å¯è½å¹¶ä¸éè¦next åprevious ï¼åªéè¦ä¿çcount åresults ä¸¤ä¸ªå­æ®µï¼è¿ä¸ªæ¶åæä»¬å¯ä»¥éè¿éåget_paginated_response æ¹æ³éè¦å¯¹ååºçæ°æ®è¿è¡è£åªã\n\nclass LargeResultsSetPagination(PageNumberPagination):\n    page_size = 1000\n    page_size_query_param = 'page_size'\n    max_page_size = 10000\n\n    def get_paginated_response(self, data):\n        return Response(OrderedDict([\n            ('count', self.page.paginator.count),\n            ('results', data)\n        ]))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# éç½®\n\n\n# å¨å±\n\nå¨settings.py ä¸­å¯ä»¥è®¾ç½®å¨å±çåé¡µæ¨¡å¼ï¼å¨REST_FRAMEWORK ä¸­è®¾ç½®DEFAULT_PAGINATION_CLASS ï¼è¯¥keyæ¯æå®åé¡µæ¨¡å¼ä½¿ç¨åªä¸ªåé¡µç±»ï¼èè¿éä½¿ç¨çæ¯drfæ¡æ¶ä¸­åç½®çåé¡µç±»LimitOffsetPaginationï¼å¹¶è®¾ç½®åæ°PAGE_SIZEæå®æ¯é¡µé»è®¤å±ç¤ºçæ°éã\n\nREST_FRAMEWORK = {\n    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.LimitOffsetPagination',\n    'PAGE_SIZE': 100\n}\n\n\n1\n2\n3\n4\n\n\nè¯¥é¡¹éç½®ä¼å¯¹å¨å±çæï¼ä¹å°±æ¯æ¯ä¸ä¸ªviewçListæ¥è¯¢é½ä¼èµ°è¯¥åé¡µæ¨¡å¼ã\n\n\n# å±é¨\n\nå¨æäºä¸å¡åºæ¯æ¯ä¸éè¦åé¡µçï¼æèä¸åçæ¥å£éè¦ä½¿ç¨çåé¡µæ¨¡å¼ä¸åï¼é£ä¹ä¸é¢çå¨å±éç½®æ¹æ³å°±ä¸éç¨çäºï¼è¿ä¸ªæ¶åå°±éè¦ä½¿ç¨å±é¨éç½®çæ¹å¼ã\n\né¦åä¸è¿è¡å¨å±æ¨¡å¼ï¼å¨éè¦åé¡µçViewä¸­æ·»å pagination_class å¹¶è®¾ç½®å¯¹åºçåé¡µæ¨¡å¼ç±»ï¼è¿éä½¿ç¨çæ¯èªå®ä¹çåé¡µç±»ï¼è¯¥éç½®åªä¼å¨æ¬Viewä¸­çæã\n\nclass BillingRecordsView(generics.ListAPIView):\n    queryset = Billing.objects.all()\n    serializer_class = BillingRecordsSerializer\n    pagination_class = LargeResultsSetPagination\n\n\n1\n2\n3\n4\n",normalizedContent:"# ç®ä»\n\næ¬æä¸»è¦ä»ç»å¨drfæ¡æ¶ä¸­å¦ä½å¯¹æ¥è¯¢çæ°æ®è¿è¡åé¡µï¼å¨drfæ¡æ¶ä¸­ææä¾è¯¥åºç¡åè½çä½¿ç¨æ¡ä¾åææ¡£ï¼è¯¦æåèdrf-pagination-å®ç½ææ¡£\n\n\n# åç½®åé¡µæ¹å¼\n\ndrfæ¡æ¶ä¸­é»è®¤æä¾å ç§åé¡µæ¹å¼ï¼å¹¶å°è£æäºæ¨¡åæä¾ç»å¼åèè°ç¨ï¼ä¸»è¦æ¯ä»¥ä¸å ç§ï¼\n\n * pagenumberpaginationï¼ä¸»è¦æ¯æä¾page åpage_size è¿è¡åé¡µã\n   * pageï¼å½åé¡µæ°\n   * page_sizeï¼æ¯é¡µå±ç¤ºçæ°é\n * limitoffsetpaginationï¼æä¾limit åoffset è¿è¡åé¡µ\n   * limitï¼å½ååé¡µå±ç¤ºçæ°é\n   * offsetï¼å½åæ°æ®æ¯ä»ç¬¬å è¡å¼å§ã\n * cursorpaginationï¼å¯¹ç»æéä¸­æä¾åè¿ä¸åéçé¾æ¥æ¥è¿è¡æä½ï¼ä¸åè®¸éæè·³å¨å°ä»»æä½ç½®ã\n\n\n# èªå®ä¹åé¡µ\n\næ¡æ¶æ¬èº«æä¾äºåç±»çæ¨¡åï¼ä½å¨å®éå·¥ä½ä¸­å¹¶ä¸éç¨ï¼æä»¥æä»¬å¯ä»¥éè¿ç»§æ¿çæ¹å¼å¯¹åç½®çåé¡µæ¨¡åä¸­çé¨åå±æ§è¿è¡è¦çï¼ä»¥ç¬¦åèªèº«ä¸å¡ã\n\nclass largeresultssetpagination(pagenumberpagination):\n    page_size = 1000\n    page_size_query_param = 'page_size'\n    max_page_size = 10000\n\nclass standardresultssetpagination(pagenumberpagination):\n    page_size = 100   \n    page_size_query_param = 'page_size'\n    max_page_size = 1000\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nåæ°ï¼\n\n * page_sizeï¼è¯·æ±æ¥å£æªæææ¶ï¼é»è®¤ä½¿ç¨è¯¥å¼æ¥æ¥è¯¢æ°æ®é\n * max_page_sizeï¼è¿ä¸ªæ¯éå¶ä¸é¡µæå¤§è½å±ç¤ºçæ°éã\n * page_size_query_paramï¼åç«¯è¯·æ±åé¡µæ°éçå­æ®µ\n\nä¸é¢æ¯é¨åå¸¸ç¨çå­æ®µï¼å¦ææç¹æ®ä¸å¡å¯ä»¥çæºç åè¿è¡ä¿®æ¹ã\n\n\n# èªå®ä¹åé¡µååºæ°æ®\n\nå¨åç½®çåé¡µç±»pagenumberpagination ä¸­ååºçæ°æ®æ ¼å¼å¦ä¸ï¼\n\n{\n    \"count\": æ»æ°,\n    \"next\": ä¸ä¸é¡µçé¾æ¥,\n    \"previous\": ä¸ä¸é¡µçé¾æ¥,\n    \"results\": åé¡µåçæ°æ®\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nä½å®æä»¬å¨ä¸å¡ä¸­å¯è½å¹¶ä¸éè¦next åprevious ï¼åªéè¦ä¿çcount åresults ä¸¤ä¸ªå­æ®µï¼è¿ä¸ªæ¶åæä»¬å¯ä»¥éè¿éåget_paginated_response æ¹æ³éè¦å¯¹ååºçæ°æ®è¿è¡è£åªã\n\nclass largeresultssetpagination(pagenumberpagination):\n    page_size = 1000\n    page_size_query_param = 'page_size'\n    max_page_size = 10000\n\n    def get_paginated_response(self, data):\n        return response(ordereddict([\n            ('count', self.page.paginator.count),\n            ('results', data)\n        ]))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# éç½®\n\n\n# å¨å±\n\nå¨settings.py ä¸­å¯ä»¥è®¾ç½®å¨å±çåé¡µæ¨¡å¼ï¼å¨rest_framework ä¸­è®¾ç½®default_pagination_class ï¼è¯¥keyæ¯æå®åé¡µæ¨¡å¼ä½¿ç¨åªä¸ªåé¡µç±»ï¼èè¿éä½¿ç¨çæ¯drfæ¡æ¶ä¸­åç½®çåé¡µç±»limitoffsetpaginationï¼å¹¶è®¾ç½®åæ°page_sizeæå®æ¯é¡µé»è®¤å±ç¤ºçæ°éã\n\nrest_framework = {\n    'default_pagination_class': 'rest_framework.pagination.limitoffsetpagination',\n    'page_size': 100\n}\n\n\n1\n2\n3\n4\n\n\nè¯¥é¡¹éç½®ä¼å¯¹å¨å±çæï¼ä¹å°±æ¯æ¯ä¸ä¸ªviewçlistæ¥è¯¢é½ä¼èµ°è¯¥åé¡µæ¨¡å¼ã\n\n\n# å±é¨\n\nå¨æäºä¸å¡åºæ¯æ¯ä¸éè¦åé¡µçï¼æèä¸åçæ¥å£éè¦ä½¿ç¨çåé¡µæ¨¡å¼ä¸åï¼é£ä¹ä¸é¢çå¨å±éç½®æ¹æ³å°±ä¸éç¨çäºï¼è¿ä¸ªæ¶åå°±éè¦ä½¿ç¨å±é¨éç½®çæ¹å¼ã\n\né¦åä¸è¿è¡å¨å±æ¨¡å¼ï¼å¨éè¦åé¡µçviewä¸­æ·»å pagination_class å¹¶è®¾ç½®å¯¹åºçåé¡µæ¨¡å¼ç±»ï¼è¿éä½¿ç¨çæ¯èªå®ä¹çåé¡µç±»ï¼è¯¥éç½®åªä¼å¨æ¬viewä¸­çæã\n\nclass billingrecordsview(generics.listapiview):\n    queryset = billing.objects.all()\n    serializer_class = billingrecordsserializer\n    pagination_class = largeresultssetpagination\n\n\n1\n2\n3\n4\n",charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"Flaskä½¿ç¨flask_socketioå®ç°websocket",frontmatter:{author:{name:"msqfx",link:"https://github.com/msqfx"},title:"Flaskä½¿ç¨flask_socketioå®ç°websocket",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/b71dc2/",description:"å¨flaskä¸­ä½¿ç¨flask_socketioæ¥å®ç°websocketçåè½ã",feed:{enable:!0},tags:["python","flask"],categories:["ç¼ç¨","python","flask"],comment:!0,meta:[{name:"twitter:title",content:"Flaskä½¿ç¨flask_socketioå®ç°websocket"},{name:"twitter:description",content:"å¨flaskä¸­ä½¿ç¨flask_socketioæ¥å®ç°websocketçåè½ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/07.flask/01.Flask%E4%BD%BF%E7%94%A8flask_socketio%E5%AE%9E%E7%8E%B0websocket.html"},{property:"og:type",content:"article"},{property:"og:title",content:"Flaskä½¿ç¨flask_socketioå®ç°websocket"},{property:"og:description",content:"å¨flaskä¸­ä½¿ç¨flask_socketioæ¥å®ç°websocketçåè½ã"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/07.flask/01.Flask%E4%BD%BF%E7%94%A8flask_socketio%E5%AE%9E%E7%8E%B0websocket.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"flask"},{itemprop:"name",content:"Flaskä½¿ç¨flask_socketioå®ç°websocket"},{itemprop:"description",content:"å¨flaskä¸­ä½¿ç¨flask_socketioæ¥å®ç°websocketçåè½ã"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/07.flask/01.Flask%E4%BD%BF%E7%94%A8flask_socketio%E5%AE%9E%E7%8E%B0websocket.html",relativePath:"04.ç¼ç¨/01.python/07.flask/01.Flaskä½¿ç¨flask_socketioå®ç°websocket.md",key:"v-f7e64afe",path:"/pages/b71dc2/",headers:[{level:2,title:"åç«¯å®ç°",slug:"åç«¯å®ç°",normalizedTitle:"åç«¯å®ç°",charIndex:105},{level:2,title:"åç«¯å®ç°",slug:"åç«¯å®ç°",normalizedTitle:"åç«¯å®ç°",charIndex:1556},{level:3,title:"å®è£",slug:"å®è£",normalizedTitle:"å®è£",charIndex:1615},{level:3,title:"send å emitåºå«",slug:"send-å-emitåºå«",normalizedTitle:"send å emitåºå«",charIndex:1652},{level:3,title:"ç®åä½¿ç¨",slug:"ç®åä½¿ç¨",normalizedTitle:"ç®åä½¿ç¨",charIndex:1711},{level:3,title:"åºäºç±»çä½¿ç¨",slug:"åºäºç±»çä½¿ç¨",normalizedTitle:"åºäºç±»çä½¿ç¨",charIndex:2613}],excerpt:'<h1 id="flaskä½¿ç¨flask-socketioå®ç°websocket"><a class="header-anchor" href="#flaskä½¿ç¨flask-socketioå®ç°websocket">#</a> Flaskä½¿ç¨flask_socketioå®ç°websocket</h1>\n<p>ä¸é¢æ¯æ¡ä¾ï¼æ¯æèªå·±ç¨æ¥æµè¯ä½¿ç¨çï¼å¯ä»¥ç´æ¥è¿è¡çãè¯¦ç»çä½¿ç¨è¯·ç<a href="https://flask-socketio.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">å®ç½<OutboundLink/></a></p>\n<p>websocketä¸»è¦åºç¨äºå®¢æ·ç«¯åæå¡ç«¯ååéä¿¡çã</p>\n',headersStr:"åç«¯å®ç° åç«¯å®ç° å®è£ send å emitåºå« ç®åä½¿ç¨ åºäºç±»çä½¿ç¨",content:"# Flaskä½¿ç¨flask_socketioå®ç°websocket\n\nä¸é¢æ¯æ¡ä¾ï¼æ¯æèªå·±ç¨æ¥æµè¯ä½¿ç¨çï¼å¯ä»¥ç´æ¥è¿è¡çãè¯¦ç»çä½¿ç¨è¯·çå®ç½\n\nwebsocketä¸»è¦åºç¨äºå®¢æ·ç«¯åæå¡ç«¯ååéä¿¡çã\n\n\n# åç«¯å®ç°\n\nä½¿ç¨socket.io.min.jsæ¯node.jsçä¸ä¸ªwebsocketåºï¼é¦ååå»ºsocket. emitæ¯ååç«¯åéæ¶æ¯, messageæ¯è¯¥æ¡æ¶æ¯çåç§°ï¼åé¢æ¯åéæ¶æ¯çæ°æ®ãonæ¯æ³¨åæ¥åæ¶æ¯çäºä»¶,è·ååç«¯ä¼ è¿æ¥çæ°æ®. namespaceæ¯æä¸ç±»çæ¶æ¯ãå½è¿æ¥æåæ¶ï¼ä¼è§¦åconnectäºä»¶ï¼è¿æ¥å³é­æ¶ï¼è§¦ådisconnectäºä»¶ã\n\n\n<html>\n    <head>\n        <script type=\"text/javascript\"\n        src=\"https://code.jquery.com/jquery-3.4.0.min.js\"><\/script>\n        <script type=\"text/javascript\"\n        src=\"//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js\"><\/script>\n        \n        <script type=\"text/javascript\" charset=\"utf-8\">\n            $(document).ready(function () {\n                namespace = \"/wechat\"\n                var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);\n                \n                socket.emit(\"message\", { \"data\": \"zhangsan\" })\n                \n                socket.on('connect', function (data) {\n                    socket.emit('message', { 'data': 'I\\'m connected!' });\n                });\n                \n                socket.on('disconnect', function(data){\n                    socket.emit('message', { 'data': 'I\\'m disconnected!' });\n                });\n                    \n                socket.on('response', function (data) {\n                    console.log(data.age)\n                });\n            });\n        <\/script>\n    </head>\n    \n    <body>\n        <h1>å¾·çè¥¿äº</h1>\n    </body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# åç«¯å®ç°\n\n> Flask-SocketIOä½¿Flaskåºç¨ç¨åºå¯ä»¥è®¿é®å®¢æ·ç«¯åæå¡å¨ä¹é´çä½å»¶è¿ååéä¿¡ã\n\n\n# å®è£\n\n> pip install flask-socketio\n\n\n# send å emitåºå«\n\nsendåéçæ¯æ å½åçæ°æ®ï¼èemitæ¯åéæå½åçæ°æ®ï¼ä¸ªäººå»ºè®®æ¯emit\n\n\n# ç®åä½¿ç¨\n\nonæ¯æ³¨åæ¥æ¶åç«¯æ¶æ¯çæ¹æ³ï¼messageæ¯ææ¥æ¶çä¿¡æ¯çåç§°ï¼ååç«¯å¯¹åºãnamespaceæ¯æä¸ç±»çæ¶æ¯ï¼ååç«¯å¯¹åºãemitæ¯æååç«¯åéæ¶æ¯ï¼å¯¹åºçæ¶æ¯çåç§°ãæ°æ®ånamespaceã\n\né»è®¤çä¸¤ä¸ªäºä»¶ï¼connectådisconnectï¼å½websocketè¿æ¥æååå¤±è´¥æ¶ï¼èªå¨è§¦åè¿ä¸¤ä¸ªäºä»¶ã\n\n\nfrom flask import Flask, render_template\nfrom flask_socketio import SocketIO\n\napp = Flask(__name__)\napp.config['SECRET_KEY'] = 'secret!'\nsocketio = SocketIO(app)\n\n@app.route('/')\ndef index():\n    return render_template('index.html')\n\n@socketio.on('message', namespace=\"/wechat\")\ndef handle_message(message):\n    print('received message: ' + message['data'])\n    socketio.emit(\"response\", {'age': 18}, namespace=\"/wechat\")\n\n@socketio.on('connect', namespace=\"/wechat\")\ndef connect():\n    print(\"connect..\")\n\n@socketio.on('disconnect', namespace=\"/wechat\")\ndef connect():\n    print(\"disconnect...\")\n\nif __name__ == '__main__':\n    socketio.run(app, port=8080)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\n\n# åºäºç±»çä½¿ç¨\n\nä¸é¢é½æ¯åºäºæ¹æ³ä½¿ç¨ï¼ä¸ªäººæè§å¦ææä½è¾å¤çæåµï¼æ¯è¾åä¹±ï¼ä½¿ç¨ç±»å»ç®¡çä¼æ´é½åæ¹ä¾¿å¾å¤ã\n\næå¡å¨æ¶å°çä»»ä½äºä»¶é½ä¼è¢«åéå°ä¸ä¸ªåä¸ºå¸¦æon_åç¼çäºä»¶åç§°çæ¹æ³ã\n\nè¿ä¸ªæ¡ä¾åä¸é¢åºäºæ¹æ³æ¯ä¸æ ·çï¼ä½æ¯æ´å æ¹ä¾¿ç®¡çäºï¼æ¯ä¸ªclassç®¡çä¸ä¸ªnamespaceã\n\n\nclass MyCustomNamespace(Namespace):\n\n    def on_connect(self):\n        print(\"è¿æ¥..\")\n        \n    def on_disconnect(self):\n        print(\"å³é­è¿æ¥\")\n        \n    def on_message(self, data):\n        print('received message: ' + data['data'])\n        self.emit(\"response\", {'age': 18})\n    \nsocketio.on_namespace(MyCustomNamespace(\"/wechat\"))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n",normalizedContent:"# flaskä½¿ç¨flask_socketioå®ç°websocket\n\nä¸é¢æ¯æ¡ä¾ï¼æ¯æèªå·±ç¨æ¥æµè¯ä½¿ç¨çï¼å¯ä»¥ç´æ¥è¿è¡çãè¯¦ç»çä½¿ç¨è¯·çå®ç½\n\nwebsocketä¸»è¦åºç¨äºå®¢æ·ç«¯åæå¡ç«¯ååéä¿¡çã\n\n\n# åç«¯å®ç°\n\nä½¿ç¨socket.io.min.jsæ¯node.jsçä¸ä¸ªwebsocketåºï¼é¦ååå»ºsocket. emitæ¯ååç«¯åéæ¶æ¯, messageæ¯è¯¥æ¡æ¶æ¯çåç§°ï¼åé¢æ¯åéæ¶æ¯çæ°æ®ãonæ¯æ³¨åæ¥åæ¶æ¯çäºä»¶,è·ååç«¯ä¼ è¿æ¥çæ°æ®. namespaceæ¯æä¸ç±»çæ¶æ¯ãå½è¿æ¥æåæ¶ï¼ä¼è§¦åconnectäºä»¶ï¼è¿æ¥å³é­æ¶ï¼è§¦ådisconnectäºä»¶ã\n\n\n<html>\n    <head>\n        <script type=\"text/javascript\"\n        src=\"https://code.jquery.com/jquery-3.4.0.min.js\"><\/script>\n        <script type=\"text/javascript\"\n        src=\"//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js\"><\/script>\n        \n        <script type=\"text/javascript\" charset=\"utf-8\">\n            $(document).ready(function () {\n                namespace = \"/wechat\"\n                var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);\n                \n                socket.emit(\"message\", { \"data\": \"zhangsan\" })\n                \n                socket.on('connect', function (data) {\n                    socket.emit('message', { 'data': 'i\\'m connected!' });\n                });\n                \n                socket.on('disconnect', function(data){\n                    socket.emit('message', { 'data': 'i\\'m disconnected!' });\n                });\n                    \n                socket.on('response', function (data) {\n                    console.log(data.age)\n                });\n            });\n        <\/script>\n    </head>\n    \n    <body>\n        <h1>å¾·çè¥¿äº</h1>\n    </body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# åç«¯å®ç°\n\n> flask-socketioä½¿flaskåºç¨ç¨åºå¯ä»¥è®¿é®å®¢æ·ç«¯åæå¡å¨ä¹é´çä½å»¶è¿ååéä¿¡ã\n\n\n# å®è£\n\n> pip install flask-socketio\n\n\n# send å emitåºå«\n\nsendåéçæ¯æ å½åçæ°æ®ï¼èemitæ¯åéæå½åçæ°æ®ï¼ä¸ªäººå»ºè®®æ¯emit\n\n\n# ç®åä½¿ç¨\n\nonæ¯æ³¨åæ¥æ¶åç«¯æ¶æ¯çæ¹æ³ï¼messageæ¯ææ¥æ¶çä¿¡æ¯çåç§°ï¼ååç«¯å¯¹åºãnamespaceæ¯æä¸ç±»çæ¶æ¯ï¼ååç«¯å¯¹åºãemitæ¯æååç«¯åéæ¶æ¯ï¼å¯¹åºçæ¶æ¯çåç§°ãæ°æ®ånamespaceã\n\né»è®¤çä¸¤ä¸ªäºä»¶ï¼connectådisconnectï¼å½websocketè¿æ¥æååå¤±è´¥æ¶ï¼èªå¨è§¦åè¿ä¸¤ä¸ªäºä»¶ã\n\n\nfrom flask import flask, render_template\nfrom flask_socketio import socketio\n\napp = flask(__name__)\napp.config['secret_key'] = 'secret!'\nsocketio = socketio(app)\n\n@app.route('/')\ndef index():\n    return render_template('index.html')\n\n@socketio.on('message', namespace=\"/wechat\")\ndef handle_message(message):\n    print('received message: ' + message['data'])\n    socketio.emit(\"response\", {'age': 18}, namespace=\"/wechat\")\n\n@socketio.on('connect', namespace=\"/wechat\")\ndef connect():\n    print(\"connect..\")\n\n@socketio.on('disconnect', namespace=\"/wechat\")\ndef connect():\n    print(\"disconnect...\")\n\nif __name__ == '__main__':\n    socketio.run(app, port=8080)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\n\n# åºäºç±»çä½¿ç¨\n\nä¸é¢é½æ¯åºäºæ¹æ³ä½¿ç¨ï¼ä¸ªäººæè§å¦ææä½è¾å¤çæåµï¼æ¯è¾åä¹±ï¼ä½¿ç¨ç±»å»ç®¡çä¼æ´é½åæ¹ä¾¿å¾å¤ã\n\næå¡å¨æ¶å°çä»»ä½äºä»¶é½ä¼è¢«åéå°ä¸ä¸ªåä¸ºå¸¦æon_åç¼çäºä»¶åç§°çæ¹æ³ã\n\nè¿ä¸ªæ¡ä¾åä¸é¢åºäºæ¹æ³æ¯ä¸æ ·çï¼ä½æ¯æ´å æ¹ä¾¿ç®¡çäºï¼æ¯ä¸ªclassç®¡çä¸ä¸ªnamespaceã\n\n\nclass mycustomnamespace(namespace):\n\n    def on_connect(self):\n        print(\"è¿æ¥..\")\n        \n    def on_disconnect(self):\n        print(\"å³é­è¿æ¥\")\n        \n    def on_message(self, data):\n        print('received message: ' + data['data'])\n        self.emit(\"response\", {'age': 18})\n    \nsocketio.on_namespace(mycustomnamespace(\"/wechat\"))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n",charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"flaskç»åmongo",frontmatter:{tags:["python","flask"],title:"flaskç»åmongo",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/c59edf/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"å¨flaskä¸­éæç¬¬ä¸æ¹åºflask-mongoengineæ¥éè¿ORMæä½mongoæ°æ®åº",feed:{enable:!0},categories:["ç¼ç¨","python","flask"],comment:!0,meta:[{name:"twitter:title",content:"flaskç»åmongo"},{name:"twitter:description",content:"å¨flaskä¸­éæç¬¬ä¸æ¹åºflask-mongoengineæ¥éè¿ORMæä½mongoæ°æ®åº"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/07.flask/02.flask%E7%BB%93%E5%90%88mongo.html"},{property:"og:type",content:"article"},{property:"og:title",content:"flaskç»åmongo"},{property:"og:description",content:"å¨flaskä¸­éæç¬¬ä¸æ¹åºflask-mongoengineæ¥éè¿ORMæä½mongoæ°æ®åº"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/07.flask/02.flask%E7%BB%93%E5%90%88mongo.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"flask"},{itemprop:"name",content:"flaskç»åmongo"},{itemprop:"description",content:"å¨flaskä¸­éæç¬¬ä¸æ¹åºflask-mongoengineæ¥éè¿ORMæä½mongoæ°æ®åº"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/07.flask/02.flask%E7%BB%93%E5%90%88mongo.html",relativePath:"04.ç¼ç¨/01.python/07.flask/02.flaskç»åmongo.md",key:"v-3c157da4",path:"/pages/c59edf/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"ç¸å³é¾æ¥",slug:"ç¸å³é¾æ¥",normalizedTitle:"ç¸å³é¾æ¥",charIndex:83},{level:2,title:"ä½¿ç¨",slug:"ä½¿ç¨",normalizedTitle:"ä½¿ç¨",charIndex:26},{level:2,title:"è§£æ±ºé®é¢",slug:"è§£æ±ºé®é¢",normalizedTitle:"è§£æ±ºé®é¢",charIndex:857}],headersStr:"ç®ä» ç¸å³é¾æ¥ ä½¿ç¨ è§£æ±ºé®é¢",content:'# ç®ä»\n\næ¬ææ¯flaskä¸­å¯¹mongoçæä½. ä½¿ç¨Flask-MongoEngineéæäºmongoçæä½ï¼ä½¿ç¨çæ¯ç±»ä¼¼äºdjangoä¸­çormæä½ã\n\n\n# ç¸å³é¾æ¥\n\nFlask-MongoEngineææ¡£\n\nMongoEngineææ¡£\n\n\n# ä½¿ç¨\n\nmongoçéç½®. flaskå°è¿ä¸ªéç½®å è½½è¿æ¥å³å¯.\n\nMONGODB_SETTINGS = {\n    "db": "lifeAssistant",\n    "host": "192.168.0.206",\n    "port": 27017\n}\n\n\n1\n2\n3\n4\n5\n\n\nåå»ºmongoå¼æ.\n\nfrom flask_mongoengine import MongoEngine\nmongodb = MongoEngine()\n\n\n1\n2\n\n\nåå»ºDocumentï¼ç±»ä¼¼äºdjangoçmodel.\n\nfrom lifeAssistant.extension import mongodb\n\nclass Article(mongodb.Document):\n    category = mongodb.StringField()\n    category2 = mongodb.StringField()\n    title = mongodb.StringField()\n    content = mongodb.StringField()\n    publisher = mongodb.StringField()\n    publisher_time = mongodb.StringField()\n    create_time = mongodb.StringField()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nä½¿ç¨Documentè¿è¡æä½. å¶ä»æä½è¯·çå®æ¹ææ¡£\n\n\n# éè¿idè·åæ°æ®.  \ninstance = Article.objects.get_or_404(id=id)\n\n\n1\n2\n3\n\n\n\n# è§£æ±ºé®é¢\n\nmongoæ°æ®è½¬json\n\né®é¢: mongoè½¬jsonæ¶ï¼ä¼è¾åºObjectIdè¿å¯¹è±¡ï¼èä¸æ¯ç´æ¥çidå¼ï¼è¿ä¸ªæ¶åéè¦è½¬æ¢.\n\n\n# è¿ä¸ªæ¯å°mongo Documentå¯¹è±¡è½¬æ¢æjsonçç¼ç å¨\nclass MongoEncoder(JSONEncoder):\n    def default(self, o):\n\n        # è½¬æ¢æ¥æ\n        if isinstance(o, (datetime, date)):\n            pass\n\n        # è½¬æ¢Document\n        if isinstance(o, BaseDocument):\n            return o.to_mongo()\n\n        # è½¬æ¢id\n        if isinstance(o, ObjectId):\n            return str(o)\n\n        return JSONEncoder.default(self, o)\n\n\n\n# å¨èå¾ä¸æ·»å mongoè§£ç å¨.  jsonifyä¼èªå¨å°Documentå¯¹è±¡è½¬æjson\nbp = Blueprint("article", __name__, url_prefix="/article")\nbp.json_encoder = MongoEncoder\n\n\n@bp.route("/<id>/", methods=("GET",))\ndef article(id: str):\n    instance = Article.objects.get_or_404(id=id)\n\n    return jsonify({\n        "code": 0,\n        "msg": "success",\n        "data": instance\n    })\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n',normalizedContent:'# ç®ä»\n\næ¬ææ¯flaskä¸­å¯¹mongoçæä½. ä½¿ç¨flask-mongoengineéæäºmongoçæä½ï¼ä½¿ç¨çæ¯ç±»ä¼¼äºdjangoä¸­çormæä½ã\n\n\n# ç¸å³é¾æ¥\n\nflask-mongoengineææ¡£\n\nmongoengineææ¡£\n\n\n# ä½¿ç¨\n\nmongoçéç½®. flaskå°è¿ä¸ªéç½®å è½½è¿æ¥å³å¯.\n\nmongodb_settings = {\n    "db": "lifeassistant",\n    "host": "192.168.0.206",\n    "port": 27017\n}\n\n\n1\n2\n3\n4\n5\n\n\nåå»ºmongoå¼æ.\n\nfrom flask_mongoengine import mongoengine\nmongodb = mongoengine()\n\n\n1\n2\n\n\nåå»ºdocumentï¼ç±»ä¼¼äºdjangoçmodel.\n\nfrom lifeassistant.extension import mongodb\n\nclass article(mongodb.document):\n    category = mongodb.stringfield()\n    category2 = mongodb.stringfield()\n    title = mongodb.stringfield()\n    content = mongodb.stringfield()\n    publisher = mongodb.stringfield()\n    publisher_time = mongodb.stringfield()\n    create_time = mongodb.stringfield()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nä½¿ç¨documentè¿è¡æä½. å¶ä»æä½è¯·çå®æ¹ææ¡£\n\n\n# éè¿idè·åæ°æ®.  \ninstance = article.objects.get_or_404(id=id)\n\n\n1\n2\n3\n\n\n\n# è§£æ±ºé®é¢\n\nmongoæ°æ®è½¬json\n\né®é¢: mongoè½¬jsonæ¶ï¼ä¼è¾åºobjectidè¿å¯¹è±¡ï¼èä¸æ¯ç´æ¥çidå¼ï¼è¿ä¸ªæ¶åéè¦è½¬æ¢.\n\n\n# è¿ä¸ªæ¯å°mongo documentå¯¹è±¡è½¬æ¢æjsonçç¼ç å¨\nclass mongoencoder(jsonencoder):\n    def default(self, o):\n\n        # è½¬æ¢æ¥æ\n        if isinstance(o, (datetime, date)):\n            pass\n\n        # è½¬æ¢document\n        if isinstance(o, basedocument):\n            return o.to_mongo()\n\n        # è½¬æ¢id\n        if isinstance(o, objectid):\n            return str(o)\n\n        return jsonencoder.default(self, o)\n\n\n\n# å¨èå¾ä¸æ·»å mongoè§£ç å¨.  jsonifyä¼èªå¨å°documentå¯¹è±¡è½¬æjson\nbp = blueprint("article", __name__, url_prefix="/article")\nbp.json_encoder = mongoencoder\n\n\n@bp.route("/<id>/", methods=("get",))\ndef article(id: str):\n    instance = article.objects.get_or_404(id=id)\n\n    return jsonify({\n        "code": 0,\n        "msg": "success",\n        "data": instance\n    })\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"tornado æä»¶ä¸ä¼ ",frontmatter:{title:"tornado æä»¶ä¸ä¼ ",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/4c38f5/",tags:["python","tornado"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"tornadoå®ç°çæä»¶ä¸ä¼ åè½",feed:{enable:!0},categories:["ç¼ç¨","python","tornado"],comment:!0,meta:[{name:"twitter:title",content:"tornado æä»¶ä¸ä¼ "},{name:"twitter:description",content:"tornadoå®ç°çæä»¶ä¸ä¼ åè½"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/01.tornado%20%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0.html"},{property:"og:type",content:"article"},{property:"og:title",content:"tornado æä»¶ä¸ä¼ "},{property:"og:description",content:"tornadoå®ç°çæä»¶ä¸ä¼ åè½"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/01.tornado%20%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"tornado"},{itemprop:"name",content:"tornado æä»¶ä¸ä¼ "},{itemprop:"description",content:"tornadoå®ç°çæä»¶ä¸ä¼ åè½"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/01.tornado%20%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0.html",relativePath:"04.ç¼ç¨/01.python/08.tornado/01.tornado æä»¶ä¸ä¼ .md",key:"v-069fea3d",path:"/pages/4c38f5/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"æ å­",slug:"æ å­",normalizedTitle:"æ å­",charIndex:71}],headersStr:"ç®ä» æ å­",content:'# ç®ä»\n\næç« ä»ç»çæ¯ä½¿ç¨tornadoå®ææä»¶çä¸ä¼ åè½\n\nè¯¥é¡¹ç®çgithubå°å: tornado_learning.git\n\n\n# æ å­\n\nè®¾ç½®æä»¶ä¸ä¼ çè·¯å¾\n\nä»£ç : tornado_learning/settings.py\n\nBASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))\nsettings = {\n    "MEDIA_ROOT": os.path.join(BASE_DIR, "media"),\n}\n\n\n1\n2\n3\n4\n\n\nä¿å­ä¸ä¼ æä»¶\n\nè·ååç«¯ä¼ éè¿æ¥çfront_imageæä»¶ï¼ç¶ååä½¿ç¨aiofileså®æä¸ä¼ æä»¶çäºè¿å¶å¼æ­¥åå¥ã\n\nä»£ç : /apps/hello/uploadHandler.py\n\n\nfrom tornado_learning.handler import BaseHandler\nimport os\nimport uuid\nimport aiofiles\n\nclass UploadHandler(BaseHandler):\n\n    async def post(self):\n        ret_data = {}\n\n        files_meta = self.request.files.get("front_image", None)\n        if not files_meta:\n            self.set_status(400)\n            ret_data["front_image"] = "è¯·ä¸ä¼ å¾ç"\n        else:\n            for meta in files_meta:\n                filename = meta["filename"]\n                new_filename = "{uuid}_{filename}".format(uuid=uuid.uuid1(), filename=filename)\n                file_path = os.path.join(self.settings["MEDIA_ROOT"], new_filename)\n\n                async with aiofiles.open(file_path, "wb") as f:\n                    await f.write(meta["body"])\n\n                ret_data[\'file_path\'] = file_path\n\n        return self.finish(ret_data)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n',normalizedContent:'# ç®ä»\n\næç« ä»ç»çæ¯ä½¿ç¨tornadoå®ææä»¶çä¸ä¼ åè½\n\nè¯¥é¡¹ç®çgithubå°å: tornado_learning.git\n\n\n# æ å­\n\nè®¾ç½®æä»¶ä¸ä¼ çè·¯å¾\n\nä»£ç : tornado_learning/settings.py\n\nbase_dir = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))\nsettings = {\n    "media_root": os.path.join(base_dir, "media"),\n}\n\n\n1\n2\n3\n4\n\n\nä¿å­ä¸ä¼ æä»¶\n\nè·ååç«¯ä¼ éè¿æ¥çfront_imageæä»¶ï¼ç¶ååä½¿ç¨aiofileså®æä¸ä¼ æä»¶çäºè¿å¶å¼æ­¥åå¥ã\n\nä»£ç : /apps/hello/uploadhandler.py\n\n\nfrom tornado_learning.handler import basehandler\nimport os\nimport uuid\nimport aiofiles\n\nclass uploadhandler(basehandler):\n\n    async def post(self):\n        ret_data = {}\n\n        files_meta = self.request.files.get("front_image", none)\n        if not files_meta:\n            self.set_status(400)\n            ret_data["front_image"] = "è¯·ä¸ä¼ å¾ç"\n        else:\n            for meta in files_meta:\n                filename = meta["filename"]\n                new_filename = "{uuid}_{filename}".format(uuid=uuid.uuid1(), filename=filename)\n                file_path = os.path.join(self.settings["media_root"], new_filename)\n\n                async with aiofiles.open(file_path, "wb") as f:\n                    await f.write(meta["body"])\n\n                ret_data[\'file_path\'] = file_path\n\n        return self.finish(ret_data)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"tornado ä½¿ç¨jwtå®æç¨æ·å¼æ­¥è®¤è¯",frontmatter:{tags:["python","tornado"],title:"tornado ä½¿ç¨jwtå®æç¨æ·å¼æ­¥è®¤è¯",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/c24905/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"tornadoä½¿ç¨jwtå®ç°ç¨æ·çå¼æ­¥è®¤è¯",feed:{enable:!0},categories:["ç¼ç¨","python","tornado"],comment:!0,meta:[{name:"twitter:title",content:"tornado ä½¿ç¨jwtå®æç¨æ·å¼æ­¥è®¤è¯"},{name:"twitter:description",content:"tornadoä½¿ç¨jwtå®ç°ç¨æ·çå¼æ­¥è®¤è¯"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/02.tornado%20%E4%BD%BF%E7%94%A8jwt%E5%AE%8C%E6%88%90%E7%94%A8%E6%88%B7%E5%BC%82%E6%AD%A5%E8%AE%A4%E8%AF%81.html"},{property:"og:type",content:"article"},{property:"og:title",content:"tornado ä½¿ç¨jwtå®æç¨æ·å¼æ­¥è®¤è¯"},{property:"og:description",content:"tornadoä½¿ç¨jwtå®ç°ç¨æ·çå¼æ­¥è®¤è¯"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/02.tornado%20%E4%BD%BF%E7%94%A8jwt%E5%AE%8C%E6%88%90%E7%94%A8%E6%88%B7%E5%BC%82%E6%AD%A5%E8%AE%A4%E8%AF%81.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"tornado"},{itemprop:"name",content:"tornado ä½¿ç¨jwtå®æç¨æ·å¼æ­¥è®¤è¯"},{itemprop:"description",content:"tornadoä½¿ç¨jwtå®ç°ç¨æ·çå¼æ­¥è®¤è¯"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/02.tornado%20%E4%BD%BF%E7%94%A8jwt%E5%AE%8C%E6%88%90%E7%94%A8%E6%88%B7%E5%BC%82%E6%AD%A5%E8%AE%A4%E8%AF%81.html",relativePath:"04.ç¼ç¨/01.python/08.tornado/02.tornado ä½¿ç¨jwtå®æç¨æ·å¼æ­¥è®¤è¯.md",key:"v-2e6d253f",path:"/pages/c24905/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"æ å­",slug:"æ å­",normalizedTitle:"æ å­",charIndex:156}],headersStr:"ç®ä» æ å­",content:'# ç®ä»\n\nå¨ä½¿ç¨ç¹å®åè½æ¶ï¼éè¦éªè¯ç¨æ·æ¯å¦ç»å½ãä½¿ç¨jwtå°ç¨æ·ä¸ææçä¿¡æ¯ä¿å­å¨å®¢æ·ç«¯ä¸ï¼ç¶åè®¿é®æ¶ï¼å°å å¯çä¿¡æ¯åéç»æå¡ç«¯éªè¯ã\n\nåsessionçä¸åä¹å¤å¨äºï¼sessionéè¦å¨ä¸¤ç«¯é½å­å¨ï¼èjwtä»å¨å®¢æ·ç«¯å­å¨ã\n\nè¯¥é¡¹ç®çgithubå°å: tornado_learning.git\n\n\n# æ å­\n\nåå»ºå¼æ­¥éªè¯çè£é¥°å¨\n\nä»headerä¸­è·åtsessionidçjwt tokenä¿¡æ¯ï¼ç¶åä»tokenè·åç¨æ·idï¼ä»æ°æ®åºä¸­æ¥æ¾ç¨æ·ä¿¡æ¯ï¼åéªè¯tokenæ¯å¦è¿æã\n\nä»£ç : utils/authenticated_async.py\n\ndef authenticated_async(method):\n    async def wrapper(self, *args, **kwargs):\n\n        # ret_data = {}\n\n        tsessionid = self.request.headers.get("tsessionid", None)\n        if tsessionid:\n\n            try:\n                payload = jwt.decode(tsessionid, self.settings["secret_key"], leeway=self.settings["jwt_expire"],\n                                     options={"verify_exp": True})\n\n                user_id = payload["id"]\n                try:\n                    user = await self.application.objects.get(User, id=user_id)\n                    self._current_user = user\n                    await method(self, *args, **kwargs)\n                except User.DoesNotExist as e:\n                    self.set_status(401)\n            except jwt.ExpiredSignatureError as e:\n                self.set_status(401)\n\n    return wrapper\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nå¨è¯·æ±ä¸æ·»å ç¨æ·è®¤è¯\n\næ¯æ¬¡å¨è¯·æ±è¯¥æ¥å£æ¶ï¼é½éè¦å¯¹è¿è¡ç¨æ·è®¤è¯ï¼è®¤è¯éè¿æè½è®¿é®è¯¥æ¥å£ã\n\nä»£ç : apps/school/handle.py\n\n\nfrom utils.authenticated_async import authenticated_async\n\nclass StudentHandler(BaseHandler):\n\n    @authenticated_async\n    async def get(self):\n        id = self.get_argument("id", None)\n        if not id:\n            return self.write("please provide the \'id\'")\n\n        student = await self.application.objects.get(Student, id=id)\n\n        try:\n            self.write({\n                "id": student.id,\n                "name": student.name\n            })\n        except Student.DoesNotExist:\n            raise tornado.webHttpError(404, "Object not found")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n',normalizedContent:'# ç®ä»\n\nå¨ä½¿ç¨ç¹å®åè½æ¶ï¼éè¦éªè¯ç¨æ·æ¯å¦ç»å½ãä½¿ç¨jwtå°ç¨æ·ä¸ææçä¿¡æ¯ä¿å­å¨å®¢æ·ç«¯ä¸ï¼ç¶åè®¿é®æ¶ï¼å°å å¯çä¿¡æ¯åéç»æå¡ç«¯éªè¯ã\n\nåsessionçä¸åä¹å¤å¨äºï¼sessionéè¦å¨ä¸¤ç«¯é½å­å¨ï¼èjwtä»å¨å®¢æ·ç«¯å­å¨ã\n\nè¯¥é¡¹ç®çgithubå°å: tornado_learning.git\n\n\n# æ å­\n\nåå»ºå¼æ­¥éªè¯çè£é¥°å¨\n\nä»headerä¸­è·åtsessionidçjwt tokenä¿¡æ¯ï¼ç¶åä»tokenè·åç¨æ·idï¼ä»æ°æ®åºä¸­æ¥æ¾ç¨æ·ä¿¡æ¯ï¼åéªè¯tokenæ¯å¦è¿æã\n\nä»£ç : utils/authenticated_async.py\n\ndef authenticated_async(method):\n    async def wrapper(self, *args, **kwargs):\n\n        # ret_data = {}\n\n        tsessionid = self.request.headers.get("tsessionid", none)\n        if tsessionid:\n\n            try:\n                payload = jwt.decode(tsessionid, self.settings["secret_key"], leeway=self.settings["jwt_expire"],\n                                     options={"verify_exp": true})\n\n                user_id = payload["id"]\n                try:\n                    user = await self.application.objects.get(user, id=user_id)\n                    self._current_user = user\n                    await method(self, *args, **kwargs)\n                except user.doesnotexist as e:\n                    self.set_status(401)\n            except jwt.expiredsignatureerror as e:\n                self.set_status(401)\n\n    return wrapper\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nå¨è¯·æ±ä¸æ·»å ç¨æ·è®¤è¯\n\næ¯æ¬¡å¨è¯·æ±è¯¥æ¥å£æ¶ï¼é½éè¦å¯¹è¿è¡ç¨æ·è®¤è¯ï¼è®¤è¯éè¿æè½è®¿é®è¯¥æ¥å£ã\n\nä»£ç : apps/school/handle.py\n\n\nfrom utils.authenticated_async import authenticated_async\n\nclass studenthandler(basehandler):\n\n    @authenticated_async\n    async def get(self):\n        id = self.get_argument("id", none)\n        if not id:\n            return self.write("please provide the \'id\'")\n\n        student = await self.application.objects.get(student, id=id)\n\n        try:\n            self.write({\n                "id": student.id,\n                "name": student.name\n            })\n        except student.doesnotexist:\n            raise tornado.webhttperror(404, "object not found")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"tornado ç»åwtformsä½¿ç¨è¡¨åæä½",frontmatter:{tags:["python","tornado"],title:"tornado ç»åwtformsä½¿ç¨è¡¨åæä½",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/7ac01f/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"tornadoä½¿ç¨wtformsæ¥å¯¹è¡¨åè¿è¡éªè¯ä¸æä½ã",feed:{enable:!0},categories:["ç¼ç¨","python","tornado"],comment:!0,meta:[{name:"twitter:title",content:"tornado ç»åwtformsä½¿ç¨è¡¨åæä½"},{name:"twitter:description",content:"tornadoä½¿ç¨wtformsæ¥å¯¹è¡¨åè¿è¡éªè¯ä¸æä½ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/04.tornado%20%E7%BB%93%E5%90%88wtforms%E4%BD%BF%E7%94%A8%E8%A1%A8%E5%8D%95%E6%93%8D%E4%BD%9C.html"},{property:"og:type",content:"article"},{property:"og:title",content:"tornado ç»åwtformsä½¿ç¨è¡¨åæä½"},{property:"og:description",content:"tornadoä½¿ç¨wtformsæ¥å¯¹è¡¨åè¿è¡éªè¯ä¸æä½ã"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/04.tornado%20%E7%BB%93%E5%90%88wtforms%E4%BD%BF%E7%94%A8%E8%A1%A8%E5%8D%95%E6%93%8D%E4%BD%9C.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"tornado"},{itemprop:"name",content:"tornado ç»åwtformsä½¿ç¨è¡¨åæä½"},{itemprop:"description",content:"tornadoä½¿ç¨wtformsæ¥å¯¹è¡¨åè¿è¡éªè¯ä¸æä½ã"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/04.tornado%20%E7%BB%93%E5%90%88wtforms%E4%BD%BF%E7%94%A8%E8%A1%A8%E5%8D%95%E6%93%8D%E4%BD%9C.html",relativePath:"04.ç¼ç¨/01.python/08.tornado/04.tornado ç»åwtformsä½¿ç¨è¡¨åæä½.md",key:"v-573b59b6",path:"/pages/7ac01f/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"ä¾å­",slug:"ä¾å­",normalizedTitle:"ä¾å­",charIndex:110},{level:2,title:"htmlè¡¨å",slug:"htmlè¡¨å",normalizedTitle:"htmlè¡¨å",charIndex:1458},{level:2,title:"wtforms è¯»åjson",slug:"wtforms-è¯»åjson",normalizedTitle:"wtforms è¯»åjson",charIndex:2568}],headersStr:"ç®ä» ä¾å­ htmlè¡¨å wtforms è¯»åjson",content:'# ç®ä»\n\nå¨è·åè¯·æ±æ¶ï¼éè¦å°è¯·æ±çåæ°è¿è¡éªè¯ã\nä½¿ç¨wtformsåtornadoçç»åï¼å¯ä»¥è·åå°è¯·æ±çåæ°ï¼å¹¶ä¸å¯¹åæ°è¿è¡éªè¯ã\n\nè¯¥é¡¹ç®çgithubå°å: tornado_learning.git\n\n\n# ä¾å­\n\nåå»ºstudentçform\n\nä»£ç : apps/shchool/forms.py\n\n\nfrom wtforms_tornado import Form\nfrom wtforms import StringField, IntegerField, TextAreaField\nfrom wtforms.validators import DataRequired, Length\n\nclass StudentForm(Form):\n    """\n    å¯ä»¥ä½ä¸ºstudentç post å put çè¡¨åä½¿ç¨ã\n    """\n\n    id = IntegerField("id", null=True)\n    name = StringField("å§å", validators=[DataRequired("è¯·è¾å¥å§å")])\n    age = IntegerField("å¹´é¾", validators=[DataRequired("è¯·è¾å¥å¹´é¾")])\n    desc = TextAreaField("ä¸ªäººç®ä»", validators=[DataRequired("è¯·è¾å¥ä¸ªäººç®ä»")])\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nç¶åéè¿formæ¥æ¶åæ°ï¼å¯¹åæ°è¿è¡éªè¯ï¼éªè¯éè¿åæä½modelï¼å¯¹æ°æ®åºè¿è¡ä¿å­æä½\n\néè¿éåstudent_from.errorså¾å°æ ¡éªå¤±è´¥çå­æ®µï¼ç¶ååè¿åå°åç«¯æç¤ºã\n\nä»£ç : apps/school/handler.py\n\n\nimport tornado\n\nfrom apps.school.forms import StudentForm\nfrom apps.school.models import Student\nfrom tornado_learning.handler import BaseHandler\n\nclass StudentHandler(BaseHandler):\n\n        async def post(self):\n\n        ret_data = {}\n\n        student_form = StudentForm(self.request.arguments)\n        if student_form.validate():\n            await self.application.objects.create(Student, **student_form.data)\n\n            ret_data["ret"] = "success"\n        else:\n            for field in student_form.errors:\n                ret_data[field] = ret_data.errors[field][0]\n\n        return self.finish(ret_data)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n\n# htmlè¡¨å\n\nè¿å¯ä»¥éè¿wtformsåå»ºå¯¹åºçmodelæ¨¡æ¿è¡¨åã\n\nä¸ªäººä¸æ¯å¾æ¨èä½¿ç¨ï¼å ä¸ºååç«¯è¦åæ§å¤ªå¼ºã\n\nè·åè¡¨å\n\nä»£ç : apps/school/forms.py\n\nclass StudentFormHandler(BaseHandler):\n\n    def get(self):\n        studentForm = StudentForm()\n        return self.render("student.html", studentForm=studentForm)\n\n\n1\n2\n3\n4\n5\n\n\nè¡¨åçhtmlæ¨¡æ¿\nå°è¯¥æä»¶æ¾å¨templatesè·¯å¾ä¸\n\nä»£ç : templates/student.html\n\n<form action="/student" , method="post">\n    {% autoescape None %}\n    {% for field in studentForm %}\n        <span>{{ field.label.text }} :</span>\n        {{ field(placeholder="è¯·è¾å¥"+field.label.text) }}\n\n        {% if field.errors %}\n            {% for error_msg in field.errors %}\n                <div class="error-msg">{{ error_msg }}</div>\n                {% end %}\n                {% else %}\n                <div class="error-msg"></div>\n            {% end %}\n    {% end %}\n\n    <label>\n        <span>&nbsp;</span>\n        <input type="submit" class="button" value="æäº¤"/>\n    </label>\n</form>\n</body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\néè¦å¨è®¾ç½®é¡¹ä¸­è®¾ç½®æ¨¡æ¿è·¯å¾\nä»£ç :tornado_learning/settings.py\n\nsettings = {\n    "template_path": "templates"\n}\n\n\n1\n2\n3\n\n\n\n# wtforms è¯»åjson\n\nä½¿ç¨wtforms_jsonå¯ä»¥ä½¿è¡¨åç´æ¥å¯¹jsonåæ°çè¯»åã\n\nåå§åwtforms_json\n\né¦ééè¦å¯¹wtforms_jsonåå§åã\nä»£ç : server.py\n\nimport wtforms_json\nwtforms_json.init()\n\n\n1\n2\n\n\nå¨handlerä¸­è·åjsonåæ°ï¼ç¶åè¯»å¥å°formä¸­\n\nä»£ç : apps/school/handler.py\n\nclass TeacherHandler(BaseHandler):\n   \n    async def post(self):\n\n        ret_data = {}\n\n        param = self.request.body.decode("utf8")\n        param = json.loads(param)\n\n        teacherForm = TeacherForm.from_json(param)\n        print(teacherForm.data)\n        if teacherForm.validate():\n            teacher = await self.application.objects.create(Teacher, **teacherForm.data)\n\n            ret_data["ret"] = "success"\n        else:\n            for field in teacherForm.errors:\n                ret_data[field] = teacherForm.errors[field][0]\n\n        return self.finish(ret_data)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n',normalizedContent:'# ç®ä»\n\nå¨è·åè¯·æ±æ¶ï¼éè¦å°è¯·æ±çåæ°è¿è¡éªè¯ã\nä½¿ç¨wtformsåtornadoçç»åï¼å¯ä»¥è·åå°è¯·æ±çåæ°ï¼å¹¶ä¸å¯¹åæ°è¿è¡éªè¯ã\n\nè¯¥é¡¹ç®çgithubå°å: tornado_learning.git\n\n\n# ä¾å­\n\nåå»ºstudentçform\n\nä»£ç : apps/shchool/forms.py\n\n\nfrom wtforms_tornado import form\nfrom wtforms import stringfield, integerfield, textareafield\nfrom wtforms.validators import datarequired, length\n\nclass studentform(form):\n    """\n    å¯ä»¥ä½ä¸ºstudentç post å put çè¡¨åä½¿ç¨ã\n    """\n\n    id = integerfield("id", null=true)\n    name = stringfield("å§å", validators=[datarequired("è¯·è¾å¥å§å")])\n    age = integerfield("å¹´é¾", validators=[datarequired("è¯·è¾å¥å¹´é¾")])\n    desc = textareafield("ä¸ªäººç®ä»", validators=[datarequired("è¯·è¾å¥ä¸ªäººç®ä»")])\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nç¶åéè¿formæ¥æ¶åæ°ï¼å¯¹åæ°è¿è¡éªè¯ï¼éªè¯éè¿åæä½modelï¼å¯¹æ°æ®åºè¿è¡ä¿å­æä½\n\néè¿éåstudent_from.errorså¾å°æ ¡éªå¤±è´¥çå­æ®µï¼ç¶ååè¿åå°åç«¯æç¤ºã\n\nä»£ç : apps/school/handler.py\n\n\nimport tornado\n\nfrom apps.school.forms import studentform\nfrom apps.school.models import student\nfrom tornado_learning.handler import basehandler\n\nclass studenthandler(basehandler):\n\n        async def post(self):\n\n        ret_data = {}\n\n        student_form = studentform(self.request.arguments)\n        if student_form.validate():\n            await self.application.objects.create(student, **student_form.data)\n\n            ret_data["ret"] = "success"\n        else:\n            for field in student_form.errors:\n                ret_data[field] = ret_data.errors[field][0]\n\n        return self.finish(ret_data)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n\n# htmlè¡¨å\n\nè¿å¯ä»¥éè¿wtformsåå»ºå¯¹åºçmodelæ¨¡æ¿è¡¨åã\n\nä¸ªäººä¸æ¯å¾æ¨èä½¿ç¨ï¼å ä¸ºååç«¯è¦åæ§å¤ªå¼ºã\n\nè·åè¡¨å\n\nä»£ç : apps/school/forms.py\n\nclass studentformhandler(basehandler):\n\n    def get(self):\n        studentform = studentform()\n        return self.render("student.html", studentform=studentform)\n\n\n1\n2\n3\n4\n5\n\n\nè¡¨åçhtmlæ¨¡æ¿\nå°è¯¥æä»¶æ¾å¨templatesè·¯å¾ä¸\n\nä»£ç : templates/student.html\n\n<form action="/student" , method="post">\n    {% autoescape none %}\n    {% for field in studentform %}\n        <span>{{ field.label.text }} :</span>\n        {{ field(placeholder="è¯·è¾å¥"+field.label.text) }}\n\n        {% if field.errors %}\n            {% for error_msg in field.errors %}\n                <div class="error-msg">{{ error_msg }}</div>\n                {% end %}\n                {% else %}\n                <div class="error-msg"></div>\n            {% end %}\n    {% end %}\n\n    <label>\n        <span>&nbsp;</span>\n        <input type="submit" class="button" value="æäº¤"/>\n    </label>\n</form>\n</body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\néè¦å¨è®¾ç½®é¡¹ä¸­è®¾ç½®æ¨¡æ¿è·¯å¾\nä»£ç :tornado_learning/settings.py\n\nsettings = {\n    "template_path": "templates"\n}\n\n\n1\n2\n3\n\n\n\n# wtforms è¯»åjson\n\nä½¿ç¨wtforms_jsonå¯ä»¥ä½¿è¡¨åç´æ¥å¯¹jsonåæ°çè¯»åã\n\nåå§åwtforms_json\n\né¦ééè¦å¯¹wtforms_jsonåå§åã\nä»£ç : server.py\n\nimport wtforms_json\nwtforms_json.init()\n\n\n1\n2\n\n\nå¨handlerä¸­è·åjsonåæ°ï¼ç¶åè¯»å¥å°formä¸­\n\nä»£ç : apps/school/handler.py\n\nclass teacherhandler(basehandler):\n   \n    async def post(self):\n\n        ret_data = {}\n\n        param = self.request.body.decode("utf8")\n        param = json.loads(param)\n\n        teacherform = teacherform.from_json(param)\n        print(teacherform.data)\n        if teacherform.validate():\n            teacher = await self.application.objects.create(teacher, **teacherform.data)\n\n            ret_data["ret"] = "success"\n        else:\n            for field in teacherform.errors:\n                ret_data[field] = teacherform.errors[field][0]\n\n        return self.finish(ret_data)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"tornado finishåwriteåºå«",frontmatter:{tags:["python","tornado"],title:"tornado finishåwriteåºå«",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/d18657/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä»ç»tornadoä¸­finishåwriteçåºå«",feed:{enable:!0},categories:["ç¼ç¨","python","tornado"],comment:!0,meta:[{name:"twitter:title",content:"tornado finishåwriteåºå«"},{name:"twitter:description",content:"ä»ç»tornadoä¸­finishåwriteçåºå«"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/05.tornado%20finish%E5%92%8Cwrite%E5%8C%BA%E5%88%AB.html"},{property:"og:type",content:"article"},{property:"og:title",content:"tornado finishåwriteåºå«"},{property:"og:description",content:"ä»ç»tornadoä¸­finishåwriteçåºå«"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/05.tornado%20finish%E5%92%8Cwrite%E5%8C%BA%E5%88%AB.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"tornado"},{itemprop:"name",content:"tornado finishåwriteåºå«"},{itemprop:"description",content:"ä»ç»tornadoä¸­finishåwriteçåºå«"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/05.tornado%20finish%E5%92%8Cwrite%E5%8C%BA%E5%88%AB.html",relativePath:"04.ç¼ç¨/01.python/08.tornado/05.tornado finishåwriteåºå«.md",key:"v-0056c406",path:"/pages/d18657/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"ä¾å­",slug:"ä¾å­",normalizedTitle:"ä¾å­",charIndex:82},{level:2,title:"æ»ç»",slug:"æ»ç»",normalizedTitle:"æ»ç»",charIndex:556}],headersStr:"ç®ä» ä¾å­ æ»ç»",content:'# ç®ä»\n\nfinishåwriteé½å¯ä»¥å°åç«¯çæ°æ®ä¼ è¾å°åç«¯ãä»ä»¬æå¥å·®å«åã\n\nè¯¥é¡¹ç®çgithubå°å: tornado_learning.git\n\n\n# ä¾å­\n\nä»£ç apps/hello/write_finish_handler.py\n\nfrom tornado_learning.handler import BaseHandler\nimport time\n\nclass Write_Finish_Handler(BaseHandler):\n\n    def get(self):\n        self.write("hello")\n        time.sleep(4)\n        self.finish("world")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¨ç­å¾4ç§åï¼åæ¶è¾åºï¼ hello world\n\nclass Finish_Write_Handler(BaseHandler):\n\n    def get(self):\n        self.finish("hello")\n        self.write("world")\n\n\n1\n2\n3\n4\n5\n\n\nè¾åº: hello\nå¹¶ä¸æ¥é: Cannot write() after finish()\n\n\n# æ»ç»\n\nself.finish()ä»£è¡¨ååºå°åç«¯çç»ç»ãå¹¶ä¸å¯ä»¥å¨finshååä¸äºä¸ååºç»åç«¯æ å³çæä½ï¼ç¼©ç­ååºæ¶é´ã\nself.write()å¹¶ä¸ä¼é©¬ä¸å°æ°æ®è¿ååç«¯ï¼å¿é¡»å¨self.finsh()æèreturnåæä¼ååºï¼ç±»ä¼¼ä»¥ç¼å­å§ã',normalizedContent:'# ç®ä»\n\nfinishåwriteé½å¯ä»¥å°åç«¯çæ°æ®ä¼ è¾å°åç«¯ãä»ä»¬æå¥å·®å«åã\n\nè¯¥é¡¹ç®çgithubå°å: tornado_learning.git\n\n\n# ä¾å­\n\nä»£ç apps/hello/write_finish_handler.py\n\nfrom tornado_learning.handler import basehandler\nimport time\n\nclass write_finish_handler(basehandler):\n\n    def get(self):\n        self.write("hello")\n        time.sleep(4)\n        self.finish("world")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¨ç­å¾4ç§åï¼åæ¶è¾åºï¼ hello world\n\nclass finish_write_handler(basehandler):\n\n    def get(self):\n        self.finish("hello")\n        self.write("world")\n\n\n1\n2\n3\n4\n5\n\n\nè¾åº: hello\nå¹¶ä¸æ¥é: cannot write() after finish()\n\n\n# æ»ç»\n\nself.finish()ä»£è¡¨ååºå°åç«¯çç»ç»ãå¹¶ä¸å¯ä»¥å¨finshååä¸äºä¸ååºç»åç«¯æ å³çæä½ï¼ç¼©ç­ååºæ¶é´ã\nself.write()å¹¶ä¸ä¼é©¬ä¸å°æ°æ®è¿ååç«¯ï¼å¿é¡»å¨self.finsh()æèreturnåæä¼ååºï¼ç±»ä¼¼ä»¥ç¼å­å§ã',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"tornado ç¨æ·å¯ç  bcryptå å¯",frontmatter:{tags:["python","tornado"],title:"tornado ç¨æ·å¯ç  bcryptå å¯",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/22f35b/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä½¿ç¨bcryptæ¥å®ç°å¯¹ç¨æ·å¯ç è¿è¡å å¯",feed:{enable:!0},categories:["ç¼ç¨","python","tornado"],comment:!0,meta:[{name:"twitter:title",content:"tornado ç¨æ·å¯ç  bcryptå å¯"},{name:"twitter:description",content:"ä½¿ç¨bcryptæ¥å®ç°å¯¹ç¨æ·å¯ç è¿è¡å å¯"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/03.tornado%20%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%20bcrypt%E5%8A%A0%E5%AF%86.html"},{property:"og:type",content:"article"},{property:"og:title",content:"tornado ç¨æ·å¯ç  bcryptå å¯"},{property:"og:description",content:"ä½¿ç¨bcryptæ¥å®ç°å¯¹ç¨æ·å¯ç è¿è¡å å¯"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/03.tornado%20%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%20bcrypt%E5%8A%A0%E5%AF%86.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"tornado"},{itemprop:"name",content:"tornado ç¨æ·å¯ç  bcryptå å¯"},{itemprop:"description",content:"ä½¿ç¨bcryptæ¥å®ç°å¯¹ç¨æ·å¯ç è¿è¡å å¯"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/03.tornado%20%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%20bcrypt%E5%8A%A0%E5%AF%86.html",relativePath:"04.ç¼ç¨/01.python/08.tornado/03.tornado ç¨æ·å¯ç  bcryptå å¯.md",key:"v-fc3c6860",path:"/pages/22f35b/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"python å¦ä½ä½¿ç¨bcrypt æ å­",slug:"python-å¦ä½ä½¿ç¨bcrypt-æ å­",normalizedTitle:"python å¦ä½ä½¿ç¨bcrypt æ å­",charIndex:175},{level:2,title:"tornado ä½¿ç¨ bcrypt å å¯å¯ç æ å­ã",slug:"tornado-ä½¿ç¨-bcrypt-å å¯å¯ç æ å­ã",normalizedTitle:"tornado ä½¿ç¨ bcrypt å å¯å¯ç æ å­ã",charIndex:437},{level:3,title:"åå»ºuser model",slug:"åå»ºuser-model",normalizedTitle:"åå»ºuser model",charIndex:467},{level:3,title:"æ³¨åçhandler",slug:"æ³¨åçhandler",normalizedTitle:"æ³¨åçhandler",charIndex:2218}],headersStr:"ç®ä» python å¦ä½ä½¿ç¨bcrypt æ å­ tornado ä½¿ç¨ bcrypt å å¯å¯ç æ å­ã åå»ºuser model æ³¨åçhandler",content:'# ç®ä»\n\nbcrypt å¯ä»¥éè¿å ççæ¹å¼å¯¹å¯ç è¿è¡å å¯ï¼æ´å çå®å¨å¯é ã\n\nè¯¥é¡¹ç®çgithubå°å: tornado_learning.git\n\nä¼ç¹\n\nmd5å å¯ï¼æ¯ä¸ªå¯¹åºçææå¯ç ï¼å¯¹åºçæ¯ä¸æ ·çå å¯çå¯æï¼æ¯è¾å®¹æçè¿è¡è§£å¯ãèbcryptæ¯ä¸æ¬¡çææå¯ç å¾å°çæ¯ä¸åçå å¯çå¯æï¼å ä¸ºå¯ææ¯éè¿éæºççç»åå å¯ï¼æä»¥æ´å å®å¨ã\n\n\n# python å¦ä½ä½¿ç¨bcrypt æ å­\n\nfrom bcrypt import hashpw, gensalt\n\n# è¿ä¸ªæ¯éæºçæçç\nsalt = gensalt(12)\n\n# è¿ä¸ªæ¯éè¿çå»å å¯\npasswd = hashpw("123456".encode(\'utf8\'), salt)\n\n# å°è¾å¥çææå¯ç ä¸å¯æå¯ç è¿è¡å å¯ï¼æ¯å¦ç­äºå¯æå¯ç ã\nhashpw(input_passwd.encode(\'utf8\'), passwd) == passwd\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# tornado ä½¿ç¨ bcrypt å å¯å¯ç æ å­ã\n\n\n# åå»ºuser model\n\nå¨user modelä¸­çå¯ç å­æ®µä½¿ç¨èªå®ä¹çPasswordField.\n\nä»£ç /apps/user/models.py\n\nclass PasswordHash(bytes):\n    def check_password(self, password):\n        """\n        æ¯è¾ä¼ å¥çå¯ç åæ°æ®åºä¸­çå¯ç æ¯å¦å¹é\n        :param password:\n        :return:\n        """\n        password = password.encode(\'utf-8\')\n        return hashpw(password, self) == self\n\nclass PasswordField(BlobField):\n    def __init__(self, iterations=12, *args, **kwargs):\n        if None in (hashpw, gensalt):\n            raise ValueError(\'Missing library required for PasswordField: bcrypt\')\n        self.bcrypt_iterations = iterations\n        self.raw_password = None\n        super(PasswordField, self).__init__(*args, **kwargs)\n\n    def db_value(self, value):\n        """\n        å°pythonçå¼è½¬æ¢æå­å¥æ°æ®åºçå¼\n        å­å¥æ°æ®åºçå¼ï¼æ¯éè¿bcryptå å¯åçå¯æã\n        :param value:\n        :return:\n        """\n        if isinstance(value, PasswordHash):\n            return bytes(value)\n\n        if isinstance(value, str):\n            value = value.encode(\'utf-8\')\n        salt = gensalt(self.bcrypt_iterations)\n        return value if value is None else hashpw(value, salt)\n\n    def python_value(self, value):\n        """\n        å°æ°æ®åºä¸­çå¼è½¬æ¢æpythonä¸­çå¼\n        è¿ä¸ªå¼æ¯ä¸ä¸ªPasswordHashå¯¹è±¡ãè¯¥å¯¹è±¡æä¾æ¯è¾å¯ç çæ¹æ³ã\n        :param value:\n        :return:\n        """\n        if isinstance(value, str):\n            value = value.encode(\'utf-8\')\n\n        return PasswordHash(value)\n\nclass User(BaseModel):\n    username = CharField(max_length=16, verbose_name="ç¨æ·å", index=True, unique=True)\n    password = PasswordField(verbose_name="å¯ç ")\n    address = CharField(max_length=200, null=True, verbose_name="å°å")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n\n\n\n# æ³¨åçhandler\n\næ³¨åçæ¥å£\n\nä»£ç : /apps/user/handler.py\n\nclass RegisterHandler(BaseHandler):\n\n    async def post(self):\n\n        ret_data = {}\n\n        registerForm = RegisterForm(self.request.arguments)\n        if registerForm.validate():\n            username = registerForm.username.data\n\n            try:\n                exist_user = await self.application.objects.get(User, username=username)\n                ret_data["username"] = "ç¨æ·åå·²ç»å­å¨"\n            except User.DoesNotExist as e:\n                user = await self.application.objects.create(User, **registerForm.data)\n                ret_data["id"] = user.id\n        else:\n            self.set_status(400)\n            for field in registerForm.erros:\n                ret_data[field] = registerForm[field][0]\n\n        return self.finish(ret_data)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n',normalizedContent:'# ç®ä»\n\nbcrypt å¯ä»¥éè¿å ççæ¹å¼å¯¹å¯ç è¿è¡å å¯ï¼æ´å çå®å¨å¯é ã\n\nè¯¥é¡¹ç®çgithubå°å: tornado_learning.git\n\nä¼ç¹\n\nmd5å å¯ï¼æ¯ä¸ªå¯¹åºçææå¯ç ï¼å¯¹åºçæ¯ä¸æ ·çå å¯çå¯æï¼æ¯è¾å®¹æçè¿è¡è§£å¯ãèbcryptæ¯ä¸æ¬¡çææå¯ç å¾å°çæ¯ä¸åçå å¯çå¯æï¼å ä¸ºå¯ææ¯éè¿éæºççç»åå å¯ï¼æä»¥æ´å å®å¨ã\n\n\n# python å¦ä½ä½¿ç¨bcrypt æ å­\n\nfrom bcrypt import hashpw, gensalt\n\n# è¿ä¸ªæ¯éæºçæçç\nsalt = gensalt(12)\n\n# è¿ä¸ªæ¯éè¿çå»å å¯\npasswd = hashpw("123456".encode(\'utf8\'), salt)\n\n# å°è¾å¥çææå¯ç ä¸å¯æå¯ç è¿è¡å å¯ï¼æ¯å¦ç­äºå¯æå¯ç ã\nhashpw(input_passwd.encode(\'utf8\'), passwd) == passwd\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# tornado ä½¿ç¨ bcrypt å å¯å¯ç æ å­ã\n\n\n# åå»ºuser model\n\nå¨user modelä¸­çå¯ç å­æ®µä½¿ç¨èªå®ä¹çpasswordfield.\n\nä»£ç /apps/user/models.py\n\nclass passwordhash(bytes):\n    def check_password(self, password):\n        """\n        æ¯è¾ä¼ å¥çå¯ç åæ°æ®åºä¸­çå¯ç æ¯å¦å¹é\n        :param password:\n        :return:\n        """\n        password = password.encode(\'utf-8\')\n        return hashpw(password, self) == self\n\nclass passwordfield(blobfield):\n    def __init__(self, iterations=12, *args, **kwargs):\n        if none in (hashpw, gensalt):\n            raise valueerror(\'missing library required for passwordfield: bcrypt\')\n        self.bcrypt_iterations = iterations\n        self.raw_password = none\n        super(passwordfield, self).__init__(*args, **kwargs)\n\n    def db_value(self, value):\n        """\n        å°pythonçå¼è½¬æ¢æå­å¥æ°æ®åºçå¼\n        å­å¥æ°æ®åºçå¼ï¼æ¯éè¿bcryptå å¯åçå¯æã\n        :param value:\n        :return:\n        """\n        if isinstance(value, passwordhash):\n            return bytes(value)\n\n        if isinstance(value, str):\n            value = value.encode(\'utf-8\')\n        salt = gensalt(self.bcrypt_iterations)\n        return value if value is none else hashpw(value, salt)\n\n    def python_value(self, value):\n        """\n        å°æ°æ®åºä¸­çå¼è½¬æ¢æpythonä¸­çå¼\n        è¿ä¸ªå¼æ¯ä¸ä¸ªpasswordhashå¯¹è±¡ãè¯¥å¯¹è±¡æä¾æ¯è¾å¯ç çæ¹æ³ã\n        :param value:\n        :return:\n        """\n        if isinstance(value, str):\n            value = value.encode(\'utf-8\')\n\n        return passwordhash(value)\n\nclass user(basemodel):\n    username = charfield(max_length=16, verbose_name="ç¨æ·å", index=true, unique=true)\n    password = passwordfield(verbose_name="å¯ç ")\n    address = charfield(max_length=200, null=true, verbose_name="å°å")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n\n\n\n# æ³¨åçhandler\n\næ³¨åçæ¥å£\n\nä»£ç : /apps/user/handler.py\n\nclass registerhandler(basehandler):\n\n    async def post(self):\n\n        ret_data = {}\n\n        registerform = registerform(self.request.arguments)\n        if registerform.validate():\n            username = registerform.username.data\n\n            try:\n                exist_user = await self.application.objects.get(user, username=username)\n                ret_data["username"] = "ç¨æ·åå·²ç»å­å¨"\n            except user.doesnotexist as e:\n                user = await self.application.objects.create(user, **registerform.data)\n                ret_data["id"] = user.id\n        else:\n            self.set_status(400)\n            for field in registerform.erros:\n                ret_data[field] = registerform[field][0]\n\n        return self.finish(ret_data)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"pythonç®åä½¿ç¨grpc",frontmatter:{title:"pythonç®åä½¿ç¨grpc",date:"2022-09-06T19:45:31.000Z",permalink:"/pages/f9d78c/",tags:["python"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ç®åä»ç»Pythonå¦ä½ä½¿ç¨grpc",feed:{enable:!0},categories:["ç¼ç¨","python","å¶ä»"],comment:!0,meta:[{name:"twitter:title",content:"pythonç®åä½¿ç¨grpc"},{name:"twitter:description",content:"ç®åä»ç»Pythonå¦ä½ä½¿ç¨grpc"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/09.%E5%85%B6%E4%BB%96/01.python%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8grpc.html"},{property:"og:type",content:"article"},{property:"og:title",content:"pythonç®åä½¿ç¨grpc"},{property:"og:description",content:"ç®åä»ç»Pythonå¦ä½ä½¿ç¨grpc"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/09.%E5%85%B6%E4%BB%96/01.python%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8grpc.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-09-06T19:45:31.000Z"},{property:"article:tag",content:"python"},{itemprop:"name",content:"pythonç®åä½¿ç¨grpc"},{itemprop:"description",content:"ç®åä»ç»Pythonå¦ä½ä½¿ç¨grpc"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/09.%E5%85%B6%E4%BB%96/01.python%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8grpc.html",relativePath:"04.ç¼ç¨/01.python/09.å¶ä»/01.pythonç®åä½¿ç¨grpc.md",key:"v-3b941cbe",path:"/pages/f9d78c/",headers:[{level:2,title:"0. ç¸å³é¾æ¥",slug:"_0-ç¸å³é¾æ¥",normalizedTitle:"0. ç¸å³é¾æ¥",charIndex:2},{level:2,title:"1. åå»ºprotobufæä»¶",slug:"_1-åå»ºprotobufæä»¶",normalizedTitle:"1. åå»ºprotobufæä»¶",charIndex:116},{level:2,title:"2. ç¼è¯protoæä»¶",slug:"_2-ç¼è¯protoæä»¶",normalizedTitle:"2. ç¼è¯protoæä»¶",charIndex:826},{level:2,title:"3. ç®åæµè¯protobufæ°æ®ç»æçåºååä¸ååºåå",slug:"_3-ç®åæµè¯protobufæ°æ®ç»æçåºååä¸ååºåå",normalizedTitle:"3. ç®åæµè¯protobufæ°æ®ç»æçåºååä¸ååºåå",charIndex:1418},{level:2,title:"4. åå»ºgrpcæå¡ç«¯",slug:"_4-åå»ºgrpcæå¡ç«¯",normalizedTitle:"4. åå»ºgrpcæå¡ç«¯",charIndex:1899},{level:2,title:"5. åå»ºgrpcå®¢æ·ç«¯",slug:"_5-åå»ºgrpcå®¢æ·ç«¯",normalizedTitle:"5. åå»ºgrpcå®¢æ·ç«¯",charIndex:2901}],headersStr:"0. ç¸å³é¾æ¥ 1. åå»ºprotobufæä»¶ 2. ç¼è¯protoæä»¶ 3. ç®åæµè¯protobufæ°æ®ç»æçåºååä¸ååºåå 4. åå»ºgrpcæå¡ç«¯ 5. åå»ºgrpcå®¢æ·ç«¯",content:"# 0. ç¸å³é¾æ¥\n\næºç æ¡ä¾ï¼https://github.com/msqfx/python-examples\n\nå®æ¹ææ¡£ï¼https://grpc.io/docs/languages/python/quickstart\n\n\n# 1. åå»ºprotobufæä»¶\n\nå¨ç®å½protoç®å½ä¸åå»ºuser.protoæä»¶ï¼åå»ºUserçrpcæå¡å®ä¹ï¼è¯¥æå¡ä¸­åå«AddUseråGetUserä¸¤ä¸ªè°ç¨ï¼å¹¶ä½¿ç¨ä¸é¢åå»ºçå¯¹åºçç»æä½ä½ä¸ºè¯·æ±ä½åååºä½ã æ³¨æï¼éè¦æ·»å package protoï¼å¦åä¸é¢ç¼è¯çæçpythonæä»¶å¼ç¨è·¯å¾åä¸æ­£ç¡®ã\n\nsyntax = \"proto3\";\n\n// åå\npackage proto;\n\n// å®ä¹User rpcæå¡\nservice User {\n  // å®ä¹rpcæå¡çæ¹æ³\n  rpc AddUser (UserRequest) returns (UserResponse);\n  rpc GetUser (GetUserRequest) returns (GetUserResponse);\n}\n\n// è¯·æ±çç»æä½\nmessage UserRequest {\n  string name = 1;\n  uint32 age = 2;\n}\n\n// ååºçç»æä½\nmessage UserResponse {\n  string msg = 1;\n  int32 code = 2;\n}\n\nmessage GetUserRequest {\n  string name = 1;\n}\n\nmessage GetUserResponse {\n  string name = 1;\n  string age = 2;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# 2. ç¼è¯protoæä»¶\n\né¦ééè¦å®è£grpcçåºåå·¥å·\n\npython -m pip install grpcio #å®è£grpc\npython -m pip install grpcio-tools #å®è£grpc tools\n\n\n1\n2\n\n\nç¶åï¼è¿è¡å½ä»¤å¯¹protoæä»¶è¿è¡ç¼è¯ï¼ä¼æ ¹æ®ä¸é¢çprotoæä»¶çæå¯¹åºçpythonæä»¶ï¼ä½ ä¼åç°å¨protoç®å½ä¸åå»ºäºuser_pb2.pyåuser_pb2_grpc.pyä¸¤ä¸ªæä»¶\n\npython -m grpc_tools.protoc --python_out=. --grpc_python_out=. -I. ./proto/user.proto\n\n\n1\n\n * --python_out=.ï¼protobufç¸å³ä»£ç æä»¶çæå¨è¿é\n * --grpc_python_out=.ï¼grpcç¸å³ä»£ç çæå¨è¿é\n * -I. ./proto/user.protoï¼protoæä»¶è·¯å¾\n\nç¼è¯åï¼\n\n * user_pb2.pyï¼ç¨æ¥å protobuf æ°æ®è¿è¡äº¤äºï¼è¿ä¸ªå°±æ¯æ ¹æ®protoæä»¶å®ä¹å¥½çæ°æ®ç»æç±»åçæçpythonåçæ°æ®ç»ææä»¶\n * user_pb2_grpc.py: ç¨æ¥å grpc è¿è¡äº¤äºï¼è¿ä¸ªå°±æ¯å®ä¹äºrpcæ¹æ³çç±»ï¼åå«äºç±»çè¯·æ±åæ°åååºç­ç­ï¼å¯ç¨pythonç´æ¥å®ä¾åè°ç¨\n\n\n# 3. ç®åæµè¯protobufæ°æ®ç»æçåºååä¸ååºåå\n\næä»¬åå»ºproto_test.pyæä»¶ï¼åå»ºUserå¯¹è±¡ï¼å¡«åå¼ï¼å¹¶å°è¯¥å¯¹è±¡åºååæå­ç¬¦ä¸²è¾åº\n\nfrom proto import user_pb2\n\n# åå»ºStudentå¯¹è±¡ï¼å°è¯¥å¯¹è±¡åºååæå­ç¬¦ä¸²\ns = user_pb2.UserRequest()\ns.name = \"zhangsan\"\ns.age = 12\nreq_str = s.SerializeToString()\nprint(req_str)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nè¾åºï¼\n\nb'\\n\\x08zhangsan\\x10\\x0c'\n\n\n1\n\n\nç¶åæä»¬ååå»ºUserå¯¹è±¡å°å°ä¸é¢çè¾åºçåºååå­ç¬¦ä¸²ååºååè¿æ¥ã\n\n# å°ä¸é¢çè¾åºçåºååå­ç¬¦ä¸²ååºååæå¯¹è±¡\ns2 = user_pb2.UserRequest()\ns2.ParseFromString(req_str)\nprint(s2.name)\nprint(s2.age)\n\n\n1\n2\n3\n4\n5\n\n\nè¾åºï¼\n\nzhangsan\n12\n\n\n1\n2\n\n\n\n# 4. åå»ºgrpcæå¡ç«¯\n\nä¸é¢æ¯ä½¿ç¨ä¹ååå»ºçprotobufågrpcæä»¶æ¥æå»ºgrpcæå¡ç«¯ä»£ç ã\n\nimport logging\nfrom concurrent import futures\n\nimport grpc\n\nfrom proto import user_pb2, user_pb2_grpc\n\n\nclass UserService(user_pb2_grpc.UserServicer):\n\n    # å®ç°protoæä»¶ä¸­rpcçè°ç¨\n    def AddUser(self, request: user_pb2.UserRequest, context):\n        return user_pb2.UserResponse(msg='add user(name={},age={}) success'.format(request.name, request.age), code=0)\n\n    def GetUser(self, request: user_pb2.GetUserRequest, context):\n        return user_pb2.GetUserResponse(name=request.name, age=\"1888\")\n\n\ndef serve():\n    # ä½¿ç¨çº¿ç¨æ± æ¥å®ægrpcçè¯·æ±\n    server = grpc.server(futures.ThreadPoolExecutor(max_workers=5))\n    user_pb2_grpc.add_UserServicer_to_server(UserService(), server)\n    server.add_insecure_port('[::]:50051')  # ç»å®ç«¯å£\n    server.start()\n    server.wait_for_termination()\n\n\nif __name__ == '__main__':\n    logging.basicConfig()\n    serve()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\nè¿è¡è¯¥æå¡ç«¯ï¼ä¼é»å¡ç­å¾å®¢æ·ç«¯çè¯·æ±ã\n\n\n# 5. åå»ºgrpcå®¢æ·ç«¯\n\nimport logging\n\nimport grpc\n\nfrom proto import user_pb2, user_pb2_grpc\n\n\ndef run():\n    # è¿æ¥rpcæå¡\n    with grpc.insecure_channel('localhost:50051') as channel:\n        stub = user_pb2_grpc.UserStub(channel)\n\n        # è°ç¨rpcæå¡çAddUseræ¹æ³\n        response: user_pb2.UserResponse = stub.AddUser(user_pb2.UserRequest(name=\"zhangsan\", age=18))\n        print(\"add user, response is 'msg={}, code={}'\".format(response.msg, response.code))\n\n        # è°ç¨rpcæå¡çGetUseræ¹æ³\n        response: user_pb2.GetUserResponse = stub.GetUser(user_pb2.GetUserRequest(name=\"lisi\"))\n        print(\"get user[name={}, age={}]\".format(response.name, response.age))\n\n\nif __name__ == '__main__':\n    logging.basicConfig()\n    run()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nè¿è¡å®¢æ·ç«¯ï¼è°ç¨rpcæå¡ï¼è¾åºï¼\n\nadd user, response is 'msg=add user(name=zhangsan,age=18) success, code=0'\nget user[name=lisi, age=1888]\n\n\n1\n2\n",normalizedContent:"# 0. ç¸å³é¾æ¥\n\næºç æ¡ä¾ï¼https://github.com/msqfx/python-examples\n\nå®æ¹ææ¡£ï¼https://grpc.io/docs/languages/python/quickstart\n\n\n# 1. åå»ºprotobufæä»¶\n\nå¨ç®å½protoç®å½ä¸åå»ºuser.protoæä»¶ï¼åå»ºuserçrpcæå¡å®ä¹ï¼è¯¥æå¡ä¸­åå«adduserågetuserä¸¤ä¸ªè°ç¨ï¼å¹¶ä½¿ç¨ä¸é¢åå»ºçå¯¹åºçç»æä½ä½ä¸ºè¯·æ±ä½åååºä½ã æ³¨æï¼éè¦æ·»å package protoï¼å¦åä¸é¢ç¼è¯çæçpythonæä»¶å¼ç¨è·¯å¾åä¸æ­£ç¡®ã\n\nsyntax = \"proto3\";\n\n// åå\npackage proto;\n\n// å®ä¹user rpcæå¡\nservice user {\n  // å®ä¹rpcæå¡çæ¹æ³\n  rpc adduser (userrequest) returns (userresponse);\n  rpc getuser (getuserrequest) returns (getuserresponse);\n}\n\n// è¯·æ±çç»æä½\nmessage userrequest {\n  string name = 1;\n  uint32 age = 2;\n}\n\n// ååºçç»æä½\nmessage userresponse {\n  string msg = 1;\n  int32 code = 2;\n}\n\nmessage getuserrequest {\n  string name = 1;\n}\n\nmessage getuserresponse {\n  string name = 1;\n  string age = 2;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# 2. ç¼è¯protoæä»¶\n\né¦ééè¦å®è£grpcçåºåå·¥å·\n\npython -m pip install grpcio #å®è£grpc\npython -m pip install grpcio-tools #å®è£grpc tools\n\n\n1\n2\n\n\nç¶åï¼è¿è¡å½ä»¤å¯¹protoæä»¶è¿è¡ç¼è¯ï¼ä¼æ ¹æ®ä¸é¢çprotoæä»¶çæå¯¹åºçpythonæä»¶ï¼ä½ ä¼åç°å¨protoç®å½ä¸åå»ºäºuser_pb2.pyåuser_pb2_grpc.pyä¸¤ä¸ªæä»¶\n\npython -m grpc_tools.protoc --python_out=. --grpc_python_out=. -i. ./proto/user.proto\n\n\n1\n\n * --python_out=.ï¼protobufç¸å³ä»£ç æä»¶çæå¨è¿é\n * --grpc_python_out=.ï¼grpcç¸å³ä»£ç çæå¨è¿é\n * -i. ./proto/user.protoï¼protoæä»¶è·¯å¾\n\nç¼è¯åï¼\n\n * user_pb2.pyï¼ç¨æ¥å protobuf æ°æ®è¿è¡äº¤äºï¼è¿ä¸ªå°±æ¯æ ¹æ®protoæä»¶å®ä¹å¥½çæ°æ®ç»æç±»åçæçpythonåçæ°æ®ç»ææä»¶\n * user_pb2_grpc.py: ç¨æ¥å grpc è¿è¡äº¤äºï¼è¿ä¸ªå°±æ¯å®ä¹äºrpcæ¹æ³çç±»ï¼åå«äºç±»çè¯·æ±åæ°åååºç­ç­ï¼å¯ç¨pythonç´æ¥å®ä¾åè°ç¨\n\n\n# 3. ç®åæµè¯protobufæ°æ®ç»æçåºååä¸ååºåå\n\næä»¬åå»ºproto_test.pyæä»¶ï¼åå»ºuserå¯¹è±¡ï¼å¡«åå¼ï¼å¹¶å°è¯¥å¯¹è±¡åºååæå­ç¬¦ä¸²è¾åº\n\nfrom proto import user_pb2\n\n# åå»ºstudentå¯¹è±¡ï¼å°è¯¥å¯¹è±¡åºååæå­ç¬¦ä¸²\ns = user_pb2.userrequest()\ns.name = \"zhangsan\"\ns.age = 12\nreq_str = s.serializetostring()\nprint(req_str)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nè¾åºï¼\n\nb'\\n\\x08zhangsan\\x10\\x0c'\n\n\n1\n\n\nç¶åæä»¬ååå»ºuserå¯¹è±¡å°å°ä¸é¢çè¾åºçåºååå­ç¬¦ä¸²ååºååè¿æ¥ã\n\n# å°ä¸é¢çè¾åºçåºååå­ç¬¦ä¸²ååºååæå¯¹è±¡\ns2 = user_pb2.userrequest()\ns2.parsefromstring(req_str)\nprint(s2.name)\nprint(s2.age)\n\n\n1\n2\n3\n4\n5\n\n\nè¾åºï¼\n\nzhangsan\n12\n\n\n1\n2\n\n\n\n# 4. åå»ºgrpcæå¡ç«¯\n\nä¸é¢æ¯ä½¿ç¨ä¹ååå»ºçprotobufågrpcæä»¶æ¥æå»ºgrpcæå¡ç«¯ä»£ç ã\n\nimport logging\nfrom concurrent import futures\n\nimport grpc\n\nfrom proto import user_pb2, user_pb2_grpc\n\n\nclass userservice(user_pb2_grpc.userservicer):\n\n    # å®ç°protoæä»¶ä¸­rpcçè°ç¨\n    def adduser(self, request: user_pb2.userrequest, context):\n        return user_pb2.userresponse(msg='add user(name={},age={}) success'.format(request.name, request.age), code=0)\n\n    def getuser(self, request: user_pb2.getuserrequest, context):\n        return user_pb2.getuserresponse(name=request.name, age=\"1888\")\n\n\ndef serve():\n    # ä½¿ç¨çº¿ç¨æ± æ¥å®ægrpcçè¯·æ±\n    server = grpc.server(futures.threadpoolexecutor(max_workers=5))\n    user_pb2_grpc.add_userservicer_to_server(userservice(), server)\n    server.add_insecure_port('[::]:50051')  # ç»å®ç«¯å£\n    server.start()\n    server.wait_for_termination()\n\n\nif __name__ == '__main__':\n    logging.basicconfig()\n    serve()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\nè¿è¡è¯¥æå¡ç«¯ï¼ä¼é»å¡ç­å¾å®¢æ·ç«¯çè¯·æ±ã\n\n\n# 5. åå»ºgrpcå®¢æ·ç«¯\n\nimport logging\n\nimport grpc\n\nfrom proto import user_pb2, user_pb2_grpc\n\n\ndef run():\n    # è¿æ¥rpcæå¡\n    with grpc.insecure_channel('localhost:50051') as channel:\n        stub = user_pb2_grpc.userstub(channel)\n\n        # è°ç¨rpcæå¡çadduseræ¹æ³\n        response: user_pb2.userresponse = stub.adduser(user_pb2.userrequest(name=\"zhangsan\", age=18))\n        print(\"add user, response is 'msg={}, code={}'\".format(response.msg, response.code))\n\n        # è°ç¨rpcæå¡çgetuseræ¹æ³\n        response: user_pb2.getuserresponse = stub.getuser(user_pb2.getuserrequest(name=\"lisi\"))\n        print(\"get user[name={}, age={}]\".format(response.name, response.age))\n\n\nif __name__ == '__main__':\n    logging.basicconfig()\n    run()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nè¿è¡å®¢æ·ç«¯ï¼è°ç¨rpcæå¡ï¼è¾åºï¼\n\nadd user, response is 'msg=add user(name=zhangsan,age=18) success, code=0'\nget user[name=lisi, age=1888]\n\n\n1\n2\n",charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"tornado ä½¿ç¨peewee-async å®æå¼æ­¥ormæ°æ®åºæä½",frontmatter:{tags:["python","tornado"],title:"tornado ä½¿ç¨peewee-async å®æå¼æ­¥ormæ°æ®åºæä½",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/113ab1/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"tornadoä¸­ä½¿ç¨peewee-asyncæ¥å®æå¼æ­¥ormæ°æ®åºæä½",feed:{enable:!0},categories:["ç¼ç¨","python","tornado"],comment:!0,meta:[{name:"twitter:title",content:"tornado ä½¿ç¨peewee-async å®æå¼æ­¥ormæ°æ®åºæä½"},{name:"twitter:description",content:"tornadoä¸­ä½¿ç¨peewee-asyncæ¥å®æå¼æ­¥ormæ°æ®åºæä½"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/06.tornado%20%E4%BD%BF%E7%94%A8peewee-async%20%E5%AE%8C%E6%88%90%E5%BC%82%E6%AD%A5orm%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C.html"},{property:"og:type",content:"article"},{property:"og:title",content:"tornado ä½¿ç¨peewee-async å®æå¼æ­¥ormæ°æ®åºæä½"},{property:"og:description",content:"tornadoä¸­ä½¿ç¨peewee-asyncæ¥å®æå¼æ­¥ormæ°æ®åºæä½"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/06.tornado%20%E4%BD%BF%E7%94%A8peewee-async%20%E5%AE%8C%E6%88%90%E5%BC%82%E6%AD%A5orm%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"tornado"},{itemprop:"name",content:"tornado ä½¿ç¨peewee-async å®æå¼æ­¥ormæ°æ®åºæä½"},{itemprop:"description",content:"tornadoä¸­ä½¿ç¨peewee-asyncæ¥å®æå¼æ­¥ormæ°æ®åºæä½"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/08.tornado/06.tornado%20%E4%BD%BF%E7%94%A8peewee-async%20%E5%AE%8C%E6%88%90%E5%BC%82%E6%AD%A5orm%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C.html",relativePath:"04.ç¼ç¨/01.python/08.tornado/06.tornado ä½¿ç¨peewee-async å®æå¼æ­¥ormæ°æ®åºæä½.md",key:"v-05407dda",path:"/pages/113ab1/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"éç½®",slug:"éç½®",normalizedTitle:"éç½®",charIndex:169},{level:2,title:"åå»ºmodel",slug:"åå»ºmodel",normalizedTitle:"åå»ºmodel",charIndex:1026},{level:2,title:"å¢å æ¹æ¥",slug:"å¢å æ¹æ¥",normalizedTitle:"å¢å æ¹æ¥",charIndex:2523},{level:2,title:"è¿è¡¨æ¥è¯¢",slug:"è¿è¡¨æ¥è¯¢",normalizedTitle:"è¿è¡¨æ¥è¯¢",charIndex:4290}],headersStr:"ç®ä» éç½® åå»ºmodel å¢å æ¹æ¥ è¿è¡¨æ¥è¯¢",content:'# ç®ä»\n\ntornadoæ¯ä¸ä¸ªå¼æ­¥webæ¡æ¶ï¼å¶ä¸­ä¸è½ä½¿ç¨é»å¡çæä½ï¼ä¸ç¶ä¼å¯¼è´æ´ä¸ªç¨åºçé»å¡ãæ°æ®åºæä½æ¶ä¸å¯é¿åçéè¦ä½¿ç¨ï¼è¿ééç¨çæ¯peewee-asyncå»è§£å³ã\n\npeewee-async æ¯ä¸ä¸ªä¸º peewee ormæ¡æ¶æä¾å¼æ­¥æ¥å£çåºã\n\nè¯¥é¡¹ç®çgithubå°å: tornado_learning.git\n\n\n# éç½®\n\nå¨settings.pyæä»¶ä¸­åå»ºè¿æ¥æ°æ®åº\nä»£ç : server.py\n\nimport peewee_async\n\ndatabase = peewee_async.MySQLDatabase("tornado_learning", "127.0.0.1", port=3306, user="root", password="root1234")\n\n\n1\n2\n3\n\n\nå¨server.pyä¸­å¼ç¨æ°æ®åºè¿æ¥ï¼å¹¶å å¥å°appä¸­\n\nfrom peewee_async import Manager\nfrom tornado import web, ioloop\n\nfrom tornado_learning.settings import database\nfrom tornado_learning.settings import settings\nfrom tornado_learning.urls import urlpattern\n\n\ndef make_app():    \n    app = web.Application(urlpattern, debug=True, **settings)    \n    \n    # å°±å¨è¿éæ·»å æ°æ®åºè¿æ¥\n    objects = Manager(database)    \n    \n    # ç¦æ­¢ä½¿ç¨åæ­¥æä½\n    database.set_allow_sync(False)    \n    app.objects = objects    \n    return app\n\nif __name__ == \'__main__\':   \n    app = make_app()   \n    app.listen(8888)    \n    ioloop.IOLoop.current().start()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n\n# åå»ºmodel\n\nåå»ºéç¨çBaseModelç±»\ncreate_timeæ¯æ¯ä¸ªmodelé½éè¦çå­æ®µï¼å°ä¸¤ä¸ªå­æ®µæåå°BaseModelä¸­ã\nidå­æ®µå¨peeweeä¸­ä¼ä¸ºæ¯ä¸ªmodelèªå¨åå»ºã\nä¸ºæ¯ä¸ä¸ªmodelæå®database\nå¨éç½®ç®å½tornado_learningä¸­åå»ºmodel.py\n\nä»£ç : tornado_learning/models\n\nfrom datetime import datetime\n\nfrom peewee import Model, DateTimeField\n\nfrom tornado_learning.settings import database\n\nclass BaseModel(Model):   \n    create_time = DateTimeField(default=datetime.now, verbose_name="åå»ºæ¶é´")    \n    class Meta:        \n        database = database\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nåå»ºmodelç±»\n\n> è¿éçstudentåteacherçå³ç³»æ¯1å¯¹å¤ã\n\nåå»ºstudentçæ¨¡åç±»ã\nä»£ç : apps/school/models.py\n\nfrom peewee import CharField, IntegerField, TextField\nfrom tornado_learning.models import BaseModel\n\nclass Student(BaseModel):    \n    name = CharField(max_length=100, null=False, verbose_name="å­¦çå")    \n    age = IntegerField(null=False, verbose_name="å¹´é¾")    \n    desc = TextField(verbose_name="ä¸ªäººç®ä»")\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nåå»ºteacherçæ¨¡åç±»\n\nclass Teacher(BaseModel):    \n    student = ForeignKeyField(rel_model=Student, related_name="teachers")    \n    name = CharField(max_length=100, null=False, verbose_name="èå¸å")   \n    age = IntegerField(null=False, verbose_name="å¹´é¾")   \n    subject = CharField(max_length=100, null=False, verbose_name="å­¦ç§")\n\n\n1\n2\n3\n4\n5\n\n\nä½¿ç¨å·¥å·ç±»åå»ºè¡¨\nå¨tools/init_db.pyä¸­åå§åè¡¨ã\nè¿è¡è¯¥æä»¶å³å¯å¨æ°æ®åºä¸­åå»ºè¡¨\n\nfrom tornado_learning.settings import database\nfrom apps.school.models import Student\n\ndef init_db():    \n    database.create_tables([Student, student])\n\nif __name__ == \'__main__\':    \n    init_db()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# å¢å æ¹æ¥\n\nä¸é¢æ¯å¢å æ¹æ¥çä¾å­ã\n\n> formè¡¨åçä½¿ç¨å¯ä»¥åèæçæç« <<tornado ç»åwtformsä½¿ç¨è¡¨åæä½\n\nä»£ç : apps/school/handler.py\n\n\nimport tornado\n\nfrom apps.school.forms import StudentForm\nfrom apps.school.models import Student\nfrom tornado_learning.handler import BaseHandler\n\nclass StudentHandler(BaseHandler):\n\n    async def get(self):\n        id = self.get_argument("id", None)\n        if not id:\n            return self.write("please provide the \'id\'")\n\n        student = await self.application.objects.get(Student, id=id)\n\n        try:\n            self.write({\n                "id": student.id,\n                "name": student.name\n            })\n        except Student.DoesNotExist:\n            raise tornado.webHttpError(404, "Object not found")\n\n    async def post(self):\n\n        student_form = StudentForm(self.request.arguments)\n        if student_form.validate():\n            await self.application.objects.create(Student, **student_form.data)\n\n            self.write("åå»ºæå")\n        else:\n            self.write("æ ¡éªå¤±è´¥")\n\n    async def delete(self):\n        id = self.get_argument("id", None)\n        if not id:\n            return self.write("please provide the \'id\'")\n\n        student = await self.application.objects.get(Student, id=id)\n        await self.application.objects.delete(student)\n\n        self.write("å é¤æå")\n\n    async def put(self):\n        studentForm = StudentForm(self.request.arguments)\n\n        student = Student(**studentForm.data)\n\n        if studentForm.validate():\n            await self.application.objects.update(student)\n            self.write("æ´æ°æå")\n        else:\n            print(studentForm.errors)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n\n\n\n# è¿è¡¨æ¥è¯¢\n\nå¨teacher modelä¸­æ·»å extendæ¹æ³ï¼æ¼åè¿è¡¨æ¥è¯¢çæ¹æ³ï¼æ¹ä¾¿ä½¿ç¨ã\nä»£ç : apps/school/model.py\n\nclass Teacher(BaseModel):\n    student = ForeignKeyField(rel_model=Student, related_name="teachers")\n    name = CharField(max_length=100, null=False, verbose_name="èå¸å")\n    age = IntegerField(null=False, verbose_name="å¹´é¾")\n    subject = CharField(max_length=100, null=False, verbose_name="å­¦ç§")\n\n    @classmethod\n    def extend(cls):\n        return cls.select(cls, Student.name, Student.age).join(Student)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nä½¿ç¨peeweeæ¼ååºæ¥è¯¢ï¼ç¶åéè¿å¼æ­¥æ§è¡å¾å°ç»æ\nä»£ç : apps/school/handler.py\n\nclass TeacherHandler(BaseHandler):\n\n    async def get(self):\n        ret_data = {"data": []}\n\n        teacher_query = Teacher.extend()\n        teacher_query = teacher_query.filter(Teacher.age > 20)\n        teachers = await self.application.objects.execute(teacher_query)\n\n        for teacher in teachers:\n            item_dict = {\n                "teacher_name": teacher.name,\n                "teacher_age": teacher.age,\n                "student_name": teacher.student.name,\n                "student_age": teacher.student.age\n            }\n            ret_data[\'data\'].append(item_dict)\n\n        return self.finish(ret_data)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n',normalizedContent:'# ç®ä»\n\ntornadoæ¯ä¸ä¸ªå¼æ­¥webæ¡æ¶ï¼å¶ä¸­ä¸è½ä½¿ç¨é»å¡çæä½ï¼ä¸ç¶ä¼å¯¼è´æ´ä¸ªç¨åºçé»å¡ãæ°æ®åºæä½æ¶ä¸å¯é¿åçéè¦ä½¿ç¨ï¼è¿ééç¨çæ¯peewee-asyncå»è§£å³ã\n\npeewee-async æ¯ä¸ä¸ªä¸º peewee ormæ¡æ¶æä¾å¼æ­¥æ¥å£çåºã\n\nè¯¥é¡¹ç®çgithubå°å: tornado_learning.git\n\n\n# éç½®\n\nå¨settings.pyæä»¶ä¸­åå»ºè¿æ¥æ°æ®åº\nä»£ç : server.py\n\nimport peewee_async\n\ndatabase = peewee_async.mysqldatabase("tornado_learning", "127.0.0.1", port=3306, user="root", password="root1234")\n\n\n1\n2\n3\n\n\nå¨server.pyä¸­å¼ç¨æ°æ®åºè¿æ¥ï¼å¹¶å å¥å°appä¸­\n\nfrom peewee_async import manager\nfrom tornado import web, ioloop\n\nfrom tornado_learning.settings import database\nfrom tornado_learning.settings import settings\nfrom tornado_learning.urls import urlpattern\n\n\ndef make_app():    \n    app = web.application(urlpattern, debug=true, **settings)    \n    \n    # å°±å¨è¿éæ·»å æ°æ®åºè¿æ¥\n    objects = manager(database)    \n    \n    # ç¦æ­¢ä½¿ç¨åæ­¥æä½\n    database.set_allow_sync(false)    \n    app.objects = objects    \n    return app\n\nif __name__ == \'__main__\':   \n    app = make_app()   \n    app.listen(8888)    \n    ioloop.ioloop.current().start()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n\n# åå»ºmodel\n\nåå»ºéç¨çbasemodelç±»\ncreate_timeæ¯æ¯ä¸ªmodelé½éè¦çå­æ®µï¼å°ä¸¤ä¸ªå­æ®µæåå°basemodelä¸­ã\nidå­æ®µå¨peeweeä¸­ä¼ä¸ºæ¯ä¸ªmodelèªå¨åå»ºã\nä¸ºæ¯ä¸ä¸ªmodelæå®database\nå¨éç½®ç®å½tornado_learningä¸­åå»ºmodel.py\n\nä»£ç : tornado_learning/models\n\nfrom datetime import datetime\n\nfrom peewee import model, datetimefield\n\nfrom tornado_learning.settings import database\n\nclass basemodel(model):   \n    create_time = datetimefield(default=datetime.now, verbose_name="åå»ºæ¶é´")    \n    class meta:        \n        database = database\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nåå»ºmodelç±»\n\n> è¿éçstudentåteacherçå³ç³»æ¯1å¯¹å¤ã\n\nåå»ºstudentçæ¨¡åç±»ã\nä»£ç : apps/school/models.py\n\nfrom peewee import charfield, integerfield, textfield\nfrom tornado_learning.models import basemodel\n\nclass student(basemodel):    \n    name = charfield(max_length=100, null=false, verbose_name="å­¦çå")    \n    age = integerfield(null=false, verbose_name="å¹´é¾")    \n    desc = textfield(verbose_name="ä¸ªäººç®ä»")\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nåå»ºteacherçæ¨¡åç±»\n\nclass teacher(basemodel):    \n    student = foreignkeyfield(rel_model=student, related_name="teachers")    \n    name = charfield(max_length=100, null=false, verbose_name="èå¸å")   \n    age = integerfield(null=false, verbose_name="å¹´é¾")   \n    subject = charfield(max_length=100, null=false, verbose_name="å­¦ç§")\n\n\n1\n2\n3\n4\n5\n\n\nä½¿ç¨å·¥å·ç±»åå»ºè¡¨\nå¨tools/init_db.pyä¸­åå§åè¡¨ã\nè¿è¡è¯¥æä»¶å³å¯å¨æ°æ®åºä¸­åå»ºè¡¨\n\nfrom tornado_learning.settings import database\nfrom apps.school.models import student\n\ndef init_db():    \n    database.create_tables([student, student])\n\nif __name__ == \'__main__\':    \n    init_db()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# å¢å æ¹æ¥\n\nä¸é¢æ¯å¢å æ¹æ¥çä¾å­ã\n\n> formè¡¨åçä½¿ç¨å¯ä»¥åèæçæç« <<tornado ç»åwtformsä½¿ç¨è¡¨åæä½\n\nä»£ç : apps/school/handler.py\n\n\nimport tornado\n\nfrom apps.school.forms import studentform\nfrom apps.school.models import student\nfrom tornado_learning.handler import basehandler\n\nclass studenthandler(basehandler):\n\n    async def get(self):\n        id = self.get_argument("id", none)\n        if not id:\n            return self.write("please provide the \'id\'")\n\n        student = await self.application.objects.get(student, id=id)\n\n        try:\n            self.write({\n                "id": student.id,\n                "name": student.name\n            })\n        except student.doesnotexist:\n            raise tornado.webhttperror(404, "object not found")\n\n    async def post(self):\n\n        student_form = studentform(self.request.arguments)\n        if student_form.validate():\n            await self.application.objects.create(student, **student_form.data)\n\n            self.write("åå»ºæå")\n        else:\n            self.write("æ ¡éªå¤±è´¥")\n\n    async def delete(self):\n        id = self.get_argument("id", none)\n        if not id:\n            return self.write("please provide the \'id\'")\n\n        student = await self.application.objects.get(student, id=id)\n        await self.application.objects.delete(student)\n\n        self.write("å é¤æå")\n\n    async def put(self):\n        studentform = studentform(self.request.arguments)\n\n        student = student(**studentform.data)\n\n        if studentform.validate():\n            await self.application.objects.update(student)\n            self.write("æ´æ°æå")\n        else:\n            print(studentform.errors)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n\n\n\n# è¿è¡¨æ¥è¯¢\n\nå¨teacher modelä¸­æ·»å extendæ¹æ³ï¼æ¼åè¿è¡¨æ¥è¯¢çæ¹æ³ï¼æ¹ä¾¿ä½¿ç¨ã\nä»£ç : apps/school/model.py\n\nclass teacher(basemodel):\n    student = foreignkeyfield(rel_model=student, related_name="teachers")\n    name = charfield(max_length=100, null=false, verbose_name="èå¸å")\n    age = integerfield(null=false, verbose_name="å¹´é¾")\n    subject = charfield(max_length=100, null=false, verbose_name="å­¦ç§")\n\n    @classmethod\n    def extend(cls):\n        return cls.select(cls, student.name, student.age).join(student)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nä½¿ç¨peeweeæ¼ååºæ¥è¯¢ï¼ç¶åéè¿å¼æ­¥æ§è¡å¾å°ç»æ\nä»£ç : apps/school/handler.py\n\nclass teacherhandler(basehandler):\n\n    async def get(self):\n        ret_data = {"data": []}\n\n        teacher_query = teacher.extend()\n        teacher_query = teacher_query.filter(teacher.age > 20)\n        teachers = await self.application.objects.execute(teacher_query)\n\n        for teacher in teachers:\n            item_dict = {\n                "teacher_name": teacher.name,\n                "teacher_age": teacher.age,\n                "student_name": teacher.student.name,\n                "student_age": teacher.student.age\n            }\n            ret_data[\'data\'].append(item_dict)\n\n        return self.finish(ret_data)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"pyspark streamingç®ä» å æ¶è´¹ kafkaç¤ºä¾",frontmatter:{tags:["python"],title:"pyspark streamingç®ä» å æ¶è´¹ kafkaç¤ºä¾",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/72664a/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ç®åä»ç»pyspark streamingä»¥åæ¶è´¹kafkaçç¤ºä¾",feed:{enable:!0},categories:["ç¼ç¨","python","å¶ä»"],comment:!0,meta:[{name:"image",content:"https://img-blog.csdnimg.cn/20190416164155495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyOTE4MjQz,size_16,color_FFFFFF,t_70"},{name:"twitter:title",content:"pyspark streamingç®ä» å æ¶è´¹ kafkaç¤ºä¾"},{name:"twitter:description",content:"ç®åä»ç»pyspark streamingä»¥åæ¶è´¹kafkaçç¤ºä¾"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://img-blog.csdnimg.cn/20190416164155495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyOTE4MjQz,size_16,color_FFFFFF,t_70"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/09.%E5%85%B6%E4%BB%96/02.pyspark%20streaming%E7%AE%80%E4%BB%8B%20%E5%92%8C%20%E6%B6%88%E8%B4%B9%20kafka%E7%A4%BA%E4%BE%8B.html"},{property:"og:type",content:"article"},{property:"og:title",content:"pyspark streamingç®ä» å æ¶è´¹ kafkaç¤ºä¾"},{property:"og:description",content:"ç®åä»ç»pyspark streamingä»¥åæ¶è´¹kafkaçç¤ºä¾"},{property:"og:image",content:"https://img-blog.csdnimg.cn/20190416164155495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyOTE4MjQz,size_16,color_FFFFFF,t_70"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/09.%E5%85%B6%E4%BB%96/02.pyspark%20streaming%E7%AE%80%E4%BB%8B%20%E5%92%8C%20%E6%B6%88%E8%B4%B9%20kafka%E7%A4%BA%E4%BE%8B.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{itemprop:"name",content:"pyspark streamingç®ä» å æ¶è´¹ kafkaç¤ºä¾"},{itemprop:"description",content:"ç®åä»ç»pyspark streamingä»¥åæ¶è´¹kafkaçç¤ºä¾"},{itemprop:"image",content:"https://img-blog.csdnimg.cn/20190416164155495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyOTE4MjQz,size_16,color_FFFFFF,t_70"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/09.%E5%85%B6%E4%BB%96/02.pyspark%20streaming%E7%AE%80%E4%BB%8B%20%E5%92%8C%20%E6%B6%88%E8%B4%B9%20kafka%E7%A4%BA%E4%BE%8B.html",relativePath:"04.ç¼ç¨/01.python/09.å¶ä»/02.pyspark streamingç®ä» å æ¶è´¹ kafkaç¤ºä¾.md",key:"v-a1f03dba",path:"/pages/72664a/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"åºç¡æ°æ®æº",slug:"åºç¡æ°æ®æº",normalizedTitle:"åºç¡æ°æ®æº",charIndex:314},{level:2,title:"é«çº§æ°æ®æº",slug:"é«çº§æ°æ®æº",normalizedTitle:"é«çº§æ°æ®æº",charIndex:1431},{level:3,title:"Spark Streaming å kafka æ´å",slug:"spark-streaming-å-kafka-æ´å",normalizedTitle:"spark streaming å kafka æ´å",charIndex:1441}],headersStr:"ç®ä» åºç¡æ°æ®æº é«çº§æ°æ®æº Spark Streaming å kafka æ´å",content:'# ç®ä»\n\n> å¹¶ä¸æ¯çæ­£çå®æ¶å¤çæ¡æ¶ï¼åªæ¯æç§æ¶é´è¿è¡å¾®æ¹å¤çè¿è¡ï¼æ¶é´å¯ä»¥è®¾ç½®çå°½å¯è½çå°ã\n\n> å°ä¸åçé¢æ°æ®æºçæ°æ®ç»è¿SparkStreaming å¤çä¹åå°ç»æè¾åºå°å¤é¨æä»¶ç³»ç»\n\n * ç¹ç¹\n\n> ä½å»¶æ¶ è½ä»éè¯¯ä¸­æç¬çæ¢å¤: fault-tolerant è½å¤è¿è¡å¨æç¾ä¸åçèç¹ è½å¤å°æ¹å¤çãæºå¨å­¦ä¹ ãå¾è®¡ç®ç­èªæ¡æ¶åSpark Streaming ç»¼åèµ·æ¥ä½¿ç¨\n\n * ç²ç²åº¦\n\n> Spark Streamingæ¥æ¶å°å®æ¶æ°æ®æµï¼ææ°æ®æç§æå®çæ¶é´æ®µåæä¸ççå°çæ°æ®åï¼ç¶åæå°çæ°æ®åä¼ ç»Spark Engineå¤çã\n\n * ç»ç²åº¦\n\n * æ°æ®æº kafkaæä¾äºä¸¤ç§æ°æ®æºã\n\n 1. åºç¡æ°æ®æºï¼å¯ä»¥ç´æ¥éè¿streamingContext APIå®ç°ãå¦æä»¶ç³»ç»åsocketè¿æ¥\n 2. é«çº§çæ°æ®æºï¼å¦Kafka, Flume, Kinesisç­ç­. å¯ä»¥éè¿é¢å¤çç±»åºå»å®ç°ã\n\n\n# åºç¡æ°æ®æº\n\n 1. ä½¿ç¨å®æ¹çæ¡ä¾\n\n/spark/examples/src/main/python/streaming\n\nnc -lk 6789\n\n 2. å¤çsocketæ°æ®\n\nç¤ºä¾ä»£ç å¦ä¸: è¯»åsocketä¸­çæ°æ®è¿è¡æµå¤ç\n\nfrom pyspark import SparkContext\nfrom pyspark.streaming import StreamingContext\n\n# local å¿é¡»è®¾ä¸º2\nsc = SparkContext("local[2]", "NetworkWordCount")\nssc = StreamingContext(sc, 1)\n\nlines = ssc.socketTextStream("localhost", 9999)\n\nwords = lines.flatMap(lambda line: line.split(" "))\n\npairs = words.map(lambda word: (word, 1))\nwordCounts = pairs.reduceByKey(lambda x, y: x + y)\n\nwordCounts.pprint()\n\nssc.start()\nssc.awaitTermination()\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\næµè¯\n\n> nc -lk 9999\n\n 3. å¤çæä»¶ç³»ç»æ°æ®\n\n> æä»¶ç³»ç»(fileStream(that is, HDFSM S3, NFS))æä¸æ¯æpythonï¼pythonä»æ¯æææ¬æä»¶(textFileStream)\n\nç¤ºä¾å¦ä¸ï¼ä½æªæåï¼æ¾ä¸å°è¯¥æä»¶ã\n\n\nlines = ssc.textFileStream("hdfs://txz-data0:9820/user/jim/workflow/crash/python/crash_2_hdfs.py")\n\n\n\n1\n2\n3\n\n\n * streaming context\n\n * DStreams\n\n> æç»­åçæ°æ®æµ å¯¹DStreamæä½ç®å­ï¼ æ¯å¦map/flatMap,å¶å®åºå±ä¼è¢«ç¿»è¯ä¸ºå¯¹DStreamä¸­çæ¯ä¸ªRDDé½åç¸åçæä½ï¼å ä¸ºä¸ä¸ªDStreamæ¯ç±ä¸åæ¹æ¬¡çRDDæ\n\n * Input DStreams and Receivers\n\n\n# é«çº§æ°æ®æº\n\n\n# Spark Streaming å kafka æ´å\n\nä¸¤ç§æ¨¡å¼\n\n * receiver æ¨¡å¼\n\nfrom pyspark.streaming.kafka import KafkaUtils\nfrom pyspark import SparkContext\nfrom pyspark.streaming import StreamingContext\n\nsc = SparkContext("local[2]", "NetworkWordCount")\nsc.setLogLevel("OFF")\nssc = StreamingContext(sc, 1)\n\n# åå»ºKafka streaming\nline = KafkaUtils.createStream(ssc, "192.168.0.208:2181", \'test\', {"jim_test": 1})\n\n# åè¯\nwords = line.flatMap(lambda line: line.split(" "))\npairs = words.map(lambda word: (word, 1))\nwordCounts = pairs.reduceByKey(lambda x, y: x + y)\nwordCounts.pprint()\n\nssc.start()\nssc.awaitTermination()\n\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n * no receiver\n\næ ¹æ®ä¸é¢çä»£ç æ¿æ¢æcreateStreamå³å¯ã\n\nline = KafkaUtils.createDirectStream(ssc, ["jim_test"], {"metadata.broker.list": "192.168.0.208:9092"})\n\n\n1\n\n\nè¿è¡:\n\n> spark-submit --jars spark-streaming-kafka-0-8-assembly_2.11-2.4.0.jar test_spark_stream.py\n\néè¦ä¸è½½ç¸åºçjarå.ä¸è½½å°åå¦ä¸ï¼æç´¢ã https://search.maven.org\n\njarçæ¬ä¼å¨è¿è¡ç¨åºæ¶æ¥éæéã',normalizedContent:'# ç®ä»\n\n> å¹¶ä¸æ¯çæ­£çå®æ¶å¤çæ¡æ¶ï¼åªæ¯æç§æ¶é´è¿è¡å¾®æ¹å¤çè¿è¡ï¼æ¶é´å¯ä»¥è®¾ç½®çå°½å¯è½çå°ã\n\n> å°ä¸åçé¢æ°æ®æºçæ°æ®ç»è¿sparkstreaming å¤çä¹åå°ç»æè¾åºå°å¤é¨æä»¶ç³»ç»\n\n * ç¹ç¹\n\n> ä½å»¶æ¶ è½ä»éè¯¯ä¸­æç¬çæ¢å¤: fault-tolerant è½å¤è¿è¡å¨æç¾ä¸åçèç¹ è½å¤å°æ¹å¤çãæºå¨å­¦ä¹ ãå¾è®¡ç®ç­èªæ¡æ¶åspark streaming ç»¼åèµ·æ¥ä½¿ç¨\n\n * ç²ç²åº¦\n\n> spark streamingæ¥æ¶å°å®æ¶æ°æ®æµï¼ææ°æ®æç§æå®çæ¶é´æ®µåæä¸ççå°çæ°æ®åï¼ç¶åæå°çæ°æ®åä¼ ç»spark engineå¤çã\n\n * ç»ç²åº¦\n\n * æ°æ®æº kafkaæä¾äºä¸¤ç§æ°æ®æºã\n\n 1. åºç¡æ°æ®æºï¼å¯ä»¥ç´æ¥éè¿streamingcontext apiå®ç°ãå¦æä»¶ç³»ç»åsocketè¿æ¥\n 2. é«çº§çæ°æ®æºï¼å¦kafka, flume, kinesisç­ç­. å¯ä»¥éè¿é¢å¤çç±»åºå»å®ç°ã\n\n\n# åºç¡æ°æ®æº\n\n 1. ä½¿ç¨å®æ¹çæ¡ä¾\n\n/spark/examples/src/main/python/streaming\n\nnc -lk 6789\n\n 2. å¤çsocketæ°æ®\n\nç¤ºä¾ä»£ç å¦ä¸: è¯»åsocketä¸­çæ°æ®è¿è¡æµå¤ç\n\nfrom pyspark import sparkcontext\nfrom pyspark.streaming import streamingcontext\n\n# local å¿é¡»è®¾ä¸º2\nsc = sparkcontext("local[2]", "networkwordcount")\nssc = streamingcontext(sc, 1)\n\nlines = ssc.sockettextstream("localhost", 9999)\n\nwords = lines.flatmap(lambda line: line.split(" "))\n\npairs = words.map(lambda word: (word, 1))\nwordcounts = pairs.reducebykey(lambda x, y: x + y)\n\nwordcounts.pprint()\n\nssc.start()\nssc.awaittermination()\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\næµè¯\n\n> nc -lk 9999\n\n 3. å¤çæä»¶ç³»ç»æ°æ®\n\n> æä»¶ç³»ç»(filestream(that is, hdfsm s3, nfs))æä¸æ¯æpythonï¼pythonä»æ¯æææ¬æä»¶(textfilestream)\n\nç¤ºä¾å¦ä¸ï¼ä½æªæåï¼æ¾ä¸å°è¯¥æä»¶ã\n\n\nlines = ssc.textfilestream("hdfs://txz-data0:9820/user/jim/workflow/crash/python/crash_2_hdfs.py")\n\n\n\n1\n2\n3\n\n\n * streaming context\n\n * dstreams\n\n> æç»­åçæ°æ®æµ å¯¹dstreamæä½ç®å­ï¼ æ¯å¦map/flatmap,å¶å®åºå±ä¼è¢«ç¿»è¯ä¸ºå¯¹dstreamä¸­çæ¯ä¸ªrddé½åç¸åçæä½ï¼å ä¸ºä¸ä¸ªdstreamæ¯ç±ä¸åæ¹æ¬¡çrddæ\n\n * input dstreams and receivers\n\n\n# é«çº§æ°æ®æº\n\n\n# spark streaming å kafka æ´å\n\nä¸¤ç§æ¨¡å¼\n\n * receiver æ¨¡å¼\n\nfrom pyspark.streaming.kafka import kafkautils\nfrom pyspark import sparkcontext\nfrom pyspark.streaming import streamingcontext\n\nsc = sparkcontext("local[2]", "networkwordcount")\nsc.setloglevel("off")\nssc = streamingcontext(sc, 1)\n\n# åå»ºkafka streaming\nline = kafkautils.createstream(ssc, "192.168.0.208:2181", \'test\', {"jim_test": 1})\n\n# åè¯\nwords = line.flatmap(lambda line: line.split(" "))\npairs = words.map(lambda word: (word, 1))\nwordcounts = pairs.reducebykey(lambda x, y: x + y)\nwordcounts.pprint()\n\nssc.start()\nssc.awaittermination()\n\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n * no receiver\n\næ ¹æ®ä¸é¢çä»£ç æ¿æ¢æcreatestreamå³å¯ã\n\nline = kafkautils.createdirectstream(ssc, ["jim_test"], {"metadata.broker.list": "192.168.0.208:9092"})\n\n\n1\n\n\nè¿è¡:\n\n> spark-submit --jars spark-streaming-kafka-0-8-assembly_2.11-2.4.0.jar test_spark_stream.py\n\néè¦ä¸è½½ç¸åºçjarå.ä¸è½½å°åå¦ä¸ï¼æç´¢ã https://search.maven.org\n\njarçæ¬ä¼å¨è¿è¡ç¨åºæ¶æ¥éæéã',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"goç®åä½¿ç¨grpc",frontmatter:{tags:["golang"],title:"goç®åä½¿ç¨grpc",date:"2022-09-07T20:10:13.000Z",permalink:"/pages/87014e/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä»ç»goæ¯å¦ä½ä½¿ç¨grpcç",feed:{enable:!0},categories:["ç¼ç¨","go"],comment:!0,meta:[{name:"twitter:title",content:"goç®åä½¿ç¨grpc"},{name:"twitter:description",content:"ä»ç»goæ¯å¦ä½ä½¿ç¨grpcç"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/02.go/01.go%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8grpc.html"},{property:"og:type",content:"article"},{property:"og:title",content:"goç®åä½¿ç¨grpc"},{property:"og:description",content:"ä»ç»goæ¯å¦ä½ä½¿ç¨grpcç"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/02.go/01.go%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8grpc.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-09-07T20:10:13.000Z"},{property:"article:tag",content:"golang"},{itemprop:"name",content:"goç®åä½¿ç¨grpc"},{itemprop:"description",content:"ä»ç»goæ¯å¦ä½ä½¿ç¨grpcç"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/02.go/01.go%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8grpc.html",relativePath:"04.ç¼ç¨/02.go/01.goç®åä½¿ç¨grpc.md",key:"v-ec68963a",path:"/pages/87014e/",headers:[{level:2,title:"0.ç¸å³é¾æ¥",slug:"_0-ç¸å³é¾æ¥",normalizedTitle:"0.ç¸å³é¾æ¥",charIndex:2},{level:2,title:"1. å®ä¹protoæä»¶",slug:"_1-å®ä¹protoæä»¶",normalizedTitle:"1. å®ä¹protoæä»¶",charIndex:142},{level:2,title:"2. ç¼è¯protoæä»¶",slug:"_2-ç¼è¯protoæä»¶",normalizedTitle:"2. ç¼è¯protoæä»¶",charIndex:799},{level:2,title:"3. åå»ºgrpcæå¡ç«¯",slug:"_3-åå»ºgrpcæå¡ç«¯",normalizedTitle:"3. åå»ºgrpcæå¡ç«¯",charIndex:1377},{level:2,title:"4. åå»ºgrpcå®¢æ·ç«¯",slug:"_4-åå»ºgrpcå®¢æ·ç«¯",normalizedTitle:"4. åå»ºgrpcå®¢æ·ç«¯",charIndex:2873},{level:2,title:"5. è¿è¡ç»æ",slug:"_5-è¿è¡ç»æ",normalizedTitle:"5. è¿è¡ç»æ",charIndex:4042}],headersStr:"0.ç¸å³é¾æ¥ 1. å®ä¹protoæä»¶ 2. ç¼è¯protoæä»¶ 3. åå»ºgrpcæå¡ç«¯ 4. åå»ºgrpcå®¢æ·ç«¯ 5. è¿è¡ç»æ",content:'# 0.ç¸å³é¾æ¥\n\ngrpc githubï¼https://github.com/grpc/grpc-go\n\nå®æ¹ææ¡£ï¼https://grpc.io/docs/languages/go/\n\næ¡ä¾ä»£ç ï¼https://github.com/msqfx/go-examples\n\n\n# 1. å®ä¹protoæä»¶\n\nprotoæä»¶æ¯ç¨æ¥é¢åå®ä¹çæ¶æ¯æ ¼å¼ãæ°æ®åä¼æç§protoæä»¶æå®ä¹çæ¶æ¯æ ¼å¼å®æäºè¿å¶ç æµçç¼ç åè§£ç ã\n\nsyntax = "proto3";\n\n// æå®çæç go æä»¶å­æ¾ä½ç½®åå¶åå\noption go_package = "./;proto";\n\n// å®ä¹User rpcæå¡\nservice User {\n  // å®ä¹rpcæå¡çæ¹æ³\n  rpc AddUser (UserRequest) returns (UserResponse);\n  rpc GetUser (GetUserRequest) returns (GetUserResponse);\n}\n\n// è¯·æ±çç»æä½\nmessage UserRequest {\n  string name = 1;\n  uint32 age = 2;\n}\n\n// ååºçç»æä½\nmessage UserResponse {\n  string msg = 1;\n  int32 code = 2;\n}\n\nmessage GetUserRequest {\n  string name = 1;\n}\n\nmessage GetUserResponse {\n  string name = 1;\n  string age = 2;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# 2. ç¼è¯protoæä»¶\n\né¦åéè¦å®è£protocçäºè¿å¶æä»¶ï¼æ¯ç¨æ¥ç¼è¯protoçã\n\nä¸è½½å°åï¼https://github.com/protocolbuffers/protobuf/releases\n\nç¶ååä¸è½½å®è£ç¼è¯protoæä»¶çæä»¶\n\n$ go install google.golang.org/protobuf/cmd/protoc-gen-go@v1.28\n$ go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@v1.2\n\n\n1\n2\n\n\nè¿å¥protoç®å½ä¸ä½¿ç¨ä»¥ä¸å½ä»¤å¯¹protoæä»¶è¿è¡ç¼è¯ï¼ä¼çæä¸¤ä¸ªæä»¶user.pb.goåuser_grpc.pb.goä¸¤ä¸ªæä»¶\n\nprotoc --go_out=. --go-grpc_out=. user.proto\n\n\n1\n\n * --go_out=. protobufç¸å³ä»£ç æä»¶çæå¨è¯¥ç®å½ä¸\n * --go-grpc_out=. grpcç¸å³ä»£ç æä»¶çæå¨è¯¥ç®å½ä¸\n\nç¼è¯å:\n\n * user.pb.goï¼ä¸»è¦æ¯è¯·æ±ä¸ç¸åºæ°æ®åçç»æä½å®ä¹ï¼å®¢æ·ç«¯åæå¡ç«¯é½å¯ä»¥éè¿è¯¥ç»æä½è¿è¡åºååä¸ååºååã\n * user_grpc.pb.goï¼ä¸»è¦æ¯grpcçæå¡ç«¯åå®¢æ·ç«¯ä»£ç ï¼éè¿å®ç°åè°ç¨æ¥å£æ¥äºç¸æ²éã\n\n\n# 3. åå»ºgrpcæå¡ç«¯\n\næä»¬é¦åè¦å®ç°user_grpc.pb.goä¸­çUserServeræ¥å£ï¼è¯¥æ¥å£ä¸­çæ¹æ³æ¯æä»¬å¨protoæä»¶ä¸­å®ä¹çrpcæå¡AddUseråGetUserã\n\nä¸è¿ï¼ä½ ä¼åç°å¶ä¸­è¿å¤äºä¸ªmustEmbedUnimplementedUserServeræ¹æ³ï¼ä½æ¯æä»¬protoæä»¶ä¸­å¹¶æ²¡æå®ä¹ï¼è¿ä¸ªæ¯ç¨æ¥å¼å®¹ä½¿ç¨çãä½ çå¯ä»¥æä»¶ä¸­UnimplementedUserServerç»æä½å®ç°äºUserServeræ¥å£ï¼èªå·±å®ä¹UserServiceåå«UnimplementedUserServerï¼å³ä½¿æ²¡æå®ç°UserServeræææ¥å£ï¼ä¹ä¸ä¼æ¥éã\n\npackage main\n\nimport (\n\t"context"\n\t"fmt"\n\t"google.golang.org/grpc"\n\t"log"\n\t"net"\n\t"simple_example/proto"\n)\n\n// UserService å®ä¹ç»æä½ï¼å®ç°UserServer\ntype UserService struct {\n\tproto.UnimplementedUserServer\n}\n\nfunc NewUserService() *UserService {\n\treturn &UserService{}\n}\n\n// AddUser å®ç°rpcæ¹æ³\nfunc (us *UserService) AddUser(ctx context.Context, request *proto.UserRequest) (*proto.UserResponse, error) {\n\tfmt.Printf("add user success. name = %s, age = %d\\n", request.GetName(), request.GetAge())\n\treturn &proto.UserResponse{Msg: "success", Code: 0}, nil\n}\n\nfunc (us *UserService) GetUser(ctx context.Context, request *proto.GetUserRequest) (*proto.GetUserResponse, error) {\n\tfmt.Printf("get user. name = %s\\n", request.GetName())\n\treturn &proto.GetUserResponse{Name: request.GetName(), Age: 1999}, nil\n}\n\nfunc main() {\n\t// çå¬ç«¯å£\n\tlis, err := net.Listen("tcp", fmt.Sprintf("localhost:%d", 8000))\n\tif err != nil {\n\t\tlog.Fatalf("failed to listen: %v", err)\n\t}\n\tgrpcServer := grpc.NewServer()\n\n\t// æ³¨årpcæå¡\n\tproto.RegisterUserServer(grpcServer, NewUserService())\n\tgrpcServer.Serve(lis)\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n\n\n\n# 4. åå»ºgrpcå®¢æ·ç«¯\n\nè°ç¨user_grpc.pb.goæä»¶ä¸­çNewUserClientæ¹æ³æ¥åå»ºè°ç¨rpcæå¡çå®¢æ·ç«¯ï¼è°ç¨rpcæ¹æ³æ¶ä½¿ç¨user.pb.goä¸­çç»æä½ä½ä¸ºè¾å¥ä¸è¾åºã\n\npackage main\n\nimport (\n\t"context"\n\t"fmt"\n\t"google.golang.org/grpc"\n\t"google.golang.org/grpc/credentials/insecure"\n\t"log"\n\t"simple_example/proto"\n)\n\nfunc main() {\n\tvar opts []grpc.DialOption\n\topts = append(opts, grpc.WithTransportCredentials(insecure.NewCredentials()))\n\n\tconn, err := grpc.Dial("localhost:8000", opts...)\n\tif err != nil {\n\t\tlog.Fatalf("fail to dial: %v", err)\n\t}\n\tdefer conn.Close()\n\n\tclient := proto.NewUserClient(conn)\n\n\t// è°ç¨rpcæå¡AddUseræ¹æ³\n\tresp, err := client.AddUser(context.Background(), &proto.UserRequest{Name: "zhengwenfeng", Age: 18})\n\tif err != nil {\n\t\tlog.Fatalf("fail to AddUser: %v", err)\n\t}\n\tfmt.Printf("AddUser, msg = %s, code = %d\\n", resp.Msg, resp.Code)\n\n\t// è°ç¨rpcæå¡GetUseræ¹æ³\n\tgetuserResp, err := client.GetUser(context.Background(), &proto.GetUserRequest{Name: "zhangsan"})\n\tif err != nil {\n\t\tlog.Fatalf("fail to GetUser: %v", err)\n\t}\n\tfmt.Printf("GetUser, Name = %s, Age = %d", getuserResp.Name, getuserResp.Age)\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\n\n# 5. è¿è¡ç»æ\n\né¦åè¿è¡æå¡ç«¯çå¬rpcæå¡ ç¶ååè¿è¡å®¢æ·ç«¯è°ç¨æå¡ã æå¡ç«¯è¾åºï¼\n\nadd user success. name = zhengwenfeng, age = 18\nget user success. name = zhangsan\n\n\n1\n2\n\n\nå®¢æ·ç«¯è¾åºï¼\n\nAddUser, msg = success, code = 0\nGetUser, Name = zhangsan, Age = 1999\n\n\n1\n2\n',normalizedContent:'# 0.ç¸å³é¾æ¥\n\ngrpc githubï¼https://github.com/grpc/grpc-go\n\nå®æ¹ææ¡£ï¼https://grpc.io/docs/languages/go/\n\næ¡ä¾ä»£ç ï¼https://github.com/msqfx/go-examples\n\n\n# 1. å®ä¹protoæä»¶\n\nprotoæä»¶æ¯ç¨æ¥é¢åå®ä¹çæ¶æ¯æ ¼å¼ãæ°æ®åä¼æç§protoæä»¶æå®ä¹çæ¶æ¯æ ¼å¼å®æäºè¿å¶ç æµçç¼ç åè§£ç ã\n\nsyntax = "proto3";\n\n// æå®çæç go æä»¶å­æ¾ä½ç½®åå¶åå\noption go_package = "./;proto";\n\n// å®ä¹user rpcæå¡\nservice user {\n  // å®ä¹rpcæå¡çæ¹æ³\n  rpc adduser (userrequest) returns (userresponse);\n  rpc getuser (getuserrequest) returns (getuserresponse);\n}\n\n// è¯·æ±çç»æä½\nmessage userrequest {\n  string name = 1;\n  uint32 age = 2;\n}\n\n// ååºçç»æä½\nmessage userresponse {\n  string msg = 1;\n  int32 code = 2;\n}\n\nmessage getuserrequest {\n  string name = 1;\n}\n\nmessage getuserresponse {\n  string name = 1;\n  string age = 2;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# 2. ç¼è¯protoæä»¶\n\né¦åéè¦å®è£protocçäºè¿å¶æä»¶ï¼æ¯ç¨æ¥ç¼è¯protoçã\n\nä¸è½½å°åï¼https://github.com/protocolbuffers/protobuf/releases\n\nç¶ååä¸è½½å®è£ç¼è¯protoæä»¶çæä»¶\n\n$ go install google.golang.org/protobuf/cmd/protoc-gen-go@v1.28\n$ go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@v1.2\n\n\n1\n2\n\n\nè¿å¥protoç®å½ä¸ä½¿ç¨ä»¥ä¸å½ä»¤å¯¹protoæä»¶è¿è¡ç¼è¯ï¼ä¼çæä¸¤ä¸ªæä»¶user.pb.goåuser_grpc.pb.goä¸¤ä¸ªæä»¶\n\nprotoc --go_out=. --go-grpc_out=. user.proto\n\n\n1\n\n * --go_out=. protobufç¸å³ä»£ç æä»¶çæå¨è¯¥ç®å½ä¸\n * --go-grpc_out=. grpcç¸å³ä»£ç æä»¶çæå¨è¯¥ç®å½ä¸\n\nç¼è¯å:\n\n * user.pb.goï¼ä¸»è¦æ¯è¯·æ±ä¸ç¸åºæ°æ®åçç»æä½å®ä¹ï¼å®¢æ·ç«¯åæå¡ç«¯é½å¯ä»¥éè¿è¯¥ç»æä½è¿è¡åºååä¸ååºååã\n * user_grpc.pb.goï¼ä¸»è¦æ¯grpcçæå¡ç«¯åå®¢æ·ç«¯ä»£ç ï¼éè¿å®ç°åè°ç¨æ¥å£æ¥äºç¸æ²éã\n\n\n# 3. åå»ºgrpcæå¡ç«¯\n\næä»¬é¦åè¦å®ç°user_grpc.pb.goä¸­çuserserveræ¥å£ï¼è¯¥æ¥å£ä¸­çæ¹æ³æ¯æä»¬å¨protoæä»¶ä¸­å®ä¹çrpcæå¡adduserågetuserã\n\nä¸è¿ï¼ä½ ä¼åç°å¶ä¸­è¿å¤äºä¸ªmustembedunimplementeduserserveræ¹æ³ï¼ä½æ¯æä»¬protoæä»¶ä¸­å¹¶æ²¡æå®ä¹ï¼è¿ä¸ªæ¯ç¨æ¥å¼å®¹ä½¿ç¨çãä½ çå¯ä»¥æä»¶ä¸­unimplementeduserserverç»æä½å®ç°äºuserserveræ¥å£ï¼èªå·±å®ä¹userserviceåå«unimplementeduserserverï¼å³ä½¿æ²¡æå®ç°userserveræææ¥å£ï¼ä¹ä¸ä¼æ¥éã\n\npackage main\n\nimport (\n\t"context"\n\t"fmt"\n\t"google.golang.org/grpc"\n\t"log"\n\t"net"\n\t"simple_example/proto"\n)\n\n// userservice å®ä¹ç»æä½ï¼å®ç°userserver\ntype userservice struct {\n\tproto.unimplementeduserserver\n}\n\nfunc newuserservice() *userservice {\n\treturn &userservice{}\n}\n\n// adduser å®ç°rpcæ¹æ³\nfunc (us *userservice) adduser(ctx context.context, request *proto.userrequest) (*proto.userresponse, error) {\n\tfmt.printf("add user success. name = %s, age = %d\\n", request.getname(), request.getage())\n\treturn &proto.userresponse{msg: "success", code: 0}, nil\n}\n\nfunc (us *userservice) getuser(ctx context.context, request *proto.getuserrequest) (*proto.getuserresponse, error) {\n\tfmt.printf("get user. name = %s\\n", request.getname())\n\treturn &proto.getuserresponse{name: request.getname(), age: 1999}, nil\n}\n\nfunc main() {\n\t// çå¬ç«¯å£\n\tlis, err := net.listen("tcp", fmt.sprintf("localhost:%d", 8000))\n\tif err != nil {\n\t\tlog.fatalf("failed to listen: %v", err)\n\t}\n\tgrpcserver := grpc.newserver()\n\n\t// æ³¨årpcæå¡\n\tproto.registeruserserver(grpcserver, newuserservice())\n\tgrpcserver.serve(lis)\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n\n\n\n# 4. åå»ºgrpcå®¢æ·ç«¯\n\nè°ç¨user_grpc.pb.goæä»¶ä¸­çnewuserclientæ¹æ³æ¥åå»ºè°ç¨rpcæå¡çå®¢æ·ç«¯ï¼è°ç¨rpcæ¹æ³æ¶ä½¿ç¨user.pb.goä¸­çç»æä½ä½ä¸ºè¾å¥ä¸è¾åºã\n\npackage main\n\nimport (\n\t"context"\n\t"fmt"\n\t"google.golang.org/grpc"\n\t"google.golang.org/grpc/credentials/insecure"\n\t"log"\n\t"simple_example/proto"\n)\n\nfunc main() {\n\tvar opts []grpc.dialoption\n\topts = append(opts, grpc.withtransportcredentials(insecure.newcredentials()))\n\n\tconn, err := grpc.dial("localhost:8000", opts...)\n\tif err != nil {\n\t\tlog.fatalf("fail to dial: %v", err)\n\t}\n\tdefer conn.close()\n\n\tclient := proto.newuserclient(conn)\n\n\t// è°ç¨rpcæå¡adduseræ¹æ³\n\tresp, err := client.adduser(context.background(), &proto.userrequest{name: "zhengwenfeng", age: 18})\n\tif err != nil {\n\t\tlog.fatalf("fail to adduser: %v", err)\n\t}\n\tfmt.printf("adduser, msg = %s, code = %d\\n", resp.msg, resp.code)\n\n\t// è°ç¨rpcæå¡getuseræ¹æ³\n\tgetuserresp, err := client.getuser(context.background(), &proto.getuserrequest{name: "zhangsan"})\n\tif err != nil {\n\t\tlog.fatalf("fail to getuser: %v", err)\n\t}\n\tfmt.printf("getuser, name = %s, age = %d", getuserresp.name, getuserresp.age)\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\n\n# 5. è¿è¡ç»æ\n\né¦åè¿è¡æå¡ç«¯çå¬rpcæå¡ ç¶ååè¿è¡å®¢æ·ç«¯è°ç¨æå¡ã æå¡ç«¯è¾åºï¼\n\nadd user success. name = zhengwenfeng, age = 18\nget user success. name = zhangsan\n\n\n1\n2\n\n\nå®¢æ·ç«¯è¾åºï¼\n\nadduser, msg = success, code = 0\ngetuser, name = zhangsan, age = 1999\n\n\n1\n2\n',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"ginä¸­validatoræ¨¡åçæºç åæ",frontmatter:{tags:["golang","gin"],title:"ginä¸­validatoræ¨¡åçæºç åæ",date:"2022-09-11T16:23:04.000Z",permalink:"/pages/c41003/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"å¨ginä¸­ä½¿ç¨çæ¯validatoræ¨¡åæ¥å¯¹è¡¨åè¿è¡æ ¡éªçï¼æ¬æä¸»è¦æ¯å¯¹è¯¥æ¨¡åçæºç åæä¸å­¦ä¹ ",feed:{enable:!0},categories:["ç¼ç¨","go"],comment:!0,meta:[{name:"twitter:title",content:"ginä¸­validatoræ¨¡åçæºç åæ"},{name:"twitter:description",content:"å¨ginä¸­ä½¿ç¨çæ¯validatoræ¨¡åæ¥å¯¹è¡¨åè¿è¡æ ¡éªçï¼æ¬æä¸»è¦æ¯å¯¹è¯¥æ¨¡åçæºç åæä¸å­¦ä¹ "},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/02.go/02.%20gin%E4%B8%ADvalidator%E6%A8%A1%E5%9D%97%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ginä¸­validatoræ¨¡åçæºç åæ"},{property:"og:description",content:"å¨ginä¸­ä½¿ç¨çæ¯validatoræ¨¡åæ¥å¯¹è¡¨åè¿è¡æ ¡éªçï¼æ¬æä¸»è¦æ¯å¯¹è¯¥æ¨¡åçæºç åæä¸å­¦ä¹ "},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/02.go/02.%20gin%E4%B8%ADvalidator%E6%A8%A1%E5%9D%97%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-09-11T16:23:04.000Z"},{property:"article:tag",content:"golang"},{property:"article:tag",content:"gin"},{itemprop:"name",content:"ginä¸­validatoræ¨¡åçæºç åæ"},{itemprop:"description",content:"å¨ginä¸­ä½¿ç¨çæ¯validatoræ¨¡åæ¥å¯¹è¡¨åè¿è¡æ ¡éªçï¼æ¬æä¸»è¦æ¯å¯¹è¯¥æ¨¡åçæºç åæä¸å­¦ä¹ "}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/02.go/02.%20gin%E4%B8%ADvalidator%E6%A8%A1%E5%9D%97%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html",relativePath:"04.ç¼ç¨/02.go/02. ginä¸­validatoræ¨¡åçæºç åæ.md",key:"v-37dbc27d",path:"/pages/c41003/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"æå è½½validateå¯¹è±¡",slug:"æå è½½validateå¯¹è±¡",normalizedTitle:"æå è½½validateå¯¹è±¡",charIndex:62},{level:2,title:"å¤ç§è¯·æ±åæ°çæ ¡éª",slug:"å¤ç§è¯·æ±åæ°çæ ¡éª",normalizedTitle:"å¤ç§è¯·æ±åæ°çæ ¡éª",charIndex:1555},{level:2,title:"é©å­æ¹æ³",slug:"é©å­æ¹æ³",normalizedTitle:"é©å­æ¹æ³",charIndex:3621},{level:2,title:"å¯¹è±¡æ± çåºç¨",slug:"å¯¹è±¡æ± çåºç¨",normalizedTitle:"å¯¹è±¡æ± çåºç¨",charIndex:4816},{level:2,title:"æ ¹æ®æ ç­¾æ ¡éªè¿ç¨",slug:"æ ¹æ®æ ç­¾æ ¡éªè¿ç¨",normalizedTitle:"æ ¹æ®æ ç­¾æ ¡éªè¿ç¨",charIndex:6027},{level:2,title:"éè¯¯æç¤ºä¿¡æ¯ç¿»è¯",slug:"éè¯¯æç¤ºä¿¡æ¯ç¿»è¯",normalizedTitle:"éè¯¯æç¤ºä¿¡æ¯ç¿»è¯",charIndex:9749}],headersStr:"ç®ä» æå è½½validateå¯¹è±¡ å¤ç§è¯·æ±åæ°çæ ¡éª é©å­æ¹æ³ å¯¹è±¡æ± çåºç¨ æ ¹æ®æ ç­¾æ ¡éªè¿ç¨ éè¯¯æç¤ºä¿¡æ¯ç¿»è¯",content:'# ç®ä»\n\nå¨ginä¸­ä½¿ç¨çæ¯validatoræ¨¡åæ¥å¯¹è¡¨åè¿è¡æ ¡éªçã\n\nvalidatoræ¨¡ågithubå°å\n\n\n# æå è½½validateå¯¹è±¡\n\nä¼æå¨ç¥ï¼å¨apiå±éè¦ä½¿ç¨gin.Contextä¸­çShouldBindJSONæ¹æ³æ¥å¯¹requestä¸­çjsonå­æ®µè¿è¡æ ¡éªï¼ä¾å­å¦ä¸:\n\nfunc login(c *gin.Context) {\n\n\tvar user User\n\tif err := c.ShouldBindJSON(&user); err != nil {\n\n\t\terrs, ok := err.(validator.ValidationErrors)\n\t\tif !ok {\n\t\t\t// éæ ¡éªéè¯¯ï¼å¶ä»éè¯¯ç´æ¥è¿å\n\t\t\tc.JSON(http.StatusOK, gin.H{"msg": err.Error()})\n\t\t\treturn\n\t\t}\n\n\t\tc.JSON(http.StatusOK, gin.H{"msg": errs.Translate(global.Trans)})\n\t\treturn\n\t}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå¨c.ShourdBindJSONä¸­ï¼ä¸ç´å¾ä¸è·³è½¬ï¼è·å°è·¯å¾binding/default_validator.goä¸ï¼å¯ä»¥çå°ä»£ç å¦ä¸ï¼å¯¹è¡¨åçæ ¡éªæ¯è°ç¨v.validate.Struct(obj)æ¥å®æçï¼è¿éçvalidateæ¯validatoråºä¸­Validateå¯¹è±¡ï¼æä»¥å¨ä¹åä½¿ç¨v.lazyinit()æ¥åå»ºè¯¥å¯¹è±¡ã\n\n// validateStruct receives struct type\nfunc (v *defaultValidator) validateStruct(obj any) error {\n\tv.lazyinit()\n\treturn v.validate.Struct(obj)\n}\n\n\n1\n2\n3\n4\n5\n\n\nåçv.lazyinit()æ¹æ³ï¼è¿éä½¿ç¨äºonce.Doæ¹æ³ï¼è¯¥onceæ¯sync.Onecå¯¹è±¡ï¼Doä¸­çæ¹æ³åªä¼æ§è¡ä¸æ¬¡ï¼ä¹å°±æ¯åªä¼åå»ºä¸æ¬¡Validateå¯¹è±¡ï¼ä¿æè¯¥å¯¹è±¡çåä¾ã\n\ntype defaultValidator struct {\n\tonce     sync.Once\n\tvalidate *validator.Validate\n}\n\nfunc (v *defaultValidator) lazyinit() {\n\tv.once.Do(func() {\n\t\tv.validate = validator.New()\n\t\tv.validate.SetTagName("binding")\n\t})\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\né£ä¹æè¿ä¹ä¸ç§åºæ¯ï¼å¦æææ³è¦å¯¹validatorä¸­çvalidateå¯¹è±¡è¿è¡éç½®ï¼è¯¥æä¹åå¢ï¼å ä¸ºä¸é¢é½æ¯å¨ä½¿ç¨æ¶æå è½½æå è½½çï¼æä»¬éè¦æåæ¿å°validateå¯¹è±¡å¹¶è¿è¡éç½®ï¼è¯¥å¦ä½å¤çï¼\n\nå¨ä»£ç binding/default_validator.goä¸­ï¼æä¾äºEngineæ¹æ³ï¼æä»¬å¯ä»¥ä½¿ç¨è¯¥æ¹æ³ç»ä½¿ç¨è¿è°ç¨æåå è½½validateå¯¹è±¡ï¼å¹¶è¿åè¯¥å¯¹è±¡ï¼å°±å¯ä»¥è¿è¡éç½®äºã\n\nfunc (v *defaultValidator) Engine() any {\n\tv.lazyinit()\n\treturn v.validate\n}\n\n\n1\n2\n3\n4\n\n\nç»è®ºï¼\n\n * ç»æä½ä¸­çå¯¹è±¡å¯ä»¥ä½¿ç¨æå è½½çæ¹å¼ï¼å¨ä½¿ç¨çæ¶ååè¿è¡åå»ºã\n\n * å¯ä»¥ä½¿ç¨once.Doçæ¹æ³åå»ºå¯¹è±¡ä¿æåä¾ã\n\n * å¯ä»¥æä¾æ¹æ³æåå è½½å¯¹è±¡ï¼ç¶åè¿ååºæ¥è¿è¡ä½¿ç¨éç½®\n\n\n# å¤ç§è¯·æ±åæ°çæ ¡éª\n\næä»¬ä½¿ç¨c.ShouldBindJSON(&user)å¯ä»¥å¯¹jsonæ ¼å¼çè¯·æ±åæ°è¿è¡æ ¡éªï¼ä¹å¯ä»¥ä½¿ç¨c.ShouldBindXMLå¯¹xmlæ ¼å¼çè¯·æ±åæ°è¿è¡æ ¡éªã\n\nå¨ä»£ç binding/binding.goä¸­å¯ä»¥çå°å®ä¹äºå¤ç§å¯¹requestè¿è¡æ ¡éªçå¨å±å¯¹è±¡ã\n\nvar (\n\tJSON          = jsonBinding{}\n\tXML           = xmlBinding{}\n\tForm          = formBinding{}\n\tQuery         = queryBinding{}\n\tFormPost      = formPostBinding{}\n\tFormMultipart = formMultipartBinding{}\n\tProtoBuf      = protobufBinding{}\n\tMsgPack       = msgpackBinding{}\n\tYAML          = yamlBinding{}\n\tUri           = uriBinding{}\n\tHeader        = headerBinding{}\n\tTOML          = tomlBinding{}\n)\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè¿å¥c.ShouldBindJSONæ¹æ³ï¼å¯ä»¥çå°è°ç¨äºc.ShouldBindWithæ¹æ³å¹¶å°è¡¨åå¯¹è±¡åå¨å±çJSONå¯¹è±¡ä¼ å¥å¶ä¸­ã\n\n// ShouldBindJSON is a shortcut for c.ShouldBindWith(obj, binding.JSON).\nfunc (c *Context) ShouldBindJSON(obj any) error {\n\treturn c.ShouldBindWith(obj, binding.JSON)\n}\n\n\n1\n2\n3\n4\n\n\nå¨c.ShouldBindWithä¸­ï¼æ¯ç´æ¥ä½¿ç¨ä¸é¢çJSONå¨å±å¯¹è±¡çbindæ¹æ³ï¼å°requetsåè¡¨åå¯¹è±¡ä¼ å¥å¶ä¸­ã\n\n// ShouldBindWith binds the passed struct pointer using the specified binding engine.\n// See the binding package.\nfunc (c *Context) ShouldBindWith(obj any, b binding.Binding) error {\n\treturn b.Bind(c.Request, obj)\n}\n\n\n1\n2\n3\n4\n5\n\n\nåçb.Bindæ¹æ³ï¼ä½ ä¼åç°ï¼å®åçäºææ¯ï¼æ ¡éªè¯·æ±åæ°æ¯å¦ä¸ºjsonæ ¼å¼ï¼ç¶ååè°ç¨validateæ¹æ³ï¼è¯¥æ¹æ³å°±æ¯å»åå»ºgo-palygroundæ¨¡åä¸­Validateå¯¹è±¡ï¼ç¶åè°ç¨å¶structæ¹æ³è¿è¡åæ°éªè¯ã\n\nfunc (jsonBinding) Bind(req *http.Request, obj any) error {\n\tif req == nil || req.Body == nil {\n\t\treturn errors.New("invalid request")\n\t}\n\treturn decodeJSON(req.Body, obj)\n}\n\nfunc decodeJSON(r io.Reader, obj any) error {\n\tdecoder := json.NewDecoder(r)\n\tif EnableDecoderUseNumber {\n\t\tdecoder.UseNumber()\n\t}\n\tif EnableDecoderDisallowUnknownFields {\n\t\tdecoder.DisallowUnknownFields()\n\t}\n\tif err := decoder.Decode(obj); err != nil {\n\t\treturn err\n\t}\n\treturn validate(obj)\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nä½ åççShouldBindXMLæ¹æ³ï¼å°±ä¼åç°æ¯åä¸é¢ä¸æ ·çè¿ç¨ï¼è°ç¨çæ¯å¨å±å¯¹è±¡XMLä¸­çbindæ¹æ³ï¼ç¶ååæ ¡éªè¯·æ±åæ°æ¯å¦ä¸ºxmlæ ¼å¼ï¼æç»è°ç¨validateæ¹æ³ã\n\næ»ç»ï¼\n\nå¨binding/binding.goä¸­çå¨å±å¯¹è±¡é½å®ç°äºä¸ä¸ªbindæ¹æ³ï¼è¯¥æ¹æ³æ¯å¯¹è¯·æ±åæ°çæ ¼å¼è¿è¡æ£éªï¼ç¶åæç»ä¼è°ç¨validateæ¹æ³ï¼å»åå»ºgo-palygroundæ¨¡åä¸­Validateå¯¹è±¡ï¼åè°ç¨å¶structå¯¹è±¡è¿è¡è¯·æ±åæ°çåå®¹æ ¡éªã\n\nåå»ºå¤ä¸ªShouldBindXXXï¼å¨ä¸åçæ¹æ³ä¸­ä½¿ç¨ä¸åçå¨å±å¯¹è±¡ï¼è¿äºå¯¹è±¡é½æä¸ä¸ªç¸åçæ¹æ³bindï¼ç¶ååç»ä¸è°ç¨bindæ¹æ³è¿è¡æ ¡éªã\n\n\n# é©å­æ¹æ³\n\nvalidatoråºä¸­Validateç»æä½æä¾äºä¸ç³»åçé©å­æ¹æ³ï¼å¨æ ¡éªä¸­çè¿ç¨ä¸­ï¼æä¾ç»ä½¿ç¨èæ¥ä¿®æ¹å¶ä¸­çé¨ååå®¹ã\n\næä»¬çä¸ä¸validator_instance.goæä»¶ä¸­Validateç»æä½ï¼è¯¥ç»æä½ä¸­åå«äºhasTagNameFuncåtagNameFuncä¸¤ä¸ªåéï¼tagNameFuncä»£è¡¨çé©å­æ¹æ³ï¼ä½¿ç¨èå¯ä»¥èªå®æ¹æ³æ¥èµå¼ç»å®ï¼hasTagNameFuncæ¯boolç±»åä»£è¡¨æ¯å¦éç½®äºé©å­æ¹æ³.\n\ntype Validate struct {\n\ttagName          string\n\tpool             *sync.Pool\n\thasCustomFuncs   bool\n\thasTagNameFunc   bool\n\ttagNameFunc      TagNameFunc\n\tstructLevelFuncs map[reflect.Type]StructLevelFuncCtx\n\tcustomFuncs      map[reflect.Type]CustomTypeFunc\n\taliases          map[string]string\n\tvalidations      map[string]internalValidationFuncWrapper\n\ttransTagFunc     map[ut.Translator]map[string]TranslationFunc // map[<locale>]map[<tag>]TranslationFunc\n\ttagCache         *tagCache\n\tstructCache      *structCache\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nä½¿ç¨èå¯ä»¥è°ç¨RegisterTagNameFuncæ¹æ³æ¥æ³¨åèªå·±åçæ¹æ³\n\nfunc (v *Validate) RegisterTagNameFunc(fn TagNameFunc) {\n\tv.tagNameFunc = fn\n\tv.hasTagNameFunc = true\n}\n\n\n1\n2\n3\n4\n\n\nå¨ä»£ç cache.goä¸­extractStructCacheæ¹æ³ä¸­æä¸é¢ä¸æ®µä»£ç ï¼éè¿è°ç¨hasTagNameFuncæ¹æ³æ¥å¤æ­æ¯å¦è®¾ç½®äºé©å­æ¹æ³ï¼å¦æè®¾ç½®äºï¼åè°ç¨tagNameFuncæ¥æ§è¡ä½¿ç¨èèªå®çæ¹æ³ã\n\n\t\tif v.hasTagNameFunc {\n\t\t\tname := v.tagNameFunc(fld)\n\t\t\tif len(name) > 0 {\n\t\t\t\tcustomName = name\n\t\t\t}\n\t\t}\n\n\n1\n2\n3\n4\n5\n6\n\n\næ»ç»ï¼\n\n * å¯ä»¥æä¾é©å­æ¹æ³æ´é²ç»ä½¿ç¨èåä¸å°æ§è¡è¿ç¨ä¸­æ¥ã\n\n\n# å¯¹è±¡æ± çåºç¨\n\nçæä»¶validator_instance.goä¸­çStructæ¹æ³ï¼è¿ä¸ªæ¹æ³å°±æ¯è¡¨åçæ ¡éªçå¥å£æ¹æ³ï¼å¯ä»¥çå°å®åè°ç¨äºStructCtxæ¹æ³ã\n\nfunc (v *Validate) Struct(s interface{}) error {\n\treturn v.StructCtx(context.Background(), s)\n}\n\n\n1\n2\n3\n\n\nåæ¥ççStructCtxæ¹æ³ï¼å¶ä¸­poolæ¯*sync.Poolç±»åï¼è°ç¨Getæ¹æ³è·åvalidateå¯¹è±¡ï¼ç¶ååè°ç¨å¶validateStructæ¹æ³ï¼å¶ä¸­ä¼è¿è¡è¯·æ±åæ°çæ ¡éªï¼ç¶åå¦ææ ¡éªæè¯¯ï¼ä¼å°éè¯¯ä¿¡æ¯ä¿å­å¨errsä¸­ãvaludateä½¿ç¨å®æåï¼åputåpoolä¸­ã\n\nå ä¸ºæ¯ä¸æ¬¡æ ¡éªé½éè¦åå»ºvalidateå¯¹è±¡ï¼æä»¥è¿éä½¿ç¨äºsync.Poolå¯ä»¥å¤ç¨ä¸´æ¶å¯¹è±¡ï¼åå°åå­çåéï¼éä½GCååã\n\nfunc (v *Validate) StructCtx(ctx context.Context, s interface{}) (err error) {\n\n\tval := reflect.ValueOf(s)\n\ttop := val\n\n\tif val.Kind() == reflect.Ptr && !val.IsNil() {\n\t\tval = val.Elem()\n\t}\n\n\tif val.Kind() != reflect.Struct || val.Type() == timeType {\n\t\treturn &InvalidValidationError{Type: reflect.TypeOf(s)}\n\t}\n\n\t// good to validate\n\tvd := v.pool.Get().(*validate)\n\tvd.top = top\n\tvd.isPartial = false\n\t// vd.hasExcludes = false // only need to reset in StructPartial and StructExcept\n\n\tvd.validateStruct(ctx, top, val, val.Type(), vd.ns[0:0], vd.actualNs[0:0], nil)\n\n\tif len(vd.errs) > 0 {\n\t\terr = vd.errs\n\t\tvd.errs = nil\n\t}\n\n\tv.pool.Put(vd)\n\n\treturn\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\næ»ç»ï¼\n\n * å½éè¦é¢ç¹åå»ºç¸åå¯¹è±¡ï¼å¹¶ä¸è¯¥å¯¹è±¡æ¯æ ç¶ææ¶ï¼å¯ä»¥ä½¿ç¨sync.Poolæ¥æé«å¤ç¨ä¸´æ¶å¯¹è±¡ï¼åå°åå­çåéï¼éä½GCååã\n\n\n# æ ¹æ®æ ç­¾æ ¡éªè¿ç¨\n\nå¨æå è½½åå»ºvalidatorçValidateå¯¹è±¡æ¶ï¼æ¯è°ç¨validator_instance.goä¸­Newæ¹æ³æ¥åå»ºè¯¥å¯¹è±¡ï¼å¨è¯¥æ¹æ³ä¸­åå§åæææ ç­¾åæ ç­¾å¯¹åºçæ ¡éªæ¹æ³å¹¶ä¿å­å¨Validateå¯¹è±¡ä¸­çvalidationsåéä¸­\n\nfor k, val := range bakedInValidators {\n\tswitch k {\n\t// these require that even if the value is nil that the validation should run, omitempty still overrides this behaviour\n\tcase requiredIfTag, requiredUnlessTag, requiredWithTag, requiredWithAllTag, requiredWithoutTag, requiredWithoutAllTag,\n\t\texcludedWithTag, excludedWithAllTag, excludedWithoutTag, excludedWithoutAllTag:\n\t\t_ = v.registerValidation(k, wrapFunc(val), true, true)\n\tdefault:\n\t\t// no need to error check here, baked in will always be valid\n\t\t_ = v.registerValidation(k, wrapFunc(val), true, false)\n\t}\n}\n\n\nfunc (v *Validate) registerValidation(tag string, fn FuncCtx, bakedIn bool, nilCheckable bool) error {\n\tif len(tag) == 0 {\n\t\treturn errors.New("function Key cannot be empty")\n\t}\n\n\tif fn == nil {\n\t\treturn errors.New("function cannot be empty")\n\t}\n\n\t_, ok := restrictedTags[tag]\n\tif !bakedIn && (ok || strings.ContainsAny(tag, restrictedTagChars)) {\n\t\tpanic(fmt.Sprintf(restrictedTagErr, tag))\n\t}\n\tv.validations[tag] = internalValidationFuncWrapper{fn: fn, runValidatinOnNil: nilCheckable}\n\treturn nil\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\næä»¬å¯ä»¥å¨baked_in.goæä»¶ä¸­çå°æå®ä¹ä»¥æ ç­¾ä¸ºkeyï¼æ ¡éªæ¹æ³ä¸ºvalueçmapå¯¹è±¡ã\n\nbakedInValidators = map[string]Func{\n\t\t"required":                      hasValue,\n\t\t"required_if":                   requiredIf,\n\t\t"required_unless":               requiredUnless,\n\t\t"required_with":                 requiredWith,\n\t\t"required_with_all":             requiredWithAll,\n\t\t"required_without":              requiredWithout,\n\t\t"required_without_all":          requiredWithoutAll,\n......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¨ä»£ç cache.goä¸­extractStructCacheæ¹æ³ä¸­ï¼ä¼éåè¯·æ±åæ°çæ¯ä¸ä¸ªå­æ®µï¼ç¶åæ ¹æ®è¯¥å­æ®µçtagåå»ºå¯¹åºçctagå¯¹è±¡ï¼ååå»ºè¯¥å­æ®µçcFieldå¯¹è±¡ï¼å¹¶å°ctagä¼ å¥ã\n\n\t\tif len(tag) > 0 {\n\t\t\tctag, _ = v.parseFieldTagsRecursive(tag, fld.Name, "", false)\n\t\t} else {\n\t\t\t// even if field doesn\'t have validations need cTag for traversing to potential inner/nested\n\t\t\t// elements of the field.\n\t\t\tctag = new(cTag)\n\t\t}\n\n\t\tcs.fields = append(cs.fields, &cField{\n\t\t\tidx:        i,\n\t\t\tname:       fld.Name,\n\t\t\taltName:    customName,\n\t\t\tcTags:      ctag,\n\t\t\tnamesEqual: fld.Name == customName,\n\t\t})\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå¨ä¸é¢çv.parseFieldTagsRecursiveæ¹æ³ä¸­ä¼å°ä»ä¹åç¼å­çvalidatetionséåä¸­æ¾å°è¯¥ctagçæ ¡éªæ¹æ³ï¼ç¶åèµå¼ctag.fnæ¹æ³ã\n\nif wrapper, ok := v.validations[current.tag]; ok {\n\tcurrent.fn = wrapper.fn\n\tcurrent.runValidationWhenNil = wrapper.runValidatinOnNil\n} else {\n\tpanic(strings.TrimSpace(fmt.Sprintf(undefinedValidation, current.tag, fieldName)))\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nå¨æä»¶validator.goä¸­traverseFieldæ¹æ³æ ¡éªå­æ®µä¸­ä¼è°ç¨ä¸é¢ä¼ éçfnæ¹æ³ï¼è¿åå¼ä¸ºfalseæ¶ï¼ä¼åå»ºfieldErrorå¯¹è±¡ä¿å­å¨validateçerrsä¸­\n\nif !ct.fn(ctx, v) {\n\n\tv.str1 = string(append(ns, cf.altName...))\n\n\tif v.v.hasTagNameFunc {\n\t\tv.str2 = string(append(structNs, cf.name...))\n\t} else {\n\t\tv.str2 = v.str1\n\t}\n\n\tv.errs = append(v.errs,\n\t\t&fieldError{\n\t\t\tv:              v.v,\n\t\t\ttag:            ct.aliasTag,\n\t\t\tactualTag:      ct.tag,\n\t\t\tns:             v.str1,\n\t\t\tstructNs:       v.str2,\n\t\t\tfieldLen:       uint8(len(cf.altName)),\n\t\t\tstructfieldLen: uint8(len(cf.name)),\n\t\t\tvalue:          current.Interface(),\n\t\t\tparam:          ct.param,\n\t\t\tkind:           kind,\n\t\t\ttyp:            typ,\n\t\t},\n)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\næç»å°è¿ä¸ªerrorå¨validator_instance.goä¸­çStructCtxæ¹æ³ä¸­è¿ååºå»ã\n\nvd.validateStruct(ctx, top, val, val.Type(), vd.ns[0:0], vd.actualNs[0:0], nil)\n\nif len(vd.errs) > 0 {\n\terr = vd.errs\n\tvd.errs = nil\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nç»è®ºï¼\n\n * errorå¹¶ä¸æ¯è°ç¨validateStructè¿ååºæ¥çï¼èæ¯éè¿å¨ç»æä½ä¸­åå»ºäºä¸ä¸ªerrorï¼å¨è¿ç¨ä¸­å¦æåçäºéè¯¯åå°è¯¥éè¯¯ä¿¡æ¯ä¿å­å¨ç»æä½çerroråéä¸­ï¼ä¹æ¯ä¸ç§errorçè¿åæ¹å¼ã\n\n * ååå§åææçæ ¡éªæ¹æ³ï¼ç¶ååæ ¹æ®æ¯ä¸ªå­æ®µéæ©æ ¡éªæ¹æ³è¿è¡æ§è¡ãé»è¾éå¸¸æ¸æ°ã\n\n\n# éè¯¯æç¤ºä¿¡æ¯ç¿»è¯\n\nä»ä¸é¢çè¿ç¨å¯ä»¥åç°ï¼ä»è½å¤åç°åªä¸ªå­æ®µååªä¸ªtagä¸­åçäºéè¯¯ï¼å¦ä¸æç¤ºï¼\n\n{\'msg\': "Key: \'User.password\' Error:Field validation for \'password\' failed on the \'required\' tag"}\n\n\n1\n\n\nä½æ¯æä»¬éè¦çæ¶åäººæ§åçéè¯¯æç¤ºã\n\nå¨ä»£ç translations/zh/zh.goçRegisterDefaultTranslationsæ¹æ³ä¸­å¯ä»¥çå°å®ä¹äºæ¯ä¸ªtagåå¯¹åºä¸­ææç¤ºä¿¡æ¯ãè¿äºä¿¡æ¯ä¼æ³¨åå°validatorçValidate.transTagFuncåéä¸­ã\n\nfunc RegisterDefaultTranslations(v *validator.Validate, trans ut.Translator) (err error) {\n\n\ttranslations := []struct {\n\t\ttag             string\n\t\ttranslation     string\n\t\toverride        bool\n\t\tcustomRegisFunc validator.RegisterTranslationsFunc\n\t\tcustomTransFunc validator.TranslationFunc\n\t}{\n\t\t{\n\t\t\ttag:         "required",\n\t\t\ttranslation: "{0}ä¸ºå¿å¡«å­æ®µ",\n\t\t\toverride:    false,\n\t\t},\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ¯ä¸ªå­æ®µçéè¯¯å¯¹è±¡é½æTranslateæ¹æ³ï¼å½è°ç¨æ¹æ³æ¶ï¼ä¼éåå½åææéè¯¯çå­æ®µï¼ç¶ååæ¾å°æ¯ä¸ªTagå¯¹åºçæç¤ºä¿¡æ¯è¾åºã\n\nfunc (ve ValidationErrors) Translate(ut ut.Translator) ValidationErrorsTranslations {\n\n\ttrans := make(ValidationErrorsTranslations)\n\n\tvar fe *fieldError\n\n\tfor i := 0; i < len(ve); i++ {\n\t\tfe = ve[i].(*fieldError)\n\n\t\t// // in case an Anonymous struct was used, ensure that the key\n\t\t// // would be \'Username\' instead of ".Username"\n\t\t// if len(fe.ns) > 0 && fe.ns[:1] == "." {\n\t\t// \ttrans[fe.ns[1:]] = fe.Translate(ut)\n\t\t// \tcontinue\n\t\t// }\n\n\t\ttrans[fe.ns] = fe.Translate(ut)\n\t}\n\n\treturn trans\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nè¿ä¸ªæ¯æ¯ä¸ä¸ªå­æ®µéè¿tagè·åæç¤ºä¿¡æ¯ã\n\nfunc (fe *fieldError) Translate(ut ut.Translator) string {\n\n\tm, ok := fe.v.transTagFunc[ut]\n\tif !ok {\n\t\treturn fe.Error()\n\t}\n\n\tfn, ok := m[fe.tag]\n\tif !ok {\n\t\treturn fe.Error()\n\t}\n\n\treturn fn(ut, fe)\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n',normalizedContent:'# ç®ä»\n\nå¨ginä¸­ä½¿ç¨çæ¯validatoræ¨¡åæ¥å¯¹è¡¨åè¿è¡æ ¡éªçã\n\nvalidatoræ¨¡ågithubå°å\n\n\n# æå è½½validateå¯¹è±¡\n\nä¼æå¨ç¥ï¼å¨apiå±éè¦ä½¿ç¨gin.contextä¸­çshouldbindjsonæ¹æ³æ¥å¯¹requestä¸­çjsonå­æ®µè¿è¡æ ¡éªï¼ä¾å­å¦ä¸:\n\nfunc login(c *gin.context) {\n\n\tvar user user\n\tif err := c.shouldbindjson(&user); err != nil {\n\n\t\terrs, ok := err.(validator.validationerrors)\n\t\tif !ok {\n\t\t\t// éæ ¡éªéè¯¯ï¼å¶ä»éè¯¯ç´æ¥è¿å\n\t\t\tc.json(http.statusok, gin.h{"msg": err.error()})\n\t\t\treturn\n\t\t}\n\n\t\tc.json(http.statusok, gin.h{"msg": errs.translate(global.trans)})\n\t\treturn\n\t}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå¨c.shourdbindjsonä¸­ï¼ä¸ç´å¾ä¸è·³è½¬ï¼è·å°è·¯å¾binding/default_validator.goä¸ï¼å¯ä»¥çå°ä»£ç å¦ä¸ï¼å¯¹è¡¨åçæ ¡éªæ¯è°ç¨v.validate.struct(obj)æ¥å®æçï¼è¿éçvalidateæ¯validatoråºä¸­validateå¯¹è±¡ï¼æä»¥å¨ä¹åä½¿ç¨v.lazyinit()æ¥åå»ºè¯¥å¯¹è±¡ã\n\n// validatestruct receives struct type\nfunc (v *defaultvalidator) validatestruct(obj any) error {\n\tv.lazyinit()\n\treturn v.validate.struct(obj)\n}\n\n\n1\n2\n3\n4\n5\n\n\nåçv.lazyinit()æ¹æ³ï¼è¿éä½¿ç¨äºonce.doæ¹æ³ï¼è¯¥onceæ¯sync.onecå¯¹è±¡ï¼doä¸­çæ¹æ³åªä¼æ§è¡ä¸æ¬¡ï¼ä¹å°±æ¯åªä¼åå»ºä¸æ¬¡validateå¯¹è±¡ï¼ä¿æè¯¥å¯¹è±¡çåä¾ã\n\ntype defaultvalidator struct {\n\tonce     sync.once\n\tvalidate *validator.validate\n}\n\nfunc (v *defaultvalidator) lazyinit() {\n\tv.once.do(func() {\n\t\tv.validate = validator.new()\n\t\tv.validate.settagname("binding")\n\t})\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\né£ä¹æè¿ä¹ä¸ç§åºæ¯ï¼å¦æææ³è¦å¯¹validatorä¸­çvalidateå¯¹è±¡è¿è¡éç½®ï¼è¯¥æä¹åå¢ï¼å ä¸ºä¸é¢é½æ¯å¨ä½¿ç¨æ¶æå è½½æå è½½çï¼æä»¬éè¦æåæ¿å°validateå¯¹è±¡å¹¶è¿è¡éç½®ï¼è¯¥å¦ä½å¤çï¼\n\nå¨ä»£ç binding/default_validator.goä¸­ï¼æä¾äºengineæ¹æ³ï¼æä»¬å¯ä»¥ä½¿ç¨è¯¥æ¹æ³ç»ä½¿ç¨è¿è°ç¨æåå è½½validateå¯¹è±¡ï¼å¹¶è¿åè¯¥å¯¹è±¡ï¼å°±å¯ä»¥è¿è¡éç½®äºã\n\nfunc (v *defaultvalidator) engine() any {\n\tv.lazyinit()\n\treturn v.validate\n}\n\n\n1\n2\n3\n4\n\n\nç»è®ºï¼\n\n * ç»æä½ä¸­çå¯¹è±¡å¯ä»¥ä½¿ç¨æå è½½çæ¹å¼ï¼å¨ä½¿ç¨çæ¶ååè¿è¡åå»ºã\n\n * å¯ä»¥ä½¿ç¨once.doçæ¹æ³åå»ºå¯¹è±¡ä¿æåä¾ã\n\n * å¯ä»¥æä¾æ¹æ³æåå è½½å¯¹è±¡ï¼ç¶åè¿ååºæ¥è¿è¡ä½¿ç¨éç½®\n\n\n# å¤ç§è¯·æ±åæ°çæ ¡éª\n\næä»¬ä½¿ç¨c.shouldbindjson(&user)å¯ä»¥å¯¹jsonæ ¼å¼çè¯·æ±åæ°è¿è¡æ ¡éªï¼ä¹å¯ä»¥ä½¿ç¨c.shouldbindxmlå¯¹xmlæ ¼å¼çè¯·æ±åæ°è¿è¡æ ¡éªã\n\nå¨ä»£ç binding/binding.goä¸­å¯ä»¥çå°å®ä¹äºå¤ç§å¯¹requestè¿è¡æ ¡éªçå¨å±å¯¹è±¡ã\n\nvar (\n\tjson          = jsonbinding{}\n\txml           = xmlbinding{}\n\tform          = formbinding{}\n\tquery         = querybinding{}\n\tformpost      = formpostbinding{}\n\tformmultipart = formmultipartbinding{}\n\tprotobuf      = protobufbinding{}\n\tmsgpack       = msgpackbinding{}\n\tyaml          = yamlbinding{}\n\turi           = uribinding{}\n\theader        = headerbinding{}\n\ttoml          = tomlbinding{}\n)\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè¿å¥c.shouldbindjsonæ¹æ³ï¼å¯ä»¥çå°è°ç¨äºc.shouldbindwithæ¹æ³å¹¶å°è¡¨åå¯¹è±¡åå¨å±çjsonå¯¹è±¡ä¼ å¥å¶ä¸­ã\n\n// shouldbindjson is a shortcut for c.shouldbindwith(obj, binding.json).\nfunc (c *context) shouldbindjson(obj any) error {\n\treturn c.shouldbindwith(obj, binding.json)\n}\n\n\n1\n2\n3\n4\n\n\nå¨c.shouldbindwithä¸­ï¼æ¯ç´æ¥ä½¿ç¨ä¸é¢çjsonå¨å±å¯¹è±¡çbindæ¹æ³ï¼å°requetsåè¡¨åå¯¹è±¡ä¼ å¥å¶ä¸­ã\n\n// shouldbindwith binds the passed struct pointer using the specified binding engine.\n// see the binding package.\nfunc (c *context) shouldbindwith(obj any, b binding.binding) error {\n\treturn b.bind(c.request, obj)\n}\n\n\n1\n2\n3\n4\n5\n\n\nåçb.bindæ¹æ³ï¼ä½ ä¼åç°ï¼å®åçäºææ¯ï¼æ ¡éªè¯·æ±åæ°æ¯å¦ä¸ºjsonæ ¼å¼ï¼ç¶ååè°ç¨validateæ¹æ³ï¼è¯¥æ¹æ³å°±æ¯å»åå»ºgo-palygroundæ¨¡åä¸­validateå¯¹è±¡ï¼ç¶åè°ç¨å¶structæ¹æ³è¿è¡åæ°éªè¯ã\n\nfunc (jsonbinding) bind(req *http.request, obj any) error {\n\tif req == nil || req.body == nil {\n\t\treturn errors.new("invalid request")\n\t}\n\treturn decodejson(req.body, obj)\n}\n\nfunc decodejson(r io.reader, obj any) error {\n\tdecoder := json.newdecoder(r)\n\tif enabledecoderusenumber {\n\t\tdecoder.usenumber()\n\t}\n\tif enabledecoderdisallowunknownfields {\n\t\tdecoder.disallowunknownfields()\n\t}\n\tif err := decoder.decode(obj); err != nil {\n\t\treturn err\n\t}\n\treturn validate(obj)\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nä½ åççshouldbindxmlæ¹æ³ï¼å°±ä¼åç°æ¯åä¸é¢ä¸æ ·çè¿ç¨ï¼è°ç¨çæ¯å¨å±å¯¹è±¡xmlä¸­çbindæ¹æ³ï¼ç¶ååæ ¡éªè¯·æ±åæ°æ¯å¦ä¸ºxmlæ ¼å¼ï¼æç»è°ç¨validateæ¹æ³ã\n\næ»ç»ï¼\n\nå¨binding/binding.goä¸­çå¨å±å¯¹è±¡é½å®ç°äºä¸ä¸ªbindæ¹æ³ï¼è¯¥æ¹æ³æ¯å¯¹è¯·æ±åæ°çæ ¼å¼è¿è¡æ£éªï¼ç¶åæç»ä¼è°ç¨validateæ¹æ³ï¼å»åå»ºgo-palygroundæ¨¡åä¸­validateå¯¹è±¡ï¼åè°ç¨å¶structå¯¹è±¡è¿è¡è¯·æ±åæ°çåå®¹æ ¡éªã\n\nåå»ºå¤ä¸ªshouldbindxxxï¼å¨ä¸åçæ¹æ³ä¸­ä½¿ç¨ä¸åçå¨å±å¯¹è±¡ï¼è¿äºå¯¹è±¡é½æä¸ä¸ªç¸åçæ¹æ³bindï¼ç¶ååç»ä¸è°ç¨bindæ¹æ³è¿è¡æ ¡éªã\n\n\n# é©å­æ¹æ³\n\nvalidatoråºä¸­validateç»æä½æä¾äºä¸ç³»åçé©å­æ¹æ³ï¼å¨æ ¡éªä¸­çè¿ç¨ä¸­ï¼æä¾ç»ä½¿ç¨èæ¥ä¿®æ¹å¶ä¸­çé¨ååå®¹ã\n\næä»¬çä¸ä¸validator_instance.goæä»¶ä¸­validateç»æä½ï¼è¯¥ç»æä½ä¸­åå«äºhastagnamefuncåtagnamefuncä¸¤ä¸ªåéï¼tagnamefuncä»£è¡¨çé©å­æ¹æ³ï¼ä½¿ç¨èå¯ä»¥èªå®æ¹æ³æ¥èµå¼ç»å®ï¼hastagnamefuncæ¯boolç±»åä»£è¡¨æ¯å¦éç½®äºé©å­æ¹æ³.\n\ntype validate struct {\n\ttagname          string\n\tpool             *sync.pool\n\thascustomfuncs   bool\n\thastagnamefunc   bool\n\ttagnamefunc      tagnamefunc\n\tstructlevelfuncs map[reflect.type]structlevelfuncctx\n\tcustomfuncs      map[reflect.type]customtypefunc\n\taliases          map[string]string\n\tvalidations      map[string]internalvalidationfuncwrapper\n\ttranstagfunc     map[ut.translator]map[string]translationfunc // map[<locale>]map[<tag>]translationfunc\n\ttagcache         *tagcache\n\tstructcache      *structcache\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nä½¿ç¨èå¯ä»¥è°ç¨registertagnamefuncæ¹æ³æ¥æ³¨åèªå·±åçæ¹æ³\n\nfunc (v *validate) registertagnamefunc(fn tagnamefunc) {\n\tv.tagnamefunc = fn\n\tv.hastagnamefunc = true\n}\n\n\n1\n2\n3\n4\n\n\nå¨ä»£ç cache.goä¸­extractstructcacheæ¹æ³ä¸­æä¸é¢ä¸æ®µä»£ç ï¼éè¿è°ç¨hastagnamefuncæ¹æ³æ¥å¤æ­æ¯å¦è®¾ç½®äºé©å­æ¹æ³ï¼å¦æè®¾ç½®äºï¼åè°ç¨tagnamefuncæ¥æ§è¡ä½¿ç¨èèªå®çæ¹æ³ã\n\n\t\tif v.hastagnamefunc {\n\t\t\tname := v.tagnamefunc(fld)\n\t\t\tif len(name) > 0 {\n\t\t\t\tcustomname = name\n\t\t\t}\n\t\t}\n\n\n1\n2\n3\n4\n5\n6\n\n\næ»ç»ï¼\n\n * å¯ä»¥æä¾é©å­æ¹æ³æ´é²ç»ä½¿ç¨èåä¸å°æ§è¡è¿ç¨ä¸­æ¥ã\n\n\n# å¯¹è±¡æ± çåºç¨\n\nçæä»¶validator_instance.goä¸­çstructæ¹æ³ï¼è¿ä¸ªæ¹æ³å°±æ¯è¡¨åçæ ¡éªçå¥å£æ¹æ³ï¼å¯ä»¥çå°å®åè°ç¨äºstructctxæ¹æ³ã\n\nfunc (v *validate) struct(s interface{}) error {\n\treturn v.structctx(context.background(), s)\n}\n\n\n1\n2\n3\n\n\nåæ¥ççstructctxæ¹æ³ï¼å¶ä¸­poolæ¯*sync.poolç±»åï¼è°ç¨getæ¹æ³è·åvalidateå¯¹è±¡ï¼ç¶ååè°ç¨å¶validatestructæ¹æ³ï¼å¶ä¸­ä¼è¿è¡è¯·æ±åæ°çæ ¡éªï¼ç¶åå¦ææ ¡éªæè¯¯ï¼ä¼å°éè¯¯ä¿¡æ¯ä¿å­å¨errsä¸­ãvaludateä½¿ç¨å®æåï¼åputåpoolä¸­ã\n\nå ä¸ºæ¯ä¸æ¬¡æ ¡éªé½éè¦åå»ºvalidateå¯¹è±¡ï¼æä»¥è¿éä½¿ç¨äºsync.poolå¯ä»¥å¤ç¨ä¸´æ¶å¯¹è±¡ï¼åå°åå­çåéï¼éä½gcååã\n\nfunc (v *validate) structctx(ctx context.context, s interface{}) (err error) {\n\n\tval := reflect.valueof(s)\n\ttop := val\n\n\tif val.kind() == reflect.ptr && !val.isnil() {\n\t\tval = val.elem()\n\t}\n\n\tif val.kind() != reflect.struct || val.type() == timetype {\n\t\treturn &invalidvalidationerror{type: reflect.typeof(s)}\n\t}\n\n\t// good to validate\n\tvd := v.pool.get().(*validate)\n\tvd.top = top\n\tvd.ispartial = false\n\t// vd.hasexcludes = false // only need to reset in structpartial and structexcept\n\n\tvd.validatestruct(ctx, top, val, val.type(), vd.ns[0:0], vd.actualns[0:0], nil)\n\n\tif len(vd.errs) > 0 {\n\t\terr = vd.errs\n\t\tvd.errs = nil\n\t}\n\n\tv.pool.put(vd)\n\n\treturn\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\næ»ç»ï¼\n\n * å½éè¦é¢ç¹åå»ºç¸åå¯¹è±¡ï¼å¹¶ä¸è¯¥å¯¹è±¡æ¯æ ç¶ææ¶ï¼å¯ä»¥ä½¿ç¨sync.poolæ¥æé«å¤ç¨ä¸´æ¶å¯¹è±¡ï¼åå°åå­çåéï¼éä½gcååã\n\n\n# æ ¹æ®æ ç­¾æ ¡éªè¿ç¨\n\nå¨æå è½½åå»ºvalidatorçvalidateå¯¹è±¡æ¶ï¼æ¯è°ç¨validator_instance.goä¸­newæ¹æ³æ¥åå»ºè¯¥å¯¹è±¡ï¼å¨è¯¥æ¹æ³ä¸­åå§åæææ ç­¾åæ ç­¾å¯¹åºçæ ¡éªæ¹æ³å¹¶ä¿å­å¨validateå¯¹è±¡ä¸­çvalidationsåéä¸­\n\nfor k, val := range bakedinvalidators {\n\tswitch k {\n\t// these require that even if the value is nil that the validation should run, omitempty still overrides this behaviour\n\tcase requirediftag, requiredunlesstag, requiredwithtag, requiredwithalltag, requiredwithouttag, requiredwithoutalltag,\n\t\texcludedwithtag, excludedwithalltag, excludedwithouttag, excludedwithoutalltag:\n\t\t_ = v.registervalidation(k, wrapfunc(val), true, true)\n\tdefault:\n\t\t// no need to error check here, baked in will always be valid\n\t\t_ = v.registervalidation(k, wrapfunc(val), true, false)\n\t}\n}\n\n\nfunc (v *validate) registervalidation(tag string, fn funcctx, bakedin bool, nilcheckable bool) error {\n\tif len(tag) == 0 {\n\t\treturn errors.new("function key cannot be empty")\n\t}\n\n\tif fn == nil {\n\t\treturn errors.new("function cannot be empty")\n\t}\n\n\t_, ok := restrictedtags[tag]\n\tif !bakedin && (ok || strings.containsany(tag, restrictedtagchars)) {\n\t\tpanic(fmt.sprintf(restrictedtagerr, tag))\n\t}\n\tv.validations[tag] = internalvalidationfuncwrapper{fn: fn, runvalidatinonnil: nilcheckable}\n\treturn nil\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\næä»¬å¯ä»¥å¨baked_in.goæä»¶ä¸­çå°æå®ä¹ä»¥æ ç­¾ä¸ºkeyï¼æ ¡éªæ¹æ³ä¸ºvalueçmapå¯¹è±¡ã\n\nbakedinvalidators = map[string]func{\n\t\t"required":                      hasvalue,\n\t\t"required_if":                   requiredif,\n\t\t"required_unless":               requiredunless,\n\t\t"required_with":                 requiredwith,\n\t\t"required_with_all":             requiredwithall,\n\t\t"required_without":              requiredwithout,\n\t\t"required_without_all":          requiredwithoutall,\n......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¨ä»£ç cache.goä¸­extractstructcacheæ¹æ³ä¸­ï¼ä¼éåè¯·æ±åæ°çæ¯ä¸ä¸ªå­æ®µï¼ç¶åæ ¹æ®è¯¥å­æ®µçtagåå»ºå¯¹åºçctagå¯¹è±¡ï¼ååå»ºè¯¥å­æ®µçcfieldå¯¹è±¡ï¼å¹¶å°ctagä¼ å¥ã\n\n\t\tif len(tag) > 0 {\n\t\t\tctag, _ = v.parsefieldtagsrecursive(tag, fld.name, "", false)\n\t\t} else {\n\t\t\t// even if field doesn\'t have validations need ctag for traversing to potential inner/nested\n\t\t\t// elements of the field.\n\t\t\tctag = new(ctag)\n\t\t}\n\n\t\tcs.fields = append(cs.fields, &cfield{\n\t\t\tidx:        i,\n\t\t\tname:       fld.name,\n\t\t\taltname:    customname,\n\t\t\tctags:      ctag,\n\t\t\tnamesequal: fld.name == customname,\n\t\t})\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå¨ä¸é¢çv.parsefieldtagsrecursiveæ¹æ³ä¸­ä¼å°ä»ä¹åç¼å­çvalidatetionséåä¸­æ¾å°è¯¥ctagçæ ¡éªæ¹æ³ï¼ç¶åèµå¼ctag.fnæ¹æ³ã\n\nif wrapper, ok := v.validations[current.tag]; ok {\n\tcurrent.fn = wrapper.fn\n\tcurrent.runvalidationwhennil = wrapper.runvalidatinonnil\n} else {\n\tpanic(strings.trimspace(fmt.sprintf(undefinedvalidation, current.tag, fieldname)))\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nå¨æä»¶validator.goä¸­traversefieldæ¹æ³æ ¡éªå­æ®µä¸­ä¼è°ç¨ä¸é¢ä¼ éçfnæ¹æ³ï¼è¿åå¼ä¸ºfalseæ¶ï¼ä¼åå»ºfielderrorå¯¹è±¡ä¿å­å¨validateçerrsä¸­\n\nif !ct.fn(ctx, v) {\n\n\tv.str1 = string(append(ns, cf.altname...))\n\n\tif v.v.hastagnamefunc {\n\t\tv.str2 = string(append(structns, cf.name...))\n\t} else {\n\t\tv.str2 = v.str1\n\t}\n\n\tv.errs = append(v.errs,\n\t\t&fielderror{\n\t\t\tv:              v.v,\n\t\t\ttag:            ct.aliastag,\n\t\t\tactualtag:      ct.tag,\n\t\t\tns:             v.str1,\n\t\t\tstructns:       v.str2,\n\t\t\tfieldlen:       uint8(len(cf.altname)),\n\t\t\tstructfieldlen: uint8(len(cf.name)),\n\t\t\tvalue:          current.interface(),\n\t\t\tparam:          ct.param,\n\t\t\tkind:           kind,\n\t\t\ttyp:            typ,\n\t\t},\n)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\næç»å°è¿ä¸ªerrorå¨validator_instance.goä¸­çstructctxæ¹æ³ä¸­è¿ååºå»ã\n\nvd.validatestruct(ctx, top, val, val.type(), vd.ns[0:0], vd.actualns[0:0], nil)\n\nif len(vd.errs) > 0 {\n\terr = vd.errs\n\tvd.errs = nil\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nç»è®ºï¼\n\n * errorå¹¶ä¸æ¯è°ç¨validatestructè¿ååºæ¥çï¼èæ¯éè¿å¨ç»æä½ä¸­åå»ºäºä¸ä¸ªerrorï¼å¨è¿ç¨ä¸­å¦æåçäºéè¯¯åå°è¯¥éè¯¯ä¿¡æ¯ä¿å­å¨ç»æä½çerroråéä¸­ï¼ä¹æ¯ä¸ç§errorçè¿åæ¹å¼ã\n\n * ååå§åææçæ ¡éªæ¹æ³ï¼ç¶ååæ ¹æ®æ¯ä¸ªå­æ®µéæ©æ ¡éªæ¹æ³è¿è¡æ§è¡ãé»è¾éå¸¸æ¸æ°ã\n\n\n# éè¯¯æç¤ºä¿¡æ¯ç¿»è¯\n\nä»ä¸é¢çè¿ç¨å¯ä»¥åç°ï¼ä»è½å¤åç°åªä¸ªå­æ®µååªä¸ªtagä¸­åçäºéè¯¯ï¼å¦ä¸æç¤ºï¼\n\n{\'msg\': "key: \'user.password\' error:field validation for \'password\' failed on the \'required\' tag"}\n\n\n1\n\n\nä½æ¯æä»¬éè¦çæ¶åäººæ§åçéè¯¯æç¤ºã\n\nå¨ä»£ç translations/zh/zh.goçregisterdefaulttranslationsæ¹æ³ä¸­å¯ä»¥çå°å®ä¹äºæ¯ä¸ªtagåå¯¹åºä¸­ææç¤ºä¿¡æ¯ãè¿äºä¿¡æ¯ä¼æ³¨åå°validatorçvalidate.transtagfuncåéä¸­ã\n\nfunc registerdefaulttranslations(v *validator.validate, trans ut.translator) (err error) {\n\n\ttranslations := []struct {\n\t\ttag             string\n\t\ttranslation     string\n\t\toverride        bool\n\t\tcustomregisfunc validator.registertranslationsfunc\n\t\tcustomtransfunc validator.translationfunc\n\t}{\n\t\t{\n\t\t\ttag:         "required",\n\t\t\ttranslation: "{0}ä¸ºå¿å¡«å­æ®µ",\n\t\t\toverride:    false,\n\t\t},\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ¯ä¸ªå­æ®µçéè¯¯å¯¹è±¡é½ætranslateæ¹æ³ï¼å½è°ç¨æ¹æ³æ¶ï¼ä¼éåå½åææéè¯¯çå­æ®µï¼ç¶ååæ¾å°æ¯ä¸ªtagå¯¹åºçæç¤ºä¿¡æ¯è¾åºã\n\nfunc (ve validationerrors) translate(ut ut.translator) validationerrorstranslations {\n\n\ttrans := make(validationerrorstranslations)\n\n\tvar fe *fielderror\n\n\tfor i := 0; i < len(ve); i++ {\n\t\tfe = ve[i].(*fielderror)\n\n\t\t// // in case an anonymous struct was used, ensure that the key\n\t\t// // would be \'username\' instead of ".username"\n\t\t// if len(fe.ns) > 0 && fe.ns[:1] == "." {\n\t\t// \ttrans[fe.ns[1:]] = fe.translate(ut)\n\t\t// \tcontinue\n\t\t// }\n\n\t\ttrans[fe.ns] = fe.translate(ut)\n\t}\n\n\treturn trans\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nè¿ä¸ªæ¯æ¯ä¸ä¸ªå­æ®µéè¿tagè·åæç¤ºä¿¡æ¯ã\n\nfunc (fe *fielderror) translate(ut ut.translator) string {\n\n\tm, ok := fe.v.transtagfunc[ut]\n\tif !ok {\n\t\treturn fe.error()\n\t}\n\n\tfn, ok := m[fe.tag]\n\tif !ok {\n\t\treturn fe.error()\n\t}\n\n\treturn fn(ut, fe)\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"ä¼åginè¡¨åçéè¯¯æç¤ºä¿¡æ¯",frontmatter:{tags:["golang","gin"],title:"ä¼åginè¡¨åçéè¯¯æç¤ºä¿¡æ¯",date:"2022-09-11T16:53:33.000Z",permalink:"/pages/cf9a4d/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"å¦ä½ä¼åginæ¡æ¶ä¸­è¡¨åçéè¯¯æç¤ºä¿¡æ¯",feed:{enable:!0},categories:["ç¼ç¨","go"],comment:!0,meta:[{name:"twitter:title",content:"ä¼åginè¡¨åçéè¯¯æç¤ºä¿¡æ¯"},{name:"twitter:description",content:"å¦ä½ä¼åginæ¡æ¶ä¸­è¡¨åçéè¯¯æç¤ºä¿¡æ¯"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/02.go/03.%E4%BC%98%E5%8C%96gin%E8%A1%A8%E5%8D%95%E7%9A%84%E9%94%99%E8%AF%AF%E6%8F%90%E7%A4%BA%E4%BF%A1%E6%81%AF.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ä¼åginè¡¨åçéè¯¯æç¤ºä¿¡æ¯"},{property:"og:description",content:"å¦ä½ä¼åginæ¡æ¶ä¸­è¡¨åçéè¯¯æç¤ºä¿¡æ¯"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/02.go/03.%E4%BC%98%E5%8C%96gin%E8%A1%A8%E5%8D%95%E7%9A%84%E9%94%99%E8%AF%AF%E6%8F%90%E7%A4%BA%E4%BF%A1%E6%81%AF.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-09-11T16:53:33.000Z"},{property:"article:tag",content:"golang"},{property:"article:tag",content:"gin"},{itemprop:"name",content:"ä¼åginè¡¨åçéè¯¯æç¤ºä¿¡æ¯"},{itemprop:"description",content:"å¦ä½ä¼åginæ¡æ¶ä¸­è¡¨åçéè¯¯æç¤ºä¿¡æ¯"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/02.go/03.%E4%BC%98%E5%8C%96gin%E8%A1%A8%E5%8D%95%E7%9A%84%E9%94%99%E8%AF%AF%E6%8F%90%E7%A4%BA%E4%BF%A1%E6%81%AF.html",relativePath:"04.ç¼ç¨/02.go/03.ä¼åginè¡¨åçéè¯¯æç¤ºä¿¡æ¯.md",key:"v-118bdc85",path:"/pages/cf9a4d/",headers:[{level:2,title:"ç¸å³é¾æ¥",slug:"ç¸å³é¾æ¥",normalizedTitle:"ç¸å³é¾æ¥",charIndex:2},{level:2,title:"ç®åä½¿ç¨è¡¨åæ£éªè¯·æ±åæ°",slug:"ç®åä½¿ç¨è¡¨åæ£éªè¯·æ±åæ°",normalizedTitle:"ç®åä½¿ç¨è¡¨åæ£éªè¯·æ±åæ°",charIndex:27},{level:2,title:"ç¿»è¯",slug:"ç¿»è¯",normalizedTitle:"ç¿»è¯",charIndex:970},{level:2,title:"ä¼åè¿åå­æ®µçkey",slug:"ä¼åè¿åå­æ®µçkey",normalizedTitle:"ä¼åè¿åå­æ®µçkey",charIndex:3105},{level:2,title:"æ»ç»",slug:"æ»ç»",normalizedTitle:"æ»ç»",charIndex:5184}],headersStr:"ç¸å³é¾æ¥ ç®åä½¿ç¨è¡¨åæ£éªè¯·æ±åæ° ç¿»è¯ ä¼åè¿åå­æ®µçkey æ»ç»",content:'# ç¸å³é¾æ¥\n\nginå®æ¹ä¾å­\n\næç« çä»£ç \n\n\n# ç®åä½¿ç¨è¡¨åæ£éªè¯·æ±åæ°\n\nåå»ºä¸ä¸ªç®åçç»å½ä¾å­ï¼æä»¬å¯¹usernameåpasswordç»å®äºrequiredæ ç­¾ï¼ä»£è¡¨çè¯·æ±loginæ¥å£çåæ°ä¸­å¿é¡»åå«è¿ä¸¤ä¸ªå­æ®µã\n\ntype User struct {\n\tUserName string `json:"username" binding:"required"`\n\tPassword string `json:"password" binding:"required"`\n}\n\nfunc login(c *gin.Context) {\n\n\tvar user User\n\tif err := c.ShouldBindJSON(&user); err != nil {\n\t\tc.JSON(http.StatusOK, gin.H{"msg": err.Error()})\n\t\treturn\n\t}\n\n\tif user.UserName != "admin" || user.Password != "123456" {\n\t\tc.JSON(http.StatusUnauthorized, gin.H{"msg": "unauthorized"})\n\t\treturn\n\t}\n\n\tc.JSON(http.StatusOK, gin.H{"msg": "you are logged in"})\n}\n\nfunc main() {\n\tr := gin.Default()\n\tr.POST("/login", login)\n\tr.Run() // çå¬å¹¶å¨ 0.0.0.0:8080 ä¸å¯å¨æå¡\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\næä»¬ä½¿ç¨ä»å¸¦æusernameå»è¯·æ±loginæ¥å£ï¼ä¼è¾åºå¦ä¸ï¼æç¤ºæä»¬Passwordæ ¡éªå¤±è´¥äºï¼å ä¸ºrequiredçæ ç­¾å¯¼è´çãä½æ¯è¿ä¸ªæç¤ºå¹¶ä¸åå¥½ï¼æä»¬éè¦è¿è¡ä¼åå±ç¤ºã\n\n{\'msg\': "Key: \'User.Password\' Error:Field validation for \'Password\' failed on the \'required\' tag"}\n\n\n1\n\n\n\n# ç¿»è¯\n\næä»¬éè¦å¯¹ä¸é¢çæç¤ºä¿¡æ¯è¿è¡ä¸ä¸ªç¿»è¯ï¼å¹¶ä¸å¯ä»¥æ¯æåç§è¯­è¨çåå¥½æ§æç¤ºã\n\næä»¬å¨global/global.goæä»¶ä¸­åå»ºä¸ä¸ªå¨å±åéï¼è¯¥å¨å±åéå¨åé¢çè¡¨åç¿»è¯ä¸­éè¦ä½¿ç¨å°\n\nimport ut "github.com/go-playground/universal-translator"\n\nvar (\n\tTrans ut.Translator\n)\n\n\n1\n2\n3\n4\n5\n\n\nå¨initialize/validator.goæä»¶ä¸­ç¼ååå®¹å¦ä¸ï¼è·åginä¸­çvalidateå¯¹è±¡ï¼ç¶åç»è¯¥å¯¹è±¡ç»å®ä¸­æåè±æçåå¥½æç¤ºä¿¡æ¯ï¼æä»¬å¯ä»¥éè¿localeæ¥è®¾ç½®æä»¬éè¦ä½¿ç¨ä¸­æè¿æ¯è±æçä¿¡æ¯ã\n\nfunc InitTrans(locale string) (err error) {\n\n\tif v, ok := binding.Validator.Engine().(*validator.Validate); ok {\n\n\t\t// ç¿»è¯\n\t\tzhT := zh.New()\n\t\tenT := en.New()\n\t\tuni := ut.New(enT, zhT, enT)\n\n\t\tglobal.Trans, ok = uni.GetTranslator(locale)\n\t\tif !ok {\n\t\t\treturn fmt.Errorf("uni.GetTranslator(%s) error", locale)\n\t\t}\n\n\t\tswitch locale {\n\t\tcase "zh":\n\t\t\tzh_translations.RegisterDefaultTranslations(v, global.Trans)\n\t\tcase "en":\n\t\t\ten_translations.RegisterDefaultTranslations(v, global.Trans)\n\t\tdefault:\n\t\t\ten_translations.RegisterDefaultTranslations(v, global.Trans)\n\t\t}\n\n\t\treturn\n\t}\n\treturn\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\næåå¨main.goä¸­çmainæ¹æ³ä¸è°ç¨ä¸é¢çInitTransæ¹æ³æ¥åå§åç¿»è¯åå®¹ã\n\nåå°loginæ¹æ³ä¸­ShouldBindJSONè¿åçerrorè½¬ævalidator.ValidationErrorsç±»åï¼è¯¥ç±»ååå«ä¸ä¸ªTranslateæ¹æ³ï¼è°ç¨è¯¥æ¹æ³ï¼åå°ä¹åçå¨å±åéTransä¼ å¥ã\n\nfunc login(c *gin.Context) {\n\n\tvar user User\n\tif err := c.ShouldBindJSON(&user); err != nil {\n\n\t\terrs, ok := err.(validator.ValidationErrors)\n\t\tif !ok {\n\t\t\t// éæ ¡éªéè¯¯ï¼å¶ä»éè¯¯ç´æ¥è¿å\n\t\t\tc.JSON(http.StatusOK, gin.H{"msg": err.Error()})\n\t\t\treturn\n\t\t}\n\n\t\tc.JSON(http.StatusOK, gin.H{"msg": errs.Translate(global.Trans)})\n\t\treturn\n\t}\n\n\tif user.UserName != "admin" || user.Password != "123456" {\n\t\tc.JSON(http.StatusUnauthorized, gin.H{"msg": "unauthorized"})\n\t\treturn\n\t}\n\n\tc.JSON(http.StatusOK, gin.H{"msg": "you are logged in"})\n}\n\nfunc main() {\n\terr := initialize.InitTrans("zh")\n\tif err != nil {\n\t\tfmt.Printf("åå§åç¿»è¯å¨éè¯¯, err = %s", err.Error())\n\t\treturn\n\t}\n\n\tr := gin.Default()\n\tr.POST("/login", login)\n\tr.Run() // çå¬å¹¶å¨ 0.0.0.0:8080 ä¸å¯å¨æå¡\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\næä»¬åä½¿ç¨ä»å¸¦æusernameå­æ®µå»è¯·æ±loginæ¥å£ï¼è¾åºåå®¹å¦ä¸ã\n\n{\'msg\': {\'User.Password\': \'Passwordä¸ºå¿å¡«å­æ®µ\'}}\n\n\n1\n\n\nä½æ¯ï¼åç°æç¤ºä¿¡æ¯çkeyæ¯User.Passwordï¼æ¯è¡¨åå¯¹è±¡åå¶å­æ®µåç§°ï¼æä»¬åºè¯¥æ³è¦çæ¯ï¼\n\n{\'msg\': {\'password\': \'Passwordä¸ºå¿å¡«å­æ®µ\'}}\n\n\n1\n\n\n\n# ä¼åè¿åå­æ®µçkey\n\næä»¬ä¿®æ¹InitTransæ¹æ³ï¼éè¿go-playgroundæä¾çæ¹æ³RegisterTagNameFuncæ¥å°æä»¬èªå®ä¹çæ¹æ³æ³¨åè¿å»ï¼è¯¥èªå®ä¹æ¹æ³çç®çæ¯ä¿®æ¹ä¸é¢çPasswordæ¹ä¸ºjsonä¸­çpasswordï¼å¯ä»¥æ¹æjsonæ ç­¾ä¸­çå¼ä½ä¸ºè¿åã\n\nfunc InitTrans(locale string) (err error) {\n\n\tif v, ok := binding.Validator.Engine().(*validator.Validate); ok {\n\n\t\t//ä¿®æ¹è¿åå­æ®µkeyçæ ¼å¼\n\t\tv.RegisterTagNameFunc(func(fld reflect.StructField) string {\n\t\t\tname := strings.SplitN(fld.Tag.Get("json"), ",", 2)[0]\n\t\t\tif name == "-" {\n\t\t\t\treturn ""\n\t\t\t}\n\t\t\treturn name\n\t\t})\n\n\t\t// ç¿»è¯\n\t\tzhT := zh.New()\n\t\tenT := en.New()\n\t\tuni := ut.New(enT, zhT, enT)\n\n\t\tglobal.Trans, ok = uni.GetTranslator(locale)\n\t\tif !ok {\n\t\t\treturn fmt.Errorf("uni.GetTranslator(%s) error", locale)\n\t\t}\n\n\t\tswitch locale {\n\t\tcase "zh":\n\t\t\tzh_translations.RegisterDefaultTranslations(v, global.Trans)\n\t\tcase "en":\n\t\t\ten_translations.RegisterDefaultTranslations(v, global.Trans)\n\t\tdefault:\n\t\t\ten_translations.RegisterDefaultTranslations(v, global.Trans)\n\t\t}\n\n\t\treturn\n\t}\n\treturn\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n\nåè¯·æ±ï¼ååºå¦ä¸ï¼åç°passwordå·²ç»æ¹å¥½äºï¼ä½æ¯Userä¹æ³å é¤ã\n\n{\'msg\': {\'User.password\': \'passwordä¸ºå¿å¡«å­æ®µ\'}}\n\n\n1\n\n\næä»¬å¨utils/validator.goæä»¶ä¸­ç¼åä»£ç å¦ä¸ï¼è¯¥æ¹æ³æ¯ç¨æ¥å é¤Userçã\n\nfunc RemoveTopStruct(fields map[string]string) map[string]string {\n\tres := map[string]string{}\n\tfor field, err := range fields {\n\t\tres[field[strings.Index(field, ".")+1:]] = err\n\t}\n\treturn res\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nåå¨ç¿»è¯è¿åçéè¯¯ä¿¡æ¯åä¸è¯¥æ¹æ³ã\n\nfunc login(c *gin.Context) {\n\n\tvar user User\n\tif err := c.ShouldBindJSON(&user); err != nil {\n\n\t\terrs, ok := err.(validator.ValidationErrors)\n\t\tif !ok {\n\t\t\t// éæ ¡éªéè¯¯ï¼å¶ä»éè¯¯ç´æ¥è¿å\n\t\t\tc.JSON(http.StatusOK, gin.H{"msg": err.Error()})\n\t\t\treturn\n\t\t}\n\n\t\tc.JSON(http.StatusOK, gin.H{"msg": utils.RemoveTopStruct(errs.Translate(global.Trans))})\n\t\treturn\n\t}\n\n\tif user.UserName != "admin" || user.Password != "123456" {\n\t\tc.JSON(http.StatusUnauthorized, gin.H{"msg": "unauthorized"})\n\t\treturn\n\t}\n\n\tc.JSON(http.StatusOK, gin.H{"msg": "you are logged in"})\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nåæ§è¡ï¼ç¸åºç»æå¦ä¸ï¼è¿ä¸ªå°±æ¯æä»¬æ³è¦çä¿¡æ¯ã\n\n{\'msg\': {\'password\': \'passwordä¸ºå¿å¡«å­æ®µ\'}}\n\n\n1\n\n\n\n# æ»ç»\n\nä¸ªäººè§çè½ç¶ginçµæ´»å°å·§ï¼ä½æ¯åè½ççå¾ä¸å®åãæ¯æ¬¡ä¸æ¬¡è¾åºåå¥½ä¿¡æ¯ï¼æä»¬é½è¦æå¨è°ç¨Translateæ¥ç¿»è¯ï¼å¹¶ä¸è¿éè¦éè¿RemoveTopStructæ¹æ³æ¥ä¿®æ¹è¿åçä¿¡æ¯ï¼æç®åçæ¥è¯´ï¼åºè¯¥ç±æ¡æ¶æ¥åï¼æä»¬åªéè¦éè¿éç½®ï¼å°±è½èªå¨è¾åºæä»¬æ³è¦çåå¥½æç¤ºä¿¡æ¯æå¯¹ã',normalizedContent:'# ç¸å³é¾æ¥\n\nginå®æ¹ä¾å­\n\næç« çä»£ç \n\n\n# ç®åä½¿ç¨è¡¨åæ£éªè¯·æ±åæ°\n\nåå»ºä¸ä¸ªç®åçç»å½ä¾å­ï¼æä»¬å¯¹usernameåpasswordç»å®äºrequiredæ ç­¾ï¼ä»£è¡¨çè¯·æ±loginæ¥å£çåæ°ä¸­å¿é¡»åå«è¿ä¸¤ä¸ªå­æ®µã\n\ntype user struct {\n\tusername string `json:"username" binding:"required"`\n\tpassword string `json:"password" binding:"required"`\n}\n\nfunc login(c *gin.context) {\n\n\tvar user user\n\tif err := c.shouldbindjson(&user); err != nil {\n\t\tc.json(http.statusok, gin.h{"msg": err.error()})\n\t\treturn\n\t}\n\n\tif user.username != "admin" || user.password != "123456" {\n\t\tc.json(http.statusunauthorized, gin.h{"msg": "unauthorized"})\n\t\treturn\n\t}\n\n\tc.json(http.statusok, gin.h{"msg": "you are logged in"})\n}\n\nfunc main() {\n\tr := gin.default()\n\tr.post("/login", login)\n\tr.run() // çå¬å¹¶å¨ 0.0.0.0:8080 ä¸å¯å¨æå¡\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\næä»¬ä½¿ç¨ä»å¸¦æusernameå»è¯·æ±loginæ¥å£ï¼ä¼è¾åºå¦ä¸ï¼æç¤ºæä»¬passwordæ ¡éªå¤±è´¥äºï¼å ä¸ºrequiredçæ ç­¾å¯¼è´çãä½æ¯è¿ä¸ªæç¤ºå¹¶ä¸åå¥½ï¼æä»¬éè¦è¿è¡ä¼åå±ç¤ºã\n\n{\'msg\': "key: \'user.password\' error:field validation for \'password\' failed on the \'required\' tag"}\n\n\n1\n\n\n\n# ç¿»è¯\n\næä»¬éè¦å¯¹ä¸é¢çæç¤ºä¿¡æ¯è¿è¡ä¸ä¸ªç¿»è¯ï¼å¹¶ä¸å¯ä»¥æ¯æåç§è¯­è¨çåå¥½æ§æç¤ºã\n\næä»¬å¨global/global.goæä»¶ä¸­åå»ºä¸ä¸ªå¨å±åéï¼è¯¥å¨å±åéå¨åé¢çè¡¨åç¿»è¯ä¸­éè¦ä½¿ç¨å°\n\nimport ut "github.com/go-playground/universal-translator"\n\nvar (\n\ttrans ut.translator\n)\n\n\n1\n2\n3\n4\n5\n\n\nå¨initialize/validator.goæä»¶ä¸­ç¼ååå®¹å¦ä¸ï¼è·åginä¸­çvalidateå¯¹è±¡ï¼ç¶åç»è¯¥å¯¹è±¡ç»å®ä¸­æåè±æçåå¥½æç¤ºä¿¡æ¯ï¼æä»¬å¯ä»¥éè¿localeæ¥è®¾ç½®æä»¬éè¦ä½¿ç¨ä¸­æè¿æ¯è±æçä¿¡æ¯ã\n\nfunc inittrans(locale string) (err error) {\n\n\tif v, ok := binding.validator.engine().(*validator.validate); ok {\n\n\t\t// ç¿»è¯\n\t\tzht := zh.new()\n\t\tent := en.new()\n\t\tuni := ut.new(ent, zht, ent)\n\n\t\tglobal.trans, ok = uni.gettranslator(locale)\n\t\tif !ok {\n\t\t\treturn fmt.errorf("uni.gettranslator(%s) error", locale)\n\t\t}\n\n\t\tswitch locale {\n\t\tcase "zh":\n\t\t\tzh_translations.registerdefaulttranslations(v, global.trans)\n\t\tcase "en":\n\t\t\ten_translations.registerdefaulttranslations(v, global.trans)\n\t\tdefault:\n\t\t\ten_translations.registerdefaulttranslations(v, global.trans)\n\t\t}\n\n\t\treturn\n\t}\n\treturn\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\næåå¨main.goä¸­çmainæ¹æ³ä¸è°ç¨ä¸é¢çinittransæ¹æ³æ¥åå§åç¿»è¯åå®¹ã\n\nåå°loginæ¹æ³ä¸­shouldbindjsonè¿åçerrorè½¬ævalidator.validationerrorsç±»åï¼è¯¥ç±»ååå«ä¸ä¸ªtranslateæ¹æ³ï¼è°ç¨è¯¥æ¹æ³ï¼åå°ä¹åçå¨å±åétransä¼ å¥ã\n\nfunc login(c *gin.context) {\n\n\tvar user user\n\tif err := c.shouldbindjson(&user); err != nil {\n\n\t\terrs, ok := err.(validator.validationerrors)\n\t\tif !ok {\n\t\t\t// éæ ¡éªéè¯¯ï¼å¶ä»éè¯¯ç´æ¥è¿å\n\t\t\tc.json(http.statusok, gin.h{"msg": err.error()})\n\t\t\treturn\n\t\t}\n\n\t\tc.json(http.statusok, gin.h{"msg": errs.translate(global.trans)})\n\t\treturn\n\t}\n\n\tif user.username != "admin" || user.password != "123456" {\n\t\tc.json(http.statusunauthorized, gin.h{"msg": "unauthorized"})\n\t\treturn\n\t}\n\n\tc.json(http.statusok, gin.h{"msg": "you are logged in"})\n}\n\nfunc main() {\n\terr := initialize.inittrans("zh")\n\tif err != nil {\n\t\tfmt.printf("åå§åç¿»è¯å¨éè¯¯, err = %s", err.error())\n\t\treturn\n\t}\n\n\tr := gin.default()\n\tr.post("/login", login)\n\tr.run() // çå¬å¹¶å¨ 0.0.0.0:8080 ä¸å¯å¨æå¡\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\næä»¬åä½¿ç¨ä»å¸¦æusernameå­æ®µå»è¯·æ±loginæ¥å£ï¼è¾åºåå®¹å¦ä¸ã\n\n{\'msg\': {\'user.password\': \'passwordä¸ºå¿å¡«å­æ®µ\'}}\n\n\n1\n\n\nä½æ¯ï¼åç°æç¤ºä¿¡æ¯çkeyæ¯user.passwordï¼æ¯è¡¨åå¯¹è±¡åå¶å­æ®µåç§°ï¼æä»¬åºè¯¥æ³è¦çæ¯ï¼\n\n{\'msg\': {\'password\': \'passwordä¸ºå¿å¡«å­æ®µ\'}}\n\n\n1\n\n\n\n# ä¼åè¿åå­æ®µçkey\n\næä»¬ä¿®æ¹inittransæ¹æ³ï¼éè¿go-playgroundæä¾çæ¹æ³registertagnamefuncæ¥å°æä»¬èªå®ä¹çæ¹æ³æ³¨åè¿å»ï¼è¯¥èªå®ä¹æ¹æ³çç®çæ¯ä¿®æ¹ä¸é¢çpasswordæ¹ä¸ºjsonä¸­çpasswordï¼å¯ä»¥æ¹æjsonæ ç­¾ä¸­çå¼ä½ä¸ºè¿åã\n\nfunc inittrans(locale string) (err error) {\n\n\tif v, ok := binding.validator.engine().(*validator.validate); ok {\n\n\t\t//ä¿®æ¹è¿åå­æ®µkeyçæ ¼å¼\n\t\tv.registertagnamefunc(func(fld reflect.structfield) string {\n\t\t\tname := strings.splitn(fld.tag.get("json"), ",", 2)[0]\n\t\t\tif name == "-" {\n\t\t\t\treturn ""\n\t\t\t}\n\t\t\treturn name\n\t\t})\n\n\t\t// ç¿»è¯\n\t\tzht := zh.new()\n\t\tent := en.new()\n\t\tuni := ut.new(ent, zht, ent)\n\n\t\tglobal.trans, ok = uni.gettranslator(locale)\n\t\tif !ok {\n\t\t\treturn fmt.errorf("uni.gettranslator(%s) error", locale)\n\t\t}\n\n\t\tswitch locale {\n\t\tcase "zh":\n\t\t\tzh_translations.registerdefaulttranslations(v, global.trans)\n\t\tcase "en":\n\t\t\ten_translations.registerdefaulttranslations(v, global.trans)\n\t\tdefault:\n\t\t\ten_translations.registerdefaulttranslations(v, global.trans)\n\t\t}\n\n\t\treturn\n\t}\n\treturn\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n\nåè¯·æ±ï¼ååºå¦ä¸ï¼åç°passwordå·²ç»æ¹å¥½äºï¼ä½æ¯userä¹æ³å é¤ã\n\n{\'msg\': {\'user.password\': \'passwordä¸ºå¿å¡«å­æ®µ\'}}\n\n\n1\n\n\næä»¬å¨utils/validator.goæä»¶ä¸­ç¼åä»£ç å¦ä¸ï¼è¯¥æ¹æ³æ¯ç¨æ¥å é¤userçã\n\nfunc removetopstruct(fields map[string]string) map[string]string {\n\tres := map[string]string{}\n\tfor field, err := range fields {\n\t\tres[field[strings.index(field, ".")+1:]] = err\n\t}\n\treturn res\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nåå¨ç¿»è¯è¿åçéè¯¯ä¿¡æ¯åä¸è¯¥æ¹æ³ã\n\nfunc login(c *gin.context) {\n\n\tvar user user\n\tif err := c.shouldbindjson(&user); err != nil {\n\n\t\terrs, ok := err.(validator.validationerrors)\n\t\tif !ok {\n\t\t\t// éæ ¡éªéè¯¯ï¼å¶ä»éè¯¯ç´æ¥è¿å\n\t\t\tc.json(http.statusok, gin.h{"msg": err.error()})\n\t\t\treturn\n\t\t}\n\n\t\tc.json(http.statusok, gin.h{"msg": utils.removetopstruct(errs.translate(global.trans))})\n\t\treturn\n\t}\n\n\tif user.username != "admin" || user.password != "123456" {\n\t\tc.json(http.statusunauthorized, gin.h{"msg": "unauthorized"})\n\t\treturn\n\t}\n\n\tc.json(http.statusok, gin.h{"msg": "you are logged in"})\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nåæ§è¡ï¼ç¸åºç»æå¦ä¸ï¼è¿ä¸ªå°±æ¯æä»¬æ³è¦çä¿¡æ¯ã\n\n{\'msg\': {\'password\': \'passwordä¸ºå¿å¡«å­æ®µ\'}}\n\n\n1\n\n\n\n# æ»ç»\n\nä¸ªäººè§çè½ç¶ginçµæ´»å°å·§ï¼ä½æ¯åè½ççå¾ä¸å®åãæ¯æ¬¡ä¸æ¬¡è¾åºåå¥½ä¿¡æ¯ï¼æä»¬é½è¦æå¨è°ç¨translateæ¥ç¿»è¯ï¼å¹¶ä¸è¿éè¦éè¿removetopstructæ¹æ³æ¥ä¿®æ¹è¿åçä¿¡æ¯ï¼æç®åçæ¥è¯´ï¼åºè¯¥ç±æ¡æ¶æ¥åï¼æä»¬åªéè¦éè¿éç½®ï¼å°±è½èªå¨è¾åºæä»¬æ³è¦çåå¥½æç¤ºä¿¡æ¯æå¯¹ã',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"goä¸­å¦ä½å¤çerror",frontmatter:{title:"goä¸­å¦ä½å¤çerror",date:"2022-11-14T10:11:11.000Z",permalink:"/pages/d93df5/",tags:["go"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"å¨ go ä¸­æ panic çæºå¶ï¼ä½ panic æå³çç¨åºç»æ­¢ï¼ä»£ç ä¸è½ç»§ç»­è¿è¡äºï¼ä¸è½ææè°ç¨èæ¥è§£å³å®ãè error æ¯é¢æä¸­çå¼å¸¸ï¼å¸æè°ç¨èå¯ä»¥å¯¹å¶è¿è¡å¤ççã",categories:["ç¼ç¨","go"],comment:!0,feed:{enable:!0},meta:[{name:"twitter:title",content:"goä¸­å¦ä½å¤çerror"},{name:"twitter:description",content:"å¨ go ä¸­æ panic çæºå¶ï¼ä½ panic æå³çç¨åºç»æ­¢ï¼ä»£ç ä¸è½ç»§ç»­è¿è¡äºï¼ä¸è½ææè°ç¨èæ¥è§£å³å®ãè error æ¯é¢æä¸­çå¼å¸¸ï¼å¸æè°ç¨èå¯ä»¥å¯¹å¶è¿è¡å¤ççã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/02.go/04.go%E4%B8%AD%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86error.html"},{property:"og:type",content:"article"},{property:"og:title",content:"goä¸­å¦ä½å¤çerror"},{property:"og:description",content:"å¨ go ä¸­æ panic çæºå¶ï¼ä½ panic æå³çç¨åºç»æ­¢ï¼ä»£ç ä¸è½ç»§ç»­è¿è¡äºï¼ä¸è½ææè°ç¨èæ¥è§£å³å®ãè error æ¯é¢æä¸­çå¼å¸¸ï¼å¸æè°ç¨èå¯ä»¥å¯¹å¶è¿è¡å¤ççã"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/02.go/04.go%E4%B8%AD%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86error.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-11-14T10:11:11.000Z"},{property:"article:tag",content:"go"},{itemprop:"name",content:"goä¸­å¦ä½å¤çerror"},{itemprop:"description",content:"å¨ go ä¸­æ panic çæºå¶ï¼ä½ panic æå³çç¨åºç»æ­¢ï¼ä»£ç ä¸è½ç»§ç»­è¿è¡äºï¼ä¸è½ææè°ç¨èæ¥è§£å³å®ãè error æ¯é¢æä¸­çå¼å¸¸ï¼å¸æè°ç¨èå¯ä»¥å¯¹å¶è¿è¡å¤ççã"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/02.go/04.go%E4%B8%AD%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86error.html",relativePath:"04.ç¼ç¨/02.go/04.goä¸­å¦ä½å¤çerror.md",key:"v-fdcf4762",path:"/pages/d93df5/",headers:[{level:2,title:"0. åè¨",slug:"_0-åè¨",normalizedTitle:"0. åè¨",charIndex:2},{level:2,title:"1. error æ¯ä»ä¹ï¼",slug:"_1-error-æ¯ä»ä¹",normalizedTitle:"1. error æ¯ä»ä¹ï¼",charIndex:195},{level:2,title:"2. éè¯¯ç±»å",slug:"_2-éè¯¯ç±»å",normalizedTitle:"2. éè¯¯ç±»å",charIndex:1465},{level:3,title:"2.1 Sentinel Error(é¢å®ä¹éè¯¯)",slug:"_2-1-sentinel-error-é¢å®ä¹éè¯¯",normalizedTitle:"2.1 sentinel error(é¢å®ä¹éè¯¯)",charIndex:1477},{level:3,title:"2.2 Error types(èªå®ä¹éç±»å)",slug:"_2-2-error-types-èªå®ä¹éç±»å",normalizedTitle:"2.2 error types(èªå®ä¹éç±»å)",charIndex:2033},{level:3,title:"2.3 Opaque errors(ä¸éæçéè¯¯)",slug:"_2-3-opaque-errors-ä¸éæçéè¯¯",normalizedTitle:"2.3 opaque errors(ä¸éæçéè¯¯)",charIndex:3015},{level:2,title:"3. ä¼éçå¤çéè¯¯",slug:"_3-ä¼éçå¤çéè¯¯",normalizedTitle:"3. ä¼éçå¤çéè¯¯",charIndex:3513},{level:3,title:"3.1 æ éè¯¯çæ­£å¸¸æµç¨ä»£ç ",slug:"_3-1-æ éè¯¯çæ­£å¸¸æµç¨ä»£ç ",normalizedTitle:"3.1 æ éè¯¯çæ­£å¸¸æµç¨ä»£ç ",charIndex:3528},{level:3,title:"3.2 åå°ä¸å¿è¦çå¤æ­",slug:"_3-2-åå°ä¸å¿è¦çå¤æ­",normalizedTitle:"3.2 åå°ä¸å¿è¦çå¤æ­",charIndex:3794},{level:3,title:"3.3 å° error åé¨å­å¨èµ·æ¥",slug:"_3-3-å°-error-åé¨å­å¨èµ·æ¥",normalizedTitle:"3.3 å° error åé¨å­å¨èµ·æ¥",charIndex:4059},{level:3,title:"3.4 å°éå¤æä½æ½ç¦»åºæ¥",slug:"_3-4-å°éå¤æä½æ½ç¦»åºæ¥",normalizedTitle:"3.4 å°éå¤æä½æ½ç¦»åºæ¥",charIndex:4865},{level:2,title:"4. Wrap erros",slug:"_4-wrap-erros",normalizedTitle:"4. wrap erros",charIndex:6248},{level:2,title:"5. pkg/errors",slug:"_5-pkg-errors",normalizedTitle:"5. pkg/errors",charIndex:8186},{level:2,title:"6. error çæä½³å®è·µ",slug:"_6-error-çæä½³å®è·µ",normalizedTitle:"6. error çæä½³å®è·µ",charIndex:9741},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:10492}],headersStr:"0. åè¨ 1. error æ¯ä»ä¹ï¼ 2. éè¯¯ç±»å 2.1 Sentinel Error(é¢å®ä¹éè¯¯) 2.2 Error types(èªå®ä¹éç±»å) 2.3 Opaque errors(ä¸éæçéè¯¯) 3. ä¼éçå¤çéè¯¯ 3.1 æ éè¯¯çæ­£å¸¸æµç¨ä»£ç  3.2 åå°ä¸å¿è¦çå¤æ­ 3.3 å° error åé¨å­å¨èµ·æ¥ 3.4 å°éå¤æä½æ½ç¦»åºæ¥ 4. Wrap erros 5. pkg/errors 6. error çæä½³å®è·µ åèèµæ",content:'# 0. åè¨\n\ngo ä¸­çå¼å¸¸å¤çåå¶ä»è¯­è¨å¤§ä¸ç¸åï¼å JavaãC++ãpython ç­è¯­è¨é½æ¯éè¿æåº Exception æ¥å¤çå¼å¸¸ï¼è go æ¯éè¿è¿å error æ¥å¤å®å¼å¸¸ï¼å¹¶è¿è¡å¤çã\n\nå¨ go ä¸­æ panic çæºå¶ï¼ä½ panic æå³çç¨åºç»æ­¢ï¼ä»£ç ä¸è½ç»§ç»­è¿è¡äºï¼ä¸è½ææè°ç¨èæ¥è§£å³å®ãè error æ¯é¢æä¸­çå¼å¸¸ï¼å¸æè°ç¨èå¯ä»¥å¯¹å¶è¿è¡å¤ççã\n\n\n# 1. error æ¯ä»ä¹ï¼\n\nä¸¾ä¸ªä¾å­ï¼ä½¿ç¨ Open æ¥æå¼æä»¶ï¼ä½æ¯å¯è½è¯¥è·¯å¾çæä»¶ä¸å­å¨ï¼åºç°å¼å¸¸ï¼å¨ go æ¯éè¿å¤æ­ err æ¯å¦ä¸º nil æ¥å¤å®æå¼æä»¶æ¯å¦æåã\n\nf, err := os.Open(path)\nif err != nil {\n    // handle error\n}\n\n// do stuff\n\n\n1\n2\n3\n4\n5\n6\n\n\né®é¢æ¥äºï¼error æ¯ä»ä¹ï¼\n\næ¥çæºç ä¼åç°ï¼error æ¯ä¸ä¸ªåå« Error æ¹æ³çæ¥å£ï¼è¿åçæ¯å®ç°äºè¯¥æ¥å£çå¯¹è±¡ã\n\ntype error interface {  \n   Error() string  \n}\n\n\n1\n2\n3\n\n\næä»¬ä¸è¬ä½¿ç¨æ¯éè¿ errors.New()æ¥è¿åä¸ä¸ªå®ç°äº error æ¥å£çå¯¹è±¡ãè¿ä¸ªå¯¹è±¡æ¯ä¸ä¸ªåå«äºå­ç¬¦ä¸²çç»æä½ï¼ç¶åå¯ä»¥éè¿ Error æ¹æ³æ¥è·åå­ç¬¦ä¸²ã\n\nfunc New(text string) error {  \n   return &errorString{text}  \n}  \n  \n// errorString is a trivial implementation of error.\ntype errorString struct {  \n   s string  \n}  \n  \nfunc (e *errorString) Error() string {  \n   return e.s  \n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næä»¬å¯ä»¥æ³¨æå° New æ¹æ³è¿åçæ¯ errorString çå°åï¼ä¹å°±æ¯è¯´ï¼å¨æä»¬å°ä¸¤ä¸ª error æ¯è¾ç¸ç­æ¶ï¼æ¯è¾æ¯å°åï¼æ¯ä¸¤ä¸ª error æ¯å¦ä¸ºåä¸ä¸ªå¯¹è±¡ï¼èä¸æ¯å¶ä¸­çéè¯¯å­ç¬¦ä¸²ã\n\nimport (\n\t"errors"\n\t"fmt"\n)\n\ntype errorString string\n\nfunc (e errorString) Error() string {\n\treturn string(e)\n}\n\nfunc New(text string) error {\n\treturn errorString(text)\n}\n\nvar ErrNamedType = New("EOF")\nvar ErrStructType = errors.New("EOF")\n\nfunc main() {\n\n\tif ErrNamedType == New("EOF") {\n\t\tfmt.Println("Named Type Error")\n\t}\n\n\tif ErrStructType == errors.New("EOF") {\n\t\tfmt.Println("Struct Type Error")\n\t}\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nè¾åºï¼\n\nNamed Type Error\n\n\n1\n\n\n\n# 2. éè¯¯ç±»å\n\n\n# 2.1 Sentinel Error(é¢å®ä¹éè¯¯)\n\nå¶å®å°±æ¯åé¢å®ä¹ä¸äºå¯ä»¥é¢æä¸­çéè¯¯ï¼å¨ä½¿ç¨è¿ç¨ä¸­ï¼éè¿å¤æ­ error æ¯å±äºåªä¸ç§ error å¹¶è¿è¡å¯¹åºçå¤çã\n\nä¸¾ä¸ªæ å­ï¼å¨ io.EOF å°±æ¯ä¸ä¸ªé¢å®ä¹çéè¯¯ï¼å®æ¯è¡¨ç¤ºè¾å¥æµä¸­çç»å°¾ã\n\nvar EOF = errors.New("EOF")\n\n\n1\n\n\nå¨ä»æµä¸­è¯»åå­ç¬¦çæ¶åï¼ä¼éè¿å¤æ­ error æ¯å¦ç­äº io.EOF æ¥å¤å®æ¯å¦è¯»å®ãæ³¨æè¿éæ¯å¤æ­ error çæéæ¯å¦ç¸ç­ã\n\nn, err := reader.Read(p)  \nif err != nil {  \n   if err == io.EOF {  \n      fmt.Println("The resource is read!")  \n      break  \n   }  \n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¿ç§æ¹å¼ä¸å»ºè®®ä½¿ç¨ï¼åå æ¯ï¼\n\n * å®ä¼æä¸ºä½  API çå¬å±é¨å\n\nå ä¸ºå¬å±å½æ°éè¦è¿åä¸ä¸ªåºå®ç errorï¼é£ä¹è¿ä¸ª error å°±å¿é¡»æ¯å¬å¼çï¼é£ä¹å°±éè¦ææ¡£è®°å½ï¼è¿ä¼å¢å  API çè¡¨é¢ç§¯ã\n\n * å¢å è°ç¨èçè¦åæ§\n\nè°ç¨èå¿é¡»è¦ç¥é io.EOF è¿ä¸ª error ï¼å¹¶å¨è°ç¨çå°æ¹ä½¿ç¨è¯¥ error å¤æ­æ¯å¦ç»æã\n\n\n# 2.2 Error types(èªå®ä¹éç±»å)\n\néè¿å®ç° error æ¥å£æ¥åå»ºèªå®ä¹éè¯¯ç±»åãå Sentinel Error ç¸æ¯ï¼æ¯éè¿å¤æ­ç±»åæ¥ç¥éæ¯åªç§éè¯¯ï¼å¹¶ä¸å¯ä»¥è¾åºæ´å¤çä¸ä¸æéè¯¯ä¿¡æ¯ã\n\néè¿èªå®ä¹ MyErrorï¼å¹¶å®ç° error æ¥å£ä¸­ç Error çæ¹æ³ã\n\ntype MyError struct {\n\tMsg  string\n\tFile string\n\tLine int\n}\n\nfunc (e *MyError) Error() string {\n\treturn fmt.Sprintf("%s:%d: %s", e.File, e.Line, e.Msg)\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\ntest æ¹æ³ä¸­è¿åçæ¯èªå®ä¹ç errorï¼æä»¬éè¿æ­è¨è½¬æ¢ error æ MyError ç±»åï¼ç¶ååè¾åºæ´å¤çä¸ä¸æä¿¡æ¯ã\n\nfunc test() error {\n\treturn &MyError{"Something happened", "server.go", 42}\n}\n\nfunc main() {\n\terr := test()\n\tswitch err := err.(type) {\n\tcase nil:\n\t\t// success\n\tcase *MyError:\n\t\tfmt.Println("error occured on line:", err.Line)\n\tdefault:\n\t\t// unknown error\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå¨æ ååº os.PathError ä¸­ï¼èªå®ä¹äº PathError ï¼ä¹æ¯ç¸åçç¨æ³ã\n\ntype PathError struct {\n\tOp   string\n\tPath string\n\tErr  error\n}\n\nfunc (e *PathError) Error() string { return e.Op + " " + e.Path + ": " + e.Err.Error() }\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næä»¬ä¹å°½å¯è½é¿åä½¿ç¨ Error typesï¼å ä¸ºå®å Sentinel Erorr ä¸æ ·ä¼åè°ç¨èäº§çè¦åï¼ä¼ä½ä¸º API çä¸é¨åã\n\n\n# 2.3 Opaque errors(ä¸éæçéè¯¯)\n\nError types æ¯éè¿å¤æ­ error çç±»åæ¥èµ°ä¸åçé»è¾ï¼è Opaque errors æ¯éè¿å¤æ­ error çè¡ä¸ºæ¥èµ°ä¸åçé»è¾ã\n\nå¨ net.Error ä¸­å®ä¹å¦ä¸ï¼é¤äºåå« error å¤ï¼è¿åå« Timeout å Temporary æ¹æ³ã\n\ntype Error interface {\n\terror\n\tTimeout() bool \n\tTemporary() bool\n}\n\n\n1\n2\n3\n4\n5\n\n\né¤äºå¤æ­æ¯å¦æ error ä¹å¤ï¼è¿å¯ä»¥éè¿æ¹æ³æ¥å¤æ­æ¯åªç§ç±»åç error ç¶åè¿è¡å¯¹åºçå¤çã\n\nif netErr, ok := err.(net.Error); ok && netErr.Timeout() {\n\treturn false\n}\n\nif netErr, ok := err.(net.Error); ok && netErr.Temporary() {\n\treturn false\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå®ä¸æ¯æ©å± error æ´å¤çä¿¡æ¯ï¼èæ¯æ©å±å¶æ¹æ³ã\n\n\n# 3. ä¼éçå¤çéè¯¯\n\n\n# 3.1 æ éè¯¯çæ­£å¸¸æµç¨ä»£ç \n\næ éè¯¯çæ­£å¸¸æµç¨ä»£ç ï¼å°æä¸ºä¸æ¡ç´çº¿ï¼èä¸æ¯ç¼©è¿çä»£ç ã\n\néè¯¯çåæ³ï¼\n\n// no\nf, err := os.Open(path)\nif err == nil {\n    // do stuff\n}\n\n// handle error\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næ­£ç¡®çåæ³ï¼\n\n// ok\nf, err := os.Open(path)\nif err != nil {\n    // handle error\n}\n\n// do stuff\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 3.2 åå°ä¸å¿è¦çå¤æ­\n\nfunc AuthenticateRequest(r *Request) error {\n    err := authenticate(r.User)\n    err != nil {\n        return err\n    }\n    return nil\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næ¹ä¸ºï¼\n\nfunc AuthenticateRequest(r *Request) error {\n    return authenticate(r.User)\n}\n\n\n1\n2\n3\n\n\n\n# 3.3 å° error åé¨å­å¨èµ·æ¥\n\nerr å¨åé¨ä¸´æ¶å¨å­ï¼å¨æåå¨è¿ååºæ¥ã\n\nä¸é¢ä¾å­ä¸­ï¼éè¿å¾ªç¯è¯» reader æ¯ä¸è¡çæ°æ®ï¼æ¯æ¬¡å¤æ­ err æ¯ä¸æ¯ nil æ¥å¤æ­æ¯å¦è¯»å®ï¼å¦ææ¯åéåºå¾ªç¯ï¼åè¿åã\n\nfunc CountLines(r io.Reader)  (int, error) {\n\tvar (\n\t\tbr = bufio.NewReader(r)\n\t\tlines int\n\t\terr error\n\t)\n\n\tfor {\n\t\t_, err = br.ReadString(\'\\n\')\n\t\tlines++\n\t\tif err != nil {\n\t\t\tbreak\n\t\t}\n\t}\n\n\tif err != io.EOF {\n\t\treturn 0, err\n\t}\n\n\treturn lines, nil\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\næ¹è¿çæ¬ï¼\n\ntype Scanner struct {\n\terr          error     // Sticky error.\n\t...\n}\n\nfunc CountLines(r io.Reader)  (int, error) {\n\tsc := bufio.NewScanner(r)\n\tlines := 0\n\n\tfor sc.Scan() {\n\t\tlines++\n\t}\n\n\treturn lines, sc.Err()\n}\n\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\næ¯æ¬¡å¾ªç¯é½ä¼å¤æ­ Scan çè¿åå¼ï¼å½æ åå®¹è¿åæ¶ï¼åä¼è¿å Falseï¼åç»æå¾ªç¯ï¼å¹¶è¿åç»æãå¾ªç¯ä¸­åºç°ç error ä¼å¨ Scan ä¸­éè¿ s.setErr(err) ä¿å­å¨å¯¹è±¡ç err å±æ§ä¸­ã\n\nä»£ç ææ¾ç®æ´äºè®¸å¤ã\n\n\n# 3.4 å°éå¤æä½æ½ç¦»åºæ¥\n\nççä¸é¢çä»£ç ï¼éé¢å¤æ¬¡ä½¿ç¨ fmt.Fprintf()å¹¶å¤æ­å¶è¿åå¼æ¯å¦ä¸º err\n\ntype Header struct {\n\tKey, Value string\n}\n\ntype Status struct {\n\tCode   int\n\tReason string\n}\n\nfunc WriteResponse(w io.Writer, st Status, headers []Header, body io.Reader) error {\n\t_, err := fmt.Fprintf(w, "HTTP/1.1 %d %s\\r\\n", st.Code, st.Reason)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tfor _, h := range headers {\n\t\t_, err := fmt.Fprintf(w, "%s: %s\\r\\n", h.Key, h.Value)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t}\n\n\tif _, err := fmt.Fprintf(w, "\\r\\n"); err != nil {\n\t\treturn err\n\t}\n\n\t_, err = io.Copy(w, body)\n\treturn err\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\næä»¬åå»ºä¸ä¸ª errWrite ç»æä½å¹¶å®ç° Write æ¹æ³ï¼ä¹å°±æ¯å¨åæ¥ç write æ¹æ³ä¸­åäºä¸å±å¹¶åå¥½éè¯¯å¤æ­ï¼ç¶åå¨æ¯ä¸ä¸ª fmt.Fprintf ä½¿ç¨æä»¬å®ä¹ç errWrite è¿è¡åå¥ï¼è¿æ ·å°±è¾¾å°äºå¤ç¨çææï¼ä»£ç ä¹å¥½çäºè®¸å¤ã\n\ntype errWrite struct {\n\tio.Writer\n\terr error\n}\n\nfunc (e *errWrite) Write(buf []byte) (int, error) {\n\tif e.err != nil {\n\t\treturn 0, e.err\n\t}\n\n\tvar n int\n\tn, e.err = e.Writer.Write(buf)\n\treturn n, e.err\n}\n\nfunc WriteResponse(w io.Writer, st Status, headers []Header, body io.Reader) error {\n\tew := &errWrite{Writer: w}\n\tfmt.Fprintf(ew, "HTTP/1.1 %d %s\\r\\n", st.Code, st.Reason)\n\n\tfor _, h := range headers {\n\t\tfmt.Fprintf(ew, "%s: %s\\r\\n", h.Key, h.Value)\n\t}\n\n\tfmt.Fprintf(w, "\\r\\n")\n\n\tio.Copy(ew, body)\n\treturn ew.err\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n\n# 4. Wrap erros\n\nå¨æä»¬å¼åä¸­ï¼å¸¸å¸¸ä¼å¨éè¯¯å¤çä¸­ï¼è®°å½äºæ¥å¿ï¼å¹¶ä¸å°éè¯¯ç»è¿åäºã\n\nå¨ os.Open æ¾ä¸å°æä»¶æ¶ä¼è¿å errorï¼å¤ç error æ¶ï¼å° error çä¿¡æ¯æä¸æ¥å¿ï¼å¹¶ä¸å° err è¿è¡è¿åï¼å¨ main å½æ°ä¸­ï¼æ¿å° error ååæ¬¡æä¸ error çæ¥å¿ï¼è¿ä¸ªæ¥å¿åä¸é¢æé¨åæ¯éå¤çæ¥å¿ã\n\nå¨ä»£ç è°ç¨é¾å¤çæ¶åï¼ä¼æä¸æ´å¤çéå¤æ¥å¿ï¼æ¥å¿ä¸­åºç°éå¸¸å¤çåªé³ï¼éå¸¸å½±åææ¥éè¯¯ã\n\nfunc ReadFile(path string) ([]byte, error) {\n\tf, err := os.Open(path)\n\tif err != nil {\n\t\tlog.Printf("could not open file: %v", err)\n\t\treturn nil, err\n\t}\n\tdefer f.Close()\n\n\tread := bufio.NewReader(f)\n\n\tline, _, err := read.ReadLine()\n\treturn line, err\n}\n\nfunc main() {\n\t_, err := ReadFile("test.txt")\n\tif err != nil {\n\t\tfmt.Println(err)\n\t}\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nè¿è¡è¾åºï¼\n\n2022/11/05 17:03:16 could not open file: open test.txt: The system cannot find t\nhe file specified.\n2022/11/05 17:03:16 open test.txt: The system cannot find the file specified.\n\n\n1\n2\n3\n\n\nå¯ä»¥ä½¿ç¨ fmt.Errorf æ¥å¯¹åå§éè¯¯è¿è¡åè£ï¼é¤äºåå§éè¯¯ä¿¡æ¯ä¹å¤ï¼å¨æ·»å é¢å¤å¾ä¿¡æ¯å¹¶è¿åã\n\nf, err := os.Open(path)\n\tif err != nil {\n\t\treturn nil, fmt.Errorf("open file failed: %w", err)\n\t}\n\n\n1\n2\n3\n4\n\n\nè¾åºï¼\n\n2022/11/05 17:04:43 open file failed: open test.txt: The system cannot find the\nfile specified.\n\n\n1\n2\n\n\nfmt.Errorf è¿åçæ¯ä¸ä¸ªæ°çè¢«åè£ç errorï¼errors.Is å¯ä»¥ä¸å±ä¸å±çå¥å¼åè£æ¥å¤æ­æ¯å¦ä¸ºåå§éè¯¯ï¼ä½æ¯å®æ¯åæéå¤æ­çï¼è¿é os.Open è¿åçåå§éè¯¯æ¯ os.PathError ä½æ¯å ä¸ºè¿åçæ¯å°åï¼æä»¥æ æ³ç¨ errors.Is å¤æ­ã\n\nfunc main() {\n\n\t_, err := ReadFile("test.txt")\n\tvar pathError *os.PathError\n\n\tif errors.Is(err, pathError) {\n\t\tfmt.Println("is PathError")\n\t} else {\n\t\tfmt.Println("no PathError")\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nè¾åºï¼\n\nno PathError\n\n\n1\n\n\nè¿éå¯ä»¥ç¨ errors.As æ¥å¤æ­ err æ¯å¦ä¸º os.PathError ç±»åï¼å³ä½¿ err æ¯å°åã\n\nè¿éå¤æ­äºæ¯å¦ä¸º os.PathError éè¯¯ï¼å¹¶ä¸å°è¿åç err è½¬æ¢æäºè¯¥éè¯¯ï¼æä»¬å¯ä»¥è°ç¨å¶ä¸­çå±æ§æ¥è·åæ´å¤çä¿¡æ¯ã\n\nfunc main() {\n\n\t_, err := ReadFile("test.txt")\n\tvar pathError *os.PathError\n\n\tif errors.As(err, &pathError) {\n\t\tfmt.Println(pathError.Path)\n\t}\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nè¾åºï¼\n\ntest.txt\n\n\n1\n\n\nè¿å¯ä»¥éè¿ errors.UnWrap æ¥è·ååºå±éè¯¯ï¼å°åå§éè¯¯ç»è§£æåºæ¥ã\n\nfunc main() {\n\t_, err := ReadFile("test.txt")\n\terr = errors.Unwrap(err)\n\tfmt.Printf("ori err: %v", err)\n}\n\n\n1\n2\n3\n4\n5\n\n\n\n# 5. pkg/errors\n\nä¸é¢ä»ç»çé½æ¯åçç errors å¤çæ¨¡åï¼ç°å¨ä»ç» pkg/errors æ¨¡åï¼å®å¨å¼å®¹åç errorsï¼å¹¶ä¸å¯¹å¶è¿è¡å¢å¼ºï¼ä¸»è¦æ¯æ·»å äºä¿å­å æ çè½åã\n\nå¯ä»¥ä½¿ç¨ errors.Wrap è¿è¡å¯¹ error çåè£ï¼å¹¶æ·»å é¢å¤çä¿¡æ¯ã\n\nfunc ReadFile(path string) ([]byte, error) {\n\tf, err := os.Open(path)\n\tif err != nil {\n\t\treturn nil, errors.Wrap(err, "could not open file")\n\t}\n\tdefer f.Close()\n\n\tread := bufio.NewReader(f)\n\n\tline, _, err := read.ReadLine()\n\treturn line, err\n}\n\nfunc main() {\n\t_, err := ReadFile("test.txt")\n\tif err != nil {\n\t\tfmt.Println(err)\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nè¾åºï¼\n\ncould not open file: open test.txt: The system cannot find the file specified.\n\n\n1\n\n\nä½å®è¿æä¸ä¸ªæ´å¼ºçåè½æ¯ä¼ä¿å­å½åçå æ ä¿¡æ¯ï¼ä½¿ç¨%+v å¯ä»¥æå°åºæ¥ã\n\nfunc main() {\n\t_, err := ReadFile("test.txt")\n\tif err != nil {\n\t\tfmt.Printf("stack track: \\n%+v", err)\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nè¾åºï¼\n\nstack track:\nopen test.txt: The system cannot find the file specified.\ncould not open file\nmain.ReadFile\n        D:/code/go_demo/main3.go:13\nmain.main\n        D:/code/go_demo/main3.go:24\nruntime.main\n        D:/install/go18.3/src/runtime/proc.go:250\nruntime.goexit\n        D:/install/go18.3/src/runtime/asm_amd64.s:1571\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå¦æä¸æ³ä¿å­å æ ä¿¡æ¯ï¼åªæ·»å é¢å¤çä¿¡æ¯ï¼å¯ä»¥ä½¿ç¨ errors.WithMessage æ·»å ã\n\n\tf, err := os.Open(path)\n\tif err != nil {\n\t\treturn nil, errors.WithMessage(err, "could not open file")\n\t}\n\n\n1\n2\n3\n4\n\n\nè¾åºï¼\n\ncould not open file: open test.txt: The system cannot find the file specified.\n\n\n1\n\n\nè¿æå ä¸ªå¸¸è§çæ¹æ³\n\n// çæéè¯¯çåæ¶å¸¦ä¸å æ ä¿¡æ¯\nfunc New(message string) error\n\n// åªéå è°ç¨å æ ä¿¡æ¯\nfunc WithStack(err error) error\n\n// è·å¾ææ ¹æ¬çéè¯¯åå \nfunc Cause(err error) error\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 6. error çæä½³å®è·µ\n\nå¤ç error çæ¹å¼è¿ä¹å¤ï¼æä»¬è¯¥å¦ä½æä¼çä½¿ç¨å®ä»¬å¢ï¼æä»¥ä¸å ä¸ªæ¹æ³ï¼\n\n * å¨èªå·±çåºç¨ä»£ç ä¸­ï¼ä½¿ç¨ errors.New æè errors.Errorf æ¥è¿åéè¯¯\n\nfunc parseArgs(args []string) error {\n\tif len(args) < 3 {\n\t\treturn errors.Errorf("not enough arguments")\n\t}\n\n\treturn nil\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n * å¦æè°ç¨å¶ä»ååçå½æ°ï¼éå¸¸ç®åçç´æ¥è¿åã\n\nif err != nil {\n\treturn err\n}\n\n\n1\n2\n3\n\n * å¦æåå¶ä»åºè¿è¡åä½ï¼èèä½¿ç¨ errors.Wrap æè errors.Wrapf ä¿å­å æ ä¿¡æ¯ãåæ ·éç¨äºåæ ååºåä½çæ¶åã\n\nf, err := os.Open(path)\nif err != nil {\n\treturn errors.Wrapf(err, "failed to open %q", path)\n\n\n1\n2\n3\n\n\n * ç´æ¥è¿åéè¯¯ï¼èä¸æ¯æ¯ä¸ªéè¯¯äº§ççå°æ¹å°å¤ææ¥å¿ã\n\n * å¨ç¨åºçé¡¶é¨æèæ¯å·¥ä½ç goroutine é¡¶é¨ï¼è¯·æ±å¥å£ï¼ï¼ä½¿ç¨ %+v æå æ è¯¦æè®°å½ã\n\nfunc main() {\n\terr := app.Run()\n\tif err != nil {\n\t\tfmt.Printf("FATAL: %+V\\n", err)\n\t\tos.Exit(1)\n\t}\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * ä½¿ç¨ errors.Cause è·å root errorï¼åè¿è¡å sentinel error å¤å®ã\n\n\n# åèèµæ\n\n * io.EOF è®¾è®¡çç¼ºé·',normalizedContent:'# 0. åè¨\n\ngo ä¸­çå¼å¸¸å¤çåå¶ä»è¯­è¨å¤§ä¸ç¸åï¼å javaãc++ãpython ç­è¯­è¨é½æ¯éè¿æåº exception æ¥å¤çå¼å¸¸ï¼è go æ¯éè¿è¿å error æ¥å¤å®å¼å¸¸ï¼å¹¶è¿è¡å¤çã\n\nå¨ go ä¸­æ panic çæºå¶ï¼ä½ panic æå³çç¨åºç»æ­¢ï¼ä»£ç ä¸è½ç»§ç»­è¿è¡äºï¼ä¸è½ææè°ç¨èæ¥è§£å³å®ãè error æ¯é¢æä¸­çå¼å¸¸ï¼å¸æè°ç¨èå¯ä»¥å¯¹å¶è¿è¡å¤ççã\n\n\n# 1. error æ¯ä»ä¹ï¼\n\nä¸¾ä¸ªä¾å­ï¼ä½¿ç¨ open æ¥æå¼æä»¶ï¼ä½æ¯å¯è½è¯¥è·¯å¾çæä»¶ä¸å­å¨ï¼åºç°å¼å¸¸ï¼å¨ go æ¯éè¿å¤æ­ err æ¯å¦ä¸º nil æ¥å¤å®æå¼æä»¶æ¯å¦æåã\n\nf, err := os.open(path)\nif err != nil {\n    // handle error\n}\n\n// do stuff\n\n\n1\n2\n3\n4\n5\n6\n\n\né®é¢æ¥äºï¼error æ¯ä»ä¹ï¼\n\næ¥çæºç ä¼åç°ï¼error æ¯ä¸ä¸ªåå« error æ¹æ³çæ¥å£ï¼è¿åçæ¯å®ç°äºè¯¥æ¥å£çå¯¹è±¡ã\n\ntype error interface {  \n   error() string  \n}\n\n\n1\n2\n3\n\n\næä»¬ä¸è¬ä½¿ç¨æ¯éè¿ errors.new()æ¥è¿åä¸ä¸ªå®ç°äº error æ¥å£çå¯¹è±¡ãè¿ä¸ªå¯¹è±¡æ¯ä¸ä¸ªåå«äºå­ç¬¦ä¸²çç»æä½ï¼ç¶åå¯ä»¥éè¿ error æ¹æ³æ¥è·åå­ç¬¦ä¸²ã\n\nfunc new(text string) error {  \n   return &errorstring{text}  \n}  \n  \n// errorstring is a trivial implementation of error.\ntype errorstring struct {  \n   s string  \n}  \n  \nfunc (e *errorstring) error() string {  \n   return e.s  \n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næä»¬å¯ä»¥æ³¨æå° new æ¹æ³è¿åçæ¯ errorstring çå°åï¼ä¹å°±æ¯è¯´ï¼å¨æä»¬å°ä¸¤ä¸ª error æ¯è¾ç¸ç­æ¶ï¼æ¯è¾æ¯å°åï¼æ¯ä¸¤ä¸ª error æ¯å¦ä¸ºåä¸ä¸ªå¯¹è±¡ï¼èä¸æ¯å¶ä¸­çéè¯¯å­ç¬¦ä¸²ã\n\nimport (\n\t"errors"\n\t"fmt"\n)\n\ntype errorstring string\n\nfunc (e errorstring) error() string {\n\treturn string(e)\n}\n\nfunc new(text string) error {\n\treturn errorstring(text)\n}\n\nvar errnamedtype = new("eof")\nvar errstructtype = errors.new("eof")\n\nfunc main() {\n\n\tif errnamedtype == new("eof") {\n\t\tfmt.println("named type error")\n\t}\n\n\tif errstructtype == errors.new("eof") {\n\t\tfmt.println("struct type error")\n\t}\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nè¾åºï¼\n\nnamed type error\n\n\n1\n\n\n\n# 2. éè¯¯ç±»å\n\n\n# 2.1 sentinel error(é¢å®ä¹éè¯¯)\n\nå¶å®å°±æ¯åé¢å®ä¹ä¸äºå¯ä»¥é¢æä¸­çéè¯¯ï¼å¨ä½¿ç¨è¿ç¨ä¸­ï¼éè¿å¤æ­ error æ¯å±äºåªä¸ç§ error å¹¶è¿è¡å¯¹åºçå¤çã\n\nä¸¾ä¸ªæ å­ï¼å¨ io.eof å°±æ¯ä¸ä¸ªé¢å®ä¹çéè¯¯ï¼å®æ¯è¡¨ç¤ºè¾å¥æµä¸­çç»å°¾ã\n\nvar eof = errors.new("eof")\n\n\n1\n\n\nå¨ä»æµä¸­è¯»åå­ç¬¦çæ¶åï¼ä¼éè¿å¤æ­ error æ¯å¦ç­äº io.eof æ¥å¤å®æ¯å¦è¯»å®ãæ³¨æè¿éæ¯å¤æ­ error çæéæ¯å¦ç¸ç­ã\n\nn, err := reader.read(p)  \nif err != nil {  \n   if err == io.eof {  \n      fmt.println("the resource is read!")  \n      break  \n   }  \n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¿ç§æ¹å¼ä¸å»ºè®®ä½¿ç¨ï¼åå æ¯ï¼\n\n * å®ä¼æä¸ºä½  api çå¬å±é¨å\n\nå ä¸ºå¬å±å½æ°éè¦è¿åä¸ä¸ªåºå®ç errorï¼é£ä¹è¿ä¸ª error å°±å¿é¡»æ¯å¬å¼çï¼é£ä¹å°±éè¦ææ¡£è®°å½ï¼è¿ä¼å¢å  api çè¡¨é¢ç§¯ã\n\n * å¢å è°ç¨èçè¦åæ§\n\nè°ç¨èå¿é¡»è¦ç¥é io.eof è¿ä¸ª error ï¼å¹¶å¨è°ç¨çå°æ¹ä½¿ç¨è¯¥ error å¤æ­æ¯å¦ç»æã\n\n\n# 2.2 error types(èªå®ä¹éç±»å)\n\néè¿å®ç° error æ¥å£æ¥åå»ºèªå®ä¹éè¯¯ç±»åãå sentinel error ç¸æ¯ï¼æ¯éè¿å¤æ­ç±»åæ¥ç¥éæ¯åªç§éè¯¯ï¼å¹¶ä¸å¯ä»¥è¾åºæ´å¤çä¸ä¸æéè¯¯ä¿¡æ¯ã\n\néè¿èªå®ä¹ myerrorï¼å¹¶å®ç° error æ¥å£ä¸­ç error çæ¹æ³ã\n\ntype myerror struct {\n\tmsg  string\n\tfile string\n\tline int\n}\n\nfunc (e *myerror) error() string {\n\treturn fmt.sprintf("%s:%d: %s", e.file, e.line, e.msg)\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\ntest æ¹æ³ä¸­è¿åçæ¯èªå®ä¹ç errorï¼æä»¬éè¿æ­è¨è½¬æ¢ error æ myerror ç±»åï¼ç¶ååè¾åºæ´å¤çä¸ä¸æä¿¡æ¯ã\n\nfunc test() error {\n\treturn &myerror{"something happened", "server.go", 42}\n}\n\nfunc main() {\n\terr := test()\n\tswitch err := err.(type) {\n\tcase nil:\n\t\t// success\n\tcase *myerror:\n\t\tfmt.println("error occured on line:", err.line)\n\tdefault:\n\t\t// unknown error\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå¨æ ååº os.patherror ä¸­ï¼èªå®ä¹äº patherror ï¼ä¹æ¯ç¸åçç¨æ³ã\n\ntype patherror struct {\n\top   string\n\tpath string\n\terr  error\n}\n\nfunc (e *patherror) error() string { return e.op + " " + e.path + ": " + e.err.error() }\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næä»¬ä¹å°½å¯è½é¿åä½¿ç¨ error typesï¼å ä¸ºå®å sentinel erorr ä¸æ ·ä¼åè°ç¨èäº§çè¦åï¼ä¼ä½ä¸º api çä¸é¨åã\n\n\n# 2.3 opaque errors(ä¸éæçéè¯¯)\n\nerror types æ¯éè¿å¤æ­ error çç±»åæ¥èµ°ä¸åçé»è¾ï¼è opaque errors æ¯éè¿å¤æ­ error çè¡ä¸ºæ¥èµ°ä¸åçé»è¾ã\n\nå¨ net.error ä¸­å®ä¹å¦ä¸ï¼é¤äºåå« error å¤ï¼è¿åå« timeout å temporary æ¹æ³ã\n\ntype error interface {\n\terror\n\ttimeout() bool \n\ttemporary() bool\n}\n\n\n1\n2\n3\n4\n5\n\n\né¤äºå¤æ­æ¯å¦æ error ä¹å¤ï¼è¿å¯ä»¥éè¿æ¹æ³æ¥å¤æ­æ¯åªç§ç±»åç error ç¶åè¿è¡å¯¹åºçå¤çã\n\nif neterr, ok := err.(net.error); ok && neterr.timeout() {\n\treturn false\n}\n\nif neterr, ok := err.(net.error); ok && neterr.temporary() {\n\treturn false\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå®ä¸æ¯æ©å± error æ´å¤çä¿¡æ¯ï¼èæ¯æ©å±å¶æ¹æ³ã\n\n\n# 3. ä¼éçå¤çéè¯¯\n\n\n# 3.1 æ éè¯¯çæ­£å¸¸æµç¨ä»£ç \n\næ éè¯¯çæ­£å¸¸æµç¨ä»£ç ï¼å°æä¸ºä¸æ¡ç´çº¿ï¼èä¸æ¯ç¼©è¿çä»£ç ã\n\néè¯¯çåæ³ï¼\n\n// no\nf, err := os.open(path)\nif err == nil {\n    // do stuff\n}\n\n// handle error\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næ­£ç¡®çåæ³ï¼\n\n// ok\nf, err := os.open(path)\nif err != nil {\n    // handle error\n}\n\n// do stuff\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 3.2 åå°ä¸å¿è¦çå¤æ­\n\nfunc authenticaterequest(r *request) error {\n    err := authenticate(r.user)\n    err != nil {\n        return err\n    }\n    return nil\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næ¹ä¸ºï¼\n\nfunc authenticaterequest(r *request) error {\n    return authenticate(r.user)\n}\n\n\n1\n2\n3\n\n\n\n# 3.3 å° error åé¨å­å¨èµ·æ¥\n\nerr å¨åé¨ä¸´æ¶å¨å­ï¼å¨æåå¨è¿ååºæ¥ã\n\nä¸é¢ä¾å­ä¸­ï¼éè¿å¾ªç¯è¯» reader æ¯ä¸è¡çæ°æ®ï¼æ¯æ¬¡å¤æ­ err æ¯ä¸æ¯ nil æ¥å¤æ­æ¯å¦è¯»å®ï¼å¦ææ¯åéåºå¾ªç¯ï¼åè¿åã\n\nfunc countlines(r io.reader)  (int, error) {\n\tvar (\n\t\tbr = bufio.newreader(r)\n\t\tlines int\n\t\terr error\n\t)\n\n\tfor {\n\t\t_, err = br.readstring(\'\\n\')\n\t\tlines++\n\t\tif err != nil {\n\t\t\tbreak\n\t\t}\n\t}\n\n\tif err != io.eof {\n\t\treturn 0, err\n\t}\n\n\treturn lines, nil\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\næ¹è¿çæ¬ï¼\n\ntype scanner struct {\n\terr          error     // sticky error.\n\t...\n}\n\nfunc countlines(r io.reader)  (int, error) {\n\tsc := bufio.newscanner(r)\n\tlines := 0\n\n\tfor sc.scan() {\n\t\tlines++\n\t}\n\n\treturn lines, sc.err()\n}\n\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\næ¯æ¬¡å¾ªç¯é½ä¼å¤æ­ scan çè¿åå¼ï¼å½æ åå®¹è¿åæ¶ï¼åä¼è¿å falseï¼åç»æå¾ªç¯ï¼å¹¶è¿åç»æãå¾ªç¯ä¸­åºç°ç error ä¼å¨ scan ä¸­éè¿ s.seterr(err) ä¿å­å¨å¯¹è±¡ç err å±æ§ä¸­ã\n\nä»£ç ææ¾ç®æ´äºè®¸å¤ã\n\n\n# 3.4 å°éå¤æä½æ½ç¦»åºæ¥\n\nççä¸é¢çä»£ç ï¼éé¢å¤æ¬¡ä½¿ç¨ fmt.fprintf()å¹¶å¤æ­å¶è¿åå¼æ¯å¦ä¸º err\n\ntype header struct {\n\tkey, value string\n}\n\ntype status struct {\n\tcode   int\n\treason string\n}\n\nfunc writeresponse(w io.writer, st status, headers []header, body io.reader) error {\n\t_, err := fmt.fprintf(w, "http/1.1 %d %s\\r\\n", st.code, st.reason)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tfor _, h := range headers {\n\t\t_, err := fmt.fprintf(w, "%s: %s\\r\\n", h.key, h.value)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t}\n\n\tif _, err := fmt.fprintf(w, "\\r\\n"); err != nil {\n\t\treturn err\n\t}\n\n\t_, err = io.copy(w, body)\n\treturn err\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\næä»¬åå»ºä¸ä¸ª errwrite ç»æä½å¹¶å®ç° write æ¹æ³ï¼ä¹å°±æ¯å¨åæ¥ç write æ¹æ³ä¸­åäºä¸å±å¹¶åå¥½éè¯¯å¤æ­ï¼ç¶åå¨æ¯ä¸ä¸ª fmt.fprintf ä½¿ç¨æä»¬å®ä¹ç errwrite è¿è¡åå¥ï¼è¿æ ·å°±è¾¾å°äºå¤ç¨çææï¼ä»£ç ä¹å¥½çäºè®¸å¤ã\n\ntype errwrite struct {\n\tio.writer\n\terr error\n}\n\nfunc (e *errwrite) write(buf []byte) (int, error) {\n\tif e.err != nil {\n\t\treturn 0, e.err\n\t}\n\n\tvar n int\n\tn, e.err = e.writer.write(buf)\n\treturn n, e.err\n}\n\nfunc writeresponse(w io.writer, st status, headers []header, body io.reader) error {\n\tew := &errwrite{writer: w}\n\tfmt.fprintf(ew, "http/1.1 %d %s\\r\\n", st.code, st.reason)\n\n\tfor _, h := range headers {\n\t\tfmt.fprintf(ew, "%s: %s\\r\\n", h.key, h.value)\n\t}\n\n\tfmt.fprintf(w, "\\r\\n")\n\n\tio.copy(ew, body)\n\treturn ew.err\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n\n# 4. wrap erros\n\nå¨æä»¬å¼åä¸­ï¼å¸¸å¸¸ä¼å¨éè¯¯å¤çä¸­ï¼è®°å½äºæ¥å¿ï¼å¹¶ä¸å°éè¯¯ç»è¿åäºã\n\nå¨ os.open æ¾ä¸å°æä»¶æ¶ä¼è¿å errorï¼å¤ç error æ¶ï¼å° error çä¿¡æ¯æä¸æ¥å¿ï¼å¹¶ä¸å° err è¿è¡è¿åï¼å¨ main å½æ°ä¸­ï¼æ¿å° error ååæ¬¡æä¸ error çæ¥å¿ï¼è¿ä¸ªæ¥å¿åä¸é¢æé¨åæ¯éå¤çæ¥å¿ã\n\nå¨ä»£ç è°ç¨é¾å¤çæ¶åï¼ä¼æä¸æ´å¤çéå¤æ¥å¿ï¼æ¥å¿ä¸­åºç°éå¸¸å¤çåªé³ï¼éå¸¸å½±åææ¥éè¯¯ã\n\nfunc readfile(path string) ([]byte, error) {\n\tf, err := os.open(path)\n\tif err != nil {\n\t\tlog.printf("could not open file: %v", err)\n\t\treturn nil, err\n\t}\n\tdefer f.close()\n\n\tread := bufio.newreader(f)\n\n\tline, _, err := read.readline()\n\treturn line, err\n}\n\nfunc main() {\n\t_, err := readfile("test.txt")\n\tif err != nil {\n\t\tfmt.println(err)\n\t}\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nè¿è¡è¾åºï¼\n\n2022/11/05 17:03:16 could not open file: open test.txt: the system cannot find t\nhe file specified.\n2022/11/05 17:03:16 open test.txt: the system cannot find the file specified.\n\n\n1\n2\n3\n\n\nå¯ä»¥ä½¿ç¨ fmt.errorf æ¥å¯¹åå§éè¯¯è¿è¡åè£ï¼é¤äºåå§éè¯¯ä¿¡æ¯ä¹å¤ï¼å¨æ·»å é¢å¤å¾ä¿¡æ¯å¹¶è¿åã\n\nf, err := os.open(path)\n\tif err != nil {\n\t\treturn nil, fmt.errorf("open file failed: %w", err)\n\t}\n\n\n1\n2\n3\n4\n\n\nè¾åºï¼\n\n2022/11/05 17:04:43 open file failed: open test.txt: the system cannot find the\nfile specified.\n\n\n1\n2\n\n\nfmt.errorf è¿åçæ¯ä¸ä¸ªæ°çè¢«åè£ç errorï¼errors.is å¯ä»¥ä¸å±ä¸å±çå¥å¼åè£æ¥å¤æ­æ¯å¦ä¸ºåå§éè¯¯ï¼ä½æ¯å®æ¯åæéå¤æ­çï¼è¿é os.open è¿åçåå§éè¯¯æ¯ os.patherror ä½æ¯å ä¸ºè¿åçæ¯å°åï¼æä»¥æ æ³ç¨ errors.is å¤æ­ã\n\nfunc main() {\n\n\t_, err := readfile("test.txt")\n\tvar patherror *os.patherror\n\n\tif errors.is(err, patherror) {\n\t\tfmt.println("is patherror")\n\t} else {\n\t\tfmt.println("no patherror")\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nè¾åºï¼\n\nno patherror\n\n\n1\n\n\nè¿éå¯ä»¥ç¨ errors.as æ¥å¤æ­ err æ¯å¦ä¸º os.patherror ç±»åï¼å³ä½¿ err æ¯å°åã\n\nè¿éå¤æ­äºæ¯å¦ä¸º os.patherror éè¯¯ï¼å¹¶ä¸å°è¿åç err è½¬æ¢æäºè¯¥éè¯¯ï¼æä»¬å¯ä»¥è°ç¨å¶ä¸­çå±æ§æ¥è·åæ´å¤çä¿¡æ¯ã\n\nfunc main() {\n\n\t_, err := readfile("test.txt")\n\tvar patherror *os.patherror\n\n\tif errors.as(err, &patherror) {\n\t\tfmt.println(patherror.path)\n\t}\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nè¾åºï¼\n\ntest.txt\n\n\n1\n\n\nè¿å¯ä»¥éè¿ errors.unwrap æ¥è·ååºå±éè¯¯ï¼å°åå§éè¯¯ç»è§£æåºæ¥ã\n\nfunc main() {\n\t_, err := readfile("test.txt")\n\terr = errors.unwrap(err)\n\tfmt.printf("ori err: %v", err)\n}\n\n\n1\n2\n3\n4\n5\n\n\n\n# 5. pkg/errors\n\nä¸é¢ä»ç»çé½æ¯åçç errors å¤çæ¨¡åï¼ç°å¨ä»ç» pkg/errors æ¨¡åï¼å®å¨å¼å®¹åç errorsï¼å¹¶ä¸å¯¹å¶è¿è¡å¢å¼ºï¼ä¸»è¦æ¯æ·»å äºä¿å­å æ çè½åã\n\nå¯ä»¥ä½¿ç¨ errors.wrap è¿è¡å¯¹ error çåè£ï¼å¹¶æ·»å é¢å¤çä¿¡æ¯ã\n\nfunc readfile(path string) ([]byte, error) {\n\tf, err := os.open(path)\n\tif err != nil {\n\t\treturn nil, errors.wrap(err, "could not open file")\n\t}\n\tdefer f.close()\n\n\tread := bufio.newreader(f)\n\n\tline, _, err := read.readline()\n\treturn line, err\n}\n\nfunc main() {\n\t_, err := readfile("test.txt")\n\tif err != nil {\n\t\tfmt.println(err)\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nè¾åºï¼\n\ncould not open file: open test.txt: the system cannot find the file specified.\n\n\n1\n\n\nä½å®è¿æä¸ä¸ªæ´å¼ºçåè½æ¯ä¼ä¿å­å½åçå æ ä¿¡æ¯ï¼ä½¿ç¨%+v å¯ä»¥æå°åºæ¥ã\n\nfunc main() {\n\t_, err := readfile("test.txt")\n\tif err != nil {\n\t\tfmt.printf("stack track: \\n%+v", err)\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nè¾åºï¼\n\nstack track:\nopen test.txt: the system cannot find the file specified.\ncould not open file\nmain.readfile\n        d:/code/go_demo/main3.go:13\nmain.main\n        d:/code/go_demo/main3.go:24\nruntime.main\n        d:/install/go18.3/src/runtime/proc.go:250\nruntime.goexit\n        d:/install/go18.3/src/runtime/asm_amd64.s:1571\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå¦æä¸æ³ä¿å­å æ ä¿¡æ¯ï¼åªæ·»å é¢å¤çä¿¡æ¯ï¼å¯ä»¥ä½¿ç¨ errors.withmessage æ·»å ã\n\n\tf, err := os.open(path)\n\tif err != nil {\n\t\treturn nil, errors.withmessage(err, "could not open file")\n\t}\n\n\n1\n2\n3\n4\n\n\nè¾åºï¼\n\ncould not open file: open test.txt: the system cannot find the file specified.\n\n\n1\n\n\nè¿æå ä¸ªå¸¸è§çæ¹æ³\n\n// çæéè¯¯çåæ¶å¸¦ä¸å æ ä¿¡æ¯\nfunc new(message string) error\n\n// åªéå è°ç¨å æ ä¿¡æ¯\nfunc withstack(err error) error\n\n// è·å¾ææ ¹æ¬çéè¯¯åå \nfunc cause(err error) error\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 6. error çæä½³å®è·µ\n\nå¤ç error çæ¹å¼è¿ä¹å¤ï¼æä»¬è¯¥å¦ä½æä¼çä½¿ç¨å®ä»¬å¢ï¼æä»¥ä¸å ä¸ªæ¹æ³ï¼\n\n * å¨èªå·±çåºç¨ä»£ç ä¸­ï¼ä½¿ç¨ errors.new æè errors.errorf æ¥è¿åéè¯¯\n\nfunc parseargs(args []string) error {\n\tif len(args) < 3 {\n\t\treturn errors.errorf("not enough arguments")\n\t}\n\n\treturn nil\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n * å¦æè°ç¨å¶ä»ååçå½æ°ï¼éå¸¸ç®åçç´æ¥è¿åã\n\nif err != nil {\n\treturn err\n}\n\n\n1\n2\n3\n\n * å¦æåå¶ä»åºè¿è¡åä½ï¼èèä½¿ç¨ errors.wrap æè errors.wrapf ä¿å­å æ ä¿¡æ¯ãåæ ·éç¨äºåæ ååºåä½çæ¶åã\n\nf, err := os.open(path)\nif err != nil {\n\treturn errors.wrapf(err, "failed to open %q", path)\n\n\n1\n2\n3\n\n\n * ç´æ¥è¿åéè¯¯ï¼èä¸æ¯æ¯ä¸ªéè¯¯äº§ççå°æ¹å°å¤ææ¥å¿ã\n\n * å¨ç¨åºçé¡¶é¨æèæ¯å·¥ä½ç goroutine é¡¶é¨ï¼è¯·æ±å¥å£ï¼ï¼ä½¿ç¨ %+v æå æ è¯¦æè®°å½ã\n\nfunc main() {\n\terr := app.run()\n\tif err != nil {\n\t\tfmt.printf("fatal: %+v\\n", err)\n\t\tos.exit(1)\n\t}\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * ä½¿ç¨ errors.cause è·å root errorï¼åè¿è¡å sentinel error å¤å®ã\n\n\n# åèèµæ\n\n * io.eof è®¾è®¡çç¼ºé·',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"å¿«éäºè§£iptables",frontmatter:{title:"å¿«éäºè§£iptables",date:"2023-05-15T19:19:11.000Z",permalink:"/pages/72ba9a/",categories:["ç¼ç¨","linux"],tags:["linux","è®¡ç®æºç½ç»","linuxç½ç»èæå"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"iptablesæ¯ä¸ä¸ªå¨Linuxæä½ç³»ç»ä¸ä½¿ç¨çé²ç«å¢å·¥å·ï¼å®å¯ä»¥ç¨äºéç½®åç®¡çç½ç»æ°æ®åçè¿æ»¤ãè½¬ååä¿®æ¹ç­æä½ã",comment:!0,feed:{enable:!0},meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/2023-04-13-2330-20230514151755-we6q131.png"},{name:"twitter:title",content:"å¿«éäºè§£iptables"},{name:"twitter:description",content:"iptablesæ¯ä¸ä¸ªå¨Linuxæä½ç³»ç»ä¸ä½¿ç¨çé²ç«å¢å·¥å·ï¼å®å¯ä»¥ç¨äºéç½®åç®¡çç½ç»æ°æ®åçè¿æ»¤ãè½¬ååä¿®æ¹ç­æä½ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/2023-04-13-2330-20230514151755-we6q131.png"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/03.linux/01.%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3iptables.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å¿«éäºè§£iptables"},{property:"og:description",content:"iptablesæ¯ä¸ä¸ªå¨Linuxæä½ç³»ç»ä¸ä½¿ç¨çé²ç«å¢å·¥å·ï¼å®å¯ä»¥ç¨äºéç½®åç®¡çç½ç»æ°æ®åçè¿æ»¤ãè½¬ååä¿®æ¹ç­æä½ã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/2023-04-13-2330-20230514151755-we6q131.png"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/03.linux/01.%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3iptables.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-05-15T19:19:11.000Z"},{property:"article:tag",content:"linux"},{property:"article:tag",content:"è®¡ç®æºç½ç»"},{property:"article:tag",content:"linuxç½ç»èæå"},{itemprop:"name",content:"å¿«éäºè§£iptables"},{itemprop:"description",content:"iptablesæ¯ä¸ä¸ªå¨Linuxæä½ç³»ç»ä¸ä½¿ç¨çé²ç«å¢å·¥å·ï¼å®å¯ä»¥ç¨äºéç½®åç®¡çç½ç»æ°æ®åçè¿æ»¤ãè½¬ååä¿®æ¹ç­æä½ã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/2023-04-13-2330-20230514151755-we6q131.png"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/03.linux/01.%E5%BF%AB%E9%80%9F%E4%BA%86%E8%A7%A3iptables.html",relativePath:"04.ç¼ç¨/03.linux/01.å¿«éäºè§£iptables.md",key:"v-21216af8",path:"/pages/72ba9a/",headers:[{level:2,title:"åè¯",slug:"åè¯",normalizedTitle:"åè¯",charIndex:2},{level:3,title:"iptablesæ¯ä»ä¹ï¼",slug:"iptablesæ¯ä»ä¹",normalizedTitle:"iptablesæ¯ä»ä¹ï¼",charIndex:9},{level:3,title:"Netfilteræ¯ä»ä¹ï¼",slug:"netfilteræ¯ä»ä¹",normalizedTitle:"netfilteræ¯ä»ä¹ï¼",charIndex:267},{level:3,title:"iptableså®ç°",slug:"iptableså®ç°",normalizedTitle:"iptableså®ç°",charIndex:1020},{level:2,title:"iptablesä¸æ¿æ§ï¼tableãchainårule",slug:"iptablesä¸æ¿æ§-tableãchainårule",normalizedTitle:"iptablesä¸æ¿æ§ï¼tableãchainårule",charIndex:1140},{level:3,title:"chain",slug:"chain",normalizedTitle:"chain",charIndex:1158},{level:3,title:"table",slug:"table",normalizedTitle:"table",charIndex:11},{level:3,title:"rule",slug:"rule",normalizedTitle:"rule",charIndex:1164},{level:2,title:"iptableså½ä»¤ä½¿ç¨",slug:"iptableså½ä»¤ä½¿ç¨",normalizedTitle:"iptableså½ä»¤ä½¿ç¨",charIndex:2402},{level:3,title:"åæ°",slug:"åæ°",normalizedTitle:"åæ°",charIndex:2419},{level:3,title:"å¸¸è§æ­¦å¨",slug:"å¸¸è§æ­¦å¨",normalizedTitle:"å¸¸è§æ­¦å¨",charIndex:3390},{level:2,title:"å·¨äººçè©è",slug:"å·¨äººçè©è",normalizedTitle:"å·¨äººçè©è",charIndex:4926}],headersStr:"åè¯ iptablesæ¯ä»ä¹ï¼ Netfilteræ¯ä»ä¹ï¼ iptableså®ç° iptablesä¸æ¿æ§ï¼tableãchainårule chain table rule iptableså½ä»¤ä½¿ç¨ åæ° å¸¸è§æ­¦å¨ å·¨äººçè©è",content:"# åè¯\n\n\n# iptablesæ¯ä»ä¹ï¼\n\niptablesæ¯ä¸ä¸ªå¨Linuxæä½ç³»ç»ä¸ä½¿ç¨çé²ç«å¢å·¥å·ï¼å®å¯ä»¥ç¨äºéç½®åç®¡çç½ç»æ°æ®åçè¿æ»¤ãè½¬ååä¿®æ¹ç­æä½ã\n\n 1. è¿æ»¤æ°æ®åï¼iptableså¯ä»¥æ ¹æ®ä¸åçè§åè¿æ»¤ç½ç»æ°æ®åï¼ä¾å¦æ ¹æ®æºIPå°åãç®æ IPå°åãç«¯å£å·ç­è¿è¡è¿æ»¤ã\n\n 2. è½¬åæ°æ®åï¼iptableså¯ä»¥å°ç½ç»æ°æ®åä»ä¸ä¸ªæ¥å£è½¬åå°å¦ä¸ä¸ªæ¥å£ï¼å®ç°ç½ç»æ°æ®çè½¬ååè½ã\n\n 3. ä¿®æ¹æ°æ®åï¼iptableså¯ä»¥ä¿®æ¹ç½ç»æ°æ®åçæºIPå°åãç®æ IPå°åãç«¯å£å·ç­ä¿¡æ¯ï¼å®ç°ç½ç»æ°æ®çä¼ªè£åæ¬ºéªã\n\n\n# Netfilteræ¯ä»ä¹ï¼\n\nNetfilteræ¯Linuxåæ ¸ä¸­çä¸ä¸ªç½ç»æ°æ®åè¿æ»¤æ¡æ¶ï¼å®å¯ä»¥å¨æ°æ®åè¿å¥åç¦»å¼ç½ç»æ¥å£æ¶è¿è¡æ¦æªåå¤çãiptableså°±æ¯åºäºNetfilteræ¡æ¶å®ç°çä¸ä¸ªç¨æ·ç©ºé´å·¥å·ï¼å®å¯ä»¥éè¿è°ç¨Netfilteræä¾çAPIæ¥å®ç°ç½ç»æ°æ®åçè¿æ»¤ãè½¬ååä¿®æ¹ç­æä½ã\n\nnetfilterçæ¶æå°±æ¯å¨æ´ä¸ªç½ç»æµç¨çè¥å¹²ä½ç½®æ¾ç½®ä¸äºé©å­ï¼å¹¶å¨æ¯ä¸ªé©å­ä¸æè½½ä¸äºå¤çå½æ°è¿è¡å¤çã\n\nIPå±ç5ä¸ªé©å­ç¹çä½ç½®ï¼åå«æ¯PREROUTINGãPOSTROUTINGãINPUTãOUTPUTåFORWARDãåçå¾å¦ä¸ï¼\n\nâ\n\nâ\n\nå½ç½å¡ä¸æ¶å°ä¸ä¸ªåéè¾¾åè®®æ æ¶ï¼æåç»è¿çnetfilteré©å­æ¯PREROUTINGï¼å¦æç¡®å®æç¨æ·åäºè¿ä¸ªé©å­å½æ°ï¼é£ä¹åæ ¸å°å¨è¿éå¯¹æ°æ®åè¿è¡ç®çå°åè½¬æ¢ï¼DNATï¼ãä¸ç®¡å¨PREROUTINGææ²¡æåè¿DNATï¼åæ ¸é½ä¼éè¿æ¥æ¬å°è·¯ç±è¡¨å³å®è¿ä¸ªæ°æ®åæ¯åéç»æ¬å°è¿ç¨è¿æ¯åéç»å¶ä»æºå¨ãå¦ææ¯åéç»å¶ä»æºå¨ï¼æå¶ä»network namespaceï¼ï¼å°±ç¸å½äºææ¬å°å½ä½è·¯ç±å¨ï¼å°±ä¼ç»è¿netfilterçFORWARDé©å­ï¼ç¨æ·å¯ä»¥å¨æ­¤å¤è®¾ç½®åè¿æ»¤é©å­å½æ°ï¼ä¾å¦iptablesçrejectå½æ°ãææé©¬ä¸è¦åå°åè®®æ å¤çåé½ä¼ç»è¿POSTROUTINGé©å­ï¼ç¨æ·å¯ä»¥å¨è¿éåä¸æºå°åè½¬æ¢ï¼SNATï¼ææºå°åä¼ªè£ï¼Masqueradeï¼ç®ç§°Masqï¼çé©å­å½æ°ãå¦æç»è¿ä¸é¢çè·¯ç±å³ç­ï¼åæ ¸å³å®æååç»æ¬å°è¿ç¨ï¼å°±ä¼ç»è¿INPUTé©å­ãæ¬å°è¿ç¨æ¶å°æ°æ®ååï¼åç¨æ¥æä¼åç»è¿OUTPUTé©å­ï¼ç¶åç»è¿ä¸æ¬¡è·¯ç±å³ç­ï¼ä¾å¦ï¼å³å®ä»æºå¨çåªåç½å¡åºå»ï¼ä¸ä¸è·³å°åæ¯å¤å°ç­ï¼ï¼æååºåè®®æ çç½ç»ååæ ·ä¼ç»è¿POSTROUTINGé©å­ã\n\n\n# iptableså®ç°\n\niptablesçåºå±å®ç°æ¯éè¿Linuxåæ ¸ä¸­çNetfilteræ¡æ¶æ¥å®ç°çãiptablesæ¯ç¨æ·ç©ºé´çä¸ä¸ªç¨åºï¼éè¿netlinkååæ ¸çnetfilteræ¡æ¶æäº¤éï¼è´è´£å¾é©å­ä¸éç½®åè°å½æ°ã\n\n\n\n\n# iptablesä¸æ¿æ§ï¼tableãchainårule\n\n\n# chain\n\niptablesæ5æ¡åç½®é¾åå«å¯¹åºçnetfilterç5ä¸ªé©å­ï¼\n\n * INPUTé¾ï¼ä¸è¬ç¨äºå¤çè¾å¥æ¬å°è¿ç¨çæ°æ®åã\n * OUTPUTé¾ï¼ä¸è¬ç¨äºå¤çæ¬å°è¿ç¨çè¾åºæ°æ®åã\n * FORWARDé¾ï¼ä¸è¬ç¨äºå¤çè½¬åå°å¶ä»æºå¨/network namespaceçæ°\n   æ®åã\n * PREROUTINGé¾ï¼å¯ä»¥å¨æ­¤å¤è¿è¡DNATã\n * POSTROUTINGé¾ï¼å¯ä»¥å¨æ­¤å¤è¿è¡SNATã\n\n\n# table\n\né¤äº5æ¡åç½®é¾ä¹å¤ï¼è¿å¯ä»¥å¨è¡¨ä¸­å®ä¹èªå·±çé¾ï¼\n\n * filter è¡¨ï¼ç¨äºè¿æ»¤æ°æ®åï¼æ¯é»è®¤çè¡¨ãå®åå« INPUTãOUTPUT å FORWARD ä¸ä¸ªé¾ï¼åå«ç¨äºå¤çè¿å¥æ¬æºçæ°æ®åãä»æ¬æºååºçæ°æ®ååè½¬åçæ°æ®åã\n\n * nat è¡¨ï¼ç¨äºç½ç»å°åè½¬æ¢ï¼NATï¼ãå®åå« PREROUTINGãPOSTROUTING å OUTPUT ä¸ä¸ªé¾ï¼åå«ç¨äºå¤çè¿å¥æ¬æºåçæ°æ®åãä»æ¬æºååºçæ°æ®ååæ¬æºçæçæ°æ®åã\n\n * mangle è¡¨ï¼ç¨äºä¿®æ¹æ°æ®åçç¹å®å­æ®µãå¦ TTLãTOS ç­ãå®åå« PREROUTINGãINPUTãFORWARDãOUTPUT å POSTROUTING äºä¸ªé¾ï¼åå«ç¨äºå¤çè¿å¥æ¬æºåçæ°æ®åãè¿å¥æ¬æºçæ°æ®åãè½¬åçæ°æ®åãä»æ¬æºååºçæ°æ®ååæ¬æºçæçæ°æ®åã\n\n * raw è¡¨ï¼ç¨äºéç½®è¿æ¥è¿½è¸ªç³»ç»ãå®åå« PREROUTING å OUTPUT ä¸¤ä¸ªé¾ï¼åå«ç¨äºå¤çè¿å¥æ¬æºåçæ°æ®ååä»æ¬æºååºçæ°æ®åã\n\nè¿5å¼ è¡¨çä¼åçº§ä»é«å°ä½æ¯ï¼rawãmangleãnatãfilterãsecurityã\n\niptablesè¡¨ä¸é¾çå¯¹åºå³ç³»å¾å¦ä¸ï¼\n\nâ\n\n\n\nä¸åçè¡¨æä¸åçé¾ï¼è¿æ¯ä¸ºäºåç±»ç®¡çiptablesè§åï¼ruleï¼çï¼ç³»ç»ææçiptablesè§åé½è¢«ååå°ä¸åçè¡¨éåä¸­ã\n\n\n# rule\n\niptablesçè§åå°±æ¯æè½½netfilteré©å­ä¸çå½æ°ï¼ç¨æ¥ä¿®æ¹æ°æ®åçåå®¹æèè¿æ»¤æ°æ®åç­æä½ï¼iptablesçè¡¨å°±æ¯ææè§åç5ä¸ªé»è¾éåã\n\niptablesè§åå¦ä½ç¼åï¼\n\nä¸æ¡iptablesè§ååå«ä¸¤é¨åä¿¡æ¯ï¼å¹éæ¡ä»¶åå¨ä½ã\n\nå¹éæ¡ä»¶å³ä¸ºå¹éæ°æ®åè¢«è¿æ¡iptablesè§åâæè·âçæ¡ä»¶ï¼ä¾å¦åè®®ç±»åãæºIPãç®çIPãæºç«¯å£ãç®çç«¯å£ãè¿æ¥ç¶æç­ãæ¯æ¡iptablesè§ååè®¸å¤ä¸ªå¹éæ¡ä»¶ä»»æç»åï¼ä»èå®ç°å¤æ¡ä»¶çå¹éï¼å¤æ¡ä»¶ä¹é´æ¯é»è¾ä¸ï¼&&ï¼å³ç³»ã\n\nå¸¸è§å¨ä½å¦ä¸ï¼\n\n * ACCEPTï¼åè®¸æ°æ®åéè¿ã\n\n * DROPï¼ä¸¢å¼æ°æ®åï¼ä¸ç»åºä»»ä½ååºã\n\n * REJECTï¼æç»æ°æ®åï¼ç»åºååºåç¥åéæ¹è¢«æç»ã\n\n * SNATï¼æºå°åè½¬æ¢ï¼ç¨äºç½ç»å°åè½¬æ¢ï¼NATï¼ã\n\n * DNATï¼ç®æ å°åè½¬æ¢ï¼ç¨äºç½ç»å°åè½¬æ¢ï¼NATï¼ã\n\n * REDIRECTï¼éå®åæ°æ®åå°æå®ç«¯å£æ IP å°åã\n\n\n# iptableså½ä»¤ä½¿ç¨\n\n\n# åæ°\n\n * -Aï¼æ·»å è§åå°æå®é¾çæ«å°¾ã\n   ä¾å¦ï¼iptables -A INPUT -s 192.168.1.0/24 -j DROP\n\n * -Dï¼å é¤æå®é¾ä¸­çè§åã\n   ä¾å¦ï¼iptables -D INPUT -s 192.168.1.0/24 -j DROP\n\n * -Iï¼æå¥è§åå°æå®é¾çå¼å¤´ææå®ä½ç½®ã\n   ä¾å¦ï¼iptables -I INPUT 2 -s 192.168.1.0/24 -j DROP\n\n * -Rï¼æ¿æ¢æå®é¾ä¸­çè§åã\n   ä¾å¦ï¼iptables -R INPUT 2 -s 192.168.1.0/24 -j DROP\n\n * -Lï¼ååºæå®é¾ä¸­çè§åã\n   ä¾å¦ï¼iptables -L INPUT\n\n * -Fï¼æ¸ç©ºæå®é¾ä¸­çè§åã\n   ä¾å¦ï¼iptables -F INPUT\n\n * -Nï¼åå»ºæ°çèªå®ä¹é¾ã\n   ä¾å¦ï¼iptables -N MYCHAIN\n\n * -Xï¼å é¤æå®çèªå®ä¹é¾ã\n   ä¾å¦ï¼iptables -X MYCHAIN\n\n * -Pï¼è®¾ç½®æå®é¾çé»è®¤ç­ç¥ã\n   ä¾å¦ï¼iptables -P INPUT DROP\n\n * -sï¼æå®æº IP å°åæå°åæ®µã\n   ä¾å¦ï¼iptables -A INPUT -s 192.168.1.0/24 -j DROP\n\n * -dï¼æå®ç®æ  IP å°åæå°åæ®µã\n   ä¾å¦ï¼iptables -A OUTPUT -d 192.168.1.0/24 -j DROP\n\n * -pï¼æå®åè®®ç±»åã\n   ä¾å¦ï¼iptables -A INPUT -p tcp -j DROP\n\n * -mï¼æå®å¹éæ¨¡åã\n   ä¾å¦ï¼iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n\n * -jï¼æå®å¨ä½ã\n   ä¾å¦ï¼iptables -A INPUT -s 192.168.1.0/24 -j DROP\n\n * -iï¼æå®è¿å¥æ¥å£ã\n   ä¾å¦ï¼iptables -A INPUT -i eth0 -j DROP\n\n * -oï¼æå®è¾åºæ¥å£ã\n   ä¾å¦ï¼iptables -A OUTPUT -o eth0 -j DROP\n\n\n# å¸¸è§æ­¦å¨\n\n 1. æ¥çææiptablesè§å\n\niptables -L -n\n\n\n1\n\n 2. éç½®é²ç«å¢è§åç­ç¥\n\n * éç½®åè®¸SSHè¿æ¥\n\niptables -A INPUT -s 10.20.30.40/24 -p tcp --dport 22 -j ACCECT\n\n\n1\n\n\n-A INPUT æ¯ä»¥è¿½å çæ¹å¼å¢å è¯¥è§åå¨INPUTé¾ä¸ï¼-s 10.20.30.40/24 -p tcp --dport 22 æ¯å¹éä¸æºå°åä¸º10.20.30.40/24ç½æ®µï¼tcpåè®®åç®çç«¯å£22çæ°æ®åï¼-j ACCET è¡¨ç¤ºåè®¸è¯¥æ°æ®åè¿è¡è¿æ¥ãè¿éæ²¡ææå®è¡¨é»è®¤æ¯filterè¡¨ã\n\n * é»æ­¢æ¥èªæä¸ªIP/ç½æ®µçææè¿æ¥\n\niptables -A INPUT -s 10.10.10.10 -j DROP\n\n\n1\n\n\n-j DROP ä¼åéç»æºå°åä¸º10.10.10.10ä¸ä¸ªè¿æ¥æç»çåç¨æ¥æã\n\n * å°éç«¯å£\n\niptables -A OUTPUT -p tcp --dport 1234 -j DROP\n\n\n1\n\n\nç¦æ­¢æ¬å°è¿ç¨è®¿é®å¤é¨1234ç«¯å£ãå ä¸ºæ¯å¨æè½½OUTPUTé¾ä¸è¯¥æ¡è§åï¼æä»¥æ¯å±è½æ¬å°è¿ç¨å¯¹å¤çè¿æ¥ãå¦ææ³è¦ç¦æ­¢å¤é¨è¿æ¥è®¿é®æ¬å°1234ç«¯å£ï¼åéè¦å¨INPUTé¾ä¸æ°å¢è§åã\n\niptables -A INPUT -p tcp --dport 1234 -j DROP\n\n\n1\n\n * ç«¯å£è½¬å\n\niptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8080\n\n\n1\n\n\nè¯¥æ¡è§åæ·»å å°PREROUTINGé¾ä¸çnatè¡¨ä¸­ï¼å¹éä¸eth0ç½å¡ä¸ææç®çç«¯å£ä¸º80çtcpæ°æ®åï¼å¹éä¸åå°è½¬åå°8080ç«¯å£ä¸ãå ä¸ºå°ç®çç«¯å£æ¹åäºï¼åéè¦åå°natè¡¨ä¸­ã\n\n * ç¦ping\n\niptables -A INPUT -p icmp -j DROP\n\n\n1\n\n\nå¨INPUTé¾filterè¡¨ä¸­æ°å¢ç¦æ­¢icmpåè®®æ°æ®åçè§åã\n\n 3. DNAT\n\niptables -t nat -A PREROUTING -d 1.2.3.4 -p tcp --dport 80 -j DNAT --to-destination 10.20.30.40:8080\n\n\n1\n\n\nåç«¯å£è½¬ååçå·®ä¸å¤ï¼åºå«å¨äºï¼ç«¯å£è½¬åä¸ä¿®æ¹IPå°åï¼èè¿éä¿®æ¹äºç®çIPå°åãå¨natè¡¨PREROUTINGä¸­æ°å¢ç®çå°åä¸º1.2.3.4ï¼ç®çç«¯å£80çtcpæ°æ®åçDNATå¨ä½ï¼å°ç®çå°åæ¹ä¸ºäº10.20.30.40:8080ã\n\nDNATä»åçå¨natè¡¨çPREROUTINGé¾ä¸­ï¼å¹¶ä¸è¯¥æä½éè¦ç¡®ä¿å¼å¯ipforwardåè½ã\n\n 4. SNAT\n\niptables -t nat -A POSTROUTING -s 192.168.1.2 -j SNAT --to-source 10.172.16.1\n\n\n1\n\n\nå¨natè¡¨POSTROUTINGé¾ä¸­æ°å¢å°æºå°å192.168.1.2çæ°æ®åè¿è¡SNATæä½ï¼æ¹ä¸ºæºå°å10.172.16.1.\n\nSNATæä½ä»å¯åçå¨natè¡¨çPOSTROUTINGé¾ä¸­ã\n\n 5. ä¿å­ä¸æ¢å¤\n\niptablesè§åä¿®æ¹ä»æ¯ä¸´æ¶çï¼éå¯åä¸¢å¤±ï¼æ§è¡ä»¥ä¸å½ä»¤æ°¸ä¹ä¿å­ã\n\niptables-save\n\n\n1\n\n\nä¹å¯å°è§åä¿å­å¨æä»¶ä¸­\n\niptables-save > iptables.bak\n\n\n1\n\n\nåç»­å¯ä»¥éè¿ä»¥ä¸å½ä»¤è¿è¡æ¢å¤\n\niptables-restore < iptables.bak\n\n\n1\n\n\n\n# å·¨äººçè©è\n\n * ãkubernetesç½ç»æå¨æåã\n\nâ",normalizedContent:"# åè¯\n\n\n# iptablesæ¯ä»ä¹ï¼\n\niptablesæ¯ä¸ä¸ªå¨linuxæä½ç³»ç»ä¸ä½¿ç¨çé²ç«å¢å·¥å·ï¼å®å¯ä»¥ç¨äºéç½®åç®¡çç½ç»æ°æ®åçè¿æ»¤ãè½¬ååä¿®æ¹ç­æä½ã\n\n 1. è¿æ»¤æ°æ®åï¼iptableså¯ä»¥æ ¹æ®ä¸åçè§åè¿æ»¤ç½ç»æ°æ®åï¼ä¾å¦æ ¹æ®æºipå°åãç®æ ipå°åãç«¯å£å·ç­è¿è¡è¿æ»¤ã\n\n 2. è½¬åæ°æ®åï¼iptableså¯ä»¥å°ç½ç»æ°æ®åä»ä¸ä¸ªæ¥å£è½¬åå°å¦ä¸ä¸ªæ¥å£ï¼å®ç°ç½ç»æ°æ®çè½¬ååè½ã\n\n 3. ä¿®æ¹æ°æ®åï¼iptableså¯ä»¥ä¿®æ¹ç½ç»æ°æ®åçæºipå°åãç®æ ipå°åãç«¯å£å·ç­ä¿¡æ¯ï¼å®ç°ç½ç»æ°æ®çä¼ªè£åæ¬ºéªã\n\n\n# netfilteræ¯ä»ä¹ï¼\n\nnetfilteræ¯linuxåæ ¸ä¸­çä¸ä¸ªç½ç»æ°æ®åè¿æ»¤æ¡æ¶ï¼å®å¯ä»¥å¨æ°æ®åè¿å¥åç¦»å¼ç½ç»æ¥å£æ¶è¿è¡æ¦æªåå¤çãiptableså°±æ¯åºäºnetfilteræ¡æ¶å®ç°çä¸ä¸ªç¨æ·ç©ºé´å·¥å·ï¼å®å¯ä»¥éè¿è°ç¨netfilteræä¾çapiæ¥å®ç°ç½ç»æ°æ®åçè¿æ»¤ãè½¬ååä¿®æ¹ç­æä½ã\n\nnetfilterçæ¶æå°±æ¯å¨æ´ä¸ªç½ç»æµç¨çè¥å¹²ä½ç½®æ¾ç½®ä¸äºé©å­ï¼å¹¶å¨æ¯ä¸ªé©å­ä¸æè½½ä¸äºå¤çå½æ°è¿è¡å¤çã\n\nipå±ç5ä¸ªé©å­ç¹çä½ç½®ï¼åå«æ¯preroutingãpostroutingãinputãoutputåforwardãåçå¾å¦ä¸ï¼\n\nâ\n\nâ\n\nå½ç½å¡ä¸æ¶å°ä¸ä¸ªåéè¾¾åè®®æ æ¶ï¼æåç»è¿çnetfilteré©å­æ¯preroutingï¼å¦æç¡®å®æç¨æ·åäºè¿ä¸ªé©å­å½æ°ï¼é£ä¹åæ ¸å°å¨è¿éå¯¹æ°æ®åè¿è¡ç®çå°åè½¬æ¢ï¼dnatï¼ãä¸ç®¡å¨preroutingææ²¡æåè¿dnatï¼åæ ¸é½ä¼éè¿æ¥æ¬å°è·¯ç±è¡¨å³å®è¿ä¸ªæ°æ®åæ¯åéç»æ¬å°è¿ç¨è¿æ¯åéç»å¶ä»æºå¨ãå¦ææ¯åéç»å¶ä»æºå¨ï¼æå¶ä»network namespaceï¼ï¼å°±ç¸å½äºææ¬å°å½ä½è·¯ç±å¨ï¼å°±ä¼ç»è¿netfilterçforwardé©å­ï¼ç¨æ·å¯ä»¥å¨æ­¤å¤è®¾ç½®åè¿æ»¤é©å­å½æ°ï¼ä¾å¦iptablesçrejectå½æ°ãææé©¬ä¸è¦åå°åè®®æ å¤çåé½ä¼ç»è¿postroutingé©å­ï¼ç¨æ·å¯ä»¥å¨è¿éåä¸æºå°åè½¬æ¢ï¼snatï¼ææºå°åä¼ªè£ï¼masqueradeï¼ç®ç§°masqï¼çé©å­å½æ°ãå¦æç»è¿ä¸é¢çè·¯ç±å³ç­ï¼åæ ¸å³å®æååç»æ¬å°è¿ç¨ï¼å°±ä¼ç»è¿inputé©å­ãæ¬å°è¿ç¨æ¶å°æ°æ®ååï¼åç¨æ¥æä¼åç»è¿outputé©å­ï¼ç¶åç»è¿ä¸æ¬¡è·¯ç±å³ç­ï¼ä¾å¦ï¼å³å®ä»æºå¨çåªåç½å¡åºå»ï¼ä¸ä¸è·³å°åæ¯å¤å°ç­ï¼ï¼æååºåè®®æ çç½ç»ååæ ·ä¼ç»è¿postroutingé©å­ã\n\n\n# iptableså®ç°\n\niptablesçåºå±å®ç°æ¯éè¿linuxåæ ¸ä¸­çnetfilteræ¡æ¶æ¥å®ç°çãiptablesæ¯ç¨æ·ç©ºé´çä¸ä¸ªç¨åºï¼éè¿netlinkååæ ¸çnetfilteræ¡æ¶æäº¤éï¼è´è´£å¾é©å­ä¸éç½®åè°å½æ°ã\n\n\n\n\n# iptablesä¸æ¿æ§ï¼tableãchainårule\n\n\n# chain\n\niptablesæ5æ¡åç½®é¾åå«å¯¹åºçnetfilterç5ä¸ªé©å­ï¼\n\n * inputé¾ï¼ä¸è¬ç¨äºå¤çè¾å¥æ¬å°è¿ç¨çæ°æ®åã\n * outputé¾ï¼ä¸è¬ç¨äºå¤çæ¬å°è¿ç¨çè¾åºæ°æ®åã\n * forwardé¾ï¼ä¸è¬ç¨äºå¤çè½¬åå°å¶ä»æºå¨/network namespaceçæ°\n   æ®åã\n * preroutingé¾ï¼å¯ä»¥å¨æ­¤å¤è¿è¡dnatã\n * postroutingé¾ï¼å¯ä»¥å¨æ­¤å¤è¿è¡snatã\n\n\n# table\n\né¤äº5æ¡åç½®é¾ä¹å¤ï¼è¿å¯ä»¥å¨è¡¨ä¸­å®ä¹èªå·±çé¾ï¼\n\n * filter è¡¨ï¼ç¨äºè¿æ»¤æ°æ®åï¼æ¯é»è®¤çè¡¨ãå®åå« inputãoutput å forward ä¸ä¸ªé¾ï¼åå«ç¨äºå¤çè¿å¥æ¬æºçæ°æ®åãä»æ¬æºååºçæ°æ®ååè½¬åçæ°æ®åã\n\n * nat è¡¨ï¼ç¨äºç½ç»å°åè½¬æ¢ï¼natï¼ãå®åå« preroutingãpostrouting å output ä¸ä¸ªé¾ï¼åå«ç¨äºå¤çè¿å¥æ¬æºåçæ°æ®åãä»æ¬æºååºçæ°æ®ååæ¬æºçæçæ°æ®åã\n\n * mangle è¡¨ï¼ç¨äºä¿®æ¹æ°æ®åçç¹å®å­æ®µãå¦ ttlãtos ç­ãå®åå« preroutingãinputãforwardãoutput å postrouting äºä¸ªé¾ï¼åå«ç¨äºå¤çè¿å¥æ¬æºåçæ°æ®åãè¿å¥æ¬æºçæ°æ®åãè½¬åçæ°æ®åãä»æ¬æºååºçæ°æ®ååæ¬æºçæçæ°æ®åã\n\n * raw è¡¨ï¼ç¨äºéç½®è¿æ¥è¿½è¸ªç³»ç»ãå®åå« prerouting å output ä¸¤ä¸ªé¾ï¼åå«ç¨äºå¤çè¿å¥æ¬æºåçæ°æ®ååä»æ¬æºååºçæ°æ®åã\n\nè¿5å¼ è¡¨çä¼åçº§ä»é«å°ä½æ¯ï¼rawãmangleãnatãfilterãsecurityã\n\niptablesè¡¨ä¸é¾çå¯¹åºå³ç³»å¾å¦ä¸ï¼\n\nâ\n\n\n\nä¸åçè¡¨æä¸åçé¾ï¼è¿æ¯ä¸ºäºåç±»ç®¡çiptablesè§åï¼ruleï¼çï¼ç³»ç»ææçiptablesè§åé½è¢«ååå°ä¸åçè¡¨éåä¸­ã\n\n\n# rule\n\niptablesçè§åå°±æ¯æè½½netfilteré©å­ä¸çå½æ°ï¼ç¨æ¥ä¿®æ¹æ°æ®åçåå®¹æèè¿æ»¤æ°æ®åç­æä½ï¼iptablesçè¡¨å°±æ¯ææè§åç5ä¸ªé»è¾éåã\n\niptablesè§åå¦ä½ç¼åï¼\n\nä¸æ¡iptablesè§ååå«ä¸¤é¨åä¿¡æ¯ï¼å¹éæ¡ä»¶åå¨ä½ã\n\nå¹éæ¡ä»¶å³ä¸ºå¹éæ°æ®åè¢«è¿æ¡iptablesè§åâæè·âçæ¡ä»¶ï¼ä¾å¦åè®®ç±»åãæºipãç®çipãæºç«¯å£ãç®çç«¯å£ãè¿æ¥ç¶æç­ãæ¯æ¡iptablesè§ååè®¸å¤ä¸ªå¹éæ¡ä»¶ä»»æç»åï¼ä»èå®ç°å¤æ¡ä»¶çå¹éï¼å¤æ¡ä»¶ä¹é´æ¯é»è¾ä¸ï¼&&ï¼å³ç³»ã\n\nå¸¸è§å¨ä½å¦ä¸ï¼\n\n * acceptï¼åè®¸æ°æ®åéè¿ã\n\n * dropï¼ä¸¢å¼æ°æ®åï¼ä¸ç»åºä»»ä½ååºã\n\n * rejectï¼æç»æ°æ®åï¼ç»åºååºåç¥åéæ¹è¢«æç»ã\n\n * snatï¼æºå°åè½¬æ¢ï¼ç¨äºç½ç»å°åè½¬æ¢ï¼natï¼ã\n\n * dnatï¼ç®æ å°åè½¬æ¢ï¼ç¨äºç½ç»å°åè½¬æ¢ï¼natï¼ã\n\n * redirectï¼éå®åæ°æ®åå°æå®ç«¯å£æ ip å°åã\n\n\n# iptableså½ä»¤ä½¿ç¨\n\n\n# åæ°\n\n * -aï¼æ·»å è§åå°æå®é¾çæ«å°¾ã\n   ä¾å¦ï¼iptables -a input -s 192.168.1.0/24 -j drop\n\n * -dï¼å é¤æå®é¾ä¸­çè§åã\n   ä¾å¦ï¼iptables -d input -s 192.168.1.0/24 -j drop\n\n * -iï¼æå¥è§åå°æå®é¾çå¼å¤´ææå®ä½ç½®ã\n   ä¾å¦ï¼iptables -i input 2 -s 192.168.1.0/24 -j drop\n\n * -rï¼æ¿æ¢æå®é¾ä¸­çè§åã\n   ä¾å¦ï¼iptables -r input 2 -s 192.168.1.0/24 -j drop\n\n * -lï¼ååºæå®é¾ä¸­çè§åã\n   ä¾å¦ï¼iptables -l input\n\n * -fï¼æ¸ç©ºæå®é¾ä¸­çè§åã\n   ä¾å¦ï¼iptables -f input\n\n * -nï¼åå»ºæ°çèªå®ä¹é¾ã\n   ä¾å¦ï¼iptables -n mychain\n\n * -xï¼å é¤æå®çèªå®ä¹é¾ã\n   ä¾å¦ï¼iptables -x mychain\n\n * -pï¼è®¾ç½®æå®é¾çé»è®¤ç­ç¥ã\n   ä¾å¦ï¼iptables -p input drop\n\n * -sï¼æå®æº ip å°åæå°åæ®µã\n   ä¾å¦ï¼iptables -a input -s 192.168.1.0/24 -j drop\n\n * -dï¼æå®ç®æ  ip å°åæå°åæ®µã\n   ä¾å¦ï¼iptables -a output -d 192.168.1.0/24 -j drop\n\n * -pï¼æå®åè®®ç±»åã\n   ä¾å¦ï¼iptables -a input -p tcp -j drop\n\n * -mï¼æå®å¹éæ¨¡åã\n   ä¾å¦ï¼iptables -a input -m state --state established,related -j accept\n\n * -jï¼æå®å¨ä½ã\n   ä¾å¦ï¼iptables -a input -s 192.168.1.0/24 -j drop\n\n * -iï¼æå®è¿å¥æ¥å£ã\n   ä¾å¦ï¼iptables -a input -i eth0 -j drop\n\n * -oï¼æå®è¾åºæ¥å£ã\n   ä¾å¦ï¼iptables -a output -o eth0 -j drop\n\n\n# å¸¸è§æ­¦å¨\n\n 1. æ¥çææiptablesè§å\n\niptables -l -n\n\n\n1\n\n 2. éç½®é²ç«å¢è§åç­ç¥\n\n * éç½®åè®¸sshè¿æ¥\n\niptables -a input -s 10.20.30.40/24 -p tcp --dport 22 -j accect\n\n\n1\n\n\n-a input æ¯ä»¥è¿½å çæ¹å¼å¢å è¯¥è§åå¨inputé¾ä¸ï¼-s 10.20.30.40/24 -p tcp --dport 22 æ¯å¹éä¸æºå°åä¸º10.20.30.40/24ç½æ®µï¼tcpåè®®åç®çç«¯å£22çæ°æ®åï¼-j accet è¡¨ç¤ºåè®¸è¯¥æ°æ®åè¿è¡è¿æ¥ãè¿éæ²¡ææå®è¡¨é»è®¤æ¯filterè¡¨ã\n\n * é»æ­¢æ¥èªæä¸ªip/ç½æ®µçææè¿æ¥\n\niptables -a input -s 10.10.10.10 -j drop\n\n\n1\n\n\n-j drop ä¼åéç»æºå°åä¸º10.10.10.10ä¸ä¸ªè¿æ¥æç»çåç¨æ¥æã\n\n * å°éç«¯å£\n\niptables -a output -p tcp --dport 1234 -j drop\n\n\n1\n\n\nç¦æ­¢æ¬å°è¿ç¨è®¿é®å¤é¨1234ç«¯å£ãå ä¸ºæ¯å¨æè½½outputé¾ä¸è¯¥æ¡è§åï¼æä»¥æ¯å±è½æ¬å°è¿ç¨å¯¹å¤çè¿æ¥ãå¦ææ³è¦ç¦æ­¢å¤é¨è¿æ¥è®¿é®æ¬å°1234ç«¯å£ï¼åéè¦å¨inputé¾ä¸æ°å¢è§åã\n\niptables -a input -p tcp --dport 1234 -j drop\n\n\n1\n\n * ç«¯å£è½¬å\n\niptables -t nat -a prerouting -i eth0 -p tcp --dport 80 -j redirect --to-port 8080\n\n\n1\n\n\nè¯¥æ¡è§åæ·»å å°preroutingé¾ä¸çnatè¡¨ä¸­ï¼å¹éä¸eth0ç½å¡ä¸ææç®çç«¯å£ä¸º80çtcpæ°æ®åï¼å¹éä¸åå°è½¬åå°8080ç«¯å£ä¸ãå ä¸ºå°ç®çç«¯å£æ¹åäºï¼åéè¦åå°natè¡¨ä¸­ã\n\n * ç¦ping\n\niptables -a input -p icmp -j drop\n\n\n1\n\n\nå¨inputé¾filterè¡¨ä¸­æ°å¢ç¦æ­¢icmpåè®®æ°æ®åçè§åã\n\n 3. dnat\n\niptables -t nat -a prerouting -d 1.2.3.4 -p tcp --dport 80 -j dnat --to-destination 10.20.30.40:8080\n\n\n1\n\n\nåç«¯å£è½¬ååçå·®ä¸å¤ï¼åºå«å¨äºï¼ç«¯å£è½¬åä¸ä¿®æ¹ipå°åï¼èè¿éä¿®æ¹äºç®çipå°åãå¨natè¡¨preroutingä¸­æ°å¢ç®çå°åä¸º1.2.3.4ï¼ç®çç«¯å£80çtcpæ°æ®åçdnatå¨ä½ï¼å°ç®çå°åæ¹ä¸ºäº10.20.30.40:8080ã\n\ndnatä»åçå¨natè¡¨çpreroutingé¾ä¸­ï¼å¹¶ä¸è¯¥æä½éè¦ç¡®ä¿å¼å¯ipforwardåè½ã\n\n 4. snat\n\niptables -t nat -a postrouting -s 192.168.1.2 -j snat --to-source 10.172.16.1\n\n\n1\n\n\nå¨natè¡¨postroutingé¾ä¸­æ°å¢å°æºå°å192.168.1.2çæ°æ®åè¿è¡snatæä½ï¼æ¹ä¸ºæºå°å10.172.16.1.\n\nsnatæä½ä»å¯åçå¨natè¡¨çpostroutingé¾ä¸­ã\n\n 5. ä¿å­ä¸æ¢å¤\n\niptablesè§åä¿®æ¹ä»æ¯ä¸´æ¶çï¼éå¯åä¸¢å¤±ï¼æ§è¡ä»¥ä¸å½ä»¤æ°¸ä¹ä¿å­ã\n\niptables-save\n\n\n1\n\n\nä¹å¯å°è§åä¿å­å¨æä»¶ä¸­\n\niptables-save > iptables.bak\n\n\n1\n\n\nåç»­å¯ä»¥éè¿ä»¥ä¸å½ä»¤è¿è¡æ¢å¤\n\niptables-restore < iptables.bak\n\n\n1\n\n\n\n# å·¨äººçè©è\n\n * ãkubernetesç½ç»æå¨æåã\n\nâ",charsets:{cjk:!0},lastUpdated:"2023/05/26, 12:48:43",lastUpdatedTimestamp:1685076523e3},{title:"çè§£Linux TunTapè®¾å¤",frontmatter:{title:"çè§£Linux TunTapè®¾å¤",date:"2023-05-26T10:20:08.000Z",permalink:"/pages/143447/",categories:["ç¼ç¨","linux"],tags:["linux","è®¡ç®æºç½ç»","linuxç½ç»èæå"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"TUN/TAPæ¯æä½ç³»ç»åæ ¸ä¸­çèæç½ç»è®¾å¤ï¼å¯ä»¥å®æç¨æ·ç©ºé´ä¸åæ ¸ç©ºé´çæ°æ®çäº¤äºãç½ç»åè®®æ ä¸­çæ°æ®éè¿è¯¥è®¾å¤å¯ä»¥è¿å¥å°ç¨æ·ç©ºé´ä¸­ï¼èç¨æ·ç©ºé´ä¸­çç¨åºéè¿è¯¥è®¾å¤ç©ºé´è¿å¥å°åæ ¸ç©ºé´çç½ç»åè®®æ ã",comment:!0,feed:{enable:!0},meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/2023-04-13-2330-20230507110448-2vjzt36.png"},{name:"twitter:title",content:"çè§£Linux TunTapè®¾å¤"},{name:"twitter:description",content:"TUN/TAPæ¯æä½ç³»ç»åæ ¸ä¸­çèæç½ç»è®¾å¤ï¼å¯ä»¥å®æç¨æ·ç©ºé´ä¸åæ ¸ç©ºé´çæ°æ®çäº¤äºãç½ç»åè®®æ ä¸­çæ°æ®éè¿è¯¥è®¾å¤å¯ä»¥è¿å¥å°ç¨æ·ç©ºé´ä¸­ï¼èç¨æ·ç©ºé´ä¸­çç¨åºéè¿è¯¥è®¾å¤ç©ºé´è¿å¥å°åæ ¸ç©ºé´çç½ç»åè®®æ ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/2023-04-13-2330-20230507110448-2vjzt36.png"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/03.linux/02.%E7%90%86%E8%A7%A3Linux%20TunTap%E8%AE%BE%E5%A4%87.html"},{property:"og:type",content:"article"},{property:"og:title",content:"çè§£Linux TunTapè®¾å¤"},{property:"og:description",content:"TUN/TAPæ¯æä½ç³»ç»åæ ¸ä¸­çèæç½ç»è®¾å¤ï¼å¯ä»¥å®æç¨æ·ç©ºé´ä¸åæ ¸ç©ºé´çæ°æ®çäº¤äºãç½ç»åè®®æ ä¸­çæ°æ®éè¿è¯¥è®¾å¤å¯ä»¥è¿å¥å°ç¨æ·ç©ºé´ä¸­ï¼èç¨æ·ç©ºé´ä¸­çç¨åºéè¿è¯¥è®¾å¤ç©ºé´è¿å¥å°åæ ¸ç©ºé´çç½ç»åè®®æ ã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/2023-04-13-2330-20230507110448-2vjzt36.png"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/03.linux/02.%E7%90%86%E8%A7%A3Linux%20TunTap%E8%AE%BE%E5%A4%87.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-05-26T10:20:08.000Z"},{property:"article:tag",content:"linux"},{property:"article:tag",content:"è®¡ç®æºç½ç»"},{property:"article:tag",content:"linuxç½ç»èæå"},{itemprop:"name",content:"çè§£Linux TunTapè®¾å¤"},{itemprop:"description",content:"TUN/TAPæ¯æä½ç³»ç»åæ ¸ä¸­çèæç½ç»è®¾å¤ï¼å¯ä»¥å®æç¨æ·ç©ºé´ä¸åæ ¸ç©ºé´çæ°æ®çäº¤äºãç½ç»åè®®æ ä¸­çæ°æ®éè¿è¯¥è®¾å¤å¯ä»¥è¿å¥å°ç¨æ·ç©ºé´ä¸­ï¼èç¨æ·ç©ºé´ä¸­çç¨åºéè¿è¯¥è®¾å¤ç©ºé´è¿å¥å°åæ ¸ç©ºé´çç½ç»åè®®æ ã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/2023-04-13-2330-20230507110448-2vjzt36.png"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/03.linux/02.%E7%90%86%E8%A7%A3Linux%20TunTap%E8%AE%BE%E5%A4%87.html",relativePath:"04.ç¼ç¨/03.linux/02.çè§£Linux TunTapè®¾å¤.md",key:"v-325b46da",path:"/pages/143447/",headers:[{level:2,title:"å¥é¨",slug:"å¥é¨",normalizedTitle:"å¥é¨",charIndex:2},{level:2,title:"åºç¨ç¨åºéè¿tunè®¾å¤è·åpingæ°æ®å",slug:"åºç¨ç¨åºéè¿tunè®¾å¤è·åpingæ°æ®å",normalizedTitle:"åºç¨ç¨åºéè¿tunè®¾å¤è·åpingæ°æ®å",charIndex:293},{level:2,title:"ä½¿ç¨tunè®¾å¤å®æåºäºUDPçå®¹å¨è·¨èç¹éä¿¡",slug:"ä½¿ç¨tunè®¾å¤å®æåºäºudpçå®¹å¨è·¨èç¹éä¿¡",normalizedTitle:"ä½¿ç¨tunè®¾å¤å®æåºäºudpçå®¹å¨è·¨èç¹éä¿¡",charIndex:3535},{level:2,title:"å·¨äººçè©è",slug:"å·¨äººçè©è",normalizedTitle:"å·¨äººçè©è",charIndex:8804}],headersStr:"å¥é¨ åºç¨ç¨åºéè¿tunè®¾å¤è·åpingæ°æ®å ä½¿ç¨tunè®¾å¤å®æåºäºUDPçå®¹å¨è·¨èç¹éä¿¡ å·¨äººçè©è",content:'# å¥é¨\n\nTUN/TAPæ¯æä½ç³»ç»åæ ¸ä¸­çèæç½ç»è®¾å¤ï¼å¯ä»¥å®æç¨æ·ç©ºé´ä¸åæ ¸ç©ºé´çæ°æ®çäº¤äºãç½ç»åè®®æ ä¸­çæ°æ®éè¿è¯¥è®¾å¤å¯ä»¥è¿å¥å°ç¨æ·ç©ºé´ä¸­ï¼èç¨æ·ç©ºé´ä¸­çç¨åºéè¿è¯¥è®¾å¤ç©ºé´è¿å¥å°åæ ¸ç©ºé´çç½ç»åè®®æ ã\n\nTUNæ¨¡æçæ¯ä¸å±è®¾å¤ï¼æä½ä¸å±çæ°æ®åï¼èTAPæ¨¡æçäºå±è®¾å¤ï¼æä½äºå±çæ°æ®åã\n\n> ç©çç½å¡ä¸èæç½å¡çåºå«æ¯ï¼ç©çç½å¡æ¯å¤çä¸åæ ¸ç©ºé´çç½ç»åè®®æ æ°æ®äº¤äºçé¨æ·ï¼èèæç½å¡æ¯ç¨æ·ç©ºé´ååæ ¸ç©ºé´äº¤äºçé¨æ·ã\n\n/dev/net/tun æ¯linuxæä¾çå­ç¬¦è®¾å¤ï¼åå¥è¯¥è®¾å¤çæ°æ®ä¼åéå°èæç½å¡ä¸­ï¼èåéå°èæç½å¡ä¸­çæ°æ®ä¹ä¼åºç°å¨å­ç¬¦è®¾å¤ä¸­ã\n\n\n\nâ\n\n\n# åºç¨ç¨åºéè¿tunè®¾å¤è·åpingæ°æ®å\n\n\n\nappç¨åºéè¿æå¼tunå­ç¬¦è®¾å¤åå»ºåºtunèæç½å¡ãç¶åéè¿pingå½ä»¤åéICMPæ°æ®åå°ç½ç»åè®®æ ä¸­ï¼è¿ä¸ªè¿ç¨æ¯ä»ç¨æ·ç©ºé´å°åæ ¸ç©ºé´ï¼åéè¿è·¯ç±å°æ°æ®åè½¬åå°tunèæç½å¡ä¸­ï¼å ä¸ºtunç½å¡ç¹æ§ï¼ä¼è¿å¥å°æå¼è¯¥tunè®¾å¤ç¨æ·ç©ºé´appç¨åºä¸­ã\n\nappç¨åºä»£ç å¦ä¸ï¼\n\nimport os\nimport struct\nfrom fcntl import ioctl\n\nBUFFER_SIZE = 4096\n\n# å®æèæç½å¡çæ³¨å\nTUNSETIFF = 0x400454ca\n\n# è®¾å¤æ¨¡å¼\nIFF_TUN = 0x0001\nIFF_TAP = 0x0002\n\n\ndef create_tunnel(tun_name=\'tun%d\', tun_mode=IFF_TUN):\n    # ä»¥è¯»åçæ¹å¼æå¼å­ç¬¦è®¾å¤tunï¼è·åå°è®¾å¤æè¿°ç¬¦\n    tun_fd = os.open("/dev/net/tun", os.O_RDWR)\n\n    # å¯¹è¯¥è®¾å¤è¿è¡éç½®ï¼è®¾å¤åç§°åè®¾å¤æ¨¡å¼ã\n    ifn = ioctl(tun_fd, TUNSETIFF, struct.pack(b"16sH", tun_name.encode(), tun_mode))\n\n    # è·åå°è®¾å¤åç§°\n    tun_name = ifn[:16].decode().strip("\\x00")\n    return tun_fd, tun_name\n\n\ndef main():\n    tun_fd, tun_name = create_tunnel()\n\n    while True:\n        data = os.read(tun_fd, BUFFER_SIZE)\n        print(f"get data from tun. data size = {len(data)}")\n\n\nif __name__ == \'__main__\':\n    main()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n\nè¿è¡åè¾åºï¼\n\n# python3 tun_demo.py\nOpen tun/tap device: tun0 for reading...\n\n\n1\n2\n\n\néè¿ip a å½ä»¤åç°tunè®¾å¤å·²ç»åå»ºï¼ä½å¶ç¶æä¸ºDOWN\n\n# ip a | grep -C tun\n45: tun0: <POINTOPOINT,MULTICAST,NOARP> mtu 1500 qdisc noop state DOWN group default qlen 500\n    link/none\n\n\n1\n2\n3\n\n\nå¯¹å¶è®¾ç½®ä¸ä¸ªipå¹¶å°å®ç¶æè®¾ç½®ä¸ºUP\n\nip a add 192.37.1.2/24 dev tun0\nip link set tun0 up\n\n\n1\n2\n\n\néç½®å¥½ipåï¼ä¼åç°èªå¨éç½®äºå¦ä¸è·¯ç±:\n\n...\n192.37.1.0/24 dev tun0 proto kernel scope link src 192.37.1.2 \n...\n\n\n1\n2\n3\n\n\nåæ¬¡æ¥çtunè®¾å¤ï¼åç°å·²ç»éç½®å¥½\n\n# ip a | grep tun0\n45: tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 500\n    inet 192.37.1.1/24 scope global tun0\n\n\n1\n2\n3\n\n\nå¹¶ä¸è¿æ¶ä¼åç°tun0å·²ç»æ¥æ¶å°äº3ä¸ªæ°æ®å\n\n# python3 tun_demo.py\nOpen tun/tap device: tun0 for reading...\nget data from tun. data size = 52\nget data from tun. data size = 52\nget data from tun. data size = 52\n\n\n1\n2\n3\n4\n5\n\n\nè¿æ¶åä½¿ç¨tcpdumpçå¬tun0ï¼æ§è¡ping 192.37.1.2ï¼æ¯æååçï¼ä½æ¯tcpdumpå´æ²¡ææå°ä»»ä½åã\n\n> pingå½ä»¤ä¼æ ¹æ®ç®æ IPå°ååå­ç½æ©ç æ¥å¤æ­æ°æ®åçç®çå°ï¼å¦æç®çå°å¨æ¬å°ç½ç»ä¸­ï¼pingå½ä»¤ä¼ç´æ¥å°æ°æ®ååéå°æ¬å°ç½ç»ï¼èä¸æ¯éè¿TUNè®¾å¤åéã\n\n# tcpdump -i tun0 -n\n...\n\n# ping 192.37.1.2 -c 3\nPING 192.37.1.2 (192.37.1.2) 56(84) bytes of data.\n64 bytes from 192.37.1.2: icmp_seq=1 ttl=64 time=0.148 ms\n64 bytes from 192.37.1.2: icmp_seq=2 ttl=64 time=0.114 ms\n64 bytes from 192.37.1.2: icmp_seq=3 ttl=64 time=0.316 ms\n\n--- 192.37.1.2 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 1999ms\nrtt min/avg/max/mdev = 0.114/0.192/0.316/0.089 ms\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\næ¹ä¸ºping 192.37.1.3ï¼å¯ä»¥çå°ç¨åºæ¶å°äºæ¶å°äºæ°æ®åï¼tcpdumpä¹æå°äºåï¼ä½æ¯å ä¸ºæ²¡æåä»»ä½çå¤çä¹æ²¡æååï¼æä»¥pingå½ä»¤çå°ä¸å°ååã\n\n# python3 tun_demo.py\nOpen tun/tap device: tun0 for reading...\nget data from tun. data size = 52\nget data from tun. data size = 52\nget data from tun. data size = 52\n\nget data from tun. data size = 88\nget data from tun. data size = 88\nget data from tun. data size = 88\n\n# tcpdump -i tun0 -n\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on tun0, link-type RAW (Raw IP), capture size 262144 bytes\n22:56:41.018149 IP 192.37.1.2 > 192.37.1.3: ICMP echo request, id 22559, seq 1, length 64\n22:56:42.018871 IP 192.37.1.2 > 192.37.1.3: ICMP echo request, id 22559, seq 2, length 64\n22:56:43.022732 IP 192.37.1.2 > 192.37.1.3: ICMP echo request, id 22559, seq 3, length 64\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nâ\n\n\n# ä½¿ç¨tunè®¾å¤å®æåºäºUDPçå®¹å¨è·¨èç¹éä¿¡\n\nä½¿ç¨tunè®¾å¤åºäºUDPå®æå®¹å¨è·¨èç¹éä¿¡ãå¦ä¸å¾æç¤ºï¼\n\nâ\n\n\n\néä¿¡æµç¨æ¯ï¼å¨Node1ä¸­çNS1è¿è¡ping Node2ä¸­NS2çveth0ç½å¡çIPï¼ICMPçIPåä¼éè¿veth0å°è¾¾veth1ä¸­ï¼å¹¶è¿å¥å°å®¿ä¸»æºçç½ç»åè®®æ ï¼éè¿è·¯ç±éç½®è¾¾å°tunè®¾å¤ï¼è¿æ¶appæå¡ä»tunè®¾å¤ä¸­è¯»åå°IPåæ°æ®ï¼ç¶åå°å¶å°è£å¨UDPåä¸­ï¼å¹¶éè¿eth0ç½å¡åéå°Node2çeth0ç½å¡ä¸ï¼éè¿ç½ç»åè®®æ è§£åè¾¾å°appç¨åºä¸­ï¼æ¿å°éé¢çIPåï¼å°å¶åå¥å°tunè®¾å¤ä¸­ï¼è¿å¥å°ç½ç»åè®®æ ä¸­ï¼éè¿è·¯ç±è¾¾å°veth1ä¸­ï¼ç¶åå°è¾¾net ns1çveth0ç½å¡ã\n\nappç¨åºç®åå®ç°å¦ä¸ï¼\n\nimport os\nimport socket\nimport struct\nimport threading\nfrom fcntl import ioctl\nimport click\n\nBIND_ADDRESS = (\'0.0.0.0\', 7000)\nBUFFER_SIZE = 4096\n\nTUNSETIFF = 0x400454ca\nIFF_TUN = 0x0001\nIFF_TAP = 0x0002\n\n\ndef create_tunnel(tun_name=\'tun%d\', tun_mode=IFF_TUN):\n    tun_fd = os.open("/dev/net/tun", os.O_RDWR)\n    ifn = ioctl(tun_fd, TUNSETIFF, struct.pack(b"16sH", tun_name.encode(), tun_mode))\n    tun_name = ifn[:16].decode().strip("\\x00")\n    return tun_fd, tun_name\n\n\ndef start_tunnel(tun_name):\n    os.popen(f"ip link set {tun_name} up")\n\n\ndef udp_server(udp_socket, tun_fd):\n    while True:\n        data, addr = udp_socket.recvfrom(2048)\n        print("get data from udp.")\n        if not data:\n            break\n\n        os.write(tun_fd, data)\n\n\n@click.command()\n@click.option("--peer_node_ip", "-p", required=True, help="å¯¹ç«¯èç¹IP")\ndef main(peer_node_ip):\n    peer_node_addr = (peer_node_ip, 7000)\n\n    tun_fd, tun_name = create_tunnel()\n    start_tunnel(tun_name)\n\n    udp_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n    udp_socket.bind(BIND_ADDRESS)\n\n    t = threading.Thread(target=udp_server, args=(udp_socket, tun_fd))\n    t.daemon = True\n    t.start()\n\n    while True:\n        data = os.read(tun_fd, BUFFER_SIZE)\n        print(f"get data from tun. data size = {len(data)}")\n        udp_socket.sendto(data, peer_node_addr)\n\n\nif __name__ == \'__main__\':\n    main()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n\n\nå¨Node1ä¸­è¿è¡è¯¥ç¨åºï¼è®¾ç½®Node2 IP\n\npython3 tun_app.py -p 10.65.132.187\n\n\n1\n\n\nå¯ä»¥çå°å·²ç»åå»ºäºtunè®¾å¤\n\n# ip link show tun0\n...\n109: tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 500\n    link/none \n    inet6 fe80::8e98:91a4:6537:d77a/64 scope link flags 800 \n       valid_lft forever preferred_lft forever\n...\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå¨Node1ä¸­åå»ºNetwork Namespaceå½åä¸ºnet1ï¼ä½¿ç¨å®æ¥å®ææ¨¡æå®¹å¨ç½ç»ã\n\nip netns add net1\n\n\n1\n\n\nç¶ååå»ºveth pairï¼å®ä»¬æ¯ä¸å¯¹ç½å¡ï¼åå«ä¸ºå½åä¸ºveth0åveth1\n\nip link add veth0 type veth peer name veth1\n\n\n1\n\n\nå°å¶ä¸ç«¯æ¥å¥å°net1ä¸­ï¼å¹¶è®¾ç½®å¥½å¶IPå°åä¸º10.1.1.2/24\n\nip link set dev veth0 netns net1\nip netns exec net1 ip addr add 10.1.1.2/24 dev veth0\nip netns exec net1 ip link set dev veth0 up\n\n\n1\n2\n3\n\n\nå¼å¯å¨å®¿ä¸»æºä¸çveth1ç½å¡ï¼å¹¶è®¾ç½®å¶IPä¸º10.1.1.1/24\n\nip a add 10.1.1.1/24 dev veth1\nip link set dev veth1 up\n\n\n1\n2\n\n\nåå°net1ä¸­çé»è®¤è·¯ç±è®¾ç½®æé½èµ°veth0ï¼è¿æ ·ï¼ping Node2ä¸­net2çç½ç»åå¯ä»¥å°veth1ä¸­ï¼ä¹å°±è¿å¥å°äºå®¿ä¸»æºçç½ç»åè®®æ ä¸­ã\n\nip netns exec net1 ip r add default via 10.1.1.1 dev veth0\n\n\n1\n\n\nå¨å®¿ä¸»æºä¸è¿éè¦æ·»å è·¯ç±ï¼è®¿é®Node2ä¸­net2æ¶é½è·¯ç±å°tun0è®¾å¤\n\nip r add 10.1.2.0/24 dev tun0\n\n\n1\n\n\nè¿æ¶ï¼å¨Node1 net1ä¸­ping Node2 net2æ¶ï¼æ­£å¸¸æ¥è¯´æ¯å¯ä»¥å¨appä¸­çå°ä»tunæ¶å°IPåçï¼è½ç¶æ²¡æååï¼é£æ¯å ä¸ºappç¨åºæ¶å°ååæ²¡æåä»»ä½ååæä½ã\n\n# ip netns exec net1 ping 10.1.2.2 -c 3\nPING 10.1.2.2 (10.1.2.2) 56(84) bytes of data.\n--- 10.1.2.2 ping statistics ---\n3 packets transmitted, 0 received, 100% packet loss, time 2001ms\n\n\n1\n2\n3\n4\n\n\næä»¬éè¿tcpdumpæåveth1ç½å¡ï¼å¯ä»¥çå°æ¶å°äºARPè¯·æ±ï¼æ³è¦è·å10.1.2.2çMACå°åï¼ä½æ¯ä¸ç´è·åä¸å°ï¼æä»¥å¯¼è´IPåæ æ³éè¿è·¯ç±è¾¾å°TUNè®¾å¤\n\n# tcpdump -i veth1 -n\n00:45:13.988076 ARP, Request who-has 10.1.2.2 tell 10.1.1.2, length 28\n\n\n1\n2\n\n\nè¿ä¸ªæ¶åéè¦å¼å¯veth1çarpä»£çï¼å°veth1çMACå°åä½ä¸ºARPçåå¤ã\n\necho 1 >  /proc/sys/net/ipv4/conf/veth1/proxy_arp\n\n\n1\n\n\nåæ¬¡ping Node2 net2æ¶ï¼å¯ä»¥çå°tcpdumpçå°ARPä¸­åå¤çMACå°åä¸ºveth1çå°åã\n\n# tcpdump -i veth1 -n\n00:45:13.988076 ARP, Request who-has 10.1.2.2 tell 10.1.1.2, length 28\n00:45:13.988100 ARP, Reply 10.1.2.2 is-at 4e:7c:bf:fe:4d:0f, length 28\n\n# ip a | grep -C 3 veth1\n...\n107: veth1@if108: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 4e:7c:bf:fe:4d:0f brd ff:ff:ff:ff:ff:ff link-netnsid 3\n    inet 10.1.1.1/24 scope global veth1\n       valid_lft forever preferred_lft forever\n...\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå¹¶ä¸appç¨åºä¸­ä¹ä»tunè®¾å¤ä¸­è·åå°äºIPåã\n\n# python3 tun_app.py -p 10.65.132.187\nget data from tun. data size = 52\nget data from tun. data size = 52\nget data from tun. data size = 52\nget data from tun. data size = 88\nget data from tun. data size = 88\nget data from tun. data size = 88\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå°è¿ä¸æ­¥ï¼Node1çåºæ¬éç½®å®æï¼æ¥ä¸æ¥éç½®Node2ï¼éç½®çæ¹æ³ä¸Node1ä¸è´ï¼å¨Node2æ§è¡å½ä»¤å¦ä¸:\n\n# å¼å¯appç¨åº\npython3 tun_app.py -p 10.61.74.37\n\n# æ°å¢network namespace net2\nip netns add net2\n\n# æ°å¢veth pairè®¾å¤\nip link add veth0 type veth peer name veth1\n\n# éç½®veth pairè®¾å¤\nip link set dev veth0 netns net2\nip netns exec net2 ip addr add 10.1.2.2/24 dev veth0\nip netns exec net2 ip link set dev veth0 up\n\nip a add 10.1.2.1/24 dev veth1\nip link set dev veth1 up\n\n# æ·»å é»è®¤è·¯ç±\nip netns exec net2 ip r add default via 10.1.2.1 dev veth0\n\n# æ·»å tun0è®¾å¤è·¯ç±\nip r add 10.1.1.0/24 dev tun0\n\n# å¼å¯arpä»£ç\necho 1 >  /proc/sys/net/ipv4/conf/veth1/proxy_arp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\néç½®å®æåï¼å¨Node1çnet1ä¸­ping Node2çnet2ï¼å¯ä»¥pingéæååã\n\n# ip netns exec net1 ping 10.1.2.2 \nPING 10.1.2.2 (10.1.2.2) 56(84) bytes of data.\n64 bytes from 10.1.2.2: icmp_seq=1 ttl=62 time=5.46 ms\n64 bytes from 10.1.2.2: icmp_seq=2 ttl=62 time=4.67 ms\n64 bytes from 10.1.2.2: icmp_seq=3 ttl=62 time=5.52 ms\n\n\n1\n2\n3\n4\n5\n\n\n\n# å·¨äººçè©è\n\n * Linux Tun/Tap ä»ç»\n\n * çè§£ Linux èæç½å¡è®¾å¤ tun/tap çä¸å\n\n * åºäºtunè®¾å¤å®ç°å¨ç¨æ·ç©ºé´å¯ä»¥pingéå¤é¨èç¹(golangçæ¬)\n\n * ä¸èµ·å¨æåä¸ä¸ªVPN\n\nâ',normalizedContent:'# å¥é¨\n\ntun/tapæ¯æä½ç³»ç»åæ ¸ä¸­çèæç½ç»è®¾å¤ï¼å¯ä»¥å®æç¨æ·ç©ºé´ä¸åæ ¸ç©ºé´çæ°æ®çäº¤äºãç½ç»åè®®æ ä¸­çæ°æ®éè¿è¯¥è®¾å¤å¯ä»¥è¿å¥å°ç¨æ·ç©ºé´ä¸­ï¼èç¨æ·ç©ºé´ä¸­çç¨åºéè¿è¯¥è®¾å¤ç©ºé´è¿å¥å°åæ ¸ç©ºé´çç½ç»åè®®æ ã\n\ntunæ¨¡æçæ¯ä¸å±è®¾å¤ï¼æä½ä¸å±çæ°æ®åï¼ètapæ¨¡æçäºå±è®¾å¤ï¼æä½äºå±çæ°æ®åã\n\n> ç©çç½å¡ä¸èæç½å¡çåºå«æ¯ï¼ç©çç½å¡æ¯å¤çä¸åæ ¸ç©ºé´çç½ç»åè®®æ æ°æ®äº¤äºçé¨æ·ï¼èèæç½å¡æ¯ç¨æ·ç©ºé´ååæ ¸ç©ºé´äº¤äºçé¨æ·ã\n\n/dev/net/tun æ¯linuxæä¾çå­ç¬¦è®¾å¤ï¼åå¥è¯¥è®¾å¤çæ°æ®ä¼åéå°èæç½å¡ä¸­ï¼èåéå°èæç½å¡ä¸­çæ°æ®ä¹ä¼åºç°å¨å­ç¬¦è®¾å¤ä¸­ã\n\n\n\nâ\n\n\n# åºç¨ç¨åºéè¿tunè®¾å¤è·åpingæ°æ®å\n\n\n\nappç¨åºéè¿æå¼tunå­ç¬¦è®¾å¤åå»ºåºtunèæç½å¡ãç¶åéè¿pingå½ä»¤åéicmpæ°æ®åå°ç½ç»åè®®æ ä¸­ï¼è¿ä¸ªè¿ç¨æ¯ä»ç¨æ·ç©ºé´å°åæ ¸ç©ºé´ï¼åéè¿è·¯ç±å°æ°æ®åè½¬åå°tunèæç½å¡ä¸­ï¼å ä¸ºtunç½å¡ç¹æ§ï¼ä¼è¿å¥å°æå¼è¯¥tunè®¾å¤ç¨æ·ç©ºé´appç¨åºä¸­ã\n\nappç¨åºä»£ç å¦ä¸ï¼\n\nimport os\nimport struct\nfrom fcntl import ioctl\n\nbuffer_size = 4096\n\n# å®æèæç½å¡çæ³¨å\ntunsetiff = 0x400454ca\n\n# è®¾å¤æ¨¡å¼\niff_tun = 0x0001\niff_tap = 0x0002\n\n\ndef create_tunnel(tun_name=\'tun%d\', tun_mode=iff_tun):\n    # ä»¥è¯»åçæ¹å¼æå¼å­ç¬¦è®¾å¤tunï¼è·åå°è®¾å¤æè¿°ç¬¦\n    tun_fd = os.open("/dev/net/tun", os.o_rdwr)\n\n    # å¯¹è¯¥è®¾å¤è¿è¡éç½®ï¼è®¾å¤åç§°åè®¾å¤æ¨¡å¼ã\n    ifn = ioctl(tun_fd, tunsetiff, struct.pack(b"16sh", tun_name.encode(), tun_mode))\n\n    # è·åå°è®¾å¤åç§°\n    tun_name = ifn[:16].decode().strip("\\x00")\n    return tun_fd, tun_name\n\n\ndef main():\n    tun_fd, tun_name = create_tunnel()\n\n    while true:\n        data = os.read(tun_fd, buffer_size)\n        print(f"get data from tun. data size = {len(data)}")\n\n\nif __name__ == \'__main__\':\n    main()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n\nè¿è¡åè¾åºï¼\n\n# python3 tun_demo.py\nopen tun/tap device: tun0 for reading...\n\n\n1\n2\n\n\néè¿ip a å½ä»¤åç°tunè®¾å¤å·²ç»åå»ºï¼ä½å¶ç¶æä¸ºdown\n\n# ip a | grep -c tun\n45: tun0: <pointopoint,multicast,noarp> mtu 1500 qdisc noop state down group default qlen 500\n    link/none\n\n\n1\n2\n3\n\n\nå¯¹å¶è®¾ç½®ä¸ä¸ªipå¹¶å°å®ç¶æè®¾ç½®ä¸ºup\n\nip a add 192.37.1.2/24 dev tun0\nip link set tun0 up\n\n\n1\n2\n\n\néç½®å¥½ipåï¼ä¼åç°èªå¨éç½®äºå¦ä¸è·¯ç±:\n\n...\n192.37.1.0/24 dev tun0 proto kernel scope link src 192.37.1.2 \n...\n\n\n1\n2\n3\n\n\nåæ¬¡æ¥çtunè®¾å¤ï¼åç°å·²ç»éç½®å¥½\n\n# ip a | grep tun0\n45: tun0: <pointopoint,multicast,noarp,up,lower_up> mtu 1500 qdisc pfifo_fast state unknown group default qlen 500\n    inet 192.37.1.1/24 scope global tun0\n\n\n1\n2\n3\n\n\nå¹¶ä¸è¿æ¶ä¼åç°tun0å·²ç»æ¥æ¶å°äº3ä¸ªæ°æ®å\n\n# python3 tun_demo.py\nopen tun/tap device: tun0 for reading...\nget data from tun. data size = 52\nget data from tun. data size = 52\nget data from tun. data size = 52\n\n\n1\n2\n3\n4\n5\n\n\nè¿æ¶åä½¿ç¨tcpdumpçå¬tun0ï¼æ§è¡ping 192.37.1.2ï¼æ¯æååçï¼ä½æ¯tcpdumpå´æ²¡ææå°ä»»ä½åã\n\n> pingå½ä»¤ä¼æ ¹æ®ç®æ ipå°ååå­ç½æ©ç æ¥å¤æ­æ°æ®åçç®çå°ï¼å¦æç®çå°å¨æ¬å°ç½ç»ä¸­ï¼pingå½ä»¤ä¼ç´æ¥å°æ°æ®ååéå°æ¬å°ç½ç»ï¼èä¸æ¯éè¿tunè®¾å¤åéã\n\n# tcpdump -i tun0 -n\n...\n\n# ping 192.37.1.2 -c 3\nping 192.37.1.2 (192.37.1.2) 56(84) bytes of data.\n64 bytes from 192.37.1.2: icmp_seq=1 ttl=64 time=0.148 ms\n64 bytes from 192.37.1.2: icmp_seq=2 ttl=64 time=0.114 ms\n64 bytes from 192.37.1.2: icmp_seq=3 ttl=64 time=0.316 ms\n\n--- 192.37.1.2 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 1999ms\nrtt min/avg/max/mdev = 0.114/0.192/0.316/0.089 ms\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\næ¹ä¸ºping 192.37.1.3ï¼å¯ä»¥çå°ç¨åºæ¶å°äºæ¶å°äºæ°æ®åï¼tcpdumpä¹æå°äºåï¼ä½æ¯å ä¸ºæ²¡æåä»»ä½çå¤çä¹æ²¡æååï¼æä»¥pingå½ä»¤çå°ä¸å°ååã\n\n# python3 tun_demo.py\nopen tun/tap device: tun0 for reading...\nget data from tun. data size = 52\nget data from tun. data size = 52\nget data from tun. data size = 52\n\nget data from tun. data size = 88\nget data from tun. data size = 88\nget data from tun. data size = 88\n\n# tcpdump -i tun0 -n\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on tun0, link-type raw (raw ip), capture size 262144 bytes\n22:56:41.018149 ip 192.37.1.2 > 192.37.1.3: icmp echo request, id 22559, seq 1, length 64\n22:56:42.018871 ip 192.37.1.2 > 192.37.1.3: icmp echo request, id 22559, seq 2, length 64\n22:56:43.022732 ip 192.37.1.2 > 192.37.1.3: icmp echo request, id 22559, seq 3, length 64\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nâ\n\n\n# ä½¿ç¨tunè®¾å¤å®æåºäºudpçå®¹å¨è·¨èç¹éä¿¡\n\nä½¿ç¨tunè®¾å¤åºäºudpå®æå®¹å¨è·¨èç¹éä¿¡ãå¦ä¸å¾æç¤ºï¼\n\nâ\n\n\n\néä¿¡æµç¨æ¯ï¼å¨node1ä¸­çns1è¿è¡ping node2ä¸­ns2çveth0ç½å¡çipï¼icmpçipåä¼éè¿veth0å°è¾¾veth1ä¸­ï¼å¹¶è¿å¥å°å®¿ä¸»æºçç½ç»åè®®æ ï¼éè¿è·¯ç±éç½®è¾¾å°tunè®¾å¤ï¼è¿æ¶appæå¡ä»tunè®¾å¤ä¸­è¯»åå°ipåæ°æ®ï¼ç¶åå°å¶å°è£å¨udpåä¸­ï¼å¹¶éè¿eth0ç½å¡åéå°node2çeth0ç½å¡ä¸ï¼éè¿ç½ç»åè®®æ è§£åè¾¾å°appç¨åºä¸­ï¼æ¿å°éé¢çipåï¼å°å¶åå¥å°tunè®¾å¤ä¸­ï¼è¿å¥å°ç½ç»åè®®æ ä¸­ï¼éè¿è·¯ç±è¾¾å°veth1ä¸­ï¼ç¶åå°è¾¾net ns1çveth0ç½å¡ã\n\nappç¨åºç®åå®ç°å¦ä¸ï¼\n\nimport os\nimport socket\nimport struct\nimport threading\nfrom fcntl import ioctl\nimport click\n\nbind_address = (\'0.0.0.0\', 7000)\nbuffer_size = 4096\n\ntunsetiff = 0x400454ca\niff_tun = 0x0001\niff_tap = 0x0002\n\n\ndef create_tunnel(tun_name=\'tun%d\', tun_mode=iff_tun):\n    tun_fd = os.open("/dev/net/tun", os.o_rdwr)\n    ifn = ioctl(tun_fd, tunsetiff, struct.pack(b"16sh", tun_name.encode(), tun_mode))\n    tun_name = ifn[:16].decode().strip("\\x00")\n    return tun_fd, tun_name\n\n\ndef start_tunnel(tun_name):\n    os.popen(f"ip link set {tun_name} up")\n\n\ndef udp_server(udp_socket, tun_fd):\n    while true:\n        data, addr = udp_socket.recvfrom(2048)\n        print("get data from udp.")\n        if not data:\n            break\n\n        os.write(tun_fd, data)\n\n\n@click.command()\n@click.option("--peer_node_ip", "-p", required=true, help="å¯¹ç«¯èç¹ip")\ndef main(peer_node_ip):\n    peer_node_addr = (peer_node_ip, 7000)\n\n    tun_fd, tun_name = create_tunnel()\n    start_tunnel(tun_name)\n\n    udp_socket = socket.socket(socket.af_inet, socket.sock_dgram)\n    udp_socket.bind(bind_address)\n\n    t = threading.thread(target=udp_server, args=(udp_socket, tun_fd))\n    t.daemon = true\n    t.start()\n\n    while true:\n        data = os.read(tun_fd, buffer_size)\n        print(f"get data from tun. data size = {len(data)}")\n        udp_socket.sendto(data, peer_node_addr)\n\n\nif __name__ == \'__main__\':\n    main()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n\n\nå¨node1ä¸­è¿è¡è¯¥ç¨åºï¼è®¾ç½®node2 ip\n\npython3 tun_app.py -p 10.65.132.187\n\n\n1\n\n\nå¯ä»¥çå°å·²ç»åå»ºäºtunè®¾å¤\n\n# ip link show tun0\n...\n109: tun0: <pointopoint,multicast,noarp,up,lower_up> mtu 1500 qdisc pfifo_fast state unknown group default qlen 500\n    link/none \n    inet6 fe80::8e98:91a4:6537:d77a/64 scope link flags 800 \n       valid_lft forever preferred_lft forever\n...\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå¨node1ä¸­åå»ºnetwork namespaceå½åä¸ºnet1ï¼ä½¿ç¨å®æ¥å®ææ¨¡æå®¹å¨ç½ç»ã\n\nip netns add net1\n\n\n1\n\n\nç¶ååå»ºveth pairï¼å®ä»¬æ¯ä¸å¯¹ç½å¡ï¼åå«ä¸ºå½åä¸ºveth0åveth1\n\nip link add veth0 type veth peer name veth1\n\n\n1\n\n\nå°å¶ä¸ç«¯æ¥å¥å°net1ä¸­ï¼å¹¶è®¾ç½®å¥½å¶ipå°åä¸º10.1.1.2/24\n\nip link set dev veth0 netns net1\nip netns exec net1 ip addr add 10.1.1.2/24 dev veth0\nip netns exec net1 ip link set dev veth0 up\n\n\n1\n2\n3\n\n\nå¼å¯å¨å®¿ä¸»æºä¸çveth1ç½å¡ï¼å¹¶è®¾ç½®å¶ipä¸º10.1.1.1/24\n\nip a add 10.1.1.1/24 dev veth1\nip link set dev veth1 up\n\n\n1\n2\n\n\nåå°net1ä¸­çé»è®¤è·¯ç±è®¾ç½®æé½èµ°veth0ï¼è¿æ ·ï¼ping node2ä¸­net2çç½ç»åå¯ä»¥å°veth1ä¸­ï¼ä¹å°±è¿å¥å°äºå®¿ä¸»æºçç½ç»åè®®æ ä¸­ã\n\nip netns exec net1 ip r add default via 10.1.1.1 dev veth0\n\n\n1\n\n\nå¨å®¿ä¸»æºä¸è¿éè¦æ·»å è·¯ç±ï¼è®¿é®node2ä¸­net2æ¶é½è·¯ç±å°tun0è®¾å¤\n\nip r add 10.1.2.0/24 dev tun0\n\n\n1\n\n\nè¿æ¶ï¼å¨node1 net1ä¸­ping node2 net2æ¶ï¼æ­£å¸¸æ¥è¯´æ¯å¯ä»¥å¨appä¸­çå°ä»tunæ¶å°ipåçï¼è½ç¶æ²¡æååï¼é£æ¯å ä¸ºappç¨åºæ¶å°ååæ²¡æåä»»ä½ååæä½ã\n\n# ip netns exec net1 ping 10.1.2.2 -c 3\nping 10.1.2.2 (10.1.2.2) 56(84) bytes of data.\n--- 10.1.2.2 ping statistics ---\n3 packets transmitted, 0 received, 100% packet loss, time 2001ms\n\n\n1\n2\n3\n4\n\n\næä»¬éè¿tcpdumpæåveth1ç½å¡ï¼å¯ä»¥çå°æ¶å°äºarpè¯·æ±ï¼æ³è¦è·å10.1.2.2çmacå°åï¼ä½æ¯ä¸ç´è·åä¸å°ï¼æä»¥å¯¼è´ipåæ æ³éè¿è·¯ç±è¾¾å°tunè®¾å¤\n\n# tcpdump -i veth1 -n\n00:45:13.988076 arp, request who-has 10.1.2.2 tell 10.1.1.2, length 28\n\n\n1\n2\n\n\nè¿ä¸ªæ¶åéè¦å¼å¯veth1çarpä»£çï¼å°veth1çmacå°åä½ä¸ºarpçåå¤ã\n\necho 1 >  /proc/sys/net/ipv4/conf/veth1/proxy_arp\n\n\n1\n\n\nåæ¬¡ping node2 net2æ¶ï¼å¯ä»¥çå°tcpdumpçå°arpä¸­åå¤çmacå°åä¸ºveth1çå°åã\n\n# tcpdump -i veth1 -n\n00:45:13.988076 arp, request who-has 10.1.2.2 tell 10.1.1.2, length 28\n00:45:13.988100 arp, reply 10.1.2.2 is-at 4e:7c:bf:fe:4d:0f, length 28\n\n# ip a | grep -c 3 veth1\n...\n107: veth1@if108: <broadcast,multicast,up,lower_up> mtu 1500 qdisc noqueue state up group default qlen 1000\n    link/ether 4e:7c:bf:fe:4d:0f brd ff:ff:ff:ff:ff:ff link-netnsid 3\n    inet 10.1.1.1/24 scope global veth1\n       valid_lft forever preferred_lft forever\n...\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå¹¶ä¸appç¨åºä¸­ä¹ä»tunè®¾å¤ä¸­è·åå°äºipåã\n\n# python3 tun_app.py -p 10.65.132.187\nget data from tun. data size = 52\nget data from tun. data size = 52\nget data from tun. data size = 52\nget data from tun. data size = 88\nget data from tun. data size = 88\nget data from tun. data size = 88\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå°è¿ä¸æ­¥ï¼node1çåºæ¬éç½®å®æï¼æ¥ä¸æ¥éç½®node2ï¼éç½®çæ¹æ³ä¸node1ä¸è´ï¼å¨node2æ§è¡å½ä»¤å¦ä¸:\n\n# å¼å¯appç¨åº\npython3 tun_app.py -p 10.61.74.37\n\n# æ°å¢network namespace net2\nip netns add net2\n\n# æ°å¢veth pairè®¾å¤\nip link add veth0 type veth peer name veth1\n\n# éç½®veth pairè®¾å¤\nip link set dev veth0 netns net2\nip netns exec net2 ip addr add 10.1.2.2/24 dev veth0\nip netns exec net2 ip link set dev veth0 up\n\nip a add 10.1.2.1/24 dev veth1\nip link set dev veth1 up\n\n# æ·»å é»è®¤è·¯ç±\nip netns exec net2 ip r add default via 10.1.2.1 dev veth0\n\n# æ·»å tun0è®¾å¤è·¯ç±\nip r add 10.1.1.0/24 dev tun0\n\n# å¼å¯arpä»£ç\necho 1 >  /proc/sys/net/ipv4/conf/veth1/proxy_arp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\néç½®å®æåï¼å¨node1çnet1ä¸­ping node2çnet2ï¼å¯ä»¥pingéæååã\n\n# ip netns exec net1 ping 10.1.2.2 \nping 10.1.2.2 (10.1.2.2) 56(84) bytes of data.\n64 bytes from 10.1.2.2: icmp_seq=1 ttl=62 time=5.46 ms\n64 bytes from 10.1.2.2: icmp_seq=2 ttl=62 time=4.67 ms\n64 bytes from 10.1.2.2: icmp_seq=3 ttl=62 time=5.52 ms\n\n\n1\n2\n3\n4\n5\n\n\n\n# å·¨äººçè©è\n\n * linux tun/tap ä»ç»\n\n * çè§£ linux èæç½å¡è®¾å¤ tun/tap çä¸å\n\n * åºäºtunè®¾å¤å®ç°å¨ç¨æ·ç©ºé´å¯ä»¥pingéå¤é¨èç¹(golangçæ¬)\n\n * ä¸èµ·å¨æåä¸ä¸ªvpn\n\nâ',charsets:{cjk:!0},lastUpdated:"2023/05/26, 12:48:43",lastUpdatedTimestamp:1685076523e3},{title:"çè§£VXLANç½ç»",frontmatter:{title:"çè§£VXLANç½ç»",date:"2023-05-26T11:38:14.000Z",permalink:"/pages/8a4b28/",categories:["ç¼ç¨","linux"],tags:["linux","è®¡ç®æºç½ç»","linuxç½ç»èæå"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"å¨ä¸å±å¯è¾¾çç½ç»ä¸­é¨ç½²VXLANï¼å¨æ¯ä¸ªVXLANç½ç»ç«¯ç¹ä¸­é½æä¸ä¸ªVTEPè®¾å¤ï¼è´è´£å°VXLANåè®®çæ°æ®åè¿è¡UDPæ°æ®åçå°ååè§£åï¼å¯ä»¥å°å¶çè§£ä¸ºé§éï¼å°VXLANæ°æ®åä»é»è¾ç½ç»è½¬åå°ç©çç½ç»",comment:!0,feed:{enable:!0},meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20230526124522.png"},{name:"twitter:title",content:"çè§£VXLANç½ç»"},{name:"twitter:description",content:"å¨ä¸å±å¯è¾¾çç½ç»ä¸­é¨ç½²VXLANï¼å¨æ¯ä¸ªVXLANç½ç»ç«¯ç¹ä¸­é½æä¸ä¸ªVTEPè®¾å¤ï¼è´è´£å°VXLANåè®®çæ°æ®åè¿è¡UDPæ°æ®åçå°ååè§£åï¼å¯ä»¥å°å¶çè§£ä¸ºé§éï¼å°VXLANæ°æ®åä»é»è¾ç½ç»è½¬åå°ç©çç½ç»"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20230526124522.png"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/03.linux/03.%E7%90%86%E8%A7%A3VXLAN%E7%BD%91%E7%BB%9C.html"},{property:"og:type",content:"article"},{property:"og:title",content:"çè§£VXLANç½ç»"},{property:"og:description",content:"å¨ä¸å±å¯è¾¾çç½ç»ä¸­é¨ç½²VXLANï¼å¨æ¯ä¸ªVXLANç½ç»ç«¯ç¹ä¸­é½æä¸ä¸ªVTEPè®¾å¤ï¼è´è´£å°VXLANåè®®çæ°æ®åè¿è¡UDPæ°æ®åçå°ååè§£åï¼å¯ä»¥å°å¶çè§£ä¸ºé§éï¼å°VXLANæ°æ®åä»é»è¾ç½ç»è½¬åå°ç©çç½ç»"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20230526124522.png"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/03.linux/03.%E7%90%86%E8%A7%A3VXLAN%E7%BD%91%E7%BB%9C.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-05-26T11:38:14.000Z"},{property:"article:tag",content:"linux"},{property:"article:tag",content:"è®¡ç®æºç½ç»"},{property:"article:tag",content:"linuxç½ç»èæå"},{itemprop:"name",content:"çè§£VXLANç½ç»"},{itemprop:"description",content:"å¨ä¸å±å¯è¾¾çç½ç»ä¸­é¨ç½²VXLANï¼å¨æ¯ä¸ªVXLANç½ç»ç«¯ç¹ä¸­é½æä¸ä¸ªVTEPè®¾å¤ï¼è´è´£å°VXLANåè®®çæ°æ®åè¿è¡UDPæ°æ®åçå°ååè§£åï¼å¯ä»¥å°å¶çè§£ä¸ºé§éï¼å°VXLANæ°æ®åä»é»è¾ç½ç»è½¬åå°ç©çç½ç»"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20230526124522.png"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/03.linux/03.%E7%90%86%E8%A7%A3VXLAN%E7%BD%91%E7%BB%9C.html",relativePath:"04.ç¼ç¨/03.linux/03.çè§£VXLANç½ç».md",key:"v-3e69314c",path:"/pages/8a4b28/",headers:[{level:2,title:"ä»ä¹æ¯VXLAN?",slug:"ä»ä¹æ¯vxlan",normalizedTitle:"ä»ä¹æ¯vxlan?",charIndex:2},{level:2,title:"ç¹å¯¹ç¹çVXLAN",slug:"ç¹å¯¹ç¹çvxlan",normalizedTitle:"ç¹å¯¹ç¹çvxlan",charIndex:159},{level:3,title:"å®æ",slug:"å®æ",normalizedTitle:"å®æ",charIndex:205},{level:3,title:"å¼æµ",slug:"å¼æµ",normalizedTitle:"å¼æµ",charIndex:2072},{level:2,title:"VXLANçå¤æ­æ¨¡å¼",slug:"vxlançå¤æ­æ¨¡å¼",normalizedTitle:"vxlançå¤æ­æ¨¡å¼",charIndex:4578},{level:3,title:"éä¿¡è¿ç¨",slug:"éä¿¡è¿ç¨",normalizedTitle:"éä¿¡è¿ç¨",charIndex:4633},{level:3,title:"ç¯å¢åå¤",slug:"ç¯å¢åå¤",normalizedTitle:"ç¯å¢åå¤",charIndex:5250},{level:3,title:"å¼å§åæ",slug:"å¼å§åæ",normalizedTitle:"å¼å§åæ",charIndex:6883},{level:2,title:"VXLANå¤æ­æ¨¡å¼+æ¡¥æ¥",slug:"vxlanå¤æ­æ¨¡å¼-æ¡¥æ¥",normalizedTitle:"vxlanå¤æ­æ¨¡å¼+æ¡¥æ¥",charIndex:9655},{level:3,title:"éä¿¡è¿ç¨",slug:"éä¿¡è¿ç¨-2",normalizedTitle:"éä¿¡è¿ç¨",charIndex:4633},{level:3,title:"ç¯å¢åå¤",slug:"ç¯å¢åå¤-2",normalizedTitle:"ç¯å¢åå¤",charIndex:5250},{level:3,title:"å¼å§åæ",slug:"å¼å§åæ-2",normalizedTitle:"å¼å§åæ",charIndex:6883},{level:2,title:"å·¨äººçè©è",slug:"å·¨äººçè©è",normalizedTitle:"å·¨äººçè©è",charIndex:13468}],headersStr:"ä»ä¹æ¯VXLAN? ç¹å¯¹ç¹çVXLAN å®æ å¼æµ VXLANçå¤æ­æ¨¡å¼ éä¿¡è¿ç¨ ç¯å¢åå¤ å¼å§åæ VXLANå¤æ­æ¨¡å¼+æ¡¥æ¥ éä¿¡è¿ç¨ ç¯å¢åå¤ å¼å§åæ å·¨äººçè©è",content:"# ä»ä¹æ¯VXLAN?\n\nå¨ä¸å±å¯è¾¾çç½ç»ä¸­é¨ç½²VXLANï¼å¨æ¯ä¸ªVXLANç½ç»ç«¯ç¹ä¸­é½æä¸ä¸ªVTEPè®¾å¤ï¼è´è´£å°VXLANåè®®çæ°æ®åè¿è¡UDPæ°æ®åçå°ååè§£åï¼å¯ä»¥å°å¶çè§£ä¸ºé§éï¼å°VXLANæ°æ®åä»é»è¾ç½ç»è½¬åå°ç©çç½ç»\n\nVXLANä½¿ç¨24ä½çVXLANç½ç»æ è¯ç¬¦ï¼VNIï¼æ¥æ è¯ä¸åçèæç½ç»\n\n\n\n\n# ç¹å¯¹ç¹çVXLAN\n\nå¨å·²ç»ç¥éå¯¹ç«¯VTEPæå¨èç¹ï¼æ¯å¦ä½è¿è¡è·¨èç¹éä¿¡çã\n\n\n\n\n# å®æ\n\nå¨Nodeä¸æ°å¢VTEPè®¾å¤vxlan0ï¼åå»ºå½ä»¤å¦ä¸ï¼\n\nip link add vxlan0 type vxlan id 42 dstport 4789 remote 10.65.132.188 local 10.65.132.187 dev ens18\n\n\n1\n\n * remoteæ¯å¯¹ç«¯èç¹çIP\n * localæ¯æ¬èç¹IP\n * idæ¯VNIçå¼\n * dstport æ¯VTEPè®¾å¤çç«¯å£\n\nåå»ºå¥½åï¼éè¦ç»å®éç½®IPå¹¶å¯ç¨\n\nip a add 172.17.1.2/24 dev vxlan0\nip link set vxlan0 up\n\n\n1\n2\n\n\nvxlan0è¯¦æå¦ä¸ï¼\n\n# ip -d link show dev vxlan0\n114: vxlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether 86:45:5c:56:49:42 brd ff:ff:ff:ff:ff:ff promiscuity 0 \n    vxlan id 42 remote 10.65.132.187 local 10.61.74.37 dev ens18 srcport 0 0 dstport 4789 ageing 300 noudpcsum noudp6zerocsumtx noudp6zerocsumrx addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 \n\n\n1\n2\n3\n4\n\n\nå¹¶ä¸å¯ä»¥çå°è·¯ç±ä¸­æ°å¢ä¸æ¡è®°å½ï¼ææç®çå°åæ¯172.17.1.0/24ç½æ®µçåé½è¦èµ°vxlan0è½¬åã\n\n# ip r\n...\n172.17.1.0/24 dev vxlan0 proto kernel scope link src 172.17.1.2\n...\n\n\n1\n2\n3\n4\n\n\nåæ¶fdbè¡¨ä¸­æ°å¢ä»¥ä¸è®°å½ï¼ä»£è¡¨çï¼ææè¿è¿vxlan0åçå¤é¨UDPç®çå°åé½ä¼è®¾ç½®ä¸º10.65.132.187ï¼å¹¶ä»ens18ç½å¡åºå»ã\n\n]# bridge fdb | grep vxlan0\n00:00:00:00:00:00 dev vxlan0 dst 10.65.132.187 via ens18 self permanent\n\n\n1\n2\n\n\nå°è¿éï¼Node1å·²ç»éç½®å¥½äºï¼æä»¬éå¤ä¸é¢æä½è®¾ç½®Node2ï¼åªéè¦å°é¨åIPä¿®æ¹å³å¯ã\n\n# å°Node1ä¸­remoteålocalåè¿æ¥å³å¯.\nip link add vxlan0 type vxlan id 42 dstport 4789 remote 10.65.132.187 dev ens18 local 10.65.132.188 dev ens18\n\n# vxlan0 å°åè®¾ç½®ä¸º172.17.1.3/24\nip a add 172.17.1.3/24 dev vxlan0\nip link set vxlan0 up\n\n# ip -d link show vxlan0\n20: vxlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether 12:09:3d:c0:97:32 brd ff:ff:ff:ff:ff:ff promiscuity 0 minmtu 68 maxmtu 65535 \n    vxlan id 42 remote 10.65.132.187 local 10.65.132.188 dev ens18 srcport 0 0 dstport 4789 ttl auto ageing 300 udpcsum noudp6zerocsumtx noudp6zerocsumrx addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# å¼æµ\n\nå¨Node2ä¸çå¬Node1çudpæ°æ®å\n\ntcpdump -i ens18 udp and host 10.65.132.187 -n\n\n\n1\n\n\nç¶åå¨Node1ä¸­ping Node2çVTEPè®¾å¤å°å172.17.1.3\n\n[root@k8s-master-07rf9 ~]# ping 172.17.1.3 -c 3\nPING 172.17.1.3 (172.17.1.3) 56(84) bytes of data.\n64 bytes from 172.17.1.3: icmp_seq=1 ttl=64 time=0.841 ms\n64 bytes from 172.17.1.3: icmp_seq=2 ttl=64 time=0.382 ms\n64 bytes from 172.17.1.3: icmp_seq=3 ttl=64 time=0.377 ms\n\n\n1\n2\n3\n4\n5\n\n\nå¯ä»¥çå°tcpdumpæå°çæ°æ®åå¦ä¸ï¼åæ¶å°äºNode1çåè¿æ¥å°è£äºARPæ°æ®åçæ°æ®åï¼æ³è¦ç¥éNode2ä¸­VTEPè®¾å¤çMACå°åï¼ç¶ååç»äºNode1ï¼Node1æ¶å°åï¼å°MACå°åå¡«åï¼åå°å°è£äºICMPçVXLANæ°æ®ååéå°Node2ï¼Node2ä¸­VTEPæ¶å°åå¹¶è§£åï¼æåååç»Node1\n\n[root@k8s-work01-1zapn ~]# tcpdump -i ens18 udp and host 10.65.132.187 -n\ndropped privs to tcpdump\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on ens18, link-type EN10MB (Ethernet), capture size 262144 bytes\n19:23:36.705418 IP 10.65.132.187.34062 > 10.65.132.188.vxlan: VXLAN, flags [I] (0x08), vni 42\nARP, Request who-has 172.17.1.3 tell 172.17.1.2, length 28\n19:23:36.705574 IP 10.65.132.188.20835 > 10.65.132.187.vxlan: VXLAN, flags [I] (0x08), vni 42\nARP, Reply 172.17.1.3 is-at 3a:84:39:cc:05:93, length 28\n19:23:36.705880 IP 10.65.132.187.jboss-iiop > 10.65.132.188.vxlan: VXLAN, flags [I] (0x08), vni 42\nIP 172.17.1.2 > 172.17.1.3: ICMP echo request, id 25707, seq 1, length 64\n19:23:36.705986 IP 10.65.132.188.62793 > 10.65.132.187.vxlan: VXLAN, flags [I] (0x08), vni 42\nIP 172.17.1.3 > 172.17.1.2: ICMP echo reply, id 25707, seq 1, length 64\n19:23:37.708701 IP 10.65.132.187.jboss-iiop > 10.65.132.188.vxlan: VXLAN, flags [I] (0x08), vni 42\nIP 172.17.1.2 > 172.17.1.3: ICMP echo request, id 25707, seq 2, length 64\n19:23:37.708846 IP 10.65.132.188.62793 > 10.65.132.187.vxlan: VXLAN, flags [I] (0x08), vni 42\nIP 172.17.1.3 > 172.17.1.2: ICMP echo reply, id 25707, seq 2, length 64\n19:23:38.732737 IP 10.65.132.187.jboss-iiop > 10.65.132.188.vxlan: VXLAN, flags [I] (0x08), vni 42\nIP 172.17.1.2 > 172.17.1.3: ICMP echo request, id 25707, seq 3, length 64\n19:23:38.732846 IP 10.65.132.188.62793 > 10.65.132.187.vxlan: VXLAN, flags [I] (0x08), vni 42\nIP 172.17.1.3 > 172.17.1.2: ICMP echo reply, id 25707, seq 3, length 64\n19:23:41.804637 IP 10.65.132.188.20835 > 10.65.132.187.vxlan: VXLAN, flags [I] (0x08), vni 42\nARP, Request who-has 172.17.1.2 tell 172.17.1.3, length 28\n19:23:41.804917 IP 10.65.132.187.34062 > 10.65.132.188.vxlan: VXLAN, flags [I] (0x08), vni 42\nARP, Reply 172.17.1.2 is-at c2:a1:4e:56:7d:eb, length 28\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# VXLANçå¤æ­æ¨¡å¼\n\nå¨æä»¬ä¸ç¥éVTEPæå¨èç¹çæåµä¸ï¼å¹¶ä¸éè¦ä½¿ç¨å¤ä¸ªVTEPç»å»ºé»è¾ç½ç»ã\n\n\n# éä¿¡è¿ç¨\n\n\n\n 1. å¨Node1ä¸éè¿ping Node2ä¸vxlan0è®¾å¤ipï¼æ°æ®åéè¿è·¯ç±å°è¾¾vxlan0ï¼vxlan0åç°ç®çIPåæºIPå±äºåä¸ç½æ®µï¼éè¦ç¥éå¯¹æ¹çMACå°åï¼å æ­¤éè¦åéARPæ¥è¯¢æ¥æã\n 2. ARPæ¥æä¸­ï¼æºMACå°åä¸ºNode1ä¸vxlan0çmacå°åï¼ç®çmacå°åä¸º255.255.255.255ä¹å°±æ¯å¹¿æ­å°åï¼å¹¶ä¸æ·»å VXLANå¤´é¨VNI=42\n 3. å ä¸ºä¸ç¥éå¯¹ç«¯çVTEPè®¾å¤å¨åªå°èç¹ä¸ï¼æä»¥vxlan0ä¼åå¤æ­å°å224.1.1.1åéå¤æ­æ¥æã\n 4. å¤æ­ç»ä¸­ææçä¸»æºé½ä¼æ¶å°æ¥æï¼å¹¶ä¸åæ ¸ä¼å¤æ­è¯¥æ°æ®åä¸ºVXLANæ¥æï¼æ ¹æ®VNIåéç»VTEPè®¾å¤ã\n 5. Node2ä¸­vxlan0æ¶å°æ¥æåï¼è§£åæ¿å°ARPæ¥æï¼ç¶åéè¿ARPæ¥æå­¦ä¹ å°äºå°Node1çvxlan0çmacå°åä¸Node1 IPçæ å°å³ç³»è®°å½å°FDBè¡¨ä¸­ï¼å¹¶ä¸çæARPåºç­æ¥æã\n 6. ARPåºç­æ¥æä¸­ï¼ç®çä¸»æºNode1çMACå°ååç®çä¸»æºNode1ä¸­vxlan0çMACå°åé½éè¿åè¿æ¥çARPæ¥æä¸­å­¦ä¹ å°ï¼æä»¥å¯ä»¥ç´æ¥éè¿åæ­è¿è¡åå¤ã\n 7. Node1æ¶å°ARPåå¤çæ¥æåï¼éè¿æ¥æåå®¹ï¼å°Node2çä¸»æºå°ååvxlan0çMACå°åçæ å°å³ç³»ç¼å­å°FDBè¡¨ä¸­ã\n 8. ç°å¨åæ¹é½å·²ç»éè¿ARPæ¥æè·å¾äºåæ¹çå»ºç«ICMPéä¿¡çææä¿¡æ¯ï¼å¯ä»¥ç´æ¥éè¿éè¿åæ­è¿è¡éä¿¡ã\n\n\n# ç¯å¢åå¤\n\né¦åå¨Node1ä¸­æ°å¢VTEPè®¾å¤vxlan0ï¼VNIä¸º42ï¼éä¿¡ç«¯å£4789ï¼ä¸»æºå°åä¸º10.65.132.187ï¼è®¾ç½®å¤æ­å°åä¸º224.1.1.1ï¼æ°æ®åéè¿ens18çå®ç½å¡åºå»ã\n\nip link add vxlan0 type vxlan id 42 dstport 4789 local 10.65.132.187 group 224.1.1.1 dev ens18\n\n\n1\n\n\nç»vxlan0æ·»å å°å172.17.1.2/24ï¼å¹¶æå®æèµ·\n\nip addr add 172.17.1.2/24 dev vxlan0\nip link set vxlan0 up\n\n\n1\n2\n\n\næ¥çvxlan0çè¯¦ç»ä¿¡æ¯\n\n# ip -d link  show vxlan0\n22: vxlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether 4e:92:72:79:59:ed brd ff:ff:ff:ff:ff:ff promiscuity 0 minmtu 68 maxmtu 65535 \n    vxlan id 42 group 224.1.1.1 local 10.65.132.187 dev ens18 srcport 0 0 dstport 4789 ttl auto ageing 300 udpcsum noudp6zerocsumtx noudp6zerocsumrx addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535\n\n\n1\n2\n3\n4\n\n\nåççfdbè¡¨ï¼æææ¯ï¼vxlan0å°åçæ¶åï¼é»è®¤ä¼ä½¿ç¨224.1.1.1ä½ä¸ºVXLANåä¹å°±æ¯å¤é¨UDPçç®çIPã\n\n# bridge fdb | grep vxlan0\n00:00:00:00:00:00 dev vxlan0 dst 224.1.1.1 via ens18 self permanent\n\n\n1\n2\n\n\nå¨Node2ä¸éå¤ä¸è¿°æä½\n\nip link add vxlan0 type vxlan id 42 dstport 4789 local 10.65.132.188 group 224.1.1.1 dev ens18\n\nip addr add 172.17.1.3/24 dev vxlan0\nip link set vxlan0 up\n\n# ip -d link show vxlan0\n11: vxlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether ba:d8:43:67:8d:fb brd ff:ff:ff:ff:ff:ff promiscuity 0 minmtu 68 maxmtu 65535 \n    vxlan id 42 group 224.1.1.1 local 10.65.132.188 dev ens18 srcport 0 0 dstport 4789 ttl auto ageing 300 udpcsum noudp6zerocsumtx noudp6zerocsumrx addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# å¼å§åæ\n\nåä½¿ç¨tcpdumpæ¥çå¬Node2ä¸­ens18ç½å¡ä¸­æ¥èªNode1çUDPæ°æ®åï¼ç¶åå¨Node1ä¸ping Node2ä¸­vxlan0è®¾å¤ã\n\nå¯ä»¥çå°æ¯å¯ä»¥pingéçã\n\n# ping 172.17.1.3 -c 1\nPING 172.17.1.3 (172.17.1.3) 56(84) bytes of data.\n64 bytes from 172.17.1.3: icmp_seq=1 ttl=64 time=0.807 ms\n\n--- 172.17.1.3 ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.807/0.807/0.807/0.000 ms\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nåæ¥ççæå°çåï¼\n\n 1. ç¬¬ä¸ä¸ªæ°æ®åï¼å¯ä»¥çå°Node2æ¶å°äºæ¥èªNode1ç VXLANæ°æ®åï¼vniä¸º42ï¼ç®çå°åæ¯å¤æ­IP224.1.1.1ï¼å ä¸ºæä»¬åå»ºçVTEPè®¾å¤è®¾ç½®äºè¯¥å¤æ­IPï¼æä»¥ä¼æ¥æ¶è¯¥æ°æ®åãä¸éé¢å°è£äºARPæ°æ®åï¼éè¦å°172.17.1.3çMACå°ååè¯172.17.1.2ã\n 2. ç¬¬äºä¸ªæ°æ®åå¯ä»¥çå°åå¤äºä¸ä¸ªVXLANæ°æ®åï¼éé¢åå«äºARPåºç­åï¼å°172.17.1.3çmacå°åä¹å°±æ¯vxlan0çå°ååå¤è¿å»ã\n 3. ç¬¬ä¸ä¸ªæ°æ®åæ¯Node1 vxlan0æ ¹æ®å¯¹æ¹çMACå°ååNode2çIPå°åï¼ç´æ¥åæ­åéåå«äºICMPæ°æ®åçVXLANæ°æ®åå°Node2\n 4. ç¬¬åä¸ªæ°æ®åæ¶Node2 vxlan0è¿è¡åå¤ICMPï¼ä¹æ¯åè£¹å¨ä¸ä¸ªVXLANæ°æ®åä¸­ï¼åéå°Node1ä¸­ã\n\n# tcpdump -i ens18 udp and host 10.65.132.187 -n\ndropped privs to tcpdump\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on ens18, link-type EN10MB (Ethernet), capture size 262144 bytes\n\n10:31:34.560469 IP 10.65.132.187.34062 > 224.1.1.1.vxlan: VXLAN, flags [I] (0x08), vni 42\nARP, Request who-has 172.17.1.3 tell 172.17.1.2, length 28\n10:31:34.560616 IP 10.65.132.188.20835 > 10.65.132.187.vxlan: VXLAN, flags [I] (0x08), vni 42\nARP, Reply 172.17.1.3 is-at ba:d8:43:67:8d:fb, length 28\n10:31:34.560819 IP 10.65.132.187.jboss-iiop > 10.65.132.188.vxlan: VXLAN, flags [I] (0x08), vni 42\nIP 172.17.1.2 > 172.17.1.3: ICMP echo request, id 46810, seq 1, length 64\n10:31:34.560935 IP 10.65.132.188.62793 > 10.65.132.187.vxlan: VXLAN, flags [I] (0x08), vni 42\nIP 172.17.1.3 > 172.17.1.2: ICMP echo reply, id 46810, seq 1, length 64\n10:31:39.661990 IP 10.65.132.188.20835 > 10.65.132.187.vxlan: VXLAN, flags [I] (0x08), vni 42\nARP, Request who-has 172.17.1.2 tell 172.17.1.3, length 28\n10:31:39.662329 IP 10.65.132.187.34062 > 10.65.132.188.vxlan: VXLAN, flags [I] (0x08), vni 42\nARP, Reply 172.17.1.2 is-at 4e:92:72:79:59:ed, length 28\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nåæ¬¡ping Node2çvxlan0è®¾å¤ï¼éè¿æåå¯ä»¥çå°ï¼ä¸éè¦åéARPæ¥æäºï¼æ¯å ä¸ºNode1å·²ç»ç¼å­äºARPã\n\nç¬¬ä¸ä¸ªæ°æ®åç®çIPä¸åæ¯224.1.1.1å¤æ­å°åäºï¼èæ¯Node2çå°åãæ¯å ä¸ºvxlan0ä¹å·²ç»ç¼å­å°fdbè¡¨ä¸­ã\n\n10:49:36.712777 IP 10.65.132.187.jboss-iiop > 10.65.132.188.vxlan: VXLAN, flags [I] (0x08), vni 42\nIP 172.17.1.2 > 172.17.1.3: ICMP echo request, id 41695, seq 1, length 64\n10:49:36.712973 IP 10.65.132.188.62793 > 10.65.132.187.vxlan: VXLAN, flags [I] (0x08), vni 42\nIP 172.17.1.3 > 172.17.1.2: ICMP echo reply, id 41695, seq 1, length 64\n\n\n1\n2\n3\n4\n\n\næ¥çarpç¼å­\n\n# arp | grep vxlan0\n172.17.1.3               ether   ba:d8:43:67:8d:fb   C                     vxlan0\n\n\n1\n2\n\n\næ¥çfdbè¡¨ï¼æ·»å äºNode2ä¸­vxlan0çMACå°ååNode2å°åçæ å°è¡¨é¡¹ã\n\n# bridge fdb | grep vxlan0\n00:00:00:00:00:00 dev vxlan0 dst 224.1.1.1 via ens18 self permanent\nba:d8:43:67:8d:fb dev vxlan0 dst 10.65.132.188 self\n\n\n1\n2\n3\n\n\n\n# VXLANå¤æ­æ¨¡å¼+æ¡¥æ¥\n\nå¨VXLANçå¤æ­çåºç¡ä¸åå ä¸æ¡¥æ¥ç½ç»ã\n\n\n# éä¿¡è¿ç¨\n\næ¡¥æ¥ç½ç»æ¨¡æåéä¿¡å°å®¿ä¸»æºè¿ç¨å¯ä»¥åèæå¨å®ç°dockerå®¹å¨bridgeç½ç»æ¨¡å\n\næ°æ®åè¾¾å°ç½æ¡¥åï¼ç¶ååè½¬åå°vxlan0ä¸­ï¼æ¥ä¸æ¥çæµç¨ä¹ä¸ä¸é¢å°çå¤æ­æ¯ä¸è´çã\n\n\n\n\n# ç¯å¢åå¤\n\nå¨Node1ä¸è¿è¡å¦ä¸å½ä»¤åå¤ç¯å¢\n\n# æ·»å VTEPè®¾å¤\nip link add vxlan0 type vxlan id 42 dstport 4789 local 10.65.132.187 group 224.1.1.1 dev ens18\n\n# æ·»å ç½æ¡¥\nip link add bridge0 type bridge\nip link set vxlan0 master bridge0\nip link set vxlan0 up\nip link set bridge0 up\n\n# æ·»å net1æ¨¡æå®¹å¨\nip netns add net1\nip link add veth0 type veth peer name veth1\nip link set dev veth0 up\n\n# å°å¦ä¸ç«¯ç»å®å¨ç½æ¡¥ä¸\nip link set dev veth1 up\nip link set dev veth1 master bridge0\n\n\n# è®¾ç½®net1ä¸­ç½ç»éç½®\nip link set dev veth0 netns net1\nip netns exec net1 ip addr add 172.19.1.2/24 dev veth0\nip netns exec net1 ip link set veth0 up\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nå¨Node2ä¸­éå¤ä¸é¢æä½ï¼å°172.19.1.3/24ç»å®å°å¦ä¸ä¸ªNetwork Namespace net3ä¸­\n\n# æ·»å VTEPè®¾å¤\nip link add vxlan0 type vxlan id 42 dstport 4789 local 10.65.132.188 group 224.1.1.1 dev ens18\n\n# æ·»å ç½æ¡¥\nip link add bridge0 type bridge\nip link set vxlan0 master bridge0\nip link set vxlan0 up\nip link set bridge0 up\n\n# æ·»å net1æ¨¡æå®¹å¨\nip netns add net3\nip link add veth0 type veth peer name veth1\n\n# å°å¦ä¸ç«¯ç»å®å¨ç½æ¡¥ä¸\nip link set dev veth1 up\nip link set dev veth1 master bridge0\n\n# è®¾ç½®net1ä¸­ç½ç»éç½®\nip link set dev veth0 netns net3\nip netns exec net3 ip addr add 172.19.1.3/24 dev veth0\nip netns exec net3 ip link set veth0 up\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# å¼å§åæ\n\nå¨Node1çnet1ä¸­ping Node2ä¸­çnet3ï¼å¯ä»¥çå°æååï¼è¯´æç½ç»æ¯éçã\n\n# ip netns exec net1 ping 172.19.1.3 -c 2\nPING 172.19.1.3 (172.19.1.3) 56(84) bytes of data.\n64 bytes from 172.19.1.3: icmp_seq=1 ttl=64 time=0.992 ms\n64 bytes from 172.19.1.3: icmp_seq=2 ttl=64 time=0.605 ms\n\n\n1\n2\n3\n4\n\n\néè¿çå¬Node2çç½å¡ens18ï¼æå°ä»¥ä¸çåï¼\n\n 1. é¦åæ¯Node1åéåå«ARPçUDPåå°å¤æ­å°å224.1.1.1ï¼å ä¸ºNode2æ¯å±äºè¯¥å¤æ­å°åï¼æä»¥ä¼æ¥æ¶è¯¥åï¼å¹¶éè¿vxlan0è¿è¡è§£åï¼æç»æ¿å°ARPåï¼ç¶ååévxlan0çmacå°åè¿è¡arpååï¼ä¹æ¯éè¿å°è£å°UDPåä¸­åéNode1ä¸­ï¼ç¶ååéè¿vxlan0->bridgeè¿å¥å°net1ä¸­ï¼net1ä¸­æ¶å°ARPåï¼å°Node2çå®¹å¨IPå°ååmacå°åç¼å­å°ARPä¸­ã\n\n 2. å¹¶ä¸å¨fdbè¡¨ä¸­æ·»å ä¸é¡¹ï¼net3ççmacå°åä¸Node2çIPå°åæ å°å³ç³»\n\n 3. æ¥ä¸æ¥æ¯éè¿ARPç¼å­æ¾å°MACå°åå¹¶æ·»å å°ICMPçIPåä¸ï¼ç¶ååå°å¶å°è£å°UDPåä¸­ï¼UDPçæºIPæ¯éè¿æ¥è¯¢fdbè¡¨å¾å°çï¼å¯ä»¥ç´æ¥éè¿åæ­åéã\n\n7:15:47.595683 IP 10.65.132.187.34062 > 224.1.1.1.vxlan: VXLAN, flags [I] (0x08), vni 42\nARP, Request who-has 172.19.1.3 tell 172.19.1.2, length 28\n17:15:47.595863 IP 10.65.132.188.20835 > 10.65.132.187.vxlan: VXLAN, flags [I] (0x08), vni 42\nARP, Reply 172.19.1.3 is-at 02:fd:f9:7f:61:a7, length 28\n17:15:47.596172 IP 10.65.132.187.42208 > 10.65.132.188.vxlan: VXLAN, flags [I] (0x08), vni 42\nIP 172.19.1.2 > 172.19.1.3: ICMP echo request, id 51397, seq 1, length 64\n17:15:47.596295 IP 10.65.132.188.22080 > 10.65.132.187.vxlan: VXLAN, flags [I] (0x08), vni 42\nIP 172.19.1.3 > 172.19.1.2: ICMP echo reply, id 51397, seq 1, length 64\n17:15:48.596543 IP 10.65.132.187.42208 > 10.65.132.188.vxlan: VXLAN, flags [I] (0x08), vni 42\nIP 172.19.1.2 > 172.19.1.3: ICMP echo request, id 51397, seq 2, length 64\n17:15:48.596724 IP 10.65.132.188.22080 > 10.65.132.187.vxlan: VXLAN, flags [I] (0x08), vni 42\nIP 172.19.1.3 > 172.19.1.2: ICMP echo reply, id 51397, seq 2, length 64\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nå¯ä»¥çå°net1ä¸­å·²ç»ç¼å­äºnet3çipå°åä¸macå°å\n\n# Node1\n# ip netns exec net1 arp \nAddress                  HWtype  HWaddress           Flags Mask            Iface\n172.19.1.3               ether   02:fd:f9:7f:61:a7   C                     veth0\n\n\n1\n2\n3\n4\n\n\nnet3ä¸­çmacå°åånet1ä¸­çarpç¼å­æ¯å¯¹åºä¸çã\n\n# ip netns exec net3 ip -d link show veth0\n34: veth0@if33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 02:fd:f9:7f:61:a7 brd ff:ff:ff:ff:ff:ff link-netnsid 0 promiscuity 0 minmtu 68 maxmtu 65535 \n    veth addrgenmode eui64 numtxqueues 8 numrxqueues 8 gso_max_size 65536 gso_max_segs 65535 \n\n\n1\n2\n3\n4\n\n\næ¥çfdbè¡¨ï¼æ°å¢äºnet3çmacå°ååNode2çIPå°åæ å°å³ç³»\n\n# bridge fdb | grep vxlan0\n02:fd:f9:7f:61:a7 dev vxlan0 dst 10.65.132.188 self\n\n\n1\n2\n\n\n\n# å·¨äººçè©è\n\n * ãkubernetesç½ç»æå¨æåã",normalizedContent:"# ä»ä¹æ¯vxlan?\n\nå¨ä¸å±å¯è¾¾çç½ç»ä¸­é¨ç½²vxlanï¼å¨æ¯ä¸ªvxlanç½ç»ç«¯ç¹ä¸­é½æä¸ä¸ªvtepè®¾å¤ï¼è´è´£å°vxlanåè®®çæ°æ®åè¿è¡udpæ°æ®åçå°ååè§£åï¼å¯ä»¥å°å¶çè§£ä¸ºé§éï¼å°vxlanæ°æ®åä»é»è¾ç½ç»è½¬åå°ç©çç½ç»\n\nvxlanä½¿ç¨24ä½çvxlanç½ç»æ è¯ç¬¦ï¼vniï¼æ¥æ è¯ä¸åçèæç½ç»\n\n\n\n\n# ç¹å¯¹ç¹çvxlan\n\nå¨å·²ç»ç¥éå¯¹ç«¯vtepæå¨èç¹ï¼æ¯å¦ä½è¿è¡è·¨èç¹éä¿¡çã\n\n\n\n\n# å®æ\n\nå¨nodeä¸æ°å¢vtepè®¾å¤vxlan0ï¼åå»ºå½ä»¤å¦ä¸ï¼\n\nip link add vxlan0 type vxlan id 42 dstport 4789 remote 10.65.132.188 local 10.65.132.187 dev ens18\n\n\n1\n\n * remoteæ¯å¯¹ç«¯èç¹çip\n * localæ¯æ¬èç¹ip\n * idæ¯vniçå¼\n * dstport æ¯vtepè®¾å¤çç«¯å£\n\nåå»ºå¥½åï¼éè¦ç»å®éç½®ipå¹¶å¯ç¨\n\nip a add 172.17.1.2/24 dev vxlan0\nip link set vxlan0 up\n\n\n1\n2\n\n\nvxlan0è¯¦æå¦ä¸ï¼\n\n# ip -d link show dev vxlan0\n114: vxlan0: <broadcast,multicast,up,lower_up> mtu 1450 qdisc noqueue state unknown mode default group default qlen 1000\n    link/ether 86:45:5c:56:49:42 brd ff:ff:ff:ff:ff:ff promiscuity 0 \n    vxlan id 42 remote 10.65.132.187 local 10.61.74.37 dev ens18 srcport 0 0 dstport 4789 ageing 300 noudpcsum noudp6zerocsumtx noudp6zerocsumrx addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 \n\n\n1\n2\n3\n4\n\n\nå¹¶ä¸å¯ä»¥çå°è·¯ç±ä¸­æ°å¢ä¸æ¡è®°å½ï¼ææç®çå°åæ¯172.17.1.0/24ç½æ®µçåé½è¦èµ°vxlan0è½¬åã\n\n# ip r\n...\n172.17.1.0/24 dev vxlan0 proto kernel scope link src 172.17.1.2\n...\n\n\n1\n2\n3\n4\n\n\nåæ¶fdbè¡¨ä¸­æ°å¢ä»¥ä¸è®°å½ï¼ä»£è¡¨çï¼ææè¿è¿vxlan0åçå¤é¨udpç®çå°åé½ä¼è®¾ç½®ä¸º10.65.132.187ï¼å¹¶ä»ens18ç½å¡åºå»ã\n\n]# bridge fdb | grep vxlan0\n00:00:00:00:00:00 dev vxlan0 dst 10.65.132.187 via ens18 self permanent\n\n\n1\n2\n\n\nå°è¿éï¼node1å·²ç»éç½®å¥½äºï¼æä»¬éå¤ä¸é¢æä½è®¾ç½®node2ï¼åªéè¦å°é¨åipä¿®æ¹å³å¯ã\n\n# å°node1ä¸­remoteålocalåè¿æ¥å³å¯.\nip link add vxlan0 type vxlan id 42 dstport 4789 remote 10.65.132.187 dev ens18 local 10.65.132.188 dev ens18\n\n# vxlan0 å°åè®¾ç½®ä¸º172.17.1.3/24\nip a add 172.17.1.3/24 dev vxlan0\nip link set vxlan0 up\n\n# ip -d link show vxlan0\n20: vxlan0: <broadcast,multicast,up,lower_up> mtu 1450 qdisc noqueue state unknown mode default group default qlen 1000\n    link/ether 12:09:3d:c0:97:32 brd ff:ff:ff:ff:ff:ff promiscuity 0 minmtu 68 maxmtu 65535 \n    vxlan id 42 remote 10.65.132.187 local 10.65.132.188 dev ens18 srcport 0 0 dstport 4789 ttl auto ageing 300 udpcsum noudp6zerocsumtx noudp6zerocsumrx addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# å¼æµ\n\nå¨node2ä¸çå¬node1çudpæ°æ®å\n\ntcpdump -i ens18 udp and host 10.65.132.187 -n\n\n\n1\n\n\nç¶åå¨node1ä¸­ping node2çvtepè®¾å¤å°å172.17.1.3\n\n[root@k8s-master-07rf9 ~]# ping 172.17.1.3 -c 3\nping 172.17.1.3 (172.17.1.3) 56(84) bytes of data.\n64 bytes from 172.17.1.3: icmp_seq=1 ttl=64 time=0.841 ms\n64 bytes from 172.17.1.3: icmp_seq=2 ttl=64 time=0.382 ms\n64 bytes from 172.17.1.3: icmp_seq=3 ttl=64 time=0.377 ms\n\n\n1\n2\n3\n4\n5\n\n\nå¯ä»¥çå°tcpdumpæå°çæ°æ®åå¦ä¸ï¼åæ¶å°äºnode1çåè¿æ¥å°è£äºarpæ°æ®åçæ°æ®åï¼æ³è¦ç¥énode2ä¸­vtepè®¾å¤çmacå°åï¼ç¶ååç»äºnode1ï¼node1æ¶å°åï¼å°macå°åå¡«åï¼åå°å°è£äºicmpçvxlanæ°æ®ååéå°node2ï¼node2ä¸­vtepæ¶å°åå¹¶è§£åï¼æåååç»node1\n\n[root@k8s-work01-1zapn ~]# tcpdump -i ens18 udp and host 10.65.132.187 -n\ndropped privs to tcpdump\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on ens18, link-type en10mb (ethernet), capture size 262144 bytes\n19:23:36.705418 ip 10.65.132.187.34062 > 10.65.132.188.vxlan: vxlan, flags [i] (0x08), vni 42\narp, request who-has 172.17.1.3 tell 172.17.1.2, length 28\n19:23:36.705574 ip 10.65.132.188.20835 > 10.65.132.187.vxlan: vxlan, flags [i] (0x08), vni 42\narp, reply 172.17.1.3 is-at 3a:84:39:cc:05:93, length 28\n19:23:36.705880 ip 10.65.132.187.jboss-iiop > 10.65.132.188.vxlan: vxlan, flags [i] (0x08), vni 42\nip 172.17.1.2 > 172.17.1.3: icmp echo request, id 25707, seq 1, length 64\n19:23:36.705986 ip 10.65.132.188.62793 > 10.65.132.187.vxlan: vxlan, flags [i] (0x08), vni 42\nip 172.17.1.3 > 172.17.1.2: icmp echo reply, id 25707, seq 1, length 64\n19:23:37.708701 ip 10.65.132.187.jboss-iiop > 10.65.132.188.vxlan: vxlan, flags [i] (0x08), vni 42\nip 172.17.1.2 > 172.17.1.3: icmp echo request, id 25707, seq 2, length 64\n19:23:37.708846 ip 10.65.132.188.62793 > 10.65.132.187.vxlan: vxlan, flags [i] (0x08), vni 42\nip 172.17.1.3 > 172.17.1.2: icmp echo reply, id 25707, seq 2, length 64\n19:23:38.732737 ip 10.65.132.187.jboss-iiop > 10.65.132.188.vxlan: vxlan, flags [i] (0x08), vni 42\nip 172.17.1.2 > 172.17.1.3: icmp echo request, id 25707, seq 3, length 64\n19:23:38.732846 ip 10.65.132.188.62793 > 10.65.132.187.vxlan: vxlan, flags [i] (0x08), vni 42\nip 172.17.1.3 > 172.17.1.2: icmp echo reply, id 25707, seq 3, length 64\n19:23:41.804637 ip 10.65.132.188.20835 > 10.65.132.187.vxlan: vxlan, flags [i] (0x08), vni 42\narp, request who-has 172.17.1.2 tell 172.17.1.3, length 28\n19:23:41.804917 ip 10.65.132.187.34062 > 10.65.132.188.vxlan: vxlan, flags [i] (0x08), vni 42\narp, reply 172.17.1.2 is-at c2:a1:4e:56:7d:eb, length 28\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# vxlançå¤æ­æ¨¡å¼\n\nå¨æä»¬ä¸ç¥évtepæå¨èç¹çæåµä¸ï¼å¹¶ä¸éè¦ä½¿ç¨å¤ä¸ªvtepç»å»ºé»è¾ç½ç»ã\n\n\n# éä¿¡è¿ç¨\n\n\n\n 1. å¨node1ä¸éè¿ping node2ä¸vxlan0è®¾å¤ipï¼æ°æ®åéè¿è·¯ç±å°è¾¾vxlan0ï¼vxlan0åç°ç®çipåæºipå±äºåä¸ç½æ®µï¼éè¦ç¥éå¯¹æ¹çmacå°åï¼å æ­¤éè¦åéarpæ¥è¯¢æ¥æã\n 2. arpæ¥æä¸­ï¼æºmacå°åä¸ºnode1ä¸vxlan0çmacå°åï¼ç®çmacå°åä¸º255.255.255.255ä¹å°±æ¯å¹¿æ­å°åï¼å¹¶ä¸æ·»å vxlanå¤´é¨vni=42\n 3. å ä¸ºä¸ç¥éå¯¹ç«¯çvtepè®¾å¤å¨åªå°èç¹ä¸ï¼æä»¥vxlan0ä¼åå¤æ­å°å224.1.1.1åéå¤æ­æ¥æã\n 4. å¤æ­ç»ä¸­ææçä¸»æºé½ä¼æ¶å°æ¥æï¼å¹¶ä¸åæ ¸ä¼å¤æ­è¯¥æ°æ®åä¸ºvxlanæ¥æï¼æ ¹æ®vniåéç»vtepè®¾å¤ã\n 5. node2ä¸­vxlan0æ¶å°æ¥æåï¼è§£åæ¿å°arpæ¥æï¼ç¶åéè¿arpæ¥æå­¦ä¹ å°äºå°node1çvxlan0çmacå°åä¸node1 ipçæ å°å³ç³»è®°å½å°fdbè¡¨ä¸­ï¼å¹¶ä¸çæarpåºç­æ¥æã\n 6. arpåºç­æ¥æä¸­ï¼ç®çä¸»æºnode1çmacå°ååç®çä¸»æºnode1ä¸­vxlan0çmacå°åé½éè¿åè¿æ¥çarpæ¥æä¸­å­¦ä¹ å°ï¼æä»¥å¯ä»¥ç´æ¥éè¿åæ­è¿è¡åå¤ã\n 7. node1æ¶å°arpåå¤çæ¥æåï¼éè¿æ¥æåå®¹ï¼å°node2çä¸»æºå°ååvxlan0çmacå°åçæ å°å³ç³»ç¼å­å°fdbè¡¨ä¸­ã\n 8. ç°å¨åæ¹é½å·²ç»éè¿arpæ¥æè·å¾äºåæ¹çå»ºç«icmpéä¿¡çææä¿¡æ¯ï¼å¯ä»¥ç´æ¥éè¿éè¿åæ­è¿è¡éä¿¡ã\n\n\n# ç¯å¢åå¤\n\né¦åå¨node1ä¸­æ°å¢vtepè®¾å¤vxlan0ï¼vniä¸º42ï¼éä¿¡ç«¯å£4789ï¼ä¸»æºå°åä¸º10.65.132.187ï¼è®¾ç½®å¤æ­å°åä¸º224.1.1.1ï¼æ°æ®åéè¿ens18çå®ç½å¡åºå»ã\n\nip link add vxlan0 type vxlan id 42 dstport 4789 local 10.65.132.187 group 224.1.1.1 dev ens18\n\n\n1\n\n\nç»vxlan0æ·»å å°å172.17.1.2/24ï¼å¹¶æå®æèµ·\n\nip addr add 172.17.1.2/24 dev vxlan0\nip link set vxlan0 up\n\n\n1\n2\n\n\næ¥çvxlan0çè¯¦ç»ä¿¡æ¯\n\n# ip -d link  show vxlan0\n22: vxlan0: <broadcast,multicast,up,lower_up> mtu 1450 qdisc noqueue state unknown mode default group default qlen 1000\n    link/ether 4e:92:72:79:59:ed brd ff:ff:ff:ff:ff:ff promiscuity 0 minmtu 68 maxmtu 65535 \n    vxlan id 42 group 224.1.1.1 local 10.65.132.187 dev ens18 srcport 0 0 dstport 4789 ttl auto ageing 300 udpcsum noudp6zerocsumtx noudp6zerocsumrx addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535\n\n\n1\n2\n3\n4\n\n\nåççfdbè¡¨ï¼æææ¯ï¼vxlan0å°åçæ¶åï¼é»è®¤ä¼ä½¿ç¨224.1.1.1ä½ä¸ºvxlanåä¹å°±æ¯å¤é¨udpçç®çipã\n\n# bridge fdb | grep vxlan0\n00:00:00:00:00:00 dev vxlan0 dst 224.1.1.1 via ens18 self permanent\n\n\n1\n2\n\n\nå¨node2ä¸éå¤ä¸è¿°æä½\n\nip link add vxlan0 type vxlan id 42 dstport 4789 local 10.65.132.188 group 224.1.1.1 dev ens18\n\nip addr add 172.17.1.3/24 dev vxlan0\nip link set vxlan0 up\n\n# ip -d link show vxlan0\n11: vxlan0: <broadcast,multicast,up,lower_up> mtu 1450 qdisc noqueue state unknown mode default group default qlen 1000\n    link/ether ba:d8:43:67:8d:fb brd ff:ff:ff:ff:ff:ff promiscuity 0 minmtu 68 maxmtu 65535 \n    vxlan id 42 group 224.1.1.1 local 10.65.132.188 dev ens18 srcport 0 0 dstport 4789 ttl auto ageing 300 udpcsum noudp6zerocsumtx noudp6zerocsumrx addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# å¼å§åæ\n\nåä½¿ç¨tcpdumpæ¥çå¬node2ä¸­ens18ç½å¡ä¸­æ¥èªnode1çudpæ°æ®åï¼ç¶åå¨node1ä¸ping node2ä¸­vxlan0è®¾å¤ã\n\nå¯ä»¥çå°æ¯å¯ä»¥pingéçã\n\n# ping 172.17.1.3 -c 1\nping 172.17.1.3 (172.17.1.3) 56(84) bytes of data.\n64 bytes from 172.17.1.3: icmp_seq=1 ttl=64 time=0.807 ms\n\n--- 172.17.1.3 ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 0.807/0.807/0.807/0.000 ms\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nåæ¥ççæå°çåï¼\n\n 1. ç¬¬ä¸ä¸ªæ°æ®åï¼å¯ä»¥çå°node2æ¶å°äºæ¥èªnode1ç vxlanæ°æ®åï¼vniä¸º42ï¼ç®çå°åæ¯å¤æ­ip224.1.1.1ï¼å ä¸ºæä»¬åå»ºçvtepè®¾å¤è®¾ç½®äºè¯¥å¤æ­ipï¼æä»¥ä¼æ¥æ¶è¯¥æ°æ®åãä¸éé¢å°è£äºarpæ°æ®åï¼éè¦å°172.17.1.3çmacå°ååè¯172.17.1.2ã\n 2. ç¬¬äºä¸ªæ°æ®åå¯ä»¥çå°åå¤äºä¸ä¸ªvxlanæ°æ®åï¼éé¢åå«äºarpåºç­åï¼å°172.17.1.3çmacå°åä¹å°±æ¯vxlan0çå°ååå¤è¿å»ã\n 3. ç¬¬ä¸ä¸ªæ°æ®åæ¯node1 vxlan0æ ¹æ®å¯¹æ¹çmacå°åånode2çipå°åï¼ç´æ¥åæ­åéåå«äºicmpæ°æ®åçvxlanæ°æ®åå°node2\n 4. ç¬¬åä¸ªæ°æ®åæ¶node2 vxlan0è¿è¡åå¤icmpï¼ä¹æ¯åè£¹å¨ä¸ä¸ªvxlanæ°æ®åä¸­ï¼åéå°node1ä¸­ã\n\n# tcpdump -i ens18 udp and host 10.65.132.187 -n\ndropped privs to tcpdump\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on ens18, link-type en10mb (ethernet), capture size 262144 bytes\n\n10:31:34.560469 ip 10.65.132.187.34062 > 224.1.1.1.vxlan: vxlan, flags [i] (0x08), vni 42\narp, request who-has 172.17.1.3 tell 172.17.1.2, length 28\n10:31:34.560616 ip 10.65.132.188.20835 > 10.65.132.187.vxlan: vxlan, flags [i] (0x08), vni 42\narp, reply 172.17.1.3 is-at ba:d8:43:67:8d:fb, length 28\n10:31:34.560819 ip 10.65.132.187.jboss-iiop > 10.65.132.188.vxlan: vxlan, flags [i] (0x08), vni 42\nip 172.17.1.2 > 172.17.1.3: icmp echo request, id 46810, seq 1, length 64\n10:31:34.560935 ip 10.65.132.188.62793 > 10.65.132.187.vxlan: vxlan, flags [i] (0x08), vni 42\nip 172.17.1.3 > 172.17.1.2: icmp echo reply, id 46810, seq 1, length 64\n10:31:39.661990 ip 10.65.132.188.20835 > 10.65.132.187.vxlan: vxlan, flags [i] (0x08), vni 42\narp, request who-has 172.17.1.2 tell 172.17.1.3, length 28\n10:31:39.662329 ip 10.65.132.187.34062 > 10.65.132.188.vxlan: vxlan, flags [i] (0x08), vni 42\narp, reply 172.17.1.2 is-at 4e:92:72:79:59:ed, length 28\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nåæ¬¡ping node2çvxlan0è®¾å¤ï¼éè¿æåå¯ä»¥çå°ï¼ä¸éè¦åéarpæ¥æäºï¼æ¯å ä¸ºnode1å·²ç»ç¼å­äºarpã\n\nç¬¬ä¸ä¸ªæ°æ®åç®çipä¸åæ¯224.1.1.1å¤æ­å°åäºï¼èæ¯node2çå°åãæ¯å ä¸ºvxlan0ä¹å·²ç»ç¼å­å°fdbè¡¨ä¸­ã\n\n10:49:36.712777 ip 10.65.132.187.jboss-iiop > 10.65.132.188.vxlan: vxlan, flags [i] (0x08), vni 42\nip 172.17.1.2 > 172.17.1.3: icmp echo request, id 41695, seq 1, length 64\n10:49:36.712973 ip 10.65.132.188.62793 > 10.65.132.187.vxlan: vxlan, flags [i] (0x08), vni 42\nip 172.17.1.3 > 172.17.1.2: icmp echo reply, id 41695, seq 1, length 64\n\n\n1\n2\n3\n4\n\n\næ¥çarpç¼å­\n\n# arp | grep vxlan0\n172.17.1.3               ether   ba:d8:43:67:8d:fb   c                     vxlan0\n\n\n1\n2\n\n\næ¥çfdbè¡¨ï¼æ·»å äºnode2ä¸­vxlan0çmacå°åånode2å°åçæ å°è¡¨é¡¹ã\n\n# bridge fdb | grep vxlan0\n00:00:00:00:00:00 dev vxlan0 dst 224.1.1.1 via ens18 self permanent\nba:d8:43:67:8d:fb dev vxlan0 dst 10.65.132.188 self\n\n\n1\n2\n3\n\n\n\n# vxlanå¤æ­æ¨¡å¼+æ¡¥æ¥\n\nå¨vxlançå¤æ­çåºç¡ä¸åå ä¸æ¡¥æ¥ç½ç»ã\n\n\n# éä¿¡è¿ç¨\n\næ¡¥æ¥ç½ç»æ¨¡æåéä¿¡å°å®¿ä¸»æºè¿ç¨å¯ä»¥åèæå¨å®ç°dockerå®¹å¨bridgeç½ç»æ¨¡å\n\næ°æ®åè¾¾å°ç½æ¡¥åï¼ç¶ååè½¬åå°vxlan0ä¸­ï¼æ¥ä¸æ¥çæµç¨ä¹ä¸ä¸é¢å°çå¤æ­æ¯ä¸è´çã\n\n\n\n\n# ç¯å¢åå¤\n\nå¨node1ä¸è¿è¡å¦ä¸å½ä»¤åå¤ç¯å¢\n\n# æ·»å vtepè®¾å¤\nip link add vxlan0 type vxlan id 42 dstport 4789 local 10.65.132.187 group 224.1.1.1 dev ens18\n\n# æ·»å ç½æ¡¥\nip link add bridge0 type bridge\nip link set vxlan0 master bridge0\nip link set vxlan0 up\nip link set bridge0 up\n\n# æ·»å net1æ¨¡æå®¹å¨\nip netns add net1\nip link add veth0 type veth peer name veth1\nip link set dev veth0 up\n\n# å°å¦ä¸ç«¯ç»å®å¨ç½æ¡¥ä¸\nip link set dev veth1 up\nip link set dev veth1 master bridge0\n\n\n# è®¾ç½®net1ä¸­ç½ç»éç½®\nip link set dev veth0 netns net1\nip netns exec net1 ip addr add 172.19.1.2/24 dev veth0\nip netns exec net1 ip link set veth0 up\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nå¨node2ä¸­éå¤ä¸é¢æä½ï¼å°172.19.1.3/24ç»å®å°å¦ä¸ä¸ªnetwork namespace net3ä¸­\n\n# æ·»å vtepè®¾å¤\nip link add vxlan0 type vxlan id 42 dstport 4789 local 10.65.132.188 group 224.1.1.1 dev ens18\n\n# æ·»å ç½æ¡¥\nip link add bridge0 type bridge\nip link set vxlan0 master bridge0\nip link set vxlan0 up\nip link set bridge0 up\n\n# æ·»å net1æ¨¡æå®¹å¨\nip netns add net3\nip link add veth0 type veth peer name veth1\n\n# å°å¦ä¸ç«¯ç»å®å¨ç½æ¡¥ä¸\nip link set dev veth1 up\nip link set dev veth1 master bridge0\n\n# è®¾ç½®net1ä¸­ç½ç»éç½®\nip link set dev veth0 netns net3\nip netns exec net3 ip addr add 172.19.1.3/24 dev veth0\nip netns exec net3 ip link set veth0 up\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# å¼å§åæ\n\nå¨node1çnet1ä¸­ping node2ä¸­çnet3ï¼å¯ä»¥çå°æååï¼è¯´æç½ç»æ¯éçã\n\n# ip netns exec net1 ping 172.19.1.3 -c 2\nping 172.19.1.3 (172.19.1.3) 56(84) bytes of data.\n64 bytes from 172.19.1.3: icmp_seq=1 ttl=64 time=0.992 ms\n64 bytes from 172.19.1.3: icmp_seq=2 ttl=64 time=0.605 ms\n\n\n1\n2\n3\n4\n\n\néè¿çå¬node2çç½å¡ens18ï¼æå°ä»¥ä¸çåï¼\n\n 1. é¦åæ¯node1åéåå«arpçudpåå°å¤æ­å°å224.1.1.1ï¼å ä¸ºnode2æ¯å±äºè¯¥å¤æ­å°åï¼æä»¥ä¼æ¥æ¶è¯¥åï¼å¹¶éè¿vxlan0è¿è¡è§£åï¼æç»æ¿å°arpåï¼ç¶ååévxlan0çmacå°åè¿è¡arpååï¼ä¹æ¯éè¿å°è£å°udpåä¸­åénode1ä¸­ï¼ç¶ååéè¿vxlan0->bridgeè¿å¥å°net1ä¸­ï¼net1ä¸­æ¶å°arpåï¼å°node2çå®¹å¨ipå°ååmacå°åç¼å­å°arpä¸­ã\n\n 2. å¹¶ä¸å¨fdbè¡¨ä¸­æ·»å ä¸é¡¹ï¼net3ççmacå°åä¸node2çipå°åæ å°å³ç³»\n\n 3. æ¥ä¸æ¥æ¯éè¿arpç¼å­æ¾å°macå°åå¹¶æ·»å å°icmpçipåä¸ï¼ç¶ååå°å¶å°è£å°udpåä¸­ï¼udpçæºipæ¯éè¿æ¥è¯¢fdbè¡¨å¾å°çï¼å¯ä»¥ç´æ¥éè¿åæ­åéã\n\n7:15:47.595683 ip 10.65.132.187.34062 > 224.1.1.1.vxlan: vxlan, flags [i] (0x08), vni 42\narp, request who-has 172.19.1.3 tell 172.19.1.2, length 28\n17:15:47.595863 ip 10.65.132.188.20835 > 10.65.132.187.vxlan: vxlan, flags [i] (0x08), vni 42\narp, reply 172.19.1.3 is-at 02:fd:f9:7f:61:a7, length 28\n17:15:47.596172 ip 10.65.132.187.42208 > 10.65.132.188.vxlan: vxlan, flags [i] (0x08), vni 42\nip 172.19.1.2 > 172.19.1.3: icmp echo request, id 51397, seq 1, length 64\n17:15:47.596295 ip 10.65.132.188.22080 > 10.65.132.187.vxlan: vxlan, flags [i] (0x08), vni 42\nip 172.19.1.3 > 172.19.1.2: icmp echo reply, id 51397, seq 1, length 64\n17:15:48.596543 ip 10.65.132.187.42208 > 10.65.132.188.vxlan: vxlan, flags [i] (0x08), vni 42\nip 172.19.1.2 > 172.19.1.3: icmp echo request, id 51397, seq 2, length 64\n17:15:48.596724 ip 10.65.132.188.22080 > 10.65.132.187.vxlan: vxlan, flags [i] (0x08), vni 42\nip 172.19.1.3 > 172.19.1.2: icmp echo reply, id 51397, seq 2, length 64\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nå¯ä»¥çå°net1ä¸­å·²ç»ç¼å­äºnet3çipå°åä¸macå°å\n\n# node1\n# ip netns exec net1 arp \naddress                  hwtype  hwaddress           flags mask            iface\n172.19.1.3               ether   02:fd:f9:7f:61:a7   c                     veth0\n\n\n1\n2\n3\n4\n\n\nnet3ä¸­çmacå°åånet1ä¸­çarpç¼å­æ¯å¯¹åºä¸çã\n\n# ip netns exec net3 ip -d link show veth0\n34: veth0@if33: <broadcast,multicast,up,lower_up> mtu 1500 qdisc noqueue state up mode default group default qlen 1000\n    link/ether 02:fd:f9:7f:61:a7 brd ff:ff:ff:ff:ff:ff link-netnsid 0 promiscuity 0 minmtu 68 maxmtu 65535 \n    veth addrgenmode eui64 numtxqueues 8 numrxqueues 8 gso_max_size 65536 gso_max_segs 65535 \n\n\n1\n2\n3\n4\n\n\næ¥çfdbè¡¨ï¼æ°å¢äºnet3çmacå°åånode2çipå°åæ å°å³ç³»\n\n# bridge fdb | grep vxlan0\n02:fd:f9:7f:61:a7 dev vxlan0 dst 10.65.132.188 self\n\n\n1\n2\n\n\n\n# å·¨äººçè©è\n\n * ãkubernetesç½ç»æå¨æåã",charsets:{cjk:!0},lastUpdated:"2023/06/06, 18:33:56",lastUpdatedTimestamp:1686047636e3},{title:"tcpç¼å­å¼èµ·çæ¥å¿ä¸¢å¤±",frontmatter:{title:"tcpç¼å­å¼èµ·çæ¥å¿ä¸¢å¤±",date:"2023-11-09T15:49:47.000Z",permalink:"/pages/36b0b2/",tags:["go","logstash","ç¼ç¨"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"logstashä»æ°æ®æºæåæ¥å¿ï¼ç¶åéè¿tcpæä»¶åéå°proxyè¿ç¨ä¸­ãå¨ä¸å¡ä¾§åç°æ¥å¿éææ¾å°äºï¼æä»¥æäºè¿ä¸æ¬¡çé®é¢ææ¥ã",comment:!0,categories:["ç¼ç¨","go"],feed:{enable:!0},meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20231109171607.png"},{name:"twitter:title",content:"tcpç¼å­å¼èµ·çæ¥å¿ä¸¢å¤±"},{name:"twitter:description",content:"logstashä»æ°æ®æºæåæ¥å¿ï¼ç¶åéè¿tcpæä»¶åéå°proxyè¿ç¨ä¸­ãå¨ä¸å¡ä¾§åç°æ¥å¿éææ¾å°äºï¼æä»¥æäºè¿ä¸æ¬¡çé®é¢ææ¥ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20231109171607.png"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/02.go/05.tcp%E7%BC%93%E5%AD%98%E5%BC%95%E8%B5%B7%E7%9A%84%E6%97%A5%E5%BF%97%E4%B8%A2%E5%A4%B1.html"},{property:"og:type",content:"article"},{property:"og:title",content:"tcpç¼å­å¼èµ·çæ¥å¿ä¸¢å¤±"},{property:"og:description",content:"logstashä»æ°æ®æºæåæ¥å¿ï¼ç¶åéè¿tcpæä»¶åéå°proxyè¿ç¨ä¸­ãå¨ä¸å¡ä¾§åç°æ¥å¿éææ¾å°äºï¼æä»¥æäºè¿ä¸æ¬¡çé®é¢ææ¥ã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20231109171607.png"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/02.go/05.tcp%E7%BC%93%E5%AD%98%E5%BC%95%E8%B5%B7%E7%9A%84%E6%97%A5%E5%BF%97%E4%B8%A2%E5%A4%B1.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-11-09T15:49:47.000Z"},{property:"article:tag",content:"go"},{property:"article:tag",content:"logstash"},{property:"article:tag",content:"ç¼ç¨"},{itemprop:"name",content:"tcpç¼å­å¼èµ·çæ¥å¿ä¸¢å¤±"},{itemprop:"description",content:"logstashä»æ°æ®æºæåæ¥å¿ï¼ç¶åéè¿tcpæä»¶åéå°proxyè¿ç¨ä¸­ãå¨ä¸å¡ä¾§åç°æ¥å¿éææ¾å°äºï¼æä»¥æäºè¿ä¸æ¬¡çé®é¢ææ¥ã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20231109171607.png"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/02.go/05.tcp%E7%BC%93%E5%AD%98%E5%BC%95%E8%B5%B7%E7%9A%84%E6%97%A5%E5%BF%97%E4%B8%A2%E5%A4%B1.html",relativePath:"04.ç¼ç¨/02.go/05.tcpç¼å­å¼èµ·çæ¥å¿ä¸¢å¤±.md",key:"v-31a5e395",path:"/pages/36b0b2/",headers:[{level:2,title:"èæ¯",slug:"èæ¯",normalizedTitle:"èæ¯",charIndex:2},{level:2,title:"é®é¢ææ¥å®ä½",slug:"é®é¢ææ¥å®ä½",normalizedTitle:"é®é¢ææ¥å®ä½",charIndex:78},{level:2,title:"ä»£ç ææ¥",slug:"ä»£ç ææ¥",normalizedTitle:"ä»£ç ææ¥",charIndex:1167},{level:2,title:"è§£å³æ¹æ³",slug:"è§£å³æ¹æ³",normalizedTitle:"è§£å³æ¹æ³",charIndex:2432},{level:2,title:"æ»ç»",slug:"æ»ç»",normalizedTitle:"æ»ç»",charIndex:2749}],headersStr:"èæ¯ é®é¢ææ¥å®ä½ ä»£ç ææ¥ è§£å³æ¹æ³ æ»ç»",content:'# èæ¯\n\nlogstashä»æ°æ®æºæåæ¥å¿ï¼ç¶åéè¿tcpæä»¶åéå°proxyè¿ç¨ä¸­ãå¨ä¸å¡ä¾§åç°æ¥å¿éææ¾å°äºï¼æä»¥æäºè¿ä¸æ¬¡çé®é¢ææ¥ã\n\n\n\n\n# é®é¢ææ¥å®ä½\n\né¦åä»logstashä¾§å¼å§æ£æ¥ãæä»¬åçlogstashçæ¥å¿ï¼æ²¡æææ¾çæ¥éä¿¡æ¯ã\n\nç¶ååæ¥çlogstashç®¡éçç¶æãå¯ä»¥å¾ææ¾ççå°ï¼å¨outputç®¡éä¸­ï¼inè¿è¿å¤§äºoutï¼ä¹å°±æ¯logstashæåçæ¥å¿å·²ç»å°äºoutputç®¡éï¼ä½æ¯æ æ³è¾åºåºå»ï¼å¹¶ä¸duration_in_millisæ¶é´å¾é¿ï¼è¿ä¸ªä»£è¡¨çååºå»çéçå¾æ¢ï¼è¿æ¯ä»ä¹åå å¢ï¼\n\ncurl -XGET \'localhost:9600/_node/stats/pipelines/azure_event_hubs?pretty\'\n\n{\n    ...\n"outputs" : [ {\n        "id" : "99b12e190d297be5d6113d04cf10089a3dccbaef7eed0cc41515e8e5af5f4595",\n        "name" : "tcp",\n        "events" : {\n        "in" : 341,\n        "out" : 69,\n        "duration_in_millis" : 519709\n        }\n    } \n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè¦ä¹æ¯åéæ¹çåå ï¼è¦ä¹æ¯æ¥æ¶æ¹çåå ãæåä»åéæ¹è¿è¡ææ¥ï¼æå¨outputç®¡éä¸­ï¼é¤äºtcpæä»¶å¤ï¼è¿æ·»å äºstdoutæä»¶ï¼ä¹å°±æ¯æ¥å¿æ¥äºé¤äºä¼éè¿tcpåéå¤ï¼è¿ä¼æå°å¨æ åè¾åºä¸­ã\n\noutput {\n\n    tcp {\n        ...\n    }\n\n    stdout {}\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nç¶åç­å¾ä¸æ®µæ¶é´ï¼ç¶ååæ¥çè¯¥ç®¡éçä¿¡æ¯ï¼stdoutæä»¶çinåoutå®å¨ç¸ç­ï¼ä½tcpæä»¶inåoutè¿æ¯ç¸å·®çå¤§ï¼ä¹å°±æ¯outputç®¡éåºè¯¥æ²¡é®é¢ã\n\næååè®¾proxyç«¯æé®é¢ãæ¥å¿æ¯å¯ä»¥ä»logstashç«¯åéå°proxyç«¯çï¼åªæ¯å¾æ¢ï¼å¹¶ä¸è¿æå¶ä»æ°æ®æºä¹å¨å¾proxyç«¯åéæ¥å¿ï¼ä¹æ²¡æè¿ä¸ªé®é¢ï¼æä»¥æçªç¶æ³å°ï¼è¯¥æ°æ®æºçæ¥å¿å¾å¤§ï¼ä¼ä¸ä¼æ¯è¿ä¸ªåå å¯¼è´çå¢ï¼\n\næä»ä¸é¢æ åè¾åºä¸­æäºä¸æ¡æ¥å¿åºæ¥ï¼134kå¤§å°ï¼ç¶åææå¨çç¨ncå½ä»¤å°æ¥å¿åéå°proxyï¼å ä¸ºæ¥å¿å¾å¤§ï¼ææ¯å°æ¥å¿åå¥å°æä»¶ï¼ç¶ååç¨ç®¡éçæ¹å¼åéç\n\ncat test.txt | nc \n\n\n1\n\n\néè¿æ¥çproxyçæ¥å¿åç°ï¼å¶æ ¹æ¬æ²¡ææ¶å°è¯¥æ¡æ¥å¿ãé£ä¹é®é¢åå æ¾å°äºï¼å°±æ¯å ä¸ºæ¥å¿å¤ªå¤§ï¼å¯¼è´æ¥å¿åçäºä¸¢å¤±ã\n\n\n# ä»£ç ææ¥\n\nproxyæå¡çæ¯golangåçï¼éè¿æ¥çä»£ç ï¼è¿éä½¿ç¨äºbufio.NewScanneræ¥å¾ªç¯è¯»åè¿æ¥ä¸­çæ°æ®ã\n\n\tscanner := bufio.NewScanner(conn)\n\n\tfor scanner.Scan() {\n\t\t// å¤çæ°æ®\n\t\tmsg := scanner.Text()\n        ...\n\n\n1\n2\n3\n4\n5\n6\n\n\næ¥çNewScanneræ¹æ³å¯ä»¥çå°æä¸ä¸ªmaxTokenSizeåæ°ï¼ç¶åç¨çé»è®¤å¼MaxScanTokenSize\n\nfunc NewScanner(r io.Reader) *Scanner {\n\treturn &Scanner{\n\t\tr:            r,\n\t\tsplit:        ScanLines,\n\t\tmaxTokenSize: MaxScanTokenSize,\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nåè·³è½¬ï¼æä¸ä¸ªåå§åç¼å­å¤§å°startBufSizeä¸º4kåæå¤§çç¼å­å¤§å°MaxScanTokenSizeä¸º64kãä½æ¯æä»¬çæ¥å¿å¤§å°ä¸º134kï¼å·²ç»å¤§äºæå¤§å¤§å°äºï¼æä»¥æ æ³æ¥æ¶å°è¯¥æ¥å¿ï¼ä¹å°±æ¯å ä¸ºè¿ä¸ªåå å¯¼è´äºæ¥å¿åçäºä¸¢å¤±ã\n\nconst (\n\tMaxScanTokenSize = 64 * 1024\n\n\tstartBufSize = 4096\n)\n\n\n1\n2\n3\n4\n5\n\n\næä»¬åçä¸Scanæ¹æ³ï¼æä¸æ®µä»£ç å¦ä¸ï¼å¦ææ¿å°çæ°æ®çå¤§å°å¤§äºmaxTokenSizeï¼åä¼ä½¿ç¨s.setErr(ErrTooLong)è®°å½éè¯¯ï¼ç¶åè¿åfalse\n\n\nfunc (s *Scanner) Scan() bool {\n\n    ..\n    const maxInt = int(^uint(0) >> 1)\n    if len(s.buf) >= s.maxTokenSize || len(s.buf) > maxInt/2 {\n        s.setErr(ErrTooLong)\n        return false\n    }\n    newSize := len(s.buf) * 2\n    if newSize == 0 {\n        newSize = startBufSize\n    }\n    if newSize > s.maxTokenSize {\n        newSize = s.maxTokenSize\n    }\n    newBuf := make([]byte, newSize)\n    copy(newBuf, s.buf[s.start:s.end])\n    ...\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nä½æ¯æä»¬å¨ä¸å¡ä»£ç ä¸­ï¼å¹¶æ²¡æå¤æ­è¯¥éè¯¯ï¼ä¹å°±æ¯å¦æScanæ¹æ³è½ç¶è¿åäºfalseï¼å¾ªç¯ç»æäºï¼ä½æ¯å¹¶æ²¡æä»»ä½éè¯¯ä¿¡æ¯ãä¹å°±æ¯æ æ³åç°è¯¥é®é¢ã\n\n\n# è§£å³æ¹æ³\n\n 1. å°TCPçæå¤§ç¼å­å¤§å°ä¿®æ¹ä¸ºéç½®æä»¶å¯éç½®çï¼è¿æ ·å¦ææ¥å¿å¾å¤§ï¼å¯ä»¥ä¿®æ¹éç½®å¢å¤§ç¼å­ä¸éãåºä¸­ææä¾Bufferæ¹æ³æ¥è®¾ç½®è¯¥ä¸éã\n\n 2. å¨Scanåçéè¯¯æ¶ï¼æå°éè¯¯æ¥å¿ï¼ä»£ç å¦ä¸ï¼\n\n\nscanner := bufio.NewScanner(conn)\n\nfor scanner.Scan() {\n    // å¤çæ°æ®\n    msg := scanner.Text()\n    ...\n\nif err := scanner.Err(); err != nil {\n    log.Errorf("æ«æè¾å¥æ¶åçéè¯¯ï¼%s", err)\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# æ»ç»\n\n 1. è¦æé«èªå·±çææ¥çææ®µï¼çæç»ä»¶æä¾çææ¥æºå¶ï¼è®©ä½ äºåååã\n 2. æ¯ä¸ä¸ªæä¾çåæ°é½è³å³éè¦ï¼æä»¥æä»¬é½éè¦æä¸å®ççè§£ï¼å¯ä»¥åå°BUGçåç',normalizedContent:'# èæ¯\n\nlogstashä»æ°æ®æºæåæ¥å¿ï¼ç¶åéè¿tcpæä»¶åéå°proxyè¿ç¨ä¸­ãå¨ä¸å¡ä¾§åç°æ¥å¿éææ¾å°äºï¼æä»¥æäºè¿ä¸æ¬¡çé®é¢ææ¥ã\n\n\n\n\n# é®é¢ææ¥å®ä½\n\né¦åä»logstashä¾§å¼å§æ£æ¥ãæä»¬åçlogstashçæ¥å¿ï¼æ²¡æææ¾çæ¥éä¿¡æ¯ã\n\nç¶ååæ¥çlogstashç®¡éçç¶æãå¯ä»¥å¾ææ¾ççå°ï¼å¨outputç®¡éä¸­ï¼inè¿è¿å¤§äºoutï¼ä¹å°±æ¯logstashæåçæ¥å¿å·²ç»å°äºoutputç®¡éï¼ä½æ¯æ æ³è¾åºåºå»ï¼å¹¶ä¸duration_in_millisæ¶é´å¾é¿ï¼è¿ä¸ªä»£è¡¨çååºå»çéçå¾æ¢ï¼è¿æ¯ä»ä¹åå å¢ï¼\n\ncurl -xget \'localhost:9600/_node/stats/pipelines/azure_event_hubs?pretty\'\n\n{\n    ...\n"outputs" : [ {\n        "id" : "99b12e190d297be5d6113d04cf10089a3dccbaef7eed0cc41515e8e5af5f4595",\n        "name" : "tcp",\n        "events" : {\n        "in" : 341,\n        "out" : 69,\n        "duration_in_millis" : 519709\n        }\n    } \n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè¦ä¹æ¯åéæ¹çåå ï¼è¦ä¹æ¯æ¥æ¶æ¹çåå ãæåä»åéæ¹è¿è¡ææ¥ï¼æå¨outputç®¡éä¸­ï¼é¤äºtcpæä»¶å¤ï¼è¿æ·»å äºstdoutæä»¶ï¼ä¹å°±æ¯æ¥å¿æ¥äºé¤äºä¼éè¿tcpåéå¤ï¼è¿ä¼æå°å¨æ åè¾åºä¸­ã\n\noutput {\n\n    tcp {\n        ...\n    }\n\n    stdout {}\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nç¶åç­å¾ä¸æ®µæ¶é´ï¼ç¶ååæ¥çè¯¥ç®¡éçä¿¡æ¯ï¼stdoutæä»¶çinåoutå®å¨ç¸ç­ï¼ä½tcpæä»¶inåoutè¿æ¯ç¸å·®çå¤§ï¼ä¹å°±æ¯outputç®¡éåºè¯¥æ²¡é®é¢ã\n\næååè®¾proxyç«¯æé®é¢ãæ¥å¿æ¯å¯ä»¥ä»logstashç«¯åéå°proxyç«¯çï¼åªæ¯å¾æ¢ï¼å¹¶ä¸è¿æå¶ä»æ°æ®æºä¹å¨å¾proxyç«¯åéæ¥å¿ï¼ä¹æ²¡æè¿ä¸ªé®é¢ï¼æä»¥æçªç¶æ³å°ï¼è¯¥æ°æ®æºçæ¥å¿å¾å¤§ï¼ä¼ä¸ä¼æ¯è¿ä¸ªåå å¯¼è´çå¢ï¼\n\næä»ä¸é¢æ åè¾åºä¸­æäºä¸æ¡æ¥å¿åºæ¥ï¼134kå¤§å°ï¼ç¶åææå¨çç¨ncå½ä»¤å°æ¥å¿åéå°proxyï¼å ä¸ºæ¥å¿å¾å¤§ï¼ææ¯å°æ¥å¿åå¥å°æä»¶ï¼ç¶ååç¨ç®¡éçæ¹å¼åéç\n\ncat test.txt | nc \n\n\n1\n\n\néè¿æ¥çproxyçæ¥å¿åç°ï¼å¶æ ¹æ¬æ²¡ææ¶å°è¯¥æ¡æ¥å¿ãé£ä¹é®é¢åå æ¾å°äºï¼å°±æ¯å ä¸ºæ¥å¿å¤ªå¤§ï¼å¯¼è´æ¥å¿åçäºä¸¢å¤±ã\n\n\n# ä»£ç ææ¥\n\nproxyæå¡çæ¯golangåçï¼éè¿æ¥çä»£ç ï¼è¿éä½¿ç¨äºbufio.newscanneræ¥å¾ªç¯è¯»åè¿æ¥ä¸­çæ°æ®ã\n\n\tscanner := bufio.newscanner(conn)\n\n\tfor scanner.scan() {\n\t\t// å¤çæ°æ®\n\t\tmsg := scanner.text()\n        ...\n\n\n1\n2\n3\n4\n5\n6\n\n\næ¥çnewscanneræ¹æ³å¯ä»¥çå°æä¸ä¸ªmaxtokensizeåæ°ï¼ç¶åç¨çé»è®¤å¼maxscantokensize\n\nfunc newscanner(r io.reader) *scanner {\n\treturn &scanner{\n\t\tr:            r,\n\t\tsplit:        scanlines,\n\t\tmaxtokensize: maxscantokensize,\n\t}\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nåè·³è½¬ï¼æä¸ä¸ªåå§åç¼å­å¤§å°startbufsizeä¸º4kåæå¤§çç¼å­å¤§å°maxscantokensizeä¸º64kãä½æ¯æä»¬çæ¥å¿å¤§å°ä¸º134kï¼å·²ç»å¤§äºæå¤§å¤§å°äºï¼æä»¥æ æ³æ¥æ¶å°è¯¥æ¥å¿ï¼ä¹å°±æ¯å ä¸ºè¿ä¸ªåå å¯¼è´äºæ¥å¿åçäºä¸¢å¤±ã\n\nconst (\n\tmaxscantokensize = 64 * 1024\n\n\tstartbufsize = 4096\n)\n\n\n1\n2\n3\n4\n5\n\n\næä»¬åçä¸scanæ¹æ³ï¼æä¸æ®µä»£ç å¦ä¸ï¼å¦ææ¿å°çæ°æ®çå¤§å°å¤§äºmaxtokensizeï¼åä¼ä½¿ç¨s.seterr(errtoolong)è®°å½éè¯¯ï¼ç¶åè¿åfalse\n\n\nfunc (s *scanner) scan() bool {\n\n    ..\n    const maxint = int(^uint(0) >> 1)\n    if len(s.buf) >= s.maxtokensize || len(s.buf) > maxint/2 {\n        s.seterr(errtoolong)\n        return false\n    }\n    newsize := len(s.buf) * 2\n    if newsize == 0 {\n        newsize = startbufsize\n    }\n    if newsize > s.maxtokensize {\n        newsize = s.maxtokensize\n    }\n    newbuf := make([]byte, newsize)\n    copy(newbuf, s.buf[s.start:s.end])\n    ...\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nä½æ¯æä»¬å¨ä¸å¡ä»£ç ä¸­ï¼å¹¶æ²¡æå¤æ­è¯¥éè¯¯ï¼ä¹å°±æ¯å¦æscanæ¹æ³è½ç¶è¿åäºfalseï¼å¾ªç¯ç»æäºï¼ä½æ¯å¹¶æ²¡æä»»ä½éè¯¯ä¿¡æ¯ãä¹å°±æ¯æ æ³åç°è¯¥é®é¢ã\n\n\n# è§£å³æ¹æ³\n\n 1. å°tcpçæå¤§ç¼å­å¤§å°ä¿®æ¹ä¸ºéç½®æä»¶å¯éç½®çï¼è¿æ ·å¦ææ¥å¿å¾å¤§ï¼å¯ä»¥ä¿®æ¹éç½®å¢å¤§ç¼å­ä¸éãåºä¸­ææä¾bufferæ¹æ³æ¥è®¾ç½®è¯¥ä¸éã\n\n 2. å¨scanåçéè¯¯æ¶ï¼æå°éè¯¯æ¥å¿ï¼ä»£ç å¦ä¸ï¼\n\n\nscanner := bufio.newscanner(conn)\n\nfor scanner.scan() {\n    // å¤çæ°æ®\n    msg := scanner.text()\n    ...\n\nif err := scanner.err(); err != nil {\n    log.errorf("æ«æè¾å¥æ¶åçéè¯¯ï¼%s", err)\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# æ»ç»\n\n 1. è¦æé«èªå·±çææ¥çææ®µï¼çæç»ä»¶æä¾çææ¥æºå¶ï¼è®©ä½ äºåååã\n 2. æ¯ä¸ä¸ªæä¾çåæ°é½è³å³éè¦ï¼æä»¥æä»¬é½éè¦æä¸å®ççè§£ï¼å¯ä»¥åå°bugçåç',charsets:{cjk:!0},lastUpdated:"2023/11/17, 16:03:58",lastUpdatedTimestamp:1700208238e3},{title:"ä½¿ç¨javaå¼ålogstashçfilteræä»¶",frontmatter:{title:"ä½¿ç¨javaå¼ålogstashçfilteræä»¶",date:"2022-12-20T15:37:33.000Z",permalink:"/pages/7f16f6/",categories:["è®¡ç®æº","ç»ä»¶","å¶ä»"],tags:["ç»ä»¶","logstash","java"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä¸»è¦è®°å½ä½¿ç¨javaå¼ålogstashçfilteræä»¶çè¿ç¨ã",feed:{enable:!0},comment:!0,meta:[{name:"twitter:title",content:"ä½¿ç¨javaå¼ålogstashçfilteræä»¶"},{name:"twitter:description",content:"ä¸»è¦è®°å½ä½¿ç¨javaå¼ålogstashçfilteræä»¶çè¿ç¨ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/09.%E5%85%B6%E4%BB%96/03.%E4%BD%BF%E7%94%A8java%E5%BC%80%E5%8F%91logstash%E7%9A%84filter%E6%8F%92%E4%BB%B6.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ä½¿ç¨javaå¼ålogstashçfilteræä»¶"},{property:"og:description",content:"ä¸»è¦è®°å½ä½¿ç¨javaå¼ålogstashçfilteræä»¶çè¿ç¨ã"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/09.%E5%85%B6%E4%BB%96/03.%E4%BD%BF%E7%94%A8java%E5%BC%80%E5%8F%91logstash%E7%9A%84filter%E6%8F%92%E4%BB%B6.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-12-20T15:37:33.000Z"},{property:"article:tag",content:"ç»ä»¶"},{property:"article:tag",content:"logstash"},{property:"article:tag",content:"java"},{itemprop:"name",content:"ä½¿ç¨javaå¼ålogstashçfilteræä»¶"},{itemprop:"description",content:"ä¸»è¦è®°å½ä½¿ç¨javaå¼ålogstashçfilteræä»¶çè¿ç¨ã"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/09.%E5%85%B6%E4%BB%96/03.%E4%BD%BF%E7%94%A8java%E5%BC%80%E5%8F%91logstash%E7%9A%84filter%E6%8F%92%E4%BB%B6.html",relativePath:"04.ç¼ç¨/09.å¶ä»/03.ä½¿ç¨javaå¼ålogstashçfilteræä»¶.md",key:"v-e9cb914e",path:"/pages/7f16f6/",headers:[{level:2,title:"0. åè¨",slug:"_0-åè¨",normalizedTitle:"0. åè¨",charIndex:2},{level:2,title:"1. åå¤å¼åç¯å¢",slug:"_1-åå¤å¼åç¯å¢",normalizedTitle:"1. åå¤å¼åç¯å¢",charIndex:111},{level:2,title:"2. ç¼å logstash java filter æä»¶",slug:"_2-ç¼å-logstash-java-filter-æä»¶",normalizedTitle:"2. ç¼å logstash java filter æä»¶",charIndex:518},{level:3,title:"2.1 åå¤å®æ¹ demo",slug:"_2-1-åå¤å®æ¹-demo",normalizedTitle:"2.1 åå¤å®æ¹ demo",charIndex:552},{level:3,title:"2.2 å¼å Filter ä»£ç ",slug:"_2-2-å¼å-filter-ä»£ç ",normalizedTitle:"2.2 å¼å filter ä»£ç ",charIndex:835},{level:2,title:"3. ååæµè¯",slug:"_3-ååæµè¯",normalizedTitle:"3. ååæµè¯",charIndex:2129},{level:2,title:"4. æåé¨ç½² Filter æä»¶",slug:"_4-æåé¨ç½²-filter-æä»¶",normalizedTitle:"4. æåé¨ç½² filter æä»¶",charIndex:2368},{level:3,title:"4.1 åæ°æ®ä¿¡æ¯",slug:"_4-1-åæ°æ®ä¿¡æ¯",normalizedTitle:"4.1 åæ°æ®ä¿¡æ¯",charIndex:2390},{level:3,title:"4.2 æåä»»å¡",slug:"_4-2-æåä»»å¡",normalizedTitle:"4.2 æåä»»å¡",charIndex:2588},{level:3,title:"4.3 å®è£",slug:"_4-3-å®è£",normalizedTitle:"4.3 å®è£",charIndex:2659},{level:2,title:"5. éªè¯",slug:"_5-éªè¯",normalizedTitle:"5. éªè¯",charIndex:3043},{level:2,title:"6. ç¸å³é¾æ¥",slug:"_6-ç¸å³é¾æ¥",normalizedTitle:"6. ç¸å³é¾æ¥",charIndex:3700}],headersStr:"0. åè¨ 1. åå¤å¼åç¯å¢ 2. ç¼å logstash java filter æä»¶ 2.1 åå¤å®æ¹ demo 2.2 å¼å Filter ä»£ç  3. ååæµè¯ 4. æåé¨ç½² Filter æä»¶ 4.1 åæ°æ®ä¿¡æ¯ 4.2 æåä»»å¡ 4.3 å®è£ 5. éªè¯ 6. ç¸å³é¾æ¥",content:'# 0. åè¨\n\nå¨å·¥ä½ä¸­éå°ï¼logstash ä¸­ç filter ä¸­åäºå¤§éçè§£æé»è¾ï¼è§£ææ§è½éå°ç¶é¢ï¼æä»¥å¸æå°è¯¥é¨åçé»è¾è½¬æ¢æ java å¼åçæä»¶ï¼ä»¥æé«è§£æéåº¦ã\n\næ¬æä¸»è¦è®°å½æå¼åæä»¶çè¿ç¨ã\n\n\n# 1. åå¤å¼åç¯å¢\n\nä¸è½½ logstash æºç \n\nç´æ¥å¯ä»¥å» logstash github ä¸­éæ©èªå·±ä½¿ç¨ççæ¬è¿è¡ä¸è½½å³å¯ã\n\næå»º logstash\n\nå°ä¸è½½ç logstash åç¼©åè§£ååºæ¥ï¼è¿å¥ logstash æ ¹ç®å½ä¸ï¼å½åè·¯å¾ä¸æ gradlew å gradlew.bat ä¸¤ä¸ªèæ¬æä»¶ï¼åèæ¯å¨ linux ä¸æ§è¡çï¼åèæ¯å¨ windows æ§è¡çèæ¬ã\n\nåè®¾å½åç¯å¢æ¯ windowsï¼æ§è¡ gradlew.bat assemble å½ä»¤å¯ä»¥å¯¹å½åæ¨¡åè¿è¡æå»ºãå¨è¿ä¸ªè¿ç¨ä¸­ä¼å»ä¸è½½ææçä¾èµåå°æ¬å°ãç­å¾æå»ºå®æï¼ç´è³è¾åº BUILD SUCCESSFUL ä»£è¡¨æå»ºæåã\n\n> gradlew.bat èæ¬æ¯å¯¹ gradle çå°è£ï¼å¨æ§è¡è¯¥å½ä»¤æ¶ï¼ä¼ä¸»å¨æ ¹æ® gradle/wrapper/ ä¸çéç½®å»ä¸è½½ gradle å·¥å·ï¼ç¶ååè°ç¨ gradle è¿è¡æå»ºæ¨¡å\n\n\n# 2. ç¼å logstash java filter æä»¶\n\n\n# 2.1 åå¤å®æ¹ demo\n\nä¸è½½ java æä»¶å®æ¹æ¨¡æ¿\n\nå° logstash-filter-java_filter_example ä¸è½½å°æ¬å°ä½¿ç¨ï¼èªå®ä¹å¼åçæä»¶æ¯åºäºè¯¥ example è¿è¡ä¿®æ¹çã\n\næå»ºæä»¶\n\nå¨è¯¥é¡¹ç®çæ ¹ç®å½ä¸ï¼åå»º gradle.properties æä»¶ï¼éè¦æ·»å åéæå® logstash ä¸ç logstash-core ç®å½è·¯å¾ï¼ä½¿ç¨ç»å¯¹è·¯å¾å³å¯ã\n\nLOGSTASH_CORE_PATH=<target_folder>/logstash-core\n\n\n1\n\n\nè¯¥åéæ¯ç» build.gradle æä»¶ä¸­ä½¿ç¨çã\n\n\n# 2.2 å¼å Filter ä»£ç \n\né¦åæ¥çå®æ¹æä¾ç demo Filter ä»£ç ï¼ä»£ç è·¯å¾å¨ï¼src\\main\\java\\org\\logstashplugins\\JavaFilterExample.javaï¼æä»¬å¼åçæä»¶åºæ¬æ¯æç§è¿ä¸ªä¾å­è¿è¡ä¿®æ¹å®ç°çã\n\n * è®¾ç½® pipeline ä¸­çæä»¶åç§°\n\né¦åå¯ä»¥çå°æä¸ä¸ªæ³¨è§£ @LogstashPlugin(name = "java_filter_example") name çå¼æ¯ææä»¬å¨ pipeline ä¸­å¡«åçæä»¶åç§°ã\n\n * å¨ pipeline ä¸­ä¼ åå°æä»¶ä¸­\n\néè¿ PluginConfigSpec.stringSetting å®ä¹åé\n\npublic static final PluginConfigSpec<String> SOURCE_CONFIG = PluginConfigSpec.stringSetting("source", "message");\n\n\n1\n\n\nåéè¿å¨æé æ¹æ³ä¸­è°ç¨ get æ¹æ³å³å¯è·åå°ä¼ å¥çå¼\n\nthis.sourceField = config.get(SOURCE_CONFIG);\n\n\n1\n\n\nå¹¶ä¸éè¦å°æ°å¢çå­æ®µæ·»å å° configSchema æ¹æ³ä¸­å¹¶è¿ååºå»ã\n\n@Override\npublic Collection<PluginConfigSpec<?>> configSchema() {\n\t// should return a list of all configuration options for this plugin\n\treturn Collections.singletonList(SOURCE_CONFIG);\n}\n\n\n1\n2\n3\n4\n5\n\n * filter ä¸»ä½ç¼ç \n\nè¯¥æä»¶çä¸»ä½æ¯ filter æ¹æ³ï¼ä¹å°±æ¯æ°æ®çè¿æ»¤èµ°ç filter æ¹æ³ï¼æä»¬å°æ³è¦åçè§£æè§åå®ç°å¨è¯¥æ¹æ³ä¸­å³å¯ã\n\nå¯ä»¥çå°è¯¥æ¹æ³ä¸­æä¸ä¸ªå¯¹ events éåçå¤çï¼æ¯ä¸ä¸ª Event é½æ¯è¿æ¥çæ¯ä¸æ¡æ°æ®ï¼ç¶åå¯¹è¯¥æ¡æ°æ®è¿è¡å¤çè½¬æ¢ï¼æååå°è½¬æ¢å¥½ç events ä¼ åºå»ã\n\nå¯ä»¥çå°å®æ¹çæ¡ä¾æ¯å°ä¼ å¥ç message å­ç¬¦ä¸²ç¿»è½¬ã\n\n@Override\npublic Collection<Event> filter(Collection<Event> events, FilterMatchListener matchListener) {\n\tfor (Event e : events) {\n\t\tObject f = e.getField(sourceField);\n\t\tif (f instanceof String) {\n\t\t\te.setField(sourceField, StringUtils.reverse((String)f));\n\t\t\tmatchListener.filterMatched(e);\n\t\t}\n\t}\n\n\treturn events;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# 3. ååæµè¯\n\nåæµå¯¹æä»¶æ¥è¯´è³å³éè¦ï¼æä»¶çè§åè½¬æ¢æµç¨ãå¤æ­é»è¾é½éå¸¸å¤ï¼åç§ç±»åçæ°æ®é½å¯è½å¯¼è´æä»¶åºéï¼èæä»¶éªè¯éè¦ç¼è¯ãæåãå®è£åæµè¯ï¼æµç¨è¾é¿ï¼æä»¥æä»¬å¯ä»¥éè¿åæµæ¥åå°ä»¥ä¸æµç¨çè¿è¡ï¼å¨åæµä¸­å°±æææçå¯è½æ§é½éªè¯å°ï¼èçå¤§éçæ¶é´ãå¹¶ä¸å¨åç»­è¿­ä»£ä¿®æ¹ä¸­ï¼å¯ä»¥åå°æ¹å¨å¼åã\n\nå»ºè®®å¯ä»¥ä½¿ç¨ junit çåæ°ååæµæ¹å¼ï¼å¯ä»¥æé«åæµçæçåæ°éãè¿ä¸ªéè¦å¨ build.gradle æä»¶ä¸­ç dependencies æ·»å æ¯æåæ°åçåºæ¥æ¯æã\n\n\n# 4. æåé¨ç½² Filter æä»¶\n\n\n# 4.1 åæ°æ®ä¿¡æ¯\n\næä»¬éè¦å¨ build.gradle æä»¶ä¸­ä¿®æ¹é¨åçæä»¶åæ°æ®ä¿¡æ¯ï¼å descriptionãauthors å email ç­å­æ®µé½å¯ä»¥éæå¡«åï¼ä»¥ä¸å­æ®µéè¦æ³¨æï¼\n\n * groupï¼éè¦åååç¸å\n * pluginClassï¼éè¦åæä»¶ Filter çç±»åç¸å\n * pluginNameï¼éè¦å @LogstashPlugin ä¸­ç name ç¸å\n\n\n# 4.2 æåä»»å¡\n\néè¿æ§è¡ gradlew.bat gem è¿è¡æä»¶æåä»»å¡ï¼æåä¼å¨æä»¶æ ¹ç®ä¸çæ .gem çæä»¶å®è£åæä»¶ã\n\n\n# 4.3 å®è£\n\nå®è£æå¨çº¿å®è£åç¦»çº¿å®è£ä¸¤ç§æ¹å¼ã\n\n> æ³¨æï¼æä»¬éè¦å»å®ç½ä¸è½½å¯ä»¥ç´æ¥ä½¿ç¨ç logstashï¼èä¸è½ä½¿ç¨ä¸é¢èªå·±ä¸è½½ç logstash æºç ã\n\nå¨çº¿å®è£\n\nå¨çº¿å®è£ä¼å»è®¿é® Elastic çå®ç½ï¼æä»¥éè¦æ¯å¨çº¿çç¯å¢ã\n\néè¿æ§è¡ logstash/bin è·¯å¾ä¸ç logstash-plugin å½ä»¤è¿è¡å®è£ï¼ç­å¾çå»å³å¯å®è£æåã\n\nlogstash-plugin install /path/javaPlugin.gem\n\n\n1\n\n\nç¦»çº¿å®è£\n\nå¨æäºåºæ¯ä¸ï¼ç¯å¢æ¯ä¸è½è¿æ¥å¤ç½çï¼æä»¥éè¦ä½¿ç¨ç¦»çº¿å®è£çæ¹å¼ã\n\nå°çæç gem æä»¶åç¼©å° zip åä¸­ï¼ç¶ååä½¿ç¨ logstash-plugin å½ä»¤è¿è¡å®è£ã\n\nlogstash-plugin install file:///tmp/plugin.zip\n\n\n1\n\n\n\n# 5. éªè¯\n\nå®æ¹çæä»¶ example çåè½æ¯ç¿»è½¬å­ç¬¦ä¸²çåè½ï¼æä»¥æä»¬åªéè¦éªè¯è¯¥åè½å³å¯ã\n\n 1. åå»ºä¸ä¸ª pipeline.conf\n\ninput {\n    # è¾å¥ä¸ä¸ªå­ç¬¦ä¸²\n    generator { message => "Hello world!" count => 1 }\n}\n\nfilter {\n\t# å¨æä»¶ä¸­@LogstashPluginéç½®çæä»¶åç§°\n    java_filter_example {}\n}\n\noutput {\n    # ç´æ¥æå°å°æ§å¶å°\n    stdout { }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n 2. å¯å¨ logstash å è½½ä¸é¢ç pipeline.conf\n\nlogstash -f pipeline.conf\n\n\n1\n\n\nè¾åºå¦ä¸ï¼å¯ä»¥çå° message å­æ®µä¸­ç Hello world!è¢«ç¿»è½¬äºã\n\n{\n\t"host" => {\n\t\t"name" => "4-sip0060"\n\t},\n\t"event" => {\n\t\t"original" => "Hello world!",\n\t\t"sequence" => 0\n\t},\n\t"@timestamp" => 2022-12-20T07:27:46.634166300Z,\n\t"@version" => "1",\n\t"message" => "!dlrow olleH"\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# 6. ç¸å³é¾æ¥\n\n * How to write a Java filter plugin',normalizedContent:'# 0. åè¨\n\nå¨å·¥ä½ä¸­éå°ï¼logstash ä¸­ç filter ä¸­åäºå¤§éçè§£æé»è¾ï¼è§£ææ§è½éå°ç¶é¢ï¼æä»¥å¸æå°è¯¥é¨åçé»è¾è½¬æ¢æ java å¼åçæä»¶ï¼ä»¥æé«è§£æéåº¦ã\n\næ¬æä¸»è¦è®°å½æå¼åæä»¶çè¿ç¨ã\n\n\n# 1. åå¤å¼åç¯å¢\n\nä¸è½½ logstash æºç \n\nç´æ¥å¯ä»¥å» logstash github ä¸­éæ©èªå·±ä½¿ç¨ççæ¬è¿è¡ä¸è½½å³å¯ã\n\næå»º logstash\n\nå°ä¸è½½ç logstash åç¼©åè§£ååºæ¥ï¼è¿å¥ logstash æ ¹ç®å½ä¸ï¼å½åè·¯å¾ä¸æ gradlew å gradlew.bat ä¸¤ä¸ªèæ¬æä»¶ï¼åèæ¯å¨ linux ä¸æ§è¡çï¼åèæ¯å¨ windows æ§è¡çèæ¬ã\n\nåè®¾å½åç¯å¢æ¯ windowsï¼æ§è¡ gradlew.bat assemble å½ä»¤å¯ä»¥å¯¹å½åæ¨¡åè¿è¡æå»ºãå¨è¿ä¸ªè¿ç¨ä¸­ä¼å»ä¸è½½ææçä¾èµåå°æ¬å°ãç­å¾æå»ºå®æï¼ç´è³è¾åº build successful ä»£è¡¨æå»ºæåã\n\n> gradlew.bat èæ¬æ¯å¯¹ gradle çå°è£ï¼å¨æ§è¡è¯¥å½ä»¤æ¶ï¼ä¼ä¸»å¨æ ¹æ® gradle/wrapper/ ä¸çéç½®å»ä¸è½½ gradle å·¥å·ï¼ç¶ååè°ç¨ gradle è¿è¡æå»ºæ¨¡å\n\n\n# 2. ç¼å logstash java filter æä»¶\n\n\n# 2.1 åå¤å®æ¹ demo\n\nä¸è½½ java æä»¶å®æ¹æ¨¡æ¿\n\nå° logstash-filter-java_filter_example ä¸è½½å°æ¬å°ä½¿ç¨ï¼èªå®ä¹å¼åçæä»¶æ¯åºäºè¯¥ example è¿è¡ä¿®æ¹çã\n\næå»ºæä»¶\n\nå¨è¯¥é¡¹ç®çæ ¹ç®å½ä¸ï¼åå»º gradle.properties æä»¶ï¼éè¦æ·»å åéæå® logstash ä¸ç logstash-core ç®å½è·¯å¾ï¼ä½¿ç¨ç»å¯¹è·¯å¾å³å¯ã\n\nlogstash_core_path=<target_folder>/logstash-core\n\n\n1\n\n\nè¯¥åéæ¯ç» build.gradle æä»¶ä¸­ä½¿ç¨çã\n\n\n# 2.2 å¼å filter ä»£ç \n\né¦åæ¥çå®æ¹æä¾ç demo filter ä»£ç ï¼ä»£ç è·¯å¾å¨ï¼src\\main\\java\\org\\logstashplugins\\javafilterexample.javaï¼æä»¬å¼åçæä»¶åºæ¬æ¯æç§è¿ä¸ªä¾å­è¿è¡ä¿®æ¹å®ç°çã\n\n * è®¾ç½® pipeline ä¸­çæä»¶åç§°\n\né¦åå¯ä»¥çå°æä¸ä¸ªæ³¨è§£ @logstashplugin(name = "java_filter_example") name çå¼æ¯ææä»¬å¨ pipeline ä¸­å¡«åçæä»¶åç§°ã\n\n * å¨ pipeline ä¸­ä¼ åå°æä»¶ä¸­\n\néè¿ pluginconfigspec.stringsetting å®ä¹åé\n\npublic static final pluginconfigspec<string> source_config = pluginconfigspec.stringsetting("source", "message");\n\n\n1\n\n\nåéè¿å¨æé æ¹æ³ä¸­è°ç¨ get æ¹æ³å³å¯è·åå°ä¼ å¥çå¼\n\nthis.sourcefield = config.get(source_config);\n\n\n1\n\n\nå¹¶ä¸éè¦å°æ°å¢çå­æ®µæ·»å å° configschema æ¹æ³ä¸­å¹¶è¿ååºå»ã\n\n@override\npublic collection<pluginconfigspec<?>> configschema() {\n\t// should return a list of all configuration options for this plugin\n\treturn collections.singletonlist(source_config);\n}\n\n\n1\n2\n3\n4\n5\n\n * filter ä¸»ä½ç¼ç \n\nè¯¥æä»¶çä¸»ä½æ¯ filter æ¹æ³ï¼ä¹å°±æ¯æ°æ®çè¿æ»¤èµ°ç filter æ¹æ³ï¼æä»¬å°æ³è¦åçè§£æè§åå®ç°å¨è¯¥æ¹æ³ä¸­å³å¯ã\n\nå¯ä»¥çå°è¯¥æ¹æ³ä¸­æä¸ä¸ªå¯¹ events éåçå¤çï¼æ¯ä¸ä¸ª event é½æ¯è¿æ¥çæ¯ä¸æ¡æ°æ®ï¼ç¶åå¯¹è¯¥æ¡æ°æ®è¿è¡å¤çè½¬æ¢ï¼æååå°è½¬æ¢å¥½ç events ä¼ åºå»ã\n\nå¯ä»¥çå°å®æ¹çæ¡ä¾æ¯å°ä¼ å¥ç message å­ç¬¦ä¸²ç¿»è½¬ã\n\n@override\npublic collection<event> filter(collection<event> events, filtermatchlistener matchlistener) {\n\tfor (event e : events) {\n\t\tobject f = e.getfield(sourcefield);\n\t\tif (f instanceof string) {\n\t\t\te.setfield(sourcefield, stringutils.reverse((string)f));\n\t\t\tmatchlistener.filtermatched(e);\n\t\t}\n\t}\n\n\treturn events;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# 3. ååæµè¯\n\nåæµå¯¹æä»¶æ¥è¯´è³å³éè¦ï¼æä»¶çè§åè½¬æ¢æµç¨ãå¤æ­é»è¾é½éå¸¸å¤ï¼åç§ç±»åçæ°æ®é½å¯è½å¯¼è´æä»¶åºéï¼èæä»¶éªè¯éè¦ç¼è¯ãæåãå®è£åæµè¯ï¼æµç¨è¾é¿ï¼æä»¥æä»¬å¯ä»¥éè¿åæµæ¥åå°ä»¥ä¸æµç¨çè¿è¡ï¼å¨åæµä¸­å°±æææçå¯è½æ§é½éªè¯å°ï¼èçå¤§éçæ¶é´ãå¹¶ä¸å¨åç»­è¿­ä»£ä¿®æ¹ä¸­ï¼å¯ä»¥åå°æ¹å¨å¼åã\n\nå»ºè®®å¯ä»¥ä½¿ç¨ junit çåæ°ååæµæ¹å¼ï¼å¯ä»¥æé«åæµçæçåæ°éãè¿ä¸ªéè¦å¨ build.gradle æä»¶ä¸­ç dependencies æ·»å æ¯æåæ°åçåºæ¥æ¯æã\n\n\n# 4. æåé¨ç½² filter æä»¶\n\n\n# 4.1 åæ°æ®ä¿¡æ¯\n\næä»¬éè¦å¨ build.gradle æä»¶ä¸­ä¿®æ¹é¨åçæä»¶åæ°æ®ä¿¡æ¯ï¼å descriptionãauthors å email ç­å­æ®µé½å¯ä»¥éæå¡«åï¼ä»¥ä¸å­æ®µéè¦æ³¨æï¼\n\n * groupï¼éè¦åååç¸å\n * pluginclassï¼éè¦åæä»¶ filter çç±»åç¸å\n * pluginnameï¼éè¦å @logstashplugin ä¸­ç name ç¸å\n\n\n# 4.2 æåä»»å¡\n\néè¿æ§è¡ gradlew.bat gem è¿è¡æä»¶æåä»»å¡ï¼æåä¼å¨æä»¶æ ¹ç®ä¸çæ .gem çæä»¶å®è£åæä»¶ã\n\n\n# 4.3 å®è£\n\nå®è£æå¨çº¿å®è£åç¦»çº¿å®è£ä¸¤ç§æ¹å¼ã\n\n> æ³¨æï¼æä»¬éè¦å»å®ç½ä¸è½½å¯ä»¥ç´æ¥ä½¿ç¨ç logstashï¼èä¸è½ä½¿ç¨ä¸é¢èªå·±ä¸è½½ç logstash æºç ã\n\nå¨çº¿å®è£\n\nå¨çº¿å®è£ä¼å»è®¿é® elastic çå®ç½ï¼æä»¥éè¦æ¯å¨çº¿çç¯å¢ã\n\néè¿æ§è¡ logstash/bin è·¯å¾ä¸ç logstash-plugin å½ä»¤è¿è¡å®è£ï¼ç­å¾çå»å³å¯å®è£æåã\n\nlogstash-plugin install /path/javaplugin.gem\n\n\n1\n\n\nç¦»çº¿å®è£\n\nå¨æäºåºæ¯ä¸ï¼ç¯å¢æ¯ä¸è½è¿æ¥å¤ç½çï¼æä»¥éè¦ä½¿ç¨ç¦»çº¿å®è£çæ¹å¼ã\n\nå°çæç gem æä»¶åç¼©å° zip åä¸­ï¼ç¶ååä½¿ç¨ logstash-plugin å½ä»¤è¿è¡å®è£ã\n\nlogstash-plugin install file:///tmp/plugin.zip\n\n\n1\n\n\n\n# 5. éªè¯\n\nå®æ¹çæä»¶ example çåè½æ¯ç¿»è½¬å­ç¬¦ä¸²çåè½ï¼æä»¥æä»¬åªéè¦éªè¯è¯¥åè½å³å¯ã\n\n 1. åå»ºä¸ä¸ª pipeline.conf\n\ninput {\n    # è¾å¥ä¸ä¸ªå­ç¬¦ä¸²\n    generator { message => "hello world!" count => 1 }\n}\n\nfilter {\n\t# å¨æä»¶ä¸­@logstashpluginéç½®çæä»¶åç§°\n    java_filter_example {}\n}\n\noutput {\n    # ç´æ¥æå°å°æ§å¶å°\n    stdout { }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n 2. å¯å¨ logstash å è½½ä¸é¢ç pipeline.conf\n\nlogstash -f pipeline.conf\n\n\n1\n\n\nè¾åºå¦ä¸ï¼å¯ä»¥çå° message å­æ®µä¸­ç hello world!è¢«ç¿»è½¬äºã\n\n{\n\t"host" => {\n\t\t"name" => "4-sip0060"\n\t},\n\t"event" => {\n\t\t"original" => "hello world!",\n\t\t"sequence" => 0\n\t},\n\t"@timestamp" => 2022-12-20t07:27:46.634166300z,\n\t"@version" => "1",\n\t"message" => "!dlrow olleh"\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# 6. ç¸å³é¾æ¥\n\n * how to write a java filter plugin',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"åå¸å¼é",frontmatter:{tags:["åå¸å¼","é","python"],title:"åå¸å¼é",date:"2022-09-21T10:09:01.000Z",permalink:"/pages/d91dfb/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä»ç»äºåå¸å¼ééå°çé®é¢åå¯¹åºçè§£å³æ¹æ¡",feed:{enable:!0},categories:["ç¼ç¨","å¶ä»"],comment:!0,meta:[{name:"twitter:title",content:"åå¸å¼é"},{name:"twitter:description",content:"æ¬æä»ç»äºåå¸å¼ééå°çé®é¢åå¯¹åºçè§£å³æ¹æ¡"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/09.%E5%85%B6%E4%BB%96/01.%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html"},{property:"og:type",content:"article"},{property:"og:title",content:"åå¸å¼é"},{property:"og:description",content:"æ¬æä»ç»äºåå¸å¼ééå°çé®é¢åå¯¹åºçè§£å³æ¹æ¡"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/09.%E5%85%B6%E4%BB%96/01.%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-09-21T10:09:01.000Z"},{property:"article:tag",content:"åå¸å¼"},{property:"article:tag",content:"é"},{property:"article:tag",content:"python"},{itemprop:"name",content:"åå¸å¼é"},{itemprop:"description",content:"æ¬æä»ç»äºåå¸å¼ééå°çé®é¢åå¯¹åºçè§£å³æ¹æ¡"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/09.%E5%85%B6%E4%BB%96/01.%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html",relativePath:"04.ç¼ç¨/09.å¶ä»/01.åå¸å¼é.md",key:"v-087ac98a",path:"/pages/d91dfb/",headers:[{level:2,title:"åè¨",slug:"åè¨",normalizedTitle:"åè¨",charIndex:2},{level:2,title:"æ°æ®åºæ´æ°é®é¢",slug:"æ°æ®åºæ´æ°é®é¢",normalizedTitle:"æ°æ®åºæ´æ°é®é¢",charIndex:34},{level:2,title:"è¶åé®é¢",slug:"è¶åé®é¢",normalizedTitle:"è¶åé®é¢",charIndex:1789},{level:2,title:"åºäºmysqlçä¹è§éæºå¶å®ç°",slug:"åºäºmysqlçä¹è§éæºå¶å®ç°",normalizedTitle:"åºäºmysqlçä¹è§éæºå¶å®ç°",charIndex:3022},{level:2,title:"åºäºmysqlçæ²è§éæºå¶å®ç°",slug:"åºäºmysqlçæ²è§éæºå¶å®ç°",normalizedTitle:"åºäºmysqlçæ²è§éæºå¶å®ç°",charIndex:4436},{level:2,title:"redisåå¸å¼é",slug:"redisåå¸å¼é",normalizedTitle:"redisåå¸å¼é",charIndex:4593},{level:3,title:"åå¸å¼ééè¦è§£å³çé®é¢",slug:"åå¸å¼ééè¦è§£å³çé®é¢",normalizedTitle:"åå¸å¼ééè¦è§£å³çé®é¢",charIndex:4607},{level:3,title:"æåºé®é¢",slug:"æåºé®é¢",normalizedTitle:"æåºé®é¢",charIndex:4804},{level:3,title:"redisä¸­åå­æä½setnx",slug:"redisä¸­åå­æä½setnx",normalizedTitle:"redisä¸­åå­æä½setnx",charIndex:7150},{level:3,title:"æ­»éé®é¢",slug:"æ­»éé®é¢",normalizedTitle:"æ­»éé®é¢",charIndex:7832},{level:3,title:"py-redis-lockåredis-py",slug:"py-redis-lockåredis-py",normalizedTitle:"py-redis-lockåredis-py",charIndex:10238},{level:3,title:"redisçåå¸å¼éä¼ç¼ºç¹",slug:"redisçåå¸å¼éä¼ç¼ºç¹",normalizedTitle:"redisçåå¸å¼éä¼ç¼ºç¹",charIndex:10307}],headersStr:"åè¨ æ°æ®åºæ´æ°é®é¢ è¶åé®é¢ åºäºmysqlçä¹è§éæºå¶å®ç° åºäºmysqlçæ²è§éæºå¶å®ç° redisåå¸å¼é åå¸å¼ééè¦è§£å³çé®é¢ æåºé®é¢ redisä¸­åå­æä½setnx æ­»éé®é¢ py-redis-lockåredis-py redisçåå¸å¼éä¼ç¼ºç¹",content:'# åè¨\n\næ¬æä»ç»äºåå¸å¼ééå°çé®é¢åå¯¹åºçè§£å³æ¹æ¡ã\n\n\n# æ°æ®åºæ´æ°é®é¢\n\nå¨æ°æ®åºä¸­åå»ºä¸ä¸ªååè¡¨ï¼åå«idãnameãcountå­æ®µï¼è¿éä½¿ç¨çpeeweeæ¥æä½æ°æ®åºã\n\nfrom peewee import *\n\ndb = SqliteDatabase(\'people.db\')\n\n\nclass Goods(Model):\n    id = IntegerField()\n    count = IntegerField()\n    name = CharField()\n\n    class Meta:\n        database = db  # This model uses the "people.db" database.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nåå§åæ°æ®è¡¨ä¸­æ°æ®ãç»id=1çåååå§åååæ°éä¸º100\n\nID   NAME      COUNT\n1    clothes   100\n\nä½¿ç¨ä¸¤ä¸ªçº¿ç¨æ¶è´¹ååååºçåºæ¯ï¼æ¯æ¬¡æ¶è´¹æ°éä¸º10ï¼å½ååæ°éåè¶³æ¶ï¼ååæ°éåå°10ãå ä¸ºç¨åºå¯è½ä¼å¨ä»»ä½å°æ¹æåè¿è¡ï¼æä»¬ä½¿ç¨time.Sleepæ¥æé ç¨åºæåçåºæ¯ã\n\nimport time\n\ndef main():\n    # ååºçæ°é\n    num = 10\n\n    goods = Goods.get(Goods.id == 1)\n    time.sleep(random.randint(1, 3))\n    if goods.count < num:\n        print("ååæ°éä¸è¶³")\n    else:\n        goods.count -= num\n        goods.save()\n\nif __name__ == \'__main__\':\n    import threading\n\n    t1 = threading.Thread(target=main)\n    t2 = threading.Thread(target=main)\n\n    t1.start()\n    t2.start()\n    t1.join()\n    t2.join()\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\nè¿è¡åä¼åç°ï¼ååæ°éåæäº90ï¼è¿ææ¾ä¸ç¬¦åæä»¬çé¢æãä¸¤ä¸ªçº¿ç¨é½æ¶è´¹äº10ä¸ªï¼é¢æç»æåºè¯¥æ¯80æå¯¹ã\n\nID   NAME      COUNT\n1    clothes   90\n\næ§è¡è¿ç¨\n\nå¨t1çº¿ç¨æ¥è¯¢å°çgoodsçååæ°éä¸º100ï¼ä¿å­å¨åéä¸­ï¼åæ­¢ï¼ç¶åt2çº¿ç¨å¼å§æ¥è¯¢ï¼æ¥è¯¢å°çæ°éä¹æ¯100ï¼ç¶åå¾ä¸æ§è¡æ¶ï¼t1å10ï¼è°ç¨saveæ¶æ¯åè¯æ°æ®åºä¿å­çæ°éä¸º90ï¼ç»æãt2çº¿ç¨ä¹æ¯100-10ï¼saveæ¶ï¼ä¹æ¯ä¿å­90ã\n\nè§£å³æ¹æ¡\n\nåºè¯¥è®©æ°æ®åºæ ¹æ®èªå·±å½åçå¼æ´æ°ï¼èä¸æ¯ä½¿ç¨åéä¸­çå¼è¿è¡æ´æ°ã\n\næä»¬æ¢å¤ååçæ°éå°100ï¼ç¶åä¿®æ¹ä»£ç å¦ä¸ï¼ä½¿ç¨updateæ¥è®©æ°æ®åºæ ¹æ®å½åçå¼è¿è¡æ´æ°ã\n\ndef main():\n    # ååºçæ°é\n    num = 10\n\n    goods = Goods.get(Goods.id == 1)\n    time.sleep(random.randint(1, 3))\n    if goods.count < num:\n        print("ååæ°éä¸è¶³")\n    else:\n        query = Goods.update(count=Goods.count - num).where(Goods.id == 1)\n        ok = query.execute()\n        if ok:\n            print("æ´æ°æå")\n        else:\n            print("æ´æ°å¤±è´¥")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè¿è¡ç»æç¬¦åæä»¬çé¢æï¼ååæ°éåæäº80ã\n\nID   NAME      COUNT\n1    clothes   80\n\n\n# è¶åé®é¢\n\nè½ç¶è§£å³äºæ´æ°æ°éä¸ä¸è´çé®é¢ï¼ä¾ç¶æ²¡æè§£å³ååè¶åé®é¢ãååæ°éä¾ç¶æ¯100ï¼ä½æ¯æä»¬ä¸¤ä¸ªçº¿ç¨é½æ³ä¹°99ä»¶ã\n\ndef main():\n    # ååºçæ°é\n    num = 99\n\n    goods = Goods.get(Goods.id == 1)\n    time.sleep(random.randint(1, 3))\n    if goods.count < num:\n        print("ååæ°éä¸è¶³")\n    else:\n        query = Goods.update(count=Goods.count - num).where(Goods.id == 1)\n        ok = query.execute()\n        if ok:\n            print("æ´æ°æå")\n        else:\n            print("æ´æ°å¤±è´¥")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè¿è¡ç»ææ¯ï¼ä¸¤ä¸ªçº¿ç¨é½æåä¹°å¥ï¼æ°æ®åºè¡¨ä¸­çæ°éåæäº-98ãæä»¬è¯å®ææä¸ä¸ªçº¿ç¨ä¹°å¥æåï¼èå¦ä¸ä¸ªçº¿ç¨æ§è¡å¤±è´¥ã\n\nID   NAME      COUNT\n1    clothes   -98\n\nå éè§£å³\n\næä»¬å¨ä¹°å¥ä¹åï¼å ä¸ä¸ªéï¼è¿æ ·åæ¶åªè½æä¸ä¸ªç¨æ·å¨æ§è¡ä¹°å¥ã\n\nimport threading\nR = threading.Lock()\n\ndef main():\n    # ååºçæ°é\n    num = 99\n\n    R.acquire()\n    goods = Goods.get(Goods.id == 1)\n    time.sleep(random.randint(1, 3))\n    if goods.count < num:\n        print("ååæ°éä¸è¶³")\n    else:\n        query = Goods.update(count=Goods.count - num).where(Goods.id == 1)\n        ok = query.execute()\n        if ok:\n            print("æ´æ°æå")\n        else:\n            print("æ´æ°å¤±è´¥")\n\n    R.release()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nè¿è¡ä¹åï¼å¯ä»¥çå°åºå­ä¸º1ä»¶ï¼åªæä¸ä¸ªçº¿ç¨æ´æ°æåï¼å¦ä¸ä¸ªæ´æ°å¤±è´¥ã\n\nå½åæ¯åä¸ä¸ªæå¡çä¸¤ä¸ªçº¿ç¨ä¸­ï¼å¯ä»¥æ¿å°éä¸æéï¼ä½æ¯å¦æå¨å¾®æå¡ä¸­ï¼æ¯ä¸æ¬¡è¯·æ±å ä¸ºè´è½½åè¡¡å¯è½è¯·æ±å¨ä¸åçæå¡ä¸­ï¼è¿ä¸¤ä¸ªæå¡çè³ä¸å¨åä¸å°æå¡å¨ä¸ï¼é£ä¹è¿ä¸ªéå°±å¤±æäºã\n\nè¿ä¸ªæ¶åéè¦ä½¿ç¨åå¸å¼éæ¥è§£å³è¯¥é®é¢ã â\n\n\n# åºäºmysqlçä¹è§éæºå¶å®ç°\n\nä»ä¹æ¯ä¹è§éï¼\n\nä¹è§éï¼å°±æ¯å¾ä¹è§ï¼æ¯æ¬¡å»æ¿æ°æ®çæ¶åé½è®¤ä¸ºå«äººä¸ä¼ä¿®æ¹ï¼æä»¥ä¸ä¼ä¸éï¼ä½æ¯å¨æ´æ°çæ¶åä¼å¤æ­ä¸ä¸å¨æ­¤æé´å«äººææ²¡æå»æ´æ°è¿ä¸ªæ°æ®ï¼å¯ä»¥ä½¿ç¨çæ¬å·ç­æºå¶ï¼ä¹è§ééç¨äºå¤è¯»çåºç¨ç±»åï¼è¿æ ·å¯ä»¥æé«ååé\n\nå®ç°\n\nä»ä¸å¡ä¸­å®ç°ä¹è§éæºå¶ã\n\nå¨ä¹åçGoodsè¡¨ä¸­æ·»å versionå­æ®µ\n\nclass Goods(Model):\n    id = IntegerField()\n    count = IntegerField()\n    name = CharField()\n    version = IntegerField()\n\n    class Meta:\n        database = db  # This model uses the "people.db" database.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ°æ®è¡¨å¦ä¸ï¼\n\nID   NAME      COUNT   VERSION\n1    clothes   100     1\n\nå¨æ´æ°æ¡ä»¶ä¸­æ·»å çæ¬çå¤æ­ï¼ç¡®è®¤å¨æ´æ°åºå­æ°éæ¶ï¼æ¯å¦æå¶ä»æå¡æ´æ¹äºè¯¥æ¡è®°å½ï¼å¦ææ²¡æåè¿è¡æ´æ°ãå¹¶ä¸å¨æ´æ°åºå­æ¶ï¼ç»çæ¬å·+1ï¼ä»£è¡¨çè¯¥è®°å½å·²è¢«ä¿®æ¹ã\n\nå¦ææ²¡ææ´æ°æåï¼åä¸ç´éè¯ï¼ç´è³æåä¸ºæ­¢ã\n\ndef main():\n    # ååºçæ°é\n    num = 99\n\n    while True:\n        goods = Goods.get(Goods.id == 1)\n        time.sleep(random.randint(1, 3))\n        if goods.count < num:\n            print("ååæ°éä¸è¶³")\n            break\n        else:\n            query = Goods.update(count=Goods.count - num, version=Goods.version + 1).where(Goods.id == 1,\n                                                                                           Goods.version == goods.version)\n            ok = query.execute()\n            if ok:\n                print("æ´æ°æå")\n                break\n            else:\n                print("æ´æ°å¤±è´¥")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nè¿è¡ç»æï¼\n\næ´æ°æå\næ´æ°å¤±è´¥\nååæ°éä¸è¶³\n\n\n1\n2\n3\n\n\nåºå­å©ä¸1ä»¶ï¼çæ¬å·æ´æ°ä¸º2ï¼ç¬¦åæä»¬çé¢æã\n\nID   NAME      COUNT   VERSION\n1    clothes   1       2\n\nâ ä¼ç¹ï¼\n\n 1. ç®å\n 2. ä¸éè¦é¢å¤çç»ä»¶\n\nç¼ºç¹ï¼\n\nå¹¶åé«æ¶ï¼ä¸æ­çå¯¹æ°æ®åºè¿è¡æ¥è¯¢ï¼ä¸æ ·ä¼å¢å æ°æ®åºçååãæ§è½å·®ã\n\nâ\n\n\n# åºäºmysqlçæ²è§éæºå¶å®ç°\n\næ²è§é,å°±æ¯å¾æ²è§ï¼æ¯æ¬¡å»æ¿æ°æ®çæ¶åé½è®¤ä¸ºå«äººä¼ä¿®æ¹ï¼æä»¥æ¯æ¬¡å¨æ¿æ°æ®çæ¶åé½ä¼ä¸éï¼è¿æ ·å«äººæ³æ¿è¿ä¸ªæ°æ®å°±ä¼blockç´å°å®æ¿å°éãä¼ ç»çå³ç³»åæ°æ®åºéè¾¹å°±ç¨å°äºå¾å¤è¿ç§éæºå¶ï¼æ¯å¦è¡éï¼è¡¨éç­ï¼è¯»éï¼åéç­ï¼é½æ¯å¨åæä½ä¹ååä¸éã\n\nç¼ºç¹ï¼å¹¶åæ§ä¸é«ï¼ä¸å»ºè®®ä½¿ç¨\n\n\n# redisåå¸å¼é\n\n\n# åå¸å¼ééè¦è§£å³çé®é¢\n\n 1. äºæ¥æ§ï¼ä»»ä½æ¶å»åªè½æä¸ä¸ªå®¢æ·æ¥æéï¼ä¸è½åæ¶å¤ä¸ªå®¢æ·è·å\n\n 2. å®å¨æ§ï¼åªæè¢«ææè¯¥éçç¨æ·å é¤ï¼èä¸è½è¢«å¶ä»ç¨æ·å é¤\n\n 3. æ­»éï¼è·åéçå®¢æ·åå ä¸ºæäºåå èå®æºï¼èæªè½éæ¾éï¼å¶ä»å®¢æ·ç«¯æ æ³è·åéï¼éè¦ææºå¶æ¥é¿åè¯¥ç±»é®é¢çåç\n    \n    1. ä»£ç å¼å¸¸ï¼å¯¼è´æ æ³è¿è¡å°release\n    2. ä½ çå½åæå¡å¨ç½ç»é®é¢-èè£\n\n\n# æåºé®é¢\n\næåå»ºä¸ä¸ªrediséçç±»ï¼ä½¿ç¨acquireå éï¼releaseè§£éã\n\nclass Lock:\n    def __init__(self, name):\n        self.redis_client = redis.Redis(host="10.61.74.37")\n        self.name = name\n\n    def acquire(self):\n        if not self.redis_client.get(self.name):\n            self.redis_client.set(self.name, 1)\n            return True\n        else:\n            while True:\n                import time\n                time.sleep(1)\n                if self.redis_client.get(self.name):\n                    self.redis_client.set(self.name, 1)\n                    return True\n\n    def release(self):\n        self.redis_client.delete(self.name)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nå¨å¥å£å¤å éï¼å¨åºå£å¤éæ¾éï¼è¿æ ·åæ¶åªæä¸ä¸ªæå¡è½å¤æ§è¡æ´æ°æä½ã\n\ndef main():\n    # ååºçæ°é\n    num = 99\n    # ååID\n    goods_id = 1\n\n    lock = Lock("lock:goods_{}".format(goods_id))\n    lock.acquire()\n    goods = Goods.get(Goods.id == goods_id)\n    time.sleep(random.randint(1, 3))\n    if goods.count < num:\n        print("ååæ°éä¸è¶³")\n    else:\n        query = Goods.update(count=Goods.count - num).where(Goods.id == 1)\n        ok = query.execute()\n        if ok:\n            print("æ´æ°æå")\n        else:\n            print("æ´æ°å¤±è´¥")\n    lock.release()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nè¿è¡ä¹åï¼åç°åºå­çæ°éæ¯-98ï¼æ²¡æè¾¾å°é¢æçææã\n\nID   NAME      COUNT\n1    clothes   -98\n\næéè¿ææ¥å¿çæ¹å¼ï¼å¨redis_client.getä¹ååreleaseä¸­ææ¥å¿ã\n\nclass Lock:\n    def __init__(self, name):\n        self.redis_client = redis.Redis(host="10.61.74.37")\n        self.name = name\n\n    def acquire(self):\n\n        if not self.redis_client.get(self.name):\n            print("acquire\\n")\n            self.redis_client.set(self.name, 1)\n            return True\n        else:\n            while True:\n                import time\n                time.sleep(1)\n                if self.redis_client.get(self.name):\n                    self.redis_client.set(self.name, 1)\n                    return True\n\n    def release(self):\n        print("release")\n        self.redis_client.delete(self.name)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nè¿è¡ç»æå¦ä¸ï¼\n\nacquireacquire\n\næ´æ°æå\nrelease\næ´æ°æå\nrelease\n\n\n1\n2\n3\n4\n5\n6\n\n\nå¨æ²¡æéæ¾éçæ¶åï¼ä¸¤ä¸ªçº¿ç¨ç«ç¶é½æ¿å°éäºï¼\n\nå ä¸ºï¼çº¿ç¨t1å¨æ§è¡redis_client.get(self.name)ä¹åè¿æ²¡æredis_client.set(self.name, 1)æ¶ï¼çº¿ç¨t2ä¹è¿æ¥å°è¿ä¸æ­¥äºï¼ä¹å°±æ¯ä¸¤ä¸ªçº¿ç¨åæ¶å¨self.redis_client.get(self.name)åself.redis_client.set(self.name, 1)ä¹é´ã\n\næä»¬éè¦ä¿è¯getåsetæ¯åå­æ§çï¼æè½è§£å³è¯¥é®é¢ã\n\n\n# redisä¸­åå­æä½setnx\n\nredisä¸­èªå¸¦äºä¸ä¸ªåå­æ§æä½setnxï¼å¯ä»¥è¿è¡æ¥è¯¢å¹¶æ´æ°ã\n\nclass Lock:\n    def __init__(self, name):\n        self.redis_client = redis.Redis(host="10.61.74.37")\n        self.name = name\n\n    def acquire(self):\n#       # å¦æä¸å­å¨ï¼è®¾ç½®å¼ä¸º1ï¼è¿å1. å¦åè¿å0. åå­æä½ã\n        if self.redis_client.setnx(self.name, 1):\n            return True\n        else:\n            while True:\n                import time\n                time.sleep(1)\n                if self.redis_client.setnx(self.name, 1):\n                    return True\n\n    def release(self):\n        self.redis_client.delete(self.name)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè¿è¡åï¼åºå­æ°éä¸º1ï¼ç¬¦åæä»¬çé¢æã\n\nID   NAME      COUNT\n1    clothes   1\n\n\n# æ­»éé®é¢\n\nè·åéçå®¢æ·åå ä¸ºæäºåå èå®æºï¼èæªè½éæ¾éï¼å¶ä»å®¢æ·ç«¯æ æ³è·åéï¼éè¦ææºå¶æ¥é¿åè¯¥ç±»é®é¢çåç\n\n 1. ä»£ç å¼å¸¸ï¼å¯¼è´æ æ³è¿è¡å°release\n 2. æ­ç¹\n\nâ è§£å³æ¹æ¡ï¼\n\néè¿è®¾ç½®è¿ææ¶é´æ¥è§£å³ï¼æ¯æ¬¡å¨æ¿éæ¶ï¼ç»redisä¸­å¯¹åºçkeyè®¾ç½®ä¸ä¸ªè¿ææ¶é´ï¼å³ä½¿åºç°ä¸é¢çé®é¢ï¼keyä¹è½èªå¨è¢«å é¤ï¼è§£å³æ­»éé®é¢ã\n\nclass Lock:\n    def __init__(self, name):\n        self.redis_client = redis.Redis(host="10.61.74.37")\n        self.name = name\n\n    def acquire(self):\n        if self.redis_client.set(self.name, 1, nx=True, ex=15):\n            return True\n        else:\n            while True:\n                import time\n                time.sleep(1)\n                if self.redis_client.set(self.name, 1, nx=True, ex=15):\n                    return True\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nä½æ¯ä¼ææ°é®é¢ï¼\n\n * å½åçº¿ç¨å¦æå¨ä¸æ®µæ¶é´åæ²¡ææ§è¡å®ï¼å½åçç¨åºæ²¡ææ§è¡å®ï¼ç¶åkeyè¿æ\n * ä¸å®å¨ï¼å¦ä¸ä¸ªçº¿ç¨è¿æ¥ä»¥åä¼å°å½åçkeyç»å æï¼å¦ä¸ä¸ªçº¿ç¨å æäºæ¬è¯¥å±äºæè®¾ç½®çå¼ã\n\nè§£å³æ¹æ¡ï¼\n\nå¦æå½åçº¿ç¨æ²¡ææ§è¡å®ï¼é£æçè¿ä¸ªçº¿ç¨è¿åºè¯¥å¨éå½çæ¶åå»ç»­ç§ï¼å°è¿ææ¶é´éæ°è®¾ç½®ãä¸è¬æ¯å¨å¿«è¦è¿æç2/3çæ¶åå»ç»­ç§ãå®æ¶ç¨åºå¯ä»¥ä½¿ç¨å¦ä¸ä¸ªçº¿ç¨å»å®æã\n\nclass Lock:\n    def __init__(self, name):\n        self.redis_client = redis.Redis(host="10.61.74.37")\n        self.name = name\n\n    def acquire(self):\n        if self.redis_client.set(self.name, 1, nx=True, ex=15):\n            # å¯å¨ä¸ä¸ªçº¿ç¨ç¶åå»å®æ¶çå·æ°è¿ä¸ªè¿æï¼è¿ä¸ªæä½æå¥½ä¹æ¯ä½¿ç¨luaèæ¬æ¥å®æã\n            return True\n        else:\n            while True:\n                import time\n                time.sleep(1)\n                if self.redis_client.set(self.name, 1, nx=True, ex=15):\n                    return True\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nâ å¦ä½é²æ­¢æè®¾ç½®çå¼è¢«å¶ä»ççº¿ç¨ç»å é¤æ?\n\nè§£å³æ¹æ³\n\nå¯ä»¥æ¿éçæ¶åçæä¸ä¸ªIDï¼å¹¶å°å¶è®¾ç½®redisä¸­é®å¯¹åºçå¼ï¼å¨å é¤çæ¶åï¼å¤æ­ä»redisä¸­æ¿åºçå¼æ¯å¦ä¸ºè¯¥ç¨åºè®¾ç½®çIDï¼å¦æä¸æ¯ï¼åå é¤å¤±è´¥ã\n\nclass Lock:\n    def __init__(self, name, id=None):\n        self.redis_client = redis.Redis(host="10.61.74.37")\n        self.name = name\n        self.id = id if id else str(uuid.uuid4())\n\n    def acquire(self):\n        if self.redis_client.set(self.name, self.id, nx=True, ex=15):\n            # å¯å¨ä¸ä¸ªçº¿ç¨ç¶åå»å®æ¶çå·æ°è¿ä¸ªè¿æï¼è¿ä¸ªæä½æå¥½ä¹æ¯ä½¿ç¨luaèæ¬æ¥å®æã\n            return True\n        else:\n            while True:\n                import time\n                time.sleep(1)\n                if self.redis_client.set(self.name, self.id, nx=True, ex=15):\n                    return True\n\n    def release(self):\n        val = str(self.redis_client.get(self.name), encoding="utf8")\n        if val == self.id:\n            self.redis_client.delete(self.name)\n        else:\n            print("ä¸è½å é¤èªå·±çé")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nâ ä½æ¯è¿ä¼ææ°çé®é¢ï¼ä¸é¢çreleaseæ¹æ³ï¼getådelete redisä¸­keyåæäºä¸¤ä¸ªæ­¥éª¤ï¼è¿æ¯æå¯è½å¨ä¸¤èä¹é´ä¸­æ­ï¼æä»¥éè¦ä½¿ç¨redisçluaèæ¬æ¥å®ç°ä¸¤èçåå­æä½\n\n\n# py-redis-lockåredis-py\n\nè¯¥åºæ¯å¼æºçåå¸å¼épyå®ç°åºï¼è§£å³äºä¸é¢çé®é¢ãåé¢æç©ºå¯ä»¥åæä¸è¯¥åºçæºç ã\n\n\n# redisçåå¸å¼éä¼ç¼ºç¹\n\nä¼ç¹\n\n * æ§è½é«\n * ç®å\n * redisæ¬èº«ä½¿ç¨å¾é¢ç¹ï¼ä¸éè¦é¢å¤ç»´æ¤\n\nç¼ºç¹\n\n * ä¾èµäºç¬¬ä¸æ¹ç»ä»¶\n\n * åæºçredisææçå¯è½æ§ç¸å¯¹è¾é«ï¼éè¦å¼å¥å¨åµæºå¶\n\n * redisçclusterçå¼å¥ä¼å¯¼è´åæçredisçéä¼æé®é¢ - redlock\n\nâ\n\nâ',normalizedContent:'# åè¨\n\næ¬æä»ç»äºåå¸å¼ééå°çé®é¢åå¯¹åºçè§£å³æ¹æ¡ã\n\n\n# æ°æ®åºæ´æ°é®é¢\n\nå¨æ°æ®åºä¸­åå»ºä¸ä¸ªååè¡¨ï¼åå«idãnameãcountå­æ®µï¼è¿éä½¿ç¨çpeeweeæ¥æä½æ°æ®åºã\n\nfrom peewee import *\n\ndb = sqlitedatabase(\'people.db\')\n\n\nclass goods(model):\n    id = integerfield()\n    count = integerfield()\n    name = charfield()\n\n    class meta:\n        database = db  # this model uses the "people.db" database.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nåå§åæ°æ®è¡¨ä¸­æ°æ®ãç»id=1çåååå§åååæ°éä¸º100\n\nid   name      count\n1    clothes   100\n\nä½¿ç¨ä¸¤ä¸ªçº¿ç¨æ¶è´¹ååååºçåºæ¯ï¼æ¯æ¬¡æ¶è´¹æ°éä¸º10ï¼å½ååæ°éåè¶³æ¶ï¼ååæ°éåå°10ãå ä¸ºç¨åºå¯è½ä¼å¨ä»»ä½å°æ¹æåè¿è¡ï¼æä»¬ä½¿ç¨time.sleepæ¥æé ç¨åºæåçåºæ¯ã\n\nimport time\n\ndef main():\n    # ååºçæ°é\n    num = 10\n\n    goods = goods.get(goods.id == 1)\n    time.sleep(random.randint(1, 3))\n    if goods.count < num:\n        print("ååæ°éä¸è¶³")\n    else:\n        goods.count -= num\n        goods.save()\n\nif __name__ == \'__main__\':\n    import threading\n\n    t1 = threading.thread(target=main)\n    t2 = threading.thread(target=main)\n\n    t1.start()\n    t2.start()\n    t1.join()\n    t2.join()\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\nè¿è¡åä¼åç°ï¼ååæ°éåæäº90ï¼è¿ææ¾ä¸ç¬¦åæä»¬çé¢æãä¸¤ä¸ªçº¿ç¨é½æ¶è´¹äº10ä¸ªï¼é¢æç»æåºè¯¥æ¯80æå¯¹ã\n\nid   name      count\n1    clothes   90\n\næ§è¡è¿ç¨\n\nå¨t1çº¿ç¨æ¥è¯¢å°çgoodsçååæ°éä¸º100ï¼ä¿å­å¨åéä¸­ï¼åæ­¢ï¼ç¶åt2çº¿ç¨å¼å§æ¥è¯¢ï¼æ¥è¯¢å°çæ°éä¹æ¯100ï¼ç¶åå¾ä¸æ§è¡æ¶ï¼t1å10ï¼è°ç¨saveæ¶æ¯åè¯æ°æ®åºä¿å­çæ°éä¸º90ï¼ç»æãt2çº¿ç¨ä¹æ¯100-10ï¼saveæ¶ï¼ä¹æ¯ä¿å­90ã\n\nè§£å³æ¹æ¡\n\nåºè¯¥è®©æ°æ®åºæ ¹æ®èªå·±å½åçå¼æ´æ°ï¼èä¸æ¯ä½¿ç¨åéä¸­çå¼è¿è¡æ´æ°ã\n\næä»¬æ¢å¤ååçæ°éå°100ï¼ç¶åä¿®æ¹ä»£ç å¦ä¸ï¼ä½¿ç¨updateæ¥è®©æ°æ®åºæ ¹æ®å½åçå¼è¿è¡æ´æ°ã\n\ndef main():\n    # ååºçæ°é\n    num = 10\n\n    goods = goods.get(goods.id == 1)\n    time.sleep(random.randint(1, 3))\n    if goods.count < num:\n        print("ååæ°éä¸è¶³")\n    else:\n        query = goods.update(count=goods.count - num).where(goods.id == 1)\n        ok = query.execute()\n        if ok:\n            print("æ´æ°æå")\n        else:\n            print("æ´æ°å¤±è´¥")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè¿è¡ç»æç¬¦åæä»¬çé¢æï¼ååæ°éåæäº80ã\n\nid   name      count\n1    clothes   80\n\n\n# è¶åé®é¢\n\nè½ç¶è§£å³äºæ´æ°æ°éä¸ä¸è´çé®é¢ï¼ä¾ç¶æ²¡æè§£å³ååè¶åé®é¢ãååæ°éä¾ç¶æ¯100ï¼ä½æ¯æä»¬ä¸¤ä¸ªçº¿ç¨é½æ³ä¹°99ä»¶ã\n\ndef main():\n    # ååºçæ°é\n    num = 99\n\n    goods = goods.get(goods.id == 1)\n    time.sleep(random.randint(1, 3))\n    if goods.count < num:\n        print("ååæ°éä¸è¶³")\n    else:\n        query = goods.update(count=goods.count - num).where(goods.id == 1)\n        ok = query.execute()\n        if ok:\n            print("æ´æ°æå")\n        else:\n            print("æ´æ°å¤±è´¥")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè¿è¡ç»ææ¯ï¼ä¸¤ä¸ªçº¿ç¨é½æåä¹°å¥ï¼æ°æ®åºè¡¨ä¸­çæ°éåæäº-98ãæä»¬è¯å®ææä¸ä¸ªçº¿ç¨ä¹°å¥æåï¼èå¦ä¸ä¸ªçº¿ç¨æ§è¡å¤±è´¥ã\n\nid   name      count\n1    clothes   -98\n\nå éè§£å³\n\næä»¬å¨ä¹°å¥ä¹åï¼å ä¸ä¸ªéï¼è¿æ ·åæ¶åªè½æä¸ä¸ªç¨æ·å¨æ§è¡ä¹°å¥ã\n\nimport threading\nr = threading.lock()\n\ndef main():\n    # ååºçæ°é\n    num = 99\n\n    r.acquire()\n    goods = goods.get(goods.id == 1)\n    time.sleep(random.randint(1, 3))\n    if goods.count < num:\n        print("ååæ°éä¸è¶³")\n    else:\n        query = goods.update(count=goods.count - num).where(goods.id == 1)\n        ok = query.execute()\n        if ok:\n            print("æ´æ°æå")\n        else:\n            print("æ´æ°å¤±è´¥")\n\n    r.release()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nè¿è¡ä¹åï¼å¯ä»¥çå°åºå­ä¸º1ä»¶ï¼åªæä¸ä¸ªçº¿ç¨æ´æ°æåï¼å¦ä¸ä¸ªæ´æ°å¤±è´¥ã\n\nå½åæ¯åä¸ä¸ªæå¡çä¸¤ä¸ªçº¿ç¨ä¸­ï¼å¯ä»¥æ¿å°éä¸æéï¼ä½æ¯å¦æå¨å¾®æå¡ä¸­ï¼æ¯ä¸æ¬¡è¯·æ±å ä¸ºè´è½½åè¡¡å¯è½è¯·æ±å¨ä¸åçæå¡ä¸­ï¼è¿ä¸¤ä¸ªæå¡çè³ä¸å¨åä¸å°æå¡å¨ä¸ï¼é£ä¹è¿ä¸ªéå°±å¤±æäºã\n\nè¿ä¸ªæ¶åéè¦ä½¿ç¨åå¸å¼éæ¥è§£å³è¯¥é®é¢ã â\n\n\n# åºäºmysqlçä¹è§éæºå¶å®ç°\n\nä»ä¹æ¯ä¹è§éï¼\n\nä¹è§éï¼å°±æ¯å¾ä¹è§ï¼æ¯æ¬¡å»æ¿æ°æ®çæ¶åé½è®¤ä¸ºå«äººä¸ä¼ä¿®æ¹ï¼æä»¥ä¸ä¼ä¸éï¼ä½æ¯å¨æ´æ°çæ¶åä¼å¤æ­ä¸ä¸å¨æ­¤æé´å«äººææ²¡æå»æ´æ°è¿ä¸ªæ°æ®ï¼å¯ä»¥ä½¿ç¨çæ¬å·ç­æºå¶ï¼ä¹è§ééç¨äºå¤è¯»çåºç¨ç±»åï¼è¿æ ·å¯ä»¥æé«ååé\n\nå®ç°\n\nä»ä¸å¡ä¸­å®ç°ä¹è§éæºå¶ã\n\nå¨ä¹åçgoodsè¡¨ä¸­æ·»å versionå­æ®µ\n\nclass goods(model):\n    id = integerfield()\n    count = integerfield()\n    name = charfield()\n    version = integerfield()\n\n    class meta:\n        database = db  # this model uses the "people.db" database.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ°æ®è¡¨å¦ä¸ï¼\n\nid   name      count   version\n1    clothes   100     1\n\nå¨æ´æ°æ¡ä»¶ä¸­æ·»å çæ¬çå¤æ­ï¼ç¡®è®¤å¨æ´æ°åºå­æ°éæ¶ï¼æ¯å¦æå¶ä»æå¡æ´æ¹äºè¯¥æ¡è®°å½ï¼å¦ææ²¡æåè¿è¡æ´æ°ãå¹¶ä¸å¨æ´æ°åºå­æ¶ï¼ç»çæ¬å·+1ï¼ä»£è¡¨çè¯¥è®°å½å·²è¢«ä¿®æ¹ã\n\nå¦ææ²¡ææ´æ°æåï¼åä¸ç´éè¯ï¼ç´è³æåä¸ºæ­¢ã\n\ndef main():\n    # ååºçæ°é\n    num = 99\n\n    while true:\n        goods = goods.get(goods.id == 1)\n        time.sleep(random.randint(1, 3))\n        if goods.count < num:\n            print("ååæ°éä¸è¶³")\n            break\n        else:\n            query = goods.update(count=goods.count - num, version=goods.version + 1).where(goods.id == 1,\n                                                                                           goods.version == goods.version)\n            ok = query.execute()\n            if ok:\n                print("æ´æ°æå")\n                break\n            else:\n                print("æ´æ°å¤±è´¥")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nè¿è¡ç»æï¼\n\næ´æ°æå\næ´æ°å¤±è´¥\nååæ°éä¸è¶³\n\n\n1\n2\n3\n\n\nåºå­å©ä¸1ä»¶ï¼çæ¬å·æ´æ°ä¸º2ï¼ç¬¦åæä»¬çé¢æã\n\nid   name      count   version\n1    clothes   1       2\n\nâ ä¼ç¹ï¼\n\n 1. ç®å\n 2. ä¸éè¦é¢å¤çç»ä»¶\n\nç¼ºç¹ï¼\n\nå¹¶åé«æ¶ï¼ä¸æ­çå¯¹æ°æ®åºè¿è¡æ¥è¯¢ï¼ä¸æ ·ä¼å¢å æ°æ®åºçååãæ§è½å·®ã\n\nâ\n\n\n# åºäºmysqlçæ²è§éæºå¶å®ç°\n\næ²è§é,å°±æ¯å¾æ²è§ï¼æ¯æ¬¡å»æ¿æ°æ®çæ¶åé½è®¤ä¸ºå«äººä¼ä¿®æ¹ï¼æä»¥æ¯æ¬¡å¨æ¿æ°æ®çæ¶åé½ä¼ä¸éï¼è¿æ ·å«äººæ³æ¿è¿ä¸ªæ°æ®å°±ä¼blockç´å°å®æ¿å°éãä¼ ç»çå³ç³»åæ°æ®åºéè¾¹å°±ç¨å°äºå¾å¤è¿ç§éæºå¶ï¼æ¯å¦è¡éï¼è¡¨éç­ï¼è¯»éï¼åéç­ï¼é½æ¯å¨åæä½ä¹ååä¸éã\n\nç¼ºç¹ï¼å¹¶åæ§ä¸é«ï¼ä¸å»ºè®®ä½¿ç¨\n\n\n# redisåå¸å¼é\n\n\n# åå¸å¼ééè¦è§£å³çé®é¢\n\n 1. äºæ¥æ§ï¼ä»»ä½æ¶å»åªè½æä¸ä¸ªå®¢æ·æ¥æéï¼ä¸è½åæ¶å¤ä¸ªå®¢æ·è·å\n\n 2. å®å¨æ§ï¼åªæè¢«ææè¯¥éçç¨æ·å é¤ï¼èä¸è½è¢«å¶ä»ç¨æ·å é¤\n\n 3. æ­»éï¼è·åéçå®¢æ·åå ä¸ºæäºåå èå®æºï¼èæªè½éæ¾éï¼å¶ä»å®¢æ·ç«¯æ æ³è·åéï¼éè¦ææºå¶æ¥é¿åè¯¥ç±»é®é¢çåç\n    \n    1. ä»£ç å¼å¸¸ï¼å¯¼è´æ æ³è¿è¡å°release\n    2. ä½ çå½åæå¡å¨ç½ç»é®é¢-èè£\n\n\n# æåºé®é¢\n\næåå»ºä¸ä¸ªrediséçç±»ï¼ä½¿ç¨acquireå éï¼releaseè§£éã\n\nclass lock:\n    def __init__(self, name):\n        self.redis_client = redis.redis(host="10.61.74.37")\n        self.name = name\n\n    def acquire(self):\n        if not self.redis_client.get(self.name):\n            self.redis_client.set(self.name, 1)\n            return true\n        else:\n            while true:\n                import time\n                time.sleep(1)\n                if self.redis_client.get(self.name):\n                    self.redis_client.set(self.name, 1)\n                    return true\n\n    def release(self):\n        self.redis_client.delete(self.name)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nå¨å¥å£å¤å éï¼å¨åºå£å¤éæ¾éï¼è¿æ ·åæ¶åªæä¸ä¸ªæå¡è½å¤æ§è¡æ´æ°æä½ã\n\ndef main():\n    # ååºçæ°é\n    num = 99\n    # ååid\n    goods_id = 1\n\n    lock = lock("lock:goods_{}".format(goods_id))\n    lock.acquire()\n    goods = goods.get(goods.id == goods_id)\n    time.sleep(random.randint(1, 3))\n    if goods.count < num:\n        print("ååæ°éä¸è¶³")\n    else:\n        query = goods.update(count=goods.count - num).where(goods.id == 1)\n        ok = query.execute()\n        if ok:\n            print("æ´æ°æå")\n        else:\n            print("æ´æ°å¤±è´¥")\n    lock.release()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nè¿è¡ä¹åï¼åç°åºå­çæ°éæ¯-98ï¼æ²¡æè¾¾å°é¢æçææã\n\nid   name      count\n1    clothes   -98\n\næéè¿ææ¥å¿çæ¹å¼ï¼å¨redis_client.getä¹ååreleaseä¸­ææ¥å¿ã\n\nclass lock:\n    def __init__(self, name):\n        self.redis_client = redis.redis(host="10.61.74.37")\n        self.name = name\n\n    def acquire(self):\n\n        if not self.redis_client.get(self.name):\n            print("acquire\\n")\n            self.redis_client.set(self.name, 1)\n            return true\n        else:\n            while true:\n                import time\n                time.sleep(1)\n                if self.redis_client.get(self.name):\n                    self.redis_client.set(self.name, 1)\n                    return true\n\n    def release(self):\n        print("release")\n        self.redis_client.delete(self.name)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nè¿è¡ç»æå¦ä¸ï¼\n\nacquireacquire\n\næ´æ°æå\nrelease\næ´æ°æå\nrelease\n\n\n1\n2\n3\n4\n5\n6\n\n\nå¨æ²¡æéæ¾éçæ¶åï¼ä¸¤ä¸ªçº¿ç¨ç«ç¶é½æ¿å°éäºï¼\n\nå ä¸ºï¼çº¿ç¨t1å¨æ§è¡redis_client.get(self.name)ä¹åè¿æ²¡æredis_client.set(self.name, 1)æ¶ï¼çº¿ç¨t2ä¹è¿æ¥å°è¿ä¸æ­¥äºï¼ä¹å°±æ¯ä¸¤ä¸ªçº¿ç¨åæ¶å¨self.redis_client.get(self.name)åself.redis_client.set(self.name, 1)ä¹é´ã\n\næä»¬éè¦ä¿è¯getåsetæ¯åå­æ§çï¼æè½è§£å³è¯¥é®é¢ã\n\n\n# redisä¸­åå­æä½setnx\n\nredisä¸­èªå¸¦äºä¸ä¸ªåå­æ§æä½setnxï¼å¯ä»¥è¿è¡æ¥è¯¢å¹¶æ´æ°ã\n\nclass lock:\n    def __init__(self, name):\n        self.redis_client = redis.redis(host="10.61.74.37")\n        self.name = name\n\n    def acquire(self):\n#       # å¦æä¸å­å¨ï¼è®¾ç½®å¼ä¸º1ï¼è¿å1. å¦åè¿å0. åå­æä½ã\n        if self.redis_client.setnx(self.name, 1):\n            return true\n        else:\n            while true:\n                import time\n                time.sleep(1)\n                if self.redis_client.setnx(self.name, 1):\n                    return true\n\n    def release(self):\n        self.redis_client.delete(self.name)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè¿è¡åï¼åºå­æ°éä¸º1ï¼ç¬¦åæä»¬çé¢æã\n\nid   name      count\n1    clothes   1\n\n\n# æ­»éé®é¢\n\nè·åéçå®¢æ·åå ä¸ºæäºåå èå®æºï¼èæªè½éæ¾éï¼å¶ä»å®¢æ·ç«¯æ æ³è·åéï¼éè¦ææºå¶æ¥é¿åè¯¥ç±»é®é¢çåç\n\n 1. ä»£ç å¼å¸¸ï¼å¯¼è´æ æ³è¿è¡å°release\n 2. æ­ç¹\n\nâ è§£å³æ¹æ¡ï¼\n\néè¿è®¾ç½®è¿ææ¶é´æ¥è§£å³ï¼æ¯æ¬¡å¨æ¿éæ¶ï¼ç»redisä¸­å¯¹åºçkeyè®¾ç½®ä¸ä¸ªè¿ææ¶é´ï¼å³ä½¿åºç°ä¸é¢çé®é¢ï¼keyä¹è½èªå¨è¢«å é¤ï¼è§£å³æ­»éé®é¢ã\n\nclass lock:\n    def __init__(self, name):\n        self.redis_client = redis.redis(host="10.61.74.37")\n        self.name = name\n\n    def acquire(self):\n        if self.redis_client.set(self.name, 1, nx=true, ex=15):\n            return true\n        else:\n            while true:\n                import time\n                time.sleep(1)\n                if self.redis_client.set(self.name, 1, nx=true, ex=15):\n                    return true\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nä½æ¯ä¼ææ°é®é¢ï¼\n\n * å½åçº¿ç¨å¦æå¨ä¸æ®µæ¶é´åæ²¡ææ§è¡å®ï¼å½åçç¨åºæ²¡ææ§è¡å®ï¼ç¶åkeyè¿æ\n * ä¸å®å¨ï¼å¦ä¸ä¸ªçº¿ç¨è¿æ¥ä»¥åä¼å°å½åçkeyç»å æï¼å¦ä¸ä¸ªçº¿ç¨å æäºæ¬è¯¥å±äºæè®¾ç½®çå¼ã\n\nè§£å³æ¹æ¡ï¼\n\nå¦æå½åçº¿ç¨æ²¡ææ§è¡å®ï¼é£æçè¿ä¸ªçº¿ç¨è¿åºè¯¥å¨éå½çæ¶åå»ç»­ç§ï¼å°è¿ææ¶é´éæ°è®¾ç½®ãä¸è¬æ¯å¨å¿«è¦è¿æç2/3çæ¶åå»ç»­ç§ãå®æ¶ç¨åºå¯ä»¥ä½¿ç¨å¦ä¸ä¸ªçº¿ç¨å»å®æã\n\nclass lock:\n    def __init__(self, name):\n        self.redis_client = redis.redis(host="10.61.74.37")\n        self.name = name\n\n    def acquire(self):\n        if self.redis_client.set(self.name, 1, nx=true, ex=15):\n            # å¯å¨ä¸ä¸ªçº¿ç¨ç¶åå»å®æ¶çå·æ°è¿ä¸ªè¿æï¼è¿ä¸ªæä½æå¥½ä¹æ¯ä½¿ç¨luaèæ¬æ¥å®æã\n            return true\n        else:\n            while true:\n                import time\n                time.sleep(1)\n                if self.redis_client.set(self.name, 1, nx=true, ex=15):\n                    return true\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nâ å¦ä½é²æ­¢æè®¾ç½®çå¼è¢«å¶ä»ççº¿ç¨ç»å é¤æ?\n\nè§£å³æ¹æ³\n\nå¯ä»¥æ¿éçæ¶åçæä¸ä¸ªidï¼å¹¶å°å¶è®¾ç½®redisä¸­é®å¯¹åºçå¼ï¼å¨å é¤çæ¶åï¼å¤æ­ä»redisä¸­æ¿åºçå¼æ¯å¦ä¸ºè¯¥ç¨åºè®¾ç½®çidï¼å¦æä¸æ¯ï¼åå é¤å¤±è´¥ã\n\nclass lock:\n    def __init__(self, name, id=none):\n        self.redis_client = redis.redis(host="10.61.74.37")\n        self.name = name\n        self.id = id if id else str(uuid.uuid4())\n\n    def acquire(self):\n        if self.redis_client.set(self.name, self.id, nx=true, ex=15):\n            # å¯å¨ä¸ä¸ªçº¿ç¨ç¶åå»å®æ¶çå·æ°è¿ä¸ªè¿æï¼è¿ä¸ªæä½æå¥½ä¹æ¯ä½¿ç¨luaèæ¬æ¥å®æã\n            return true\n        else:\n            while true:\n                import time\n                time.sleep(1)\n                if self.redis_client.set(self.name, self.id, nx=true, ex=15):\n                    return true\n\n    def release(self):\n        val = str(self.redis_client.get(self.name), encoding="utf8")\n        if val == self.id:\n            self.redis_client.delete(self.name)\n        else:\n            print("ä¸è½å é¤èªå·±çé")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nâ ä½æ¯è¿ä¼ææ°çé®é¢ï¼ä¸é¢çreleaseæ¹æ³ï¼getådelete redisä¸­keyåæäºä¸¤ä¸ªæ­¥éª¤ï¼è¿æ¯æå¯è½å¨ä¸¤èä¹é´ä¸­æ­ï¼æä»¥éè¦ä½¿ç¨redisçluaèæ¬æ¥å®ç°ä¸¤èçåå­æä½\n\n\n# py-redis-lockåredis-py\n\nè¯¥åºæ¯å¼æºçåå¸å¼épyå®ç°åºï¼è§£å³äºä¸é¢çé®é¢ãåé¢æç©ºå¯ä»¥åæä¸è¯¥åºçæºç ã\n\n\n# redisçåå¸å¼éä¼ç¼ºç¹\n\nä¼ç¹\n\n * æ§è½é«\n * ç®å\n * redisæ¬èº«ä½¿ç¨å¾é¢ç¹ï¼ä¸éè¦é¢å¤ç»´æ¤\n\nç¼ºç¹\n\n * ä¾èµäºç¬¬ä¸æ¹ç»ä»¶\n\n * åæºçredisææçå¯è½æ§ç¸å¯¹è¾é«ï¼éè¦å¼å¥å¨åµæºå¶\n\n * redisçclusterçå¼å¥ä¼å¯¼è´åæçredisçéä¼æé®é¢ - redlock\n\nâ\n\nâ',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"countçæ§è½ä¼å",frontmatter:{title:"countçæ§è½ä¼å",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/19cfb6/",tags:["æ§è½é®é¢","sql","clickhouse"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"éå°çsqlæ¥è¯¢è¯­å¥ä¸­åç°çcountæ§è½ä¼åçé®é¢",feed:{enable:!0},categories:["ç¼ç¨","å¶ä»"],comment:!0,meta:[{name:"twitter:title",content:"countçæ§è½ä¼å"},{name:"twitter:description",content:"éå°çsqlæ¥è¯¢è¯­å¥ä¸­åç°çcountæ§è½ä¼åçé®é¢"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/09.%E5%85%B6%E4%BB%96/20.count%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html"},{property:"og:type",content:"article"},{property:"og:title",content:"countçæ§è½ä¼å"},{property:"og:description",content:"éå°çsqlæ¥è¯¢è¯­å¥ä¸­åç°çcountæ§è½ä¼åçé®é¢"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/09.%E5%85%B6%E4%BB%96/20.count%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"æ§è½é®é¢"},{property:"article:tag",content:"sql"},{property:"article:tag",content:"clickhouse"},{itemprop:"name",content:"countçæ§è½ä¼å"},{itemprop:"description",content:"éå°çsqlæ¥è¯¢è¯­å¥ä¸­åç°çcountæ§è½ä¼åçé®é¢"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/09.%E5%85%B6%E4%BB%96/20.count%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html",relativePath:"04.ç¼ç¨/09.å¶ä»/20.countçæ§è½ä¼å.md",key:"v-05a28fa4",path:"/pages/19cfb6/",headers:[{level:2,title:"é®é¢",slug:"é®é¢",normalizedTitle:"é®é¢",charIndex:2},{level:2,title:"å®ä½é®é¢",slug:"å®ä½é®é¢",normalizedTitle:"å®ä½é®é¢",charIndex:77},{level:2,title:"æ¥è¯¢åæ",slug:"æ¥è¯¢åæ",normalizedTitle:"æ¥è¯¢åæ",charIndex:227}],headersStr:"é®é¢ å®ä½é®é¢ æ¥è¯¢åæ",content:"# é®é¢\n\nä»å¤©æµè¯ç»ææäºBUGï¼åç°æä¸ªæ¥è¯¢æ¥å£è¶æ¶äºï¼è¶æ¶æ¶é´ä¸º1åéã\n\nç®åçç¨çæ°æ®åºæ¯clickhouseï¼æ°æ®éå¤§æ¦å¨20äº¿å·¦å³\n\n\n# å®ä½é®é¢\n\næéè¿è°è¯å°æ¥è¯¢æ°æ®çè¯­å¥æå°åºæ¥ï¼æ¥è¯¢è¯­å¥æ¾å¨æ°æ®åºä¸­æ§è¡ï¼åç°å ç§å°±æ¥è¯¢å®æäºï¼è¿ä¸ªæ¶åæå°±å¥äºæªäºï¼åé¢æåä»ç»çæ¥å£çä»£ç ï¼è·è¸ªè°è¯ååç°ï¼é¤äºä¼æ¥è¯¢æ°æ®ä¹å¤ï¼è¿ä¼æ§è¡æ¥è¯¢æ°æ®éçè¯­å¥ã\n\næå°æ¥è¯¢æ°éçè¯­å¥æå°åºæ¥ï¼æ§è¡è¯¥è¯­å¥ï¼åç°æ¯è¶è¿1åéçï¼çæ¥æ¯å®ä½å°é®é¢äºã\n\n\n# æ¥è¯¢åæ\n\nè¯­å¥å¤§æ¦æ¯ä¸é¢è¿æ ·çï¼å¤§æ¦æ30å¤å¼ è¡¨ï¼ä¹å°±æ¯éè¦union30å¤å¼ è¡¨\n\nselect\n    count(*)\nfrom\n    (\n        select\n            a_field,\n            b_field,\n            c_field,\n            d_field,\n            e_field,\n            f_field\n        from\n            A\n        union\n        all\n        select\n            a_field,\n            b_field,\n            c_field,\n            d_field,\n            e_field,\n            f_field\n        from\n            B\n    )\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\nè¿æ¡è¯­å¥æ¯éè¿å°å¤ä¸ªè¡¨unionæä¸ä¸ªå¤§è¡¨ï¼ç¶ååcountæ±æ°éã\n\né®é¢æ¾èæè§ï¼ä¸ºå¥æä»¬è¦æé ä¸å¼ è¿ä¹å¤§çè¡¨å¨åå­ä¸­åcountæ°éï¼ç´æ¥countæ¯å¼ è¡¨çæ°éåç¸å ä¸å°±æ¯äºãä¼åè¯­å¥å¦ä¸ï¼\n\nselect\n    count(cnt)\nfrom\n    (\n        select\n            count() as cnt\n        from\n            A\n        union\n        all\n        select\n            count() as cnt\n        from\n            B\n    )\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå°è¯¥è¯­å¥æ¾å¨æ°æ®åºæ¥è¯¢ï¼ç§çº§è¿åï¼ç´æ¥ä»1åéä¼åå°1ç§é",normalizedContent:"# é®é¢\n\nä»å¤©æµè¯ç»ææäºbugï¼åç°æä¸ªæ¥è¯¢æ¥å£è¶æ¶äºï¼è¶æ¶æ¶é´ä¸º1åéã\n\nç®åçç¨çæ°æ®åºæ¯clickhouseï¼æ°æ®éå¤§æ¦å¨20äº¿å·¦å³\n\n\n# å®ä½é®é¢\n\næéè¿è°è¯å°æ¥è¯¢æ°æ®çè¯­å¥æå°åºæ¥ï¼æ¥è¯¢è¯­å¥æ¾å¨æ°æ®åºä¸­æ§è¡ï¼åç°å ç§å°±æ¥è¯¢å®æäºï¼è¿ä¸ªæ¶åæå°±å¥äºæªäºï¼åé¢æåä»ç»çæ¥å£çä»£ç ï¼è·è¸ªè°è¯ååç°ï¼é¤äºä¼æ¥è¯¢æ°æ®ä¹å¤ï¼è¿ä¼æ§è¡æ¥è¯¢æ°æ®éçè¯­å¥ã\n\næå°æ¥è¯¢æ°éçè¯­å¥æå°åºæ¥ï¼æ§è¡è¯¥è¯­å¥ï¼åç°æ¯è¶è¿1åéçï¼çæ¥æ¯å®ä½å°é®é¢äºã\n\n\n# æ¥è¯¢åæ\n\nè¯­å¥å¤§æ¦æ¯ä¸é¢è¿æ ·çï¼å¤§æ¦æ30å¤å¼ è¡¨ï¼ä¹å°±æ¯éè¦union30å¤å¼ è¡¨\n\nselect\n    count(*)\nfrom\n    (\n        select\n            a_field,\n            b_field,\n            c_field,\n            d_field,\n            e_field,\n            f_field\n        from\n            a\n        union\n        all\n        select\n            a_field,\n            b_field,\n            c_field,\n            d_field,\n            e_field,\n            f_field\n        from\n            b\n    )\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\nè¿æ¡è¯­å¥æ¯éè¿å°å¤ä¸ªè¡¨unionæä¸ä¸ªå¤§è¡¨ï¼ç¶ååcountæ±æ°éã\n\né®é¢æ¾èæè§ï¼ä¸ºå¥æä»¬è¦æé ä¸å¼ è¿ä¹å¤§çè¡¨å¨åå­ä¸­åcountæ°éï¼ç´æ¥countæ¯å¼ è¡¨çæ°éåç¸å ä¸å°±æ¯äºãä¼åè¯­å¥å¦ä¸ï¼\n\nselect\n    count(cnt)\nfrom\n    (\n        select\n            count() as cnt\n        from\n            a\n        union\n        all\n        select\n            count() as cnt\n        from\n            b\n    )\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå°è¯¥è¯­å¥æ¾å¨æ°æ®åºæ¥è¯¢ï¼ç§çº§è¿åï¼ç´æ¥ä»1åéä¼åå°1ç§é",charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"ä½¿ç¨hueåå»ºozzieçpyspark action workflow",frontmatter:{tags:["hue","python","å¤§æ°æ®"],title:"ä½¿ç¨hueåå»ºozzieçpyspark action workflow",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/aba491/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"ä»ç»å¦ä½ä½¿ç¨hueæ¥åå»ºozzieæ¥åå»ºä¸ä¸ªspark actionçowrkflow",feed:{enable:!0},categories:["ç¼ç¨","å¶ä»"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220907215736.png"},{name:"twitter:title",content:"ä½¿ç¨hueåå»ºozzieçpyspark action workflow"},{name:"twitter:description",content:"ä»ç»å¦ä½ä½¿ç¨hueæ¥åå»ºozzieæ¥åå»ºä¸ä¸ªspark actionçowrkflow"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220907215736.png"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/09.%E5%85%B6%E4%BB%96/02.%E4%BD%BF%E7%94%A8hue%E5%88%9B%E5%BB%BAozzie%E7%9A%84pyspark%20action%20workflow.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ä½¿ç¨hueåå»ºozzieçpyspark action workflow"},{property:"og:description",content:"ä»ç»å¦ä½ä½¿ç¨hueæ¥åå»ºozzieæ¥åå»ºä¸ä¸ªspark actionçowrkflow"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220907215736.png"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/09.%E5%85%B6%E4%BB%96/02.%E4%BD%BF%E7%94%A8hue%E5%88%9B%E5%BB%BAozzie%E7%9A%84pyspark%20action%20workflow.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"hue"},{property:"article:tag",content:"python"},{property:"article:tag",content:"å¤§æ°æ®"},{itemprop:"name",content:"ä½¿ç¨hueåå»ºozzieçpyspark action workflow"},{itemprop:"description",content:"ä»ç»å¦ä½ä½¿ç¨hueæ¥åå»ºozzieæ¥åå»ºä¸ä¸ªspark actionçowrkflow"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/20220907215736.png"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/09.%E5%85%B6%E4%BB%96/02.%E4%BD%BF%E7%94%A8hue%E5%88%9B%E5%BB%BAozzie%E7%9A%84pyspark%20action%20workflow.html",relativePath:"04.ç¼ç¨/09.å¶ä»/02.ä½¿ç¨hueåå»ºozzieçpyspark action workflow.md",key:"v-8c516c3e",path:"/pages/aba491/",headersStr:null,content:'> hueæ¯ä¸ä¸ªApache Hadoop uiç³»ç»ï¼æ¬ç¯æç« ä»ç»å¦ä½ä½¿ç¨hueåå»ºä¸ä¸ªozzieçpyspark actionçworkflow, è¯¥workflowä»åå«ä¸ä¸ªspark actionãæ³¨æï¼æ¬æä½¿ç¨çæ¯pythonè¯­è¨çpysparkã\n\n 1. ç¼åä¸ä¸ªpythonæä½sparkçç¨åºã demo.py\n\nfrom pyspark.sql import SparkSession\n\nspark = SparkSession.builder.enableHiveSupport().appName(\n"demo").getOrCreate()\n\n# spark çä¸äºæä½\n.......\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n 2. æ°å»ºworkflow\n\n\n\n> ä¼ å¥éè¦è¿è¡çpythonèæ¬\n\n\n\n 3. å¯¹è¯¥action è¿è¡ä¸äºå±æ§çéç½®ã\n\n> å¯¹sparkè¿è¡è®¾ç½®ï¼å¯ä»¥éæ©sparkçè¿è¡æ¨¡å¼ã é»è®¤ä½¿ç¨çæ¯spark1 çåºå»æ§è¡ï¼å¦æä½¿ç¨çæ¯spark2ï¼åéè¦è®¾ç½®å±æ§oozie.action.sharelib.for.spark=spark2 å¦å¾æç¤ºã\n\n\n\n> è¿å¥2è®¾ç½®ï¼è¿è¡ä¸äºåéçè®¾ç½® oozie.libpath éè¦ä½¿ç¨å°sparkçä¸äºjaråï¼å¡«å¥è·¯å¾jaråè·¯å¾ã\n\n\n\n 4. è¯¥workflowå·²ç»è®¾ç½®æåï¼å¯ä»¥å¯¹å¶è¿è¡è¿è¡è¿è¡æµè¯ã',normalizedContent:'> hueæ¯ä¸ä¸ªapache hadoop uiç³»ç»ï¼æ¬ç¯æç« ä»ç»å¦ä½ä½¿ç¨hueåå»ºä¸ä¸ªozzieçpyspark actionçworkflow, è¯¥workflowä»åå«ä¸ä¸ªspark actionãæ³¨æï¼æ¬æä½¿ç¨çæ¯pythonè¯­è¨çpysparkã\n\n 1. ç¼åä¸ä¸ªpythonæä½sparkçç¨åºã demo.py\n\nfrom pyspark.sql import sparksession\n\nspark = sparksession.builder.enablehivesupport().appname(\n"demo").getorcreate()\n\n# spark çä¸äºæä½\n.......\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n 2. æ°å»ºworkflow\n\n\n\n> ä¼ å¥éè¦è¿è¡çpythonèæ¬\n\n\n\n 3. å¯¹è¯¥action è¿è¡ä¸äºå±æ§çéç½®ã\n\n> å¯¹sparkè¿è¡è®¾ç½®ï¼å¯ä»¥éæ©sparkçè¿è¡æ¨¡å¼ã é»è®¤ä½¿ç¨çæ¯spark1 çåºå»æ§è¡ï¼å¦æä½¿ç¨çæ¯spark2ï¼åéè¦è®¾ç½®å±æ§oozie.action.sharelib.for.spark=spark2 å¦å¾æç¤ºã\n\n\n\n> è¿å¥2è®¾ç½®ï¼è¿è¡ä¸äºåéçè®¾ç½® oozie.libpath éè¦ä½¿ç¨å°sparkçä¸äºjaråï¼å¡«å¥è·¯å¾jaråè·¯å¾ã\n\n\n\n 4. è¯¥workflowå·²ç»è®¾ç½®æåï¼å¯ä»¥å¯¹å¶è¿è¡è¿è¡è¿è¡æµè¯ã',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"å³äº",frontmatter:{title:"å³äº",date:"2019-12-25T14:27:01.000Z",permalink:"/about/",sidebar:!1,article:!1,author:{name:"lizhengyuan",link:"https://github.com/msqfx"},description:"å·¥ä½å¹´é: 5å¹´\nèä¸: è½¯ä»¶å¼åå·¥ç¨å¸\nç®å: å¨æåæ¬ç ä¸­~",comment:!0,meta:[{name:"twitter:title",content:"å³äº"},{name:"twitter:description",content:"å·¥ä½å¹´é: 5å¹´\nèä¸: è½¯ä»¶å¼åå·¥ç¨å¸\nç®å: å¨æåæ¬ç ä¸­~"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/08.%E5%85%B3%E4%BA%8E/01.%E5%85%B3%E4%BA%8E.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å³äº"},{property:"og:description",content:"å·¥ä½å¹´é: 5å¹´\nèä¸: è½¯ä»¶å¼åå·¥ç¨å¸\nç®å: å¨æåæ¬ç ä¸­~"},{property:"og:url",content:"https://www.msqfx.cc/08.%E5%85%B3%E4%BA%8E/01.%E5%85%B3%E4%BA%8E.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2019-12-25T14:27:01.000Z"},{itemprop:"name",content:"å³äº"},{itemprop:"description",content:"å·¥ä½å¹´é: 5å¹´\nèä¸: è½¯ä»¶å¼åå·¥ç¨å¸\nç®å: å¨æåæ¬ç ä¸­~"}],readingShow:"top"},regularPath:"/08.%E5%85%B3%E4%BA%8E/01.%E5%85%B3%E4%BA%8E.html",relativePath:"08.å³äº/01.å³äº.md",key:"v-54f1c73c",path:"/about/",headers:[{level:2,title:"å³äºåä¸»",slug:"å³äºåä¸»",normalizedTitle:"å³äºåä¸»",charIndex:2},{level:3,title:"æè½æ¸å",slug:"æè½æ¸å",normalizedTitle:"æè½æ¸å",charIndex:54},{level:3,title:"âï¸ èç³»",slug:"èç³»",normalizedTitle:"âï¸ èç³»",charIndex:182},{level:2,title:"å³äºæ¬ç«",slug:"å³äºæ¬ç«",normalizedTitle:"å³äºæ¬ç«",charIndex:320},{level:3,title:"åå®¢åç¨",slug:"åå®¢åç¨",normalizedTitle:"åå®¢åç¨",charIndex:349}],headersStr:"å³äºåä¸» æè½æ¸å âï¸ èç³» å³äºæ¬ç« åå®¢åç¨",content:"# å³äºåä¸»\n\n * å·¥ä½å¹´é: 5å¹´\n * èä¸: è½¯ä»¶å¼åå·¥ç¨å¸\n * ç®å: å¨æåæ¬ç ä¸­~\n\n\n# æè½æ¸å\n\n * ç¼ç¨è¯­è¨: java/go\n * webæ¡æ¶: spring/springboot/springcloud/mybatis/gin\n * æ°æ®åº: mysql/redis/mongo/es\n * å®¹å¨ææ¯: docker/k8s\n\n\n# âï¸ èç³»\n\n * WeChat or QQ: {{ QQ }}\n * Email: lizy928@163.com\n * GitHub: https://github.com/msqfx\n * CSDN: https://blog.csdn.net/lizy928\n\n\n# å³äºæ¬ç«\n\nç¨æ¥è®°å½æ¬äººå­¦ä¹ ãæèåçæ´»ççåå®¢\n\n\n# åå®¢åç¨\n\n * 2023-01-15\n\n> æ·»å äºwalineçè¯è®ºç³»ç»ï¼æ¹ä¾¿è®¨è®ºäº¤æµé®é¢ã\n\n * 2022-08-07\n\n> å³å®éç¨vuepressä½ä¸ºä¸ªäººåå®¢çææ¯æ¡æ¶ï¼å¹¶å¼å§å­¦ä¹ æ­å»ºã",normalizedContent:"# å³äºåä¸»\n\n * å·¥ä½å¹´é: 5å¹´\n * èä¸: è½¯ä»¶å¼åå·¥ç¨å¸\n * ç®å: å¨æåæ¬ç ä¸­~\n\n\n# æè½æ¸å\n\n * ç¼ç¨è¯­è¨: java/go\n * webæ¡æ¶: spring/springboot/springcloud/mybatis/gin\n * æ°æ®åº: mysql/redis/mongo/es\n * å®¹å¨ææ¯: docker/k8s\n\n\n# âï¸ èç³»\n\n * wechat or qq: {{ qq }}\n * email: lizy928@163.com\n * github: https://github.com/msqfx\n * csdn: https://blog.csdn.net/lizy928\n\n\n# å³äºæ¬ç«\n\nç¨æ¥è®°å½æ¬äººå­¦ä¹ ãæèåçæ´»ççåå®¢\n\n\n# åå®¢åç¨\n\n * 2023-01-15\n\n> æ·»å äºwalineçè¯è®ºç³»ç»ï¼æ¹ä¾¿è®¨è®ºäº¤æµé®é¢ã\n\n * 2022-08-07\n\n> å³å®éç¨vuepressä½ä¸ºä¸ªäººåå®¢çææ¯æ¡æ¶ï¼å¹¶å¼å§å­¦ä¹ æ­å»ºã",charsets:{cjk:!0},lastUpdated:"2023/12/16, 15:47:37",lastUpdatedTimestamp:1702712857e3},{title:"è¯»ä¹¦ç¬è®°:å¦ä½éè¯»ä¸æ¬ä¹¦",frontmatter:{title:"è¯»ä¹¦ç¬è®°:å¦ä½éè¯»ä¸æ¬ä¹¦",date:"2022-10-21T20:52:34.000Z",permalink:"/pages/8bdb8d/",categories:["è¯»ä¹¦ç ´ä¸å·"],tags:["è¯»ä¹¦"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬ææ¯æéè¯»å®ãå¦ä½éè¯»ä¸æ¬ä¹¦ãçè¯»åæï¼ä½èä¸»è¦æ¯å°éè¯»åä¸ºäºåä¸ªå±æ¬¡ï¼åºç¡éè¯»ãæ£è§éè¯»ãåæéè¯»åä¸»é¢éè¯»ï¼å¹¶è®²è§£è¿å ä¸ªå±æ¬¡è¯¥å¦ä½å»åï¼è½å¤æ´å¥½çå¸®å©æä»¬éè¯»ï¼è®©æä»¬ä»ä¸­æ¶è·å°æ´å¤",feed:{enable:!0},comment:!0,meta:[{name:"twitter:title",content:"è¯»ä¹¦ç¬è®°:å¦ä½éè¯»ä¸æ¬ä¹¦"},{name:"twitter:description",content:"æ¬ææ¯æéè¯»å®ãå¦ä½éè¯»ä¸æ¬ä¹¦ãçè¯»åæï¼ä½èä¸»è¦æ¯å°éè¯»åä¸ºäºåä¸ªå±æ¬¡ï¼åºç¡éè¯»ãæ£è§éè¯»ãåæéè¯»åä¸»é¢éè¯»ï¼å¹¶è®²è§£è¿å ä¸ªå±æ¬¡è¯¥å¦ä½å»åï¼è½å¤æ´å¥½çå¸®å©æä»¬éè¯»ï¼è®©æä»¬ä»ä¸­æ¶è·å°æ´å¤"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/05.%E8%AF%BB%E4%B9%A6%E7%A0%B4%E4%B8%87%E5%8D%B7/01.%E5%A6%82%E4%BD%95%E9%98%85%E8%AF%BB%E4%B8%80%E6%9C%AC%E4%B9%A6.html"},{property:"og:type",content:"article"},{property:"og:title",content:"è¯»ä¹¦ç¬è®°:å¦ä½éè¯»ä¸æ¬ä¹¦"},{property:"og:description",content:"æ¬ææ¯æéè¯»å®ãå¦ä½éè¯»ä¸æ¬ä¹¦ãçè¯»åæï¼ä½èä¸»è¦æ¯å°éè¯»åä¸ºäºåä¸ªå±æ¬¡ï¼åºç¡éè¯»ãæ£è§éè¯»ãåæéè¯»åä¸»é¢éè¯»ï¼å¹¶è®²è§£è¿å ä¸ªå±æ¬¡è¯¥å¦ä½å»åï¼è½å¤æ´å¥½çå¸®å©æä»¬éè¯»ï¼è®©æä»¬ä»ä¸­æ¶è·å°æ´å¤"},{property:"og:url",content:"https://www.msqfx.cc/05.%E8%AF%BB%E4%B9%A6%E7%A0%B4%E4%B8%87%E5%8D%B7/01.%E5%A6%82%E4%BD%95%E9%98%85%E8%AF%BB%E4%B8%80%E6%9C%AC%E4%B9%A6.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-10-21T20:52:34.000Z"},{property:"article:tag",content:"è¯»ä¹¦"},{itemprop:"name",content:"è¯»ä¹¦ç¬è®°:å¦ä½éè¯»ä¸æ¬ä¹¦"},{itemprop:"description",content:"æ¬ææ¯æéè¯»å®ãå¦ä½éè¯»ä¸æ¬ä¹¦ãçè¯»åæï¼ä½èä¸»è¦æ¯å°éè¯»åä¸ºäºåä¸ªå±æ¬¡ï¼åºç¡éè¯»ãæ£è§éè¯»ãåæéè¯»åä¸»é¢éè¯»ï¼å¹¶è®²è§£è¿å ä¸ªå±æ¬¡è¯¥å¦ä½å»åï¼è½å¤æ´å¥½çå¸®å©æä»¬éè¯»ï¼è®©æä»¬ä»ä¸­æ¶è·å°æ´å¤"}],readingShow:"top"},regularPath:"/05.%E8%AF%BB%E4%B9%A6%E7%A0%B4%E4%B8%87%E5%8D%B7/01.%E5%A6%82%E4%BD%95%E9%98%85%E8%AF%BB%E4%B8%80%E6%9C%AC%E4%B9%A6.html",relativePath:"05.è¯»ä¹¦ç ´ä¸å·/01.å¦ä½éè¯»ä¸æ¬ä¹¦.md",key:"v-567cb3a8",path:"/pages/8bdb8d/",headers:[{level:2,title:"åè¨",slug:"åè¨",normalizedTitle:"åè¨",charIndex:2},{level:2,title:"ä¸»å¨éè¯»",slug:"ä¸»å¨éè¯»",normalizedTitle:"ä¸»å¨éè¯»",charIndex:104},{level:2,title:"éè¯»çç®æ  ï¼ä¸ºè·å¾èµè®¯èè¯»ï¼ä»¥åä¸ºæ±å¾çè§£èè¯»",slug:"éè¯»çç®æ -ä¸ºè·å¾èµè®¯èè¯»-ä»¥åä¸ºæ±å¾çè§£èè¯»",normalizedTitle:"éè¯»çç®æ  ï¼ä¸ºè·å¾èµè®¯èè¯»ï¼ä»¥åä¸ºæ±å¾çè§£èè¯»",charIndex:603},{level:2,title:"çæ­£çéè¯»",slug:"çæ­£çéè¯»",normalizedTitle:"çæ­£çéè¯»",charIndex:705},{level:2,title:"æå¯¼åçå­¦ä¹ ï¼ä»¥åèªæåç°åçå­¦ä¹ ",slug:"æå¯¼åçå­¦ä¹ -ä»¥åèªæåç°åçå­¦ä¹ ",normalizedTitle:"æå¯¼åçå­¦ä¹ ï¼ä»¥åèªæåç°åçå­¦ä¹ ",charIndex:750},{level:2,title:"éè¯»æ¯è·çå·²ä¸ºç¼ºå¸­çæ¥å¿å¨å­¦ä¹ ",slug:"éè¯»æ¯è·çå·²ä¸ºç¼ºå¸­çæ¥å¿å¨å­¦ä¹ ",normalizedTitle:"éè¯»æ¯è·çå·²ä¸ºç¼ºå¸­çæ¥å¿å¨å­¦ä¹ ",charIndex:883},{level:2,title:"åä¸ªå±æ¬¡",slug:"åä¸ªå±æ¬¡",normalizedTitle:"åä¸ªå±æ¬¡",charIndex:38},{level:2,title:"ç¥è¯»",slug:"ç¥è¯»",normalizedTitle:"ç¥è¯»",charIndex:1149},{level:2,title:"éè¯»éåº¦",slug:"éè¯»éåº¦",normalizedTitle:"éè¯»éåº¦",charIndex:1404},{level:2,title:"å¹å»éè¯»çä¹ æ¯",slug:"å¹å»éè¯»çä¹ æ¯",normalizedTitle:"å¹å»éè¯»çä¹ æ¯",charIndex:1551},{level:2,title:"åæéè¯»çè§å",slug:"åæéè¯»çè§å",normalizedTitle:"åæéè¯»çè§å",charIndex:1977},{level:2,title:"è¾å©éè¯»",slug:"è¾å©éè¯»",normalizedTitle:"è¾å©éè¯»",charIndex:3312},{level:2,title:"éè¯»å¥½ä¹¦çéè¦æ§",slug:"éè¯»å¥½ä¹¦çéè¦æ§",normalizedTitle:"éè¯»å¥½ä¹¦çéè¦æ§",charIndex:3689}],headersStr:"åè¨ ä¸»å¨éè¯» éè¯»çç®æ  ï¼ä¸ºè·å¾èµè®¯èè¯»ï¼ä»¥åä¸ºæ±å¾çè§£èè¯» çæ­£çéè¯» æå¯¼åçå­¦ä¹ ï¼ä»¥åèªæåç°åçå­¦ä¹  éè¯»æ¯è·çå·²ä¸ºç¼ºå¸­çæ¥å¿å¨å­¦ä¹  åä¸ªå±æ¬¡ ç¥è¯» éè¯»éåº¦ å¹å»éè¯»çä¹ æ¯ åæéè¯»çè§å è¾å©éè¯» éè¯»å¥½ä¹¦çéè¦æ§",content:'# åè¨\n\næ¬ææ¯æéè¯»å®ãå¦ä½éè¯»ä¸æ¬ä¹¦ãçè¯»åæï¼ä½èä¸»è¦æ¯å°éè¯»åä¸ºäºåä¸ªå±æ¬¡ï¼åºç¡éè¯»ãæ£è§éè¯»ãåæéè¯»åä¸»é¢éè¯»ï¼å¹¶è®²è§£è¿å ä¸ªå±æ¬¡è¯¥å¦ä½å»åï¼è½å¤æ´å¥½çå¸®å©æä»¬éè¯»ï¼è®©æä»¬ä»ä¸­æ¶è·å°æ´å¤\n\n\n# ä¸»å¨éè¯»\n\nä½èæå¡æä»¬éè¦ä¸»å¨è¯»ä¹¦ï¼è¿æ ·æä»¬æè½å¯¹ä¹¦ä¸­ç¥è¯ææ´å¥½çæ¢ç´¢å¹¶æ¶è·å°çä¼æ´å¤ã\n\nåå¨æä»¬éè¯»èµè®¯ä¿¡æ¯çæ¶åï¼ä¸ä»ä»åªéè¦ç¥éäºæä»¶äºçåçï¼è¿éè¦çè§£å®åççèåé»è¾ååçè¿è¡èæ³ï¼å°èªå·±ä»¥åçç¥è¯è¿è¡å³èèµ·æ¥ãè¿å°±æ¯ä¸»å¨çéè¯»ã\n\nå¹¶ä¸æä»¬åä¸»å¨éè¯»æ¶ä¼ä¿æå¤§èçæèå¹¶ä¿ææ¸éçç¶æï¼é£ä¹å¹³æ¶æææ¬²ç¡çäººé½åªæ¯å¨è¢«å¨çæ¥æ¶ç¥è¯ï¼æä»¥æ³¨æåææ æ³éä¸­èµ·æ¥ã\n\né®é¢æ¥äºï¼æä»¬è¯¥å¦ä½åå°ä¸»å¨éè¯»å¢ï¼ç­æ¡æ¯å¸¦çé®é¢å»éè¯»ï¼\n\n * è¿æ¬ä¹¦å¨è®²ä»ä¹ï¼\n * ä½èä»ç»è¯´äºä»ä¹ï¼å¦ä½è¯´çï¼æ¾åºå¯¹åºçæ³æ³ãå£°æåè®ºç¹\n * è¿æ¬ä¹¦æéçåï¼æ¯å¨é¨æéçï¼è¿æ¯é¨åæéçï¼\n * è¿æ¬ä¹¦è·èªå·±æä»ä¹å³ç³»ï¼èªå·±å¯ä»¥å­¦å°ä»ä¹ï¼å¯¹èªå·±æä»ä¹å¯ç¤ºï¼\n\nå¨éè¯»çè¿ç¨ä¸­æåºé¤äºä¸é¢å ä¸ªåºç¡çé®é¢ä¹å¤ï¼è¿éè¦èªå·±å»æåºé®é¢ï¼å¹¶ä¸æ­çå»ä»ä¹¦å¯»æ¾å¹¶åç­é®é¢ãåªæè¿æ ·ç»è¿æèæè½åå°ä¸»å¨éè¯»ã\n\nä½èè¿æå°äºåç¬è®°çå¿è¦æ§ï¼è¿ä¹æ¯ä¸»å¨éè¯»çä¸ä¸ªæ¹å¼ï¼\n\n * è½è®©èªå·±çä¿ææ¸é\n * æ¯ä¸ä¸ªä¸»å¨æèçè¿ç¨å¹¶ç¨è¨è¯­ç»è¡¨è¾¾åºæ¥ã\n * å°èªå·±çææ³ååºæ¥ï¼è®©èªå·±æ´å¥½ççè§£ä½èçææ³ï¼å¹¶å±å¼èªå·±çèæ³ã\n\n\n# éè¯»çç®æ  ï¼ä¸ºè·å¾èµè®¯èè¯»ï¼ä»¥åä¸ºæ±å¾çè§£èè¯»\n\næä»¬æ¯ä¸ºäºè·åå°ä½èè¾åºçç¥è¯èè¯»ä¹¦ï¼èä¸æ¯ä¸ºäºè¯»ä¹¦èè¯»ä¹¦ï¼å¦æè¯»å®è¿æ¬ä¹¦ï¼æ²¡æçè§£å°ä½èæ³è¦è¡¨è¾¾çä¸è¥¿ï¼èªèº«æ²¡ææ¹åï¼é£ä¹åçº¯ç²¹çæµªè´¹æ¶é´ã\n\n\n# çæ­£çéè¯»\n\nä¸åå©å¤åï¼éè¿èªå·±ä¸æ­çæèå»éè¯»ï¼ä»æ¨¡ç³ççè§£å°æ´æ¸æ¥ççè§£ã\n\n\n# æå¯¼åçå­¦ä¹ ï¼ä»¥åèªæåç°åçå­¦ä¹ \n\næ è®ºæ¯æå¯¼åå­¦ä¹ è¿æ¯èªæåç°åå­¦ä¹ é½å¯ä»¥æ¯ä¸»å¨çï¼ä¸è®ºæ¯åªä¸ç§ æ¹å¼ï¼åªæçæ­£å­¦ä¹ å°çäººææ¯ä¸»å¨çå­¦ä¹ èã\n\nå¨æå¯¼åçå­¦ä¹ è¿ç¨ä¸­ï¼è½ç¶æä»¬æ¯è¢«å¨çæ¥æ¶ç¥è¯ï¼çèµ·æ¥æ¯«ä¸è´¹åï¼ä½æ¯ä¸æ ·è¿æ¯éè¦ç»è¿èªå·±çæèæè½ææè·å¾ã\n\n\n# éè¯»æ¯è·çå·²ä¸ºç¼ºå¸­çæ¥å¿å¨å­¦ä¹ \n\næèå¸æ¶ï¼å¯ä»¥åç­ä½ çé®é¢ï¼èçèªå·±æèçæ¶é´ï¼èéè¯»ä¹¦æ¬æ¶ï¼å¿é¡»ç»è¿èªå·±çæèä¸åææå¯è½æç­æ¡ã\n\n\n# åä¸ªå±æ¬¡\n\nä½èå°éè¯»åä¸ºåä¸ªå±æ¬¡ï¼\n\n * åºç¡éè¯»ï¼å°±æ¯æåºç¡çéè¯»ï¼è½è®¤å­å°±è¡ï¼ç»åäºä¹å¹´ä¹å¡æè²åºæ¬å°±è½åå°ã\n * æ£è§éè¯»ï¼å°±æ¯å¨ä¸å®çæ¶é´ä¹åï¼æä½ä¸æ¬ä¹¦çéç¹ã\n * åæéè¯»ï¼æ¯å¨ççéè¯»ãå®æ´çéè¯»ã\n * ä¸»é¢éè¯»ï¼éè¯»èéè¿è¯»å¾å¤çä¹¦ï¼ç¶ååä¸¾è¿äºä¹¦ä¹é´çç¸å³ä¹å¤ãè¿ç§æ¹å¼æ¯æä¸»å¨ãä¹æ¯æè±åæ°çéè¯»ã\n\nä½èæ´æ¬ä¹¦ä¸»è¦æ¯å´ç»è¿åä¸ªå±æ¬¡è¿è¡è®²è§£åæçã\n\n\n# ç¥è¯»\n\n> ä½ èä¸­çç®æ æ¯è¦åç°è¿æ¬ä¹¦å¼ä¸å¼å¾å¤è±æ¶é´ä»ç»éè¯»ãå¶æ¬¡ï¼å°±ç®ä½ å³å®äºä¸åå¤è±æ¶é´ä»ç»éè¯»è¿æ¬ä¹¦ï¼ç¥è¯»ä¹è½åè¯ä½ è®¸å¤è·è¿æ¬ä¹¦æå³çäºã\n\nè¿æ¯ç¥è¯»çç®æ ï¼æä»¬éè¿ç¥è¯»å¯ä»¥èçæ¶é´ï¼æé¤ä¸äºåå¾ä¹¦ã\n\né£ä¹æä»¬æ¹å¦ä½è¿è¡ç¥è¯»å¢ï¼æä»¥ä¸å ä¸ªæ¹æ³ï¼\n\n * åçä¹¦åé¡µï¼ç¶åå¦ææåºå°±åçåºã\n * ç ç©¶ç®å½é¡µã\n * å¦æä¹¦ä¸­éæç´¢å¼ï¼ä¹è¦æ£éä¸ä¸ã\n * å¦æé£æ¯æ¬åçä¹¦è¡£çæ°ä¹¦ï¼ä¸å¦¨è¯»ä¸ä¸åºçèçä»ç»ã\n * ä»ç®å½é¡µä¸­æéå ä¸ªè·ä¸»é¢ç¸å³çç¯ç« æ¥çã\n * å°å¨æ°ç¿»ä¸éï¼éæçä¸ªå æ®µã\n\n\n# éè¯»éåº¦\n\næä»¬å¨æ£è§éè¯»æ¶ï¼æ¯éè¦å¿«éå°éè¯»çï¼å¨ä¸å¼å¾æä»¬è±æ¶é´çå°æ¹è¯»å¿«ä¸ç¹ï¼è¿ä¸ªæ¶åæä»¬æ¶åéè¦ç¥éæä»¬å¨éè¯»ä¸­å¯»æ¾ä»ä¹ï¼è¿æ ·æä»¬æè½å¯¹ä¸åçåå®¹ä½¿ç¨ä¸åçéåº¦æ¥è¿è¡éè¯»ã\n\nå¦ä½æåéè¯»éåº¦ï¼å°æææåæå­å¾åç§»å¨ä¸å»ï¼ç¼çè·çææçä¸å»ï¼å¼ºè¿«èªå·±çç¼çè·çæé¨çå¨ä½ç§»å¨ã\n\n\n# å¹å»éè¯»çä¹ æ¯\n\n> æä»¬è°å°ä¸ä¸ªæææ¯çäººæ¶ï¼å¹¶ä¸æ¯å¨è¯´ä»ç¥éè¯¥å¦ä½å»åé£ä»¶äºï¼èæ¯ä»å·²ç»å»æå»åé£ä»¶äºçä¹ æ¯äºã\n\nå½æä»¬å»æä¹ æ¯åï¼æå°±è½å¤èªç¶çæç§è§åå»åé£ä»¶äºæï¼æææ¯çäººä¹æ¯éè¿ä¸æ­çè®­ç»å°è§åå»æäºä¹ æ¯ã\n\næä»¬å°éè¯»å¹å»æä¹ æ¯åï¼å¯ä»¥æé«éè¯»çè½åä¸éåº¦ï¼æåä¼åèµ°è·¯ä¸åé¥­ä¸æ ·çèªç¶ã\n\n> ä½ ä¸å®è¦å­¦ä¼å¿æé£äºåå¼çæ­¥éª¤ï¼æè½è¡¨ç°åºæ´ä½çå¨ä½ï¼èæ¯ä¸ä¸ªåä¸çæ­¥éª¤é½è¿è¦ç¡®å®è¡¨ç°å¾å¾å¥½ãä½æ¯ï¼ä¸ºäºè¦å¿æè¿äºåä¸çå¨ä½ï¼ä¸å¼å§ä½ å¿é¡»ååå«å­¦ä¼æ¯ä¸ä¸ªåä¸çå¨ä½ãåªæè¿æ ·ï¼ä½ æè½å°ææçå¨ä½è¿ç»èµ·æ¥ï¼åæä¸ä¸ªä¼ç§çæ»éªé«æã\n\néè¯»æ¯éè¦å¤ä¸ªæ­¥éª¤ç»åèµ·æ¥çï¼æä»¬éè¦ä¸æ­çç»ä¹ é»ç¼åä¸ªæ­¥éª¤ï¼å°è¿äºæ­¥éª¤åæä¹ æ¯åéæ¸å¿è®°ï¼ç¶åèªç¶çå°ææçè¿æ¥èµ·æ¥ï¼æç»æä¸ºä¸ä¸ªéè¯»é«æãè¿è®©ææ³å°äºåå¤©å± é¾è®°ä¸­çå¼ ä¸ä¸°æå¼ æ å¿å¤ªææ¶çåºæ¯ï¼åæ¯æå¼ æ å¿æ¯ä¸ä¸ªå¨ä½ï¼çç»ä¹åéæ¸å¿è®°ï¼æç»å°å¤ªæèä¼è´¯éï¼å½æ¶ä¸å¤ªæï¼ç°å¨åç°è¿éæå¼æ²åå·¥ä¹å¦ã\n\n\n# åæéè¯»çè§å\n\n> ä¾ç§ä¹¦æ¬çç§ç±»ä¸ä¸»é¢ä½åç±»ã\n\nä¸åç§ç±»çä¹¦ç±çç®çæ¯ä¸åçï¼æ¯å¦çè®ºæ§çä½åæ¯æä½ è¿æ¯ä»ä¹ï¼èå®ç¨æ§çä½ç¨å¨æä½ å¦ä½å»åä½ æ³åçäºæã\n\nå°ä¹¦ç±çåç±»å¹¶ä¸ç®åï¼æä»¬å¯ä»¥éè¿ä¹¦åãåè¨åä¹¦ä¸­ä¸»é¢åå®¹æ¥åºåã\n\nä¸åç§ç±»çä¹¦ç±ä¹éè¦ä½¿ç¨çæ¯ä¸åçæ¹æ³éè¯»ã\n\n> ç¨æç®ç­çå¥å­è¯´åºæ´æ¬ä¹¦å¨è°äºä»ä¹ã\n\nå¦ææä»¬ç¥éäºè¿æ¬ä¹¦å¨è°ä»ä¹ï¼æä»¬å°±è½æ£æµåºä½èæ³è¦å¹²ä»ä¹ï¼å¹¶è½åç°è¿æ¬ä¹¦çä¸»é¢åéç¹ã\n\néè¿ç»èªå·±æä»äººè®²è¿°è¿æ¬ä¹¦è¯´çä»ä¹ï¼å¯ä»¥éªè¯èªå·±æ¯å¦å¯¹æ¬ä¹¦æ´ä½åå®¹æä¸ä¸ªè¯¦ç»çäºè§£ã\n\n> æç§é¡ºåºä¸å³ç³»ï¼ååºå¨ä¹¦çéè¦é¨åãå°å¨ä¹¦ççº²è¦æåºæ¥ä¹åï¼åå°åä¸ªé¨åççº²è¦ä¹ä¸ä¸ååºã\n\nå¿ä¸­è¦å¯¹ä¹¦ä¸­çæ´ä½æ¶ææä¸ä¸ªäºè§£ï¼æè½ä»å¤ä¸ªæ¹é¢å»çå¾è¿æ¬ä¹¦ã\n\n> æ¾åºä½èå¨é®çé®é¢ï¼æä½èæ³è¦è§£å³çé®é¢ã\n\nä½èåä¹¦æ¶ï¼è¯å®æ¯å¸¦çé®é¢æèæ³è¦è§£å³ä¸ä¸ªé®é¢å»åçãæ¾åºè¿äºé®é¢è½å¤æ´å¥½çä¸ºä¸é¢ä¸¤æ¡æå¡ã\n\n> è¯ éä½èä½¿ç¨çå³é®å­ï¼ä¸ä½èè¾¾æå±è¯ã\n\nç¸åçåå­ä¼åç°åºä¸åçæä¹ï¼æ¯å¦æä»¬å¨è°"éè¯»"æ¶ï¼å¯è½æ¯ä¸ºå¨±ä¹èéè¯»ï¼å¯è½æ¯ä¸ºè·å¾å¨è¯¢èéè¯»ï¼ä¹å¯è½æ¯ä¸ºè¿½æ±çè§£åèéè¯»ãæä»¬éè¦åä½èä¿æä¸è´çè§£ï¼æè½æå±åçææ³ãå¦ææä»¬å¯¹å­å¥æ¯«ä¸ç¨å¿ï¼èªç¶æ æ³è·ä½èè¾¾æå±è¯ï¼ä¹å°±ä¸æ æè·ã\n\næä»¬å¯ä»¥éè¿ä¸ä¸æä¸­å·²ç»çè§£çè¯­å¥å¨å¸®å©èªå·±æ¥æ¨æ²åºæä»¬ä¸çè§£çé£ä¸ªå­çææã\n\n> ä»æéè¦çå¥å­ä¸­æåºä½èçéè¦ä¸»æ¨ã\n\næ¾åºè¯­å¥çä¸»æ¨åï¼éè¦ä½¿ç¨èªå·±çè¯è¯­æ¥è¯´æ¥éªè¯èªå·±å°åºææ²¡æçè§£éå½»ãä¹å¯ä»¥éè¿å°æä¸ªä¾å­æèäºææ¥è¯´æä¸»æ¨æ¥éªè¯ã\n\n> æ¾åºä½èçè®ºè¿°ï¼éæ°æ¶æè¿äºè®ºè¿°çåå åæï¼ä»¥æç½ä½èçä¸»å¼ ã\n\n> ç¡®å®ä½èå·²ç»è§£å³äºåªäºé®é¢ï¼è¿æåªäºæ¯æªè§£å³çãå¨æªè§£å³çé®é¢ä¸­ï¼å®åªäºæ¯ä½èè®¤ä¸ºèªå·±æ æ³è§£å³çé®é¢ã\n\n> å¨ä½ è¯´åºâæåæâï¼âæä¸åæâï¼æâææç¼è¯è®ºâä¹åï¼ä½ ä¸å®è¦è½è¯å®å°è¯´ï¼âæäºè§£äºãâ\n\nå¨æä»¬è¯è®ºä¹åï¼ä¸å®æ¯å¨èªå·±å·²ç»çè§£çåºç¡ä¹ä¸ï¼è¿æ¯å¯¹å¯¹æ¹çåºæ¬ç¤¼è²ãå¨æä»¬ä¸æ¸æ¥çæ¶åä¾¿åæå¯¹æ¹ï¼æ¯æè ¢çï¼å¦æä¸æ¸æ¥è¿ä¸åæå¯¹æ¹çï¼åæ¯æ ç¤¼çãåªæå®å¨çè§£äºï¼ææè¯å¤´è®ºè¶³çèµæ ¼ã\n\n> å½ä½ ä¸åæä½èçè§ç¹æ¶ï¼è¦çæ§å°è¡¨è¾¾èªå·±çæè§ï¼ä¸è¦æ çå°è¾©é©³æäºè®ºã\n\næä»¬éè¦æè°è¯å½åå­¦ä¹ ï¼è¿æ¯ä¸ä¸ªäºç¸å­¦ä¹ åå¤´èé£æ´çè¿ç¨ï¼ä»ä¸­è·åå°ç¥è¯ï¼è¿ææ¯ç®çï¼èä¸æ¯æ æä¹çäºåµã\n\n> å°éç¥è¯ä¸ä¸ªäººè§ç¹çä¸åï¼å¨ä½ä»»ä½è¯æ­ä¹åï¼é½è¦æ¾åºçè®ºåºç¡\n\nä½èæåºæ»¡è¶³åä½èè¾©è®ºèµæ ¼çä¸ä¸ªè§åï¼\n\n * è¯»èä¸å®è¦å®æ´çäºè§£è¿æ¬ä¹¦\n * è¯»èä¸è¦äºå¼ºå¥½èæç²ç®åé©³\n * å°ç¥è¯ä¸çä¸åæè§çåæ¯å¤§ä½ä¸å¯ä»¥è§£å³çé®é¢\n\næä»¬å¨éè¯»ä¸æ¬ä¹¦æ¶å¦ææä¸åçæè§ï¼å¯ä»¥æçºªå¾çè¿è¡è¾©è®ºï¼\n\n * å¨äºè¾©çè¿ç¨ä¸­ä¸è¦å¸¦æèªå·±çæç»ªï¼å¦åå°±ä¸æ¯å¨è¯´çäºã\n * å¨äºè¾©æ¶éè¦åå°åææ¡ä»¶æèåè®¾æ¡ä»¶æåºæ¥ï¼è¿ä¸ªæ¯ä½ åé¢ææå¤æ­çåºç¡ï¼ä½ ä¹è¦æ¥åå¯¹æ¹çåè®¾æ¡ä»¶ï¼å³ä½¿ä½ ä»¬ççæ³å®å¨ç¸åï¼ä½æ¯ä¹éè¦æ¥åã\n * å¨äºè¾©æ¶ï¼éè¦ç«å¨å¯¹æ¹çè§åº¦å»æèï¼è¿æ ·æè½æ¯æè§çäº¤æµï¼èä¸æ¯æ æä¹çäºåµã\n\næä»¬å¨åé©³ä½èé®é¢çæ¶åï¼ä¸å®è¦æ¿åºä¾æ®æ¥è¯æèªå·±çè®ºç¹æå¯¹å¯¹æ¹çå°éã\n\n\n# è¾å©éè¯»\n\nå¯¹äºè¾å©éè¯»ï¼å»ºè®®åå°½èªå·±æè½çéè¿åå¨éè¯»å»å°ä¸æ¬ä¹¦ï¼å¦æè¿æä¸æçåéè¦å¯»æ¾å¤å¨çå¸®å©ã\n\nå¯¹äºå¯¼è¯»ï¼å»ºè®®æ¯å¨è¯»å®ä¸æ¬ä¹¦ä¹ååå»éè¯»ï¼è¿æ¯å ä¸ºï¼\n\n * å¯¼è¯»ä¸ä¸å®æ¯å¯¹çï¼å ä¸ºè¿ä¸ªæ¯å«äººè¯»å®ä¹¦ä¹åèªå·±çæè\n * å³ä½¿æ¯å¯¹çï¼ä¹ä¸æ¯ä¸å®æ¯å¨é¢çï¼å¯è½å¯¼è¯»è¿ä¹ä¼æéæ¼\n * çå¯¼è¯»ä¹ä¼éå¶èªå·±ççè§£ï¼å¹¶ä¸è·çå¯¼è¯»èçè§åº¦å»æèï¼ä½æ²¡æèªå·±çæèã\n\nè¿ä¹åçè¯ï¼ä¹æ¯æå¥½å¤çï¼\n\n * å¸®å©æä»¬è¯ éè¯­å¥ï¼å¹¶æ¾åºå±è¯ä¸ä¸»æ¨ã\n * èªæè¯»ä¹¦çä¸ç§è¡¥åï¼å¨éè¯»å®ä¹åäº§ççé®ç­ï¼å¯ä»¥å¸®å©ä½ è§£ç­ä¸çè§£ã\n\nå¯¹äºæè¦çä½ç¨ï¼\n\n * å¨éè¯»ä¸æ¬ä¹¦ä¹åï¼å¯ä»¥å¤éèªå·±çè®°å¿\n * å¨ä¸»é¢éè¯»æ¶ï¼å¯ä»¥éè¿æè¦ç¸å³èèµ·æ¥ã\n\nå¯¹äºå·¥å·ä¹¦çä½¿ç¨ï¼æä»¬éè¦ç¥éèªå·±æ³è¦æ¾ä»ä¹ï¼åªä¸ç§å·¥å·ææä»¬æ³è¦æ¾çåå®¹ï¼å¹¶å¦ä½ä½¿ç¨ä»ä»¬å¿«éæ¥æ¾å°ä½ æ³è¦æ¾çèµæã\n\n\n# éè¯»å¥½ä¹¦çéè¦æ§\n\n> å¦æä½ æè¯»çä¹¦é½å¨ä½ çè½åèå´ä¹åï¼ä½ å°±æ²¡æ³æåèªå·±çéè¯»è½åãä½ å¿é¡»è½æçºµè¶è¶ä½ è½åçä¹¦ï¼æåæä»¬æè¯´çï¼éè¯»è¶è¶ä½ å¤´èçä¹¦ãåªæé£æ ·çä¹¦è½å¸®å©ä½ çææ³å¢é¿ï¼é¤éä½ è½å¢é¿å¿æºï¼å¦åä½ å­¦ä¸å°ä¸è¥¿ã\n\næä»¬éè¦éè¿æ£è§éè¯»æ¥æé¤æé£äºåä¹¦ï¼æè½èçæ¶é´è¯»æ´å¤çå¥½ä¹¦ã',normalizedContent:'# åè¨\n\næ¬ææ¯æéè¯»å®ãå¦ä½éè¯»ä¸æ¬ä¹¦ãçè¯»åæï¼ä½èä¸»è¦æ¯å°éè¯»åä¸ºäºåä¸ªå±æ¬¡ï¼åºç¡éè¯»ãæ£è§éè¯»ãåæéè¯»åä¸»é¢éè¯»ï¼å¹¶è®²è§£è¿å ä¸ªå±æ¬¡è¯¥å¦ä½å»åï¼è½å¤æ´å¥½çå¸®å©æä»¬éè¯»ï¼è®©æä»¬ä»ä¸­æ¶è·å°æ´å¤\n\n\n# ä¸»å¨éè¯»\n\nä½èæå¡æä»¬éè¦ä¸»å¨è¯»ä¹¦ï¼è¿æ ·æä»¬æè½å¯¹ä¹¦ä¸­ç¥è¯ææ´å¥½çæ¢ç´¢å¹¶æ¶è·å°çä¼æ´å¤ã\n\nåå¨æä»¬éè¯»èµè®¯ä¿¡æ¯çæ¶åï¼ä¸ä»ä»åªéè¦ç¥éäºæä»¶äºçåçï¼è¿éè¦çè§£å®åççèåé»è¾ååçè¿è¡èæ³ï¼å°èªå·±ä»¥åçç¥è¯è¿è¡å³èèµ·æ¥ãè¿å°±æ¯ä¸»å¨çéè¯»ã\n\nå¹¶ä¸æä»¬åä¸»å¨éè¯»æ¶ä¼ä¿æå¤§èçæèå¹¶ä¿ææ¸éçç¶æï¼é£ä¹å¹³æ¶æææ¬²ç¡çäººé½åªæ¯å¨è¢«å¨çæ¥æ¶ç¥è¯ï¼æä»¥æ³¨æåææ æ³éä¸­èµ·æ¥ã\n\né®é¢æ¥äºï¼æä»¬è¯¥å¦ä½åå°ä¸»å¨éè¯»å¢ï¼ç­æ¡æ¯å¸¦çé®é¢å»éè¯»ï¼\n\n * è¿æ¬ä¹¦å¨è®²ä»ä¹ï¼\n * ä½èä»ç»è¯´äºä»ä¹ï¼å¦ä½è¯´çï¼æ¾åºå¯¹åºçæ³æ³ãå£°æåè®ºç¹\n * è¿æ¬ä¹¦æéçåï¼æ¯å¨é¨æéçï¼è¿æ¯é¨åæéçï¼\n * è¿æ¬ä¹¦è·èªå·±æä»ä¹å³ç³»ï¼èªå·±å¯ä»¥å­¦å°ä»ä¹ï¼å¯¹èªå·±æä»ä¹å¯ç¤ºï¼\n\nå¨éè¯»çè¿ç¨ä¸­æåºé¤äºä¸é¢å ä¸ªåºç¡çé®é¢ä¹å¤ï¼è¿éè¦èªå·±å»æåºé®é¢ï¼å¹¶ä¸æ­çå»ä»ä¹¦å¯»æ¾å¹¶åç­é®é¢ãåªæè¿æ ·ç»è¿æèæè½åå°ä¸»å¨éè¯»ã\n\nä½èè¿æå°äºåç¬è®°çå¿è¦æ§ï¼è¿ä¹æ¯ä¸»å¨éè¯»çä¸ä¸ªæ¹å¼ï¼\n\n * è½è®©èªå·±çä¿ææ¸é\n * æ¯ä¸ä¸ªä¸»å¨æèçè¿ç¨å¹¶ç¨è¨è¯­ç»è¡¨è¾¾åºæ¥ã\n * å°èªå·±çææ³ååºæ¥ï¼è®©èªå·±æ´å¥½ççè§£ä½èçææ³ï¼å¹¶å±å¼èªå·±çèæ³ã\n\n\n# éè¯»çç®æ  ï¼ä¸ºè·å¾èµè®¯èè¯»ï¼ä»¥åä¸ºæ±å¾çè§£èè¯»\n\næä»¬æ¯ä¸ºäºè·åå°ä½èè¾åºçç¥è¯èè¯»ä¹¦ï¼èä¸æ¯ä¸ºäºè¯»ä¹¦èè¯»ä¹¦ï¼å¦æè¯»å®è¿æ¬ä¹¦ï¼æ²¡æçè§£å°ä½èæ³è¦è¡¨è¾¾çä¸è¥¿ï¼èªèº«æ²¡ææ¹åï¼é£ä¹åçº¯ç²¹çæµªè´¹æ¶é´ã\n\n\n# çæ­£çéè¯»\n\nä¸åå©å¤åï¼éè¿èªå·±ä¸æ­çæèå»éè¯»ï¼ä»æ¨¡ç³ççè§£å°æ´æ¸æ¥ççè§£ã\n\n\n# æå¯¼åçå­¦ä¹ ï¼ä»¥åèªæåç°åçå­¦ä¹ \n\næ è®ºæ¯æå¯¼åå­¦ä¹ è¿æ¯èªæåç°åå­¦ä¹ é½å¯ä»¥æ¯ä¸»å¨çï¼ä¸è®ºæ¯åªä¸ç§ æ¹å¼ï¼åªæçæ­£å­¦ä¹ å°çäººææ¯ä¸»å¨çå­¦ä¹ èã\n\nå¨æå¯¼åçå­¦ä¹ è¿ç¨ä¸­ï¼è½ç¶æä»¬æ¯è¢«å¨çæ¥æ¶ç¥è¯ï¼çèµ·æ¥æ¯«ä¸è´¹åï¼ä½æ¯ä¸æ ·è¿æ¯éè¦ç»è¿èªå·±çæèæè½ææè·å¾ã\n\n\n# éè¯»æ¯è·çå·²ä¸ºç¼ºå¸­çæ¥å¿å¨å­¦ä¹ \n\næèå¸æ¶ï¼å¯ä»¥åç­ä½ çé®é¢ï¼èçèªå·±æèçæ¶é´ï¼èéè¯»ä¹¦æ¬æ¶ï¼å¿é¡»ç»è¿èªå·±çæèä¸åææå¯è½æç­æ¡ã\n\n\n# åä¸ªå±æ¬¡\n\nä½èå°éè¯»åä¸ºåä¸ªå±æ¬¡ï¼\n\n * åºç¡éè¯»ï¼å°±æ¯æåºç¡çéè¯»ï¼è½è®¤å­å°±è¡ï¼ç»åäºä¹å¹´ä¹å¡æè²åºæ¬å°±è½åå°ã\n * æ£è§éè¯»ï¼å°±æ¯å¨ä¸å®çæ¶é´ä¹åï¼æä½ä¸æ¬ä¹¦çéç¹ã\n * åæéè¯»ï¼æ¯å¨ççéè¯»ãå®æ´çéè¯»ã\n * ä¸»é¢éè¯»ï¼éè¯»èéè¿è¯»å¾å¤çä¹¦ï¼ç¶ååä¸¾è¿äºä¹¦ä¹é´çç¸å³ä¹å¤ãè¿ç§æ¹å¼æ¯æä¸»å¨ãä¹æ¯æè±åæ°çéè¯»ã\n\nä½èæ´æ¬ä¹¦ä¸»è¦æ¯å´ç»è¿åä¸ªå±æ¬¡è¿è¡è®²è§£åæçã\n\n\n# ç¥è¯»\n\n> ä½ èä¸­çç®æ æ¯è¦åç°è¿æ¬ä¹¦å¼ä¸å¼å¾å¤è±æ¶é´ä»ç»éè¯»ãå¶æ¬¡ï¼å°±ç®ä½ å³å®äºä¸åå¤è±æ¶é´ä»ç»éè¯»è¿æ¬ä¹¦ï¼ç¥è¯»ä¹è½åè¯ä½ è®¸å¤è·è¿æ¬ä¹¦æå³çäºã\n\nè¿æ¯ç¥è¯»çç®æ ï¼æä»¬éè¿ç¥è¯»å¯ä»¥èçæ¶é´ï¼æé¤ä¸äºåå¾ä¹¦ã\n\né£ä¹æä»¬æ¹å¦ä½è¿è¡ç¥è¯»å¢ï¼æä»¥ä¸å ä¸ªæ¹æ³ï¼\n\n * åçä¹¦åé¡µï¼ç¶åå¦ææåºå°±åçåºã\n * ç ç©¶ç®å½é¡µã\n * å¦æä¹¦ä¸­éæç´¢å¼ï¼ä¹è¦æ£éä¸ä¸ã\n * å¦æé£æ¯æ¬åçä¹¦è¡£çæ°ä¹¦ï¼ä¸å¦¨è¯»ä¸ä¸åºçèçä»ç»ã\n * ä»ç®å½é¡µä¸­æéå ä¸ªè·ä¸»é¢ç¸å³çç¯ç« æ¥çã\n * å°å¨æ°ç¿»ä¸éï¼éæçä¸ªå æ®µã\n\n\n# éè¯»éåº¦\n\næä»¬å¨æ£è§éè¯»æ¶ï¼æ¯éè¦å¿«éå°éè¯»çï¼å¨ä¸å¼å¾æä»¬è±æ¶é´çå°æ¹è¯»å¿«ä¸ç¹ï¼è¿ä¸ªæ¶åæä»¬æ¶åéè¦ç¥éæä»¬å¨éè¯»ä¸­å¯»æ¾ä»ä¹ï¼è¿æ ·æä»¬æè½å¯¹ä¸åçåå®¹ä½¿ç¨ä¸åçéåº¦æ¥è¿è¡éè¯»ã\n\nå¦ä½æåéè¯»éåº¦ï¼å°æææåæå­å¾åç§»å¨ä¸å»ï¼ç¼çè·çææçä¸å»ï¼å¼ºè¿«èªå·±çç¼çè·çæé¨çå¨ä½ç§»å¨ã\n\n\n# å¹å»éè¯»çä¹ æ¯\n\n> æä»¬è°å°ä¸ä¸ªæææ¯çäººæ¶ï¼å¹¶ä¸æ¯å¨è¯´ä»ç¥éè¯¥å¦ä½å»åé£ä»¶äºï¼èæ¯ä»å·²ç»å»æå»åé£ä»¶äºçä¹ æ¯äºã\n\nå½æä»¬å»æä¹ æ¯åï¼æå°±è½å¤èªç¶çæç§è§åå»åé£ä»¶äºæï¼æææ¯çäººä¹æ¯éè¿ä¸æ­çè®­ç»å°è§åå»æäºä¹ æ¯ã\n\næä»¬å°éè¯»å¹å»æä¹ æ¯åï¼å¯ä»¥æé«éè¯»çè½åä¸éåº¦ï¼æåä¼åèµ°è·¯ä¸åé¥­ä¸æ ·çèªç¶ã\n\n> ä½ ä¸å®è¦å­¦ä¼å¿æé£äºåå¼çæ­¥éª¤ï¼æè½è¡¨ç°åºæ´ä½çå¨ä½ï¼èæ¯ä¸ä¸ªåä¸çæ­¥éª¤é½è¿è¦ç¡®å®è¡¨ç°å¾å¾å¥½ãä½æ¯ï¼ä¸ºäºè¦å¿æè¿äºåä¸çå¨ä½ï¼ä¸å¼å§ä½ å¿é¡»ååå«å­¦ä¼æ¯ä¸ä¸ªåä¸çå¨ä½ãåªæè¿æ ·ï¼ä½ æè½å°ææçå¨ä½è¿ç»èµ·æ¥ï¼åæä¸ä¸ªä¼ç§çæ»éªé«æã\n\néè¯»æ¯éè¦å¤ä¸ªæ­¥éª¤ç»åèµ·æ¥çï¼æä»¬éè¦ä¸æ­çç»ä¹ é»ç¼åä¸ªæ­¥éª¤ï¼å°è¿äºæ­¥éª¤åæä¹ æ¯åéæ¸å¿è®°ï¼ç¶åèªç¶çå°ææçè¿æ¥èµ·æ¥ï¼æç»æä¸ºä¸ä¸ªéè¯»é«æãè¿è®©ææ³å°äºåå¤©å± é¾è®°ä¸­çå¼ ä¸ä¸°æå¼ æ å¿å¤ªææ¶çåºæ¯ï¼åæ¯æå¼ æ å¿æ¯ä¸ä¸ªå¨ä½ï¼çç»ä¹åéæ¸å¿è®°ï¼æç»å°å¤ªæèä¼è´¯éï¼å½æ¶ä¸å¤ªæï¼ç°å¨åç°è¿éæå¼æ²åå·¥ä¹å¦ã\n\n\n# åæéè¯»çè§å\n\n> ä¾ç§ä¹¦æ¬çç§ç±»ä¸ä¸»é¢ä½åç±»ã\n\nä¸åç§ç±»çä¹¦ç±çç®çæ¯ä¸åçï¼æ¯å¦çè®ºæ§çä½åæ¯æä½ è¿æ¯ä»ä¹ï¼èå®ç¨æ§çä½ç¨å¨æä½ å¦ä½å»åä½ æ³åçäºæã\n\nå°ä¹¦ç±çåç±»å¹¶ä¸ç®åï¼æä»¬å¯ä»¥éè¿ä¹¦åãåè¨åä¹¦ä¸­ä¸»é¢åå®¹æ¥åºåã\n\nä¸åç§ç±»çä¹¦ç±ä¹éè¦ä½¿ç¨çæ¯ä¸åçæ¹æ³éè¯»ã\n\n> ç¨æç®ç­çå¥å­è¯´åºæ´æ¬ä¹¦å¨è°äºä»ä¹ã\n\nå¦ææä»¬ç¥éäºè¿æ¬ä¹¦å¨è°ä»ä¹ï¼æä»¬å°±è½æ£æµåºä½èæ³è¦å¹²ä»ä¹ï¼å¹¶è½åç°è¿æ¬ä¹¦çä¸»é¢åéç¹ã\n\néè¿ç»èªå·±æä»äººè®²è¿°è¿æ¬ä¹¦è¯´çä»ä¹ï¼å¯ä»¥éªè¯èªå·±æ¯å¦å¯¹æ¬ä¹¦æ´ä½åå®¹æä¸ä¸ªè¯¦ç»çäºè§£ã\n\n> æç§é¡ºåºä¸å³ç³»ï¼ååºå¨ä¹¦çéè¦é¨åãå°å¨ä¹¦ççº²è¦æåºæ¥ä¹åï¼åå°åä¸ªé¨åççº²è¦ä¹ä¸ä¸ååºã\n\nå¿ä¸­è¦å¯¹ä¹¦ä¸­çæ´ä½æ¶ææä¸ä¸ªäºè§£ï¼æè½ä»å¤ä¸ªæ¹é¢å»çå¾è¿æ¬ä¹¦ã\n\n> æ¾åºä½èå¨é®çé®é¢ï¼æä½èæ³è¦è§£å³çé®é¢ã\n\nä½èåä¹¦æ¶ï¼è¯å®æ¯å¸¦çé®é¢æèæ³è¦è§£å³ä¸ä¸ªé®é¢å»åçãæ¾åºè¿äºé®é¢è½å¤æ´å¥½çä¸ºä¸é¢ä¸¤æ¡æå¡ã\n\n> è¯ éä½èä½¿ç¨çå³é®å­ï¼ä¸ä½èè¾¾æå±è¯ã\n\nç¸åçåå­ä¼åç°åºä¸åçæä¹ï¼æ¯å¦æä»¬å¨è°"éè¯»"æ¶ï¼å¯è½æ¯ä¸ºå¨±ä¹èéè¯»ï¼å¯è½æ¯ä¸ºè·å¾å¨è¯¢èéè¯»ï¼ä¹å¯è½æ¯ä¸ºè¿½æ±çè§£åèéè¯»ãæä»¬éè¦åä½èä¿æä¸è´çè§£ï¼æè½æå±åçææ³ãå¦ææä»¬å¯¹å­å¥æ¯«ä¸ç¨å¿ï¼èªç¶æ æ³è·ä½èè¾¾æå±è¯ï¼ä¹å°±ä¸æ æè·ã\n\næä»¬å¯ä»¥éè¿ä¸ä¸æä¸­å·²ç»çè§£çè¯­å¥å¨å¸®å©èªå·±æ¥æ¨æ²åºæä»¬ä¸çè§£çé£ä¸ªå­çææã\n\n> ä»æéè¦çå¥å­ä¸­æåºä½èçéè¦ä¸»æ¨ã\n\næ¾åºè¯­å¥çä¸»æ¨åï¼éè¦ä½¿ç¨èªå·±çè¯è¯­æ¥è¯´æ¥éªè¯èªå·±å°åºææ²¡æçè§£éå½»ãä¹å¯ä»¥éè¿å°æä¸ªä¾å­æèäºææ¥è¯´æä¸»æ¨æ¥éªè¯ã\n\n> æ¾åºä½èçè®ºè¿°ï¼éæ°æ¶æè¿äºè®ºè¿°çåå åæï¼ä»¥æç½ä½èçä¸»å¼ ã\n\n> ç¡®å®ä½èå·²ç»è§£å³äºåªäºé®é¢ï¼è¿æåªäºæ¯æªè§£å³çãå¨æªè§£å³çé®é¢ä¸­ï¼å®åªäºæ¯ä½èè®¤ä¸ºèªå·±æ æ³è§£å³çé®é¢ã\n\n> å¨ä½ è¯´åºâæåæâï¼âæä¸åæâï¼æâææç¼è¯è®ºâä¹åï¼ä½ ä¸å®è¦è½è¯å®å°è¯´ï¼âæäºè§£äºãâ\n\nå¨æä»¬è¯è®ºä¹åï¼ä¸å®æ¯å¨èªå·±å·²ç»çè§£çåºç¡ä¹ä¸ï¼è¿æ¯å¯¹å¯¹æ¹çåºæ¬ç¤¼è²ãå¨æä»¬ä¸æ¸æ¥çæ¶åä¾¿åæå¯¹æ¹ï¼æ¯æè ¢çï¼å¦æä¸æ¸æ¥è¿ä¸åæå¯¹æ¹çï¼åæ¯æ ç¤¼çãåªæå®å¨çè§£äºï¼ææè¯å¤´è®ºè¶³çèµæ ¼ã\n\n> å½ä½ ä¸åæä½èçè§ç¹æ¶ï¼è¦çæ§å°è¡¨è¾¾èªå·±çæè§ï¼ä¸è¦æ çå°è¾©é©³æäºè®ºã\n\næä»¬éè¦æè°è¯å½åå­¦ä¹ ï¼è¿æ¯ä¸ä¸ªäºç¸å­¦ä¹ åå¤´èé£æ´çè¿ç¨ï¼ä»ä¸­è·åå°ç¥è¯ï¼è¿ææ¯ç®çï¼èä¸æ¯æ æä¹çäºåµã\n\n> å°éç¥è¯ä¸ä¸ªäººè§ç¹çä¸åï¼å¨ä½ä»»ä½è¯æ­ä¹åï¼é½è¦æ¾åºçè®ºåºç¡\n\nä½èæåºæ»¡è¶³åä½èè¾©è®ºèµæ ¼çä¸ä¸ªè§åï¼\n\n * è¯»èä¸å®è¦å®æ´çäºè§£è¿æ¬ä¹¦\n * è¯»èä¸è¦äºå¼ºå¥½èæç²ç®åé©³\n * å°ç¥è¯ä¸çä¸åæè§çåæ¯å¤§ä½ä¸å¯ä»¥è§£å³çé®é¢\n\næä»¬å¨éè¯»ä¸æ¬ä¹¦æ¶å¦ææä¸åçæè§ï¼å¯ä»¥æçºªå¾çè¿è¡è¾©è®ºï¼\n\n * å¨äºè¾©çè¿ç¨ä¸­ä¸è¦å¸¦æèªå·±çæç»ªï¼å¦åå°±ä¸æ¯å¨è¯´çäºã\n * å¨äºè¾©æ¶éè¦åå°åææ¡ä»¶æèåè®¾æ¡ä»¶æåºæ¥ï¼è¿ä¸ªæ¯ä½ åé¢ææå¤æ­çåºç¡ï¼ä½ ä¹è¦æ¥åå¯¹æ¹çåè®¾æ¡ä»¶ï¼å³ä½¿ä½ ä»¬ççæ³å®å¨ç¸åï¼ä½æ¯ä¹éè¦æ¥åã\n * å¨äºè¾©æ¶ï¼éè¦ç«å¨å¯¹æ¹çè§åº¦å»æèï¼è¿æ ·æè½æ¯æè§çäº¤æµï¼èä¸æ¯æ æä¹çäºåµã\n\næä»¬å¨åé©³ä½èé®é¢çæ¶åï¼ä¸å®è¦æ¿åºä¾æ®æ¥è¯æèªå·±çè®ºç¹æå¯¹å¯¹æ¹çå°éã\n\n\n# è¾å©éè¯»\n\nå¯¹äºè¾å©éè¯»ï¼å»ºè®®åå°½èªå·±æè½çéè¿åå¨éè¯»å»å°ä¸æ¬ä¹¦ï¼å¦æè¿æä¸æçåéè¦å¯»æ¾å¤å¨çå¸®å©ã\n\nå¯¹äºå¯¼è¯»ï¼å»ºè®®æ¯å¨è¯»å®ä¸æ¬ä¹¦ä¹ååå»éè¯»ï¼è¿æ¯å ä¸ºï¼\n\n * å¯¼è¯»ä¸ä¸å®æ¯å¯¹çï¼å ä¸ºè¿ä¸ªæ¯å«äººè¯»å®ä¹¦ä¹åèªå·±çæè\n * å³ä½¿æ¯å¯¹çï¼ä¹ä¸æ¯ä¸å®æ¯å¨é¢çï¼å¯è½å¯¼è¯»è¿ä¹ä¼æéæ¼\n * çå¯¼è¯»ä¹ä¼éå¶èªå·±ççè§£ï¼å¹¶ä¸è·çå¯¼è¯»èçè§åº¦å»æèï¼ä½æ²¡æèªå·±çæèã\n\nè¿ä¹åçè¯ï¼ä¹æ¯æå¥½å¤çï¼\n\n * å¸®å©æä»¬è¯ éè¯­å¥ï¼å¹¶æ¾åºå±è¯ä¸ä¸»æ¨ã\n * èªæè¯»ä¹¦çä¸ç§è¡¥åï¼å¨éè¯»å®ä¹åäº§ççé®ç­ï¼å¯ä»¥å¸®å©ä½ è§£ç­ä¸çè§£ã\n\nå¯¹äºæè¦çä½ç¨ï¼\n\n * å¨éè¯»ä¸æ¬ä¹¦ä¹åï¼å¯ä»¥å¤éèªå·±çè®°å¿\n * å¨ä¸»é¢éè¯»æ¶ï¼å¯ä»¥éè¿æè¦ç¸å³èèµ·æ¥ã\n\nå¯¹äºå·¥å·ä¹¦çä½¿ç¨ï¼æä»¬éè¦ç¥éèªå·±æ³è¦æ¾ä»ä¹ï¼åªä¸ç§å·¥å·ææä»¬æ³è¦æ¾çåå®¹ï¼å¹¶å¦ä½ä½¿ç¨ä»ä»¬å¿«éæ¥æ¾å°ä½ æ³è¦æ¾çèµæã\n\n\n# éè¯»å¥½ä¹¦çéè¦æ§\n\n> å¦æä½ æè¯»çä¹¦é½å¨ä½ çè½åèå´ä¹åï¼ä½ å°±æ²¡æ³æåèªå·±çéè¯»è½åãä½ å¿é¡»è½æçºµè¶è¶ä½ è½åçä¹¦ï¼æåæä»¬æè¯´çï¼éè¯»è¶è¶ä½ å¤´èçä¹¦ãåªæé£æ ·çä¹¦è½å¸®å©ä½ çææ³å¢é¿ï¼é¤éä½ è½å¢é¿å¿æºï¼å¦åä½ å­¦ä¸å°ä¸è¥¿ã\n\næä»¬éè¦éè¿æ£è§éè¯»æ¥æé¤æé£äºåä¹¦ï¼æè½èçæ¶é´è¯»æ´å¤çå¥½ä¹¦ã',charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"åé¾",frontmatter:{title:"åé¾",date:"2022-10-30T20:28:03.000Z",permalink:"/friends",categories:["æ´å¤"],tags:[null],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"desc: å¼åæ¥å¸¸\n  avatar: https://www.lllomh.com/static/images/photos.jpg\n  link: https://www.lllomh.com/\n:::",article:!1,comment:!0,meta:[{name:"twitter:title",content:"åé¾"},{name:"twitter:description",content:"desc: å¼åæ¥å¸¸\n  avatar: https://www.lllomh.com/static/images/photos.jpg\n  link: https://www.lllomh.com/\n:::"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/09.%E6%9B%B4%E5%A4%9A/02.%E5%8F%8B%E9%93%BE.html"},{property:"og:type",content:"article"},{property:"og:title",content:"åé¾"},{property:"og:description",content:"desc: å¼åæ¥å¸¸\n  avatar: https://www.lllomh.com/static/images/photos.jpg\n  link: https://www.lllomh.com/\n:::"},{property:"og:url",content:"https://www.msqfx.cc/09.%E6%9B%B4%E5%A4%9A/02.%E5%8F%8B%E9%93%BE.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-10-30T20:28:03.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"åé¾"},{itemprop:"description",content:"desc: å¼åæ¥å¸¸\n  avatar: https://www.lllomh.com/static/images/photos.jpg\n  link: https://www.lllomh.com/\n:::"}],readingShow:"top"},regularPath:"/09.%E6%9B%B4%E5%A4%9A/02.%E5%8F%8B%E9%93%BE.html",relativePath:"09.æ´å¤/02.åé¾.md",key:"v-0485a99b",path:"/friends/",headers:[{level:2,title:"åé¾ç³è¯·",slug:"åé¾ç³è¯·",normalizedTitle:"åé¾ç³è¯·",charIndex:1786}],headersStr:"åé¾ç³è¯·",content:"éä¸æ¸é£çåå®¢\n\næé»é,å¤æ­»å¯ç£\n\nEvan's blog\n\nç§¯è·¬æ­¥ä»¥è³åéï¼åæ¬¢å­¦ä¹ åæ¬¢ä½ ã\n\näºä¸«è®²æ¢µ\n\nð»å­¦ä¹ ðè®°å½ðåäº«\n\néºé¹¿é²å\n\nå¤§éè³ç®ï¼ç¥æè¡é¾ã\n\nCrayonã®åå®¢\n\nç¨åºç¿ && äºæ¬¡ç¿\n\nCase of Xeon\n\nWelcome inside\n\nè¥ç«åå®¢\n\nææ¯æ¹åçæ´»\n\nmqray's blog\n\nææ¥å¤ææ¥ï¼ææ¥ä½å¶å¤ï¼\n\nä¹å¼¦ä¹å±\n\næ¬¢è¿æè¡èï¼æ¥å°è¿ä¸ªå¹³å¡ä½åè®°è½½äºè®¸å¤æäºçå°å±\n\nèæ¸¡\n\nå¼åæ¥å¸¸\n\n- name: éä¸æ¸é£çåå®¢\n  desc: 'æé»é,å¤æ­»å¯ç£'\n  avatar: https://www.zhengwenfeng.com/img/me.jpg\n  link: https://www.zhengwenfeng.com\n  bgColor: '#f8f9fa'\n- name: Evan's blog # æµç§°\n  desc: ç§¯è·¬æ­¥ä»¥è³åéï¼åæ¬¢å­¦ä¹ åæ¬¢ä½ ã # ä»ç»\n  avatar: https://cdn.jsdelivr.net/gh/xugaoyi/image_store/blog/20200103123203.jpg # å¤´å\n  link: https://xugaoyi.com/  # é¾æ¥\n  bgColor: '#f8f9fa'\n- name: äºä¸«è®²æ¢µ\n  desc: 'ð»å­¦ä¹ ðè®°å½ðåäº«'\n  avatar: https://wiki.eryajf.net/img/logo.png\n  link: https://wiki.eryajf.net\n  bgColor: '#f8f9fa'\n- name: éºé¹¿é²å\n  desc: 'å¤§éè³ç®ï¼ç¥æè¡é¾ã'\n  avatar: https://pic.cnblogs.com/avatar/1273193/20190806180831.png\n  link: https://www.cnblogs.com/miluluyo/\n  bgColor: '#f8f9fa'\n- name: Crayonã®åå®¢\n  desc: 'ç¨åºç¿ && äºæ¬¡ç¿'\n  avatar: http://sucrayon.top/images/avatar.jpg\n  link: http://sucrayon.top/\n  bgColor: '#f8f9fa'\n- name: Case of Xeon\n  desc: 'Welcome inside'\n  avatar: https://hexo.chensmallx.top/img/avator.jpg\n  link: https://hexo.chensmallx.top/\n  bgColor: '#f8f9fa'\n- name: è¥ç«åå®¢\n  desc: ææ¯æ¹åçæ´»\n  avatar: http://blog.mryxh.cn/favicon.ico\n  link: http://blog.mryxh.cn/\n  bgColor: '#f8f9fa'\n- name: mqray's blog\n  desc: ææ¥å¤ææ¥ï¼ææ¥ä½å¶å¤ï¼\n  avatar: https://mqrayblog.cn/img/avatar.png\n  link: https://mqrayblog.cn/\n- name: ä¹å¼¦ä¹å±\n  desc: æ¬¢è¿æè¡èï¼æ¥å°è¿ä¸ªå¹³å¡ä½åè®°è½½äºè®¸å¤æäºçå°å±\n  avatar: https://blog.sinzmise.top/img/avatar.png\n  link: https://blog.sinzmise.top/\n- name: èæ¸¡\n  desc: å¼åæ¥å¸¸\n  avatar: https://www.lllomh.com/static/images/photos.jpg\n  link: https://www.lllomh.com/\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n\n# åé¾ç³è¯·\n\nç³è¯·åè®°å¾åæ·»å æ¬ç«å¦~\n\n * æ¹æ³ä¸\n\nä¸æ èç³» æè å¨æ¬é¡µé¢è¯è®ºåºçè¨æ¨çåé¾ä¿¡æ¯ï¼æ ¼å¼ï¼(ç¹å»ä»£ç åå³ä¸è§ä¸é®å¤å¶)\n\n- name: éä¸æ¸é£çåå®¢ # æµç§°\n  desc:  æé»é,å¤æ­»å¯ç£ # ä»ç»\n  avatar: https://www.zhengwenfeng.com/img/me.jpg # å¤´å\n  link: https://www.zhengwenfeng.com  # é¾æ¥\n\n\n1\n2\n3\n4\n\n * æ¹æ³äº\n\nforkæ¬é¡¹ç®,å¨docs/æ´å¤/åé¾.mdæä»¶ä¸­ï¼æ°å¢èªå·±çåé¾ï¼ç¶åæäº¤PRå³å¯ã",normalizedContent:"éä¸æ¸é£çåå®¢\n\næé»é,å¤æ­»å¯ç£\n\nevan's blog\n\nç§¯è·¬æ­¥ä»¥è³åéï¼åæ¬¢å­¦ä¹ åæ¬¢ä½ ã\n\näºä¸«è®²æ¢µ\n\nð»å­¦ä¹ ðè®°å½ðåäº«\n\néºé¹¿é²å\n\nå¤§éè³ç®ï¼ç¥æè¡é¾ã\n\ncrayonã®åå®¢\n\nç¨åºç¿ && äºæ¬¡ç¿\n\ncase of xeon\n\nwelcome inside\n\nè¥ç«åå®¢\n\nææ¯æ¹åçæ´»\n\nmqray's blog\n\nææ¥å¤ææ¥ï¼ææ¥ä½å¶å¤ï¼\n\nä¹å¼¦ä¹å±\n\næ¬¢è¿æè¡èï¼æ¥å°è¿ä¸ªå¹³å¡ä½åè®°è½½äºè®¸å¤æäºçå°å±\n\nèæ¸¡\n\nå¼åæ¥å¸¸\n\n- name: éä¸æ¸é£çåå®¢\n  desc: 'æé»é,å¤æ­»å¯ç£'\n  avatar: https://www.zhengwenfeng.com/img/me.jpg\n  link: https://www.zhengwenfeng.com\n  bgcolor: '#f8f9fa'\n- name: evan's blog # æµç§°\n  desc: ç§¯è·¬æ­¥ä»¥è³åéï¼åæ¬¢å­¦ä¹ åæ¬¢ä½ ã # ä»ç»\n  avatar: https://cdn.jsdelivr.net/gh/xugaoyi/image_store/blog/20200103123203.jpg # å¤´å\n  link: https://xugaoyi.com/  # é¾æ¥\n  bgcolor: '#f8f9fa'\n- name: äºä¸«è®²æ¢µ\n  desc: 'ð»å­¦ä¹ ðè®°å½ðåäº«'\n  avatar: https://wiki.eryajf.net/img/logo.png\n  link: https://wiki.eryajf.net\n  bgcolor: '#f8f9fa'\n- name: éºé¹¿é²å\n  desc: 'å¤§éè³ç®ï¼ç¥æè¡é¾ã'\n  avatar: https://pic.cnblogs.com/avatar/1273193/20190806180831.png\n  link: https://www.cnblogs.com/miluluyo/\n  bgcolor: '#f8f9fa'\n- name: crayonã®åå®¢\n  desc: 'ç¨åºç¿ && äºæ¬¡ç¿'\n  avatar: http://sucrayon.top/images/avatar.jpg\n  link: http://sucrayon.top/\n  bgcolor: '#f8f9fa'\n- name: case of xeon\n  desc: 'welcome inside'\n  avatar: https://hexo.chensmallx.top/img/avator.jpg\n  link: https://hexo.chensmallx.top/\n  bgcolor: '#f8f9fa'\n- name: è¥ç«åå®¢\n  desc: ææ¯æ¹åçæ´»\n  avatar: http://blog.mryxh.cn/favicon.ico\n  link: http://blog.mryxh.cn/\n  bgcolor: '#f8f9fa'\n- name: mqray's blog\n  desc: ææ¥å¤ææ¥ï¼ææ¥ä½å¶å¤ï¼\n  avatar: https://mqrayblog.cn/img/avatar.png\n  link: https://mqrayblog.cn/\n- name: ä¹å¼¦ä¹å±\n  desc: æ¬¢è¿æè¡èï¼æ¥å°è¿ä¸ªå¹³å¡ä½åè®°è½½äºè®¸å¤æäºçå°å±\n  avatar: https://blog.sinzmise.top/img/avatar.png\n  link: https://blog.sinzmise.top/\n- name: èæ¸¡\n  desc: å¼åæ¥å¸¸\n  avatar: https://www.lllomh.com/static/images/photos.jpg\n  link: https://www.lllomh.com/\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n\n# åé¾ç³è¯·\n\nç³è¯·åè®°å¾åæ·»å æ¬ç«å¦~\n\n * æ¹æ³ä¸\n\nä¸æ èç³» æè å¨æ¬é¡µé¢è¯è®ºåºçè¨æ¨çåé¾ä¿¡æ¯ï¼æ ¼å¼ï¼(ç¹å»ä»£ç åå³ä¸è§ä¸é®å¤å¶)\n\n- name: éä¸æ¸é£çåå®¢ # æµç§°\n  desc:  æé»é,å¤æ­»å¯ç£ # ä»ç»\n  avatar: https://www.zhengwenfeng.com/img/me.jpg # å¤´å\n  link: https://www.zhengwenfeng.com  # é¾æ¥\n\n\n1\n2\n3\n4\n\n * æ¹æ³äº\n\nforkæ¬é¡¹ç®,å¨docs/æ´å¤/åé¾.mdæä»¶ä¸­ï¼æ°å¢èªå·±çåé¾ï¼ç¶åæäº¤prå³å¯ã",charsets:{cjk:!0},lastUpdated:"2024/02/18, 14:37:23",lastUpdatedTimestamp:1708238243e3},{title:"Javaåå­ç®¡çæ»ç»",frontmatter:{title:"Javaåå­ç®¡çæ»ç»",date:"2023-08-27T20:50:06.000Z",permalink:"/pages/277c5b/",author:{name:"éä¸æ¸é£",link:"https://msqfx.github.io"},categories:["java","å¹¶åç¯"],tags:[null],description:"",comment:!0,meta:[{name:"twitter:title",content:"Javaåå­ç®¡çæ»ç»"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/10.Java%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%80%BB%E7%BB%93.html"},{property:"og:type",content:"article"},{property:"og:title",content:"Javaåå­ç®¡çæ»ç»"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/10.Java%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%80%BB%E7%BB%93.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-08-27T20:50:06.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"Javaåå­ç®¡çæ»ç»"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/01.java/03.%E5%B9%B6%E5%8F%91%E7%AF%87/10.Java%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%80%BB%E7%BB%93.html",relativePath:"01.java/03.å¹¶åç¯/10.Javaåå­ç®¡çæ»ç».md",key:"v-e5fb5ede",path:"/pages/277c5b/",headers:[{level:2,title:"æ åå­ï¼Stack Memoryï¼",slug:"æ åå­-stack-memory",normalizedTitle:"æ åå­ï¼stack memoryï¼",charIndex:16},{level:2,title:"å åå­ï¼Heap Memoryï¼ï¼",slug:"å åå­-heap-memory",normalizedTitle:"å åå­ï¼heap memoryï¼ï¼",charIndex:158},{level:2,title:"æ¹æ³åºï¼Method Areaï¼",slug:"æ¹æ³åº-method-area",normalizedTitle:"æ¹æ³åºï¼method areaï¼",charIndex:360},{level:2,title:"å¶ä»ç¸å³ç¥è¯ç¹",slug:"å¶ä»ç¸å³ç¥è¯ç¹",normalizedTitle:"å¶ä»ç¸å³ç¥è¯ç¹",charIndex:504}],headersStr:"æ åå­ï¼Stack Memoryï¼ å åå­ï¼Heap Memoryï¼ï¼ æ¹æ³åºï¼Method Areaï¼ å¶ä»ç¸å³ç¥è¯ç¹",content:'# Java åå­ç®¡ç\n\n\n# æ åå­ï¼Stack Memoryï¼\n\n * æ æ¯çº¿ç¨ç§æçï¼æ¯ä¸ªçº¿ç¨é½æèªå·±çæ ã\n * ç¨äºå­å¨å±é¨åéãæ¹æ³åæ°ãè¿åå°åä»¥åä¸äºåºæ¬æ°æ®ç±»åã\n * å·æå¿«éçåéåéæ¾ï¼å ä¸ºéç¨"åè¿ååº"ï¼LIFOï¼çæ°æ®ç»æã\n * æ åå­çå¤§å°æ¯æéçï¼ä¸è¬ç±èææºé¢åå®ä¹ã\n\n\n# å åå­ï¼Heap Memoryï¼ï¼\n\n * ç¨äºå­å¨å¯¹è±¡å®ä¾åæ°ç»ç­å¨æåéçå¯¹è±¡ã\n * Java ä¸­çåå¾åæ¶ï¼Garbage Collectionï¼åçå¨å åå­ï¼åæ¶ä¸åä½¿ç¨çå¯¹è±¡ã\n * å¯ä»¥éè¿è®¾ç½®åæ°è°æ´å çå¤§å°ï¼å¦ -Xmxï¼æå¤§å å¤§å°ï¼å -Xmsï¼åå§å å¤§å°ï¼ã\n * å åå­åä¸ºæ°çä»£ï¼EdenãSurvivorï¼åèå¹´ä»£ï¼ä¸åçå¯¹è±¡çæåçå½å¨æå½±åå¯¹è±¡å¨ä¸åä»£ä¸­çåéã\n\n\n# æ¹æ³åºï¼Method Areaï¼\n\n * å­å¨ç±»ä¿¡æ¯ãå¸¸éãéæåéãæ¹æ³ä»£ç ç­ã\n * æ¹æ³åºä¹å«æ°¸ä¹ä»£ï¼Permanent Generationï¼ï¼ä½å¨ Java 8 åè¢«åç©ºé´ï¼Metaspaceï¼åä»£ã\n * åç©ºé´çå¤§å°å¯ä»¥æ ¹æ®éè¦å¨ææ©å±ï¼å¹¶ä¸å¯ä»¥éæ¾æªä½¿ç¨çåå­ã\n\n\n# å¶ä»ç¸å³ç¥è¯ç¹\n\n * å¼ä¼ éä¸å¼ç¨ä¼ éï¼åºæ¬ç±»åéç¨å¼ä¼ éï¼ä¼ éçæ¯å¼çæ·è´ï¼å¼ç¨ç±»åéç¨å¼ç¨ä¼ éï¼ä¼ éçæ¯å¼ç¨çå°åã\n * èªå¨åå­ç®¡çï¼Java éè¿åå¾åæ¶å¨èªå¨ç®¡çåå­ï¼éæ¾ä¸åä½¿ç¨çå¯¹è±¡ï¼é¿åäºæå¨éæ¾åå­çé®é¢ã\n * åå­æ³æ¼ï¼æªéæ¾ä¸åä½¿ç¨çå¯¹è±¡ï¼å¯¼è´åå­å ç¨ä¸æ­å¢å ï¼æç»å¯è½èå°½å¯ç¨åå­ã\n * åå­æº¢åºï¼Out of Memoryï¼ï¼ç³è¯·çåå­è¶è¿äºèææºçéå¶ï¼å¯¼è´ç¨åºå´©æºã\n * å¼±å¼ç¨ãè½¯å¼ç¨åå¼ºå¼ç¨ï¼ä¸åçº§å«çå¼ç¨å¯ä»¥å½±ååå¾åæ¶æ¶å¯¹è±¡ççå½å¨æã\n * æ å¸§ï¼Stack Frameï¼ï¼æ¹æ³å¨æ§è¡æ¶ä¼å¨æ ä¸åå»ºæ å¸§ï¼ç¨äºå­å¨å±é¨åéãæä½æ°æ ãæ¹æ³è¿åå¼ç­ã',normalizedContent:'# java åå­ç®¡ç\n\n\n# æ åå­ï¼stack memoryï¼\n\n * æ æ¯çº¿ç¨ç§æçï¼æ¯ä¸ªçº¿ç¨é½æèªå·±çæ ã\n * ç¨äºå­å¨å±é¨åéãæ¹æ³åæ°ãè¿åå°åä»¥åä¸äºåºæ¬æ°æ®ç±»åã\n * å·æå¿«éçåéåéæ¾ï¼å ä¸ºéç¨"åè¿ååº"ï¼lifoï¼çæ°æ®ç»æã\n * æ åå­çå¤§å°æ¯æéçï¼ä¸è¬ç±èææºé¢åå®ä¹ã\n\n\n# å åå­ï¼heap memoryï¼ï¼\n\n * ç¨äºå­å¨å¯¹è±¡å®ä¾åæ°ç»ç­å¨æåéçå¯¹è±¡ã\n * java ä¸­çåå¾åæ¶ï¼garbage collectionï¼åçå¨å åå­ï¼åæ¶ä¸åä½¿ç¨çå¯¹è±¡ã\n * å¯ä»¥éè¿è®¾ç½®åæ°è°æ´å çå¤§å°ï¼å¦ -xmxï¼æå¤§å å¤§å°ï¼å -xmsï¼åå§å å¤§å°ï¼ã\n * å åå­åä¸ºæ°çä»£ï¼edenãsurvivorï¼åèå¹´ä»£ï¼ä¸åçå¯¹è±¡çæåçå½å¨æå½±åå¯¹è±¡å¨ä¸åä»£ä¸­çåéã\n\n\n# æ¹æ³åºï¼method areaï¼\n\n * å­å¨ç±»ä¿¡æ¯ãå¸¸éãéæåéãæ¹æ³ä»£ç ç­ã\n * æ¹æ³åºä¹å«æ°¸ä¹ä»£ï¼permanent generationï¼ï¼ä½å¨ java 8 åè¢«åç©ºé´ï¼metaspaceï¼åä»£ã\n * åç©ºé´çå¤§å°å¯ä»¥æ ¹æ®éè¦å¨ææ©å±ï¼å¹¶ä¸å¯ä»¥éæ¾æªä½¿ç¨çåå­ã\n\n\n# å¶ä»ç¸å³ç¥è¯ç¹\n\n * å¼ä¼ éä¸å¼ç¨ä¼ éï¼åºæ¬ç±»åéç¨å¼ä¼ éï¼ä¼ éçæ¯å¼çæ·è´ï¼å¼ç¨ç±»åéç¨å¼ç¨ä¼ éï¼ä¼ éçæ¯å¼ç¨çå°åã\n * èªå¨åå­ç®¡çï¼java éè¿åå¾åæ¶å¨èªå¨ç®¡çåå­ï¼éæ¾ä¸åä½¿ç¨çå¯¹è±¡ï¼é¿åäºæå¨éæ¾åå­çé®é¢ã\n * åå­æ³æ¼ï¼æªéæ¾ä¸åä½¿ç¨çå¯¹è±¡ï¼å¯¼è´åå­å ç¨ä¸æ­å¢å ï¼æç»å¯è½èå°½å¯ç¨åå­ã\n * åå­æº¢åºï¼out of memoryï¼ï¼ç³è¯·çåå­è¶è¿äºèææºçéå¶ï¼å¯¼è´ç¨åºå´©æºã\n * å¼±å¼ç¨ãè½¯å¼ç¨åå¼ºå¼ç¨ï¼ä¸åçº§å«çå¼ç¨å¯ä»¥å½±ååå¾åæ¶æ¶å¯¹è±¡ççå½å¨æã\n * æ å¸§ï¼stack frameï¼ï¼æ¹æ³å¨æ§è¡æ¶ä¼å¨æ ä¸åå»ºæ å¸§ï¼ç¨äºå­å¨å±é¨åéãæä½æ°æ ãæ¹æ³è¿åå¼ç­ã',charsets:{cjk:!0}},{title:"çè§£Linux IPIPé§é",frontmatter:{title:"çè§£Linux IPIPé§é",date:"2023-05-26T13:11:26.000Z",permalink:"/pages/c128e7/",categories:["ç¼ç¨","linux"],tags:["linux","è®¡ç®æºç½ç»","linuxç½ç»èæå"],author:{name:"msqfx",link:"https://github.com/msqfx"},description:"IPIPé§éçå·¥ä½åçæ¯å°æºä¸»æºçIPæ°æ®åå°è£å¨ä¸ä¸ªæ°çIPæ°æ®åä¸­ï¼æ°çIPæ°æ®åçç®çå°åæ¯é§éçå¦ä¸ç«¯ãå¨é§éçå¦ä¸ç«¯ï¼æ¥æ¶æ¹å°è§£å°è£åå§IPæ°æ®åï¼å¹¶å°å¶ä¼ éå°ç®æ ä¸»æºãIPIPé§éå¯ä»¥å¨ä¸åçç½ç»ä¹é´å»ºç«è¿æ¥ï¼ä¾å¦å¨IPv4ç½ç»åIPv6ç½ç»ä¹é´å»ºç«è¿æ¥ã",comment:!0,feed:{enable:!0},meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/c__Users_User_OneDrive_workspace_excalidraw_ipip-20230526095538-83tl82w.png"},{name:"twitter:title",content:"çè§£Linux IPIPé§é"},{name:"twitter:description",content:"IPIPé§éçå·¥ä½åçæ¯å°æºä¸»æºçIPæ°æ®åå°è£å¨ä¸ä¸ªæ°çIPæ°æ®åä¸­ï¼æ°çIPæ°æ®åçç®çå°åæ¯é§éçå¦ä¸ç«¯ãå¨é§éçå¦ä¸ç«¯ï¼æ¥æ¶æ¹å°è§£å°è£åå§IPæ°æ®åï¼å¹¶å°å¶ä¼ éå°ç®æ ä¸»æºãIPIPé§éå¯ä»¥å¨ä¸åçç½ç»ä¹é´å»ºç«è¿æ¥ï¼ä¾å¦å¨IPv4ç½ç»åIPv6ç½ç»ä¹é´å»ºç«è¿æ¥ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/c__Users_User_OneDrive_workspace_excalidraw_ipip-20230526095538-83tl82w.png"},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/03.linux/04.%E7%90%86%E8%A7%A3Linux%20IPIP%E9%9A%A7%E9%81%93.html"},{property:"og:type",content:"article"},{property:"og:title",content:"çè§£Linux IPIPé§é"},{property:"og:description",content:"IPIPé§éçå·¥ä½åçæ¯å°æºä¸»æºçIPæ°æ®åå°è£å¨ä¸ä¸ªæ°çIPæ°æ®åä¸­ï¼æ°çIPæ°æ®åçç®çå°åæ¯é§éçå¦ä¸ç«¯ãå¨é§éçå¦ä¸ç«¯ï¼æ¥æ¶æ¹å°è§£å°è£åå§IPæ°æ®åï¼å¹¶å°å¶ä¼ éå°ç®æ ä¸»æºãIPIPé§éå¯ä»¥å¨ä¸åçç½ç»ä¹é´å»ºç«è¿æ¥ï¼ä¾å¦å¨IPv4ç½ç»åIPv6ç½ç»ä¹é´å»ºç«è¿æ¥ã"},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/c__Users_User_OneDrive_workspace_excalidraw_ipip-20230526095538-83tl82w.png"},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/03.linux/04.%E7%90%86%E8%A7%A3Linux%20IPIP%E9%9A%A7%E9%81%93.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2023-05-26T13:11:26.000Z"},{property:"article:tag",content:"linux"},{property:"article:tag",content:"è®¡ç®æºç½ç»"},{property:"article:tag",content:"linuxç½ç»èæå"},{itemprop:"name",content:"çè§£Linux IPIPé§é"},{itemprop:"description",content:"IPIPé§éçå·¥ä½åçæ¯å°æºä¸»æºçIPæ°æ®åå°è£å¨ä¸ä¸ªæ°çIPæ°æ®åä¸­ï¼æ°çIPæ°æ®åçç®çå°åæ¯é§éçå¦ä¸ç«¯ãå¨é§éçå¦ä¸ç«¯ï¼æ¥æ¶æ¹å°è§£å°è£åå§IPæ°æ®åï¼å¹¶å°å¶ä¼ éå°ç®æ ä¸»æºãIPIPé§éå¯ä»¥å¨ä¸åçç½ç»ä¹é´å»ºç«è¿æ¥ï¼ä¾å¦å¨IPv4ç½ç»åIPv6ç½ç»ä¹é´å»ºç«è¿æ¥ã"},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/c__Users_User_OneDrive_workspace_excalidraw_ipip-20230526095538-83tl82w.png"}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/03.linux/04.%E7%90%86%E8%A7%A3Linux%20IPIP%E9%9A%A7%E9%81%93.html",relativePath:"04.ç¼ç¨/03.linux/04.çè§£Linux IPIPé§é.md",key:"v-e627318a",path:"/pages/c128e7/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"ä½¿ç¨IPIPé§éå®ç°è·¨ä¸»æºç½ç»",slug:"ä½¿ç¨ipipé§éå®ç°è·¨ä¸»æºç½ç»",normalizedTitle:"ä½¿ç¨ipipé§éå®ç°è·¨ä¸»æºç½ç»",charIndex:190},{level:2,title:"å·¨äººçè©è",slug:"å·¨äººçè©è",normalizedTitle:"å·¨äººçè©è",charIndex:1895}],headersStr:"ç®ä» ä½¿ç¨IPIPé§éå®ç°è·¨ä¸»æºç½ç» å·¨äººçè©è",content:"# ç®ä»\n\nIPIPé§éæ¯ä¸ç§ç¹å¯¹ç¹çé§éåè®®ï¼ç¨äºå¨IPv4ç½ç»ä¸ä¼ è¾IPv4æIPv6æ°æ®åã\n\nIPIPé§éçå·¥ä½åçæ¯å°æºä¸»æºçIPæ°æ®åå°è£å¨ä¸ä¸ªæ°çIPæ°æ®åä¸­ï¼æ°çIPæ°æ®åçç®çå°åæ¯é§éçå¦ä¸ç«¯ãå¨é§éçå¦ä¸ç«¯ï¼æ¥æ¶æ¹å°è§£å°è£åå§IPæ°æ®åï¼å¹¶å°å¶ä¼ éå°ç®æ ä¸»æºãIPIPé§éå¯ä»¥å¨ä¸åçç½ç»ä¹é´å»ºç«è¿æ¥ï¼ä¾å¦å¨IPv4ç½ç»åIPv6ç½ç»ä¹é´å»ºç«è¿æ¥ã\n\n\n# ä½¿ç¨IPIPé§éå®ç°è·¨ä¸»æºç½ç»\n\n\n\né¦åå¨Node1åå»ºtunè®¾å¤å¹¶è®¾ç½®ä¸ºipipæ¨¡å¼ï¼localè®¾ç½®ä¸ºæ¬å°IPå°å10.65.132.187ï¼remoteè®¾ç½®ä¸ºå¯¹ç«¯IP10.65.132.187ï¼è¿ä¸¤ä¸ªæ¯é§éå¤å±IPï¼ç¶ååè®¾ç½®é§éåå±IPï¼10.10.100.10å°10.10.200.10ã\n\nip tunnel add tun1 mode ipip remote 10.65.132.188 local 10.65.132.187\nip link set tun1 up\nip a add 10.10.100.10 peer 10.10.200.10 dev tun1\n\n\n1\n2\n3\n\n\nå¯ä»¥çå°æ·»å äºä¸æ¡è·¯ç±ï¼åéå°ç®çå°å10.10.200.10çåé½ä¼è½¬åå°tun1è®¾å¤ä¸­\n\n# ip r\n...\n10.10.200.10 dev tun1 proto kernel scope link src 10.10.100.10\n...\n\n\n1\n2\n3\n4\n\n\ntunè®¾å¤ä¼å°è¿å¥çIPåå°è£å°ä¸ä¸ªIPåä¸­ï¼æºå°åæ¯ä¹åè®¾ç½®çå¤å±local IPï¼èç®çå°åæ¯å¤å±remote IPï¼ç¶ååéè¿è·¯ç±è¾¾å°ä»ens18ç½å¡åºå»å°Node2ä¸­ã\n\nå¨Node2ä¸åå»ºtunè®¾å¤ï¼éç½®åNode1ä¸æ ·\n\nip tunnel add tun2 mode ipip remote 10.65.132.187 local 10.65.132.188\nip link set tun2 up\nip a add 10.10.200.10 peer 10.10.100.10 dev tun2\n\n\n\n1\n2\n3\n4\n\n\nç¶åå¨Node1ä¸ping Node2çtunè®¾å¤\n\nping 10.10.200.10 -c 1\n\n\n1\n\n\néè¿tcpdumpå¨Node2æåå¦ä¸ï¼\n\n20:16:40.011992 IP 10.65.132.187 > 10.65.132.188: IP 10.10.100.10 > 10.10.200.10: ICMP echo request, id 17609, seq 1, length 64 (ipip-proto-4)\n20:16:40.012099 IP 10.65.132.188 > 10.65.132.187: IP 10.10.200.10 > 10.10.100.10: ICMP echo reply, id 17609, seq 1, length 64 (ipip-proto-4)\n\n\n1\n2\n\n\næ°æ®åè¾¾å°Node2åï¼æ¯ä¸ä¸ªä¸¤å±IPæ°æ®åï¼ä»Node2çens18ç½å¡åºæ¥åï¼è§£å°æ°æ®åï¼åç°åå±çç®çIPæ¯10.10.200.10ä¹å°±æ¯tun2çå°åï¼ç¶åå°æ°æ®ååå°tun2è®¾å¤ã\n\ntun2è®¾å¤æ¶å°æ°æ®åååæ ¹æ®ä¸é¢ç¸åæ­¥éª¤è¿è¡å°è£æ°æ®åååç»tun1ï¼æç»æ´ä¸ªpingè¿ç¨å®æã\n\nIPIPé§éæ¯éè¿IPå°åæ¥æ è¯ç½ç»è®¾å¤çï¼æä»¥ä¸éè¦ä½¿ç¨MACå°åï¼ç´æ¥éè¿IPå°åå³å¯ãéè¿æ¥çtunè®¾å¤ä¿¡æ¯ï¼å¯ä»¥çå°å¶æ¯ä¸å­å¨macå°åçã\n\n# ip -d link show tun1\n59: tun1@NONE: <POINTOPOINT,NOARP,UP,LOWER_UP> mtu 1480 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ipip 10.65.132.187 peer 10.65.132.188 promiscuity 0 minmtu 68 maxmtu 65515 \n    ipip ipip remote 10.65.132.188 local 10.65.132.187 ttl inherit pmtudisc addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 \n\n\n1\n2\n3\n4\n\n\n\n# å·¨äººçè©è\n\n * ãKubernetesç½ç»æå¨æåã\n\nâ",normalizedContent:"# ç®ä»\n\nipipé§éæ¯ä¸ç§ç¹å¯¹ç¹çé§éåè®®ï¼ç¨äºå¨ipv4ç½ç»ä¸ä¼ è¾ipv4æipv6æ°æ®åã\n\nipipé§éçå·¥ä½åçæ¯å°æºä¸»æºçipæ°æ®åå°è£å¨ä¸ä¸ªæ°çipæ°æ®åä¸­ï¼æ°çipæ°æ®åçç®çå°åæ¯é§éçå¦ä¸ç«¯ãå¨é§éçå¦ä¸ç«¯ï¼æ¥æ¶æ¹å°è§£å°è£åå§ipæ°æ®åï¼å¹¶å°å¶ä¼ éå°ç®æ ä¸»æºãipipé§éå¯ä»¥å¨ä¸åçç½ç»ä¹é´å»ºç«è¿æ¥ï¼ä¾å¦å¨ipv4ç½ç»åipv6ç½ç»ä¹é´å»ºç«è¿æ¥ã\n\n\n# ä½¿ç¨ipipé§éå®ç°è·¨ä¸»æºç½ç»\n\n\n\né¦åå¨node1åå»ºtunè®¾å¤å¹¶è®¾ç½®ä¸ºipipæ¨¡å¼ï¼localè®¾ç½®ä¸ºæ¬å°ipå°å10.65.132.187ï¼remoteè®¾ç½®ä¸ºå¯¹ç«¯ip10.65.132.187ï¼è¿ä¸¤ä¸ªæ¯é§éå¤å±ipï¼ç¶ååè®¾ç½®é§éåå±ipï¼10.10.100.10å°10.10.200.10ã\n\nip tunnel add tun1 mode ipip remote 10.65.132.188 local 10.65.132.187\nip link set tun1 up\nip a add 10.10.100.10 peer 10.10.200.10 dev tun1\n\n\n1\n2\n3\n\n\nå¯ä»¥çå°æ·»å äºä¸æ¡è·¯ç±ï¼åéå°ç®çå°å10.10.200.10çåé½ä¼è½¬åå°tun1è®¾å¤ä¸­\n\n# ip r\n...\n10.10.200.10 dev tun1 proto kernel scope link src 10.10.100.10\n...\n\n\n1\n2\n3\n4\n\n\ntunè®¾å¤ä¼å°è¿å¥çipåå°è£å°ä¸ä¸ªipåä¸­ï¼æºå°åæ¯ä¹åè®¾ç½®çå¤å±local ipï¼èç®çå°åæ¯å¤å±remote ipï¼ç¶ååéè¿è·¯ç±è¾¾å°ä»ens18ç½å¡åºå»å°node2ä¸­ã\n\nå¨node2ä¸åå»ºtunè®¾å¤ï¼éç½®ånode1ä¸æ ·\n\nip tunnel add tun2 mode ipip remote 10.65.132.187 local 10.65.132.188\nip link set tun2 up\nip a add 10.10.200.10 peer 10.10.100.10 dev tun2\n\n\n\n1\n2\n3\n4\n\n\nç¶åå¨node1ä¸ping node2çtunè®¾å¤\n\nping 10.10.200.10 -c 1\n\n\n1\n\n\néè¿tcpdumpå¨node2æåå¦ä¸ï¼\n\n20:16:40.011992 ip 10.65.132.187 > 10.65.132.188: ip 10.10.100.10 > 10.10.200.10: icmp echo request, id 17609, seq 1, length 64 (ipip-proto-4)\n20:16:40.012099 ip 10.65.132.188 > 10.65.132.187: ip 10.10.200.10 > 10.10.100.10: icmp echo reply, id 17609, seq 1, length 64 (ipip-proto-4)\n\n\n1\n2\n\n\næ°æ®åè¾¾å°node2åï¼æ¯ä¸ä¸ªä¸¤å±ipæ°æ®åï¼ä»node2çens18ç½å¡åºæ¥åï¼è§£å°æ°æ®åï¼åç°åå±çç®çipæ¯10.10.200.10ä¹å°±æ¯tun2çå°åï¼ç¶åå°æ°æ®ååå°tun2è®¾å¤ã\n\ntun2è®¾å¤æ¶å°æ°æ®åååæ ¹æ®ä¸é¢ç¸åæ­¥éª¤è¿è¡å°è£æ°æ®åååç»tun1ï¼æç»æ´ä¸ªpingè¿ç¨å®æã\n\nipipé§éæ¯éè¿ipå°åæ¥æ è¯ç½ç»è®¾å¤çï¼æä»¥ä¸éè¦ä½¿ç¨macå°åï¼ç´æ¥éè¿ipå°åå³å¯ãéè¿æ¥çtunè®¾å¤ä¿¡æ¯ï¼å¯ä»¥çå°å¶æ¯ä¸å­å¨macå°åçã\n\n# ip -d link show tun1\n59: tun1@none: <pointopoint,noarp,up,lower_up> mtu 1480 qdisc noqueue state unknown mode default group default qlen 1000\n    link/ipip 10.65.132.187 peer 10.65.132.188 promiscuity 0 minmtu 68 maxmtu 65515 \n    ipip ipip remote 10.65.132.188 local 10.65.132.187 ttl inherit pmtudisc addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 \n\n\n1\n2\n3\n4\n\n\n\n# å·¨äººçè©è\n\n * ãkubernetesç½ç»æå¨æåã\n\nâ",charsets:{cjk:!0},lastUpdated:"2023/05/26, 13:21:02",lastUpdatedTimestamp:1685078462e3},{title:"åç±»",frontmatter:{categoriesPage:!0,title:"åç±»",permalink:"/categories/",article:!1,description:"",meta:[{name:"twitter:title",content:"åç±»"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/@pages/categoriesPage.html"},{property:"og:type",content:"article"},{property:"og:title",content:"åç±»"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/@pages/categoriesPage.html"},{property:"og:site_name",content:"msqfx"},{itemprop:"name",content:"åç±»"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/@pages/categoriesPage.html",relativePath:"@pages/categoriesPage.md",key:"v-7ffecc44",path:"/categories/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2022/08/09, 07:53:30",lastUpdatedTimestamp:166000281e4},{title:"django rest_frameworkä½¿ç¨jwt",frontmatter:{tags:["python","django"],title:"django rest_frameworkä½¿ç¨jwt",date:"2022-08-10T00:00:00.000Z",permalink:"/pages/25eafd/",author:{name:"msqfx",link:"https://github.com/msqfx"},description:"æ¬æä»ç»å¨ django rest_framework ä½¿ç¨jwtè®¤è¯.",feed:{enable:!0},categories:["ç¼ç¨","python","django"],comment:!0,meta:[{name:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604218012751.jpg#alt="},{name:"twitter:title",content:"django rest_frameworkä½¿ç¨jwt"},{name:"twitter:description",content:"æ¬æä»ç»å¨ django rest_framework ä½¿ç¨jwtè®¤è¯."},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604218012751.jpg#alt="},{name:"twitter:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/02.django%20rest_framework%E4%BD%BF%E7%94%A8jwt.html"},{property:"og:type",content:"article"},{property:"og:title",content:"django rest_frameworkä½¿ç¨jwt"},{property:"og:description",content:"æ¬æä»ç»å¨ django rest_framework ä½¿ç¨jwtè®¤è¯."},{property:"og:image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604218012751.jpg#alt="},{property:"og:url",content:"https://www.msqfx.cc/04.%E7%BC%96%E7%A8%8B/01.python/06.django/02.django%20rest_framework%E4%BD%BF%E7%94%A8jwt.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2022-08-10T00:00:00.000Z"},{property:"article:tag",content:"python"},{property:"article:tag",content:"django"},{itemprop:"name",content:"django rest_frameworkä½¿ç¨jwt"},{itemprop:"description",content:"æ¬æä»ç»å¨ django rest_framework ä½¿ç¨jwtè®¤è¯."},{itemprop:"image",content:"https://gcore.jsdelivr.net/gh/msqfx/BLOG-CDN@main/1604218012751.jpg#alt="}],readingShow:"top"},regularPath:"/04.%E7%BC%96%E7%A8%8B/01.python/06.django/02.django%20rest_framework%E4%BD%BF%E7%94%A8jwt.html",relativePath:"04.ç¼ç¨/01.python/06.django/02.django rest_frameworkä½¿ç¨jwt.md",key:"v-25855433",path:"/pages/25eafd/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"ç¸å³é¾æ¥",slug:"ç¸å³é¾æ¥",normalizedTitle:"ç¸å³é¾æ¥",charIndex:113},{level:2,title:"jwt è®¤è¯æµç¨",slug:"jwt-è®¤è¯æµç¨",normalizedTitle:"jwt è®¤è¯æµç¨",charIndex:126},{level:2,title:"ä½¿ç¨",slug:"ä½¿ç¨",normalizedTitle:"ä½¿ç¨",charIndex:34}],headersStr:"ç®ä» ç¸å³é¾æ¥ jwt è®¤è¯æµç¨ ä½¿ç¨",content:"# ç®ä»\n\næ¬æä»ç»å¨ django rest_framework ä½¿ç¨jwtè®¤è¯.\n\njwt ä¸æ¯ rest_frameworkèªå¸¦çè®¤è¯æ¹å¼ï¼éè¦éè¿ç¬¬ä¸æ¹åºdjangorestframework-jwtç»åä½¿ç¨\n\n\n# ç¸å³é¾æ¥\n\nå®ç½\n\n\n# jwt è®¤è¯æµç¨\n\n\n\n\n# ä½¿ç¨\n\n 0. å®è£djangorestframework-jwt\n\n> pip install djangorestframework-jwt\n\n 1. æ·»å è·åtokençè·¯ç±\n\nfrom rest_framework_jwt.views import obtain_jwt_token\n\nurlpatterns = [\n    re_path(r'^api-token-auth/', obtain_jwt_token),\n]\n\n\n1\n2\n3\n4\n5\n\n 2. å¨å±æ·»å è®¤è¯ãå°jwt authenticationç±»æ³¨å¥å°æ¡æ¶ä¸­\n\nè®¿é®ä»»ä½çè·¯ç±é½ä¼ä½¿ç¨JSONWebTokenAuthentication.authenticateè¿è¡è®¤è¯.\n\nsettings.py\n\nREST_FRAMEWORK = {\n    'DEFAULT_AUTHENTICATION_CLASSES': [\n        'rest_framework_jwt.authentication.JSONWebTokenAuthentication',\n    ]\n\n\n1\n2\n3\n4\n\n 3. å±é¨æ·»å è®¤è¯ï¼å¨APIViewä¸­æ·»å è®¤è¯ç±».\n\næ¯æ¬¡è®¿é®è¯¥è§å¾æ¶ï¼é½ä¼è°ç¨JSONWebTokenAuthentication.authenticate è¿è¡è®¤è¯.\n\nclass TestView(APIView):\n    authentication_classes = (JSONWebTokenAuthentication,)\n\n    def get(self, *args, **kwargs):\n        return HttpResponse(self.request.user)\n\n\n1\n2\n3\n4\n5\n\n 4. è®¾ç½®\n\nsettings.py\n\n\nJWT_AUTH = {\n    'JWT_EXPIRATION_DELTA': datetime.timedelta(minutes=30),   # è¿ææ¶é´\n    'JWT_RESPONSE_PAYLOAD_HANDLER': 'user.utils.jwt_response_payload_handler'    # é»è®¤è¿åçä»æ`token`å­æ®µï¼å¯ä»¥ç±èªå·±ä¿®æ¹è¿åçæ°æ®ï¼å¯ä»¥åå«user.idåuser.username   \n}\n\n\n1\n2\n3\n4\n5\n",normalizedContent:"# ç®ä»\n\næ¬æä»ç»å¨ django rest_framework ä½¿ç¨jwtè®¤è¯.\n\njwt ä¸æ¯ rest_frameworkèªå¸¦çè®¤è¯æ¹å¼ï¼éè¦éè¿ç¬¬ä¸æ¹åºdjangorestframework-jwtç»åä½¿ç¨\n\n\n# ç¸å³é¾æ¥\n\nå®ç½\n\n\n# jwt è®¤è¯æµç¨\n\n\n\n\n# ä½¿ç¨\n\n 0. å®è£djangorestframework-jwt\n\n> pip install djangorestframework-jwt\n\n 1. æ·»å è·åtokençè·¯ç±\n\nfrom rest_framework_jwt.views import obtain_jwt_token\n\nurlpatterns = [\n    re_path(r'^api-token-auth/', obtain_jwt_token),\n]\n\n\n1\n2\n3\n4\n5\n\n 2. å¨å±æ·»å è®¤è¯ãå°jwt authenticationç±»æ³¨å¥å°æ¡æ¶ä¸­\n\nè®¿é®ä»»ä½çè·¯ç±é½ä¼ä½¿ç¨jsonwebtokenauthentication.authenticateè¿è¡è®¤è¯.\n\nsettings.py\n\nrest_framework = {\n    'default_authentication_classes': [\n        'rest_framework_jwt.authentication.jsonwebtokenauthentication',\n    ]\n\n\n1\n2\n3\n4\n\n 3. å±é¨æ·»å è®¤è¯ï¼å¨apiviewä¸­æ·»å è®¤è¯ç±».\n\næ¯æ¬¡è®¿é®è¯¥è§å¾æ¶ï¼é½ä¼è°ç¨jsonwebtokenauthentication.authenticate è¿è¡è®¤è¯.\n\nclass testview(apiview):\n    authentication_classes = (jsonwebtokenauthentication,)\n\n    def get(self, *args, **kwargs):\n        return httpresponse(self.request.user)\n\n\n1\n2\n3\n4\n5\n\n 4. è®¾ç½®\n\nsettings.py\n\n\njwt_auth = {\n    'jwt_expiration_delta': datetime.timedelta(minutes=30),   # è¿ææ¶é´\n    'jwt_response_payload_handler': 'user.utils.jwt_response_payload_handler'    # é»è®¤è¿åçä»æ`token`å­æ®µï¼å¯ä»¥ç±èªå·±ä¿®æ¹è¿åçæ°æ®ï¼å¯ä»¥åå«user.idåuser.username   \n}\n\n\n1\n2\n3\n4\n5\n",charsets:{cjk:!0},lastUpdated:"2023/05/01, 18:02:43",lastUpdatedTimestamp:1682935363e3},{title:"ç½ç«",frontmatter:{title:"ç½ç«",permalink:"/pages/beb6c0bd8a66cea6/",date:"2020-04-19T11:33:04.000Z",article:!1,author:{name:"xugaoyi",link:"https://github.com/xugaoyi"},description:"k8s k8sä¸­æå®ç½\nvuepress-theme-vdoing ä¸æ¬¾ä¼ç§çåå®¢ä¸»é¢\nææ¯æç« æå½\nä»£ç çæ®µ å¿«éæ¥çæä¸é¨ææ¯çä»£ç çæ®µ",comment:!0,meta:[{name:"twitter:title",content:"ç½ç«"},{name:"twitter:description",content:"k8s k8sä¸­æå®ç½\nvuepress-theme-vdoing ä¸æ¬¾ä¼ç§çåå®¢ä¸»é¢\nææ¯æç« æå½\nä»£ç çæ®µ å¿«éæ¥çæä¸é¨ææ¯çä»£ç çæ®µ"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/09.%E6%9B%B4%E5%A4%9A/01.%E6%94%B6%E8%97%8F.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ç½ç«"},{property:"og:description",content:"k8s k8sä¸­æå®ç½\nvuepress-theme-vdoing ä¸æ¬¾ä¼ç§çåå®¢ä¸»é¢\nææ¯æç« æå½\nä»£ç çæ®µ å¿«éæ¥çæä¸é¨ææ¯çä»£ç çæ®µ"},{property:"og:url",content:"https://www.msqfx.cc/09.%E6%9B%B4%E5%A4%9A/01.%E6%94%B6%E8%97%8F.html"},{property:"og:site_name",content:"msqfx"},{property:"article:published_time",content:"2020-04-19T11:33:04.000Z"},{itemprop:"name",content:"ç½ç«"},{itemprop:"description",content:"k8s k8sä¸­æå®ç½\nvuepress-theme-vdoing ä¸æ¬¾ä¼ç§çåå®¢ä¸»é¢\nææ¯æç« æå½\nä»£ç çæ®µ å¿«éæ¥çæä¸é¨ææ¯çä»£ç çæ®µ"}],readingShow:"top"},regularPath:"/09.%E6%9B%B4%E5%A4%9A/01.%E6%94%B6%E8%97%8F.html",relativePath:"09.æ´å¤/01.æ¶è.md",key:"v-8d4bc20e",path:"/pages/beb6c0bd8a66cea6/",headers:[{level:2,title:"ææ¡£",slug:"ææ¡£",normalizedTitle:"ææ¡£",charIndex:12},{level:2,title:"golang",slug:"golang",normalizedTitle:"golang",charIndex:103},{level:2,title:"åå®¢",slug:"åå®¢",normalizedTitle:"åå®¢",charIndex:61},{level:2,title:"ç¤¾åº",slug:"ç¤¾åº",normalizedTitle:"ç¤¾åº",charIndex:324},{level:2,title:"æå·§",slug:"æå·§",normalizedTitle:"æå·§",charIndex:476},{level:2,title:"è§é¢",slug:"è§é¢",normalizedTitle:"è§é¢",charIndex:564},{level:2,title:"ç®æ³",slug:"ç®æ³",normalizedTitle:"ç®æ³",charIndex:727},{level:2,title:"å·¥å·",slug:"å·¥å·",normalizedTitle:"å·¥å·",charIndex:747},{level:2,title:"å¨±ä¹",slug:"å¨±ä¹",normalizedTitle:"å¨±ä¹",charIndex:886}],headersStr:"ææ¡£ golang åå®¢ ç¤¾åº æå·§ è§é¢ ç®æ³ å·¥å· å¨±ä¹",content:"# ä¸ªäººæ¶èå¤¹\n\n\n# ææ¡£\n\n * k8s k8sä¸­æå®ç½\n * vuepress-theme-vdoing ä¸æ¬¾ä¼ç§çåå®¢ä¸»é¢\n * ææ¯æç« æå½\n * ä»£ç çæ®µ å¿«éæ¥çæä¸é¨ææ¯çä»£ç çæ®µ\n\n\n# golang\n\n * hotexamples golangä»£ç ç¤ºä¾ç½ç«\n\n\n# åå®¢\n\n * é®ä¸å³°çç½ç»æ¥å¿\n * é¦ä¸ä¸çææ¯ä¸æ \n * ITç å\n * æå¥\n * å´åºæ\n * é·å£³\n * çç»ç§-DKåå®¢\n * äºä¸«è®²æ¢µ\n * Crayonã®åå®¢\n * Tushar's Blog ä¸ä¸ªå½å¤pythonç¨åºåçåå®¢ï¼æè§ä¸é\n * åæ¢äºåç\n * simpleprogrammer ãè½¯æè½-ä»£ç ä¹å¤ççå­æåãä½èçåå®¢\n\n\n# ç¤¾åº\n\n * Github ç¨åºååæ§äº¤åç¤¾åº\n * æé ä¸ä¸ªå¸®å©å¼åèæé¿çç¤¾åº\n * ç®ä¹¦ æå¾å¤é¢éçåä½ç¤¾åº\n * æå¦ è§£å³ææ¯é®é¢çç¤¾åº\n * stack overflow åä¸ï¼å¤ç½ç\n * InfoQ ä¿è¿è½¯ä»¶å¼ååç¸å³é¢åç¥è¯ä¸åæ°çä¼ æ­\n * V2EX åæå·¥ä½èä»¬çç¤¾åº\n\n\n# æå·§\n\n * Google è¶å¿ æ¥çæé¡¹ææ¯æå³é®å­çç­åº¦è¶å¿ï¼å¯ç¨äºåææé¡¹ææ¯çåå±åæ¯ï¼æå¯¹æ¯æä¸¤é¡¹ææ¯çç­åº¦ã\n * ç¾åº¦ææ° åä¸ï¼ä½ç¾åº¦çæ°æ®ä»éå½åã\n\n\n# è§é¢\n\n * bilibili Bç«ï¼ä¸é¢å¾å¤åè´¹æå­¦è§é¢\n * æè¯¾ç½ å®æè§é¢æç¨\n * å¦å³è¯¾å  æ¯è¾ç³»ç»çåç«¯å¥é¨è§é¢æç¨\n * ä¸­å½å¤§å­¦MOOC æ¶µçè®¡ç®æºãå¤è¯­ãå¿çå­¦ç­ä¸ä¸åè´¹è¯¾ç¨\n * ç»èº«æè²å¹³å° æ¶µççæ´»ãå´è¶£ãèåºãæè½ãèå¹´ãå­¦åç­åè´¹è¯¾ç¨\n * egghead è´¨éè¿ä¸éçç­è§é¢æç¨ï¼å¤ç½\n\n\n# ç®æ³\n\n * leetcode\n\n\n# å·¥å·\n\n * å¾®ä¿¡markdownç¼è¾å¨\n * ossinsight å¯ä»¥çå°githubä¸ç¨æ·æèä»åºçæ°æ®ææ \n * feeddd å¾®ä¿¡å¬ä¼å·çRSSè®¢éæº\n * ChatGPT èå¤©æºè½AIæå¡ï¼å¯ä»¥èªå¨åä»£ç ã\n * corrector ä¸æ¬¾åè´¹çä¸­æçº éæå¡\n\n\n# å¨±ä¹\n\n * ä¸­ææ­å®¢æ¦\n * å¼å¸¸æç¨ å·¥å·ç ´è§£ç½ç«",normalizedContent:"# ä¸ªäººæ¶èå¤¹\n\n\n# ææ¡£\n\n * k8s k8sä¸­æå®ç½\n * vuepress-theme-vdoing ä¸æ¬¾ä¼ç§çåå®¢ä¸»é¢\n * ææ¯æç« æå½\n * ä»£ç çæ®µ å¿«éæ¥çæä¸é¨ææ¯çä»£ç çæ®µ\n\n\n# golang\n\n * hotexamples golangä»£ç ç¤ºä¾ç½ç«\n\n\n# åå®¢\n\n * é®ä¸å³°çç½ç»æ¥å¿\n * é¦ä¸ä¸çææ¯ä¸æ \n * itç å\n * æå¥\n * å´åºæ\n * é·å£³\n * çç»ç§-dkåå®¢\n * äºä¸«è®²æ¢µ\n * crayonã®åå®¢\n * tushar's blog ä¸ä¸ªå½å¤pythonç¨åºåçåå®¢ï¼æè§ä¸é\n * åæ¢äºåç\n * simpleprogrammer ãè½¯æè½-ä»£ç ä¹å¤ççå­æåãä½èçåå®¢\n\n\n# ç¤¾åº\n\n * github ç¨åºååæ§äº¤åç¤¾åº\n * æé ä¸ä¸ªå¸®å©å¼åèæé¿çç¤¾åº\n * ç®ä¹¦ æå¾å¤é¢éçåä½ç¤¾åº\n * æå¦ è§£å³ææ¯é®é¢çç¤¾åº\n * stack overflow åä¸ï¼å¤ç½ç\n * infoq ä¿è¿è½¯ä»¶å¼ååç¸å³é¢åç¥è¯ä¸åæ°çä¼ æ­\n * v2ex åæå·¥ä½èä»¬çç¤¾åº\n\n\n# æå·§\n\n * google è¶å¿ æ¥çæé¡¹ææ¯æå³é®å­çç­åº¦è¶å¿ï¼å¯ç¨äºåææé¡¹ææ¯çåå±åæ¯ï¼æå¯¹æ¯æä¸¤é¡¹ææ¯çç­åº¦ã\n * ç¾åº¦ææ° åä¸ï¼ä½ç¾åº¦çæ°æ®ä»éå½åã\n\n\n# è§é¢\n\n * bilibili bç«ï¼ä¸é¢å¾å¤åè´¹æå­¦è§é¢\n * æè¯¾ç½ å®æè§é¢æç¨\n * å¦å³è¯¾å  æ¯è¾ç³»ç»çåç«¯å¥é¨è§é¢æç¨\n * ä¸­å½å¤§å­¦mooc æ¶µçè®¡ç®æºãå¤è¯­ãå¿çå­¦ç­ä¸ä¸åè´¹è¯¾ç¨\n * ç»èº«æè²å¹³å° æ¶µççæ´»ãå´è¶£ãèåºãæè½ãèå¹´ãå­¦åç­åè´¹è¯¾ç¨\n * egghead è´¨éè¿ä¸éçç­è§é¢æç¨ï¼å¤ç½\n\n\n# ç®æ³\n\n * leetcode\n\n\n# å·¥å·\n\n * å¾®ä¿¡markdownç¼è¾å¨\n * ossinsight å¯ä»¥çå°githubä¸ç¨æ·æèä»åºçæ°æ®ææ \n * feeddd å¾®ä¿¡å¬ä¼å·çrssè®¢éæº\n * chatgpt èå¤©æºè½aiæå¡ï¼å¯ä»¥èªå¨åä»£ç ã\n * corrector ä¸æ¬¾åè´¹çä¸­æçº éæå¡\n\n\n# å¨±ä¹\n\n * ä¸­ææ­å®¢æ¦\n * å¼å¸¸æç¨ å·¥å·ç ´è§£ç½ç«",charsets:{cjk:!0},lastUpdated:"2023/02/17, 11:48:27",lastUpdatedTimestamp:1676605707e3},{title:"å½æ¡£",frontmatter:{archivesPage:!0,title:"å½æ¡£",permalink:"/archives/",article:!1,description:"",meta:[{name:"twitter:title",content:"å½æ¡£"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/@pages/archivesPage.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å½æ¡£"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/@pages/archivesPage.html"},{property:"og:site_name",content:"msqfx"},{itemprop:"name",content:"å½æ¡£"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/@pages/archivesPage.html",relativePath:"@pages/archivesPage.md",key:"v-6cd702fe",path:"/archives/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2022/08/09, 07:53:30",lastUpdatedTimestamp:166000281e4},{title:"æ ç­¾",frontmatter:{tagsPage:!0,title:"æ ç­¾",permalink:"/tags/",article:!1,description:"",meta:[{name:"twitter:title",content:"æ ç­¾"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://www.msqfx.cc/@pages/tagsPage.html"},{property:"og:type",content:"article"},{property:"og:title",content:"æ ç­¾"},{property:"og:description",content:""},{property:"og:url",content:"https://www.msqfx.cc/@pages/tagsPage.html"},{property:"og:site_name",content:"msqfx"},{itemprop:"name",content:"æ ç­¾"},{itemprop:"description",content:""}],readingShow:"top"},regularPath:"/@pages/tagsPage.html",relativePath:"@pages/tagsPage.md",key:"v-16e3f17e",path:"/tags/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2022/08/09, 07:53:30",lastUpdatedTimestamp:166000281e4}],themeConfig:{nav:[{text:"é¦é¡µ",link:"/"},{text:"java",link:"/java/",items:[{text:"åºç¡ç¯",link:"/pages/11aacc/"},{text:"éåç¯",link:"/pages/2e780e/"},{text:"å¹¶åç¯",link:"/pages/846d88/"},{text:"JVM",link:"/pages/562a37/"}]},{text:"ç¼ç¨",link:"/code/",items:[{text:"pythonä¹è·¯",link:"/python/"},{text:"goä¹è·¯",link:"/go/"},{text:"linux",link:"/linux/"},{text:"å¶ä»",link:"/pages/19cfb6/"}]},{text:"ä¸­é´ä»¶",link:"/middleware/",items:[{text:"kafka",link:"/kafka/"},{text:"mysql",link:"/mysql/"},{text:"redis",link:"/redis/"}]},{text:"äºåç",link:"/CloudNative/",items:[{text:"docker",link:"/docker/"},{text:"k8s",link:"/k8s/"}]},{text:"è¯»ä¹¦ç ´ä¸å·",link:"/readbook/"},{text:"å³äº",link:"/about/"},{text:"æçå·¥å·",items:[{text:"jsonæ ¼å¼å",link:"https://www.json.cn/"},{text:"ä»£ç çæ®µ",link:"https://ref.zhengwenfeng.com/"},{text:"ngéç½®æ ¼å¼å",link:"https://www.dute.org/nginx-config-formatter/"},{text:"cornè¡¨è¾¾å¼",link:"https://www.pppet.net/"}]},{text:"æ´å¤",link:"/more/",items:[{text:"æ¶è",link:"/pages/beb6c0bd8a66cea6/"},{text:"åé¾",link:"/friends/"},{text:"å¤é¨é¡µé¢",items:[{text:"å¼å¾",link:"https://www.travellings.cn/go.html"}]},{text:"ç´¢å¼",link:"/archives/",items:[{text:"åç±»",link:"/categories/"},{text:"æ ç­¾",link:"/tags/"},{text:"å½æ¡£",link:"/archives/"}]}]}],sidebarDepth:2,logo:"/img/me.jpg",repo:"msqfx/msqfx.github.io",searchMaxSuggestions:10,lastUpdated:"ä¸æ¬¡æ´æ°",docsDir:"docs",editLinks:!1,searchPlaceholder:"æä¸ ðº æç´¢",sidebar:{"/00.ç®å½/":[["01.pythonä¹è·¯.md","pythonä¹è·¯","/python/"],["02.goä¹è·¯.md","goä¹è·¯","/go/"],["03.ç¼ç¨.md","ç¼ç¨","/code/"],["04.k8s.md","k8s","/k8s/"],["05.redis.md","redis","/redis/"],["06.mysql.md","mysql","/mysql/"],["07.è¯»ä¹¦ç ´ä¸å·.md","è¯»ä¹¦ç ´ä¸å·","/readbook/"],["08.äºåç.md","äºåç","/CloudNative/"],["10.docker.md","docker","/docker/"],["12.kafka.md","kafka","/kafka/"],["13.ä¸­é´ä»¶.md","ä¸­é´ä»¶","/middleware/"],["14.linux.md","linux","/linux/"],["100.æ´å¤.md","æ´å¤","/more"]],catalogue:{java:"/","pythonä¹è·¯":"/python/","goä¹è·¯":"/go/","ç¼ç¨":"/code/",k8s:"/k8s/",redis:"/redis/",mysql:"/mysql/","è¯»ä¹¦ç ´ä¸å·":"/readbook/","äºåç":"/CloudNative/",docker:"/docker/","æ´å¤":"/more",kafka:"/kafka/","ä¸­é´ä»¶":"/middleware/",linux:"/linux/"},"/01.java/":[{title:"åºç¡ç¯",collapsable:!0,children:[["01.åºç¡ç¯/01.Javaåºç¡å°ç».md","Javaåºç¡å°ç»","/pages/11aacc/"],["01.åºç¡ç¯/02.Javaåºæ¬æ°æ®ç±»å.md","Javaåºæ¬æ°æ®ç±»å","/pages/b3eb48/"]]},{title:"éåç¯",collapsable:!0,children:[["02.éåç¯/01.Javaéåæ¦è¿°.md","Javaéåæ¦è¿°","/pages/2e780e/"],["02.éåç¯/02.Listæ¥å£.md","Listæ¥å£","/pages/dcfa33/"],["02.éåç¯/03.Setæ¥å£.md","Setæ¥å£","/pages/4d8b8b/"],["02.éåç¯/04.Queueæ¥å£.md","Queueæ¥å£","/pages/887881/"],["02.éåç¯/05.Mapæ¥å£.md","Mapæ¥å£","/pages/4c1680/"]]},{title:"å¹¶åç¯",collapsable:!0,children:[["03.å¹¶åç¯/01.Javaå¹¶ååºç¡å°ç».md","Javaå¹¶ååºç¡å°ç»","/pages/846d88/"],["03.å¹¶åç¯/02.éè¯¦è§£.md","éè¯¦è§£","/pages/5a6aca/"],["03.å¹¶åç¯/03.SynchronizedåVolatileçä½¿ç¨ä¸åºå«.md","SynchronizedåVolatileçä½¿ç¨ä¸åºå«","/pages/e19c5d/"],["03.å¹¶åç¯/04.çº¿ç¨æ± è¯¦è§£.md","çº¿ç¨æ± è¯¦è§£","/pages/040070/"],["03.å¹¶åç¯/05.CompletableFutureå­¦ä¹ .md","CompletableFutureå­¦ä¹ ","/pages/f6a447/"],["03.å¹¶åç¯/10.Javaåå­ç®¡çæ»ç».md","Javaåå­ç®¡çæ»ç»","/pages/277c5b/"]]},{title:"JVM",collapsable:!0,children:[["04.JVM/01.JVMåºç¡å¥é¨.md","JVMåºç¡å¥é¨","/pages/562a37/"],["04.JVM/02.JVMå¸¸é®.md","JVMå¸¸é®","/pages/ff3623/"]]}],"/01.äºåç/":[{title:"docker",collapsable:!0,children:[["06.docker/01.å®¹å¨çæ¬è´¨.md","å®¹å¨çæ¬è´¨","/pages/f3cf17/"],["06.docker/02.dockerå®¹å¨.md","dockerå®¹å¨","/pages/39f36e/"],["06.docker/03.æå¨å®ç°dockerå®¹å¨bridgeç½ç»æ¨¡å.md","æå¨å®ç°dockerå®¹å¨bridgeç½ç»æ¨¡å","/pages/d3768c/"],["06.docker/04.dockerå®¹å¨åæºç½ç».md","dockerå®¹å¨åæºç½ç»","/pages/0ddeb7/"]]},{title:"k8s",collapsable:!0,children:[["07.k8s/03.k8sä¹pod.md","k8sä¹Pod","/pages/2b547f/"],["07.k8s/04.k8sä¹deployment.md","k8sä¹Deployment","/pages/d73c88/"],["07.k8s/05.k8sä¹service.md","k8sä¹Service","/pages/1f860b/"],["07.k8s/06.k8sä¹ConfigMapåSecret.md","k8sä¹ConfigMapåSecret","/pages/ff8188/"],["07.k8s/07.k8sä¹JobåCronJob.md","k8sä¹JobåCronJob","/pages/c96905/"],["07.k8s/08.k8sä¹DaemonSet.md","k8sä¹DaemonSet","/pages/92bee4/"],["07.k8s/09.k8sä¹PVãPVCåStorageClass.md","k8sä¹PVãPVCåStorageClass","/pages/095c75/"],["07.k8s/10.k8sä¹StatefulSet.md","k8sä¹StatefulSet","/pages/d178a2/"],["07.k8s/11.ä½¿ç¨kubeadmå®è£k8s.md","ä½¿ç¨kubeadmå®è£k8s","/pages/9e17c8/"],["07.k8s/12.podä¸­å°ä»£ç ä¸è¿è¡ç¯å¢åç¦».md","podä¸­å°ä»£ç ä¸è¿è¡ç¯å¢åç¦»","/pages/27987d/"],["07.k8s/13.djangoåç«¯æå¡ãlogstashåflinkæ¥å¥VictoriaMetricsææ çæ§.md","djangoåç«¯æå¡ãlogstashåflinkæ¥å¥VictoriaMetricsææ çæ§","/pages/b1b4a3/"],["07.k8s/14.çè§£flannelçä¸ç§å®¹å¨ç½ç»æ¹æ¡åç.md","çè§£flannelçä¸ç§å®¹å¨ç½ç»æ¹æ¡åç","/pages/d9d0ce/"],["07.k8s/15.çè§£calicoå®¹å¨ç½ç»éä¿¡æ¹æ¡åç.md","çè§£calicoå®¹å¨ç½ç»éä¿¡æ¹æ¡åç","/pages/f0f725/"],["07.k8s/16.kubernetes serviceå¦ä½éè¿iptablesè½¬å.md","kubernetes serviceå¦ä½éè¿iptablesè½¬å","/pages/b3955c/"],["07.k8s/17.kube-proxyæºç åæ.md","kube-proxyæºç åæ","/pages/6e0045/"]]}],"/03.ä¸­é´ä»¶/":[{title:"kafka",collapsable:!0,children:[["01.kafka/01.listeneråadvertised.listenersçä½ç¨.md","kafkaä¸­listeneråadvertised.listenersçä½ç¨","/pages/fa114f/"]]},{title:"mysql",collapsable:!0,children:[["03.mysql/01.mysqlä¹æ¥å¿.md","mysqlä¹æ¥å¿","/pages/2d69c7/"],["03.mysql/02.mysqlä¹MVCCåç.md","mysqlä¹MVCCåç","/pages/0d8f4a/"]]},{title:"redis",collapsable:!0,children:[["05.redis/01.redisä¹äºç§åºæ¬æ°æ®ç±»å.md","redisä¹äºç§åºæ¬æ°æ®ç±»å","/pages/2bbeb3/"],["05.redis/02.redisä¹æä¹å.md","redisä¹æä¹å","/pages/4c6b13/"],["05.redis/03. redisä¹ä¸»ä»åºåæ­¥.md","redisä¹ä¸»ä»åºåæ­¥","/pages/8072eb/"],["05.redis/04. redisä¹å¨åµæºå¶.md","redisä¹å¨åµæºå¶","/pages/ffee9e/"],["05.redis/05. redisä¹åçéç¾¤.md","redisä¹åçéç¾¤","/pages/1c2914/"],["05.redis/06. redisä¹ç¼å­.md","redisä¹ç¼å­","/pages/0d7b25/"]]}],"/04.ç¼ç¨/":[{title:"python",collapsable:!0,children:[{title:"åºç¡",collapsable:!0,children:[["01.python/01.åºç¡/01.pythonè¿­ä»£å¨ä¸çæå¨.md","pythonè¿­ä»£å¨ä¸çæå¨","/pages/e31b06/"],["01.python/01.åºç¡/02.pythonåç¼ç¨.md","pythonåç¼ç¨","/pages/5fa368/"],["01.python/01.åºç¡/03.pythonåå¾åæ¶æºå¶.md","pythonåå¾åæ¶æºå¶","/pages/78c648/"],["01.python/01.åºç¡/04.pythonä¸ä¸æç®¡çå¨.md","pythonä¸ä¸æç®¡çå¨","/pages/a6b804/"],["01.python/01.åºç¡/05.pythonè£é¥°å¨çä½¿ç¨æ¹æ³.md","pythonè£é¥°å¨çä½¿ç¨æ¹æ³","/pages/7434f1/"],["01.python/01.åºç¡/06.ä½¿ç¨pythonå®ç°åä¾æ¨¡å¼çä¸ç§æ¹å¼.md","ä½¿ç¨pythonå®ç°åä¾æ¨¡å¼çä¸ç§æ¹å¼","/pages/33b8d0/"],["01.python/01.åºç¡/07.pythonä¸­importåç.md","pythonä¸­importåç","/pages/d8fd49/"]]},{title:"ç¬¬ä¸æ¹åº",collapsable:!0,children:[["01.python/02.ç¬¬ä¸æ¹åº/01.ä½¿ç¨ddtå®ç°unittestçåæ°åæµè¯.md","ä½¿ç¨ddtå®ç°unittestçåæ°åæµè¯","/pages/8d9ab9/"],["01.python/02.ç¬¬ä¸æ¹åº/02.ddtæºç åæ.md","ddtæºç åæ","/pages/069c65/"],["01.python/02.ç¬¬ä¸æ¹åº/03.django-apscheduleå®æ¶ä»»å¡å¼å¸¸åæ­¢.md","django-apscheduleå®æ¶ä»»å¡å¼å¸¸åæ­¢","/pages/ec5110/"]]},{title:"django",collapsable:!0,children:[["01.python/06.django/01.django celery ç»åä½¿ç¨.md","django celery ç»åä½¿ç¨","/pages/853501/"],["01.python/06.django/02.django rest_frameworkä½¿ç¨jwt.md","django rest_frameworkä½¿ç¨jwt","/pages/25eafd/"],["01.python/06.django/03.django rest_framework Authentication.md","django rest_framework Authentication","/pages/626675/"],["01.python/06.django/04.django rest_frameworkå¼å¸¸å¤ç.md","django rest_frameworkå¼å¸¸å¤ç","/pages/070fec/"],["01.python/06.django/05.django rest_framework èªå®ä¹ææ¡£.md","django rest_framework èªå®ä¹ææ¡£","/pages/c3af6a/"],["01.python/06.django/06.djangoåç¼©æä»¶ä¸è½½.md","djangoåç¼©æä»¶ä¸è½½","/pages/f2738b/"],["01.python/06.django/07.django rest_frameworkä½¿ç¨pytestååæµè¯.md","django rest_frameworkä½¿ç¨pytestååæµè¯","/pages/c28126/"],["01.python/06.django/08.django restframework choice èªå®ä¹è¾åºæ°æ®.md","django restframework choice èªå®ä¹è¾åºæ°æ®","/pages/b90015/"],["01.python/06.django/09.django Filtering ä½¿ç¨.md","django Filtering ä½¿ç¨","/pages/cfdb5f/"],["01.python/06.django/10.django viewset å Router éåä½¿ç¨æ¶æ¥çé.md","django viewset å Router éåä½¿ç¨æ¶æ¥çé","/pages/e75ceb/"],["01.python/06.django/11.django modelçåºåå.md","django modelçåºåå","/pages/acdd50/"],["01.python/06.django/12.djangoä¸­ä½¿ç¨AbStractUser.md","djangoä¸­ä½¿ç¨AbStractUser","/pages/382755/"],["01.python/06.django/13.django.core.exceptions.ImproperlyConfigured Application labels aren't unique, duplicates users.md","django.core.exceptions.ImproperlyConfigured Application labels aren't unique, duplicates users","/pages/060c51/"],["01.python/06.django/14.django ä¸­ mediaéç½®.md","django ä¸­ mediaéç½®","/pages/de01e2/"],["01.python/06.django/15.django å¤é®å¼ç¨èªèº«åon_deleteåæ°.md","django å¤é®å¼ç¨èªèº«åon_deleteåæ°","/pages/b422bd/"],["01.python/06.django/16.django è­¦å while time zone support is active.md","django è­¦å while time zone support is active","/pages/f0d816/"],["01.python/06.django/17.django rest_framework åé¡µ.md","django rest_framework åé¡µ","/pages/cb262f/"]]},{title:"flask",collapsable:!0,children:[["01.python/07.flask/01.Flaskä½¿ç¨flask_socketioå®ç°websocket.md","Flaskä½¿ç¨flask_socketioå®ç°websocket","/pages/b71dc2/"],["01.python/07.flask/02.flaskç»åmongo.md","flaskç»åmongo","/pages/c59edf/"]]},{title:"tornado",collapsable:!0,children:[["01.python/08.tornado/01.tornado æä»¶ä¸ä¼ .md","tornado æä»¶ä¸ä¼ ","/pages/4c38f5/"],["01.python/08.tornado/02.tornado ä½¿ç¨jwtå®æç¨æ·å¼æ­¥è®¤è¯.md","tornado ä½¿ç¨jwtå®æç¨æ·å¼æ­¥è®¤è¯","/pages/c24905/"],["01.python/08.tornado/03.tornado ç¨æ·å¯ç  bcryptå å¯.md","tornado ç¨æ·å¯ç  bcryptå å¯","/pages/22f35b/"],["01.python/08.tornado/04.tornado ç»åwtformsä½¿ç¨è¡¨åæä½.md","tornado ç»åwtformsä½¿ç¨è¡¨åæä½","/pages/7ac01f/"],["01.python/08.tornado/05.tornado finishåwriteåºå«.md","tornado finishåwriteåºå«","/pages/d18657/"],["01.python/08.tornado/06.tornado ä½¿ç¨peewee-async å®æå¼æ­¥ormæ°æ®åºæä½.md","tornado ä½¿ç¨peewee-async å®æå¼æ­¥ormæ°æ®åºæä½","/pages/113ab1/"]]},{title:"å¶ä»",collapsable:!0,children:[["01.python/09.å¶ä»/01.pythonç®åä½¿ç¨grpc.md","pythonç®åä½¿ç¨grpc","/pages/f9d78c/"],["01.python/09.å¶ä»/02.pyspark streamingç®ä» å æ¶è´¹ kafkaç¤ºä¾.md","pyspark streamingç®ä» å æ¶è´¹ kafkaç¤ºä¾","/pages/72664a/"]]}]},{title:"go",collapsable:!0,children:[["02.go/01.goç®åä½¿ç¨grpc.md","goç®åä½¿ç¨grpc","/pages/87014e/"],["02.go/02. ginä¸­validatoræ¨¡åçæºç åæ.md","ginä¸­validatoræ¨¡åçæºç åæ","/pages/c41003/"],["02.go/03.ä¼åginè¡¨åçéè¯¯æç¤ºä¿¡æ¯.md","ä¼åginè¡¨åçéè¯¯æç¤ºä¿¡æ¯","/pages/cf9a4d/"],["02.go/04.goä¸­å¦ä½å¤çerror.md","goä¸­å¦ä½å¤çerror","/pages/d93df5/"],["02.go/05.tcpç¼å­å¼èµ·çæ¥å¿ä¸¢å¤±.md","tcpç¼å­å¼èµ·çæ¥å¿ä¸¢å¤±","/pages/36b0b2/"]]},{title:"linux",collapsable:!0,children:[["03.linux/01.å¿«éäºè§£iptables.md","å¿«éäºè§£iptables","/pages/72ba9a/"],["03.linux/02.çè§£Linux TunTapè®¾å¤.md","çè§£Linux TunTapè®¾å¤","/pages/143447/"],["03.linux/03.çè§£VXLANç½ç».md","çè§£VXLANç½ç»","/pages/8a4b28/"],["03.linux/04.çè§£Linux IPIPé§é.md","çè§£Linux IPIPé§é","/pages/c128e7/"]]},{title:"å¶ä»",collapsable:!0,children:[["09.å¶ä»/01.åå¸å¼é.md","åå¸å¼é","/pages/d91dfb/"],["09.å¶ä»/02.ä½¿ç¨hueåå»ºozzieçpyspark action workflow.md","ä½¿ç¨hueåå»ºozzieçpyspark action workflow","/pages/aba491/"],["09.å¶ä»/03.ä½¿ç¨javaå¼ålogstashçfilteræä»¶.md","ä½¿ç¨javaå¼ålogstashçfilteræä»¶","/pages/7f16f6/"],["09.å¶ä»/20.countçæ§è½ä¼å.md","countçæ§è½ä¼å","/pages/19cfb6/"]]}],"/05.è¯»ä¹¦ç ´ä¸å·/":[["01.å¦ä½éè¯»ä¸æ¬ä¹¦.md","è¯»ä¹¦ç¬è®°:å¦ä½éè¯»ä¸æ¬ä¹¦","/pages/8bdb8d/"]],"/08.å³äº/":[["01.å³äº.md","å³äº","/about/"]],"/09.æ´å¤/":[["01.æ¶è.md","ç½ç«","/pages/beb6c0bd8a66cea6/"],["02.åé¾.md","åé¾","/friends"]]},author:{name:"zhengwenfeng",link:"https://github.com/msqfx"},blogger:{avatar:"/img/me.jpg",name:"zhengwenfeng",slogan:"ç©·ååï¼ååéï¼éåä¹"},social:{icons:[{iconClass:"icon-youjian",title:"åé®ä»¶",link:"mailto:lizy928@163.com"},{iconClass:"icon-github",title:"GitHub",link:"https://github.com/msqfx"},{iconClass:"icon-rss",title:"RSSè®¢é",link:"https://www.msqfx.cc/rss.xml"}]},footer:{createYear:2022,copyrightInfo:'msqfx | <a href="https://github.com/msqfx/msqfx.github.io/master/LICENSE" target="_blank">MIT License</a>'},extendFrontmatter:{author:{name:"msqfx",link:"https://github.com/msqfx"},description:"",comment:!0},htmlModules:{homeSidebarB:'<div style="padding: 0.95rem">\n    <p style="\n      color: var(--textColor);\n      opacity: 0.9;\n      font-size: 20px;\n      font-weight: bold;\n      margin: 0 0 8px 0;\n    ">csdn</p>\n    <img src="/img/csdn.png"  style="width:100%;" />\n    ææ¯åå®¢ï¼æ«ç æèæç´¢å³æ³¨\n    </p>\n    </div>'}}};var wl=t(96),xl=t(97),El=t(11);var jl={computed:{$filterPosts(){return this.$site.pages.filter(n=>{const{frontmatter:{pageComponent:e,article:t,home:r}}=n;return!(e||!1===t||!0===r)})},$sortPosts(){return(n=this.$filterPosts).sort((n,e)=>{const t=n.frontmatter.sticky,r=e.frontmatter.sticky;return t&&r?t==r?Object(El.a)(n,e):t-r:t&&!r?-1:!t&&r?1:Object(El.a)(n,e)}),n;var n},$sortPostsByDate(){return(n=this.$filterPosts).sort((n,e)=>Object(El.a)(n,e)),n;var n},$groupPosts(){return function(n){const e={},t={};for(let r=0,a=n.length;r<a;r++){const{frontmatter:{categories:a,tags:o}}=n[r];"array"===Object(El.n)(a)&&a.forEach(t=>{t&&(e[t]||(e[t]=[]),e[t].push(n[r]))}),"array"===Object(El.n)(o)&&o.forEach(e=>{e&&(t[e]||(t[e]=[]),t[e].push(n[r]))})}return{categories:e,tags:t}}(this.$sortPosts)},$categoriesAndTags(){return function(n){const e=[],t=[];for(let t in n.categories)e.push({key:t,length:n.categories[t].length});for(let e in n.tags)t.push({key:e,length:n.tags[e].length});return{categories:e,tags:t}}(this.$groupPosts)}}};$t.component(wl.default),$t.component(xl.default);function Al(n){return n.toString().padStart(2,"0")}t(246);$t.component("Badge",()=>Promise.all([t.e(0),t.e(3)]).then(t.bind(null,445))),$t.component("CodeBlock",()=>Promise.resolve().then(t.bind(null,96))),$t.component("CodeGroup",()=>Promise.resolve().then(t.bind(null,97)));t(247);var Tl=t(95),Sl=t.n(Tl),Cl=t(25);let Bl,zl,Pl;var Il;"valine"===(Il="waline")?t.e(122).then(t.t.bind(null,325,7)).then(n=>zl=n.default):"gitalk"===Il?Promise.all([t.e(0),t.e(121)]).then(t.t.bind(null,326,7)).then(()=>t.e(120).then(t.t.bind(null,327,7))).then(n=>Bl=n.default):"waline"===Il&&t.e(5).then(t.t.bind(null,328,7)).then(n=>Pl=n.default);function ql(n,e){const t={};return Reflect.ownKeys(n).forEach(r=>{if("string"==typeof n[r])try{t[r]=Sl.a.render(n[r],e)}catch(e){console.warn(`Comment config option error at key named "${r}"`),console.warn("More info: "+e.message),t[r]=n[r]}else t[r]=n[r]}),t}console.log(`How to use "waline" in ${Cl.name}@v${Cl.version}:`,Cl.homepage);const Nl={gitalk:{render(n,e){const t=document.createElement("div");t.id=e;document.querySelector("main.page").appendChild(t);new Bl(ql({serverURL:"https://comment.msqfx.cc/"},{frontmatter:n})).render(e)},clear(n){const e=document.querySelector("#"+n);return e&&e.remove(),!0}},valine:{render(n,e){const t=document.createElement("div");t.id=e;document.querySelector("main.page").appendChild(t),new zl({...ql({serverURL:"https://comment.msqfx.cc/"},{frontmatter:n}),el:"#"+e})},clear(n){const e=document.querySelector("#"+n);return e&&e.remove(),!0}},waline:{render(n,e){const t=document.createElement("div");t.id=e;document.querySelector("main.page").appendChild(t),new Pl({...ql({serverURL:"https://comment.msqfx.cc/"},{frontmatter:n}),el:"#"+e})},clear(n){const e=document.querySelector("#"+n);return e&&e.remove(),!0}}},Dl="vuepress-plugin-comment";let Fl=null;function Ol(n){let e={serverURL:"https://comment.msqfx.cc/"}.el||Dl;return e.startsWith("#")&&(e=e.slice(1)),console.log(e),Nl.waline.clear(e)}function Ll(n){return!1!==n.comment&&!1!==n.comments}function Rl(n){clearTimeout(Fl);if(!document.querySelector("main.page"))return void(Fl=setTimeout(()=>Rl(n),200));let e={serverURL:"https://comment.msqfx.cc/"}.el||Dl;return e.startsWith("#")&&(e=e.slice(1)),Nl.waline.render(n,e)}var Ml={mounted(){Fl=setTimeout(()=>{const n={to:{},from:{},...this.$frontmatter};Ol()&&Ll(n)&&Rl(n)},1e3),this.$router.afterEach((n,e)=>{if(n&&e&&n.path===e.path)return;const t={to:n,from:e,...this.$frontmatter};Ol()&&Ll(t)&&Rl(t)})}},Ul=Object(bl.a)(Ml,(function(){var n=this.$createElement;return(this._self._c||n)("div")}),[],!1,null,null,null).exports,Vl={name:"ReadingProgress",data:()=>({readingTop:0,readingHeight:1,progressStyle:null,transform:void 0,running:!1}),watch:{$readingShow(){this.progressStyle=this.getProgressStyle(),this.$readingShow&&window.addEventListener("scroll",this.base)}},mounted(){this.transform=this.getTransform(),this.progressStyle=this.getProgressStyle(),this.$readingShow&&window.addEventListener("scroll",this.base)},beforeDestroy(){this.$readingShow&&window.removeEventListener("scroll",this.base)},methods:{base(){this.running||(this.running=!0,requestAnimationFrame(this.getReadingBase))},getReadingBase(){this.readingHeight=this.getReadingHeight()-this.getScreenHeight(),this.readingTop=this.getReadingTop(),this.progressStyle=this.getProgressStyle(),this.running=!1},getReadingHeight:()=>Math.max(document.body.scrollHeight,document.body.offsetHeight,0),getScreenHeight:()=>Math.max(window.innerHeight,document.documentElement.clientHeight,0),getReadingTop:()=>Math.max(window.pageYOffset,document.documentElement.scrollTop,0),getTransform(){const n=document.createElement("div");return["transform","-webkit-transform","-moz-transform","-o-transform","-ms-transform"].find(e=>e in n.style)||void 0},getProgressStyle(){const n=this.readingTop/this.readingHeight;switch(this.$readingShow){case"top":case"bottom":return this.transform?`${this.transform}: scaleX(${n})`:`width: ${100*n}%`;case"left":case"right":return this.transform?`${this.transform}: scaleY(${n})`:`height: ${100*n}%`;default:return null}}}},Jl=(t(252),Object(bl.a)(Vl,(function(){var n=this.$createElement,e=this._self._c||n;return e("ClientOnly",[this.$readingShow?e("div",{staticClass:"reading-progress",class:this.$readingShow},[e("div",{staticClass:"progress",style:this.progressStyle})]):this._e()])}),[],!1,null,"566fc75b",null).exports),Hl=[({Vue:n,options:e,router:t,siteData:r})=>{},({Vue:n,options:e,router:t,siteData:r})=>{r.pages.map(n=>{const{frontmatter:{date:e,author:t}}=n;"string"==typeof e&&"Z"===e.charAt(e.length-1)&&(n.frontmatter.date=function(n){n instanceof Date||(n=new Date(n));return`${n.getUTCFullYear()}-${Al(n.getUTCMonth()+1)}-${Al(n.getUTCDate())} ${Al(n.getUTCHours())}:${Al(n.getUTCMinutes())}:${Al(n.getUTCSeconds())}`}(e)),t?n.author=t:r.themeConfig.author&&(n.author=r.themeConfig.author)}),n.mixin(jl)},{},({Vue:n})=>{n.mixin({computed:{$dataBlock(){return this.$options.__data__block__}}})},{},{},({Vue:n})=>{n.component("Comment",Ul)},({router:n})=>{"undefined"!=typeof window&&function(){var n=document.createElement("script"),e=window.location.protocol.split(":")[0];n.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(n,t)}()},({router:n})=>{"undefined"!=typeof window&&(window._hmt=window._hmt||[],function(){var n=document.createElement("script");n.src="https://hm.baidu.com/hm.js?7c28cc47ffa100de44e976f816b0b294";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)}(),n.afterEach((function(n){_hmt.push(["_trackPageview",n.fullPath])})))},({Vue:n})=>{n.component(Jl.name,Jl),n.mixin({computed:{$readingShow(){return this.$page.frontmatter.readingShow}}})}],Gl=["Comment","ReadingProgress"];class $l extends class{constructor(){this.store=new $t({data:{state:{}}})}$get(n){return this.store.state[n]}$set(n,e){$t.set(this.store.state,n,e)}$emit(...n){this.store.$emit(...n)}$on(...n){this.store.$on(...n)}}{}Object.assign($l.prototype,{getPageAsyncComponent:ii,getLayoutAsyncComponent:li,getAsyncComponent:ci,getVueComponent:pi});var Kl={install(n){const e=new $l;n.$vuepress=e,n.prototype.$vuepress=e}};function Zl(n,e){const t=e.toLowerCase();return n.options.routes.some(n=>n.path.toLowerCase()===t)}var Wl={props:{pageKey:String,slotKey:{type:String,default:"default"}},render(n){const e=this.pageKey||this.$parent.$page.key;return ui("pageKey",e),$t.component(e)||$t.component(e,ii(e)),$t.component(e)?n(e):n("")}},Xl={functional:!0,props:{slotKey:String,required:!0},render:(n,{props:e,slots:t})=>n("div",{class:["content__"+e.slotKey]},t()[e.slotKey])},Ql={computed:{openInNewWindowTitle(){return this.$themeLocaleConfig.openNewWindowText||"(opens new window)"}}},Yl=(t(253),t(254),Object(bl.a)(Ql,(function(){var n=this.$createElement,e=this._self._c||n;return e("span",[e("svg",{staticClass:"icon outbound",attrs:{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",x:"0px",y:"0px",viewBox:"0 0 100 100",width:"15",height:"15"}},[e("path",{attrs:{fill:"currentColor",d:"M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"}}),this._v(" "),e("polygon",{attrs:{fill:"currentColor",points:"45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"}})]),this._v(" "),e("span",{staticClass:"sr-only"},[this._v(this._s(this.openInNewWindowTitle))])])}),[],!1,null,null,null).exports),nc={functional:!0,render(n,{parent:e,children:t}){if(e._isMounted)return t;e.$once("hook:mounted",()=>{e.$forceUpdate()})}};$t.config.productionTip=!1,$t.use(Hs),$t.use(Kl),$t.mixin(function(n,e,t=$t){!function(n){n.locales&&Object.keys(n.locales).forEach(e=>{n.locales[e].path=e});Object.freeze(n)}(e),t.$vuepress.$set("siteData",e);const r=new(n(t.$vuepress.$get("siteData"))),a=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(r)),o={};return Object.keys(a).reduce((n,e)=>(e.startsWith("$")&&(n[e]=a[e].get),n),o),{computed:o}}(n=>class{setPage(n){this.__page=n}get $site(){return n}get $themeConfig(){return this.$site.themeConfig}get $frontmatter(){return this.$page.frontmatter}get $localeConfig(){const{locales:n={}}=this.$site;let e,t;for(const r in n)"/"===r?t=n[r]:0===this.$page.path.indexOf(r)&&(e=n[r]);return e||t||{}}get $siteTitle(){return this.$localeConfig.title||this.$site.title||""}get $canonicalUrl(){const{canonicalUrl:n}=this.$page.frontmatter;return"string"==typeof n&&n}get $title(){const n=this.$page,{metaTitle:e}=this.$page.frontmatter;if("string"==typeof e)return e;const t=this.$siteTitle,r=n.frontmatter.home?null:n.frontmatter.title||n.title;return t?r?r+" | "+t:t:r||"VuePress"}get $description(){const n=function(n){if(n){const e=n.filter(n=>"description"===n.name)[0];if(e)return e.content}}(this.$page.frontmatter.meta);return n||(this.$page.frontmatter.description||this.$localeConfig.description||this.$site.description||"")}get $lang(){return this.$page.frontmatter.lang||this.$localeConfig.lang||"en-US"}get $localePath(){return this.$localeConfig.path||"/"}get $themeLocaleConfig(){return(this.$site.themeConfig.locales||{})[this.$localePath]||{}}get $page(){return this.__page?this.__page:function(n,e){for(let t=0;t<n.length;t++){const r=n[t];if(r.path.toLowerCase()===e.toLowerCase())return r}return{path:"",frontmatter:{}}}(this.$site.pages,this.$route.path)}},kl)),$t.component("Content",Wl),$t.component("ContentSlotsDistributor",Xl),$t.component("OutboundLink",Yl),$t.component("ClientOnly",nc),$t.component("Layout",li("Layout")),$t.component("NotFound",li("NotFound")),$t.prototype.$withBase=function(n){const e=this.$site.base;return"/"===n.charAt(0)?e+n.slice(1):n},window.__VUEPRESS__={version:"1.9.5",hash:"a23c0e0"},async function(n){const e="undefined"!=typeof window&&window.__VUEPRESS_ROUTER_BASE__?window.__VUEPRESS_ROUTER_BASE__:kl.routerBase||kl.base,t=new Hs({base:e,mode:"history",fallback:!1,routes:_l,scrollBehavior:(n,e,t)=>t||(n.hash?!$t.$vuepress.$get("disableScrollBehavior")&&{selector:decodeURIComponent(n.hash)}:{x:0,y:0})});!function(n){n.beforeEach((e,t,r)=>{if(Zl(n,e.path))r();else if(/(\/|\.html)$/.test(e.path))if(/\/$/.test(e.path)){const t=e.path.replace(/\/$/,"")+".html";Zl(n,t)?r(t):r()}else r();else{const t=e.path+"/",a=e.path+".html";Zl(n,a)?r(a):Zl(n,t)?r(t):r()}})}(t);const r={};try{await Promise.all(Hl.filter(n=>"function"==typeof n).map(e=>e({Vue:$t,options:r,router:t,siteData:kl,isServer:n})))}catch(n){console.error(n)}return{app:new $t(Object.assign(r,{router:t,render:n=>n("div",{attrs:{id:"app"}},[n("RouterView",{ref:"layout"}),n("div",{class:"global-ui"},Gl.map(e=>n(e)))])})),router:t}}(!1).then(({app:n,router:e})=>{e.onReady(()=>{n.$mount("#app")})})}]);