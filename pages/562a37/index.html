<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVM基础入门 | 陌上清风的博客</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <script>var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?7c28cc47ffa100de44e976f816b0b294";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();</script>
    <link rel="alternate" type="application/rss+xml" href="https://www.zhengwenfeng.com/rss.xml" title="陌上清风的博客 RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://www.zhengwenfeng.com/feed.atom" title="陌上清风的博客 Atom Feed">
    <link rel="alternate" type="application/json" href="https://www.zhengwenfeng.com/feed.json" title="陌上清风的博客 JSON Feed">
    <meta name="description" content="假设我们有一个文件 x.Java，你执行 javac，它就会变成 x.class。">
    <meta name="image" content="https://cmty256.github.io/imgs-blog/Java/image-20230811223459658.ku0m0cn1b0g.png">
    <meta name="twitter:title" content="JVM基础入门">
    <meta name="twitter:description" content="假设我们有一个文件 x.Java，你执行 javac，它就会变成 x.class。">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://cmty256.github.io/imgs-blog/Java/image-20230811223459658.ku0m0cn1b0g.png">
    <meta name="twitter:url" content="https://www.msqfx.cc/01.java/04.JVM/01.JVM%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html">
    <meta property="og:type" content="article">
    <meta property="og:title" content="JVM基础入门">
    <meta property="og:description" content="假设我们有一个文件 x.Java，你执行 javac，它就会变成 x.class。">
    <meta property="og:image" content="https://cmty256.github.io/imgs-blog/Java/image-20230811223459658.ku0m0cn1b0g.png">
    <meta property="og:url" content="https://www.msqfx.cc/01.java/04.JVM/01.JVM%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html">
    <meta property="og:site_name" content="msqfx">
    <meta property="article:published_time" content="2023-08-11T22:29:07.000Z">
    <meta property="article:tag" content="null">
    <meta itemprop="name" content="JVM基础入门">
    <meta itemprop="description" content="假设我们有一个文件 x.Java，你执行 javac，它就会变成 x.class。">
    <meta itemprop="image" content="https://cmty256.github.io/imgs-blog/Java/image-20230811223459658.ku0m0cn1b0g.png">
    <meta name="keywords" content="后端博客,个人技术博客,后端,后端开发,后端框架,后端面试题,技术文档,学习,面试,python,go,redis,k8s,mysql,kafka,flask,django,tornado,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="preload" href="/assets/css/0.styles.1a807705.css" as="style"><link rel="preload" href="/assets/js/app.a37af6d9.js" as="script"><link rel="preload" href="/assets/js/2.ba2df60a.js" as="script"><link rel="preload" href="/assets/js/32.7caefc7b.js" as="script"><link rel="prefetch" href="/assets/js/10.49a84f11.js"><link rel="prefetch" href="/assets/js/100.6713a918.js"><link rel="prefetch" href="/assets/js/101.662a7fd4.js"><link rel="prefetch" href="/assets/js/102.7caa9051.js"><link rel="prefetch" href="/assets/js/103.d2e4b5ac.js"><link rel="prefetch" href="/assets/js/104.1b4b2c8e.js"><link rel="prefetch" href="/assets/js/105.fb4fd6d8.js"><link rel="prefetch" href="/assets/js/106.a840626a.js"><link rel="prefetch" href="/assets/js/107.87b06d77.js"><link rel="prefetch" href="/assets/js/108.6b6c072f.js"><link rel="prefetch" href="/assets/js/109.25e2c915.js"><link rel="prefetch" href="/assets/js/11.dc1f7f59.js"><link rel="prefetch" href="/assets/js/110.2a66b5c5.js"><link rel="prefetch" href="/assets/js/111.207f71bd.js"><link rel="prefetch" href="/assets/js/112.8bd38d71.js"><link rel="prefetch" href="/assets/js/113.6713bacc.js"><link rel="prefetch" href="/assets/js/114.29464f99.js"><link rel="prefetch" href="/assets/js/115.96eaf075.js"><link rel="prefetch" href="/assets/js/116.4e5cb7b4.js"><link rel="prefetch" href="/assets/js/117.d1a5de4c.js"><link rel="prefetch" href="/assets/js/118.655c6520.js"><link rel="prefetch" href="/assets/js/119.94830a2a.js"><link rel="prefetch" href="/assets/js/12.d5cafed8.js"><link rel="prefetch" href="/assets/js/120.01eb7047.js"><link rel="prefetch" href="/assets/js/121.a68fd0f7.js"><link rel="prefetch" href="/assets/js/122.93091491.js"><link rel="prefetch" href="/assets/js/13.d35cdd82.js"><link rel="prefetch" href="/assets/js/14.0552ffa3.js"><link rel="prefetch" href="/assets/js/15.dd83f90d.js"><link rel="prefetch" href="/assets/js/16.cd39b01c.js"><link rel="prefetch" href="/assets/js/17.be2c5d1c.js"><link rel="prefetch" href="/assets/js/18.30011395.js"><link rel="prefetch" href="/assets/js/19.91079076.js"><link rel="prefetch" href="/assets/js/20.b9d0dabe.js"><link rel="prefetch" href="/assets/js/21.d9c47444.js"><link rel="prefetch" href="/assets/js/22.acdf2bd8.js"><link rel="prefetch" href="/assets/js/23.bcbd2fc3.js"><link rel="prefetch" href="/assets/js/24.dd45921c.js"><link rel="prefetch" href="/assets/js/25.fc4665a1.js"><link rel="prefetch" href="/assets/js/26.604115fe.js"><link rel="prefetch" href="/assets/js/27.fe372ae0.js"><link rel="prefetch" href="/assets/js/28.269a2f2c.js"><link rel="prefetch" href="/assets/js/29.cb38c79a.js"><link rel="prefetch" href="/assets/js/3.7b7b7ad0.js"><link rel="prefetch" href="/assets/js/30.2a72aaa6.js"><link rel="prefetch" href="/assets/js/31.5e699f78.js"><link rel="prefetch" href="/assets/js/33.2cba8fe7.js"><link rel="prefetch" href="/assets/js/34.1633e2ed.js"><link rel="prefetch" href="/assets/js/35.27c53d02.js"><link rel="prefetch" href="/assets/js/36.525ea1a7.js"><link rel="prefetch" href="/assets/js/37.f9997184.js"><link rel="prefetch" href="/assets/js/38.2e481766.js"><link rel="prefetch" href="/assets/js/39.9edefdc0.js"><link rel="prefetch" href="/assets/js/4.ee8017dd.js"><link rel="prefetch" href="/assets/js/40.d20c14a0.js"><link rel="prefetch" href="/assets/js/41.4a8a99f7.js"><link rel="prefetch" href="/assets/js/42.a3e6900d.js"><link rel="prefetch" href="/assets/js/43.58146ace.js"><link rel="prefetch" href="/assets/js/44.d54f7679.js"><link rel="prefetch" href="/assets/js/45.9f3d0746.js"><link rel="prefetch" href="/assets/js/46.67b6d541.js"><link rel="prefetch" href="/assets/js/47.1bdc2f23.js"><link rel="prefetch" href="/assets/js/48.ce48209b.js"><link rel="prefetch" href="/assets/js/49.1124b5b8.js"><link rel="prefetch" href="/assets/js/5.522bd6ec.js"><link rel="prefetch" href="/assets/js/50.4836a5a2.js"><link rel="prefetch" href="/assets/js/51.2e0285d8.js"><link rel="prefetch" href="/assets/js/52.178fafe1.js"><link rel="prefetch" href="/assets/js/53.76d6f991.js"><link rel="prefetch" href="/assets/js/54.7bae518f.js"><link rel="prefetch" href="/assets/js/55.8ad542dd.js"><link rel="prefetch" href="/assets/js/56.eb3a5866.js"><link rel="prefetch" href="/assets/js/57.66a548b5.js"><link rel="prefetch" href="/assets/js/58.11c919a4.js"><link rel="prefetch" href="/assets/js/59.56ee65ad.js"><link rel="prefetch" href="/assets/js/6.24f2b434.js"><link rel="prefetch" href="/assets/js/60.3f3cc5b3.js"><link rel="prefetch" href="/assets/js/61.6aafaf2b.js"><link rel="prefetch" href="/assets/js/62.3e86764a.js"><link rel="prefetch" href="/assets/js/63.eb854243.js"><link rel="prefetch" href="/assets/js/64.047122c3.js"><link rel="prefetch" href="/assets/js/65.ab3be43f.js"><link rel="prefetch" href="/assets/js/66.0e819df1.js"><link rel="prefetch" href="/assets/js/67.10046f7e.js"><link rel="prefetch" href="/assets/js/68.dd3f9d4c.js"><link rel="prefetch" href="/assets/js/69.61a878dc.js"><link rel="prefetch" href="/assets/js/7.fa04b38a.js"><link rel="prefetch" href="/assets/js/70.723f314f.js"><link rel="prefetch" href="/assets/js/71.d885dd2c.js"><link rel="prefetch" href="/assets/js/72.31685ecb.js"><link rel="prefetch" href="/assets/js/73.b240ced0.js"><link rel="prefetch" href="/assets/js/74.7463a336.js"><link rel="prefetch" href="/assets/js/75.7a05004d.js"><link rel="prefetch" href="/assets/js/76.ecb99c56.js"><link rel="prefetch" href="/assets/js/77.c57bc56b.js"><link rel="prefetch" href="/assets/js/78.00ee2dbd.js"><link rel="prefetch" href="/assets/js/79.b145c896.js"><link rel="prefetch" href="/assets/js/8.9ccba721.js"><link rel="prefetch" href="/assets/js/80.d71abb80.js"><link rel="prefetch" href="/assets/js/81.1552378a.js"><link rel="prefetch" href="/assets/js/82.5f88610a.js"><link rel="prefetch" href="/assets/js/83.b80ddb74.js"><link rel="prefetch" href="/assets/js/84.ae1cf267.js"><link rel="prefetch" href="/assets/js/85.08950c74.js"><link rel="prefetch" href="/assets/js/86.99955193.js"><link rel="prefetch" href="/assets/js/87.7c290c78.js"><link rel="prefetch" href="/assets/js/88.f7f4496c.js"><link rel="prefetch" href="/assets/js/89.bf057c70.js"><link rel="prefetch" href="/assets/js/9.616f3d23.js"><link rel="prefetch" href="/assets/js/90.886e171c.js"><link rel="prefetch" href="/assets/js/91.9ee9ec0e.js"><link rel="prefetch" href="/assets/js/92.1c227473.js"><link rel="prefetch" href="/assets/js/93.4881a96e.js"><link rel="prefetch" href="/assets/js/94.68ac79b2.js"><link rel="prefetch" href="/assets/js/95.744db94e.js"><link rel="prefetch" href="/assets/js/96.77331cfb.js"><link rel="prefetch" href="/assets/js/97.a4e9229f.js"><link rel="prefetch" href="/assets/js/98.60f98d83.js"><link rel="prefetch" href="/assets/js/99.995587b3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1a807705.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/me.jpg" alt="陌上清风的博客" class="logo"> <span class="site-name can-hide">陌上清风的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><a href="/java/" class="link-title">java</a> <span class="title" style="display:none;">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/11aacc/" class="nav-link">基础篇</a></li><li class="dropdown-item"><!----> <a href="/pages/2e780e/" class="nav-link">集合篇</a></li><li class="dropdown-item"><!----> <a href="/pages/846d88/" class="nav-link">并发篇</a></li><li class="dropdown-item"><!----> <a href="/pages/562a37/" aria-current="page" class="nav-link router-link-exact-active router-link-active">JVM</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><a href="/code/" class="link-title">编程</a> <span class="title" style="display:none;">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">python之路</a></li><li class="dropdown-item"><!----> <a href="/go/" class="nav-link">go之路</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">linux</a></li><li class="dropdown-item"><!----> <a href="/pages/19cfb6/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><a href="/middleware/" class="link-title">中间件</a> <span class="title" style="display:none;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kafka/" class="nav-link">kafka</a></li><li class="dropdown-item"><!----> <a href="/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/redis/" class="nav-link">redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="云原生" class="dropdown-title"><a href="/CloudNative/" class="link-title">云原生</a> <span class="title" style="display:none;">云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">docker</a></li><li class="dropdown-item"><!----> <a href="/k8s/" class="nav-link">k8s</a></li></ul></div></div><div class="nav-item"><a href="/readbook/" class="nav-link">读书破万卷</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="我的工具" class="dropdown-title"><!----> <span class="title" style="display:;">我的工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.json.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  json格式化
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://ref.zhengwenfeng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码片段
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.dute.org/nginx-config-formatter/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ng配置格式化
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.pppet.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  corn表达式
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友链</a></li><li class="dropdown-item"><h4>外部页面</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.travellings.cn/go.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开往
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>索引</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li></ul></div></div> <a href="https://github.com/msqfx/msqfx.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/me.jpg"> <div class="blogger-info"><h3>zhengwenfeng</h3> <span>穷则变，变则通，通则久</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><a href="/java/" class="link-title">java</a> <span class="title" style="display:none;">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/11aacc/" class="nav-link">基础篇</a></li><li class="dropdown-item"><!----> <a href="/pages/2e780e/" class="nav-link">集合篇</a></li><li class="dropdown-item"><!----> <a href="/pages/846d88/" class="nav-link">并发篇</a></li><li class="dropdown-item"><!----> <a href="/pages/562a37/" aria-current="page" class="nav-link router-link-exact-active router-link-active">JVM</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><a href="/code/" class="link-title">编程</a> <span class="title" style="display:none;">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">python之路</a></li><li class="dropdown-item"><!----> <a href="/go/" class="nav-link">go之路</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">linux</a></li><li class="dropdown-item"><!----> <a href="/pages/19cfb6/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><a href="/middleware/" class="link-title">中间件</a> <span class="title" style="display:none;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kafka/" class="nav-link">kafka</a></li><li class="dropdown-item"><!----> <a href="/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/redis/" class="nav-link">redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="云原生" class="dropdown-title"><a href="/CloudNative/" class="link-title">云原生</a> <span class="title" style="display:none;">云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">docker</a></li><li class="dropdown-item"><!----> <a href="/k8s/" class="nav-link">k8s</a></li></ul></div></div><div class="nav-item"><a href="/readbook/" class="nav-link">读书破万卷</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="我的工具" class="dropdown-title"><!----> <span class="title" style="display:;">我的工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.json.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  json格式化
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://ref.zhengwenfeng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码片段
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.dute.org/nginx-config-formatter/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ng配置格式化
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.pppet.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  corn表达式
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友链</a></li><li class="dropdown-item"><h4>外部页面</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.travellings.cn/go.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开往
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>索引</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li></ul></div></div> <a href="https://github.com/msqfx/msqfx.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>集合篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>并发篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JVM</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/562a37/" aria-current="page" class="active sidebar-link">JVM基础入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/562a37/#jvm-基础" class="sidebar-link">JVM 基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/562a37/#聊一聊-java-从编码到执行到底是一个怎么样的过程" class="sidebar-link">聊一聊 Java 从编码到执行到底是一个怎么样的过程？</a></li><li class="sidebar-sub-header level3"><a href="/pages/562a37/#什么是-jvm" class="sidebar-link">什么是 JVM?</a></li><li class="sidebar-sub-header level3"><a href="/pages/562a37/#常见的-jvm-实现" class="sidebar-link">常见的 JVM 实现</a></li><li class="sidebar-sub-header level3"><a href="/pages/562a37/#jdk-jre-jvm-的关系" class="sidebar-link">JDK JRE JVM 的关系</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/562a37/#class-文件格式" class="sidebar-link">Class 文件格式</a></li><li class="sidebar-sub-header level2"><a href="/pages/562a37/#类加载-初始化" class="sidebar-link">类加载 - 初始化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/562a37/#加载过程" class="sidebar-link">加载过程</a></li><li class="sidebar-sub-header level3"><a href="/pages/562a37/#类加载器" class="sidebar-link">类加载器</a></li><li class="sidebar-sub-header level3"><a href="/pages/562a37/#双亲委派" class="sidebar-link">双亲委派</a></li><li class="sidebar-sub-header level4"><a href="/pages/562a37/#为什么类加载器要使用双亲委派-重要" class="sidebar-link">为什么类加载器要使用双亲委派？（重要）</a></li><li class="sidebar-sub-header level3"><a href="/pages/562a37/#类加载器范围" class="sidebar-link">类加载器范围</a></li><li class="sidebar-sub-header level3"><a href="/pages/562a37/#自定义类加载器" class="sidebar-link">自定义类加载器</a></li><li class="sidebar-sub-header level4"><a href="/pages/562a37/#loadclass-源码解析" class="sidebar-link">loadClass 源码解析</a></li><li class="sidebar-sub-header level4"><a href="/pages/562a37/#自定义一个类加载器需要做什么" class="sidebar-link">自定义一个类加载器需要做什么？</a></li><li class="sidebar-sub-header level4"><a href="/pages/562a37/#加密" class="sidebar-link">加密</a></li><li class="sidebar-sub-header level3"><a href="/pages/562a37/#编译器" class="sidebar-link">编译器</a></li><li class="sidebar-sub-header level3"><a href="/pages/562a37/#懒加载" class="sidebar-link">懒加载</a></li><li class="sidebar-sub-header level3"><a href="/pages/562a37/#拓展知识" class="sidebar-link">拓展知识</a></li><li class="sidebar-sub-header level4"><a href="/pages/562a37/#双亲委派如何打破" class="sidebar-link">双亲委派如何打破？</a></li><li class="sidebar-sub-header level4"><a href="/pages/562a37/#类加载器涉及到了哪些设计模式" class="sidebar-link">类加载器涉及到了哪些设计模式？</a></li></ul></li></ul></li><li><a href="/pages/ff3623/" class="sidebar-link">JVM常问</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-91157402><div class="articleInfo" data-v-91157402><ul class="breadcrumbs" data-v-91157402><li data-v-91157402><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-91157402></a></li> <li data-v-91157402><a href="/#java" data-v-91157402>java</a></li><li data-v-91157402><a href="/#JVM" data-v-91157402>JVM</a></li></ul> <div class="info" data-v-91157402><div title="作者" class="author iconfont icon-touxiang" data-v-91157402><a href="https://msqfx.github.io" target="_blank" title="作者" class="beLink" data-v-91157402>陌上清风</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-91157402><a href="javascript:;" data-v-91157402>2023-08-11</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">JVM基础入门<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="jvm-基础入门"><a href="#jvm-基础入门" class="header-anchor">#</a> JVM 基础入门</h1> <h2 id="jvm-基础"><a href="#jvm-基础" class="header-anchor">#</a> JVM 基础</h2> <h3 id="聊一聊-java-从编码到执行到底是一个怎么样的过程"><a href="#聊一聊-java-从编码到执行到底是一个怎么样的过程" class="header-anchor">#</a> 聊一聊 Java 从编码到执行到底是一个怎么样的过程？</h3> <p><img src="https://cmty256.github.io/imgs-blog/Java/image-20230811223459658.ku0m0cn1b0g.png" alt="image-20230811223459658"></p> <p>假设我们有一个文件 <code>x.Java</code>，你执行 <code>javac</code>，它就会变成 <code>x.class</code>。</p> <p><em>这个 class 怎么执行的？</em></p> <p>当我们调用 Java 命令的时候，class 会被 load 到内存，这块叫【Classloader】，会被 Classloader 装载到内存里。</p> <p>一般的情况下，我们写自己的类文件的时候也会用到 【Java 的类库】，所以他会把 Java 类库相关的这些个类也要装载到内存里，装载完成之后会调用【字节码解释器】或者是【JIT 即时编译器】来进行解释或编译，编译完之后由【执行引擎】开始执行，这以及下面面对的，那就是操作系统和硬件了。</p> <p>Java 编译好了之后变成 class， class 会被 load 到内存，与此同时像什么 string， object 这些个 class 也都会被 load 到内存。</p> <p><em>Java 是这个解释执行的还是编译执行的？</em></p> <p>其实解释和编译是可以混合的，特别常用的一些代码，代码用到的次数特别多，这个时候他会把代码做成一个及时的编译，做成一个本地的编译。</p> <p>你可以理解为就像 c 语言在 Windows 上执行的时候，把它编译成 exe 一样，那么下次再执行这段代码的时候，就不需要通过解释器来一句一句解释来执行了，执行引擎可以直接交给操作系统去让它调用，这个效率要高很多，不是所有的代码都要都会被 GIT 进行及时编译的，如果是这样的话，那整个 Java 就完全变成了不能跨平台了。</p> <p>所以有一些特定的，执行起来执行次数好多好多，用的特别多的时候，这个时候会进行一个即时编译器的编译。</p> <h3 id="什么是-jvm"><a href="#什么是-jvm" class="header-anchor">#</a> 什么是 JVM?</h3> <p>所谓的 JVM 虚拟机，其实它本身是一个规范，是虚构出来的一台计算机。拥有自己的操作系统，是一个跨语言平台。</p> <p><em>为什么 JVM 虚拟机能够支持多种语言运行在上面呢？</em></p> <p>最关键的原因是就是因为 class 这个东西，我们可以说任何的语言，只要你能编译成 class，符合 class 文件的规范，你就可以扔在 Java 虚拟机上去执行。</p> <p><strong>注意：JVM 只和 class 文件有关，与 java 无关。</strong></p> <p>JDK 官网：<a href="https://docs.oracle.com/javase/specs/" target="_blank" rel="noopener noreferrer">Java SE Specifications (oracle.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>维基百科：<a href="https://zh.wikipedia.org/wiki/Java%E8%99%9A%E6%8B%9F%E6%9C%BA" target="_blank" rel="noopener noreferrer">Java虚拟机 - 维基百科，自由的百科全书 (wikipedia.org)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>甲骨文中国：<a href="https://www.oracle.com/cn/java/" target="_blank" rel="noopener noreferrer">Java 软件 | Oracle 中国<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="常见的-jvm-实现"><a href="#常见的-jvm-实现" class="header-anchor">#</a> 常见的 JVM 实现</h3> <ol><li><p>Hotspot（最常用）</p> <ul><li>oracle 官方，我们做实验用的 JVM，Java 虚拟机</li> <li><code>java -version</code> 命令可查看使用的是什么 JVM</li> <li><strong>Hotspot 8 之后要收费，但 Open JDK 是开源的版本，免费</strong></li></ul></li> <li><p>Jrockit</p> <ul><li>BEA 曾经号称世界上最快的 JVM</li> <li>被 Oracle 收购，合并于 hotspot</li></ul></li> <li><p>TaobaoVM（免费）</p> <ul><li>hotspot 深度定制版</li></ul></li> <li><p>LiquidVM</p> <ul><li>直接针对硬件</li></ul></li> <li><p>azul zing（特别贵）</p> <ul><li>最新垃圾回收的业界标杆（号称 1ms 以内）</li> <li>www.azul.com</li></ul></li> <li><p>J9-IBM</p> <ul><li>Microsoft VM</li></ul></li></ol> <h3 id="jdk-jre-jvm-的关系"><a href="#jdk-jre-jvm-的关系" class="header-anchor">#</a> JDK JRE JVM 的关系</h3> <p>包含关系。</p> <p>JVM -- 运行 java 字节码的虚拟机</p> <p>JRE -- java 运行环境 == jvm + core（核心类库）</p> <p>JDK -- java 开发工具包 == jre + development kit（开发工具）</p> <h2 id="class-文件格式"><a href="#class-文件格式" class="header-anchor">#</a> Class 文件格式</h2> <p>Class 文件格式（<em>File Format</em>）</p> <ul><li>二进制字节流（由 java 虚拟机解释）</li> <li>数据类型: u1 u2 u4 u8 和 _info (表类型)
<ul><li>info 的来源是 hotspot 源码中的写法</li></ul></li> <li>查看 16 进制格式的 ClassFile
<ul><li>软件 - sublime / notepad /</li> <li>IDEA 插件 - BinEd</li></ul></li> <li>有很多可以更好观察 ByteCode 的方法
<ul><li>终端命令：<code>javap &lt;class文件路径&gt;</code>，<code>-v</code> 参数详细查看</li> <li>JBE 可以直接修改</li> <li>JClassLib - IDEA 插件之一</li></ul></li> <li>文件结构
<ul><li><strong>General Information（通用信息）：</strong> 这个部分包含了一些通用的信息，比如文件的魔数（magic number），文件版本号等。</li> <li><strong>Constant Pool（常量池）：</strong> 常量池是一个重要的数据结构，它存储了一系列常量，包括字面值、符号引用、类和接口的名称等。常量池在字节码文件中起到了存储和管理常量数据的作用。</li> <li><strong>Interfaces（接口）：</strong> 这部分定义了该类实现的接口。</li> <li><strong>Fields（字段）：</strong> 这部分描述了类的字段（成员变量），包括字段的名称、类型以及修饰符等信息。</li> <li><strong>Methods（方法）：</strong> 这部分描述了类的方法，包括方法的名称、参数列表、返回类型、字节码指令等。</li> <li><strong>Attributes（属性）：</strong> 属性提供了关于类、字段或方法的其他信息，例如源代码行号、注解等。这个部分可以包含多个不同类型的属性，每个属性都有一个名称和相应的数据。</li></ul></li></ul> <p>如下图示：</p> <p><img src="https://cmty256.github.io/imgs-blog/Java/image.35tlgo72z6o0.png" alt="image"></p> <ul><li><strong>magic</strong>：魔数，是一个固定的字节序列，用于标识 Java 字节码文件。它的值为 0xCAFEBABE，用于确定文件是否是有效的 Java 字节码文件。</li> <li><strong>minor version</strong>：次版本号，指示 Java 编译器版本的次要更新。用于描述字节码文件与Java虚拟机版本的兼容性。</li> <li><strong>major version</strong>：主版本号，指示 Java 编译器版本的主要更新。同样用于描述字节码文件与 Java 虚拟机版本的兼容性。</li> <li><strong>constant_pool_count</strong>：常量池计数，表示常量池中常量的数量。十六进制 0010 转化为十进制为 16。常量池真正存储内容的时候存了 16 -1 项。后面的内容都是引用它。</li> <li><strong>#1:</strong>：常量池项，通常以 # 开头，表示一个常量池中的单个项。</li> <li><strong>access flags</strong>：访问标志，描述类或接口的访问级别和特性。</li> <li><strong>this_class</strong>：当前类的索引，指示当前类在常量池中的位置。</li> <li><strong>super class</strong>：父类的索引，指示父类在常量池中的位置。</li> <li><strong>interface_count</strong>：接口数量，表示该类实现的接口数量。</li> <li><strong>interfaces</strong>：接口列表，描述该类实现的接口在常量池中的位置。</li> <li><strong>fields_count</strong>：字段数量，表示该类中声明的字段数量。</li> <li><strong>methods_count</strong>：方法数量，表示该类中声明的方法数量。</li> <li><strong>method_info</strong>：方法信息，描述方法的访问标志、方法名、参数列表等。</li> <li><strong>attribute_count</strong>：属性数量，表示该类的属性数量。</li></ul> <p>每个部分描述了 Java 字节码文件的不同方面，从类的声明到方法的定义，以及与常量池等相关的信息。这些信息在 Java 虚拟机中被解析和使用，以正确地加载和执行 Java 类。</p> <blockquote><p>Java 的汇编指令有 200 多条。</p> <p>好文分享：<a href="https://zhuanlan.zhihu.com/p/149876413" target="_blank" rel="noopener noreferrer">class类文件结构<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="类加载-初始化"><a href="#类加载-初始化" class="header-anchor">#</a> 类加载 - 初始化</h2> <h3 id="加载过程"><a href="#加载过程" class="header-anchor">#</a> 加载过程</h3> <p>加载、链接和初始化是 Java 程序运行时的三个主要阶段。</p> <ol><li><p>Loading -- 加载</p></li> <li><p>Linking -- 链接</p> <ul><li>Verification -- 验证</li> <li>Preparation -- 准备</li> <li>Resolution -- 解析</li></ul></li> <li><p>Initializing -- 初始化</p></li></ol> <p>具体来说：</p> <ol><li><p><strong>Loading（加载）</strong>： 这是类加载过程的第一个阶段。在这个阶段，Java 虚拟机（JVM）会从类的外部源加载类的二进制数据，通常是从<em>磁盘</em>文件中加载，但也可以是网络、内存等。</p> <p>加载器将类的二进制数据（class文件）从外部源加载到<em>内存</em>中，并将其放置在运行时数据区的方法区内。</p></li> <li><p><strong>Linking（链接）</strong>： 这是加载过程的第二个阶段，它将类的二进制数据链接到 JVM 的运行时状态。</p> <p>链接过程分为以下三个步骤：</p> <ul><li><strong>Verification（验证）</strong>：确保类的二进制数据符合 JVM 规范，不违反类加载的安全性要求。这个步骤确保类的结构正确，不会引发运行时错误。</li> <li><strong>Preparation（准备）</strong>：为类的静态变量分配内存空间，并设置默认的初始值（通常为零值）。这个步骤为类变量分配内存并初始化，但不会为实例变量分配内存。（把 class 文件的静态变量赋默认值，比如 int 类型的默认值为 0）</li> <li><strong>Resolution（解析）</strong>：将（class文件里面的常量池里面用到的）符号引用转换为直接引用，解析动作可以在运行时再完成，也可以在编译时静态完成。这个步骤处理类、接口、方法和字段的符号引用，将其解析为实际的引用。</li></ul></li> <li><p><strong>Initializing（初始化）</strong>： 这是链接过程的最后一个阶段，也是类加载的最终阶段。在这个阶段，类的静态初始化器会被执行，初始化静态字段和执行静态块。这个阶段是在类被首次使用时触发的，例如创建类的实例、访问类的静态字段等。（调用类初始化代码 <code>&lt;clinit&gt;</code>，给静态成员变量赋初始值）</p></li></ol> <p>总结来说，类加载过程涉及到从外部源加载类的二进制数据，然后将其链接到 JVM 的运行时状态，最终进行初始化。链接阶段包括验证、准备和解析，而初始化阶段则会执行类的静态初始化器。这个过程确保类在 Java 虚拟机中正确加载和使用。</p> <p><em>加载之后会发生什么？</em></p> <p>任何一个 class 被加载到内存之后，会生成了两块内容。</p> <ul><li>第一块内容是这个二进制的，这块东西确实被落到内存，放到了内存的一块区域，可以原封不动的扔进去。</li> <li>第二个，它生成了一个 class 类的对象，通过以后其他的那些我们自己写的对象去访问这个对象，通过这个对象去访问 class 类的文件，所以生成一个 class 的对象，这个 class 对象是指向了这块内容。</li></ul> <p>在 Java 虚拟机中，类的元数据，包括类的结构信息、字段、方法、父类、接口等，都会被加载到方法区（元空间<em>Metaspace</em>，替代了永久代<em>PermGen</em>）中。Class 对象本身也是类的元数据之一，因此 Class 对象也存放在方法区中。 Class 对象在内存中的位置可以看作是类的描述符，用来操作该类的字节码以及其他相关的元数据。</p> <p>可以看看下面这两篇文章：</p> <ul><li><a href="https://blog.wangqi.love/articles/Java/%E6%96%B9%E6%B3%95%E5%8C%BA%E4%B8%8EMetaspace.html" target="_blank" rel="noopener noreferrer">方法区与Metaspace<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.zhihu.com/question/40543936" target="_blank" rel="noopener noreferrer">Java8取消permgen，使用mataspace有什么好处，内存结构有什么本质的变化？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="类加载器"><a href="#类加载器" class="header-anchor">#</a> 类加载器</h3> <p>JVM 它本身有一个类加载器的层次，这个类加载器就是一个普通的 class，JVM 有一个类加载器的层次，分别来加载不同的 class。或者说，JVM 里面所有的 class 都是被类加载器给加载到内存的，那么这个类加载器简单说我们可以把它叫做 ClassLoader。</p> <p><img src="https://cmty256.github.io/imgs-blog/Java/image.7dxh3fbo1is0.webp" alt="image"></p> <p><strong>注意：从下往上，是委托给父加载器，不是继承关系，是语法上的一种关系。</strong></p> <p>在 Java 虚拟机中，类加载器按照层次结构进行组织，分为三个主要层次：启动类加载器（Bootstrap ClassLoader）、扩展类加载器（Extension ClassLoader）和应用程序类加载器（Application ClassLoader，也称为系统类加载器）。这些类加载器形成了类加载器的双亲委派模型。</p> <ol><li><strong>启动类加载器（Bootstrap ClassLoader）</strong>：这是 Java 虚拟机的一部分，用于加载 Java 核心库（例如 <code>java.lang</code> 包中的类）。它是所有其他类加载器的父加载器，但它本身不是一个普通的 Java 类，因此在源码中并没有对应的类。它位于虚拟机内部，通常用本地代码实现。它是最顶层的类加载器，负责加载 Java 核心类库。</li> <li><strong>扩展类加载器（Extension ClassLoader）</strong>： 扩展类加载器用于加载 Java 虚拟机的扩展类库，位于 <code>jre/lib/ext</code> 目录中的类。它的父加载器是启动类加载器。</li> <li><strong>应用程序类加载器（Application ClassLoader）</strong>：这个加载器也称为系统类加载器，它负责加载应用程序的类，包括用户自定义的类和第三方库中的类。它的父加载器是扩展类加载器。</li></ol> <p>启动类加载器、扩展类加载器和应用程序类加载器构成了类加载器的层次结构，通过双亲委派模型来保证类的加载的一致性和安全性。在加载一个类时，首先会尝试由父加载器加载，只有在父加载器无法加载时，子加载器才会尝试加载。这个模型可以防止类的重复加载，同时保证了类的隔离性。</p> <p>在启动类加载器加载的类中，有一部分是虚拟机内部的类，比如 <code>java.lang.Object</code>、<code>java.lang.String</code> 等。这些类并不是普通的 Java 类，因此没有对应的源码。而在 Java 虚拟机的源码中，通常会对这些类的加载过程进行描述，但实际上它们是由虚拟机的实现提供的。</p> <p>最顶层加载器 Bootstrap 会返回一个空值。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">T004_ParentAndChild</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">T004_ParentAndChild</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">T004_ParentAndChild</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// App</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">T004_ParentAndChild</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Extension</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">T004_ParentAndChild</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Bootstrap，返回 null</span>
        <span class="token comment">// System.out.println(T004_ParentAndChild.class.getClassLoader().getParent().getParent().getParent()); // 解开注释就会报空指针异常</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>输出结果：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sun.misc.Launcher$AppClassLoader@18b4aac2
null
sun.misc.Launcher$ExtClassLoader@4554617c
null
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="双亲委派"><a href="#双亲委派" class="header-anchor">#</a> 双亲委派</h3> <ol><li>父加载器
<ul><li>父加载器不是【类加载器的加载器】！！！也不是【类加载器的父类加载器】</li></ul></li> <li>双亲委派是一个孩子向父亲方向，然后父亲向孩子方向的双亲委派过程</li> <li>思考：为什么要搞双亲委派？
<ul><li>java.lang.String 类由自定义类加载器加载行不行？ -- 不行，因为不安全</li></ul></li></ol> <p>先是自底向上检查是否已经加载，然后再回过头来找 class 并加载，查看是否加载成功，一直到底都没加载成功就会抛出一个 class 找不到异常。</p> <p><img src="https://cmty256.github.io/imgs-blog/Java/image-20230819014050253.6pstpqtl5m40.webp" alt="image-20230819014050253"></p> <p><em>这个缓存是在哪缓存？</em></p> <p>可以简单的认为是它自己内部维护的一个容器，一个 list 或者一个数组加载的东西都扔在里面。每个加载器都有自己的缓存。</p> <h4 id="为什么类加载器要使用双亲委派-重要"><a href="#为什么类加载器要使用双亲委派-重要" class="header-anchor">#</a> 为什么类加载器要使用双亲委派？（重要）</h4> <p>主要是为了安全。次要原因是资源浪费问题，避免重新加载问题（防止类重复加载）。</p> <h3 id="类加载器范围"><a href="#类加载器范围" class="header-anchor">#</a> 类加载器范围</h3> <p>来自 Launcher 源码</p> <ol><li>启动类加载器 <strong>Bootstrap ClassLoader</strong>：
<ul><li>加载路径：<code>sun.boot.class.path</code></li> <li>范围：它负责加载 Java 核心类库，这些类库包括 Java API 中的基础类，如 <code>java.lang</code> 包下的类等。</li> <li>作用：它是 Java 类加载器中最顶层的类加载器，负责加载虚拟机自身需要的类，以及在运行期间会被系统使用的类。由于 Bootstrap ClassLoader 是用本地代码来实现的，所以在 Java 中无法直接获取到该类加载器的引用。</li></ul></li> <li>扩展类加载器 <strong>ExtensionClassLoader</strong>：
<ul><li>加载路径：<code>java.ext.dirs</code></li> <li>范围：它负责加载 Java 的扩展库，这些库位于 JRE 的 <code>lib/ext</code> 目录或者由系统变量 <code>java.ext.dirs</code> 指定的路径。</li> <li>作用：它负责加载一些 Java 标准扩展库以及一些自定义的扩展库，这些库通常是一些可选的功能。扩展类加载器是由 <code>sun.misc.Launcher$ExtClassLoader</code> 实现的。</li></ul></li> <li>系统类加载器 <strong>AppClassLoader</strong>：
<ul><li>加载路径：<code>java.class.path</code></li> <li>范围：也被称为系统类加载器，它负责加载用户类路径（Classpath）上指定的类。</li> <li>作用：它负责加载应用程序中的类，包括开发者自己编写的类以及引用的第三方类库。应用类加载器是由 <code>sun.misc.Launcher$AppClassLoader</code> 实现的。</li></ul></li></ol> <p>代码查看：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">T003_ClassLoaderScope</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;根目录下加载&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> pathBoot <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;sun.boot.class.path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pathBoot<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;;&quot;</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">lineSeparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;--------------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ext 下加载&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> pathExt <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;java.ext.dirs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pathExt<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;;&quot;</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">lineSeparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;--------------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;App 下加载&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> pathApp <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;java.class.path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pathApp<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;;&quot;</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">lineSeparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>输出结果：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>根目录下加载
C:\Program Files\Java\jdk1.8.0_321\jre\lib\resources.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\rt.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\sunrsasign.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\jsse.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\jce.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\charsets.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\jfr.jar
C:\Program Files\Java\jdk1.8.0_321\jre\classes
--------------------
ext 下加载
C:\Program Files\Java\jdk1.8.0_321\jre\lib\ext
C:\WINDOWS\Sun\Java\lib\ext
--------------------
App 下加载
C:\Program Files\Java\jdk1.8.0_321\jre\lib\charsets.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\deploy.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\ext\access-bridge-64.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\ext\cldrdata.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\ext\dnsns.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\ext\jaccess.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\ext\jfxrt.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\ext\localedata.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\ext\nashorn.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\ext\sunec.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\ext\sunjce_provider.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\ext\sunmscapi.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\ext\sunpkcs11.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\ext\zipfs.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\javaws.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\jce.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\jfr.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\jfxswt.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\jsse.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\management-agent.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\plugin.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\resources.jar
C:\Program Files\Java\jdk1.8.0_321\jre\lib\rt.jar
D:\笔记\学习资料\马士兵\JVM视频源码\out\production\JVM				// 项目路径
D:\software\idea2022\IntelliJ IDEA 2022.1.3\lib\idea_rt.jar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="自定义类加载器"><a href="#自定义类加载器" class="header-anchor">#</a> 自定义类加载器</h3> <p>当你想加载某个类的时候，可以调用 <code>loadClass</code> 方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">T005_LoadClassByHand</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">T005_LoadClassByHand</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">&quot;com.mashibing.jvm.c2_classloader.T002_ClassLoaderLevel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>clazz<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//利用类加载器加载资源，参考坦克图片的加载</span>
        <span class="token comment">//T005_LoadClassByHand.class.getClassLoader().getResourceAsStream(&quot;&quot;);</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="loadclass-源码解析"><a href="#loadclass-源码解析" class="header-anchor">#</a> loadClass 源码解析</h4> <p><code>loadClass</code> 方法是在双亲委派模型下实现的。</p> <p>findInCache -&gt; parent.loadClass -&gt; findClass()</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ClassLoader</span> parent<span class="token punctuation">;</span> <span class="token comment">// final 关键字修饰</span>

<span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">boolean</span> resolve<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token function">getClassLoadingLock</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 首先，检查类是否已经加载</span>
            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> c <span class="token operator">=</span> <span class="token function">findLoadedClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">long</span> t0 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 如果类不在已加载类中，则委派给父类加载器加载</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        c <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 如果没有父加载器，则使用系统类加载器加载</span>
                        c <span class="token operator">=</span> <span class="token function">findBootstrapClassOrNull</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 如果找不到类，抛出ClassNotFoundException</span>
                    <span class="token comment">// 从非空父类装入器</span>
                <span class="token punctuation">}</span>
              
							 <span class="token comment">// 如果父加载器也找不到，则尝试自己加载</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 如果仍未找到，则按顺序调用 findClass</span>
                    <span class="token comment">// to find the class. 要找到这个类</span>
                    <span class="token keyword">long</span> t1 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    c <span class="token operator">=</span> <span class="token function">findClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// 这是定义类装入器；记录统计数据</span>
                    <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>PerfCounter</span><span class="token punctuation">.</span><span class="token function">getParentDelegationTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTime</span><span class="token punctuation">(</span>t1 <span class="token operator">-</span> t0<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>PerfCounter</span><span class="token punctuation">.</span><span class="token function">getFindClassTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addElapsedTimeFrom</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>PerfCounter</span><span class="token punctuation">.</span><span class="token function">getFindClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">resolveClass</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> c<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span> <span class="token comment">// findClass被protected修饰，保护起来</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>主要步骤如下：</p> <ol><li>首先，方法会尝试从已加载的类中查找目标类是否已经加载，如果已经加载，则直接返回该类。</li> <li>如果目标类未加载，它会尝试委派给父类加载器来加载。这是双亲委派模型的核心思想之一。父类加载器会重复这个过程，直到到达启动类加载器（Bootstrap ClassLoader）为止。</li> <li>如果父类加载器也无法加载目标类，则 <code>loadClass</code> 方法会调用 <code>findClass</code> 方法，尝试自己加载目标类。这是子类加载器在加载自己类的<strong>最后一步</strong>。</li> <li>最后，如果 <code>resolve</code> 参数为 <code>true</code>，则会调用 <code>resolveClass</code> 方法，用于解析加载的类，确保类的完整性和正确性。</li></ol> <p><em>什么时候需要自己去加载？</em></p> <p><em>加载进去就生成 class 对象吗？</em></p> <p>不是，要经过 初始化 才生成 class 对象。</p> <h4 id="自定义一个类加载器需要做什么"><a href="#自定义一个类加载器需要做什么" class="header-anchor">#</a> 自定义一个类加载器需要做什么？</h4> <p>只需要做一件事，就是定义自己的 findClass 就可以了。</p> <p>具体来说：</p> <ul><li><p>继承 ClassLoader</p></li> <li><p>重写模板方法 findClass</p> <ul><li>调用 defineClass(byte[] -&gt; Class clazz)</li></ul></li> <li><p>加密：可自定义类加载器加载自加密的 class</p> <ul><li>防止反编译</li> <li>防止篡改</li></ul></li></ul> <p>代码如下：</p> <p>首先继承 ClassLoader 这个类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 自定义类加载器继承自ClassLoader</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">T006_MSBClassLoader</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span> <span class="token punctuation">{</span>

    <span class="token comment">// 重写findClass方法，用于加载类字节码</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 根据类名构建文件路径</span>
        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;c:/test/&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">&quot;.class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 读取字节码文件</span>
            <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ByteArrayOutputStream</span> baos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

            <span class="token comment">// 读取文件内容并写入字节数组输出流</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token operator">=</span>fis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                baos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 将字节数组转换为字节数组</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> baos<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            baos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关闭流</span>

            <span class="token comment">// 使用defineClass方法定义并返回类</span>
            <span class="token keyword">return</span> <span class="token function">defineClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 若加载失败，则调用父类的findClass方法</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">findClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// throws ClassNotFoundException</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 主函数</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建自定义类加载器实例</span>
        <span class="token class-name">ClassLoader</span> l <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T006_MSBClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 通过自定义类加载器加载类</span>
        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> l<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">&quot;com.mashibing.jvm.Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span> clazz1 <span class="token operator">=</span> l<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">&quot;com.mashibing.jvm.Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 输出两次加载的类是否相同</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>clazz <span class="token operator">==</span> clazz1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建加载的类的实例并调用方法</span>
        <span class="token class-name">Hello</span> h <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Hello</span><span class="token punctuation">)</span> clazz<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        h<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 输出类加载器信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出自定义类加载器的类加载器</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出自定义类加载器的父类加载器</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出系统类加载器</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello JVM!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><p>这段代码实现了一个自定义的类加载器 <code>T006_MSBClassLoader</code>，该类加载器继承自 <code>ClassLoader</code>，重写了 <code>findClass</code> 方法来加载类的字节码。在主函数中，使用这个自定义的类加载器加载类，并输出加载的类是否相同，然后创建该类的实例并调用方法。最后，输出了自定义类加载器的类加载器和父类加载器信息，以及系统类加载器的信息。这种自定义类加载器的方式允许你从非标准的位置加载类文件，并且可以通过不同的类加载器实现类的隔离。</p> <hr> <p><code>defineClass</code> 方法是 <code>ClassLoader</code> 类中的一个重要方法，用于将字节数组转换为一个 <code>Class</code> 对象。该方法的作用是将一个【字节数组中的类字节码】转换为一个【Java 类的实例】。当一个类加载器调用 <code>defineClass</code> 方法时，它会将字节数组中的类字节码转换为一个 <code>Class</code> 对象，并返回该对象。(不会验证字节码的正确性)</p> <blockquote><p>输出结果</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>true
Hello JVM!
sun.misc.Launcher$AppClassLoader@18b4aac2
sun.misc.Launcher$AppClassLoader@18b4aac2
sun.misc.Launcher$AppClassLoader@18b4aac2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="加密"><a href="#加密" class="header-anchor">#</a> 加密</h4> <p>大家都知道 java 的代码 class 文件很容易就被反编译了。</p> <p><em>但是我要是定义自己的格式，我不想让别人反编译，这时候怎么办？</em></p> <p>你可以通过自定义的 class loader 来进行。然后在写逻辑的时候加一个加密操作。</p> <h3 id="编译器"><a href="#编译器" class="header-anchor">#</a> 编译器</h3> <p>三大模式：</p> <ul><li>解释器（<em>bytecode intepreter</em>） -- 解释模式</li> <li>JIT（<em>Just In-Time compiler</em>） -- 编译模式</li> <li>混合模式
<ul><li>混合使用解释器 + 热点代码编译（编译成本地代码，就不用在解释器里面解释来执行了，效率提升）</li> <li>起始阶段采用解释执行</li> <li>热点代码检测
<ul><li>多次被调用的方法(方法计数器:监测方法执行频率)</li> <li>多次被调用的循环(循环计数器:检测循环执行频率)</li> <li>进行编译</li></ul></li></ul></li></ul> <p><em>为什么不干脆直接编译成本地代码，那执行效率不更高吗？</em></p> <p>有两个原因。</p> <ol><li>第一，Java 的解释器，现在它的效率也已经非常高了，在一些简单代码的执行上，它并不输于你编译成本地代码。</li> <li>第二，如果你一个执行的文件特别多，各种各样的类库的时候，好几十个 class，你上来二话不说先在内存里编译一遍，这个启动过程会长得吓人。所以它现在默认的模式是混合模式。</li></ol> <p><em>可以用指明参数的方式指定用什么模式</em></p> <ol><li><p>-Xmixed 默认为<strong>混合</strong>模式</p> <p>开始解释执行，启动速度较快，对热点代码实行检测和编译</p></li> <li><p>-Xint 使用<strong>解释</strong>模式，启动很快，执行稍慢</p></li> <li><p>-Xcomp 使用<strong>纯编译</strong>模式，执行很快，启动很慢（要编译的类少的时候，启动也会很快）</p></li></ol> <h3 id="懒加载"><a href="#懒加载" class="header-anchor">#</a> 懒加载</h3> <p>lazyloading</p> <ul><li>严格讲应该叫 lazylnitializing</li> <li>JVM 规范并没有规定何时加载</li> <li>但是严格规定了什么时候必须初始化，五种情况
<ol><li>使用 new，getstatic，putstatic，invokestatic 指令时，访问 final 变量除外</li> <li>java.lang.reflect 对类进行反射调用时</li> <li>初始化子类的时候，父类必须首先初始化</li> <li>虚拟机启动时，被执行的主类必须初始化</li> <li>动态语言支持 java.lang.invoke.MethodHandle 解析的结果为 REF_getstatic, REF_putstatic, REF_invokestatic 的方法句柄时，该类必须初始化</li></ol></li></ul> <h3 id="拓展知识"><a href="#拓展知识" class="header-anchor">#</a> 拓展知识</h3> <h4 id="双亲委派如何打破"><a href="#双亲委派如何打破" class="header-anchor">#</a> 双亲委派如何打破？</h4> <p><font color="red">parent 是如何指定的，打破双亲委派</font></p> <ol><li>用 <code>super(parent)</code> 指定</li> <li>双亲委派的打破
<ol><li>如何打破：重写 <code>loadClass()</code> 方法</li> <li>何时打破过？
<ol><li>JDK1.2 之前，自定义 ClassLoader 都必须重写 loadClass()</li> <li>ThreadContextClassLoader 可以实现基础类调用实现类代码，通过 thread.setContextClassLoader 指定</li> <li>热启动，热部署
<ul><li>osgi tomcat 都有自己的模块指定 classloader（可以加载同一类库的不同版本）</li></ul></li></ol></li></ol></li></ol> <h4 id="类加载器涉及到了哪些设计模式"><a href="#类加载器涉及到了哪些设计模式" class="header-anchor">#</a> 类加载器涉及到了哪些设计模式？</h4> <p>在 Java 虚拟机 (JVM) 中的类加载器 (ClassLoader) 实现中，通常使用了以下两种设计模式：</p> <ol><li><strong>委托模式</strong> (Delegation Pattern)：ClassLoader 的实现通常使用了委托模式来处理类加载请求。委托模式指的是当一个对象收到请求时，它将请求委托给其他对象来处理。在类加载器的情况下，当一个类加载器接收到加载类的请求时，它首先会将请求委托给父类加载器进行处理。如果父类加载器无法加载该类，子类加载器才会尝试加载类。这种委托模式的设计方式可以实现类加载器的层次结构，从而实现类加载器的隔离和类加载的委派。</li> <li><strong>单一职责模式</strong> (Single Responsibility Pattern)：ClassLoader 的主要责任是加载类文件并定义对应的类。ClassLoader 的设计符合单一职责模式，即一个类应该只负责一项职责。ClassLoader 将类加载的职责封装在一个独立的类中，从而使得类加载的逻辑与其他功能解耦，提高了代码的可维护性和可扩展性。</li></ol> <p>除了委托模式和单一职责模式，ClassLoader 的实现可能还涉及其他设计模式，具体取决于实际的实现细节和需求。例如，一些类加载器的缓存机制可能使用了享元模式 (Flyweight Pattern) 来提高性能和资源利用效率。</p></div></div>  <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/277c5b/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Java内存管理总结</div></a> <a href="/pages/ff3623/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">JVM常问</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/277c5b/" class="prev">Java内存管理总结</a></span> <span class="next"><a href="/pages/ff3623/">JVM常问</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/6e0045/"><div>
            kube-proxy源码分析
            <!----></div></a> <span class="date">01-18</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/b3955c/"><div>
            kubernetes service如何通过iptables转发
            <!----></div></a> <span class="date">01-18</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/36b0b2/"><div>
            tcp缓存引起的日志丢失
            <!----></div></a> <span class="date">11-09</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:lizy928@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/msqfx" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://www.msqfx.cc/rss.xml" title="RSS订阅" target="_blank" class="iconfont icon-rss"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2024
    <span>msqfx | <a href="https://github.com/msqfx/msqfx.github.io/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div><!----></div></div>
    <script src="/assets/js/app.a37af6d9.js" defer></script><script src="/assets/js/2.ba2df60a.js" defer></script><script src="/assets/js/32.7caefc7b.js" defer></script>
  </body>
</html>
